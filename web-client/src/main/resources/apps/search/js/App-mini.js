Ext.namespace("Ext.ux.form");Ext.ux.form.TwinTriggerComboBox=function(a){Ext.ux.form.TwinTriggerComboBox.superclass.constructor.apply(this,arguments);};Ext.extend(Ext.ux.form.TwinTriggerComboBox,Ext.form.ComboBox,{trigger1Class:"x-form-clear-trigger",trigger2Class:"",trigger3Class:"x-form-trigger3-trigger",hideTrigger1:true,tooltipType:"qtip",initComponent:function(){Ext.ux.form.TwinTriggerComboBox.superclass.initComponent.call(this);this.addEvents({clear:true,trigger3:true});this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger2Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger3Class}]};},getTrigger:function(a){return this.triggers[a];},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true);var d=this;a.each(function(l,h,j){l.hide=function(){var m=d.wrap.getWidth();this.dom.style.display="none";d.el.setWidth(m-d.trigger.getWidth());};l.show=function(){var m=d.wrap.getWidth();this.dom.style.display="";d.el.setWidth(m-d.trigger.getWidth());};var g="Trigger"+(j+1);if(this["hide"+g]){l.dom.style.display="none";}l.on("click",this["on"+g+"Click"],this,{preventDefault:true});l.addClassOnOver("x-form-trigger-over");l.addClassOnClick("x-form-trigger-click");},this);this.triggers=a.elements;if(this.trigger3TipConfig){var e={target:this.getTrigger(2)};for(var f in this.helpTipConfig){e[f]=this.helpTipConfig[f];}var b=new Ext.ToolTip(e);}if(this.trigger3TipConfig){if(typeof this.trigger3TipConfig=="object"){Ext.QuickTips.register(Ext.apply({target:this.getTrigger(2)},this.trigger3TipConfig));}else{this.getTrigger(2).dom[this.tooltipType]=this.trigger3TipConfig;}}},onTrigger1Click:function(){this.clearValue();this.triggerBlur.defer(50,this);},onTrigger2Click:function(){this.onTriggerClick();},onTrigger3Click:function(){this.fireEvent("trigger3Click",this);},onSelect:function(a,b){Ext.ux.form.TwinTriggerComboBox.superclass.onSelect.apply(this,[a,b]);this.triggers[0].show();},clearValue:function(){Ext.ux.form.TwinTriggerComboBox.superclass.clearValue.call(this);this.triggers[0].hide();this.fireEvent("clear",this);},insert:function(b,d){this.reset();var a=new this.store.recordType(d);a.id=a.data.id;this.store.insert(b,a);this.setValue(a.data.id);this.fireEvent("select",this,a,b);}});Ext.reg("twintriggercombo",Ext.ux.form.TwinTriggerComboBox);
/*!
 * Ext Core Library $version&#xD;&#xA;http://extjs.com/&#xD;&#xA;Copyright(c) 2006-2009, $author.&#xD;&#xA;&#xD;&#xA;The MIT License&#xD;&#xA;&#xD;&#xA;Permission is hereby granted, free of charge, to any person obtaining a copy&#xD;&#xA;of this software and associated documentation files (the &quot;Software&quot;), to deal&#xD;&#xA;in the Software without restriction, including without limitation the rights&#xD;&#xA;to use, copy, modify, merge, publish, distribute, sublicense, and/or sell&#xD;&#xA;copies of the Software, and to permit persons to whom the Software is&#xD;&#xA;furnished to do so, subject to the following conditions:&#xD;&#xA;&#xD;&#xA;The above copyright notice and this permission notice shall be included in&#xD;&#xA;all copies or substantial portions of the Software.&#xD;&#xA;&#xD;&#xA;THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&#xD;&#xA;IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&#xD;&#xA;FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&#xD;&#xA;AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER&#xD;&#xA;LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,&#xD;&#xA;OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN&#xD;&#xA;THE SOFTWARE.&#xD;&#xA;
 */
Ext.ns("Ext.ux");Ext.ux.RatingItem=Ext.extend(Ext.Component,{starWidth:16,resetValue:"",defaultConfig:{defaultSelected:-1,nbStars:5,split:1,selected:-1,showTitles:true,cls:"",disabled:false},constructor:function(a,b){Ext.apply(this,b);Ext.applyIf(this,this.defaultConfig);Ext.ux.RatingItem.superclass.constructor.call(this);this.addEvents("change","reset");if(a==undefined){a=document.createElement("div");a.className=this.itemCls;this.text="";for(var d=0;d<(this.nbStars*this.split);d++){this.text+='<input type="radio" name="rating'+this.id+'" value="'+(d+1)/this.split+'" '+((d+1)/this.split==this.defaultSelected?' checked="true"':"")+'"/>';}a.innerHTML=this.text;}this.el=Ext.get(a);this.init();},onRender:function(){Ext.ux.RatingItem.superclass.onRender.apply(this,arguments);},init:function(){var a=this.disabled;this.values=[];this.titles=[];this.stars=[];this.container=this.el.createChild({cls:"ux-rating-container ux-rating-clearfix"+this.cls});if(this.canReset){this.resetEl=this.container.createChild({cls:"ux-rating-reset",cn:[{tag:"a",title:this.showTitles?(this.resetTitle||"Reset your vote"):"",html:"Reset"}]});this.resetEl.visibilityMode=Ext.Element.DISPLAY;this.resetEl.hover(function(){Ext.fly(this).addClass("ux-rating-reset-hover");},function(){Ext.fly(this).removeClass("ux-rating-reset-hover");});this.resetEl.on("click",this.reset,this);}this.radioBoxes=this.el.select("input[type=radio]");this.radioBoxes.each(this.initStar,this);this.input=this.container.createChild({tag:"input",type:"hidden",name:this.name,value:this.values[this.defaultSelected]||this.resetValue});this.radioBoxes.remove();this.select(this.defaultSelected===undefined?false:this.defaultSelected);if(a){this.disable();}else{this.enable();}},initStar:function(f,e,d){var b=Math.floor(this.starWidth/this.split);if(d==0){this.name=f.dom.name;this.disabled=f.dom.disabled;}this.values[d]=f.dom.value;this.titles[d]=f.dom.title;if(f.dom.checked){this.defaultSelected=d;}var a=this.container.createChild({cls:"ux-rating-star"});var h=a.createChild({tag:"a",html:this.values[d],title:this.showTitles?this.titles[d]:""});if(this.split){var g=(d%this.split);a.setWidth(b);h.setStyle("margin-left","-"+(g*b)+"px");}this.stars.push(a.dom);},onStarClick:function(b,a){if(!this.disabled){this.select(this.stars.indexOf(a));}},onStarOver:function(b,a){if(!this.disabled){this.fillTo(this.stars.indexOf(a),true);}},onStarOut:function(b,a){if(!this.disabled){this.fillTo(this.selected,false);}},reset:function(b,a){this.select(-1);},select:function(a){if(a===false||a===-1){this.value=this.resetValue;this.title="";this.input.dom.value="";if(this.canReset){this.resetEl.setOpacity(0.5);}this.fillNone();if(this.selected!==-1){this.fireEvent("change",this,this.values[a],this.stars[a]);}this.selected=-1;}else{if(a!==this.selected){this.selected=a;this.value=this.values[a];this.title=this.titles[a];this.input.dom.value=this.value;if(this.canReset){this.resetEl.setOpacity(0.99);}this.fillTo(a,false);this.fireEvent("change",this,this.values[a],this.stars[a]);}}},fillTo:function(d,e){if(d!=-1){var a=e?"ux-rating-star-hover":"ux-rating-star-on";var b=e?"ux-rating-star-on":"ux-rating-star-hover";Ext.each(this.stars.slice(0,d+1),function(){Ext.fly(this).removeClass(b).addClass(a);});Ext.each(this.stars.slice(d+1),function(){Ext.fly(this).removeClass([b,a]);});}else{this.fillNone();}},fillNone:function(){this.container.select(".ux-rating-star").removeClass(["ux-rating-star-hover","ux-rating-star-on"]);},enable:function(){if(this.canReset){this.resetEl.show();}this.input.dom.disabled=null;this.disabled=false;this.container.removeClass("ux-rating-disabled");this.container.on({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"});},disable:function(){if(this.canReset){this.resetEl.hide();}this.input.dom.disabled=true;this.disabled=true;this.container.addClass("ux-rating-disabled");this.container.un({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"});},getValue:function(){return this.values[this.selected]||this.resetValue;},destroy:function(){this.disable();
this.container.remove();this.radioBoxes.appendTo(this.el);if(this.selected!==-1){this.radioBoxes.elements[this.selected].checked=true;}}});Ext.reg("ratingitem",Ext.ux.RatingItem);Ext.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected");},onRender:function(a,b){Ext.form.FileUploadField.superclass.onRender.call(this,a,b);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1});var d=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(d,{renderTo:this.wrap,cls:"x-form-file-btn"+(d.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth());}this.fileInput.on("change",function(){var e=this.fileInput.dom.value;this.setValue(e);this.fireEvent("fileselected",this,e);},this);},getFileInputId:function(){return this.id+"-file";},onResize:function(a,b){Ext.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a);}},preFocus:Ext.emptyFn,getResizeEl:function(){return this.wrap;},getPositionEl:function(){return this.wrap;},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0]);}});Ext.reg("fileuploadfield",Ext.form.FileUploadField);Ext.ns("Ext.ux.form");Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"input",type:"hidden"},timeWidth:100,dtSeparator:" ",hiddenFormat:"Y-m-d H:i:s",otherToNow:true,timePosition:"right",dateFormat:"m/d/y",timeFormat:"g:i A",initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);var b=Ext.apply({},{id:this.id+"-date",format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(b);this.df.ownerCt=this;delete (this.dateFormat);var a=Ext.apply({},{id:this.id+"-time",format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(a);this.tf.ownerCt=this;delete (this.timeFormat);this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);this.relayEvents(this.tf,["focus","specialkey","invalid","valid"]);},onRender:function(a,d){if(this.isRendered){return;}Ext.ux.form.DateTime.superclass.onRender.call(this,a,d);var e;if("below"===this.timePosition||"bellow"===this.timePosition){e=Ext.DomHelper.append(a,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",cls:"ux-datetime-time"}]}]},true);}else{e=Ext.DomHelper.append(a,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:4px",cls:"ux-datetime-date"},{tag:"td",cls:"ux-datetime-time"}]}]},true);}this.tableEl=e;this.wrap=e.wrap({cls:"x-form-field-wrap"});this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(e.child("td.ux-datetime-date"));this.tf.render(e.child("td.ux-datetime-time"));if(Ext.isIE&&Ext.isStrict){e.select("input").applyStyles({top:0});}this.on("specialkey",this.onSpecialKey,this);this.df.el.swallowEvent(["keydown","keypress"]);this.tf.el.swallowEvent(["keydown","keypress"]);if("side"===this.msgTarget){var b=this.el.findParent(".x-form-element",10,true);this.errorIcon=b.createChild({cls:"x-form-invalid-icon"});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon;}this.el.dom.name=this.hiddenName||this.name||this.id;this.df.el.dom.removeAttribute("name");this.tf.el.dom.removeAttribute("name");this.isRendered=true;this.updateHidden();},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0]);},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0);},clearInvalid:function(){this.df.clearInvalid();this.tf.clearInvalid();},markInvalid:function(a){this.df.markInvalid(a);this.tf.markInvalid(a);},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.df.destroy();this.tf.destroy();}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable();}this.disabled=true;this.df.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this;},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable();}this.disabled=false;this.df.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this;},focus:function(){this.df.focus();},getPositionEl:function(){return this.wrap;},getResizeEl:function(){return this.wrap;},getValue:function(){return this.dateValue?new Date(this.dateValue):"";},isValid:function(){return this.df.isValid()&&this.tf.isValid();},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible();},onBlur:function(a){if(this.wrapClick){a.focus();this.wrapClick=false;}if(a===this.df){this.updateDate();}else{this.updateTime();}this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var b=this.getValue();if(String(b)!==String(this.startValue)){this.fireEvent("change",this,b,this.startValue);}this.hasFocus=false;this.fireEvent("blur",this);}}).defer(100,this);},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this);}},onMouseDown:function(a){if(!this.disabled){this.wrapClick="td"===a.target.nodeName.toLowerCase();}},onSpecialKey:function(d,a){var b=a.getKey();if(b===a.TAB){if(d===this.df&&!a.shiftKey){a.stopEvent();this.tf.focus();}if(d===this.tf&&a.shiftKey){a.stopEvent();this.df.focus();}}if(b===a.ENTER){this.updateValue();}},setDate:function(a){this.df.setValue(a);},setTime:function(a){this.tf.setValue(a);},setSize:function(a,b){if(!a){return;}if("below"===this.timePosition){this.df.setSize(a,b);this.tf.setSize(a,b);if(Ext.isIE){this.df.el.up("td").setWidth(a);this.tf.el.up("td").setWidth(a);}}else{this.df.setSize(a-this.timeWidth-4,b);this.tf.setSize(this.timeWidth,b);if(Ext.isIE){this.df.el.up("td").setWidth(a-this.timeWidth-4);this.tf.el.up("td").setWidth(this.timeWidth);}}},setValue:function(a){if(!a&&true===this.emptyToNow){this.setValue(new Date());return;}else{if(!a){this.setDate("");this.setTime("");this.updateValue();return;}}if("number"===typeof a){a=new Date(a);}else{if("string"===typeof a&&this.hiddenFormat){a=Date.parseDate(a,this.hiddenFormat);}}a=a?a:new Date(1970,0,1,0,0,0);var b,d;if(a instanceof Date){this.setDate(a);this.setTime(a);this.dateValue=new Date(a);}else{b=a.split(this.dtSeparator);this.setDate(b[0]);if(b[1]){if(b[2]){b[1]+=b[2];}this.setTime(b[1]);}}this.updateValue();},setVisible:function(a){if(a){this.df.show();this.tf.show();}else{this.df.hide();this.tf.hide();}return this;},show:function(){return this.setVisible(true);},hide:function(){return this.setVisible(false);},updateDate:function(){var a=this.df.getValue();if(a){if(!(this.dateValue instanceof Date)){this.initDateValue();if(!this.tf.getValue()){this.setTime(this.dateValue);}}this.dateValue.setMonth(0);this.dateValue.setFullYear(a.getFullYear());this.dateValue.setMonth(a.getMonth(),a.getDate());}else{this.dateValue="";this.setTime("");}},updateTime:function(){var a=this.tf.getValue();if(a&&!(a instanceof Date)){a=Date.parseDate(a,this.tf.format);}if(a&&!this.df.getValue()){this.initDateValue();
this.setDate(this.dateValue);}if(this.dateValue instanceof Date){if(a){this.dateValue.setHours(a.getHours());this.dateValue.setMinutes(a.getMinutes());this.dateValue.setSeconds(a.getSeconds());}else{this.dateValue.setHours(0);this.dateValue.setMinutes(0);this.dateValue.setSeconds(0);}}},updateHidden:function(){if(this.isRendered){var a=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):"";this.el.dom.value=a;}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return;},validate:function(){return this.df.validate()&&this.tf.validate();},renderer:function(a){var d=a.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;d+=" "+(a.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);var b=function(f){var e=Ext.util.Format.date(f,d);return e;};return b;}});Ext.reg("xdatetime",Ext.ux.form.DateTime);
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl);}this.tpl.compile();}this.state={};this.bodyContent={};},getRowClass:function(e,d,b,a){b.cols=b.cols-1;var f=this.bodyContent[e.id];if(!f&&!this.lazyRender){f=this.getBodyContent(e,d);}if(f){b.body=f;}return this.state[e.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed";},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this);},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this});}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this);}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav;}var a=this.grid.getView().mainBody;if(a){a.un("mousedown",this.onMouseDown,this);}},onRowDblClick:function(b,d,a){this.toggleRow(d);},onEnter:function(l){var h=this.grid;var a=h.getSelectionModel();var j=a.getSelections();for(var b=0,f=j.length;b<f;b++){var d=h.getStore().indexOf(j[b]);this.toggleRow(d);}},getBodyContent:function(b,d){if(!this.enableCaching){return this.tpl.apply(b.data);}var a=this.bodyContent[b.id];if(!a){a=this.tpl.apply(b.data);this.bodyContent[b.id]=a;}return a;},onMouseDown:function(d,b){d.stopEvent();var a=d.getTarget(".x-grid3-row");this.toggleRow(a);},renderer:function(d,a,b){a.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>';},beforeExpand:function(d,b,a){if(this.fireEvent("beforeexpand",this,d,b,a)!==false){if(this.tpl&&this.lazyRender){b.innerHTML=this.getBodyContent(d,a);}return true;}else{return false;}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a);}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a);},expandRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a);}var d=this.grid.store.getAt(a.rowIndex);var b=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",a);if(this.beforeExpand(d,b,a.rowIndex)){this.state[d.id]=true;Ext.fly(a).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,d,b,a.rowIndex);}},collapseRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a);}var d=this.grid.store.getAt(a.rowIndex);var b=Ext.fly(a).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,d,b,a.rowIndex)!==false){this.state[d.id]=false;Ext.fly(a).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,d,b,a.rowIndex);}}});Ext.preg("rowexpander",Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;Array.prototype.contains=function(a){return this.indexOf(a)!==-1;};Ext.namespace("Ext.ux");Ext.ux.DDView=function(b){if(!b.itemSelector){var a=b.tpl;if(this.classRe.test(a)){b.tpl=a.replace(this.classRe,"class=$1x-combo-list-item $2$1");}else{b.tpl=a.replace(this.tagRe,'$1 class="x-combo-list-item" $2');}b.itemSelector=".x-combo-list-item";}Ext.ux.DDView.superclass.constructor.call(this,Ext.apply(b,{border:false}));};Ext.extend(Ext.ux.DDView,Ext.DataView,{sortDir:"ASC",isFormField:true,classRe:/class=(['"])(.*)\1/,tagRe:/(<\w*)(.*?>)/,reset:Ext.emptyFn,clearInvalid:Ext.form.Field.prototype.clearInvalid,msgTarget:"qtip",afterRender:function(){Ext.ux.DDView.superclass.afterRender.call(this);if(this.dragGroup){this.setDraggable(this.dragGroup.split(","));}if(this.dropGroup){this.setDroppable(this.dropGroup.split(","));}if(this.deletable){this.setDeletable();}this.isDirtyFlag=false;this.addEvents("drop");},validate:function(){return true;},destroy:function(){this.purgeListeners();this.getEl().removeAllListeners();this.getEl().remove();if(this.dragZone){if(this.dragZone.destroy){this.dragZone.destroy();}}if(this.dropZone){if(this.dropZone.destroy){this.dropZone.destroy();}}},getName:function(){return this.name;},setValue:function(a){if(!this.store){throw"DDView.setValue(). DDView must be constructed with a valid Store";}var b={};b[this.store.reader.meta.root]=a?[].concat(a):[];this.store.proxy=new Ext.data.MemoryProxy(b);this.store.load();},getValue:function(){var a="(";this.store.each(function(b){a+=b.id+",";});return a.substr(0,a.length-1)+")";},getIds:function(){var b=0,a=new Array(this.store.getCount());this.store.each(function(d){a[b++]=d.id;});return a;},isDirty:function(){return this.isDirtyFlag;},getTargetFromEvent:function(b){var a=b.getTarget();while((a!==null)&&(a.parentNode!=this.el.dom)){a=a.parentNode;}if(!a){a=this.el.dom.lastChild||this.el.dom;}return a;},getDragData:function(b){var a=this.findItemFromChild(b.getTarget());if(a){if(!this.isSelected(a)){delete this.ignoreNextClick;this.onItemClick(a,this.indexOf(a),b);this.ignoreNextClick=true;}var g={sourceView:this,viewNodes:[],records:[],copy:this.copy||(this.allowCopy&&b.ctrlKey)};if(this.getSelectionCount()==1){var f=this.getSelectedIndexes()[0];var d=this.getNode(f);g.viewNodes.push(g.ddel=d);g.records.push(this.store.getAt(f));g.repairXY=Ext.fly(d).getXY();}else{g.ddel=document.createElement("div");g.ddel.className="multi-proxy";this.collectSelection(g);}return g;}return false;},getRepairXY:function(a){return this.dragData.repairXY;},collectSelection:function(b){b.repairXY=Ext.fly(this.getSelectedNodes()[0]).getXY();if(this.preserveSelectionOrder===true){Ext.each(this.getSelectedIndexes(),function(f){var e=this.getNode(f);var d=e.cloneNode(true);d.id=Ext.id();b.ddel.appendChild(d);b.records.push(this.store.getAt(f));b.viewNodes.push(e);},this);}else{var a=0;this.store.each(function(d){if(this.isSelected(a)){var e=this.getNode(a);var f=e.cloneNode(true);f.id=Ext.id();b.ddel.appendChild(f);b.records.push(this.store.getAt(a));b.viewNodes.push(e);}a++;},this);}},setDraggable:function(a){if(a instanceof Array){Ext.each(a,this.setDraggable,this);return;}if(this.dragZone){this.dragZone.addToGroup(a);}else{this.dragZone=new Ext.dd.DragZone(this.getEl(),{containerScroll:true,ddGroup:a});if(!this.multiSelect){this.singleSelect=true;}this.dragZone.getDragData=this.getDragData.createDelegate(this);this.dragZone.getRepairXY=this.getRepairXY;this.dragZone.onEndDrag=this.onEndDrag;}},setDroppable:function(a){if(a instanceof Array){Ext.each(a,this.setDroppable,this);return;}if(this.dropZone){this.dropZone.addToGroup(a);}else{this.dropZone=new Ext.dd.DropZone(this.getEl(),{owningView:this,containerScroll:true,ddGroup:a});this.dropZone.getTargetFromEvent=this.getTargetFromEvent.createDelegate(this);
this.dropZone.onNodeEnter=this.onNodeEnter.createDelegate(this);this.dropZone.onNodeOver=this.onNodeOver.createDelegate(this);this.dropZone.onNodeOut=this.onNodeOut.createDelegate(this);this.dropZone.onNodeDrop=this.onNodeDrop.createDelegate(this);}},getDropPoint:function(h,j,f){if(j==this.el.dom){return"above";}var g=Ext.lib.Dom.getY(j),d=g+j.offsetHeight;var a=g+(d-g)/2;var l=Ext.lib.Event.getPageY(h);if(l<=a){return"above";}else{return"below";}},isValidDropPoint:function(f,b,e){if(!e.viewNodes||(e.viewNodes.length!=1)){return true;}var a=e.viewNodes[0];if(a==b){return false;}if((f=="below")&&(b.nextSibling==a)){return false;}if((f=="above")&&(b.previousSibling==a)){return false;}return true;},onNodeEnter:function(b,d,a,f){if(this.highlightColor&&(f.sourceView!=this)){this.el.highlight(this.highlightColor);}return false;},onNodeOver:function(a,b,j,f){var h=this.dropNotAllowed;var g=this.getDropPoint(j,a,b);if(this.isValidDropPoint(g,a,f)){if(this.appendOnly||this.sortField){return"x-tree-drop-ok-below";}if(g){var d;if(g=="above"){h=a.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";d="x-view-drag-insert-above";}else{h=a.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";d="x-view-drag-insert-below";}if(this.lastInsertClass!=d){Ext.fly(a).replaceClass(this.lastInsertClass,d);this.lastInsertClass=d;}}}return h;},onNodeOut:function(b,d,a,f){this.removeDropIndicators(b);},onNodeDrop:function(h,b,o,l){if(this.fireEvent("drop",this,h,b,o,l)===false){return false;}var f=this.getDropPoint(o,h,b);var j=(this.appendOnly||(h==this.el.dom))?this.store.getCount():h.viewIndex;if(f=="below"){j++;}if(l.sourceView==this){if(f=="below"){if(l.viewNodes[0]==h){l.viewNodes.shift();}}else{if(l.viewNodes[l.viewNodes.length-1]==h){l.viewNodes.pop();}}if(!l.viewNodes.length){return false;}if(j>this.store.indexOf(l.records[0])){j--;}}if(l.node instanceof Ext.tree.TreeNode){var d=l.node.getOwnerTree().recordFromNode(l.node);if(d){l.records=[d];}}if(!l.records){alert("Programming problem. Drag data contained no Records");return false;}for(var m=0;m<l.records.length;m++){var d=l.records[m];var g=this.store.getById(d.id);if(g&&(b!=this.dragZone)){if(!this.allowDup&&!this.allowTrash){Ext.fly(this.getNode(this.store.indexOf(g))).frame("red",1);return true;}var a=new Ext.data.Record();d.id=a.id;delete a;}if(l.copy){this.store.insert(j++,d.copy());}else{if(l.sourceView){l.sourceView.isDirtyFlag=true;l.sourceView.store.remove(d);}if(!this.allowTrash){this.store.insert(j++,d);}}if(this.sortField){this.store.sort(this.sortField,this.sortDir);}this.isDirtyFlag=true;}this.dragZone.cachedTarget=null;return true;},onEndDrag:function(b,f){var a=Ext.get(this.dragData.ddel);if(a&&a.hasClass("multi-proxy")){a.remove();}},removeDropIndicators:function(a){if(a){Ext.fly(a).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass";}},setDeletable:function(a){if(!this.singleSelect&&!this.multiSelect){this.singleSelect=true;}var b=this.getContextMenu();this.contextMenu.on("itemclick",function(d){switch(d.id){case"delete":this.remove(this.getSelectedIndexes());break;}},this);this.contextMenu.add({icon:a||AU.resolveUrl("/images/delete.gif"),id:"delete",text:AU.getMessage("deleteItem")});},getContextMenu:function(){if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({id:this.id+"-contextmenu"});this.el.on("contextmenu",this.showContextMenu,this);}return this.contextMenu;},disableContextMenu:function(){if(this.contextMenu){this.el.un("contextmenu",this.showContextMenu,this);}},showContextMenu:function(b,a){a=this.findItemFromChild(b.getTarget());if(a){b.stopEvent();this.select(this.getNode(a),this.multiSelect&&b.ctrlKey,true);this.contextMenu.showAt(b.getXY());}},remove:function(d){d=[].concat(d);for(var b=0;b<d.length;b++){var a=this.store.getAt(d[b]);this.store.remove(a);}},onDblClick:function(d){var b=this.findItemFromChild(d.getTarget());if(b){if(this.fireEvent("dblclick",this,this.indexOf(b),b,d)===false){return false;}if(this.dragGroup){var f=Ext.dd.DragDropMgr.getRelated(this.dragZone,true);while(f.contains(this.dropZone)){f.remove(this.dropZone);}if((f.length==1)&&(f[0].owningView)){this.dragZone.cachedTarget=null;var g=Ext.get(f[0].getEl());var a=g.getBox(true);f[0].onNodeDrop(g.dom,{target:g.dom,xy:[a.x,a.y+a.height-1]},null,this.getDragData(d));}}}},onItemClick:function(d,b,a){if(this.ignoreNextClick){delete this.ignoreNextClick;return;}if(this.fireEvent("beforeclick",this,b,d,a)===false){return false;}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&a.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),b),false);}else{if(this.isSelected(d)&&a.ctrlKey){this.deselect(d);}else{this.deselect(d);this.select(d,this.multiSelect&&a.ctrlKey);this.lastSelection=d;}}a.preventDefault();}return true;}});Ext.ux.Multiselect=Ext.extend(Ext.form.Field,{store:null,dataFields:[],data:[],width:100,height:100,displayField:0,valueField:1,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",copy:false,allowDup:false,allowTrash:false,legend:null,focusClass:undefined,delimiter:",",view:null,dragGroup:null,dropGroup:null,tbar:null,appendOnly:false,sortField:null,sortDir:"ASC",defaultAutoCreate:{tag:"div"},tpl:null,initComponent:function(){Ext.ux.Multiselect.superclass.initComponent.call(this);this.addEvents({dblclick:true,click:true,change:true,drop:true});},onRender:function(a,e){var d,f,g;Ext.ux.Multiselect.superclass.onRender.call(this,a,e);f="ux-mselect";d=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:1px;",tbar:this.tbar});if(!this.legend){d.el.down("."+d.headerCls).remove();}d.body.addClass(f);if(!this.tpl){g='<tpl for="."><div class="'+f+"-item";if(Ext.isIE||Ext.isIE7){g+='" unselectable=on';}else{g+=' x-unselectable"';}g+=">{"+this.displayField+"}</div></tpl>";this.tpl=g;}if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data});}this.view=new Ext.ux.DDView({multiSelect:true,store:this.store,selectedClass:f+"-selected",tpl:this.tpl,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+f+"-item",isFormField:false,applyTo:d.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});d.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeClick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.view.on("drop",function(o,l,m,j,h){return this.fireEvent("drop",o,l,m,j,h);},this);this.hiddenName=this.name;var b={tag:"input",type:"hidden",value:"",name:this.name};if(this.isFormField){this.hiddenField=this.el.createChild(b);}else{this.hiddenField=Ext.get(document.body).createChild(b);}d.doLayout();},initValue:Ext.emptyFn,onViewClick:function(b,g,a,d){var f=this.preClickSelections.indexOf(g);if(f!=-1){this.preClickSelections.splice(f,1);this.view.clearSelections(true);this.view.select(this.preClickSelections);}this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,d);this.validate();},onViewBeforeClick:function(a,d,f,b){this.preClickSelections=this.view.getSelectedIndexes();if(this.disabled){return false;}},onViewDblClick:function(a,d,f,b){return this.fireEvent("dblclick",a,d,f,b);},getValue:function(d){var b=[];var a=this.view.getSelectedIndexes();if(a.length==0){return"";}for(var e=0;e<a.length;e++){b.push(this.store.getAt(a[e]).get(((d!=null)?d:this.valueField)));}return b.join(this.delimiter);},setValue:function(d){var e;var b=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!d||(d=="")){return;}if(!(d instanceof Array)){d=d.split(this.delimiter);}for(var a=0;
a<d.length;a++){e=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+d[a]+"$","i")).itemAt(0));b.push(e);}this.view.select(b);this.hiddenField.dom.value=this.getValue();this.validate();},selectAll:function(){var b=[];for(var a=0;a<this.view.store.getCount();a++){b.push(a);}this.view.select(b);this.hiddenField.dom.value=this.getValue();this.validate();},reset:function(){this.setValue("");},getRawValue:function(a){var b=this.getValue(a);if(b.length){b=b.split(this.delimiter);}else{b=[];}return b;},setRawValue:function(a){setValue(a);},validateValue:function(a){if(a.length<1){if(this.allowBlank){this.clearInvalid();return true;}else{this.markInvalid(this.blankText);return false;}}if(a.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false;}if(a.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false;}return true;}});Ext.reg("multiselect",Ext.ux.Multiselect);Ext.ux.ItemSelector=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,fromAllowDup:false,toAllowDup:false,fromAllowTrash:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},fromTpl:null,toTpl:null,initComponent:function(){Ext.ux.ItemSelector.superclass.initComponent.call(this);this.addEvents({rowdblclick:true,change:true});},onRender:function(f,b){Ext.ux.ItemSelector.superclass.onRender.call(this,f,b);this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.fromAllowDup,copy:this.fromAllowDup,allowTrash:this.fromAllowTrash,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir,tpl:this.fromTpl});this.fromMultiselect.on("dblclick",this.onRowDblClick,this);if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData});}this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.toAllowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.fromSortField,sortDir:this.fromSortDir,tpl:this.toTpl});this.toMultiselect.on("dblclick",this.onRowDblClick,this);var a=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});a.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);var e=new Ext.Panel({header:false});a.add(e);a.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);a.render(this.el);e.el.down("."+e.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/";}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var h=e.getEl();if(!this.toSortField){this.toTopIcon=h.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});h.createChild({tag:"br"});this.upIcon=h.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});h.createChild({tag:"br"});}this.addIcon=h.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});h.createChild({tag:"br"});this.removeIcon=h.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});h.createChild({tag:"br"});if(!this.toSortField){this.downIcon=h.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});h.createChild({tag:"br"});this.toBottomIcon=h.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}});}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this);}this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this);}if((!this.drawUpIcon||this.hideNavIcons)&&this.upIcon){this.upIcon.dom.style.display="none";}if((!this.drawDownIcon||this.hideNavIcons)&&this.downIcon){this.downIcon.dom.style.display="none";}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none";}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none";}if((!this.drawTopIcon||this.hideNavIcons)&&this.toTopIcon){this.toTopIcon.dom.style.display="none";}if((!this.drawBotIcon||this.hideNavIcons)&&this.toBottomIcon){this.toBottomIcon.dom.style.display="none";}var d=a.body.first();this.el.setWidth(a.body.first().getWidth());a.body.removeClass();this.hiddenName=this.name;var g={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(g);this.valueChanged(this.toStore);},initValue:Ext.emptyFn,toTop:function(){var a=this.toMultiselect.view.getSelectedIndexes();var b=[];if(a.length>0){a.sort();for(var d=0;d<a.length;d++){record=this.toMultiselect.view.store.getAt(a[d]);b.push(record);}a=[];for(var d=b.length-1;d>-1;d--){record=b[d];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);a.push(((b.length-1)-d));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(a);},toBottom:function(){var a=this.toMultiselect.view.getSelectedIndexes();var b=[];if(a.length>0){a.sort();for(var d=0;d<a.length;d++){record=this.toMultiselect.view.store.getAt(a[d]);b.push(record);}a=[];for(var d=0;d<b.length;d++){record=b[d];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);a.push((this.toMultiselect.view.store.getCount())-(b.length-d));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(a);},up:function(){var d=null;var a=this.toMultiselect.view.getSelectedIndexes();a.sort();var b=[];if(a.length>0){for(var e=0;e<a.length;e++){d=this.toMultiselect.view.store.getAt(a[e]);if((a[e]-1)>=0){this.toMultiselect.view.store.remove(d);this.toMultiselect.view.store.insert(a[e]-1,d);b.push(a[e]-1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(b);}},down:function(){var d=null;var a=this.toMultiselect.view.getSelectedIndexes();a.sort();a.reverse();var b=[];if(a.length>0){for(var e=0;e<a.length;e++){d=this.toMultiselect.view.store.getAt(a[e]);if((a[e]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(d);this.toMultiselect.view.store.insert(a[e]+1,d);b.push(a[e]+1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(b);}},fromTo:function(){var b=this.fromMultiselect.view.getSelectedIndexes();var e=[];if(b.length>0){for(var a=0;a<b.length;a++){record=this.fromMultiselect.view.store.getAt(b[a]);
e.push(record);}if(!this.toAllowDup){b=[];}for(var a=0;a<e.length;a++){record=e[a];if(this.toAllowDup){var d=new Ext.data.Record();record.id=d.id;delete d;this.toMultiselect.view.store.add(record);}else{if(this.fromAllowTrash){this.fromMultiselect.view.store.remove(record);}this.toMultiselect.view.store.add(record);b.push((this.toMultiselect.view.store.getCount()-1));}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir);}if(this.toAllowDup){this.fromMultiselect.view.select(b);}else{this.toMultiselect.view.select(b);}},toFrom:function(){var a=this.toMultiselect.view.getSelectedIndexes();var b=[];if(a.length>0){for(var d=0;d<a.length;d++){record=this.toMultiselect.view.store.getAt(a[d]);b.push(record);}a=[];for(var d=0;d<b.length;d++){record=b[d];this.toMultiselect.view.store.remove(record);if(!this.fromAllowDup){this.fromMultiselect.view.store.add(record);a.push((this.fromMultiselect.view.store.getCount()-1));}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir);}this.fromMultiselect.view.select(a);},valueChanged:function(a){var d=null;var e=[];for(var b=0;b<a.getCount();b++){d=a.getAt(b);e.push(d.get(this.valueField));}this.hiddenField.dom.value=e.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);},getValue:function(){return this.hiddenField.dom.value;},onRowDblClick:function(a,d,f,b){return this.fireEvent("rowdblclick",a,d,f,b);},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();if(!this.fromAllowDup){this.fromMultiselect.store.add(range);this.fromMultiselect.store.sort(this.displayField,"ASC");}this.valueChanged(this.toMultiselect.store);}});Ext.reg("itemselector",Ext.ux.ItemSelector);
/*!
 * Ext Core Library $version&#xD;&#xA;http://extjs.com/&#xD;&#xA;Copyright(c) 2006-2009, $author.&#xD;&#xA;&#xD;&#xA;The MIT License&#xD;&#xA;&#xD;&#xA;Permission is hereby granted, free of charge, to any person obtaining a copy&#xD;&#xA;of this software and associated documentation files (the &quot;Software&quot;), to deal&#xD;&#xA;in the Software without restriction, including without limitation the rights&#xD;&#xA;to use, copy, modify, merge, publish, distribute, sublicense, and/or sell&#xD;&#xA;copies of the Software, and to permit persons to whom the Software is&#xD;&#xA;furnished to do so, subject to the following conditions:&#xD;&#xA;&#xD;&#xA;The above copyright notice and this permission notice shall be included in&#xD;&#xA;all copies or substantial portions of the Software.&#xD;&#xA;&#xD;&#xA;THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&#xD;&#xA;IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&#xD;&#xA;FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&#xD;&#xA;AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER&#xD;&#xA;LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,&#xD;&#xA;OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN&#xD;&#xA;THE SOFTWARE.&#xD;&#xA;
 */
Ext.ns("Ext.ux");Ext.ux.Lightbox=(function(){var a={},e=[],b,d=false,f=[];return{overlayOpacity:0.85,animate:true,resizeSpeed:8,borderSize:10,labelImage:"Image",labelOf:"of",init:function(){this.resizeDuration=this.animate?((11-this.resizeSpeed)*0.15):0;this.overlayDuration=this.animate?0.2:0;if(!d){Ext.apply(this,Ext.util.Observable.prototype);Ext.util.Observable.constructor.call(this);this.addEvents("open","close");this.initMarkup();this.initEvents();d=true;}},initMarkup:function(){a.shim=Ext.DomHelper.append(document.body,{tag:"iframe",id:"ux-lightbox-shim"},true);a.overlay=Ext.DomHelper.append(document.body,{id:"ux-lightbox-overlay"},true);var g=new Ext.Template(this.getTemplate());a.lightbox=g.append(document.body,{},true);var h=["outerImageContainer","imageContainer","image","hoverNav","navPrev","navNext","loading","loadingLink","outerDataContainer","dataContainer","data","details","caption","imageNumber","bottomNav","navClose"];Ext.each(h,function(l){a[l]=Ext.get("ux-lightbox-"+l);});Ext.each([a.overlay,a.lightbox,a.shim],function(l){l.setVisibilityMode(Ext.Element.DISPLAY);l.hide();});var j=(this.animate?250:1)+"px";a.outerImageContainer.setStyle({width:j,height:j});},getTemplate:function(){return['<div id="ux-lightbox">','<div id="ux-lightbox-outerImageContainer">','<div id="ux-lightbox-imageContainer">','<img id="ux-lightbox-image">','<div id="ux-lightbox-hoverNav">','<a href="#" id="ux-lightbox-navPrev"></a>','<a href="#" id="ux-lightbox-navNext"></a>',"</div>",'<div id="ux-lightbox-loading">','<a id="ux-lightbox-loadingLink"></a>',"</div>","</div>","</div>",'<div id="ux-lightbox-outerDataContainer">','<div id="ux-lightbox-dataContainer">','<div id="ux-lightbox-data">','<div id="ux-lightbox-details">','<span id="ux-lightbox-caption"></span>','<span id="ux-lightbox-imageNumber"></span>',"</div>",'<div id="ux-lightbox-bottomNav">','<a href="#" id="ux-lightbox-navClose"></a>',"</div>","</div>","</div>","</div>","</div>"];},initEvents:function(){var g=function(h){h.preventDefault();this.close();};a.overlay.on("click",g,this);a.loadingLink.on("click",g,this);a.navClose.on("click",g,this);a.lightbox.on("click",function(h){if(h.getTarget().id=="ux-lightbox"){this.close();}},this);a.navPrev.on("click",function(h){h.preventDefault();this.setImage(b-1);},this);a.navNext.on("click",function(h){h.preventDefault();this.setImage(b+1);},this);},register:function(g,h){if(f.indexOf(g)===-1){f.push(g);Ext.fly(document).on("click",function(j){var l=j.getTarget(g);if(l){j.preventDefault();this.open(l,g,h);}},this);}},open:function(h,j,g){g=g||false;this.setViewSize();a.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,callback:function(){e=[];var q=0;if(!g){e.push([h.href,h.title]);}else{var r=Ext.query(j);Ext.each(r,function(s){if(s.href){e.push([s.href,s.title]);}});while(e[q][0]!=h.href){q++;}}var m=Ext.fly(document).getScroll();var o=m.top+(Ext.lib.Dom.getViewportHeight()/10);var l=m.left;a.lightbox.setStyle({top:o+"px",left:l+"px"}).show();this.setImage(q);this.fireEvent("open",e[q]);},scope:this});},setViewSize:function(){var h=this.getViewSize(),g=this.getDocumentSize();a.overlay.setStyle({width:g[0]+"px",height:g[1]+"px"});a.shim.setStyle({width:h[0]+"px",height:h[1]+"px"}).show();},setImage:function(h){b=h;this.disableKeyNav();if(this.animate){a.loading.show();}a.image.hide();a.hoverNav.hide();a.navPrev.hide();a.navNext.hide();a.dataContainer.setOpacity(0.0001);a.imageNumber.hide();var g=new Image();g.onload=(function(){a.image.dom.src=e[b][0];this.resizeImage(g.width,g.height);}).createDelegate(this);g.src=e[b][0];},resizeImage:function(o,s){var q=a.outerImageContainer.getWidth();var j=a.outerImageContainer.getHeight();var h=(o+this.borderSize*2);var g=(s+this.borderSize*2);var m=q-h;var r=j-g;var l=function(){a.hoverNav.setWidth(a.imageContainer.getWidth()+"px");a.navPrev.setHeight(s+"px");a.navNext.setHeight(s+"px");a.outerDataContainer.setWidth(h+"px");this.showImage();};if(r!=0||m!=0){a.outerImageContainer.shift({height:g,width:h,duration:this.resizeDuration,scope:this,callback:l,delay:50});}else{l.call(this);}},showImage:function(){a.loading.hide();a.image.fadeIn({duration:this.resizeDuration,scope:this,callback:function(){this.updateDetails();}});this.preloadImages();},updateDetails:function(){var g=a.data.getWidth(true)-a.navClose.getWidth()-10;a.details.setWidth((g>0?g:0)+"px");a.caption.update(e[b][1]);a.caption.show();if(e.length>1){a.imageNumber.update(this.labelImage+" "+(b+1)+" "+this.labelOf+"  "+e.length);a.imageNumber.show();}a.dataContainer.fadeIn({duration:this.resizeDuration/2,scope:this,callback:function(){var h=this.getDocumentSize();a.overlay.setHeight(h[1]+"px");this.updateNav();}});},updateNav:function(){this.enableKeyNav();
a.hoverNav.show();if(b>0){a.navPrev.show();}if(b<(e.length-1)){a.navNext.show();}},enableKeyNav:function(){Ext.fly(document).on("keydown",this.keyNavAction,this);},disableKeyNav:function(){Ext.fly(document).un("keydown",this.keyNavAction,this);},keyNavAction:function(g){var h=g.getKey();if(h==88||h==67||h==27){this.close();}else{if(h==80||h==37){if(b!=0){this.setImage(b-1);}}else{if(h==78||h==39){if(b!=(e.length-1)){this.setImage(b+1);}}}}},preloadImages:function(){var g,h;if(e.length>b+1){g=new Image();g.src=e[b+1][0];}if(b>0){h=new Image();h.src=e[b-1][0];}},close:function(){this.disableKeyNav();a.lightbox.hide();a.overlay.fadeOut({duration:this.overlayDuration});a.shim.hide();this.fireEvent("close",b);},getViewSize:function(){return[Ext.lib.Dom.getViewWidth(),Ext.lib.Dom.getViewHeight()];},getDocumentSize:function(){return[Ext.lib.Dom.getDocumentWidth(),Ext.lib.Dom.getDocumentHeight()];}};})();Ext.onReady(Ext.ux.Lightbox.init,Ext.ux.Lightbox);Ext.namespace("Ext.ux.form");Ext.ux.form.SuperBoxSelect=function(a){Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,a);this.addEvents("beforeadditem","additem","newitem","beforeremoveitem","removeitem","clear");};Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.form.ComboBox,{addNewDataOnBlur:false,allowAddNewData:false,allowQueryAll:true,backspaceDeletesLastItem:true,classField:null,clearBtnCls:"",clearLastQueryOnEscape:false,clearOnEscape:false,displayFieldTpl:null,extraItemCls:"",extraItemStyle:"",expandBtnCls:"",fixFocusOnTabSelect:true,forceFormValue:true,forceSameValueQuery:false,itemDelimiterKey:Ext.EventObject.ENTER,navigateItemsWithTab:true,pinList:true,preventDuplicates:true,queryFilterRe:"",queryValuesDelimiter:"|",queryValuesIndicator:"valuesqry",removeValuesFromStore:true,renderFieldBtns:true,stackItems:false,styleField:null,supressClearValueRemoveEvents:false,validationEvent:"blur",valueDelimiter:",",initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(false),usedRecords:new Ext.util.MixedCollection(false),addedRecords:[],remoteLookup:[],hideTrigger:true,grow:false,resizable:false,multiSelectMode:false,preRenderValue:null,filteredQueryData:""});if(this.queryFilterRe){if(Ext.isString(this.queryFilterRe)){this.queryFilterRe=new RegExp(this.queryFilterRe);}}if(this.transform){this.doTransform();}if(this.forceFormValue){this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this});}Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this);if(this.mode==="remote"&&this.store){this.store.on("load",this.onStoreLoad,this);}},onRender:function(e,d){var a=this.hiddenName;this.hiddenName=null;Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,e,d);this.hiddenName=a;this.manageNameAttribute();var b=(this.stackItems===true)?"x-superboxselect-stacked":"";if(this.renderFieldBtns){b+=" x-superboxselect-display-btns";}this.el.removeClass("x-form-text").addClass("x-superboxselect-input-field");this.wrapEl=this.el.wrap({tag:"ul"});this.outerWrapEl=this.wrapEl.wrap({tag:"div",cls:"x-form-text x-superboxselect "+b});this.inputEl=this.el.wrap({tag:"li",cls:"x-superboxselect-input"});if(this.renderFieldBtns){this.setupFieldButtons().manageClearBtn();}this.setupFormInterception();},doTransform:function(){var g=Ext.getDom(this.transform),j=[];if(!this.store){this.mode="local";var m=[],a=g.options;for(var h=0,l=a.length;h<l;h++){var e=a[h],f=Ext.get(e),q=f.getAttributeNS(null,"value")||"",r=f.getAttributeNS(null,"className")||"",b=f.getAttributeNS(null,"style")||"";if(e.selected){j.push(q);}m.push([q,e.text,r,typeof(b)==="string"?b:b.cssText]);}this.store=new Ext.data.SimpleStore({id:0,fields:["value","text","cls","style"],data:m});Ext.apply(this,{valueField:"value",displayField:"text",classField:"cls",styleField:"style"});}if(j.length){this.value=j.join(",");}},setupFieldButtons:function(){this.buttonWrap=this.outerWrapEl.createChild({cls:"x-superboxselect-btns"});this.buttonClear=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-clear "+this.clearBtnCls});if(this.allowQueryAll){this.buttonExpand=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-expand "+this.expandBtnCls});}this.initButtonEvents();return this;},initButtonEvents:function(){this.buttonClear.addClassOnOver("x-superboxselect-btn-over").on("click",function(a){a.stopEvent();if(this.disabled){return;}this.clearValue();this.el.focus();},this);if(this.allowQueryAll){this.buttonExpand.addClassOnOver("x-superboxselect-btn-over").on("click",function(a){a.stopEvent();if(this.disabled){return;}if(this.isExpanded()){this.multiSelectMode=false;}else{if(this.pinList){this.multiSelectMode=true;}}this.onTriggerClick();},this);}},removeButtonEvents:function(){this.buttonClear.removeAllListeners();if(this.allowQueryAll){this.buttonExpand.removeAllListeners();}return this;},clearCurrentFocus:function(){if(this.currentFocus){this.currentFocus.onLnkBlur();this.currentFocus=null;}return this;},initEvents:function(){var a=this.el;a.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this});this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this});this.wrapEl.on("click",this.onWrapClick,this);this.outerWrapEl.on("click",this.onWrapClick,this);this.inputEl.focus=function(){a.focus();};Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this);Ext.apply(this.keyNav,{tab:function(b){if(this.fixFocusOnTabSelect&&this.isExpanded()){b.stopEvent();a.blur();this.onViewClick(false);this.focus(false,10);return true;}this.onViewClick(false);if(a.dom.value!==""){this.setRawValue("");}return true;},down:function(b){if(!this.isExpanded()&&!this.currentFocus){if(this.allowQueryAll){this.onTriggerClick();}}else{this.inKeyMode=true;this.selectNext();}},enter:function(){}});},onClick:function(){this.clearCurrentFocus();this.collapse();this.autoSize();},beforeBlur:function(){if(this.allowAddNewData&&this.addNewDataOnBlur){var a=this.el.dom.value;if(a!==""){this.fireNewItemEvent(a);}}Ext.form.ComboBox.superclass.beforeBlur.call(this);},onFocus:function(){this.outerWrapEl.addClass(this.focusClass);Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this);},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass);this.clearCurrentFocus();if(this.el.dom.value!==""){this.applyEmptyText();this.autoSize();}Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this);},onCollapse:function(){this.view.clearSelections();this.multiSelectMode=false;},onWrapClick:function(a){a.stopEvent();this.collapse();this.el.focus();this.clearCurrentFocus();},markInvalid:function(a){var d,b;if(!this.rendered||this.preventMark){return;}this.outerWrapEl.addClass(this.invalidClass);a=a||this.invalidText;switch(this.msgTarget){case"qtip":Ext.apply(this.el.dom,{qtip:a,qclass:"x-form-invalid-tip"});Ext.apply(this.wrapEl.dom,{qtip:a,qclass:"x-form-invalid-tip"});if(Ext.QuickTips){Ext.QuickTips.enable();}break;case"title":this.el.dom.title=a;this.wrapEl.dom.title=a;this.outerWrapEl.dom.title=a;break;case"under":if(!this.errorEl){d=this.getErrorCt();if(!d){this.el.dom.title=a;break;}this.errorEl=d.createChild({cls:"x-form-invalid-msg"});this.errorEl.setWidth(d.getWidth(true)-20);}this.errorEl.update(a);Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);break;case"side":if(!this.errorIcon){d=this.getErrorCt();if(!d){this.el.dom.title=a;break;}this.errorIcon=d.createChild({cls:"x-form-invalid-icon"});}this.alignErrorIcon();Ext.apply(this.errorIcon.dom,{qtip:a,qclass:"x-form-invalid-tip"});this.errorIcon.show();this.on("resize",this.alignErrorIcon,this);break;default:b=Ext.getDom(this.msgTarget);b.innerHTML=a;b.style.display=this.msgDisplay;break;}this.fireEvent("invalid",this,a);},clearInvalid:function(){if(!this.rendered||this.preventMark){return;}this.outerWrapEl.removeClass(this.invalidClass);switch(this.msgTarget){case"qtip":this.el.dom.qtip="";this.wrapEl.dom.qtip="";break;
case"title":this.el.dom.title="";this.wrapEl.dom.title="";this.outerWrapEl.dom.title="";break;case"under":if(this.errorEl){Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this);}break;case"side":if(this.errorIcon){this.errorIcon.dom.qtip="";this.errorIcon.hide();this.un("resize",this.alignErrorIcon,this);}break;default:var a=Ext.getDom(this.msgTarget);a.innerHTML="";a.style.display="none";break;}this.fireEvent("valid",this);},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[Ext.isIE?5:2,3]);}},expand:function(){if(this.isExpanded()||!this.hasFocus){return;}if(this.bufferSize){this.doResize(this.bufferSize);delete this.bufferSize;}this.list.alignTo(this.outerWrapEl,this.listAlign).show();this.innerList.setOverflow("auto");this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent("expand",this);},restrictHeight:function(){var f=this.innerList.dom,b=f.scrollTop,g=this.list;f.style.height="";var j=g.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,d=Math.max(f.clientHeight,f.offsetHeight,f.scrollHeight),l=this.getPosition()[1]-Ext.getBody().getScroll().top,a=Ext.lib.Dom.getViewHeight()-l-this.getSize().height,e=Math.max(l,a,this.minHeight||0)-g.shadowOffset-j-5;d=Math.min(d,e,this.maxHeight);this.innerList.setHeight(d);g.beginUpdate();g.setHeight(d+j);g.alignTo(this.outerWrapEl,this.listAlign);g.endUpdate();if(this.multiSelectMode){f.scrollTop=b;}},validateValue:function(a){if(this.items.getCount()===0){if(this.allowBlank){this.clearInvalid();return true;}else{this.markInvalid(this.blankText);return false;}}this.clearInvalid();return true;},manageNameAttribute:function(){if(this.items.getCount()===0&&this.forceFormValue){this.el.dom.setAttribute("name",this.hiddenName||this.name);}else{this.el.dom.removeAttribute("name");}},setupFormInterception:function(){var a;this.findParentBy(function(d){if(d.getForm){a=d.getForm();}});if(a){var b=a.getValues;a.getValues=function(d){this.el.dom.disabled=true;var f=this.el.dom.value;this.setRawValue("");var e=b.call(a);this.el.dom.disabled=false;this.setRawValue(f);if(this.forceFormValue&&this.items.getCount()===0){e[this.name]="";}return d?Ext.urlEncode(e):e;}.createDelegate(this);}},onResize:function(e,a,d,f){var b=Ext.isIE6?4:Ext.isIE7?1:Ext.isIE8?1:0;if(this.wrapEl){this._width=e;this.outerWrapEl.setWidth(e-b);if(this.renderFieldBtns){b+=(this.buttonWrap.getWidth()+20);this.wrapEl.setWidth(e-b);}}Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,e,a,d,f);this.autoSize();},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this);this.items.each(function(a){a.enable();});if(this.renderFieldBtns){this.initButtonEvents();}},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this);this.items.each(function(a){a.disable();});if(this.renderFieldBtns){this.removeButtonEvents();}},clearValue:function(a){Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this);this.preventMultipleRemoveEvents=a||this.supressClearValueRemoveEvents||false;this.removeAllItems();this.preventMultipleRemoveEvents=false;this.fireEvent("clear",this);return this;},fireNewItemEvent:function(a){this.view.clearSelections();this.collapse();this.setRawValue("");if(this.queryFilterRe){a=a.replace(this.queryFilterRe,"");if(!a){return;}}this.fireEvent("newitem",this,a,this.filteredQueryData);},onKeyUp:function(a){if(this.editable!==false&&(!a.isSpecialKey()||a.getKey()===a.BACKSPACE)&&this.itemDelimiterKey.indexOf!==a.getKey()&&(!a.hasModifier()||a.shiftKey)){this.lastKey=a.getKey();this.dqTask.delay(this.queryDelay);}},onKeyDownHandler:function(g,b){var j,l,a;if(g.getKey()===g.ESC){if(!this.isExpanded()){if(this.el.dom.value!=""&&(this.clearOnEscape||this.clearLastQueryOnEscape)){if(this.clearOnEscape){this.el.dom.value="";}if(this.clearLastQueryOnEscape){this.lastQuery="";}g.stopEvent();}}}if((g.getKey()===g.DELETE||g.getKey()===g.SPACE)&&this.currentFocus){g.stopEvent();j=this.currentFocus;this.on("expand",function(){this.collapse();},this,{single:true});a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){l=this.items.itemAt(a+1);}j.preDestroy(true);if(l){(function(){l.onLnkFocus();this.currentFocus=l;}).defer(200,this);}return true;}var h=this.el.dom.value,d,f=g.ctrlKey;if(this.itemDelimiterKey===g.getKey()){g.stopEvent();if(h!==""){if(f||!this.isExpanded()){this.fireNewItemEvent(h);}else{this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this);}}}else{if(!this.isExpanded()){return;}this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this);}}return true;}if(h!==""){this.autoSize();return;}if(g.getKey()===g.HOME){g.stopEvent();if(this.items.getCount()>0){this.collapse();d=this.items.get(0);d.el.focus();}return true;}if(g.getKey()===g.BACKSPACE){g.stopEvent();if(this.currentFocus){j=this.currentFocus;this.on("expand",function(){this.collapse();},this,{single:true});a=this.items.indexOfKey(j.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){l=this.items.itemAt(a+1);}j.preDestroy(true);if(l){(function(){l.onLnkFocus();this.currentFocus=l;}).defer(200,this);}return;}else{d=this.items.get(this.items.getCount()-1);if(d){if(this.backspaceDeletesLastItem){this.on("expand",function(){this.collapse();},this,{single:true});d.preDestroy(true);}else{if(this.navigateItemsWithTab){d.onElClick();}else{this.on("expand",function(){this.collapse();this.currentFocus=d;this.currentFocus.onLnkFocus.defer(20,this.currentFocus);},this,{single:true});}}}return true;}}if(!g.isNavKeyPress()){this.multiSelectMode=false;this.clearCurrentFocus();return;}if(g.getKey()===g.LEFT||(g.getKey()===g.UP&&!this.isExpanded())){g.stopEvent();this.collapse();d=this.items.get(this.items.getCount()-1);if(this.navigateItemsWithTab){if(d){d.focus();}}else{if(this.currentFocus){a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a!==0){this.currentFocus=this.items.itemAt(a-1);this.currentFocus.onLnkFocus();}}else{this.currentFocus=d;if(d){d.onLnkFocus();}}}return true;}if(g.getKey()===g.DOWN){if(this.currentFocus){this.collapse();g.stopEvent();a=this.items.indexOfKey(this.currentFocus.key);if(a==(this.items.getCount()-1)){this.clearCurrentFocus.defer(10,this);}else{this.clearCurrentFocus();this.currentFocus=this.items.itemAt(a+1);if(this.currentFocus){this.currentFocus.onLnkFocus();}}return true;}}if(g.getKey()===g.RIGHT){this.collapse();d=this.items.itemAt(0);if(this.navigateItemsWithTab){if(d){d.focus();}}else{if(this.currentFocus){a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){this.currentFocus=this.items.itemAt(a+1);if(this.currentFocus){this.currentFocus.onLnkFocus();}}}else{this.currentFocus=d;if(d){d.onLnkFocus();}}}}},onKeyUpBuffered:function(a){if(!a.isNavKeyPress()){this.autoSize();}},reset:function(){this.killItems();Ext.ux.form.SuperBoxSelect.superclass.reset.call(this);this.addedRecords=[];this.autoSize().setRawValue("");},applyEmptyText:function(){this.setRawValue("");if(this.items.getCount()>0){this.el.removeClass(this.emptyClass);this.setRawValue("");return this;}if(this.rendered&&this.emptyText&&this.getRawValue().length<1){this.setRawValue(this.emptyText);this.el.addClass(this.emptyClass);}return this;},removeAllItems:function(){this.items.each(function(a){a.preDestroy(true);},this);this.manageClearBtn();return this;},killItems:function(){this.items.each(function(a){a.kill();},this);this.resetStore();this.items.clear();this.manageClearBtn();return this;},resetStore:function(){this.store.clearFilter();if(!this.removeValuesFromStore){return this;}this.usedRecords.each(function(a){this.store.add(a);},this);this.usedRecords.clear();if(!this.store.remoteSort){this.store.sort(this.displayField,"ASC");}return this;},sortStore:function(){var a=this.store.getSortState();if(a&&a.field){this.store.sort(a.field,a.direction);
}return this;},getCaption:function(a){if(typeof this.displayFieldTpl==="string"){this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl);}var d,b=a instanceof Ext.data.Record?a.data:a;if(this.displayFieldTpl){d=this.displayFieldTpl.apply(b);}else{if(this.displayField){d=b[this.displayField];}}return d;},addRecord:function(e){var a=e.data[this.displayField],f=this.getCaption(e),b=e.data[this.valueField],d=this.classField?e.data[this.classField]:"",g=this.styleField?e.data[this.styleField]:"";if(this.removeValuesFromStore){this.usedRecords.add(b,e);this.store.remove(e);}this.addItemBox(b,a,f,d,g);this.fireEvent("additem",this,b,e);},createRecord:function(a){if(!this.recordConstructor){var b=[{name:this.valueField},{name:this.displayField}];if(this.classField){b.push({name:this.classField});}if(this.styleField){b.push({name:this.styleField});}this.recordConstructor=Ext.data.Record.create(b);}return new this.recordConstructor(a);},addItems:function(a){if(Ext.isArray(a)){Ext.each(a,function(b){this.addItem(b);},this);}else{this.addItem(a);}},addNewItem:function(a){this.addItem(a,true);},addItem:function(e,a){var d=e[this.valueField];if(this.disabled){return false;}if(this.preventDuplicates&&this.hasValue(d)){return;}var f=this.findRecord(this.valueField,d);if(f){this.addRecord(f);return;}else{if(!this.allowAddNewData){return;}}if(this.mode==="remote"){this.remoteLookup.push(e);this.doQuery(d,false,false,a);return;}var b=this.createRecord(e);this.store.add(b);this.addRecord(b);return true;},addItemBox:function(h,l,e,d,j){var a,b=function(q){var o="";switch(typeof q){case"function":o=q.call();break;case"object":for(var m in q){o+=m+":"+q[m]+";";}break;case"string":o=q+";";}return o;},f=Ext.id(null,"sbx-item"),g=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+" "+d,style:b(this.extraItemStyle)+" "+j,caption:e,display:l,value:h,key:f,listeners:{remove:function(m){if(this.fireEvent("beforeremoveitem",this,m.value)===false){return false;}this.items.removeKey(m.key);if(this.removeValuesFromStore){if(this.usedRecords.containsKey(m.value)){this.store.add(this.usedRecords.get(m.value));this.usedRecords.removeKey(m.value);this.sortStore();if(this.view){this.view.render();}}}if(!this.preventMultipleRemoveEvents){this.fireEvent.defer(250,this,["removeitem",this,m.value,this.findInStore(m.value)]);}},destroy:function(){this.collapse();this.autoSize().manageClearBtn().validateValue();},scope:this}});g.render();a={tag:"input",type:"hidden",value:h,name:(this.hiddenName||this.name)};if(this.disabled){Ext.apply(a,{disabled:"disabled"});}g.hidden=this.el.insertSibling(a,"before");this.items.add(f,g);this.applyEmptyText().autoSize().manageClearBtn().validateValue();},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered){return this;}var a="x-superboxselect-btn-hide";if(this.items.getCount()===0){this.buttonClear.addClass(a);}else{this.buttonClear.removeClass(a);}return this;},findInStore:function(b){var a=this.store.find(this.valueField,b);if(a>-1){return this.store.getAt(a);}return false;},getSelectedRecords:function(){var a=[];if(this.removeValuesFromStore){a=this.usedRecords.getRange();}else{var b=[];this.items.each(function(d){b.push(d.value);});Ext.each(b,function(d){a.push(this.findInStore(d));},this);}return a;},findSelectedItem:function(b){var a;this.items.each(function(d){if(d.el.dom===b){a=d;return false;}});return a;},findSelectedRecord:function(d){var b,a=this.findSelectedItem(d);if(a){b=this.findSelectedRecordByValue(a.value);}return b;},findSelectedRecordByValue:function(b){var a;if(this.removeValuesFromStore){this.usedRecords.each(function(d){if(d.get(this.valueField)==b){a=d;return false;}},this);}else{a=this.findInStore(b);}return a;},getValue:function(){var a=[];this.items.each(function(b){a.push(b.value);});return a.join(this.valueDelimiter);},getCount:function(){return this.items.getCount();},getValueEx:function(){var a=[];this.items.each(function(d){var b={};b[this.valueField]=d.value;b[this.displayField]=d.display;if(this.classField){b[this.classField]=d.cls||"";}if(this.styleField){b[this.styleField]=d.style||"";}a.push(b);},this);return a;},initValue:function(){if(Ext.isObject(this.value)||Ext.isArray(this.value)){this.setValueEx(this.value);this.originalValue=this.getValue();}else{Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this);}if(this.mode==="remote"){this.setOriginal=true;}},addValue:function(a){if(Ext.isEmpty(a)){return;}var b=a;if(!Ext.isArray(a)){a=""+a;b=a.split(this.valueDelimiter);}Ext.each(b,function(f){var e=this.findRecord(this.valueField,f);if(e){this.addRecord(e);}else{if(this.mode==="remote"){this.remoteLookup.push(f);}}},this);if(this.mode==="remote"){var d=this.remoteLookup.join(this.queryValuesDelimiter);this.doQuery(d,false,true);}},setValue:function(a){if(!this.rendered){this.value=a;return;}this.removeAllItems().resetStore();this.remoteLookup=[];this.addValue(a);},setValueEx:function(a){if(!this.rendered){this.value=a;return;}this.removeAllItems().resetStore();if(!Ext.isArray(a)){a=[a];}this.remoteLookup=[];if(this.allowAddNewData&&this.mode==="remote"){Ext.each(a,function(e){var b=this.findRecord(this.valueField,e[this.valueField])||this.createRecord(e);this.addRecord(b);},this);return;}Ext.each(a,function(b){this.addItem(b);},this);},hasValue:function(b){var a=false;this.items.each(function(d){if(d.value==b){a=true;return false;}},this);return a;},onSelect:function(b,d){if(this.fireEvent("beforeselect",this,b,d)!==false){var a=b.data[this.valueField];if(this.preventDuplicates&&this.hasValue(a)){return;}this.setRawValue("");this.lastSelectionText="";if(this.fireEvent("beforeadditem",this,a,b,this.filteredQueryData)!==false){this.addRecord(b);}if(this.store.getCount()===0||!this.multiSelectMode){this.collapse();}else{this.restrictHeight();}}},onDestroy:function(){this.items.purgeListeners();this.killItems();if(this.allowQueryAll){Ext.destroy(this.buttonExpand);}if(this.renderFieldBtns){Ext.destroy(this.buttonClear,this.buttonWrap);}Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl);Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this);},autoSize:function(){if(!this.rendered){return this;}if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el);}var a=this.el,f=a.dom.value,b=document.createElement("div");if(f===""&&this.emptyText&&this.items.getCount()<1){f=this.emptyText;}b.appendChild(document.createTextNode(f));f=b.innerHTML;b=null;f+="&#160;";var e=Math.max(this.metrics.getWidth(f)+24,24);if(typeof this._width!="undefined"){e=Math.min(this._width,e);}this.el.setWidth(e);if(Ext.isIE){this.el.dom.style.top="0";}this.fireEvent("autosize",this,e);return this;},shouldQuery:function(b){if(this.lastQuery){var a=b.match("^"+this.lastQuery);if(!a||this.store.getCount()){return true;}else{return(a[0]!==this.lastQuery);}}return true;},doQuery:function(b,a,e,g){b=Ext.isEmpty(b)?"":b;if(this.queryFilterRe){this.filteredQueryData="";var d=b.match(this.queryFilterRe);if(d&&d.length){this.filteredQueryData=d[0];}b=b.replace(this.queryFilterRe,"");if(!b&&d){return;}}var f={query:b,forceAll:a,combo:this,cancel:false};if(this.fireEvent("beforequery",f)===false||f.cancel){return false;}b=f.query;a=f.forceAll;if(a===true||(b.length>=this.minChars)||e&&!Ext.isEmpty(b)){if(g||this.forceSameValueQuery||this.shouldQuery(b)){this.lastQuery=b;if(this.mode=="local"){this.selectedIndex=-1;if(a){this.store.clearFilter();}else{this.store.filter(this.displayField,b);}this.onLoad();}else{this.store.baseParams[this.queryParam]=b;this.store.baseParams[this.queryValuesIndicator]=e;this.store.load({params:this.getParams(b)});if(!g){this.expand();}}}else{this.selectedIndex=-1;this.onLoad();}}},onStoreLoad:function(b,a,d){var g=d.params[this.queryParam]||b.baseParams[this.queryParam]||"",h=d.params[this.queryValuesIndicator]||b.baseParams[this.queryValuesIndicator];if(this.removeValuesFromStore){this.store.each(function(l){if(this.usedRecords.containsKey(l.get(this.valueField))){this.store.remove(l);
}},this);}if(h){var j=g.split(this.queryValuesDelimiter);Ext.each(j,function(l){this.remoteLookup.remove(l);var m=this.findRecord(this.valueField,l);if(m){this.addRecord(m);}},this);if(this.setOriginal){this.setOriginal=false;this.originalValue=this.getValue();}}if(g!==""&&this.allowAddNewData){Ext.each(this.remoteLookup,function(l){if(typeof l==="object"&&l[this.valueField]===g){this.remoteLookup.remove(l);if(a.length&&a[0].get(this.valueField)===g){this.addRecord(a[0]);return;}var m=this.createRecord(l);this.store.add(m);this.addRecord(m);this.addedRecords.push(m);(function(){if(this.isExpanded()){this.collapse();}}).defer(10,this);return;}},this);}var e=[];if(g===""){Ext.each(this.addedRecords,function(l){if(this.preventDuplicates&&this.usedRecords.containsKey(l.get(this.valueField))){return;}e.push(l);},this);}else{var f=new RegExp(Ext.escapeRe(g)+".*","i");Ext.each(this.addedRecords,function(l){if(this.preventDuplicates&&this.usedRecords.containsKey(l.get(this.valueField))){return;}if(f.test(l.get(this.displayField))){e.push(l);}},this);}this.store.add(e);this.sortStore();if(this.store.getCount()===0&&this.isExpanded()){this.collapse();}}});Ext.reg("superboxselect",Ext.ux.form.SuperBoxSelect);Ext.ux.form.SuperBoxSelectItem=function(a){Ext.apply(this,a);Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this);};Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this);},onElClick:function(d){var a=this.owner;a.clearCurrentFocus().collapse();if(a.navigateItemsWithTab){this.focus();}else{a.el.dom.focus();var b=this;(function(){this.onLnkFocus();a.currentFocus=this;}).defer(10,this);}},onLnkClick:function(a){if(a){a.stopEvent();}this.preDestroy();if(!this.owner.navigateItemsWithTab){this.owner.el.focus();}},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus");this.owner.outerWrapEl.addClass("x-form-focus");},onLnkBlur:function(){this.el.removeClass("x-superboxselect-item-focus");this.owner.outerWrapEl.removeClass("x-form-focus");},enableElListeners:function(){this.el.on("click",this.onElClick,this,{stopEvent:true});this.el.addClassOnOver("x-superboxselect-item x-superboxselect-item-hover");},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this});},enableAllListeners:function(){this.enableElListeners();this.enableLnkListeners();},disableAllListeners:function(){this.el.removeAllListeners();this.lnk.un("click",this.onLnkClick,this);this.lnk.un("focus",this.onLnkFocus,this);this.lnk.un("blur",this.onLnkBlur,this);},onRender:function(f,d){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,f,d);var a=this.el;if(a){a.remove();}this.el=a=f.createChild({tag:"li"},f.last());a.addClass("x-superboxselect-item");var g=this.owner.navigateItemsWithTab?(Ext.isSafari?"button":"a"):"span";var b=this.key;Ext.apply(a,{focus:function(){var h=this.down(g+".x-superboxselect-item-close");if(h){h.focus();}},preDestroy:function(){this.preDestroy();}.createDelegate(this)});this.enableElListeners();a.update(this.caption);var e={tag:g,"class":"x-superboxselect-item-close",tabIndex:this.owner.navigateItemsWithTab?"0":"-1"};if(g==="a"){e.href="#";}this.lnk=a.createChild(e);if(!this.disabled){this.enableLnkListeners();}else{this.disableAllListeners();}this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this});this.setupKeyMap();},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus("right");},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus("left");},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var a=this.owner.items.get(0).el.focus();if(a){a.el.focus();}},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus();},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]);this.keyMap.stopEvent=true;},moveFocus:function(a){var b=this.el[a=="left"?"prev":"next"]()||this.owner.el;b.focus.defer(100,b);},preDestroy:function(a){if(this.fireEvent("remove",this)===false){return;}var b=function(){if(this.owner.navigateItemsWithTab){this.moveFocus("right");}this.hidden.remove();this.hidden=null;this.destroy();};if(a){b.call(this);}else{this.el.hide({duration:0.2,callback:b,scope:this});}return this;},kill:function(){this.hidden.remove();this.hidden=null;this.purgeListeners();this.destroy();},onDisable:function(){if(this.hidden){this.hidden.dom.setAttribute("disabled","disabled");}this.keyMap.disable();Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this);},onEnable:function(){if(this.hidden){this.hidden.dom.removeAttribute("disabled");}this.keyMap.enable();Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this);},onDestroy:function(){Ext.destroy(this.lnk,this.el);Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this);}});Proj4js={defaultDatum:"WGS84",transform:function(b,e,d){if(!b.readyToUse||!e.readyToUse){this.reportError("Proj4js initialization for "+b.srsCode+" not yet complete");return d;}if((b.srsProjNumber=="900913"&&e.datumCode!="WGS84")||(e.srsProjNumber=="900913"&&b.datumCode!="WGS84")){var a=Proj4js.WGS84;this.transform(b,a,d);b=a;}if(b.projName=="longlat"){d.x*=Proj4js.common.D2R;d.y*=Proj4js.common.D2R;}else{if(b.to_meter){d.x*=b.to_meter;d.y*=b.to_meter;}b.inverse(d);}if(b.from_greenwich){d.x+=b.from_greenwich;}d=this.datum_transform(b.datum,e.datum,d);if(e.from_greenwich){d.x-=e.from_greenwich;}if(e.projName=="longlat"){d.x*=Proj4js.common.R2D;d.y*=Proj4js.common.R2D;}else{e.forward(d);if(e.to_meter){d.x/=e.to_meter;d.y/=e.to_meter;}}return d;},datum_transform:function(a,d,b){if(a.compare_datums(d)){return b;}if(a.datum_type==Proj4js.common.PJD_NODATUM||d.datum_type==Proj4js.common.PJD_NODATUM){return b;}if(a.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.");}if(d.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.");}if(a.es!=d.es||a.a!=d.a||a.datum_type==Proj4js.common.PJD_3PARAM||a.datum_type==Proj4js.common.PJD_7PARAM||d.datum_type==Proj4js.common.PJD_3PARAM||d.datum_type==Proj4js.common.PJD_7PARAM){a.geodetic_to_geocentric(b);if(a.datum_type==Proj4js.common.PJD_3PARAM||a.datum_type==Proj4js.common.PJD_7PARAM){a.geocentric_to_wgs84(b);}if(d.datum_type==Proj4js.common.PJD_3PARAM||d.datum_type==Proj4js.common.PJD_7PARAM){d.geocentric_from_wgs84(b);}d.geocentric_to_geodetic(b);}if(d.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.");}return b;},reportError:function(a){},extend:function(d,b){d=d||{};if(b){for(var a in b){var e=b[a];if(e!==undefined){d[a]=e;}}}return d;},Class:function(){var e=function(){this.initialize.apply(this,arguments);};var d={};var b;for(var a=0;a<arguments.length;++a){if(typeof arguments[a]=="function"){b=arguments[a].prototype;}else{b=arguments[a];}Proj4js.extend(d,b);}e.prototype=d;return e;},bind:function(a,d){var b=Array.prototype.slice.apply(arguments,[2]);return function(){var e=b.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(d,e);};},scriptName:"proj4js.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath){return this.libPath;}var a=this.scriptName;var g=a.length;var d=document.getElementsByTagName("script");for(var f=0;f<d.length;f++){var b=d[f].getAttribute("src");if(b){var e=b.lastIndexOf(a);if((e>-1)&&(e+g==b.length)){this.libPath=b.slice(0,-g);break;}}}return this.libPath||"";},loadScript:function(b,d,a,e){var f=document.createElement("script");f.defer=false;f.type="text/javascript";f.id=b;f.src=b;f.onload=d;f.onerror=a;f.loadCheck=e;if(/MSIE/.test(navigator.userAgent)){f.onreadystatechange=this.checkReadyState;
}document.getElementsByTagName("head")[0].appendChild(f);},checkReadyState:function(){if(this.readyState=="loaded"){if(!this.loadCheck()){this.onerror();}else{this.onload();}}}};Proj4js.Proj=Proj4js.Class({readyToUse:false,title:null,projName:null,units:null,datum:null,initialize:function(a){this.srsCodeInput=a;if(a.indexOf("urn:")==0){var b=a.split(":");if((b[1]=="ogc"||b[1]=="x-ogc")&&(b[2]=="def")&&(b[3]=="crs")&&b.length==7){a=b[4]+":"+b[6];}}else{if(a.indexOf("http://")==0){var d=a.split("#");if(d[0].match(/epsg.org/)){a="EPSG:"+d[1];}else{if(d[0].match(/RIG.xml/)){a="IGNF:"+d[1];}}}}this.srsCode=a.toUpperCase();if(this.srsCode.indexOf("EPSG")==0){this.srsCode=this.srsCode;this.srsAuth="epsg";this.srsProjNumber=this.srsCode.substring(5);}else{if(this.srsCode.indexOf("IGNF")==0){this.srsCode=this.srsCode;this.srsAuth="IGNF";this.srsProjNumber=this.srsCode.substring(5);}else{if(this.srsCode.indexOf("CRS")==0){this.srsCode=this.srsCode;this.srsAuth="CRS";this.srsProjNumber=this.srsCode.substring(4);}else{this.srsAuth="";this.srsProjNumber=this.srsCode;}}}this.loadProjDefinition();},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode]){this.defsLoaded();return;}var a=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(a,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this));},loadFromService:function(){var a=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js";Proj4js.loadScript(a,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this));},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName);},checkDefsLoaded:function(){if(Proj4js.defs[this.srsCode]){return true;}else{return false;}},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);Proj4js.extend(Proj4js.defs[this.srsCode],Proj4js.defs.WGS84);this.defsLoaded();},loadProjCode:function(b){if(Proj4js.Proj[b]){this.initTransforms();return;}var a=Proj4js.getScriptLocation()+"projCode/"+b+".js";Proj4js.loadScript(a,Proj4js.bind(this.loadProjCodeSuccess,this,b),Proj4js.bind(this.loadProjCodeFailure,this,b),Proj4js.bind(this.checkCodeLoaded,this,b));},loadProjCodeSuccess:function(a){if(Proj4js.Proj[a].dependsOn){this.loadProjCode(Proj4js.Proj[a].dependsOn);}else{this.initTransforms();}},loadProjCodeFailure:function(a){Proj4js.reportError("failed to find projection file for: "+a);},checkCodeLoaded:function(a){if(Proj4js.Proj[a]){return true;}else{return false;}},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=true;},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var b,f;var e=this.defData.split("+");for(var d=0;d<e.length;d++){var a=e[d].split("=");b=a[0].toLowerCase();f=a[1];switch(b.replace(/\s/gi,"")){case"":break;case"title":this.title=f;break;case"proj":this.projName=f.replace(/\s/gi,"");break;case"units":this.units=f.replace(/\s/gi,"");break;case"datum":this.datumCode=f.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=f.replace(/\s/gi,"");break;case"ellps":this.ellps=f.replace(/\s/gi,"");break;case"a":this.a=parseFloat(f);break;case"b":this.b=parseFloat(f);break;case"rf":this.rf=parseFloat(f);break;case"lat_0":this.lat0=f*Proj4js.common.D2R;break;case"lat_1":this.lat1=f*Proj4js.common.D2R;break;case"lat_2":this.lat2=f*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=f*Proj4js.common.D2R;break;case"lon_0":this.long0=f*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(f)*Proj4js.common.D2R;break;case"lonc":this.longc=f*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(f);break;case"y_0":this.y0=parseFloat(f);break;case"k_0":this.k0=parseFloat(f);break;case"k":this.k0=parseFloat(f);break;case"R_A":this.R=true;break;case"zone":this.zone=parseInt(f);break;case"south":this.utmSouth=true;break;case"towgs84":this.datum_params=f.split(",");break;case"to_meter":this.to_meter=parseFloat(f);break;case"from_greenwich":this.from_greenwich=f*Proj4js.common.D2R;break;case"pm":f=f.replace(/\s/gi,"");this.from_greenwich=Proj4js.PrimeMeridian[f]?Proj4js.PrimeMeridian[f]:parseFloat(f);this.from_greenwich*=Proj4js.common.D2R;break;case"no_defs":break;default:}}this.deriveConstants();},deriveConstants:function(){if(this.nagrids=="@null"){this.datumCode="none";}if(this.datumCode&&this.datumCode!="none"){var a=Proj4js.Datum[this.datumCode];if(a){this.datum_params=a.towgs84.split(",");this.ellps=a.ellipse;this.datumName=a.datumName?a.datumName:this.datumCode;}}if(!this.a){var b=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,b);}if(this.rf&&!this.b){this.b=(1-1/this.rf)*this.a;}if(Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=true;this.b=this.a;}this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);if(this.R_A){this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.RA4+this.es*Proj4js.RA6));this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=0;}this.ep2=(this.a2-this.b2)/this.b2;if(!this.k0){this.k0=1;}this.datum=new Proj4js.datum(this);}});Proj4js.Proj.longlat={init:function(){},forward:function(a){return a;},inverse:function(a){return a;}};Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:900913":"+title= Google Mercator EPSG:900913 +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:900913"];Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:0.7853981633974483,R2D:57.29577951308232,D2R:0.017453292519943295,SEC_TO_RAD:0.00000484813681109536,EPSLN:1e-10,MAX_ITER:20,COS_67P5:0.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:0.16666666666666666,RA4:0.04722222222222222,RA6:0.022156084656084655,RV4:0.06944444444444445,RV6:0.04243827160493827,msfnz:function(a,e,b){var d=a*e;return b/(Math.sqrt(1-d*d));},tsfnz:function(d,b,a){var e=d*a;var f=0.5*d;e=Math.pow(((1-e)/(1+e)),f);return(Math.tan(0.5*(this.HALF_PI-b))/e);},phi2z:function(b,a){var g=0.5*b;var d,e;var f=this.HALF_PI-2*Math.atan(a);for(i=0;i<=15;i++){d=b*Math.sin(f);e=this.HALF_PI-2*Math.atan(a*(Math.pow(((1-d)/(1+d)),g)))-f;f+=e;if(Math.abs(e)<=1e-10){return f;}}alert("phi2z has NoConvergence");return(-9999);},qsfnz:function(a,e,b){var d;if(a>1e-7){d=a*e;return((1-a*a)*(e/(1-d*d)-(0.5/a)*Math.log((1-d)/(1+d))));}else{return(2*e);}},asinz:function(a){if(Math.abs(a)>1){a=(a>1)?1:-1;}return Math.asin(a);},e0fn:function(a){return(1-0.25*a*(1+a/16*(3+1.25*a)));},e1fn:function(a){return(0.375*a*(1+0.25*a*(1+0.46875*a)));},e2fn:function(a){return(0.05859375*a*a*(1+0.75*a));},e3fn:function(a){return(a*a*a*(35/3072));},mlfn:function(d,b,a,f,e){return(d*e-b*Math.sin(2*e)+a*Math.sin(4*e)-f*Math.sin(6*e));},srat:function(a,b){return(Math.pow((1-a)/(1+a),b));},sign:function(a){if(a<0){return(-1);}else{return(1);}},adjust_lon:function(a){a=(Math.abs(a)<this.PI)?a:(a-(this.sign(a)*this.TWO_PI));return a;},adjust_lat:function(a){a=(Math.abs(a)<this.HALF_PI)?a:(a-(this.sign(a)*this.PI));return a;},latiso:function(b,a,e){if(Math.abs(a)>this.HALF_PI){return +Number.NaN;}if(a==this.HALF_PI){return Number.POSITIVE_INFINITY;}if(a==-1*this.HALF_PI){return -1*Number.POSITIVE_INFINITY;}var d=b*e;return Math.log(Math.tan((this.HALF_PI+a)/2))+b*Math.log((1-d)/(1+d))/2;},fL:function(b,a){return 2*Math.atan(b*Math.exp(a))-this.HALF_PI;},invlatiso:function(d,a){var f=this.fL(1,a);var b=0;var e=0;
do{b=f;e=d*Math.sin(b);f=this.fL(Math.exp(d*Math.log((1+e)/(1-e))/2),a);}while(Math.abs(f-b)>1e-12);return f;},sinh:function(a){var b=Math.exp(a);b=(b-1/b)/2;return b;},cosh:function(a){var b=Math.exp(a);b=(b+1/b)/2;return b;},tanh:function(a){var b=Math.exp(a);b=(b-1/b)/(b+1/b);return b;},asinh:function(a){var b=(a>=0?1:-1);return b*(Math.log(Math.abs(a)+Math.sqrt(a*a+1)));},acosh:function(a){return 2*Math.log(Math.sqrt((a+1)/2)+Math.sqrt((a-1)/2));},atanh:function(a){return Math.log((a-1)/(a+1))/2;},gN:function(b,g,f){var d=g*f;return b/Math.sqrt(1-d*d);}};Proj4js.datum=Proj4js.Class({initialize:function(b){this.datum_type=Proj4js.common.PJD_WGS84;if(b.datumCode&&b.datumCode=="none"){this.datum_type=Proj4js.common.PJD_NODATUM;}if(b&&b.datum_params){for(var a=0;a<b.datum_params.length;a++){b.datum_params[a]=parseFloat(b.datum_params[a]);}if(b.datum_params[0]!=0||b.datum_params[1]!=0||b.datum_params[2]!=0){this.datum_type=Proj4js.common.PJD_3PARAM;}if(b.datum_params.length>3){if(b.datum_params[3]!=0||b.datum_params[4]!=0||b.datum_params[5]!=0||b.datum_params[6]!=0){this.datum_type=Proj4js.common.PJD_7PARAM;b.datum_params[3]*=Proj4js.common.SEC_TO_RAD;b.datum_params[4]*=Proj4js.common.SEC_TO_RAD;b.datum_params[5]*=Proj4js.common.SEC_TO_RAD;b.datum_params[6]=(b.datum_params[6]/1000000)+1;}}}if(b){this.a=b.a;this.b=b.b;this.es=b.es;this.ep2=b.ep2;this.datum_params=b.datum_params;}},compare_datums:function(a){if(this.datum_type!=a.datum_type){return false;}else{if(this.a!=a.a||Math.abs(this.es-a.es)>5e-11){return false;}else{if(this.datum_type==Proj4js.common.PJD_3PARAM){return(this.datum_params[0]==a.datum_params[0]&&this.datum_params[1]==a.datum_params[1]&&this.datum_params[2]==a.datum_params[2]);}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){return(this.datum_params[0]==a.datum_params[0]&&this.datum_params[1]==a.datum_params[1]&&this.datum_params[2]==a.datum_params[2]&&this.datum_params[3]==a.datum_params[3]&&this.datum_params[4]==a.datum_params[4]&&this.datum_params[5]==a.datum_params[5]&&this.datum_params[6]==a.datum_params[6]);}else{if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT){return strcmp(pj_param(this.params,"snadgrids").s,pj_param(a.params,"snadgrids").s)==0;}else{return true;}}}}}},geodetic_to_geocentric:function(a){var b=a.x;var h=a.y;var d=a.z?a.z:0;var e;var q;var l;var m=0;var o;var j;var g;var f;if(h<-Proj4js.common.HALF_PI&&h>-1.001*Proj4js.common.HALF_PI){h=-Proj4js.common.HALF_PI;}else{if(h>Proj4js.common.HALF_PI&&h<1.001*Proj4js.common.HALF_PI){h=Proj4js.common.HALF_PI;}else{if((h<-Proj4js.common.HALF_PI)||(h>Proj4js.common.HALF_PI)){Proj4js.reportError("geocent:lat out of range:"+h);return null;}}}if(b>Proj4js.common.PI){b-=(2*Proj4js.common.PI);}j=Math.sin(h);f=Math.cos(h);g=j*j;o=this.a/(Math.sqrt(1-this.es*g));e=(o+d)*f*Math.cos(b);q=(o+d)*f*Math.sin(b);l=((o*(1-this.es))+d)*j;a.x=e;a.y=q;a.z=l;return m;},geocentric_to_geodetic:function(w){var t=1e-12;var h=(t*t);var F=30;var g;var b;var z;var o;var B;var j;var f;var q;var m;var e;var u;var s;var E;var l;var a=w.x;var D=w.y;var C=w.z?w.z:0;var d;var v;var r;E=false;g=Math.sqrt(a*a+D*D);b=Math.sqrt(a*a+D*D+C*C);if(g/this.a<t){E=true;d=0;if(b/this.a<t){v=Proj4js.common.HALF_PI;r=-this.b;return;}}else{d=Math.atan2(D,a);}z=C/b;o=g/b;B=1/Math.sqrt(1-this.es*(2-this.es)*o*o);q=o*(1-this.es)*B;m=z*B;l=0;do{l++;f=this.a/Math.sqrt(1-this.es*m*m);r=g*q+C*m-f*(1-this.es*m*m);j=this.es*f/(f+r);B=1/Math.sqrt(1-j*(2-j)*o*o);e=o*(1-j)*B;u=z*B;s=u*q-e*m;q=e;m=u;}while(s*s>h&&l<F);v=Math.atan(u/Math.abs(e));w.x=d;w.y=v;w.z=r;return w;},geocentric_to_geodetic_noniter:function(B){var e=B.x;var d=B.y;var a=B.z?B.z:0;var h;var z;var q;var f;var u;var w;var s;var m;var j;var l;var t;var g;var r;var C;var v;var o;var b;e=parseFloat(e);d=parseFloat(d);a=parseFloat(a);b=false;if(e!=0){h=Math.atan2(d,e);}else{if(d>0){h=Proj4js.common.HALF_PI;}else{if(d<0){h=-Proj4js.common.HALF_PI;}else{b=true;h=0;if(a>0){z=Proj4js.common.HALF_PI;}else{if(a<0){z=-Proj4js.common.HALF_PI;}else{z=Proj4js.common.HALF_PI;q=-this.b;return;}}}}}u=e*e+d*d;f=Math.sqrt(u);w=a*Proj4js.common.AD_C;m=Math.sqrt(w*w+u);l=w/m;g=f/m;t=l*l*l;s=a+this.b*this.ep2*t;o=f-this.a*this.es*g*g*g;j=Math.sqrt(s*s+o*o);r=s/j;C=o/j;v=this.a/Math.sqrt(1-this.es*r*r);if(C>=Proj4js.common.COS_67P5){q=f/C-v;}else{if(C<=-Proj4js.common.COS_67P5){q=f/-C-v;}else{q=a/r+v*(this.es-1);}}if(b==false){z=Math.atan(r/C);}B.x=h;B.y=z;B.z=q;return B;},geocentric_to_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM){e.x+=this.datum_params[0];e.y+=this.datum_params[1];e.z+=this.datum_params[2];}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var j=this.datum_params[0];var g=this.datum_params[1];var o=this.datum_params[2];var h=this.datum_params[3];var b=this.datum_params[4];var m=this.datum_params[5];var l=this.datum_params[6];var f=l*(e.x-m*e.y+b*e.z)+j;var a=l*(m*e.x+e.y-h*e.z)+g;var d=l*(-b*e.x+h*e.y+e.z)+o;e.x=f;e.y=a;e.z=d;}}},geocentric_from_wgs84:function(f){if(this.datum_type==Proj4js.common.PJD_3PARAM){f.x-=this.datum_params[0];f.y-=this.datum_params[1];f.z-=this.datum_params[2];}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var l=this.datum_params[0];var g=this.datum_params[1];var b=this.datum_params[2];var j=this.datum_params[3];var e=this.datum_params[4];var o=this.datum_params[5];var m=this.datum_params[6];var h=(f.x-l)/m;var d=(f.y-g)/m;var a=(f.z-b)/m;f.x=h+o*d-e*a;f.y=-o*h+d+j*a;f.z=e*h-j*d+a;}}}});Proj4js.Point=Proj4js.Class({initialize:function(d,b,a){if(typeof d=="object"){this.x=d[0];this.y=d[1];this.z=d[2]||0;}else{if(typeof d=="string"){var e=d.split(",");this.x=parseFloat(e[0]);this.y=parseFloat(e[1]);this.z=parseFloat(e[2])||0;}else{this.x=d;this.y=b;this.z=a||0;}}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z);},toString:function(){return("x="+this.x+",y="+this.y);},toShortString:function(){return(this.x+", "+this.y);}});Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};
Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};Proj4js.WGS84=new Proj4js.Proj("WGS84");Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("aeaInitEqualLatitudes");return;}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e3=Math.sqrt(this.es);this.sin_po=Math.sin(this.lat1);this.cos_po=Math.cos(this.lat1);this.t1=this.sin_po;this.con=this.sin_po;this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat2);this.cos_po=Math.cos(this.lat2);this.t2=this.sin_po;this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat0);this.cos_po=Math.cos(this.lat0);this.t3=this.sin_po;this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1);}else{this.ns0=this.con;}this.c=this.ms1*this.ms1+this.ns0*this.qs1;this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0;},forward:function(f){var g=f.x;var e=f.y;this.sin_phi=Math.sin(e);this.cos_phi=Math.cos(e);var b=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi);var j=this.a*Math.sqrt(this.c-this.ns0*b)/this.ns0;var d=this.ns0*Proj4js.common.adjust_lon(g-this.long0);var a=j*Math.sin(d)+this.x0;var h=this.rh-j*Math.cos(d)+this.y0;f.x=a;f.y=h;return f;},inverse:function(g){var a,b,d,e,h,f;g.x-=this.x0;g.y=this.rh-g.y+this.y0;if(this.ns0>=0){a=Math.sqrt(g.x*g.x+g.y*g.y);d=1;}else{a=-Math.sqrt(g.x*g.x+g.y*g.y);d=-1;}e=0;if(a!=0){e=Math.atan2(d*g.x,d*g.y);}d=a*this.ns0/this.a;b=(this.c-d*d)/this.ns0;if(this.e3>=1e-10){d=1-0.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3;if(Math.abs(Math.abs(d)-Math.abs(b))>1e-10){f=this.phi1z(this.e3,b);}else{if(b>=0){f=0.5*PI;}else{f=-0.5*PI;}}}else{f=this.phi1z(e3,b);}h=Proj4js.common.adjust_lon(e/this.ns0+this.long0);g.x=h;g.y=f;return g;},phi1z:function(j,a){var b,d,e;var h=Proj4js.common.asinz(0.5*a);if(j<Proj4js.common.EPSLN){return h;}var g=j*j;for(var f=1;f<=25;f++){sinphi=Math.sin(h);cosphi=Math.cos(h);b=j*sinphi;d=1-b*b;e=0.5*d*d/cosphi*(a/(1-g)-sinphi/d+0.5/j*Math.log((1-b)/(1+b)));h=h+e;if(Math.abs(e)<=1e-7){return h;}}Proj4js.reportError("aea:phi1z:Convergence error");return null;}};Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);if(!this.rc){Proj4js.reportError("sterea:init:E_ERROR_0");return;}this.sinc0=Math.sin(this.phic0);this.cosc0=Math.cos(this.phic0);this.R2=2*this.rc;if(!this.title){this.title="Oblique Stereographic Alternative";}},forward:function(a){a.x=Proj4js.common.adjust_lon(a.x-this.long0);Proj4js.Proj.gauss.forward.apply(this,[a]);sinc=Math.sin(a.y);cosc=Math.cos(a.y);cosl=Math.cos(a.x);k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl);a.x=k*cosc*Math.sin(a.x);a.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl);a.x=this.a*a.x+this.x0;a.y=this.a*a.y+this.y0;return a;},inverse:function(d){var a,b;d.x=(d.x-this.x0)/this.a;d.y=(d.y-this.y0)/this.a;d.x/=this.k0;d.y/=this.k0;if((rho=Math.sqrt(d.x*d.x+d.y*d.y))){c=2*Math.atan2(rho,this.R2);sinc=Math.sin(c);cosc=Math.cos(c);b=Math.asin(cosc*this.sinc0+d.y*sinc*this.cosc0/rho);a=Math.atan2(d.x*sinc,rho*this.cosc0*cosc-d.y*this.sinc0*sinc);}else{b=this.phic0;a=0;}d.x=a;d.y=b;Proj4js.Proj.gauss.inverse.apply(this,[d]);d.x=Proj4js.common.adjust_lon(d.x+this.long0);return d;}};Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);},forward:function(q){var l=q.x;var w=q.y;var u=Proj4js.common.adjust_lon(l-this.long0);var r;var j,g;var h=Math.sin(w);var d=Math.cos(w);if(this.sphere){var f=d*Math.sin(u);if((Math.abs(Math.abs(f)-1))<1e-10){Proj4js.reportError("tmerc:forward: Point projects into infinity");return(93);}else{j=0.5*this.a*this.k0*Math.log((1+f)/(1-f));r=Math.acos(d*Math.cos(u)/Math.sqrt(1-f*f));if(w<0){r=-r;}g=this.a*this.k0*(r-this.lat0);}}else{var a=d*u;var z=Math.pow(a,2);var e=this.ep2*Math.pow(d,2);var o=Math.tan(w);var m=Math.pow(o,2);r=1-this.es*Math.pow(h,2);var s=this.a/Math.sqrt(r);var v=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,w);j=this.k0*s*a*(1+z/6*(1-m+e+z/20*(5-18*m+Math.pow(m,2)+72*e-58*this.ep2)))+this.x0;g=this.k0*(v-this.ml0+s*o*(z*(0.5+z/24*(5-m+9*e+4*Math.pow(e,2)+z/30*(61-58*m+Math.pow(m,2)+600*e-330*this.ep2)))))+this.y0;}q.x=j;q.y=g;return q;},inverse:function(b){var J,G;var F;var l;var M=6;var L,H;if(this.sphere){var u=Math.exp(b.x/(this.a*this.k0));var s=0.5*(u-1/u);var z=this.lat0+b.y/(this.a*this.k0);var o=Math.cos(z);J=Math.sqrt((1-o*o)/(1+s*s));L=Math.asinz(J);if(z<0){L=-L;}if((s==0)&&(o==0)){H=this.long0;}else{H=Proj4js.common.adjust_lon(Math.atan2(s,o)+this.long0);}}else{var m=b.x-this.x0;var e=b.y-this.y0;J=(this.ml0+e/this.k0)/this.a;G=J;for(l=0;;l++){F=((J+this.e1*Math.sin(2*G)-this.e2*Math.sin(4*G)+this.e3*Math.sin(6*G))/this.e0)-G;G+=F;if(Math.abs(F)<=Proj4js.common.EPSLN){break;}if(l>=M){Proj4js.reportError("tmerc:inverse: Latitude failed to converge");return(95);}}if(Math.abs(G)<Proj4js.common.HALF_PI){var E=Math.sin(G);var I=Math.cos(G);var q=Math.tan(G);var B=this.ep2*Math.pow(I,2);var K=Math.pow(B,2);var v=Math.pow(q,2);var D=Math.pow(v,2);J=1-this.es*Math.pow(E,2);var j=this.a/Math.sqrt(J);var C=j*(1-this.es)/J;var w=m/(j*this.k0);var a=Math.pow(w,2);L=G-(j*q*a/C)*(0.5-a/24*(5+3*v+10*B-4*K-9*this.ep2-a/30*(61+90*v+298*B+45*D-252*this.ep2-3*K)));H=Proj4js.common.adjust_lon(this.long0+(w*(1-a/6*(1+2*v+B-a/20*(5-2*B+28*v-3*K+8*this.ep2+24*D)))/I));}else{L=Proj4js.common.HALF_PI*Proj4js.common.sign(e);H=this.long0;}}b.x=H;b.y=L;return b;}};Proj4js.Proj.equi={init:function(){if(!this.x0){this.x0=0;}if(!this.y0){this.y0=0;}if(!this.lat0){this.lat0=0;}if(!this.long0){this.long0=0;}},forward:function(g){var a=g.x;var f=g.y;var e=Proj4js.common.adjust_lon(a-this.long0);var d=this.x0+this.a*e*Math.cos(this.lat0);var b=this.y0+this.a*f;this.t1=d;this.t2=Math.cos(this.lat0);g.x=d;g.y=b;return g;},inverse:function(d){d.x-=this.x0;d.y-=this.y0;var b=d.y/this.a;if(Math.abs(b)>Proj4js.common.HALF_PI){Proj4js.reportError("equi:Inv:DataError");}var a=Proj4js.common.adjust_lon(this.long0+d.x/(this.a*Math.cos(this.lat0)));d.x=a;d.y=b;}};Proj4js.Proj.merc={init:function(){if(this.lat_ts){if(this.sphere){this.k0=Math.cos(this.lat_ts);}else{this.k0=Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts));}}},forward:function(g){var h=g.x;var f=g.y;if(f*Proj4js.common.R2D>90&&f*Proj4js.common.R2D<-90&&h*Proj4js.common.R2D>180&&h*Proj4js.common.R2D<-180){Proj4js.reportError("merc:forward: llInputOutOfRange: "+h+" : "+f);return null;}var b,a;if(Math.abs(Math.abs(f)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("merc:forward: ll2mAtPoles");
return null;}else{if(this.sphere){b=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(h-this.long0);a=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+0.5*f));}else{var e=Math.sin(f);var d=Proj4js.common.tsfnz(this.e,f,e);b=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(h-this.long0);a=this.y0-this.a*this.k0*Math.log(d);}g.x=b;g.y=a;return g;}},inverse:function(g){var d=g.x-this.x0;var b=g.y-this.y0;var a,f;if(this.sphere){f=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-b/this.a*this.k0));}else{var e=Math.exp(-b/(this.a*this.k0));f=Proj4js.common.phi2z(this.e,e);if(f==-9999){Proj4js.reportError("merc:inverse: lat = -9999");return null;}}a=Proj4js.common.adjust_lon(this.long0+d/(this.a*this.k0));g.x=a;g.y=f;return g;}};Proj4js.Proj.sinu={init:function(){this.R=6370997;},forward:function(g){var d,b,e;var a=g.x;var f=g.y;e=Proj4js.common.adjust_lon(a-this.long0);d=this.R*e*Math.cos(f)+this.x0;b=this.R*f+this.y0;g.x=d;g.y=b;return g;},inverse:function(a){var e,d,b;a.x-=this.x0;a.y-=this.y0;e=a.y/this.R;if(Math.abs(e)>Proj4js.common.HALF_PI){Proj4js.reportError("sinu:Inv:DataError");}d=Math.abs(e)-Proj4js.common.HALF_PI;if(Math.abs(d)>Proj4js.common.EPSLN){d=this.long0+a.x/(this.R*Math.cos(e));b=Proj4js.common.adjust_lon(d);}else{b=this.long0;}a.x=b;a.y=e;return a;}};Proj4js.Proj.eqdc={init:function(){if(!this.mode){this.mode=0;}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.sinphi=Math.sin(this.lat1);this.cosphi=Math.cos(this.lat1);this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);if(this.mode!=0){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("eqdc:Init:EqualLatitudes");}this.sinphi=Math.sin(this.lat2);this.cosphi=Math.cos(this.lat2);this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);if(Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN){this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1);}else{this.ns=this.sinphi;}}else{this.ns=this.sinphi;}this.g=this.ml1+this.ms1/this.ns;this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);this.rh=this.a*(this.g-this.ml0);},forward:function(e){var f=e.x;var d=e.y;var j=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,d);var h=this.a*(this.g-j);var b=this.ns*Proj4js.common.adjust_lon(f-this.long0);var a=this.x0+h*Math.sin(b);var g=this.y0+this.rh-h*Math.cos(b);e.x=a;e.y=g;return e;},inverse:function(f){f.x-=this.x0;f.y=this.rh-f.y+this.y0;var b,a;if(this.ns>=0){var a=Math.sqrt(f.x*f.x+f.y*f.y);var b=1;}else{a=-Math.sqrt(f.x*f.x+f.y*f.y);b=-1;}var d=0;if(a!=0){d=Math.atan2(b*f.x,b*f.y);}var h=this.g-a/this.a;var e=this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3);var g=Proj4js.common.adjust_lon(this.long0+d/this.ns);f.x=g;f.y=e;return f;},phi3z:function(j,h,g,f,e){var d;var a;d=j;for(var b=0;b<15;b++){a=(j+g*Math.sin(2*d)-f*Math.sin(4*d)+e*Math.sin(6*d))/h-d;d+=a;if(Math.abs(a)<=1e-10){return d;}}Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null;}};function phi4z(e,l,j,h,g,t,r,C,f){var m,B,w,z,u,s,q,o,d,v;f=t;for(v=1;v<=15;v++){m=Math.sin(f);tanphi=Math.tan(f);C=tanphi*Math.sqrt(1-e*m*m);B=Math.sin(2*f);z=l*f-j*B+h*Math.sin(4*f)-g*Math.sin(6*f);u=l-2*j*Math.cos(2*f)+4*h*Math.cos(4*f)-6*g*Math.cos(6*f);s=2*z+C*(z*z+r)-2*t*(C*z+1);q=e*B*(z*z+r-2*t*z)/(2*C);o=2*(t-z)*(C*u-2/B)-2*u;d=s/(q+o);f+=d;if(Math.abs(d)<=1e-10){return(f);}}Proj4js.reportError("phi4z: No convergence");return null;}function e4fn(b){var d,a;d=1+b;a=1-b;return(Math.sqrt((Math.pow(d,d))*(Math.pow(a,a))));}Proj4js.Proj.poly={init:function(){var a;if(this.lat0=0){this.lat0=90;}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);},forward:function(d){var l,f;var h;var m;var e,g;var b;var a,q;var o=d.x;var j=d.y;e=Proj4js.common.adjust_lon(o-this.long0);if(Math.abs(j)<=1e-7){a=this.x0+this.a*e;q=this.y0-this.a*this.ml0;}else{l=Math.sin(j);f=Math.cos(j);g=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,j);b=Proj4js.common.msfnz(this.e,l,f);e=l;a=this.x0+this.a*b*Math.sin(e)/l;q=this.y0+this.a*(g-this.ml0+b*(1-Math.cos(e))/l);}d.x=a;d.y=q;return d;},inverse:function(e){var d,l;var j;var h;var o;var f,g;var q;var a,m;e.x-=this.x0;e.y-=this.y0;j=this.ml0+e.y/this.a;q=0;if(Math.abs(j)<=1e-7){a=e.x/this.a+this.long0;m=0;}else{h=j*j+(e.x/this.a)*(e.x/this.a);q=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,h,o,m);if(q!=1){return(q);}a=Proj4js.common.adjust_lon((asinz(e.x*o/this.a)/Math.sin(m))+this.long0);}e.x=a;e.y=m;return e;}};Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE;Proj4js.Proj.gstmerc={init:function(){var d=this.b/this.a;this.e=Math.sqrt(1-d*d);this.lc=this.long0;this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var a=Math.sin(this.lat0);var e=Math.asin(a/this.rs);var b=Math.sin(e);this.cp=Proj4js.common.latiso(0,e,b)-this.rs*Proj4js.common.latiso(this.e,this.lat0,a);this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*a*a);this.xs=this.x0;this.ys=this.y0-this.n2*e;if(!this.title){this.title="Gauss Schreiber transverse mercator";}},forward:function(g){var a=g.x;var f=g.y;var b=this.rs*(a-this.lc);var d=this.cp+(this.rs*Proj4js.common.latiso(this.e,f,Math.sin(f)));var h=Math.asin(Math.sin(b)/Proj4js.common.cosh(d));var e=Proj4js.common.latiso(0,h,Math.sin(h));g.x=this.xs+(this.n2*e);g.y=this.ys+(this.n2*Math.atan(Proj4js.common.sinh(d)/Math.cos(b)));return g;},inverse:function(g){var e=g.x;var b=g.y;var d=Math.atan(Proj4js.common.sinh((e-this.xs)/this.n2)/Math.cos((b-this.ys)/this.n2));var a=Math.asin(Math.sin((b-this.ys)/this.n2)/Proj4js.common.cosh((e-this.xs)/this.n2));var f=Proj4js.common.latiso(0,a,Math.sin(a));g.x=this.lc+d/this.rs;g.y=Proj4js.common.invlatiso(this.e,(f-this.cp)/this.rs);return g;}};Proj4js.Proj.ortho={init:function(a){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);},forward:function(e){var a,h;var f;var b;var j;var l;var d=e.x;var m=e.y;f=Proj4js.common.adjust_lon(d-this.long0);a=Math.sin(m);h=Math.cos(m);b=Math.cos(f);l=this.sin_p14*a+this.cos_p14*h*b;j=1;if((l>0)||(Math.abs(l)<=Proj4js.common.EPSLN)){var q=this.a*j*h*Math.sin(f);var o=this.y0+this.a*j*(this.cos_p14*a-this.sin_p14*h*b);}else{Proj4js.reportError("orthoFwdPointError");}e.x=q;e.y=o;return e;},inverse:function(g){var b;var a;var j,e;var d;var h;var f,l;g.x-=this.x0;g.y-=this.y0;b=Math.sqrt(g.x*g.x+g.y*g.y);if(b>this.a+1e-7){Proj4js.reportError("orthoInvDataError");}a=Proj4js.common.asinz(b/this.a);j=Math.sin(a);cosi=Math.cos(a);f=this.long0;if(Math.abs(b)<=Proj4js.common.EPSLN){l=this.lat0;}l=Proj4js.common.asinz(e*this.sin_p14+(y*j*this.cos_p14)/b);h=Math.abs(lat0)-Proj4js.common.HALF_PI;if(Math.abs(h)<=Proj4js.common.EPSLN){if(this.lat0>=0){f=Proj4js.common.adjust_lon(this.long0+Math.atan2(g.x,-g.y));}else{f=Proj4js.common.adjust_lon(this.long0-Math.atan2(-g.x,g.y));}}h=e-this.sin_p14*Math.sin(l);if((Math.abs(h)>=Proj4js.common.EPSLN)||(Math.abs(x)>=Proj4js.common.EPSLN)){f=Proj4js.common.adjust_lon(this.long0+Math.atan2((g.x*j*this.cos_p14),(h*b)));}g.x=f;g.y=l;return g;}};Proj4js.Proj.somerc={init:function(){var h=this.lat0;this.lambda0=this.long0;var b=Math.sin(h);var f=this.a;var d=this.rf;var g=1/d;var a=2*g-Math.pow(g,2);var j=this.e=Math.sqrt(a);this.R=f*Math.sqrt(1-a)/(1-a*Math.pow(b,2));this.alpha=Math.sqrt(1+a/(1-a)*Math.pow(Math.cos(h),4));this.b0=Math.asin(b/this.alpha);
this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+h/2))+this.alpha*j/2*Math.log((1+j*b)/(1-j*b));},forward:function(h){var d=Math.log(Math.tan(Math.PI/4-h.y/2));var j=this.e/2*Math.log((1+this.e*Math.sin(h.y))/(1-this.e*Math.sin(h.y)));var f=-this.alpha*(d+j)+this.K;var a=2*(Math.atan(Math.exp(f))-Math.PI/4);var e=this.alpha*(h.x-this.lambda0);var l=Math.atan(Math.sin(e)/(Math.sin(this.b0)*Math.tan(a)+Math.cos(this.b0)*Math.cos(e)));var g=Math.asin(Math.cos(this.b0)*Math.sin(a)-Math.sin(this.b0)*Math.cos(a)*Math.cos(e));h.y=this.R/2*Math.log((1+Math.sin(g))/(1-Math.sin(g)))+this.y0;h.x=this.R*l+this.x0;return h;},inverse:function(a){var q=a.x-this.x0;var d=a.y-this.y0;var r=q/this.R;var e=2*(Math.atan(Math.exp(d/this.R))-Math.PI/4);var l=Math.asin(Math.cos(this.b0)*Math.sin(e)+Math.sin(this.b0)*Math.cos(e)*Math.cos(r));var o=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(e)));var j=this.lambda0+o/this.alpha;var h=0;var g=l;var m=-1000;var f=0;while(Math.abs(g-m)>1e-7){if(++f>20){Proj4js.reportError("omercFwdInfinity");return;}h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+l/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(g))/2));m=g;g=2*Math.atan(Math.exp(h))-Math.PI/2;}a.x=j;a.y=g;return a;}};Proj4js.Proj.stere={ssfn_:function(b,a,d){a*=d;return(Math.tan(0.5*(Proj4js.common.HALF_PI+b))*Math.pow((1-a)/(1+a),0.5*d));},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var a=Math.abs(this.lat0);if((Math.abs(a)-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.mode=this.lat0<0?this.S_POLE:this.N_POLE;}else{this.mode=a>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT;}this.phits=Math.abs(this.phits);if(this.es){var b;switch(this.mode){case this.N_POLE:case this.S_POLE:if(Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e));}else{a=Math.sin(this.phits);this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,a);a*=this.e;this.akm1/=Math.sqrt(1-a*a);}break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:a=Math.sin(this.lat0);b=2*Math.atan(this.ssfn_(this.lat0,a,this.e))-Proj4js.common.HALF_PI;a*=this.e;this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-a*a);this.sinX1=Math.sin(b);this.cosX1=Math.cos(b);break;}}else{switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-0.5*this.phits):2*this.k0;break;}}},forward:function(h){var g=h.x;var a=h.y;var e,b;if(this.sphere){var f,j,d,l;f=Math.sin(a);j=Math.cos(a);d=Math.cos(g);l=Math.sin(g);switch(this.mode){case this.EQUIT:b=1+j*d;if(b<=Proj4js.common.EPSLN){F_ERROR;}b=this.akm1/b;e=b*j*l;b*=f;break;case this.OBLIQ:b=1+this.sinph0*f+this.cosph0*j*d;if(b<=Proj4js.common.EPSLN){F_ERROR;}b=this.akm1/b;e=b*j*l;b*=this.cosph0*f-this.sinph0*j*d;break;case this.N_POLE:d=-d;a=-a;case this.S_POLE:if(Math.abs(a-Proj4js.common.HALF_PI)<this.TOL){F_ERROR;}b=this.akm1*Math.tan(Proj4js.common.FORTPI+0.5*a);e=l*b;b*=d;break;}}else{d=Math.cos(g);l=Math.sin(g);f=Math.sin(a);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){X=2*Math.atan(this.ssfn_(a,f,this.e));sinX=Math.sin(X-Proj4js.common.HALF_PI);cosX=Math.cos(X);}switch(this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*d));b=A*(this.cosX1*sinX-this.sinX1*cosX*d);e=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*d);b=A*sinX;e=A*cosX;break;case this.S_POLE:a=-a;d=-d;f=-f;case this.N_POLE:e=this.akm1*Proj4js.common.tsfnz(this.e,a,f);b=-e*d;break;}e=e*l;}h.x=e*this.a+this.x0;h.y=b*this.a+this.y0;return h;},inverse:function(o){var f=(o.x-this.x0)/this.a;var j=(o.y-this.y0)/this.a;var m,d;var u,l,e=0,r=0,q,t=0,a=0;var v;if(this.sphere){var b,g,s,h;g=Math.sqrt(f*f+j*j);b=2*Math.atan(g/this.akm1);s=Math.sin(b);h=Math.cos(b);m=0;switch(this.mode){case this.EQUIT:if(Math.abs(g)<=Proj4js.common.EPSLN){d=0;}else{d=Math.asin(j*s/g);}if(h!=0||f!=0){m=Math.atan2(f*s,h*g);}break;case this.OBLIQ:if(Math.abs(g)<=Proj4js.common.EPSLN){d=this.phi0;}else{d=Math.asin(h*sinph0+j*s*cosph0/g);}b=h-sinph0*Math.sin(d);if(b!=0||f!=0){m=Math.atan2(f*s*cosph0,b*g);}break;case this.N_POLE:j=-j;case this.S_POLE:if(Math.abs(g)<=Proj4js.common.EPSLN){d=this.phi0;}else{d=Math.asin(this.mode==this.S_POLE?-h:h);}m=(f==0&&j==0)?0:Math.atan2(f,j);break;}}else{q=Math.sqrt(f*f+j*j);switch(this.mode){case this.OBLIQ:case this.EQUIT:e=2*Math.atan2(q*this.cosX1,this.akm1);u=Math.cos(e);l=Math.sin(e);if(q==0){r=Math.asin(u*this.sinX1);}else{r=Math.asin(u*this.sinX1+(j*l*this.cosX1/q));}e=Math.tan(0.5*(Proj4js.common.HALF_PI+r));f*=l;j=q*this.cosX1*u-j*this.sinX1*l;a=Proj4js.common.HALF_PI;t=0.5*this.e;break;case this.N_POLE:j=-j;case this.S_POLE:e=-q/this.akm1;r=Proj4js.common.HALF_PI-2*Math.atan(e);a=-Proj4js.common.HALF_PI;t=-0.5*this.e;break;}for(v=this.NITER;v--;r=d){l=this.e*Math.sin(r);d=2*Math.atan(e*Math.pow((1+l)/(1-l),t))-a;if(Math.abs(r-d)<this.CONV){if(this.mode==this.S_POLE){d=-d;}m=(f==0&&j==0)?0:Math.atan2(f,j);o.x=m;o.y=d;return o;}}}}};Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array();this.A[1]=+0.6399175073;this.A[2]=-0.1358797613;this.A[3]=+0.063294409;this.A[4]=-0.02526853;this.A[5]=+0.0117879;this.A[6]=-0.0055161;this.A[7]=+0.0026906;this.A[8]=-0.001333;this.A[9]=+0.00067;this.A[10]=-0.00034;this.B_re=new Array();this.B_im=new Array();this.B_re[1]=+0.7557853228;this.B_im[1]=0;this.B_re[2]=+0.249204646;this.B_im[2]=+0.003371507;this.B_re[3]=-0.001541739;this.B_im[3]=+0.04105856;this.B_re[4]=-0.10162907;this.B_im[4]=+0.01727609;this.B_re[5]=-0.26623489;this.B_im[5]=-0.36249218;this.B_re[6]=-0.6870983;this.B_im[6]=-1.1651967;this.C_re=new Array();this.C_im=new Array();this.C_re[1]=+1.3231270439;this.C_im[1]=0;this.C_re[2]=-0.577245789;this.C_im[2]=-0.007809598;this.C_re[3]=+0.508307513;this.C_im[3]=-0.112208952;this.C_re[4]=-0.15094762;this.C_im[4]=+0.18200602;this.C_re[5]=+1.01418179;this.C_im[5]=+1.64497696;this.C_re[6]=+1.9660549;this.C_im[6]=+2.5127645;this.D=new Array();this.D[1]=+1.5627014243;this.D[2]=+0.5185406398;this.D[3]=-0.03333098;this.D[4]=-0.1052906;this.D[5]=-0.0368594;this.D[6]=+0.007317;this.D[7]=+0.0122;this.D[8]=+0.00394;this.D[9]=-0.0013;},forward:function(o){var m=o.x;var e=o.y;var h=e-this.lat0;var a=m-this.long0;var r=h/Proj4js.common.SEC_TO_RAD*0.00001;var l=a;var d=1;var v=0;for(n=1;n<=10;n++){d=d*r;v=v+this.A[n]*d;}var b=v;var t=l;var j=1;var u=0;var g;var s;var f=0;var q=0;for(n=1;n<=6;n++){g=j*b-u*t;s=u*b+j*t;j=g;u=s;f=f+this.B_re[n]*j-this.B_im[n]*u;q=q+this.B_im[n]*j+this.B_re[n]*u;}x=(q*this.a)+this.x0;y=(f*this.a)+this.y0;o.x=x;o.y=y;return o;},inverse:function(m){var e=m.x;var d=m.y;var b=e-this.x0;var a=d-this.y0;var J=a/this.a;var z=b/this.a;var E=1;var r=0;var B;var l;var F=0;var t=0;for(n=1;n<=6;n++){B=E*J-r*z;l=r*J+E*z;E=B;r=l;F=F+this.C_re[n]*E-this.C_im[n]*r;t=t+this.C_im[n]*E+this.C_re[n]*r;}for(i=0;i<this.iterations;i++){var g=F;var D=t;var H;var j;var v=J;var h=z;for(n=2;n<=6;n++){H=g*F-D*t;j=D*F+g*t;g=H;D=j;v=v+(n-1)*(this.B_re[n]*g-this.B_im[n]*D);h=h+(n-1)*(this.B_im[n]*g+this.B_re[n]*D);}g=1;D=0;var u=this.B_re[1];var f=this.B_im[1];for(n=2;n<=6;n++){H=g*F-D*t;j=D*F+g*t;g=H;D=j;u=u+n*(this.B_re[n]*g-this.B_im[n]*D);f=f+n*(this.B_im[n]*g+this.B_re[n]*D);}var w=u*u+f*f;F=(v*u+h*f)/w;t=(h*u-v*f)/w;}var s=F;var I=t;var o=1;var q=0;for(n=1;n<=9;n++){o=o*s;q=q+this.D[n]*o;}var G=this.lat0+(q*Proj4js.common.SEC_TO_RAD*100000);var C=this.long0+I;m.x=C;m.y=G;return m;}};Proj4js.Proj.mill={init:function(){},forward:function(g){var a=g.x;var f=g.y;var e=Proj4js.common.adjust_lon(a-this.long0);var d=this.x0+this.a*e;var b=this.y0+this.a*Math.log(Math.tan((Proj4js.common.PI/4)+(f/2.5)))*1.25;
g.x=d;g.y=b;return g;},inverse:function(d){d.x-=this.x0;d.y-=this.y0;var a=Proj4js.common.adjust_lon(this.long0+d.x/this.a);var b=2.5*(Math.atan(Math.exp(0.8*d.y/this.a))-Proj4js.common.PI/4);d.x=a;d.y=b;return d;}};Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(!this.zone){Proj4js.reportError("utm:init: zone must be specified for UTM");return;}this.lat0=0;this.long0=((6*Math.abs(this.zone))-183)*Proj4js.common.D2R;this.x0=500000;this.y0=this.utmSouth?10000000:0;this.k0=0.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse;}};var GEOCENT_LAT_ERROR=1;var COS_67P5=0.3826834323650898;var AD_C=1.0026;function cs_geodetic_to_geocentric(l,o){var r=o.x;var e=o.y;var q=o.z;var a;var j;var h;var g=0;var m;var f;var d;var b;if(e<-HALF_PI&&e>-1.001*HALF_PI){e=-HALF_PI;}else{if(e>HALF_PI&&e<1.001*HALF_PI){e=HALF_PI;}else{if((e<-HALF_PI)||(e>HALF_PI)){g|=GEOCENT_LAT_ERROR;}}}if(!g){if(r>PI){r-=(2*PI);}f=Math.sin(e);b=Math.cos(e);d=f*f;m=l.a/(Math.sqrt(1-l.es*d));a=(m+q)*b*Math.cos(r);j=(m+q)*b*Math.sin(r);h=((m*(1-l.es))+q)*f;}o.x=a;o.y=j;o.z=h;return g;}function cs_geocentric_to_geodetic(l,B){var b=B.x;var a=B.y;var C=B.z;var f;var z;var q;var d;var u;var w;var t;var j;var g;var h;var s;var e;var r;var m;var v;var o;var D;b=parseFloat(b);a=parseFloat(a);C=parseFloat(C);D=false;if(b!=0){f=Math.atan2(a,b);}else{if(a>0){f=HALF_PI;}else{if(a<0){f=-HALF_PI;}else{D=true;f=0;if(C>0){z=HALF_PI;}else{if(C<0){z=-HALF_PI;}else{z=HALF_PI;q=-l.b;return;}}}}}u=b*b+a*a;d=Math.sqrt(u);w=C*AD_C;j=Math.sqrt(w*w+u);h=w/j;e=d/j;s=h*h*h;t=C+l.b*l.ep2*s;o=d-l.a*l.es*e*e*e;g=Math.sqrt(t*t+o*o);r=t/g;m=o/g;v=l.a/Math.sqrt(1-l.es*r*r);if(m>=COS_67P5){q=d/m-v;}else{if(m<=-COS_67P5){q=d/-m-v;}else{q=C/r+v*(l.es-1);}}if(D==false){z=Math.atan(r/m);}B.x=f;B.y=z;B.z=q;return 0;}function cs_geocentric_to_wgs84(h,o){if(h.datum_type==PJD_3PARAM){o.x+=h.datum_params[0];o.y+=h.datum_params[1];o.z+=h.datum_params[2];}else{var f=h.datum_params[0];var d=h.datum_params[1];var m=h.datum_params[2];var e=h.datum_params[3];var q=h.datum_params[4];var j=h.datum_params[5];var g=h.datum_params[6];var b=g*(o.x-j*o.y+q*o.z)+f;var l=g*(j*o.x+o.y-e*o.z)+d;var a=g*(-q*o.x+e*o.y+o.z)+m;o.x=b;o.y=l;o.z=a;}}function cs_geocentric_from_wgs84(j,a){if(j.datum_type==PJD_3PARAM){a.x-=j.datum_params[0];a.y-=j.datum_params[1];a.z-=j.datum_params[2];}else{var g=j.datum_params[0];var d=j.datum_params[1];var q=j.datum_params[2];var f=j.datum_params[3];var b=j.datum_params[4];var m=j.datum_params[5];var h=j.datum_params[6];var e=(a.x-g)/h;var o=(a.y-d)/h;var l=(a.z-q)/h;a.x=e+m*o-b*l;a.y=-m*e+o+f*l;a.z=b*e-f*o+l;}}Proj4js.Proj.vandg={init:function(){this.R=6370997;},forward:function(u){var s=u.x;var h=u.y;var r=Proj4js.common.adjust_lon(s-this.long0);var q,j;if(Math.abs(h)<=Proj4js.common.EPSLN){q=this.x0+this.R*r;j=this.y0;}var w=Proj4js.common.asinz(2*Math.abs(h/Proj4js.common.PI));if((Math.abs(r)<=Proj4js.common.EPSLN)||(Math.abs(Math.abs(h)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)){q=this.x0;if(h>=0){j=this.y0+Proj4js.common.PI*this.R*Math.tan(0.5*w);}else{j=this.y0+Proj4js.common.PI*this.R*-Math.tan(0.5*w);}}var e=0.5*Math.abs((Proj4js.common.PI/r)-(r/Proj4js.common.PI));var v=e*e;var f=Math.sin(w);var o=Math.cos(w);var d=o/(f+o-1);var b=d*d;var a=d*(2/f-1);var l=a*a;var t=Proj4js.common.PI*this.R*(e*(d-l)+Math.sqrt(v*(d-l)*(d-l)-(l+v)*(b-l)))/(l+v);if(r<0){t=-t;}q=this.x0+t;t=Math.abs(t/(Proj4js.common.PI*this.R));if(h>=0){j=this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-t*t-2*e*t);}else{j=this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-t*t-2*e*t);}u.x=q;u.y=j;return u;},inverse:function(t){var l;var o,r,j,e,b,a;var h,u;var s;var g;var q;var f;var m;t.x-=this.x0;t.y-=this.y0;q=Proj4js.common.PI*this.R;o=t.x/q;r=t.y/q;j=o*o+r*r;e=-Math.abs(r)*(1+j);b=e-2*r*r+o*o;a=-2*e+1+2*r*r+j*j;m=r*r/a+(2*b*b*b/a/a/a-9*e*b/a/a)/27;s=(e-b*b/3/a)/a;g=2*Math.sqrt(-s/3);q=((3*m)/s)/g;if(Math.abs(q)>1){if(q>=0){q=1;}else{q=-1;}}f=Math.acos(q)/3;if(t.y>=0){lat=(-g*Math.cos(f+Proj4js.common.PI/3)-b/3/a)*Proj4js.common.PI;}else{lat=-(-g*Math.cos(f+PI/3)-b/3/a)*Proj4js.common.PI;}if(Math.abs(o)<Proj4js.common.EPSLN){lon=this.long0;}lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(j-1+Math.sqrt(1+2*(o*o-r*r)+j*j))/2/o);t.x=lon;t.y=lat;return t;}};Proj4js.Proj.eqc={init:function(){if(!this.x0){this.x0=0;}if(!this.y0){this.y0=0;}if(!this.lat0){this.lat0=0;}if(!this.long0){this.long0=0;}if(!this.lat_ts){this.lat_ts=0;}if(!this.title){this.title="Equidistant Cylindrical (Plate Carre)";}this.rc=Math.cos(this.lat_ts);},forward:function(b){var d=b.x;var a=b.y;var f=Proj4js.common.adjust_lon(d-this.long0);var e=Proj4js.common.adjust_lat(a-this.lat0);b.x=this.x0+(this.a*f*this.rc);b.y=this.y0+(this.a*e);return b;},inverse:function(d){var b=d.x;var a=d.y;d.x=Proj4js.common.adjust_lon(this.long0+((b-this.x0)/(this.a*this.rc)));d.y=Proj4js.common.adjust_lat(this.lat0+((a-this.y0)/(this.a)));return d;}};Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0);cphi=Math.cos(this.lat0);cphi*=cphi;this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi);this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es));this.phic0=Math.asin(sphi/this.C);this.ratexp=0.5*this.C*this.e;this.K=Math.tan(0.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(0.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp));},forward:function(d){var a=d.x;var b=d.y;d.y=2*Math.atan(this.K*Math.pow(Math.tan(0.5*b+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(b),this.ratexp))-Proj4js.common.HALF_PI;d.x=this.C*a;return d;},inverse:function(b){var a=1e-14;var d=b.x/this.C;var f=b.y;num=Math.pow(Math.tan(0.5*f+Proj4js.common.FORTPI)/this.K,1/this.C);for(var e=Proj4js.common.MAX_ITER;e>0;--e){f=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(b.y),-0.5*this.e))-Proj4js.common.HALF_PI;if(Math.abs(f-b.y)<a){break;}b.y=f;}if(!e){Proj4js.reportError("gauss:inverse:convergence failed");return null;}b.x=d;b.y=f;return b;}};Proj4js.Proj.omerc={init:function(){if(!this.mode){this.mode=0;}if(!this.lon1){this.lon1=0;this.mode=1;}if(!this.lon2){this.lon2=0;}if(!this.lat2){this.lat2=0;}var b=this.b/this.a;var a=1-Math.pow(b,2);var d=Math.sqrt(a);this.sin_p20=Math.sin(this.lat0);this.cos_p20=Math.cos(this.lat0);this.con=1-this.es*this.sin_p20*this.sin_p20;this.com=Math.sqrt(1-a);this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-a));this.al=this.a*this.bl*this.k0*this.com/this.con;if(Math.abs(this.lat0)<Proj4js.common.EPSLN){this.ts=1;this.d=1;this.el=1;}else{this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20);this.con=Math.sqrt(this.con);this.d=this.bl*this.com/(this.cos_p20*this.con);if((this.d*this.d-1)>0){if(this.lat0>=0){this.f=this.d+Math.sqrt(this.d*this.d-1);}else{this.f=this.d-Math.sqrt(this.d*this.d-1);}}else{this.f=this.d;}this.el=this.f*Math.pow(this.ts,this.bl);}if(this.mode!=0){this.g=0.5*(this.f-1/this.f);this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d);this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl;this.con=Math.abs(this.lat0);if((this.con>Proj4js.common.EPSLN)&&(Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN)){this.singam=Math.sin(this.gama);this.cosgam=Math.cos(this.gama);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}}else{Proj4js.reportError("omerc:Init:DataError");}}else{this.sinphi=Math.sin(this.at1);this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi);this.sinphi=Math.sin(this.lat2);this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi);this.h=Math.pow(this.ts1,this.bl);this.l=Math.pow(this.ts2,this.bl);this.f=this.el/this.h;this.g=0.5*(this.f-1/this.f);this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h);this.p=(this.l-this.h)/(this.l+this.h);this.dlon=this.lon1-this.lon2;
if(this.dlon<-Proj4js.common.PI){this.lon2=this.lon2-2*Proj4js.common.PI;}if(this.dlon>Proj4js.common.PI){this.lon2=this.lon2+2*Proj4js.common.PI;}this.dlon=this.lon1-this.lon2;this.longc=0.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(0.5*this.bl*this.dlon)/this.p)/this.bl;this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc);this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g);this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama));if(Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError");}else{this.con=Math.abs(this.lat1);}if((this.con<=Proj4js.common.EPSLN)||(Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN)){Proj4js.reportError("omercInitDataError");}else{if(Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError");}}this.singam=Math.sin(this.gam);this.cosgam=Math.cos(this.gam);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}}},forward:function(j){var f;var H,D;var C;var z,u,F;var a,l,r;var G,g,v;var w,o;var B;var E;var d;var I=j.x;var e=j.y;H=Math.sin(e);E=Proj4js.common.adjust_lon(I-this.longc);v=Math.sin(this.bl*E);if(Math.abs(Math.abs(e)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){d=Proj4js.common.tsfnz(this.e,e,H);G=this.el/(Math.pow(d,this.bl));B=0.5*(G-1/G);u=0.5*(G+1/G);w=(B*this.singam-v*this.cosgam)/u;a=Math.cos(this.bl*E);if(Math.abs(a)<1e-7){g=this.al*this.bl*E;}else{g=this.al*Math.atan((B*this.cosgam+v*this.singam)/a)/this.bl;if(a<0){g=g+Proj4js.common.PI*this.al/this.bl;}}}else{if(e>=0){w=this.singam;}else{w=-this.singam;}g=this.al*e/this.bl;}if(Math.abs(Math.abs(w)-1)<=Proj4js.common.EPSLN){Proj4js.reportError("omercFwdInfinity");}o=0.5*this.al*Math.log((1-w)/(1+w))/this.bl;g=g-this.u;var m=this.x0+o*this.cosaz+g*this.sinaz;var h=this.y0+g*this.cosaz-o*this.sinaz;j.x=m;j.y=h;return j;},inverse:function(w){var D;var e;var I;var H,C;var z;var r,h,F;var a,B,m;var G,f,u,l,d;var o,g,v;var E;var j;w.x-=this.x0;w.y-=this.y0;j=0;G=w.x*this.cosaz-w.y*this.sinaz;f=w.y*this.cosaz+w.x*this.sinaz;f=f+this.u;u=Math.exp(-this.bl*G/this.al);l=0.5*(u-1/u);h=0.5*(u+1/u);o=Math.sin(this.bl*f/this.al);g=(o*this.cosgam+l*this.singam)/h;if(Math.abs(Math.abs(g)-1)<=Proj4js.common.EPSLN){lon=this.longc;if(g>=0){lat=Proj4js.common.HALF_PI;}else{lat=-Proj4js.common.HALF_PI;}}else{a=1/this.bl;d=Math.pow((this.el/Math.sqrt((1+g)/(1-g))),a);lat=Proj4js.common.phi2z(this.e,d);e=this.longc-Math.atan2((l*this.cosgam-o*this.singam),a)/this.bl;lon=Proj4js.common.adjust_lon(e);}w.x=lon;w.y=lat;return w;}};Proj4js.Proj.lcc={init:function(){if(!this.lat2){this.lat2=this.lat0;}if(!this.k0){this.k0=1;}if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("lcc:init: Equal Latitudes");return;}var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var m=Math.sin(this.lat1);var j=Math.cos(this.lat1);var b=Proj4js.common.msfnz(this.e,m,j);var f=Proj4js.common.tsfnz(this.e,this.lat1,m);var l=Math.sin(this.lat2);var h=Math.cos(this.lat2);var a=Proj4js.common.msfnz(this.e,l,h);var d=Proj4js.common.tsfnz(this.e,this.lat2,l);var g=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns=Math.log(b/a)/Math.log(f/d);}else{this.ns=m;}this.f0=b/(this.ns*Math.pow(f,this.ns));this.rh=this.a*this.f0*Math.pow(g,this.ns);if(!this.title){this.title="Lambert Conformal Conic";}},forward:function(a){var b=a.x;var g=a.y;if(g<=90&&g>=-90&&b<=180&&b>=-180){}else{Proj4js.reportError("lcc:forward: llInputOutOfRange: "+b+" : "+g);return null;}var d=Math.abs(Math.abs(g)-Proj4js.common.HALF_PI);var f;if(d>Proj4js.common.EPSLN){f=Proj4js.common.tsfnz(this.e,g,Math.sin(g));rh1=this.a*this.f0*Math.pow(f,this.ns);}else{d=g*this.ns;if(d<=0){Proj4js.reportError("lcc:forward: No Projection");return null;}rh1=0;}var e=this.ns*Proj4js.common.adjust_lon(b-this.long0);a.x=this.k0*(rh1*Math.sin(e))+this.x0;a.y=this.k0*(this.rh-rh1*Math.cos(e))+this.y0;return a;},inverse:function(g){var a,b,e;var f,h;x=(g.x-this.x0)/this.k0;y=(this.rh-(g.y-this.y0)/this.k0);if(this.ns>0){a=Math.sqrt(x*x+y*y);b=1;}else{a=-Math.sqrt(x*x+y*y);b=-1;}var d=0;if(a!=0){d=Math.atan2((b*x),(b*y));}if((a!=0)||(this.ns>0)){b=1/this.ns;e=Math.pow((a/(this.a*this.f0)),b);f=Proj4js.common.phi2z(this.e,e);if(f==-9999){return null;}}else{f=-Proj4js.common.HALF_PI;}h=Proj4js.common.adjust_lon(d/this.ns+this.long0);g.x=h;g.y=f;return g;}};Proj4js.Proj.laea={init:function(){this.sin_lat_o=Math.sin(this.lat0);this.cos_lat_o=Math.cos(this.lat0);},forward:function(r){var o=r.x;var j=r.y;var d=Proj4js.common.adjust_lon(o-this.long0);var e=Math.sin(j);var l=Math.cos(j);var a=Math.sin(d);var b=Math.cos(d);var h=this.sin_lat_o*e+this.cos_lat_o*l*b;if(h==-1){Proj4js.reportError("laea:fwd:Point projects to a circle of radius "+2*R);return null;}var f=this.a*Math.sqrt(2/(1+h));var q=f*l*a+this.x0;var m=f*(this.cos_lat_o*e-this.sin_lat_o*l*b)+this.y0;r.x=q;r.y=m;return r;},inverse:function(g){g.x-=this.x0;g.y-=this.y0;var e=Math.sqrt(g.x*g.x+g.y*g.y);var d=e/(2*this.a);if(d>1){Proj4js.reportError("laea:Inv:DataError");return null;}var j=2*Proj4js.common.asinz(d);var b=Math.sin(j);var a=Math.cos(j);var h=this.long0;if(Math.abs(e)>Proj4js.common.EPSLN){var f=Proj4js.common.asinz(this.sin_lat_o*a+this.cos_lat_o*b*g.y/e);var d=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(d)>Proj4js.common.EPSLN){d=a-this.sin_lat_o*Math.sin(f);if(d!=0){h=Proj4js.common.adjust_lon(this.long0+Math.atan2(g.x*b*this.cos_lat_o,d*e));}}else{if(this.lat0<0){h=Proj4js.common.adjust_lon(this.long0-Math.atan2(-g.x,g.y));}else{h=Proj4js.common.adjust_lon(this.long0+Math.atan2(g.x,-g.y));}}}else{f=this.lat0;}g.x=h;g.y=f;return g;}};Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);this.cos_p12=Math.cos(this.lat0);},forward:function(h){var f=h.x;var a=h.y;var l;var d=Math.sin(h.y);var j=Math.cos(h.y);var e=Proj4js.common.adjust_lon(f-this.long0);var b=Math.cos(e);var m=this.sin_p12*d+this.cos_p12*j*b;if(Math.abs(Math.abs(m)-1)<Proj4js.common.EPSLN){l=1;if(m<0){Proj4js.reportError("aeqd:Fwd:PointError");return;}}else{var o=Math.acos(m);l=o/Math.sin(o);}h.x=this.x0+this.a*l*j*Math.sin(e);h.y=this.y0+this.a*l*(this.cos_p12*d-this.sin_p12*j*b);return h;},inverse:function(g){g.x-=this.x0;g.y-=this.y0;var b=Math.sqrt(g.x*g.x+g.y*g.y);if(b>(2*Proj4js.common.HALF_PI*this.a)){Proj4js.reportError("aeqdInvDataError");return;}var l=b/this.a;var j=Math.sin(l);var e=Math.cos(l);var f=this.long0;var a;if(Math.abs(b)<=Proj4js.common.EPSLN){a=this.lat0;}else{a=Proj4js.common.asinz(e*this.sin_p12+(g.y*j*this.cos_p12)/b);var h=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(h)<=Proj4js.common.EPSLN){if(lat0>=0){f=Proj4js.common.adjust_lon(this.long0+Math.atan2(g.x,-g.y));}else{f=Proj4js.common.adjust_lon(this.long0-Math.atan2(-g.x,g.y));}}else{h=e-this.sin_p12*Math.sin(a);if((Math.abs(h)<Proj4js.common.EPSLN)&&(Math.abs(g.x)<Proj4js.common.EPSLN)){}else{var d=Math.atan2((g.x*j*this.cos_p12),(h*b));f=Proj4js.common.adjust_lon(this.long0+Math.atan2((g.x*j*this.cos_p12),(h*b)));}}}g.x=f;g.y=a;return g;}};Proj4js.Proj.moll={init:function(){},forward:function(g){var d=g.x;var a=g.y;var l=Proj4js.common.adjust_lon(d-this.long0);var j=a;var h=Proj4js.common.PI*Math.sin(a);for(var m=0;;m++){var f=-(j+Math.sin(j)-h)/(1+Math.cos(j));j+=f;if(Math.abs(f)<Proj4js.common.EPSLN){break;}if(m>=50){Proj4js.reportError("moll:Fwd:IterationError");}}j/=2;if(Proj4js.common.PI/2-Math.abs(a)<Proj4js.common.EPSLN){l=0;}var e=0.900316316158*this.a*l*Math.cos(j)+this.x0;var b=1.4142135623731*this.a*Math.sin(j)+this.y0;g.x=e;g.y=b;return g;},inverse:function(b){var f;var e;b.x-=this.x0;var e=b.y/(1.4142135623731*this.a);if(Math.abs(e)>0.999999999999){e=0.999999999999;}var f=Math.asin(e);var d=Proj4js.common.adjust_lon(this.long0+(b.x/(0.900316316158*this.a*Math.cos(f))));
if(d<(-Proj4js.common.PI)){d=-Proj4js.common.PI;}if(d>Proj4js.common.PI){d=Proj4js.common.PI;}e=(2*f+Math.sin(2*f))/Proj4js.common.PI;if(Math.abs(e)>1){e=1;}var a=Math.asin(e);b.x=d;b.y=a;return b;}};var OpenLayers={singleFile:true};(function(){var o=(typeof OpenLayers=="object"&&OpenLayers.singleFile);var a;window.OpenLayers={_scriptName:(!o)?"lib/OpenLayers.js":"OpenLayers.js",_getScriptLocation:function(){if(a!=undefined){return a;}a="";var r=new RegExp("(^|(.*?\\/))("+OpenLayers._scriptName+")(\\?|$)");var s=document.getElementsByTagName("script");for(var v=0,t=s.length;v<t;v++){var h=s[v].getAttribute("src");if(h){var u=h.match(r);if(u){a=u[1];break;}}}return a;}};if(!o){var q=new Array("OpenLayers/Util.js","OpenLayers/BaseTypes.js","OpenLayers/BaseTypes/Class.js","OpenLayers/BaseTypes/Bounds.js","OpenLayers/BaseTypes/Element.js","OpenLayers/BaseTypes/LonLat.js","OpenLayers/BaseTypes/Pixel.js","OpenLayers/BaseTypes/Size.js","OpenLayers/Console.js","OpenLayers/Tween.js","Rico/Corner.js","Rico/Color.js","OpenLayers/Ajax.js","OpenLayers/Events.js","OpenLayers/Request.js","OpenLayers/Request/XMLHttpRequest.js","OpenLayers/Projection.js","OpenLayers/Map.js","OpenLayers/Layer.js","OpenLayers/Icon.js","OpenLayers/Marker.js","OpenLayers/Marker/Box.js","OpenLayers/Popup.js","OpenLayers/Tile.js","OpenLayers/Tile/Image.js","OpenLayers/Tile/Image/IFrame.js","OpenLayers/Tile/WFS.js","OpenLayers/Layer/Image.js","OpenLayers/Layer/SphericalMercator.js","OpenLayers/Layer/EventPane.js","OpenLayers/Layer/FixedZoomLevels.js","OpenLayers/Layer/Google.js","OpenLayers/Layer/Google/v3.js","OpenLayers/Layer/VirtualEarth.js","OpenLayers/Layer/Yahoo.js","OpenLayers/Layer/HTTPRequest.js","OpenLayers/Layer/Grid.js","OpenLayers/Layer/MapGuide.js","OpenLayers/Layer/MapServer.js","OpenLayers/Layer/MapServer/Untiled.js","OpenLayers/Layer/KaMap.js","OpenLayers/Layer/KaMapCache.js","OpenLayers/Layer/MultiMap.js","OpenLayers/Layer/Markers.js","OpenLayers/Layer/Text.js","OpenLayers/Layer/WorldWind.js","OpenLayers/Layer/ArcGIS93Rest.js","OpenLayers/Layer/WMS.js","OpenLayers/Layer/WMS/Untiled.js","OpenLayers/Layer/WMS/Post.js","OpenLayers/Layer/WMTS.js","OpenLayers/Layer/ArcIMS.js","OpenLayers/Layer/GeoRSS.js","OpenLayers/Layer/Boxes.js","OpenLayers/Layer/XYZ.js","OpenLayers/Layer/TMS.js","OpenLayers/Layer/TileCache.js","OpenLayers/Layer/Zoomify.js","OpenLayers/Popup/Anchored.js","OpenLayers/Popup/AnchoredBubble.js","OpenLayers/Popup/Framed.js","OpenLayers/Popup/FramedCloud.js","OpenLayers/Feature.js","OpenLayers/Feature/Vector.js","OpenLayers/Feature/WFS.js","OpenLayers/Handler.js","OpenLayers/Handler/Click.js","OpenLayers/Handler/Hover.js","OpenLayers/Handler/Point.js","OpenLayers/Handler/Path.js","OpenLayers/Handler/Polygon.js","OpenLayers/Handler/Feature.js","OpenLayers/Handler/Drag.js","OpenLayers/Handler/RegularPolygon.js","OpenLayers/Handler/Box.js","OpenLayers/Handler/MouseWheel.js","OpenLayers/Handler/Keyboard.js","OpenLayers/Control.js","OpenLayers/Control/Attribution.js","OpenLayers/Control/Button.js","OpenLayers/Control/ZoomBox.js","OpenLayers/Control/ZoomToMaxExtent.js","OpenLayers/Control/DragPan.js","OpenLayers/Control/Navigation.js","OpenLayers/Control/MouseDefaults.js","OpenLayers/Control/MousePosition.js","OpenLayers/Control/OverviewMap.js","OpenLayers/Control/KeyboardDefaults.js","OpenLayers/Control/PanZoom.js","OpenLayers/Control/PanZoomBar.js","OpenLayers/Control/ArgParser.js","OpenLayers/Control/Permalink.js","OpenLayers/Control/Scale.js","OpenLayers/Control/ScaleLine.js","OpenLayers/Control/Snapping.js","OpenLayers/Control/Split.js","OpenLayers/Control/LayerSwitcher.js","OpenLayers/Control/DrawFeature.js","OpenLayers/Control/DragFeature.js","OpenLayers/Control/ModifyFeature.js","OpenLayers/Control/Panel.js","OpenLayers/Control/SelectFeature.js","OpenLayers/Control/NavigationHistory.js","OpenLayers/Control/Measure.js","OpenLayers/Control/WMSGetFeatureInfo.js","OpenLayers/Control/WMTSGetFeatureInfo.js","OpenLayers/Control/Graticule.js","OpenLayers/Control/TransformFeature.js","OpenLayers/Control/SLDSelect.js","OpenLayers/Geometry.js","OpenLayers/Geometry/Rectangle.js","OpenLayers/Geometry/Collection.js","OpenLayers/Geometry/Point.js","OpenLayers/Geometry/MultiPoint.js","OpenLayers/Geometry/Curve.js","OpenLayers/Geometry/LineString.js","OpenLayers/Geometry/LinearRing.js","OpenLayers/Geometry/Polygon.js","OpenLayers/Geometry/MultiLineString.js","OpenLayers/Geometry/MultiPolygon.js","OpenLayers/Geometry/Surface.js","OpenLayers/Renderer.js","OpenLayers/Renderer/Elements.js","OpenLayers/Renderer/SVG.js","OpenLayers/Renderer/Canvas.js","OpenLayers/Renderer/VML.js","OpenLayers/Layer/Vector.js","OpenLayers/Layer/Vector/RootContainer.js","OpenLayers/Strategy.js","OpenLayers/Strategy/Filter.js","OpenLayers/Strategy/Fixed.js","OpenLayers/Strategy/Cluster.js","OpenLayers/Strategy/Paging.js","OpenLayers/Strategy/BBOX.js","OpenLayers/Strategy/Save.js","OpenLayers/Strategy/Refresh.js","OpenLayers/Filter.js","OpenLayers/Filter/FeatureId.js","OpenLayers/Filter/Logical.js","OpenLayers/Filter/Comparison.js","OpenLayers/Filter/Spatial.js","OpenLayers/Protocol.js","OpenLayers/Protocol/HTTP.js","OpenLayers/Protocol/SQL.js","OpenLayers/Protocol/SQL/Gears.js","OpenLayers/Protocol/WFS.js","OpenLayers/Protocol/WFS/v1.js","OpenLayers/Protocol/WFS/v1_0_0.js","OpenLayers/Protocol/WFS/v1_1_0.js","OpenLayers/Protocol/SOS.js","OpenLayers/Protocol/SOS/v1_0_0.js","OpenLayers/Layer/PointTrack.js","OpenLayers/Layer/GML.js","OpenLayers/Style.js","OpenLayers/Style2.js","OpenLayers/StyleMap.js","OpenLayers/Rule.js","OpenLayers/Format.js","OpenLayers/Format/XML.js","OpenLayers/Format/Context.js","OpenLayers/Format/ArcXML.js","OpenLayers/Format/ArcXML/Features.js","OpenLayers/Format/GML.js","OpenLayers/Format/GML/Base.js","OpenLayers/Format/GML/v2.js","OpenLayers/Format/GML/v3.js","OpenLayers/Format/Atom.js","OpenLayers/Format/KML.js","OpenLayers/Format/GeoRSS.js","OpenLayers/Format/WFS.js","OpenLayers/Format/WFSCapabilities.js","OpenLayers/Format/WFSCapabilities/v1.js","OpenLayers/Format/WFSCapabilities/v1_0_0.js","OpenLayers/Format/WFSCapabilities/v1_1_0.js","OpenLayers/Format/WFSDescribeFeatureType.js","OpenLayers/Format/WMSDescribeLayer.js","OpenLayers/Format/WMSDescribeLayer/v1_1.js","OpenLayers/Format/WKT.js","OpenLayers/Format/OSM.js","OpenLayers/Format/GPX.js","OpenLayers/Format/Filter.js","OpenLayers/Format/Filter/v1.js","OpenLayers/Format/Filter/v1_0_0.js","OpenLayers/Format/Filter/v1_1_0.js","OpenLayers/Format/SLD.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/SLD/v1_0_0.js","OpenLayers/Format/OWSCommon/v1.js","OpenLayers/Format/OWSCommon/v1_0_0.js","OpenLayers/Format/OWSCommon/v1_1_0.js","OpenLayers/Format/CSWGetDomain.js","OpenLayers/Format/CSWGetDomain/v2_0_2.js","OpenLayers/Format/CSWGetRecords.js","OpenLayers/Format/CSWGetRecords/v2_0_2.js","OpenLayers/Format/WFST.js","OpenLayers/Format/WFST/v1.js","OpenLayers/Format/WFST/v1_0_0.js","OpenLayers/Format/WFST/v1_1_0.js","OpenLayers/Format/Text.js","OpenLayers/Format/JSON.js","OpenLayers/Format/GeoJSON.js","OpenLayers/Format/WMC.js","OpenLayers/Format/WMC/v1.js","OpenLayers/Format/WMC/v1_0_0.js","OpenLayers/Format/WMC/v1_1_0.js","OpenLayers/Format/WMSCapabilities.js","OpenLayers/Format/WMSCapabilities/v1.js","OpenLayers/Format/WMSCapabilities/v1_1.js","OpenLayers/Format/WMSCapabilities/v1_1_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1.js","OpenLayers/Format/WMSCapabilities/v1_3.js","OpenLayers/Format/WMSCapabilities/v1_3_0.js","OpenLayers/Format/WMSGetFeatureInfo.js","OpenLayers/Format/SOSCapabilities.js","OpenLayers/Format/SOSCapabilities/v1_0_0.js","OpenLayers/Format/SOSGetObservation.js","OpenLayers/Format/SOSGetFeatureOfInterest.js","OpenLayers/Format/OWSContext.js","OpenLayers/Format/OWSContext/v0_3_1.js","OpenLayers/Format/WMTSCapabilities.js","OpenLayers/Format/WMTSCapabilities/v1_0_0.js","OpenLayers/Layer/WFS.js","OpenLayers/Control/GetFeature.js","OpenLayers/Control/MouseToolbar.js","OpenLayers/Control/NavToolbar.js","OpenLayers/Control/PanPanel.js","OpenLayers/Control/Pan.js","OpenLayers/Control/ZoomIn.js","OpenLayers/Control/ZoomOut.js","OpenLayers/Control/ZoomPanel.js","OpenLayers/Control/EditingToolbar.js","OpenLayers/Symbolizer.js","OpenLayers/Symbolizer/Point.js","OpenLayers/Symbolizer/Line.js","OpenLayers/Symbolizer/Polygon.js","OpenLayers/Symbolizer/Text.js","OpenLayers/Symbolizer/Raster.js","OpenLayers/Lang.js","OpenLayers/Lang/en.js","OpenLayers/Lang/fr.js");
var e=navigator.userAgent;var j=(e.match("MSIE")||e.match("Safari"));if(j){var d=new Array(q.length);}var b=OpenLayers._getScriptLocation()+"lib/";for(var g=0,m=q.length;g<m;g++){if(j){d[g]="<script src='"+b+q[g]+"'><\/script>";}else{var f=document.createElement("script");f.src=b+q[g];var l=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;l.appendChild(f);}}if(j){document.write(d.join(""));}}})();OpenLayers.VERSION_NUMBER="OpenLayers 2.10 -- $Revision: 10721 $";OpenLayers.Util={};OpenLayers.Util.getElement=function(){var b=[];for(var a=0,d=arguments.length;a<d;a++){var e=arguments[a];if(typeof e=="string"){e=document.getElementById(e);}if(arguments.length==1){return e;}b.push(e);}return b;};OpenLayers.Util.isElement=function(a){return !!(a&&a.nodeType===1);};if(typeof window.$==="undefined"){window.$=OpenLayers.Util.getElement;}OpenLayers.Util.extend=function(e,d){e=e||{};if(d){for(var b in d){var a=d[b];if(a!==undefined){e[b]=a;}}var f=typeof window.Event=="function"&&d instanceof window.Event;if(!f&&d.hasOwnProperty&&d.hasOwnProperty("toString")){e.toString=d.toString;}}return e;};OpenLayers.Util.removeItem=function(a,d){for(var b=a.length-1;b>=0;b--){if(a[b]==d){a.splice(b,1);}}return a;};OpenLayers.Util.clearArray=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"}));a.length=0;};OpenLayers.Util.indexOf=function(b,a){if(typeof b.indexOf=="function"){return b.indexOf(a);}else{for(var e=0,d=b.length;e<d;e++){if(b[e]==a){return e;}}return -1;}};OpenLayers.Util.modifyDOMElement=function(f,j,e,g,a,d,h,b){if(j){f.id=j;}if(e){f.style.left=e.x+"px";f.style.top=e.y+"px";}if(g){f.style.width=g.w+"px";f.style.height=g.h+"px";}if(a){f.style.position=a;}if(d){f.style.border=d;}if(h){f.style.overflow=h;}if(parseFloat(b)>=0&&parseFloat(b)<1){f.style.filter="alpha(opacity="+(b*100)+")";f.style.opacity=b;}else{if(parseFloat(b)==1){f.style.filter="";f.style.opacity="";}}};OpenLayers.Util.createDiv=function(f,e,d,a,l,h,g,b){var j=document.createElement("div");if(a){j.style.backgroundImage="url("+a+")";}if(!f){f=OpenLayers.Util.createUniqueID("OpenLayersDiv");}if(!l){l="absolute";}OpenLayers.Util.modifyDOMElement(j,f,e,d,l,h,g,b);return j;};OpenLayers.Util.createImage=function(f,d,b,l,j,h,a,e){var g=document.createElement("img");if(!f){f=OpenLayers.Util.createUniqueID("OpenLayersDiv");}if(!j){j="relative";}OpenLayers.Util.modifyDOMElement(g,f,d,b,j,h,null,a);if(e){g.style.display="none";OpenLayers.Event.observe(g,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,g));OpenLayers.Event.observe(g,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,g));}g.style.alt=f;g.galleryImg="no";if(l){g.src=l;}return g;};OpenLayers.Util.setOpacity=function(b,a){OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a);};OpenLayers.Util.onImageLoad=function(){if(!this.viewRequestID||(this.map&&this.viewRequestID==this.map.viewRequestID)){this.style.display="";}OpenLayers.Element.removeClass(this,"olImageLoadError");};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var g=this.urls;if(g&&g instanceof Array&&g.length>1){var a=this.src.toString();var f,d;for(d=0;f=g[d];d++){if(a.indexOf(f)!=-1){break;}}var b=Math.floor(g.length*Math.random());var e=g[b];d=0;while(e==f&&d++<4){b=Math.floor(g.length*Math.random());e=g[b];}this.src=a.replace(f,e);}else{this.src=this.src;}}else{OpenLayers.Element.addClass(this,"olImageLoadError");}this.style.display="";};OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var b=navigator.appVersion.split("MSIE");var d=parseFloat(b[1]);var f=false;try{f=!!(document.body.filters);}catch(a){}OpenLayers.Util.alphaHackNeeded=(f&&(d>=5.5)&&(d<7));}return OpenLayers.Util.alphaHackNeeded;};OpenLayers.Util.modifyAlphaImageDiv=function(d,f,e,b,m,l,g,h,a){OpenLayers.Util.modifyDOMElement(d,f,e,b,l,null,null,a);var j=d.childNodes[0];if(m){j.src=m;}OpenLayers.Util.modifyDOMElement(j,d.id+"_innerImage",null,b,"relative",g);if(OpenLayers.Util.alphaHack()){if(d.style.display!="none"){d.style.display="inline-block";}if(h==null){h="scale";}d.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+j.src+"', sizingMethod='"+h+"')";if(parseFloat(d.style.opacity)>=0&&parseFloat(d.style.opacity)<1){d.style.filter+=" alpha(opacity="+d.style.opacity*100+")";}j.style.filter="alpha(opacity=0)";}};OpenLayers.Util.createAlphaImageDiv=function(e,b,o,l,j,f,g,m,d){var a=OpenLayers.Util.createDiv();var h=OpenLayers.Util.createImage(null,null,null,null,null,null,null,false);a.appendChild(h);if(d){h.style.display="none";OpenLayers.Event.observe(h,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,a));OpenLayers.Event.observe(h,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,a));}OpenLayers.Util.modifyAlphaImageDiv(a,e,b,o,l,j,f,g,m);return a;};OpenLayers.Util.upperCaseObject=function(d){var b={};for(var a in d){b[a.toUpperCase()]=d[a];}return b;};OpenLayers.Util.applyDefaults=function(b,a){b=b||{};var e=typeof window.Event=="function"&&a instanceof window.Event;for(var d in a){if(b[d]===undefined||(!e&&a.hasOwnProperty&&a.hasOwnProperty(d)&&!b.hasOwnProperty(d))){b[d]=a[d];}}if(!e&&a&&a.hasOwnProperty&&a.hasOwnProperty("toString")&&!b.hasOwnProperty("toString")){b.toString=a.toString;}return b;};OpenLayers.Util.getParameterString=function(h){var g=[];for(var d in h){var b=h[d];if((b!=null)&&(typeof b!="function")){var j;if(typeof b=="object"&&b.constructor==Array){var l=[];var e;for(var f=0,a=b.length;f<a;f++){e=b[f];l.push(encodeURIComponent((e===null||e===undefined)?"":e));}j=l.join(",");}else{j=encodeURIComponent(b);}g.push(encodeURIComponent(d)+"="+j);}}return g.join("&");};OpenLayers.Util.urlAppend=function(d,e){var b=d;if(e){var a=(d+" ").split(/[?&]/);b+=(a.pop()===" "?e:a.length?"&"+e:"?"+e);}return b;};OpenLayers.ImgPath="";OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||(OpenLayers._getScriptLocation()+"img/");};OpenLayers.Util.Try=function(){var b=null;for(var a=0,f=arguments.length;a<f;a++){var g=arguments[a];try{b=g();break;}catch(d){}}return b;};OpenLayers.Util.getNodes=function(a,d){var b=OpenLayers.Util.Try(function(){return OpenLayers.Util._getNodes(a.documentElement.childNodes,d);},function(){return OpenLayers.Util._getNodes(a.childNodes,d);});return b;};OpenLayers.Util._getNodes=function(a,d){var f=[];for(var b=0,e=a.length;b<e;b++){if(a[b].nodeName==d){f.push(a[b]);}}return f;};OpenLayers.Util.getTagText=function(a,b,e){var d=OpenLayers.Util.getNodes(a,b);if(d&&(d.length>0)){if(!e){e=0;}if(d[e].childNodes.length>1){return d.childNodes[1].nodeValue;}else{if(d[e].childNodes.length==1){return d[e].firstChild.nodeValue;}}}else{return"";}};OpenLayers.Util.getXmlNodeValue=function(a){var b=null;OpenLayers.Util.Try(function(){b=a.text;if(!b){b=a.textContent;}if(!b){b=a.firstChild.nodeValue;}},function(){b=a.textContent;});return b;};OpenLayers.Util.mouseLeft=function(b,a){var d=(b.relatedTarget)?b.relatedTarget:b.toElement;while(d!=a&&d!=null){d=d.parentNode;}return(d!=a);};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(b,a){if(a==null){a=OpenLayers.Util.DEFAULT_PRECISION;}var b;if(a==0){b=parseFloat(b);}else{b=parseFloat(parseFloat(b).toPrecision(a));}return b;};OpenLayers.Util.rad=function(a){return a*Math.PI/180;};OpenLayers.Util.deg=function(a){return a*180/Math.PI;};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(t,o){var z=OpenLayers.Util.VincentyConstants;var S=z.a,O=z.b,q=z.f;var G=OpenLayers.Util.rad(o.lon-t.lon);var K=Math.atan((1-q)*Math.tan(OpenLayers.Util.rad(t.lat)));var m=Math.atan((1-q)*Math.tan(OpenLayers.Util.rad(o.lat)));var E=Math.sin(K),v=Math.cos(K);var D=Math.sin(m),u=Math.cos(m);
var e=G,I=2*Math.PI;var P=20;while(Math.abs(e-I)>1e-12&&--P>0){var V=Math.sin(e),l=Math.cos(e);var U=Math.sqrt((u*V)*(u*V)+(v*D-E*u*l)*(v*D-E*u*l));if(U==0){return 0;}var h=E*D+v*u*l;var T=Math.atan2(U,h);var w=Math.asin(v*u*V/U);var j=Math.cos(w)*Math.cos(w);var M=h-2*E*D/j;var J=q/16*j*(4+q*(4-3*j));I=e;e=G+(1-J)*q*Math.sin(w)*(T+J*U*(M+J*h*(-1+2*M*M)));}if(P==0){return NaN;}var H=j*(S*S-O*O)/(O*O);var Q=1+H/16384*(4096+H*(-768+H*(320-175*H)));var N=H/1024*(256+H*(-128+H*(74-47*H)));var g=N*U*(M+N/4*(h*(-1+2*M*M)-N/6*M*(-3+4*U*U)*(-3+4*M*M)));var F=O*Q*(T-g);var r=F.toFixed(3)/1000;return r;};OpenLayers.Util.destinationVincenty=function(r,Y,U){var J=OpenLayers.Util;var j=J.VincentyConstants;var aa=j.a,S=j.b,t=j.f;var q=r.lon;var g=r.lat;var Q=U;var T=J.rad(Y);var W=Math.sin(T);var h=Math.cos(T);var V=(1-t)*Math.tan(J.rad(g));var E=1/Math.sqrt((1+V*V)),m=V*E;var M=Math.atan2(V,h);var O=E*W;var d=1-O*O;var G=d*(aa*aa-S*S)/(S*S);var N=1+G/16384*(4096+G*(-768+G*(320-175*G)));var I=G/1024*(256+G*(-128+G*(74-47*G)));var K=Q/(S*N),z=2*Math.PI;while(Math.abs(K-z)>1e-12){var w=Math.cos(2*M+K);var v=Math.sin(K);var Z=Math.cos(K);var P=I*v*(w+I/4*(Z*(-1+2*w*w)-I/6*w*(-3+4*v*v)*(-3+4*w*w)));z=K;K=Q/(S*N)+P;}var l=m*v-E*Z*h;var F=Math.atan2(m*Z+E*v*h,(1-t)*Math.sqrt(O*O+l*l));var H=Math.atan2(v*W,E*Z-m*v*h);var D=t/16*d*(4+t*(4-3*d));var o=H-(1-D)*t*O*(K+D*v*(w+D*Z*(-1+2*w*w)));var e=Math.atan2(O,-l);return new OpenLayers.LonLat(q+J.deg(o),J.deg(F));};OpenLayers.Util.getParameters=function(d){d=d||window.location.href;var b="";if(OpenLayers.String.contains(d,"?")){var f=d.indexOf("?")+1;var h=OpenLayers.String.contains(d,"#")?d.indexOf("#"):d.length;b=d.substring(f,h);}var e={};var g=b.split(/[&;]/);for(var l=0,m=g.length;l<m;++l){var j=g[l].split("=");if(j[0]){var a=decodeURIComponent(j[0]);var o=j[1]||"";o=decodeURIComponent(o.replace(/\+/g," ")).split(",");if(o.length==1){o=o[0];}e[a]=o;}}return e;};OpenLayers.Util.getArgs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"}));return OpenLayers.Util.getParameters(a);};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(a){if(a==null){a="id_";}OpenLayers.Util.lastSeqID+=1;return a+OpenLayers.Util.lastSeqID;};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:OpenLayers.INCHES_PER_UNIT.Meter*100,km:OpenLayers.INCHES_PER_UNIT.Meter*1000,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(b){var a=(b>1)?(1/b):b;return a;};OpenLayers.Util.getResolutionFromScale=function(b,d){var e;if(b){if(d==null){d="degrees";}var a=OpenLayers.Util.normalizeScale(b);e=1/(a*OpenLayers.INCHES_PER_UNIT[d]*OpenLayers.DOTS_PER_INCH);}return e;};OpenLayers.Util.getScaleFromResolution=function(d,b){if(b==null){b="degrees";}var a=d*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH;return a;};OpenLayers.Util.safeStopPropagation=function(a){OpenLayers.Event.stop(a,true);};OpenLayers.Util.pagePosition=function(a){var d=0,h=0;var g=a;var b=a;while(g){if(g==document.body){if(OpenLayers.Element.getStyle(b,"position")=="absolute"){break;}}d+=g.offsetTop||0;h+=g.offsetLeft||0;b=g;try{g=g.offsetParent;}catch(f){OpenLayers.Console.error(OpenLayers.i18n("pagePositionFailed",{elemId:g.id}));break;}}g=a;while(g){d-=g.scrollTop||0;h-=g.scrollLeft||0;g=g.parentNode;}return[h,d];};OpenLayers.Util.isEquivalentUrl=function(b,a,f){f=f||{};OpenLayers.Util.applyDefaults(f,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var e=OpenLayers.Util.createUrlObject(b,f);var d=OpenLayers.Util.createUrlObject(a,f);for(var g in e){if(g!=="args"){if(e[g]!=d[g]){return false;}}}for(var g in e.args){if(e.args[g]!=d.args[g]){return false;}delete d.args[g];}for(var g in d.args){return false;}return true;};OpenLayers.Util.createUrlObject=function(f,g){g=g||{};if(!(/^\w+:\/\//).test(f)){var m=window.location;var j=m.port?":"+m.port:"";var o=m.protocol+"//"+m.host.split(":").shift()+j;if(f.indexOf("/")===0){f=o+f;}else{var l=m.pathname.split("/");l.pop();f=o+l.join("/")+"/"+f;}}if(g.ignoreCase){f=f.toLowerCase();}var b=document.createElement("a");b.href=f;var h={};h.host=b.host.split(":").shift();h.protocol=b.protocol;if(g.ignorePort80){h.port=(b.port=="80"||b.port=="0")?"":b.port;}else{h.port=(b.port==""||b.port=="0")?"80":b.port;
}h.hash=(g.ignoreHash||b.hash==="#")?"":b.hash;var e=b.search;if(!e){var d=f.indexOf("?");e=(d!=-1)?f.substr(d):"";}h.args=OpenLayers.Util.getParameters(e);h.pathname=(b.pathname.charAt(0)=="/")?b.pathname:"/"+b.pathname;return h;};OpenLayers.Util.removeTail=function(e){var a=null;var d=e.indexOf("?");var b=e.indexOf("#");if(d==-1){a=(b!=-1)?e.substr(0,b):e;}else{a=(b!=-1)?e.substr(0,Math.min(d,b)):e.substr(0,d);}return a;};OpenLayers.Util.getBrowserName=function(){var b="";var a=navigator.userAgent.toLowerCase();if(a.indexOf("opera")!=-1){b="opera";}else{if(a.indexOf("msie")!=-1){b="msie";}else{if(a.indexOf("safari")!=-1){b="safari";}else{if(a.indexOf("mozilla")!=-1){if(a.indexOf("firefox")!=-1){b="firefox";}else{b="mozilla";}}}}}return b;};OpenLayers.Util.getRenderedDimensions=function(t,o,q){var r,d;var s=document.createElement("div");s.style.visibility="hidden";var f=(q&&q.containerElement)?q.containerElement:document.body;if(o){if(o.w){r=o.w;s.style.width=r+"px";}else{if(o.h){d=o.h;s.style.height=d+"px";}}}if(q&&q.displayClass){s.className=q.displayClass;}var g=document.createElement("div");g.innerHTML=t;g.style.overflow="visible";if(g.childNodes){for(var b=0,a=g.childNodes.length;b<a;b++){if(!g.childNodes[b].style){continue;}g.childNodes[b].style.overflow="visible";}}s.appendChild(g);f.appendChild(s);var e=false;var m=s.parentNode;while(m&&m.tagName.toLowerCase()!="body"){var j=OpenLayers.Element.getStyle(m,"position");if(j=="absolute"){e=true;break;}else{if(j&&j!="static"){break;}}m=m.parentNode;}if(!e){s.style.position="absolute";}if(!r){r=parseInt(g.scrollWidth);s.style.width=r+"px";}if(!d){d=parseInt(g.scrollHeight);}s.removeChild(g);f.removeChild(s);return new OpenLayers.Size(r,d);};OpenLayers.Util.getScrollbarWidth=function(){var a=OpenLayers.Util._scrollbarWidth;if(a==null){var d=null;var b=null;var e=0;var f=0;d=document.createElement("div");d.style.position="absolute";d.style.top="-1000px";d.style.left="-1000px";d.style.width="100px";d.style.height="50px";d.style.overflow="hidden";b=document.createElement("div");b.style.width="100%";b.style.height="200px";d.appendChild(b);document.body.appendChild(d);e=b.offsetWidth;d.style.overflow="scroll";f=b.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=(e-f);a=OpenLayers.Util._scrollbarWidth;}return a;};OpenLayers.Util.getFormattedLonLat=function(d,g,l){if(!l){l="dms";}var j=Math.abs(d);var e=Math.floor(j);var f=(j-e)/(1/60);var h=f;f=Math.floor(f);var b=(h-f)/(1/60);b=Math.round(b*10);b/=10;if(e<10){e="0"+e;}var a=e+"\u00B0";if(l.indexOf("dm")>=0){if(f<10){f="0"+f;}a+=f+"'";if(l.indexOf("dms")>=0){if(b<10){b="0"+b;}a+=b+'"';}}if(g=="lon"){a+=d<0?OpenLayers.i18n("W"):OpenLayers.i18n("E");}else{a+=d<0?OpenLayers.i18n("S"):OpenLayers.i18n("N");}return a;};OpenLayers.String={startsWith:function(b,a){return(b.indexOf(a)==0);},contains:function(b,a){return(b.indexOf(a)!=-1);},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"");},camelize:function(b){var g=b.split("-");var e=g[0];for(var f=1,d=g.length;f<d;f++){var a=g[f];e+=a.charAt(0).toUpperCase()+a.substring(1);}return e;},format:function(b,a,d){if(!a){a=window;}var e=function(h,g){var f;var l=g.split(/\.+/);for(var j=0;j<l.length;j++){if(j==0){f=a;}f=f[l[j]];}if(typeof f=="function"){f=d?f.apply(null,d):f();}if(typeof f=="undefined"){return"undefined";}else{return f;}};return b.replace(OpenLayers.String.tokenRegEx,e);},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a);},numericIf:function(a){return OpenLayers.String.isNumeric(a)?parseFloat(a):a;}};if(!String.prototype.startsWith){String.prototype.startsWith=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"}));return OpenLayers.String.startsWith(this,a);};}if(!String.prototype.contains){String.prototype.contains=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"}));return OpenLayers.String.contains(this,a);};}if(!String.prototype.trim){String.prototype.trim=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"}));return OpenLayers.String.trim(this);};}if(!String.prototype.camelize){String.prototype.camelize=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"}));return OpenLayers.String.camelize(this);};}OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(b,a){var d=0;if(a>0){d=parseFloat(b.toPrecision(a));}return d;},format:function(h,f,b,e){f=(typeof f!="undefined")?f:0;b=(typeof b!="undefined")?b:OpenLayers.Number.thousandsSeparator;e=(typeof e!="undefined")?e:OpenLayers.Number.decimalSeparator;if(f!=null){h=parseFloat(h.toFixed(f));}var g=h.toString().split(".");if(g.length==1&&f==null){f=0;}var j=g[0];if(b){var l=/(-?[0-9]+)([0-9]{3})/;while(l.test(j)){j=j.replace(l,"$1"+b+"$2");}}var a;if(f==0){a=j;}else{var d=g.length>1?g[1]:"0";if(f!=null){d=d+new Array(f-d.length+1).join("0");}a=j+e+d;}return a;}};if(!Number.prototype.limitSigDigs){Number.prototype.limitSigDigs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"}));return OpenLayers.Number.limitSigDigs(this,a);};}OpenLayers.Function={bind:function(a,d){var b=Array.prototype.slice.apply(arguments,[2]);return function(){var e=b.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(d,e);};},bindAsEventListener:function(b,a){return function(d){return b.call(a,d||window.event);};},False:function(){return false;},True:function(){return true;}};if(!Function.prototype.bind){Function.prototype.bind=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"}));Array.prototype.unshift.apply(arguments,[this]);return OpenLayers.Function.bind.apply(null,arguments);};}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"}));return OpenLayers.Function.bindAsEventListener(this,a);};}OpenLayers.Array={filter:function(a,h,d){var f=[];if(Array.prototype.filter){f=a.filter(h,d);}else{var b=a.length;if(typeof h!="function"){throw new TypeError();}for(var e=0;e<b;e++){if(e in a){var g=a[e];if(h.call(d,g,e,a)){f.push(g);}}}}return f;}};OpenLayers.Date={toISOString:(function(){if("toISOString" in Date.prototype){return function(b){return b.toISOString();};}else{function a(d,b){var e=d+"";while(e.length<b){e="0"+e;}return e;}return function(b){var d;if(isNaN(b.getTime())){d="Invalid Date";}else{d=b.getUTCFullYear()+"-"+a(b.getUTCMonth()+1,2)+"-"+a(b.getUTCDate(),2)+"T"+a(b.getUTCHours(),2)+":"+a(b.getUTCMinutes(),2)+":"+a(b.getUTCSeconds(),2)+"."+a(b.getUTCMilliseconds(),3)+"Z";}return d;};}})(),parse:function(d){var l;var h=Date.parse(d);if(!isNaN(h)){l=new Date(h);}else{var a=d.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))?$/);var l;if(a&&(a[1]||a[7])){var g=parseInt(a[1],10)||0;var b=(parseInt(a[2],10)-1)||0;var r=parseInt(a[3],10)||1;l=new Date(Date.UTC(g,b,r));var o=a[7];if(o){var e=parseInt(a[4],10);var q=parseInt(a[5],10);var j=parseFloat(a[6]);var f=j|0;var m=Math.round(1000*(j-f));l.setUTCHours(e,q,f,m);if(o!=="Z"){var u=parseInt(o,10);var t=parseInt(a[8])||0;var s=-1000*(60*(u*60)+t*60);l=new Date(l.getTime()+s);}}}else{l=new Date("invalid");}}return l;}};OpenLayers.Class=function(){var g=function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments);}};var e={};var a,d,f;for(var h=0,b=arguments.length;h<b;++h){f=arguments[h];if(typeof f=="function"){if(h==0&&b>1){d=f.prototype.initialize;f.prototype.initialize=function(){};e=new f();if(d===undefined){delete f.prototype.initialize;
}else{f.prototype.initialize=d;}}a=f.prototype;}else{a=f;}OpenLayers.Util.extend(e,a);}g.prototype=e;return g;};OpenLayers.Class.isPrototype=function(){};OpenLayers.Class.create=function(){return function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments);}};};OpenLayers.Class.inherit=function(){var b=arguments[0];var d=new b(OpenLayers.Class.isPrototype);for(var a=1,e=arguments.length;a<e;a++){if(typeof arguments[a]=="function"){var f=arguments[a];arguments[a]=new f(OpenLayers.Class.isPrototype);}OpenLayers.Util.extend(d,arguments[a]);}return d;};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(b,d,e,a){if(b!=null){this.left=OpenLayers.Util.toFloat(b);}if(d!=null){this.bottom=OpenLayers.Util.toFloat(d);}if(e!=null){this.right=OpenLayers.Util.toFloat(e);}if(a!=null){this.top=OpenLayers.Util.toFloat(a);}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top);},equals:function(b){var a=false;if(b!=null){a=((this.left==b.left)&&(this.right==b.right)&&(this.top==b.top)&&(this.bottom==b.bottom));}return a;},toString:function(){return("left-bottom=("+this.left+","+this.bottom+") right-top=("+this.right+","+this.top+")");},toArray:function(a){if(a===true){return[this.bottom,this.left,this.top,this.right];}else{return[this.left,this.bottom,this.right,this.top];}},toBBOX:function(d,g){if(d==null){d=6;}var a=Math.pow(10,d);var h=Math.round(this.left*a)/a;var f=Math.round(this.bottom*a)/a;var e=Math.round(this.right*a)/a;var b=Math.round(this.top*a)/a;if(g===true){return f+","+h+","+b+","+e;}else{return h+","+f+","+e+","+b;}},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])]);},getWidth:function(){return(this.right-this.left);},getHeight:function(){return(this.top-this.bottom);},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight());},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2);},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2);}return this.centerLonLat;},scale:function(f,d){if(d==null){d=this.getCenterLonLat();}var a,j;if(d.CLASS_NAME=="OpenLayers.LonLat"){a=d.lon;j=d.lat;}else{a=d.x;j=d.y;}var h=(this.left-a)*f+a;var b=(this.bottom-j)*f+j;var e=(this.right-a)*f+a;var g=(this.top-j)*f+j;return new OpenLayers.Bounds(h,b,e,g);},add:function(b,a){if((b==null)||(a==null)){var d=OpenLayers.i18n("boundsAddError");OpenLayers.Console.error(d);return null;}return new OpenLayers.Bounds(this.left+b,this.bottom+a,this.right+b,this.top+a);},extend:function(a){var b=null;if(a){switch(a.CLASS_NAME){case"OpenLayers.LonLat":b=new OpenLayers.Bounds(a.lon,a.lat,a.lon,a.lat);break;case"OpenLayers.Geometry.Point":b=new OpenLayers.Bounds(a.x,a.y,a.x,a.y);break;case"OpenLayers.Bounds":b=a;break;}if(b){this.centerLonLat=null;if((this.left==null)||(b.left<this.left)){this.left=b.left;}if((this.bottom==null)||(b.bottom<this.bottom)){this.bottom=b.bottom;}if((this.right==null)||(b.right>this.right)){this.right=b.right;}if((this.top==null)||(b.top>this.top)){this.top=b.top;}}}},containsLonLat:function(b,a){return this.contains(b.lon,b.lat,a);},containsPixel:function(b,a){return this.contains(b.x,b.y,a);},contains:function(e,b,d){if(d==null){d=true;}if(e==null||b==null){return false;}e=OpenLayers.Util.toFloat(e);b=OpenLayers.Util.toFloat(b);var a=false;if(d){a=((e>=this.left)&&(e<=this.right)&&(b>=this.bottom)&&(b<=this.top));}else{a=((e>this.left)&&(e<this.right)&&(b>this.bottom)&&(b<this.top));}return a;},intersectsBounds:function(f,b){if(b==null){b=true;}var e=false;var j=(this.left==f.right||this.right==f.left||this.top==f.bottom||this.bottom==f.top);if(b||!j){var h=(((f.bottom>=this.bottom)&&(f.bottom<=this.top))||((this.bottom>=f.bottom)&&(this.bottom<=f.top)));var g=(((f.top>=this.bottom)&&(f.top<=this.top))||((this.top>f.bottom)&&(this.top<f.top)));var d=(((f.left>=this.left)&&(f.left<=this.right))||((this.left>=f.left)&&(this.left<=f.right)));var a=(((f.right>=this.left)&&(f.right<=this.right))||((this.right>=f.left)&&(this.right<=f.right)));e=((h||g)&&(d||a));}return e;},containsBounds:function(a,d,b){if(d==null){d=false;}if(b==null){b=true;}var e=this.contains(a.left,a.bottom,b);var f=this.contains(a.right,a.bottom,b);var h=this.contains(a.left,a.top,b);var g=this.contains(a.right,a.top,b);return(d)?(e||f||h||g):(e&&f&&h&&g);},determineQuadrant:function(a){var d="";var b=this.getCenterLonLat();d+=(a.lat<b.lat)?"b":"t";d+=(a.lon<b.lon)?"l":"r";return d;},transform:function(g,e){this.centerLonLat=null;var a=OpenLayers.Projection.transform({x:this.left,y:this.bottom},g,e);var d=OpenLayers.Projection.transform({x:this.right,y:this.bottom},g,e);var f=OpenLayers.Projection.transform({x:this.left,y:this.top},g,e);var b=OpenLayers.Projection.transform({x:this.right,y:this.top},g,e);this.left=Math.min(a.x,f.x);this.bottom=Math.min(a.y,d.y);this.right=Math.max(d.x,b.x);this.top=Math.max(f.y,b.y);return this;},wrapDateLine:function(e,a){a=a||{};var b=a.leftTolerance||0;var f=a.rightTolerance||0;var d=this.clone();if(e){while(d.left<e.left&&(d.right-f)<=e.left){d=d.add(e.getWidth(),0);}while((d.left+b)>=e.right&&d.right>e.right){d=d.add(-e.getWidth(),0);}}return d;},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(b){var a=b.split(",");return OpenLayers.Bounds.fromArray(a);};OpenLayers.Bounds.fromArray=function(a){return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));};OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0);};OpenLayers.Bounds.oppositeQuadrant=function(a){var b="";b+=(a.charAt(0)=="t")?"b":"t";b+=(a.charAt(1)=="l")?"r":"l";return b;};OpenLayers.Rico=new Object();OpenLayers.Rico.Corner={round:function(b,f){b=OpenLayers.Util.getElement(b);this._setOptions(f);var d=this.options.color;if(this.options.color=="fromElement"){d=this._background(b);}var a=this.options.bgColor;if(this.options.bgColor=="fromParent"){a=this._background(b.offsetParent);}this._roundCornersImpl(b,d,a);},changeColor:function(a,e){a.style.backgroundColor=e;var d=a.parentNode.getElementsByTagName("span");for(var b=0;b<d.length;b++){d[b].style.backgroundColor=e;}},changeOpacity:function(f,b){var g=b;var d="alpha(opacity="+b*100+")";f.style.opacity=g;f.style.filter=d;var e=f.parentNode.getElementsByTagName("span");for(var a=0;a<e.length;a++){e[a].style.opacity=g;e[a].style.filter=d;}},reRound:function(b,a){var e=b.parentNode.childNodes[0];var d=b.parentNode.childNodes[2];b.parentNode.removeChild(e);b.parentNode.removeChild(d);this.round(b.parentNode,a);},_roundCornersImpl:function(a,b,d){if(this.options.border){this._renderBorder(a,d);}if(this._isTopRounded()){this._roundTopCorners(a,b,d);}if(this._isBottomRounded()){this._roundBottomCorners(a,b,d);}},_renderBorder:function(g,a){var e="1px solid "+this._borderColor(a);var d="border-left: "+e;var b="border-right: "+e;var f="style='"+d+";"+b+"'";g.innerHTML="<div "+f+">"+g.innerHTML+"</div>";},_roundTopCorners:function(a,e,d){var b=this._createCorner(d);for(var f=0;f<this.options.numSlices;f++){b.appendChild(this._createCornerSlice(e,d,f,"top"));}a.style.paddingTop=0;a.insertBefore(b,a.firstChild);},_roundBottomCorners:function(a,e,d){var b=this._createCorner(d);for(var f=(this.options.numSlices-1);f>=0;f--){b.appendChild(this._createCornerSlice(e,d,f,"bottom"));}a.style.paddingBottom=0;a.appendChild(b);},_createCorner:function(b){var a=document.createElement("div");a.style.backgroundColor=(this._isTransparent()?"transparent":b);return a;},_createCornerSlice:function(e,f,a,b){var g=document.createElement("span");
var d=g.style;d.backgroundColor=e;d.display="block";d.height="1px";d.overflow="hidden";d.fontSize="1px";var h=this._borderColor(e,f);if(this.options.border&&a==0){d.borderTopStyle="solid";d.borderTopWidth="1px";d.borderLeftWidth="0px";d.borderRightWidth="0px";d.borderBottomWidth="0px";d.height="0px";d.borderColor=h;}else{if(h){d.borderColor=h;d.borderStyle="solid";d.borderWidth="0px 1px";}}if(!this.options.compact&&(a==(this.options.numSlices-1))){d.height="2px";}this._setMargin(g,a,b);this._setBorder(g,a,b);return g;},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};OpenLayers.Util.extend(this.options,a||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent()){this.options.blend=false;}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return"";}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return"";}if(this.options.corners.indexOf("tl")>=0){return"left";}else{if(this.options.corners.indexOf("tr")>=0){return"right";}}return"";},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return"";}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return"";}if(this.options.corners.indexOf("bl")>=0){return"left";}else{if(this.options.corners.indexOf("br")>=0){return"right";}}return"";},_borderColor:function(a,b){if(a=="transparent"){return b;}else{if(this.options.border){return this.options.border;}else{if(this.options.blend){return this._blend(b,a);}else{return"";}}}},_setMargin:function(b,d,f){var a=this._marginSize(d);var e=f=="top"?this._whichSideTop():this._whichSideBottom();if(e=="left"){b.style.marginLeft=a+"px";b.style.marginRight="0px";}else{if(e=="right"){b.style.marginRight=a+"px";b.style.marginLeft="0px";}else{b.style.marginLeft=a+"px";b.style.marginRight=a+"px";}}},_setBorder:function(b,d,f){var a=this._borderSize(d);var e=f=="top"?this._whichSideTop():this._whichSideBottom();if(e=="left"){b.style.borderLeftWidth=a+"px";b.style.borderRightWidth="0px";}else{if(e=="right"){b.style.borderRightWidth=a+"px";b.style.borderLeftWidth="0px";}else{b.style.borderLeftWidth=a+"px";b.style.borderRightWidth=a+"px";}}if(this.options.border!=false){b.style.borderLeftWidth=a+"px";b.style.borderRightWidth=a+"px";}},_marginSize:function(d){if(this._isTransparent()){return 0;}var b=[5,3,2,1];var e=[3,2,1,0];var a=[2,1];var f=[1,0];if(this.options.compact&&this.options.blend){return f[d];}else{if(this.options.compact){return a[d];}else{if(this.options.blend){return e[d];}else{return b[d];}}}},_borderSize:function(d){var b=[5,3,2,1];var f=[2,1,1,1];var e=[1,0];var a=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1;}else{if(this.options.compact){return e[d];}else{if(this.options.blend){return f[d];}else{if(this.options.border){return a[d];}else{if(this._isTransparent()){return b[d];}}}}}return 0;},_hasString:function(b){for(var a=1;a<arguments.length;a++){if(b.indexOf(arguments[a])>=0){return true;}}return false;},_blend:function(a,b){var d=OpenLayers.Rico.Color.createFromHex(a);d.blend(OpenLayers.Rico.Color.createFromHex(b));return d;},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex();}catch(b){return"#ffffff";}},_isTransparent:function(){return this.options.color=="transparent";},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr");},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br");},_hasSingleTextChild:function(a){return a.childNodes.length==1&&a.childNodes[0].nodeType==3;}};OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a);},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){var d=document.getElementsByTagName("script");for(var a=0,b=d.length;a<b;++a){if(d[a].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);break;}}}})();OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a;},destroy:function(){},read:function(a){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"));},write:function(a){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"));},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.CSWGetRecords=function(b){b=OpenLayers.Util.applyDefaults(b,OpenLayers.Format.CSWGetRecords.DEFAULTS);var a=OpenLayers.Format.CSWGetRecords["v"+b.version.replace(/\./g,"_")];if(!a){throw"Unsupported CSWGetRecords version: "+b.version;}return new a(b);};OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};OpenLayers.Event={observers:false,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement;},isLeftClick:function(a){return(((a.which)&&(a.which==1))||((a.button)&&(a.button==1)));},isRightClick:function(a){return(((a.which)&&(a.which==3))||((a.button)&&(a.button==2)));},stop:function(b,a){if(!a){if(b.preventDefault){b.preventDefault();}else{b.returnValue=false;}}if(b.stopPropagation){b.stopPropagation();}else{b.cancelBubble=true;}},findElement:function(a,d){var b=OpenLayers.Event.element(a);while(b.parentNode&&(!b.tagName||(b.tagName.toUpperCase()!=d.toUpperCase()))){b=b.parentNode;}return b;},observe:function(d,f,e,b){var g=OpenLayers.Util.getElement(d);b=b||false;if(f=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||g.attachEvent)){f="keydown";}if(!this.observers){this.observers={};}if(!g._eventCacheID){var h="eventCacheID_";if(g.id){h=g.id+"_"+h;}g._eventCacheID=OpenLayers.Util.createUniqueID(h);}var a=g._eventCacheID;if(!this.observers[a]){this.observers[a]=[];}this.observers[a].push({element:g,name:f,observer:e,useCapture:b});if(g.addEventListener){g.addEventListener(f,e,b);}else{if(g.attachEvent){g.attachEvent("on"+f,e);}}},stopObservingElement:function(b){var d=OpenLayers.Util.getElement(b);var a=d._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[a]);},_removeElementObservers:function(d){if(d){for(var f=d.length-1;f>=0;f--){var a=d[f];var e=new Array(a.element,a.name,a.observer,a.useCapture);var b=OpenLayers.Event.stopObserving.apply(this,e);}}},stopObserving:function(a,d,m,f){f=f||false;var l=OpenLayers.Util.getElement(a);var h=l._eventCacheID;if(d=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||l.detachEvent){d="keydown";}}var e=false;var g=OpenLayers.Event.observers[h];if(g){var j=0;while(!e&&j<g.length){var b=g[j];if((b.name==d)&&(b.observer==m)&&(b.useCapture==f)){g.splice(j,1);if(g.length==0){delete OpenLayers.Event.observers[h];}e=true;break;}j++;}}if(e){if(l.removeEventListener){l.removeEventListener(d,m,f);}else{if(l&&l.detachEvent){l.detachEvent("on"+d,m);}}}return e;},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b]);}OpenLayers.Event.observers=false;}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);if(window.Event){OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event);}else{var Event=OpenLayers.Event;}OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:false,clearMouseListener:null,initialize:function(e,g,a,h,d){OpenLayers.Util.extend(this,d);
this.object=e;this.fallThrough=h;this.listeners={};this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this);this.eventTypes=[];if(a!=null){for(var f=0,b=a.length;f<b;f++){this.addEventType(a[f]);}}if(g!=null){this.attachToElement(g);}},destroy:function(){if(this.element){OpenLayers.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener);}}this.element=null;this.listeners=null;this.object=null;this.eventTypes=null;this.fallThrough=null;this.eventHandler=null;},addEventType:function(a){if(!this.listeners[a]){this.eventTypes.push(a);this.listeners[a]=[];}},attachToElement:function(b){if(this.element){OpenLayers.Event.stopObservingElement(this.element);}this.element=b;for(var a=0,d=this.BROWSER_EVENTS.length;a<d;a++){var e=this.BROWSER_EVENTS[a];this.addEventType(e);OpenLayers.Event.observe(b,e,this.eventHandler);}OpenLayers.Event.observe(b,"dragstart",OpenLayers.Event.stop);},on:function(a){for(var b in a){if(b!="scope"){this.register(b,a.scope,a[b]);}}},register:function(e,b,a){if((a!=null)&&(OpenLayers.Util.indexOf(this.eventTypes,e)!=-1)){if(b==null){b=this.object;}var d=this.listeners[e];d.push({obj:b,func:a});}},registerPriority:function(e,b,a){if(a!=null){if(b==null){b=this.object;}var d=this.listeners[e];if(d!=null){d.unshift({obj:b,func:a});}}},un:function(a){for(var b in a){if(b!="scope"){this.unregister(b,a.scope,a[b]);}}},unregister:function(g,b,a){if(b==null){b=this.object;}var f=this.listeners[g];if(f!=null){for(var e=0,d=f.length;e<d;e++){if(f[e].obj==b&&f[e].func==a){f.splice(e,1);break;}}}},remove:function(a){if(this.listeners[a]!=null){this.listeners[a]=[];}},triggerEvent:function(g,d){var f=this.listeners[g];if(!f||f.length==0){return;}if(d==null){d={};}d.object=this.object;d.element=this.element;if(!d.type){d.type=g;}var f=f.slice(),h;for(var e=0,b=f.length;e<b;e++){var a=f[e];h=a.func.apply(a.obj,[d]);if((h!=undefined)&&(h==false)){break;}}if(!this.fallThrough){OpenLayers.Event.stop(d,true);}return h;},handleBrowserEvent:function(a){if(this.includeXY){a.xy=this.getMousePosition(a);}this.triggerEvent(a.type,a);},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null;},getMousePosition:function(a){if(!this.includeXY){this.clearMouseCache();}else{if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true;}}if(!this.element.scrolls){this.element.scrolls=[(document.documentElement.scrollLeft||document.body.scrollLeft),(document.documentElement.scrollTop||document.body.scrollTop)];}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)];}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element);this.element.offsets[0]+=this.element.scrolls[0];this.element.offsets[1]+=this.element.scrolls[1];}return new OpenLayers.Pixel((a.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(a.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1]);},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,f,b,a){this.url=e;this.size=(f)?f:new OpenLayers.Size(20,20);this.offset=b?b:new OpenLayers.Pixel(-(this.size.w/2),-(this.size.h/2));this.calculateOffset=a;var d=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(d);},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null;},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset);},setSize:function(a){if(a!=null){this.size=a;}this.draw();},setUrl:function(a){if(a!=null){this.url=a;}this.draw();},draw:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(a);return this.imageDiv;},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){OpenLayers.Element.remove(this.imageDiv);}},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a);},moveTo:function(a){if(a!=null){this.px=a;}if(this.imageDiv!=null){if(this.px==null){this.display(false);}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size);}var b=this.px.offset(this.offset);OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,b);}}},display:function(a){this.imageDiv.style.display=(a)?"":"none";},isDrawn:function(){var a=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));return a;},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(a,d){this.lonlat=a;var b=(d)?d:OpenLayers.Marker.defaultIcon();if(this.icon==null){this.icon=b;}else{this.icon.url=b.url;this.icon.size=b.size;this.icon.offset=b.offset;this.icon.calculateOffset=b.calculateOffset;}this.events=new OpenLayers.Events(this,this.icon.imageDiv,null);},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null;}},draw:function(a){return this.icon.draw(a);},erase:function(){if(this.icon!=null){this.icon.erase();}},moveTo:function(a){if((a!=null)&&(this.icon!=null)){this.icon.moveTo(a);}this.lonlat=this.map.getLonLatFromLayerPx(a);},isDrawn:function(){var a=(this.icon&&this.icon.isDrawn());return a;},onScreen:function(){var b=false;if(this.map){var a=this.map.getExtent();b=a.containsLonLat(this.lonlat);}return b;},inflate:function(b){if(this.icon){var a=new OpenLayers.Size(this.icon.size.w*b,this.icon.size.h*b);this.icon.setSize(a);}},setOpacity:function(a){this.icon.setOpacity(a);},setUrl:function(a){this.icon.setUrl(a);},display:function(a){this.icon.display(a);},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){var b=OpenLayers.Util.getImagesLocation()+"marker.png";var d=new OpenLayers.Size(21,25);var a=function(e){return new OpenLayers.Pixel(-(e.w/2),-e.h);};return new OpenLayers.Icon(b,d,null,a);};OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding);}},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,initialize:function(a,e,h,d,g,f){if(a==null){a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");}this.id=a;this.lonlat=e;this.contentSize=(h!=null)?h:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);if(d!=null){this.contentHTML=d;}this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var b=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(b,null,null,null,"relative",null,"hidden");var a=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(a,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);if(g){this.addCloseBox(f);}this.registerEvents();},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide);
}this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv);}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;if(this.map!=null){this.map.removePopup(this);}this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null;},draw:function(a){if(a==null){if((this.lonlat!=null)&&(this.map!=null)){a=this.map.getLayerPxFromLonLat(this.lonlat);}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide);}if(!this.disableFirefoxOverflowHack&&OpenLayers.Util.getBrowserName()=="firefox"){this.map.events.register("movestart",this,function(){var b=document.defaultView.getComputedStyle(this.contentDiv,null);var d=b.getPropertyValue("overflow");if(d!="hidden"){this.contentDiv._oldOverflow=d;this.contentDiv.style.overflow="hidden";}});this.map.events.register("moveend",this,function(){var b=this.contentDiv._oldOverflow;if(b){this.contentDiv.style.overflow=b;this.contentDiv._oldOverflow=null;}});}this.moveTo(a);if(!this.autoSize&&!this.size){this.setSize(this.contentSize);}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView();}return this.div;},updatePosition:function(){if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);if(a){this.moveTo(a);}}},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px";}},visible:function(){return OpenLayers.Element.visible(this.div);},toggle:function(){if(this.visible()){this.hide();}else{this.show();}},show:function(){OpenLayers.Element.show(this.div);if(this.panMapIfOutOfView){this.panIntoView();}},hide:function(){OpenLayers.Element.hide(this.div);},setSize:function(a){this.size=a.clone();var f=this.getContentDivPadding();var e=f.left+f.right;var d=f.top+f.bottom;this.fixPadding();e+=this.padding.left+this.padding.right;d+=this.padding.top+this.padding.bottom;if(this.closeDiv){var b=parseInt(this.closeDiv.style.width);e+=b+f.right;}this.size.w+=e;this.size.h+=d;if(OpenLayers.Util.getBrowserName()=="msie"){this.contentSize.w+=f.left+f.right;this.contentSize.h+=f.bottom+f.top;}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px";}if(this.contentDiv!=null){this.contentDiv.style.width=a.w+"px";this.contentDiv.style.height=a.h+"px";}},updateSize:function(){var l="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var d=(this.map)?this.map.layerContainerDiv:document.body;var e=OpenLayers.Util.getRenderedDimensions(l,null,{displayClass:this.displayClass,containerElement:d});var b=this.getSafeContentSize(e);var a=null;if(b.equals(e)){a=e;}else{var g=new OpenLayers.Size();g.w=(b.w<e.w)?b.w:null;g.h=(b.h<e.h)?b.h:null;if(g.w&&g.h){a=b;}else{var j=OpenLayers.Util.getRenderedDimensions(l,g,{displayClass:this.contentDisplayClass,containerElement:d});var h=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if((h!="hidden")&&(j.equals(b))){var f=OpenLayers.Util.getScrollbarWidth();if(g.w){j.h+=f;}else{j.w+=f;}}a=this.getSafeContentSize(j);}}this.setSize(a);},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a;}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor;}},setOpacity:function(a){if(a!=undefined){this.opacity=a;}if(this.div!=null){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+this.opacity*100+")";}},setBorder:function(a){if(a!=undefined){this.border=a;}if(this.div!=null){this.div.style.border=this.border;}},setContentHTML:function(a){if(a!=null){this.contentHTML=a;}if((this.contentDiv!=null)&&(this.contentHTML!=null)&&(this.contentHTML!=this.contentDiv.innerHTML)){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize();}}},registerImageListeners:function(){var b=function(){this.popup.updateSize();if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView();}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad);};var e=this.contentDiv.getElementsByTagName("img");for(var a=0,d=e.length;a<d;a++){var f=e[a];if(f.width==0||f.height==0){var g={popup:this,img:f};f._onImgLoad=OpenLayers.Function.bind(b,g);OpenLayers.Event.observe(f,"load",f._onImgLoad);}}},getSafeContentSize:function(e){var g=e.clone();var o=this.getContentDivPadding();var b=o.left+o.right;var l=o.top+o.bottom;this.fixPadding();b+=this.padding.left+this.padding.right;l+=this.padding.top+this.padding.bottom;if(this.closeDiv){var f=parseInt(this.closeDiv.style.width);b+=f+o.right;}if(this.minSize){g.w=Math.max(g.w,(this.minSize.w-b));g.h=Math.max(g.h,(this.minSize.h-l));}if(this.maxSize){g.w=Math.min(g.w,(this.maxSize.w-b));g.h=Math.min(g.h,(this.maxSize.h-l));}if(this.map&&this.map.size){var j=0,h=0;if(this.keepInMap&&!this.panMapIfOutOfView){var m=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":j=m.x;h=this.map.size.h-m.y;break;case"tl":j=this.map.size.w-m.x;h=this.map.size.h-m.y;break;case"bl":j=this.map.size.w-m.x;h=m.y;break;case"br":j=m.x;h=m.y;break;default:j=m.x;h=this.map.size.h-m.y;break;}}var a=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-l-h;var d=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-b-j;g.w=Math.min(g.w,d);g.h=Math.min(g.h,a);}return g;},getContentDivPadding:function(){var a=this._contentDivPadding;if(!a){if(this.div.parentNode==null){this.div.style.display="none";document.body.appendChild(this.div);}a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=a;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display="";}}return a;},addCloseBox:function(a){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17));this.closeDiv.className="olPopupCloseBox";var d=this.getContentDivPadding();this.closeDiv.style.right=d.right+"px";this.closeDiv.style.top=d.top+"px";this.groupDiv.appendChild(this.closeDiv);var b=a||function(e){this.hide();OpenLayers.Event.stop(e);};OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(b,this));},panIntoView:function(){var d=this.map.getSize();var b=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));var a=b.clone();if(b.x<this.map.paddingForPopups.left){a.x=this.map.paddingForPopups.left;}else{if((b.x+this.size.w)>(d.w-this.map.paddingForPopups.right)){a.x=d.w-this.map.paddingForPopups.right-this.size.w;}}if(b.y<this.map.paddingForPopups.top){a.y=this.map.paddingForPopups.top;}else{if((b.y+this.size.h)>(d.h-this.map.paddingForPopups.bottom)){a.y=d.h-this.map.paddingForPopups.bottom-this.size.h;}}var f=b.x-a.x;var e=b.y-a.y;this.map.pan(f,e);},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,true);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,scope:this});},onmousedown:function(a){this.mousedown=true;OpenLayers.Event.stop(a,true);},onmousemove:function(a){if(this.mousedown){OpenLayers.Event.stop(a,true);}},onmouseup:function(a){if(this.mousedown){this.mousedown=false;OpenLayers.Event.stop(a,true);}},onclick:function(a){OpenLayers.Event.stop(a,true);},onmouseout:function(a){this.mousedown=false;},ondblclick:function(a){OpenLayers.Event.stop(a,true);},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:true,anchor:null,initialize:function(j,e,h,d,b,g,f){var a=[j,e,h,d,g,f];
OpenLayers.Popup.prototype.initialize.apply(this,a);this.anchor=(b!=null)?b:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)};},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments);},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments);},moveTo:function(a){var e=this.relativePosition;this.relativePosition=this.calculateRelativePosition(a);var b=this.calculateNewPx(a);var d=new Array(b);OpenLayers.Popup.prototype.moveTo.apply(this,d);if(this.relativePosition!=e){this.updateRelativePosition();}},setSize:function(b){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(a);}},calculateRelativePosition:function(e){var b=this.map.getLonLatFromLayerPx(e);var a=this.map.getExtent();var d=a.determineQuadrant(b);return OpenLayers.Bounds.oppositeQuadrant(d);},updateRelativePosition:function(){},calculateNewPx:function(f){var d=f.offset(this.anchor.offset);var e=this.size||this.contentSize;var b=(this.relativePosition.charAt(0)=="t");d.y+=(b)?-(e.h+this.anchor.size.h):this.anchor.size.h;var a=(this.relativePosition.charAt(1)=="l");d.x+=(a)?-(e.w+this.anchor.size.w):this.anchor.size.w;return d;},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:false,initialize:function(a,e,h,d,b,g,f){this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);},draw:function(a){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);this.setContentHTML();this.setBackgroundColor();this.setOpacity();return this.div;},updateRelativePosition:function(){this.setRicoCorners();},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.setRicoCorners();},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a;}if(this.div!=null){if(this.contentDiv!=null){this.div.style.background="transparent";OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor);}}},setOpacity:function(a){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,a);if(this.div!=null){if(this.groupDiv!=null){OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity);}}},setBorder:function(a){this.border=0;},setRicoCorners:function(){var a=this.getCornersToRound(this.relativePosition);var b={corners:a,color:this.backgroundColor,bgColor:"transparent",blend:false};if(!this.rounded){OpenLayers.Rico.Corner.round(this.div,b);this.rounded=true;}else{OpenLayers.Rico.Corner.reRound(this.groupDiv,b);this.setBackgroundColor();this.setOpacity();}},getCornersToRound:function(){var a=["tl","tr","bl","br"];var b=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);OpenLayers.Util.removeItem(a,b);return a.join(" ");},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:OpenLayers.Popup.AnchoredBubble,popup:null,initialize:function(b,a,d){this.layer=b;this.lonlat=a;this.data=(d!=null)?d:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup);}}if(this.layer!=null&&this.marker!=null){this.layer.removeMarker(this.marker);}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null;}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null;}},onScreen:function(){var b=false;if((this.layer!=null)&&(this.layer.map!=null)){var a=this.layer.map.getExtent();b=a.containsLonLat(this.lonlat);}return b;},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon);}return this.marker;},destroyMarker:function(){this.marker.destroy();},createPopup:function(d){if(this.lonlat!=null){var a=this.id+"_popup";var b=(this.marker)?this.marker.icon:null;if(!this.popup){this.popup=new this.popupClass(a,this.lonlat,this.data.popupSize,this.data.popupContentHTML,b,d);}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow;}this.popup.feature=this;}return this.popup;},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null;}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",initialize:function(a,b,d){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,b]);this.lonlat=null;this.geometry=a?a:null;this.state=null;this.attributes={};if(b){this.attributes=OpenLayers.Util.extend(this.attributes,b);}this.style=d?d:null;},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null;}this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments);},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style);},onScreen:function(b){var a=false;if(this.layer&&this.layer.map){var e=this.layer.map.getExtent();if(b){var f=this.geometry.getBounds();a=e.intersectsBounds(f);}else{var d=e.toGeometry();a=d.intersects(this.geometry);}}return a;},getVisibility:function(){return !(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility());},createMarker:function(){return null;},destroyMarker:function(){},createPopup:function(){return null;},atPoint:function(e,b,a){var d=false;if(this.geometry){d=this.geometry.atPoint(e,b,a);}return d;},destroyPopup:function(){},move:function(d){if(!this.layer||!this.geometry.move){return;}var e;if(d.CLASS_NAME=="OpenLayers.LonLat"){e=this.layer.getViewPortPxFromLonLat(d);}else{e=d;}var b=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var a=this.layer.map.getResolution();this.geometry.move(a*(e.x-b.x),a*(b.y-e.y));this.layer.drawFeature(this);return b;},toState:function(a){if(a==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break;}}else{if(a==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a;break;}}else{if(a==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a;break;}}else{if(a==OpenLayers.State.UNKNOWN){this.state=a;}}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}};
OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM");}OpenLayers.Format.prototype.initialize.apply(this,[a]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var b in this.namespaces){this.namespaceAlias[this.namespaces[b]]=b;}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments);},setNamespace:function(a,b){this.namespaces[a]=b;this.namespaceAlias[b]=a;},read:function(a){var b=a.indexOf("<");if(b>0){a=a.substring(b);}var d=OpenLayers.Util.Try(OpenLayers.Function.bind((function(){var e;if(window.ActiveXObject&&!this.xmldom){e=new ActiveXObject("Microsoft.XMLDOM");}else{e=this.xmldom;}e.loadXML(a);return e;}),this),function(){return new DOMParser().parseFromString(a,"text/xml");},function(){var e=new XMLHttpRequest();e.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(a),false);if(e.overrideMimeType){e.overrideMimeType("text/xml");}e.send(null);return e.responseXML;});if(this.keepData){this.data=d;}return d;},write:function(e){var a;if(this.xmldom){a=e.xml;}else{var d=new XMLSerializer();if(e.nodeType==1){var b=document.implementation.createDocument("","",null);if(b.importNode){e=b.importNode(e,true);}b.appendChild(e);a=d.serializeToString(b);}else{a=d.serializeToString(e);}}return a;},createElementNS:function(a,b){var d;if(this.xmldom){if(typeof a=="string"){d=this.xmldom.createNode(1,b,a);}else{d=this.xmldom.createNode(1,b,"");}}else{d=document.createElementNS(a,b);}return d;},createTextNode:function(b){var a;if(typeof b!=="string"){b=String(b);}if(this.xmldom){a=this.xmldom.createTextNode(b);}else{a=document.createTextNode(b);}return a;},getElementsByTagNameNS:function(l,j,h){var f=[];if(l.getElementsByTagNameNS){f=l.getElementsByTagNameNS(j,h);}else{var g=l.getElementsByTagName("*");var e,a;for(var b=0,d=g.length;b<d;++b){e=g[b];a=(e.prefix)?(e.prefix+":"+h):h;if((h=="*")||(a==e.nodeName)){if((j=="*")||(j==e.namespaceURI)){f.push(e);}}}}return f;},getAttributeNodeNS:function(h,g,f){var e=null;if(h.getAttributeNodeNS){e=h.getAttributeNodeNS(g,f);}else{var l=h.attributes;var d,j;for(var a=0,b=l.length;a<b;++a){d=l[a];if(d.namespaceURI==g){j=(d.prefix)?(d.prefix+":"+f):f;if(j==d.nodeName){e=d;break;}}}}return e;},getAttributeNS:function(d,b,e){var f="";if(d.getAttributeNS){f=d.getAttributeNS(b,e)||"";}else{var a=this.getAttributeNodeNS(d,b,e);if(a){f=a.nodeValue;}}return f;},getChildValue:function(d,a){var e=a||"";if(d){for(var b=d.firstChild;b;b=b.nextSibling){switch(b.nodeType){case 3:case 4:e+=b.nodeValue;}}}return e;},concatChildValues:function(f,b){var a="";var d=f.firstChild;var e;while(d){e=d.nodeValue;if(e){a+=e;}d=d.nextSibling;}if(a==""&&b!=undefined){a=b;}return a;},isSimpleContent:function(b){var a=true;for(var d=b.firstChild;d;d=d.nextSibling){if(d.nodeType===1){a=false;break;}}return a;},contentType:function(a){var d=false,f=false;var e=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(var b=a.firstChild;b;b=b.nextSibling){switch(b.nodeType){case 1:f=true;break;case 8:break;default:d=true;}if(f&&d){break;}}if(f&&d){e=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;}else{if(f){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;}else{if(d){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE;}}}return e;},hasAttributeNS:function(a,e,d){var b=false;if(a.hasAttributeNS){b=a.hasAttributeNS(e,d);}else{b=!!this.getAttributeNodeNS(a,e,d);}return b;},setAttributeNS:function(b,a,e,d){if(b.setAttributeNS){b.setAttributeNS(a,e,d);}else{if(this.xmldom){if(a){var f=b.ownerDocument.createNode(2,e,a);f.nodeValue=d;b.setAttributeNode(f);}else{b.setAttribute(e,d);}}else{throw"setAttributeNS not implemented";}}},createElementNSPlus:function(e,d){d=d||{};var g=d.uri||this.namespaces[d.prefix];if(!g){var b=e.indexOf(":");g=this.namespaces[e.substring(0,b)];}if(!g){g=this.namespaces[this.defaultPrefix];}var f=this.createElementNS(g,e);if(d.attributes){this.setAttributes(f,d.attributes);}var a=d.value;if(a!=null){f.appendChild(this.createTextNode(a));}return f;},setAttributes:function(a,d){var b,f;for(var e in d){if(d[e]!=null&&d[e].toString){b=d[e].toString();f=this.namespaces[e.substring(0,e.indexOf(":"))]||null;this.setAttributeNS(a,f,e,b);}}},readNode:function(a,d){if(!d){d={};}var b=this.readers[a.namespaceURI?this.namespaceAlias[a.namespaceURI]:this.defaultPrefix];if(b){var f=a.localName||a.nodeName.split(":").pop();var e=b[f]||b["*"];if(e){e.apply(this,[a,d]);}}return d;},readChildNodes:function(g,a){if(!a){a={};}var f=g.childNodes;var b;for(var e=0,d=f.length;e<d;++e){b=f[e];if(b.nodeType==1){this.readNode(b,a);}}return a;},writeNode:function(b,h,f){var g,e;var d=b.indexOf(":");if(d>0){g=b.substring(0,d);e=b.substring(d+1);}else{if(f){g=this.namespaceAlias[f.namespaceURI];}else{g=this.defaultPrefix;}e=b;}var a=this.writers[g][e].apply(this,[h]);if(f){f.appendChild(a);}return a;},getChildEl:function(a,b,d){return a&&this.getThisOrNextEl(a.firstChild,b,d);},getNextEl:function(a,b,d){return a&&this.getThisOrNextEl(a.nextSibling,b,d);},getThisOrNextEl:function(b,d,a){outer:for(var e=b;e;e=e.nextSibling){switch(e.nodeType){case 1:if((!d||d===(e.localName||e.nodeName.split(":").pop()))&&(!a||a===e.namespaceURI)){break outer;}e=null;break outer;case 3:if(/^\s*$/.test(e.nodeValue)){break;}case 4:case 6:case 12:case 10:case 11:e=null;break outer;}}return e||null;},lookupNamespaceURI:function(a,b){var g=null;if(a){if(a.lookupNamespaceURI){g=a.lookupNamespaceURI(b);}else{outer:switch(a.nodeType){case 1:if(a.namespaceURI!==null&&a.prefix===b){g=a.namespaceURI;break outer;}var e=a.attributes.length;if(e){var d;for(var f=0;f<e;++f){d=a.attributes[f];if(d.prefix==="xmlns"&&d.name==="xmlns:"+b){g=d.value||null;break outer;}else{if(d.name==="xmlns"&&b===null){g=d.value||null;break outer;}}}}g=this.lookupNamespaceURI(a.parentNode,b);break outer;case 2:g=this.lookupNamespaceURI(a.ownerElement,b);break outer;case 9:g=this.lookupNamespaceURI(a.documentElement,b);break outer;case 6:case 12:case 10:case 11:break outer;default:g=this.lookupNamespaceURI(a.parentNode,b);break outer;}}}return g;},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);if(!OpenLayers.Format.OWSCommon){OpenLayers.Format.OWSCommon={};}OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},readers:{ows:{ServiceIdentification:function(a,b){b.serviceIdentification={};this.readChildNodes(a,b.serviceIdentification);},Title:function(a,b){b.title=this.getChildValue(a);},Abstract:function(a,b){b["abstract"]=this.getChildValue(a);},Keywords:function(a,b){b.keywords={};this.readChildNodes(a,b.keywords);},Keyword:function(b,a){a[this.getChildValue(b)]=true;},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)};},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=this.getChildValue(a);},Fees:function(a,b){b.fees=this.getChildValue(a);},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a);},ServiceProvider:function(a,b){b.serviceProvider={};this.readChildNodes(a,b.serviceProvider);},ProviderName:function(a,b){b.providerName=this.getChildValue(a);},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href");},ServiceContact:function(a,b){b.serviceContact={};this.readChildNodes(a,b.serviceContact);},IndividualName:function(b,a){a.individualName=this.getChildValue(b);},PositionName:function(b,a){a.positionName=this.getChildValue(b);},ContactInfo:function(b,a){a.contactInfo={};this.readChildNodes(b,a.contactInfo);},Phone:function(b,a){a.phone={};
this.readChildNodes(b,a.phone);},Voice:function(b,a){a.voice=this.getChildValue(b);},Address:function(b,a){a.address={};this.readChildNodes(b,a.address);},DeliveryPoint:function(b,a){a.deliveryPoint=this.getChildValue(b);},City:function(b,a){a.city=this.getChildValue(b);},AdministrativeArea:function(b,a){a.administrativeArea=this.getChildValue(b);},PostalCode:function(b,a){a.postalCode=this.getChildValue(b);},Country:function(b,a){a.country=this.getChildValue(b);},ElectronicMailAddress:function(b,a){a.electronicMailAddress=this.getChildValue(b);},Role:function(b,a){a.role=this.getChildValue(b);},OperationsMetadata:function(a,b){b.operationsMetadata={};this.readChildNodes(a,b.operationsMetadata);},Operation:function(a,d){var b=a.getAttribute("name");d[b]={};this.readChildNodes(a,d[b]);},DCP:function(b,a){a.dcp={};this.readChildNodes(b,a.dcp);},HTTP:function(b,a){a.http={};this.readChildNodes(b,a.http);},Get:function(b,a){a.get=this.getAttributeNS(b,this.namespaces.xlink,"href");},Post:function(b,a){a.post=this.getAttributeNS(b,this.namespaces.xlink,"href");},Parameter:function(a,b){if(!b.parameters){b.parameters={};}var d=a.getAttribute("name");b.parameters[d]={};this.readChildNodes(a,b.parameters[d]);},Value:function(a,b){b[this.getChildValue(a)]=true;},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)});this.readChildNodes(a,b);},WGS84BoundingBox:function(d,a){var b={};b.crs=d.getAttribute("crs");if(a.BoundingBox){a.BoundingBox.push(b);}else{a.projection=b.crs;b=a;}this.readChildNodes(d,b);},BoundingBox:function(a,b){this.readers.ows.WGS84BoundingBox.apply(this,[a,b]);},LowerCorner:function(e,a){var b=this.getChildValue(e).replace(this.regExes.trimSpace,"");b=b.replace(this.regExes.trimComma,",");var d=b.split(this.regExes.splitSpace);a.left=d[0];a.bottom=d[1];},UpperCorner:function(e,a){var b=this.getChildValue(e).replace(this.regExes.trimSpace,"");b=b.replace(this.regExes.trimComma,",");var d=b.split(this.regExes.splitSpace);a.right=d[0];a.top=d[1];a.bounds=new OpenLayers.Bounds(a.left,a.bottom,a.right,a.top);delete a.left;delete a.bottom;delete a.right;delete a.top;}}},writers:{ows:{BoundingBox:function(a){var b=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:a.projection}});this.writeNode("ows:LowerCorner",a,b);this.writeNode("ows:UpperCorner",a,b);return b;},LowerCorner:function(a){var b=this.createElementNSPlus("ows:LowerCorner",{value:a.bounds.left+" "+a.bounds.bottom});return b;},UpperCorner:function(a){var b=this.createElementNSPlus("ows:UpperCorner",{value:a.bounds.right+" "+a.bounds.top});return b;},Title:function(b){var a=this.createElementNSPlus("ows:Title",{value:b});return a;},OutputFormat:function(b){var a=this.createElementNSPlus("ows:OutputFormat",{value:b});return a;}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.0",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",getParser:function(b){var d=b||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=d){var a=OpenLayers.Format.WMC["v"+d.replace(/\./g,"_")];if(!a){throw"Can't find a WMC parser for version "+d;}this.parser=new a(this.options);}return this.parser;},layerToContext:function(b){var a=this.getParser();var d={queryable:b.queryable,visibility:b.visibility,name:b.params.LAYERS,title:b.name,metadataURL:b.metadataURL,version:b.params.VERSION,url:b.url,maxExtent:b.maxExtent,transparent:b.params.TRANSPARENT,numZoomLevels:b.numZoomLevels,units:b.units,isBaseLayer:b.isBaseLayer,opacity:b.opacity,displayInLayerSwitcher:b.displayInLayerSwitcher,singleTile:b.singleTile,tileSize:(b.singleTile||!b.tileSize)?undefined:{width:b.tileSize.w,height:b.tileSize.h},minScale:(b.options.resolutions||b.options.scales||b.options.maxResolution||b.options.minScale)?b.minScale:undefined,maxScale:(b.options.resolutions||b.options.scales||b.options.minResolution||b.options.maxScale)?b.maxScale:undefined,formats:[{value:b.params.FORMAT,current:true}],styles:[{href:b.params.SLD,body:b.params.SLD_BODY,name:b.params.STYLES||a.defaultStyleName,title:a.defaultStyleTitle,current:true}]};return d;},toContext:function(b){var g={};var a=b.layers;if(b.CLASS_NAME=="OpenLayers.Map"){g.bounds=b.getExtent();g.maxExtent=b.maxExtent;g.projection=b.projection;g.size=b.getSize();}else{OpenLayers.Util.applyDefaults(g,b);if(g.layers!=undefined){delete (g.layers);}}if(g.layersContext==undefined){g.layersContext=[];}if(a!=undefined&&a instanceof Array){for(var f=0,d=a.length;f<d;f++){var e=a[f];if(e instanceof OpenLayers.Layer.WMS){g.layersContext.push(this.layerToContext(e));}}}return g;},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(a){var b=null;if(a==null){b=this.namespaces[this.defaultPrefix];}else{for(b in this.namespaces){if(this.namespaces[b]==a){break;}}}return b;},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a]);}var b=a.documentElement;this.rootPrefix=b.prefix;var d={version:b.getAttribute("version")};this.runChildNodes(d,b);return d;},runChildNodes:function(l,j){var g=j.childNodes;var f,h,b,e;for(var a=0,d=g.length;a<d;++a){f=g[a];if(f.nodeType==1){b=this.getNamespacePrefix(f.namespaceURI);e=f.nodeName.split(":").pop();h=this["read_"+b+"_"+e];if(h){h.apply(this,[l,f]);}}}},read_wmc_General:function(a,b){this.runChildNodes(a,b);},read_wmc_BoundingBox:function(a,b){a.projection=b.getAttribute("SRS");a.bounds=new OpenLayers.Bounds(parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy")));},read_wmc_LayerList:function(a,b){a.layersContext=[];this.runChildNodes(a,b);},read_wmc_Layer:function(b,d){var a={visibility:(d.getAttribute("hidden")!="1"),queryable:(d.getAttribute("queryable")=="1"),formats:[],styles:[]};this.runChildNodes(a,d);b.layersContext.push(a);},read_wmc_Extension:function(b,a){this.runChildNodes(b,a);},read_ol_units:function(b,a){b.units=this.getChildValue(a);},read_ol_maxExtent:function(a,d){var b=new OpenLayers.Bounds(d.getAttribute("minx"),d.getAttribute("miny"),d.getAttribute("maxx"),d.getAttribute("maxy"));a.maxExtent=b;},read_ol_transparent:function(b,a){b.transparent=this.getChildValue(a);},read_ol_numZoomLevels:function(b,a){b.numZoomLevels=parseInt(this.getChildValue(a));},read_ol_opacity:function(b,a){b.opacity=parseFloat(this.getChildValue(a));},read_ol_singleTile:function(b,a){b.singleTile=(this.getChildValue(a)=="true");},read_ol_tileSize:function(d,b){var a={width:b.getAttribute("width"),height:b.getAttribute("height")};d.tileSize=a;},read_ol_isBaseLayer:function(b,a){b.isBaseLayer=(this.getChildValue(a)=="true");},read_ol_displayInLayerSwitcher:function(b,a){b.displayInLayerSwitcher=(this.getChildValue(a)=="true");},read_wmc_Server:function(a,e){a.version=e.getAttribute("version");var b={};var d=e.getElementsByTagName("OnlineResource");if(d.length>0){this.read_wmc_OnlineResource(b,d[0]);}a.url=b.href;},read_wmc_FormatList:function(b,a){this.runChildNodes(b,a);},read_wmc_Format:function(d,b){var a={value:this.getChildValue(b)};if(b.getAttribute("current")=="1"){a.current=true;}d.formats.push(a);},read_wmc_StyleList:function(b,a){this.runChildNodes(b,a);},read_wmc_Style:function(a,d){var b={};
this.runChildNodes(b,d);if(d.getAttribute("current")=="1"){b.current=true;}a.styles.push(b);},read_wmc_SLD:function(a,b){this.runChildNodes(a,b);},read_sld_StyledLayerDescriptor:function(a,d){var b=OpenLayers.Format.XML.prototype.write.apply(this,[d]);a.body=b;},read_wmc_OnlineResource:function(b,a){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href");},read_wmc_Name:function(a,d){var b=this.getChildValue(d);if(b){a.name=b;}},read_wmc_Title:function(d,b){var a=this.getChildValue(b);if(a){d.title=a;}},read_wmc_MetadataURL:function(a,e){var b={};var d=e.getElementsByTagName("OnlineResource");if(d.length>0){this.read_wmc_OnlineResource(b,d[0]);}a.metadataURL=b.href;},read_wmc_Abstract:function(a,d){var b=this.getChildValue(d);if(b){a["abstract"]=b;}},read_wmc_LegendURL:function(a,b){var e={width:b.getAttribute("width"),height:b.getAttribute("height")};var d=b.getElementsByTagName("OnlineResource");if(d.length>0){this.read_wmc_OnlineResource(e,d[0]);}a.legend=e;},write:function(a,d){var b=this.createElementDefaultNS("ViewContext");this.setAttributes(b,{version:this.VERSION,id:(d&&typeof d.id=="string")?d.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);b.appendChild(this.write_wmc_General(a));b.appendChild(this.write_wmc_LayerList(a));return OpenLayers.Format.XML.prototype.write.apply(this,[b]);},createElementDefaultNS:function(a,e,d){var b=this.createElementNS(this.namespaces[this.defaultPrefix],a);if(e){b.appendChild(this.createTextNode(e));}if(d){this.setAttributes(b,d);}return b;},setAttributes:function(e,b){var a;for(var d in b){a=b[d].toString();if(a.match(/[A-Z]/)){this.setAttributeNS(e,null,d,a);}else{e.setAttribute(d,a);}}},write_wmc_General:function(b){var a=this.createElementDefaultNS("General");if(b.size){a.appendChild(this.createElementDefaultNS("Window",null,{width:b.size.w,height:b.size.h}));}var d=b.bounds;a.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:d.left.toPrecision(18),miny:d.bottom.toPrecision(18),maxx:d.right.toPrecision(18),maxy:d.top.toPrecision(18),SRS:b.projection}));a.appendChild(this.createElementDefaultNS("Title",b.title));a.appendChild(this.write_ol_MapExtension(b));return a;},write_ol_MapExtension:function(e){var b=this.createElementDefaultNS("Extension");var a=e.maxExtent;if(a){var d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(d,{minx:a.left.toPrecision(18),miny:a.bottom.toPrecision(18),maxx:a.right.toPrecision(18),maxy:a.top.toPrecision(18)});b.appendChild(d);}return b;},write_wmc_LayerList:function(a){var b=this.createElementDefaultNS("LayerList");for(var e=0,d=a.layersContext.length;e<d;++e){b.appendChild(this.write_wmc_Layer(a.layersContext[e]));}return b;},write_wmc_Layer:function(a){var b=this.createElementDefaultNS("Layer",null,{queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1"});b.appendChild(this.write_wmc_Server(a));b.appendChild(this.createElementDefaultNS("Name",a.name));b.appendChild(this.createElementDefaultNS("Title",a.title));if(a.metadataURL){b.appendChild(this.write_wmc_MetadataURL(a.metadataURL));}return b;},write_wmc_LayerExtension:function(g){var j=this.createElementDefaultNS("Extension");var f=g.maxExtent;var d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(d,{minx:f.left.toPrecision(18),miny:f.bottom.toPrecision(18),maxx:f.right.toPrecision(18),maxy:f.top.toPrecision(18)});j.appendChild(d);if(g.tileSize&&!g.singleTile){var e=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(e,g.tileSize);j.appendChild(e);}var b=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"];var h;for(var l=0,a=b.length;l<a;++l){h=this.createOLPropertyNode(g,b[l]);if(h){j.appendChild(h);}}return j;},createOLPropertyNode:function(d,a){var b=null;if(d[a]!=null){b=this.createElementNS(this.namespaces.ol,"ol:"+a);b.appendChild(this.createTextNode(d[a].toString()));}return b;},write_wmc_Server:function(a){var b=this.createElementDefaultNS("Server");this.setAttributes(b,{service:"OGC:WMS",version:a.version});b.appendChild(this.write_wmc_OnlineResource(a.url));return b;},write_wmc_MetadataURL:function(b){var a=this.createElementDefaultNS("MetadataURL");a.appendChild(this.write_wmc_OnlineResource(b));return a;},write_wmc_FormatList:function(a){var b=this.createElementDefaultNS("FormatList");for(var f=0,e=a.formats.length;f<e;f++){var d=a.formats[f];b.appendChild(this.createElementDefaultNS("Format",d.value,(d.current&&d.current==true)?{current:"1"}:null));}return b;},write_wmc_StyleList:function(h){var f=this.createElementDefaultNS("StyleList");var b=h.styles;if(b&&b instanceof Array){var a;for(var g=0,j=b.length;g<j;g++){var e=b[g];var d=this.createElementDefaultNS("Style",null,(e.current&&e.current==true)?{current:"1"}:null);if(e.href){a=this.createElementDefaultNS("SLD");var l=this.write_wmc_OnlineResource(e.href);a.appendChild(l);a.appendChild(this.createElementDefaultNS("Name",e.name));if(e.title){a.appendChild(this.createElementDefaultNS("Title",e.title));}d.appendChild(a);}else{if(e.body){a=this.createElementDefaultNS("SLD");var m=OpenLayers.Format.XML.prototype.read.apply(this,[e.body]);var o=m.documentElement;if(a.ownerDocument&&a.ownerDocument.importNode){o=a.ownerDocument.importNode(o,true);}a.appendChild(o);a.appendChild(this.createElementDefaultNS("Name",e.name));if(e.title){a.appendChild(this.createElementDefaultNS("Title",e.title));}d.appendChild(a);}else{d.appendChild(this.createElementDefaultNS("Name",e.name));d.appendChild(this.createElementDefaultNS("Title",e.title));if(e["abstract"]){d.appendChild(this.createElementDefaultNS("Abstract",e["abstract"]));}}}f.appendChild(d);}}return f;},write_wmc_OnlineResource:function(a){var b=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(b,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(b,this.namespaces.xlink,"xlink:href",a);return b;},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a]);},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));b.appendChild(this.write_wmc_LayerExtension(a));},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a]);},read_sld_MinScaleDenominator:function(a,d){var b=parseFloat(this.getChildValue(d));if(b>0){a.maxScale=b;}},read_sld_MaxScaleDenominator:function(b,a){b.minScale=parseFloat(this.getChildValue(a));},write_wmc_Layer:function(e){var a=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[e]);if(e.maxScale){var b=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");b.appendChild(this.createTextNode(e.maxScale.toPrecision(16)));a.appendChild(b);}if(e.minScale){var d=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");d.appendChild(this.createTextNode(e.minScale.toPrecision(16)));a.appendChild(d);}a.appendChild(this.write_wmc_FormatList(e));a.appendChild(this.write_wmc_StyleList(e));a.appendChild(this.write_wmc_LayerExtension(e));return a;},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[a]);
},read:function(g){var f,e,j;var h=this.regExes.typeStr.exec(g);if(h){e=h[1].toLowerCase();j=h[2];if(this.parse[e]){f=this.parse[e].apply(this,[j]);}if(this.internalProjection&&this.externalProjection){if(f&&f.CLASS_NAME=="OpenLayers.Feature.Vector"){f.geometry.transform(this.externalProjection,this.internalProjection);}else{if(f&&e!="geometrycollection"&&typeof f=="object"){for(var d=0,a=f.length;d<a;d++){var b=f[d];b.geometry.transform(this.externalProjection,this.internalProjection);}}}}}return f;},write:function(f){var a,e,d,j,g;if(f.constructor==Array){a=f;g=true;}else{a=[f];g=false;}var h=[];if(g){h.push("GEOMETRYCOLLECTION(");}for(var l=0,b=a.length;l<b;++l){if(g&&l>0){h.push(",");}e=a[l].geometry;d=e.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[d]){return null;}if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection);}j=this.extract[d].apply(this,[e]);h.push(d.toUpperCase()+"("+j+")");}if(g){h.push(")");}return h.join("");},extract:{point:function(a){return a.x+" "+a.y;},multipoint:function(a){var b=[];for(var e=0,d=a.components.length;e<d;++e){b.push("("+this.extract.point.apply(this,[a.components[e]])+")");}return b.join(",");},linestring:function(e){var b=[];for(var a=0,d=e.components.length;a<d;++a){b.push(this.extract.point.apply(this,[e.components[a]]));}return b.join(",");},multilinestring:function(a){var b=[];for(var e=0,d=a.components.length;e<d;++e){b.push("("+this.extract.linestring.apply(this,[a.components[e]])+")");}return b.join(",");},polygon:function(a){var b=[];for(var e=0,d=a.components.length;e<d;++e){b.push("("+this.extract.linestring.apply(this,[a.components[e]])+")");}return b.join(",");},multipolygon:function(b){var a=[];for(var e=0,d=b.components.length;e<d;++e){a.push("("+this.extract.polygon.apply(this,[b.components[e]])+")");}return a.join(",");}},parse:{point:function(b){var a=OpenLayers.String.trim(b).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a[0],a[1]));},multipoint:function(b){var e;var g=OpenLayers.String.trim(b).split(this.regExes.parenComma);var a=[];for(var f=0,d=g.length;f<d;++f){e=g[f].replace(this.regExes.trimParens,"$1");a.push(this.parse.point.apply(this,[e]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(a));},linestring:function(d){var a=OpenLayers.String.trim(d).split(",");var b=[];for(var f=0,e=a.length;f<e;++f){b.push(this.parse.point.apply(this,[a[f]]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(b));},multilinestring:function(b){var f;var e=OpenLayers.String.trim(b).split(this.regExes.parenComma);var a=[];for(var g=0,d=e.length;g<d;++g){f=e[g].replace(this.regExes.trimParens,"$1");a.push(this.parse.linestring.apply(this,[f]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(a));},polygon:function(j){var d,b,g;var h=OpenLayers.String.trim(j).split(this.regExes.parenComma);var f=[];for(var e=0,a=h.length;e<a;++e){d=h[e].replace(this.regExes.trimParens,"$1");b=this.parse.linestring.apply(this,[d]).geometry;g=new OpenLayers.Geometry.LinearRing(b.components);f.push(g);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(f));},multipolygon:function(b){var g;var e=OpenLayers.String.trim(b).split(this.regExes.doubleParenComma);var a=[];for(var f=0,d=e.length;f<d;++f){g=e[f].replace(this.regExes.trimParens,"$1");a.push(this.parse.polygon.apply(this,[g]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(a));},geometrycollection:function(d){d=d.replace(/,\s*([A-Za-z])/g,"|$1");var b=OpenLayers.String.trim(d).split("|");var a=[];for(var f=0,e=b.length;f<e;++f){a.push(OpenLayers.Format.WKT.prototype.read.apply(this,[b[f]]));}return a;}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},gmlFormat:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,arguments);OpenLayers.Util.extend(this,a);this.options=a;},read:function(d){var e;if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d]);}var f=d.documentElement;if(f){var a=this;var b=this["read_"+f.nodeName];if(b){e=b.call(this,f);}else{e=new OpenLayers.Format.GML((this.options?this.options:{})).read(d);}}else{e=d;}return e;},read_msGMLOutput:function(g){var b=[];var q=this.getSiblingNodesByTagCriteria(g,this.layerIdentifier);if(q){for(var l=0,e=q.length;l<e;++l){var s=q[l];var o=s.nodeName;if(s.prefix){o=o.split(":")[1];}var o=o.replace(this.layerIdentifier,"");var r=this.getSiblingNodesByTagCriteria(s,this.featureIdentifier);if(r){for(var f=0;f<r.length;f++){var m=r[f];var a=this.parseGeometry(m);var d=this.parseAttributes(m);var h=new OpenLayers.Feature.Vector(a.geometry,d,null);h.bounds=a.bounds;h.type=o;b.push(h);}}}}return b;},read_FeatureInfoResponse:function(l){var e=[];var o=this.getElementsByTagNameNS(l,"*","FIELDS");for(var m=0,q=o.length;m<q;m++){var a=o[m];var b=null;var h={};for(var g=0,f=a.attributes.length;g<f;g++){var d=a.attributes[g];h[d.nodeName]=d.nodeValue;}e.push(new OpenLayers.Feature.Vector(b,h,null));}return e;},getSiblingNodesByTagCriteria:function(a,e){var f=[];var h,l,j,b,g;if(a&&a.hasChildNodes()){h=a.childNodes;j=h.length;for(var d=0;d<j;d++){g=h[d];while(g&&g.nodeType!=1){g=g.nextSibling;d++;}l=(g?g.nodeName:"");if(l.length>0&&l.indexOf(e)>-1){f.push(g);}else{b=this.getSiblingNodesByTagCriteria(g,e);if(b.length>0){(f.length==0)?f=b:f.push(b);}}}}return f;},parseAttributes:function(j){var l={};if(j.nodeType==1){var g=j.childNodes;var h=g.length;for(var m=0;m<h;++m){var f=g[m];if(f.nodeType==1){var e=f.childNodes;if(e.length==1){var b=e[0];if(b.nodeType==3||b.nodeType==4){var d=(f.prefix)?f.nodeName.split(":")[1]:f.nodeName;var a=b.nodeValue.replace(this.regExes.trimSpace,"");l[d]=a;}}}}}return l;},parseGeometry:function(a){if(!this.gmlFormat){this.gmlFormat=new OpenLayers.Format.GML();}var d=this.gmlFormat.parseFeature(a);var b,e=null;if(d){b=d.geometry&&d.geometry.clone();e=d.bounds&&d.bounds.clone();d.destroy();}return{geometry:b,bounds:e};},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){this.id=null;this.bounds=null;},clone:function(){return new OpenLayers.Geometry();},setBounds:function(a){if(a){this.bounds=a.clone();}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds();}},extendBounds:function(b){var a=this.getBounds();if(!a){this.setBounds(b);}else{this.bounds.extend(b);}},getBounds:function(){if(this.bounds==null){this.calculateBounds();}return this.bounds;},calculateBounds:function(){},distanceTo:function(b,a){},getVertices:function(a){},atPoint:function(f,j,g){var d=false;var e=this.getBounds();if((e!=null)&&(f!=null)){var b=(j!=null)?j:0;var a=(g!=null)?g:0;var h=new OpenLayers.Bounds(this.bounds.left-b,this.bounds.bottom-a,this.bounds.right+b,this.bounds.top+a);d=h.containsLonLat(f);}return d;},getLength:function(){return 0;},getArea:function(){return 0;},getCentroid:function(){return null;},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this));},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(h){var a=arguments.callee.format;if(!a){a=new OpenLayers.Format.WKT();arguments.callee.format=a;}var f;var d=a.read(h);if(d instanceof OpenLayers.Feature.Vector){f=d.geometry;}else{if(d instanceof Array){var b=d.length;var g=new Array(b);for(var e=0;e<b;++e){g[e]=d[e].geometry;}f=new OpenLayers.Geometry.Collection(g);}}return f;};OpenLayers.Geometry.segmentsIntersect=function(t,H,u){var h=u&&u.point;var L=u&&u.tolerance;
var B=false;var f=t.x1-H.x1;var r=t.y1-H.y1;var a=t.x2-t.x1;var J=t.y2-t.y1;var m=H.y2-H.y1;var F=H.x2-H.x1;var o=(m*a)-(F*J);var z=(F*r)-(m*f);var v=(a*r)-(J*f);if(o==0){if(z==0&&v==0){B=true;}}else{var q=z/o;var l=v/o;if(q>=0&&q<=1&&l>=0&&l<=1){if(!h){B=true;}else{var D=t.x1+(q*a);var C=t.y1+(q*J);B=new OpenLayers.Geometry.Point(D,C);}}}if(L){var g;if(B){if(h){var K=[t,H];var b,D,C;outer:for(var G=0;G<2;++G){b=K[G];for(var s=1;s<3;++s){D=b["x"+s];C=b["y"+s];g=Math.sqrt(Math.pow(D-B.x,2)+Math.pow(C-B.y,2));if(g<L){B.x=D;B.y=C;break outer;}}}}}else{var K=[t,H];var e,w,D,C,I,E;outer:for(var G=0;G<2;++G){e=K[G];w=K[(G+1)%2];for(var s=1;s<3;++s){I={x:e["x"+s],y:e["y"+s]};E=OpenLayers.Geometry.distanceToSegment(I,w);if(E.distance<L){if(h){B=new OpenLayers.Geometry.Point(I.x,I.y);}else{B=true;}break outer;}}}}}return B;};OpenLayers.Geometry.distanceToSegment=function(l,r){var o=l.x;var h=l.y;var j=r.x1;var f=r.y1;var g=r.x2;var b=r.y2;var q=g-j;var m=b-f;var e=((q*(o-j))+(m*(h-f)))/(Math.pow(q,2)+Math.pow(m,2));var d,a;if(e<=0){d=j;a=f;}else{if(e>=1){d=g;a=b;}else{d=j+e*q;a=f+e*m;}}return{distance:Math.sqrt(Math.pow(d-o,2)+Math.pow(a-h,2)),x:d,y:a};};OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",autoActivate:false,active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners);}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners);}this.events.destroy();this.events=null;}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null;}if(this.handlers){for(var a in this.handlers){if(this.handlers.hasOwnProperty(a)&&typeof this.handlers[a].destroy=="function"){this.handlers[a].destroy();}}this.handlers=null;}if(this.map){this.map.removeControl(this);this.map=null;}},setMap:function(a){this.map=a;if(this.handler){this.handler.setMap(a);}},draw:function(a){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=OpenLayers.Function.False;}if(this.title!=""){this.div.title=this.title;}}if(a!=null){this.position=a.clone();}this.moveTo(this.position);return this.div;},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px";}},activate:function(){if(this.active){return false;}if(this.handler){this.handler.activate();}this.active=true;if(this.map){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");}this.events.triggerEvent("activate");return true;},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate();}this.active=false;if(this.map){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");}this.events.triggerEvent("deactivate");return true;}return false;},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(a){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);this.removeButtons();this.buttons=null;this.position=null;},draw:function(d){OpenLayers.Control.prototype.draw.apply(this,arguments);d=this.position;this.buttons=[];var a=new OpenLayers.Size(18,18);var b=new OpenLayers.Pixel(d.x+a.w/2,d.y);this._addButton("panup","north-mini.png",b,a);d.y=b.y+a.h;this._addButton("panleft","west-mini.png",d,a);this._addButton("panright","east-mini.png",d.add(a.w,0),a);this._addButton("pandown","south-mini.png",b.add(0,a.h*2),a);this._addButton("zoomin","zoom-plus-mini.png",b.add(0,a.h*3+5),a);this._addButton("zoomworld","zoom-world-mini.png",b.add(0,a.h*4+5),a);this._addButton("zoomout","zoom-minus-mini.png",b.add(0,a.h*5+5),a);return this.div;},_addButton:function(f,j,e,b){var a=OpenLayers.Util.getImagesLocation()+j;var g=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+f,e,b,a,"absolute");this.div.appendChild(g);OpenLayers.Event.observe(g,"mousedown",OpenLayers.Function.bindAsEventListener(this.buttonDown,g));OpenLayers.Event.observe(g,"dblclick",OpenLayers.Function.bindAsEventListener(this.doubleClick,g));OpenLayers.Event.observe(g,"click",OpenLayers.Function.bindAsEventListener(this.doubleClick,g));g.action=f;g.map=this.map;if(!this.slideRatio){var h=this.slideFactor;var l=function(){return h;};}else{var d=this.slideRatio;var l=function(m){return this.map.getSize()[m]*d;};}g.getSlideFactor=l;this.buttons.push(g);return g;},_removeButton:function(a){OpenLayers.Event.stopObservingElement(a);a.map=null;a.getSlideFactor=null;this.div.removeChild(a);OpenLayers.Util.removeItem(this.buttons,a);},removeButtons:function(){for(var a=this.buttons.length-1;a>=0;--a){this._removeButton(this.buttons[a]);}},doubleClick:function(a){OpenLayers.Event.stop(a);return false;},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return;}switch(this.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent();break;}OpenLayers.Event.stop(a);},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,divEvents:null,zoomWorldIcon:false,forceFixedZoomLevel:false,mouseDragStart:null,zoomStart:null,initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments);},destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart;},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.register("changebaselayer",this,this.redraw);},redraw:function(){if(this.div!=null){this.removeButtons();this._removeZoomBar();}this.draw();},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments);e=this.position.clone();this.buttons=[];var b=new OpenLayers.Size(18,18);var d=new OpenLayers.Pixel(e.x+b.w/2,e.y);var a=b.w;if(this.zoomWorldIcon){d=new OpenLayers.Pixel(e.x+b.w,e.y);}this._addButton("panup","north-mini.png",d,b);e.y=d.y+b.h;this._addButton("panleft","west-mini.png",e,b);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",e.add(b.w,0),b);a*=2;}this._addButton("panright","east-mini.png",e.add(a,0),b);this._addButton("pandown","south-mini.png",d.add(0,b.h*2),b);this._addButton("zoomin","zoom-plus-mini.png",d.add(0,b.h*3+5),b);d=this._addZoomBar(d.add(0,b.h*4+5));this._addButton("zoomout","zoom-minus-mini.png",d,b);return this.div;},_addZoomBar:function(b){var g=OpenLayers.Util.getImagesLocation();var a=this.id+"_"+this.map.id;var d=this.map.getNumZoomLevels()-1-this.map.getZoom();var e=OpenLayers.Util.createAlphaImageDiv(a,b.add(-1,d*this.zoomStopHeight),new OpenLayers.Size(20,9),g+"slider.png","absolute");
this.slider=e;this.sliderEvents=new OpenLayers.Events(this,e,null,true,{includeXY:true});this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var f=new OpenLayers.Size();f.h=this.zoomStopHeight*this.map.getNumZoomLevels();f.w=this.zoomStopWidth;var h=null;if(OpenLayers.Util.alphaHack()){var a=this.id+"_"+this.map.id;h=OpenLayers.Util.createAlphaImageDiv(a,b,new OpenLayers.Size(f.w,this.zoomStopHeight),g+"zoombar.png","absolute",null,"crop");h.style.height=f.h+"px";}else{h=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,b,f,g+"zoombar.png");}this.zoombarDiv=h;this.divEvents=new OpenLayers.Events(this,h,null,true,{includeXY:true});this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(h);this.startTop=parseInt(h.style.top);this.div.appendChild(e);this.map.events.register("zoomend",this,this.moveZoomBar);b=b.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());return b;},_removeZoomBar:function(){this.sliderEvents.un({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});this.sliderEvents.destroy();this.divEvents.un({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.divEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar);},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a);},divClick:function(e){if(!OpenLayers.Event.isLeftClick(e)){return;}var d=e.xy.y;var b=OpenLayers.Util.pagePosition(e.object)[1];var a=(d-b)/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom){a=Math.floor(a);}var f=(this.map.getNumZoomLevels()-1)-a;f=Math.min(Math.max(f,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(f);OpenLayers.Event.stop(e);},zoomBarDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return;}this.map.events.on({mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=a.xy.clone();this.zoomStart=a.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(a);},zoomBarDrag:function(e){if(this.mouseDragStart!=null){var d=this.mouseDragStart.y-e.xy.y;var b=OpenLayers.Util.pagePosition(this.zoombarDiv);if((e.clientY-b[1])>0&&(e.clientY-b[1])<parseInt(this.zoombarDiv.style.height)-2){var a=parseInt(this.slider.style.top)-d;this.slider.style.top=a+"px";this.mouseDragStart=e.xy.clone();}OpenLayers.Event.stop(e);}},zoomBarUp:function(d){if(!OpenLayers.Event.isLeftClick(d)){return;}if(this.mouseDragStart){this.div.style.cursor="";this.map.events.un({mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.zoomStart.y-d.xy.y;var a=this.map.zoom;if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){a+=b/this.zoomStopHeight;a=Math.min(Math.max(a,0),this.map.getNumZoomLevels()-1);}else{a+=Math.round(b/this.zoomStopHeight);}this.map.zoomTo(a);this.mouseDragStart=null;this.zoomStart=null;OpenLayers.Event.stop(d);}},moveZoomBar:function(){var a=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px";},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:false,initialize:function(a){this.easing=(a)?a:OpenLayers.Easing.Expo.easeOut;},start:function(a,e,b,d){this.playing=true;this.begin=a;this.finish=e;this.duration=b;this.callbacks=d.callbacks;this.time=0;if(this.interval){window.clearInterval(this.interval);this.interval=null;}if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin);}this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL);},stop:function(){if(!this.playing){return;}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish);}window.clearInterval(this.interval);this.interval=null;this.playing=false;},play:function(){var g={};for(var d in this.begin){var a=this.begin[d];var e=this.finish[d];if(a==null||e==null||isNaN(a)||isNaN(e)){OpenLayers.Console.error("invalid value for Tween");}var h=e-a;g[d]=this.easing.apply(this,[this.time,a,h,this.duration]);}this.time++;if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,g);}if(this.time>this.duration){this.stop();}},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(e,a,g,f){return g*e/f+a;},easeOut:function(e,a,g,f){return g*e/f+a;},easeInOut:function(e,a,g,f){return g*e/f+a;},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(e,a,g,f){return(e==0)?a:g*Math.pow(2,10*(e/f-1))+a;},easeOut:function(e,a,g,f){return(e==f)?a+g:g*(-Math.pow(2,-10*e/f)+1)+a;},easeInOut:function(e,a,g,f){if(e==0){return a;}if(e==f){return a+g;}if((e/=f/2)<1){return g/2*Math.pow(2,10*(e-1))+a;}return g/2*(-Math.pow(2,-10*--e)+2)+a;},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(e,a,g,f){return g*(e/=f)*e+a;},easeOut:function(e,a,g,f){return -g*(e/=f)*(e-2)+a;},easeInOut:function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e+a;}return -g/2*((--e)*(e-2)-1)+a;},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},EVENT_TYPES:["preaddlayer","addlayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,initialize:function(j,e){if(arguments.length===1&&typeof j==="object"){e=j;j=e&&e.div;}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,e);this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(j);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px";}OpenLayers.Element.addClass(this.div,"olMap");var h=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(h,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);h=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(h);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:true});this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners);}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize);
}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy);}if(this.theme){var g=true;var d=document.getElementsByTagName("link");for(var f=0,a=d.length;f<a;++f){if(OpenLayers.Util.isEquivalentUrl(d.item(f).href,this.theme)){g=false;break;}}if(g){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(b);}}if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()];}else{this.controls=[];}}for(var f=0,a=this.controls.length;f<a;f++){this.addControlToMap(this.controls[f]);}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(e&&e.layers){this.addLayers(e.layers);if(e.center){this.setCenter(e.center,e.zoom);}}},render:function(a){this.div=OpenLayers.Util.getElement(a);OpenLayers.Element.addClass(this.div,"olMap");this.events.attachToElement(this.div);this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize();},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false;}if(this.panTween){this.panTween.stop();this.panTween=null;}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy);}else{this.events.unregister("resize",this,this.updateSize);}this.paddingForPopups=null;if(this.controls!=null){for(var a=this.controls.length-1;a>=0;--a){this.controls[a].destroy();}this.controls=null;}if(this.layers!=null){for(var a=this.layers.length-1;a>=0;--a){this.layers[a].destroy(false);}this.layers=null;}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv);}this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null;}this.events.destroy();this.events=null;},setOptions:function(a){OpenLayers.Util.extend(this,a);},getTileSize:function(){return this.tileSize;},getBy:function(d,a,e){var b=(typeof e.test=="function");var f=OpenLayers.Array.filter(this[d],function(g){return g[a]==e||(b&&e.test(g[a]));});return f;},getLayersBy:function(b,a){return this.getBy("layers",b,a);},getLayersByName:function(a){return this.getLayersBy("name",a);},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a);},getControlsBy:function(b,a){return this.getBy("controls",b,a);},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a);},getLayer:function(d){var f=null;for(var b=0,e=this.layers.length;b<e;b++){var a=this.layers[b];if(a.id==d){f=a;break;}}return f;},setLayerZIndex:function(b,a){b.setZIndex(this.Z_INDEX_BASE[b.isBaseLayer?"BaseLayer":"Overlay"]+a*5);},resetLayersZIndex:function(){for(var a=0,b=this.layers.length;a<b;a++){var d=this.layers[a];this.setLayerZIndex(d,a);}},addLayer:function(a){for(var e=0,d=this.layers.length;e<d;e++){if(this.layers[e]==a){var b=OpenLayers.i18n("layerAlreadyAdded",{layerName:a.name});OpenLayers.Console.warn(b);return false;}}if(this.allOverlays){a.isBaseLayer=false;}if(this.events.triggerEvent("preaddlayer",{layer:a})===false){return;}a.div.className="olLayerDiv";a.div.style.overflow="";this.setLayerZIndex(a,this.layers.length);if(a.isFixed){this.viewPortDiv.appendChild(a.div);}else{this.layerContainerDiv.appendChild(a.div);}this.layers.push(a);a.setMap(this);if(a.isBaseLayer||(this.allOverlays&&!this.baseLayer)){if(this.baseLayer==null){this.setBaseLayer(a);}else{a.setVisibility(false);}}else{a.redraw();}this.events.triggerEvent("addlayer",{layer:a});a.afterAdd();},addLayers:function(a){for(var d=0,b=a.length;d<b;d++){this.addLayer(a[d]);}},removeLayer:function(a,d){if(d==null){d=true;}if(a.isFixed){this.viewPortDiv.removeChild(a.div);}else{this.layerContainerDiv.removeChild(a.div);}OpenLayers.Util.removeItem(this.layers,a);a.removeMap(this);a.map=null;if(this.baseLayer==a){this.baseLayer=null;if(d){for(var f=0,e=this.layers.length;f<e;f++){var b=this.layers[f];if(b.isBaseLayer||this.allOverlays){this.setBaseLayer(b);break;}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:a});},getNumLayers:function(){return this.layers.length;},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a);},setLayerIndex:function(b,f){var d=this.getLayerIndex(b);if(f<0){f=0;}else{if(f>this.layers.length){f=this.layers.length;}}if(d!=f){this.layers.splice(d,1);this.layers.splice(f,0,b);for(var a=0,e=this.layers.length;a<e;a++){this.setLayerZIndex(this.layers[a],a);}this.events.triggerEvent("changelayer",{layer:b,property:"order"});if(this.allOverlays){if(f===0){this.setBaseLayer(b);}else{if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0]);}}}}},raiseLayer:function(d,a){var b=this.getLayerIndex(d)+a;this.setLayerIndex(d,b);},setBaseLayer:function(a){if(a!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,a)!=-1){var d=this.getCenter();var b=OpenLayers.Util.getResolutionFromScale(this.getScale(),a.units);if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false);}this.baseLayer=a;this.viewRequestID++;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(true);}if(d!=null){var e=this.getZoomForResolution(b||this.resolution,true);this.setCenter(d,e,false,true);}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer});}}},addControl:function(b,a){this.controls.push(b);this.addControlToMap(b,a);},addControls:function(d,a){var g=(arguments.length===1)?[]:a;for(var f=0,b=d.length;f<b;f++){var h=d[f];var e=(g[f])?g[f]:null;this.addControl(h,e);}},addControlToMap:function(d,b){d.outsideViewport=(d.div!=null);if(this.displayProjection&&!d.displayProjection){d.displayProjection=this.displayProjection;}d.setMap(this);var a=d.draw(b);if(a){if(!d.outsideViewport){a.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(a);}}if(d.autoActivate){d.activate();}},getControl:function(d){var f=null;for(var a=0,e=this.controls.length;a<e;a++){var b=this.controls[a];if(b.id==d){f=b;break;}}return f;},removeControl:function(a){if((a)&&(a==this.getControl(a.id))){if(a.div&&(a.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(a.div);}OpenLayers.Util.removeItem(this.controls,a);}},addPopup:function(d,b){if(b){for(var e=this.popups.length-1;e>=0;--e){this.removePopup(this.popups[e]);}}d.map=this;this.popups.push(d);var a=d.draw();if(a){a.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(a);}},removePopup:function(a){OpenLayers.Util.removeItem(this.popups,a);if(a.div){try{this.layerContainerDiv.removeChild(a.div);}catch(b){}}a.map=null;},getSize:function(){var a=null;if(this.size!=null){a=this.size.clone();}return a;},updateSize:function(){var f=this.getCurrentSize();if(f&&!isNaN(f.h)&&!isNaN(f.w)){this.events.clearMouseCache();var b=this.getSize();if(b==null){this.size=b=f;}if(!f.equals(b)){this.size=f;for(var g=0,e=this.layers.length;g<e;g++){this.layers[g].onMapResize();}var d=this.getCenter();if(this.baseLayer!=null&&d!=null){var a=this.getZoom();this.zoom=null;this.setCenter(d,a);}}}},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=this.div.offsetWidth;a.h=this.div.offsetHeight;}if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=parseInt(this.div.style.width);a.h=parseInt(this.div.style.height);}return a;},calculateBounds:function(d,e){var a=null;if(d==null){d=this.getCenter();}if(e==null){e=this.getResolution();}if((d!=null)&&(e!=null)){var g=this.getSize();var b=g.w*e;var f=g.h*e;a=new OpenLayers.Bounds(d.lon-b/2,d.lat-f/2,d.lon+b/2,d.lat+f/2);}return a;
},getCenter:function(){var a=null;if(this.center){a=this.center.clone();}return a;},getZoom:function(){return this.zoom;},pan:function(g,f,a){a=OpenLayers.Util.applyDefaults(a,{animate:true,dragging:false});var b=this.getViewPortPxFromLonLat(this.getCenter());var e=b.add(g,f);if(!a.dragging||!e.equals(b)){var d=this.getLonLatFromViewPortPx(e);if(a.animate){this.panTo(d);}else{this.setCenter(d,null,a.dragging);}}},panTo:function(e){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(e)){if(!this.panTween){this.panTween=new OpenLayers.Tween(this.panMethod);}var d=this.getCenter();if(e.lon==d.lon&&e.lat==d.lat){return;}var b={lon:d.lon,lat:d.lat};var a={lon:e.lon,lat:e.lat};this.panTween.start(b,a,this.panDuration,{callbacks:{start:OpenLayers.Function.bind(function(f){this.events.triggerEvent("movestart");},this),eachStep:OpenLayers.Function.bind(function(f){f=new OpenLayers.LonLat(f.lon,f.lat);this.moveTo(f,this.zoom,{dragging:true,noEvent:true});},this),done:OpenLayers.Function.bind(function(f){f=new OpenLayers.LonLat(f.lon,f.lat);this.moveTo(f,this.zoom,{noEvent:true});this.events.triggerEvent("moveend");},this)}});}else{this.setCenter(e);}},setCenter:function(a,d,e,b){this.moveTo(a,d,{dragging:e,forceZoomChange:b,caller:"setCenter"});},moveTo:function(u,r,h){if(!h){h={};}if(r!=null){r=parseFloat(r);if(!this.fractionalZoom){r=Math.round(r);}}var o=h.dragging;var m=h.forceZoomChange;var a=h.noEvent;if(this.panTween&&h.caller=="setCenter"){this.panTween.stop();}if(!this.center&&!this.isValidLonLat(u)){u=this.maxExtent.getCenterLonLat();}if(this.restrictedExtent!=null){if(u==null){u=this.getCenter();}if(r==null){r=this.getZoom();}var q=this.getResolutionForZoom(r);var e=this.calculateBounds(u,q);if(!this.restrictedExtent.containsBounds(e)){var f=this.restrictedExtent.getCenterLonLat();if(e.getWidth()>this.restrictedExtent.getWidth()){u=new OpenLayers.LonLat(f.lon,u.lat);}else{if(e.left<this.restrictedExtent.left){u=u.add(this.restrictedExtent.left-e.left,0);}else{if(e.right>this.restrictedExtent.right){u=u.add(this.restrictedExtent.right-e.right,0);}}}if(e.getHeight()>this.restrictedExtent.getHeight()){u=new OpenLayers.LonLat(u.lon,f.lat);}else{if(e.bottom<this.restrictedExtent.bottom){u=u.add(0,this.restrictedExtent.bottom-e.bottom);}else{if(e.top>this.restrictedExtent.top){u=u.add(0,this.restrictedExtent.top-e.top);}}}}}var l=m||((this.isValidZoomLevel(r))&&(r!=this.getZoom()));var s=(this.isValidLonLat(u))&&(!u.equals(this.center));if(l||s||!o){if(!this.dragging&&!a){this.events.triggerEvent("movestart");}if(s){if((!l)&&(this.center)){this.centerLayerContainer(u);}this.center=u.clone();}if((l)||(this.layerContainerOrigin==null)){this.layerContainerOrigin=this.center.clone();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px";}if(l){this.zoom=r;this.resolution=this.getResolutionForZoom(r);this.viewRequestID++;}var j=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(j,l,o);if(o){this.baseLayer.events.triggerEvent("move");}else{this.baseLayer.events.triggerEvent("moveend",{zoomChanged:l});}}j=this.baseLayer.getExtent();for(var t=0,d=this.layers.length;t<d;t++){var b=this.layers[t];if(b!==this.baseLayer&&!b.isBaseLayer){var g=b.calculateInRange();if(b.inRange!=g){b.inRange=g;if(!g){b.display(false);}this.events.triggerEvent("changelayer",{layer:b,property:"visibility"});}if(g&&b.visibility){b.moveTo(j,l,o);if(o){b.events.triggerEvent("move");}else{b.events.triggerEvent("moveend",{zoomChanged:l});}}}}if(l){for(var t=0,d=this.popups.length;t<d;t++){this.popups[t].updatePosition();}}this.events.triggerEvent("move");if(l){this.events.triggerEvent("zoomend");}}if(!o&&!a){this.events.triggerEvent("moveend");}this.dragging=!!o;},centerLayerContainer:function(d){var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var a=this.getViewPortPxFromLonLat(d);if((b!=null)&&(a!=null)){this.layerContainerDiv.style.left=Math.round(b.x-a.x)+"px";this.layerContainerDiv.style.top=Math.round(b.y-a.y)+"px";}},isValidZoomLevel:function(a){return((a!=null)&&(a>=0)&&(a<this.getNumZoomLevels()));},isValidLonLat:function(a){var d=false;if(a!=null){var b=this.getMaxExtent();d=b.containsLonLat(a);}return d;},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null;},getProjectionObject:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.projection;}return a;},getMaxResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.maxResolution;}return a;},getMaxExtent:function(b){var a=null;if(b&&b.restricted&&this.restrictedExtent){a=this.restrictedExtent;}else{if(this.baseLayer!=null){a=this.baseLayer.maxExtent;}}return a;},getNumZoomLevels:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.numZoomLevels;}return a;},getExtent:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getExtent();}return a;},getResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getResolution();}else{if(this.allOverlays===true&&this.layers.length>0){a=this.layers[0].getResolution();}}return a;},getUnits:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.units;}return a;},getScale:function(){var a=null;if(this.baseLayer!=null){var d=this.getResolution();var b=this.baseLayer.units;a=OpenLayers.Util.getScaleFromResolution(d,b);}return a;},getZoomForExtent:function(a,d){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getZoomForExtent(a,d);}return b;},getResolutionForZoom:function(b){var a=null;if(this.baseLayer){a=this.baseLayer.getResolutionForZoom(b);}return a;},getZoomForResolution:function(b,a){var d=null;if(this.baseLayer!=null){d=this.baseLayer.getZoomForResolution(b,a);}return d;},zoomTo:function(a){if(this.isValidZoomLevel(a)){this.setCenter(null,a);}},zoomIn:function(){this.zoomTo(this.getZoom()+1);},zoomOut:function(){this.zoomTo(this.getZoom()-1);},zoomToExtent:function(b,a){var e=b.getCenterLonLat();if(this.baseLayer.wrapDateLine){var d=this.getMaxExtent();b=b.clone();while(b.right<b.left){b.right+=d.getWidth();}e=b.getCenterLonLat().wrapDateLine(d);}this.setCenter(e,this.getZoomForExtent(b,a));},zoomToMaxExtent:function(a){var d=(a)?a.restricted:true;var b=this.getMaxExtent({restricted:d});this.zoomToExtent(b);},zoomToScale:function(j,h){var e=OpenLayers.Util.getResolutionFromScale(j,this.baseLayer.units);var d=this.getSize();var g=d.w*e;var b=d.h*e;var a=this.getCenter();var f=new OpenLayers.Bounds(a.lon-g/2,a.lat-b/2,a.lon+g/2,a.lat+b/2);this.zoomToExtent(f,h);},getLonLatFromViewPortPx:function(a){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getLonLatFromViewPortPx(a);}return b;},getViewPortPxFromLonLat:function(b){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getViewPortPxFromLonLat(b);}return a;},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a);},getPixelFromLonLat:function(b){var a=this.getViewPortPxFromLonLat(b);a.x=Math.round(a.x);a.y=Math.round(a.y);return a;},getGeodesicPixelSize:function(b){var j=b?this.getLonLatFromPixel(b):(this.getCenter()||new OpenLayers.LonLat(0,0));var l=this.getResolution();var h=j.add(-l/2,0);var e=j.add(l/2,0);var g=j.add(0,-l/2);var a=j.add(0,l/2);var d=new OpenLayers.Projection("EPSG:4326");var f=this.getProjectionObject()||d;if(!f.equals(d)){h.transform(f,d);e.transform(f,d);g.transform(f,d);a.transform(f,d);}return new OpenLayers.Size(OpenLayers.Util.distVincenty(h,e),OpenLayers.Util.distVincenty(g,a));},getViewPortPxFromLayerPx:function(b){var a=null;if(b!=null){var e=parseInt(this.layerContainerDiv.style.left);var d=parseInt(this.layerContainerDiv.style.top);a=b.add(e,d);}return a;},getLayerPxFromViewPortPx:function(a){var b=null;if(a!=null){var e=-parseInt(this.layerContainerDiv.style.left);var d=-parseInt(this.layerContainerDiv.style.top);b=a.add(e,d);if(isNaN(b.x)||isNaN(b.y)){b=null;}}return b;},getLonLatFromLayerPx:function(a){a=this.getViewPortPxFromLayerPx(a);return this.getLonLatFromViewPortPx(a);},getLayerPxFromLonLat:function(b){var a=this.getPixelFromLonLat(b);
return this.getLayerPxFromViewPortPx(a);},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,initialize:function(b,a){OpenLayers.Util.extend(this,a);this.projCode=b;if(window.Proj4js){this.proj=new Proj4js.Proj(b);}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode;},getUnits:function(){return this.proj?this.proj.units:null;},toString:function(){return this.getCode();},equals:function(a){if(a&&a.getCode){return this.getCode()==a.getCode();}else{return false;}},destroy:function(){delete this.proj;delete this.projCode;},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.addTransform=function(a,d,b){if(!OpenLayers.Projection.transforms[a]){OpenLayers.Projection.transforms[a]={};}OpenLayers.Projection.transforms[a][d]=b;};OpenLayers.Projection.transform=function(b,a,d){if(a.proj&&d.proj){b=Proj4js.transform(a.proj,d.proj,b);}else{if(a&&d&&OpenLayers.Projection.transforms[a.getCode()]&&OpenLayers.Projection.transforms[a.getCode()][d.getCode()]){OpenLayers.Projection.transforms[a.getCode()][d.getCode()](b);}}return b;};OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend"],RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],metadata:{},initialize:function(b,a){this.addOptions(a);this.name=b;if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners);}}if(this.wrapDateLine){this.displayOutsideMaxExtent=true;}},destroy:function(a){if(a==null){a=true;}if(this.map!=null){this.map.removeLayer(this,a);}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners);}this.events.destroy();}this.eventListeners=null;this.events=null;},clone:function(a){if(a==null){a=new OpenLayers.Layer(this.name,this.getOptions());}OpenLayers.Util.applyDefaults(a,this);a.map=null;return a;},getOptions:function(){var a={};for(var b in this.options){a[b]=this[b];}return a;},setName:function(a){if(a!=this.name){this.name=a;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"});}}},addOptions:function(a){if(this.options==null){this.options={};}OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a);if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection);}if(this.projection&&this.projection.getUnits()){this.units=this.projection.getUnits();}if(this.map){var b=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var d in a){if(a.hasOwnProperty(d)&&OpenLayers.Util.indexOf(b,d)>=0){this.initResolutions();break;}}}},onMapResize:function(){},redraw:function(){var d=false;if(this.map){this.inRange=this.calculateInRange();var a=this.getExtent();if(a&&this.inRange&&this.visibility){var b=true;this.moveTo(a,b,false);this.events.triggerEvent("moveend",{zoomChanged:b});d=true;}}return d;},moveTo:function(e,d,a){var b=this.visibility;if(!this.isBaseLayer){b=b&&this.inRange;}this.display(b);},setMap:function(b){if(this.map==null){this.map=b;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection);}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var a=((this.visibility)&&(this.inRange));this.div.style.display=a?"":"none";}this.setTileSize();}},afterAdd:function(){},removeMap:function(a){},getImageSize:function(a){return(this.imageSize||this.tileSize);},setTileSize:function(a){var b=(a)?a:((this.tileSize)?this.tileSize:this.map.getTileSize());this.tileSize=b;if(this.gutter){this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter);this.imageSize=new OpenLayers.Size(b.w+(2*this.gutter),b.h+(2*this.gutter));}},getVisibility:function(){return this.visibility;},setVisibility:function(a){if(a!=this.visibility){this.visibility=a;this.display(a);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"});}this.events.triggerEvent("visibilitychanged");}},display:function(a){if(a!=(this.div.style.display!="none")){this.div.style.display=(a&&this.calculateInRange())?"block":"none";}},calculateInRange:function(){var b=false;if(this.alwaysInRange){b=true;}else{if(this.map){var a=this.map.getResolution();b=((a>=this.minResolution)&&(a<=this.maxResolution));}}return b;},setIsBaseLayer:function(a){if(a!=this.isBaseLayer){this.isBaseLayer=a;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this});}}},initResolutions:function(){var f,a;var g={},e=true;for(f=0,a=this.RESOLUTION_PROPERTIES.length;f<a;f++){var j=this.RESOLUTION_PROPERTIES[f];g[j]=this.options[j];if(e&&this.options[j]){e=false;}}if(this.alwaysInRange==null){this.alwaysInRange=e;}if(g.resolutions==null){g.resolutions=this.resolutionsFromScales(g.scales);}if(g.resolutions==null){g.resolutions=this.calculateResolutions(g);}if(g.resolutions==null){for(f=0,a=this.RESOLUTION_PROPERTIES.length;f<a;f++){var j=this.RESOLUTION_PROPERTIES[f];g[j]=this.options[j]!=null?this.options[j]:this.map[j];}if(g.resolutions==null){g.resolutions=this.resolutionsFromScales(g.scales);}if(g.resolutions==null){g.resolutions=this.calculateResolutions(g);}}var d;if(this.options.maxResolution&&this.options.maxResolution!=="auto"){d=this.options.maxResolution;}if(this.options.minScale){d=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units);}var b;if(this.options.minResolution&&this.options.minResolution!=="auto"){b=this.options.minResolution;}if(this.options.maxScale){b=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units);}if(g.resolutions){g.resolutions.sort(function(m,l){return(l-m);});if(!d){d=g.resolutions[0];}if(!b){var h=g.resolutions.length-1;b=g.resolutions[h];}}this.resolutions=g.resolutions;if(this.resolutions){a=this.resolutions.length;this.scales=new Array(a);for(f=0;f<a;f++){this.scales[f]=OpenLayers.Util.getScaleFromResolution(this.resolutions[f],this.units);}this.numZoomLevels=a;}this.minResolution=b;if(b){this.maxScale=OpenLayers.Util.getScaleFromResolution(b,this.units);}this.maxResolution=d;if(d){this.minScale=OpenLayers.Util.getScaleFromResolution(d,this.units);}},resolutionsFromScales:function(b){if(b==null){return;}var e,a,d;d=b.length;e=new Array(d);for(a=0;a<d;a++){e[a]=OpenLayers.Util.getResolutionFromScale(b[a],this.units);}return e;},calculateResolutions:function(m){var b=m.maxResolution;if(m.minScale!=null){b=OpenLayers.Util.getResolutionFromScale(m.minScale,this.units);}else{if(b=="auto"&&this.maxExtent!=null){var q=this.map.getSize();var j=this.maxExtent.getWidth()/q.w;var g=this.maxExtent.getHeight()/q.h;b=Math.max(j,g);}}var f=m.minResolution;if(m.maxScale!=null){f=OpenLayers.Util.getResolutionFromScale(m.maxScale,this.units);
}else{if(m.minResolution=="auto"&&this.minExtent!=null){var q=this.map.getSize();var j=this.minExtent.getWidth()/q.w;var g=this.minExtent.getHeight()/q.h;f=Math.max(j,g);}}var l=m.maxZoomLevel;var o=m.numZoomLevels;if(typeof f==="number"&&typeof b==="number"&&o===undefined){var h=b/f;o=Math.floor(Math.log(h)/Math.log(2))+1;}else{if(o===undefined&&l!=null){o=l+1;}}if(typeof o!=="number"||o<=0||(typeof b!=="number"&&typeof f!=="number")){return;}var d=new Array(o);var a=2;if(typeof f=="number"&&typeof b=="number"){a=Math.pow((b/f),(1/(o-1)));}var e;if(typeof b==="number"){for(e=0;e<o;e++){d[e]=b/Math.pow(a,e);}}else{for(e=0;e<o;e++){d[o-1-e]=f*Math.pow(a,e);}}return d;},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a);},getExtent:function(){return this.map.calculateBounds();},getZoomForExtent:function(e,a){var b=this.map.getSize();var d=Math.max(e.getWidth()/b.w,e.getHeight()/b.h);return this.getZoomForResolution(d,a);},getDataExtent:function(){},getResolutionForZoom:function(a){a=Math.max(0,Math.min(a,this.resolutions.length-1));var e;if(this.map.fractionalZoom){var d=Math.floor(a);var b=Math.ceil(a);e=this.resolutions[d]-((a-d)*(this.resolutions[d]-this.resolutions[b]));}else{e=this.resolutions[Math.round(a)];}return e;},getZoomForResolution:function(a,g){var r;if(this.map.fractionalZoom){var h=0;var o=this.resolutions.length-1;var q=this.resolutions[h];var l=this.resolutions[o];var f;for(var b=0,d=this.resolutions.length;b<d;++b){f=this.resolutions[b];if(f>=a){q=f;h=b;}if(f<=a){l=f;o=b;break;}}var e=q-l;if(e>0){r=h+((q-a)/e);}else{r=h;}}else{var j;var m=Number.POSITIVE_INFINITY;for(var b=0,d=this.resolutions.length;b<d;b++){if(g){j=Math.abs(this.resolutions[b]-a);if(j>m){break;}m=j;}else{if(this.resolutions[b]<a){break;}}}r=Math.max(0,b-1);}return r;},getLonLatFromViewPortPx:function(d){var g=null;if(d!=null){var f=this.map.getSize();var b=this.map.getCenter();if(b){var e=this.map.getResolution();var a=d.x-(f.w/2);var h=d.y-(f.h/2);g=new OpenLayers.LonLat(b.lon+a*e,b.lat-h*e);if(this.wrapDateLine){g=g.wrapDateLine(this.maxExtent);}}}return g;},getViewPortPxFromLonLat:function(b){var e=null;if(b!=null){var d=this.map.getResolution();var a=this.map.getExtent();e=new OpenLayers.Pixel((1/d*(b.lon-a.left)),(1/d*(a.top-b.lat)));}return e;},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var b=0,d=this.div.childNodes.length;b<d;++b){var a=this.div.childNodes[b].firstChild;OpenLayers.Util.modifyDOMElement(a,null,null,null,null,null,null,e);}if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"});}}},getZIndex:function(){return this.div.style.zIndex;},setZIndex:function(a){this.div.style.zIndex=a;},adjustBounds:function(d){if(this.gutter){var b=this.gutter*this.map.getResolution();d=new OpenLayers.Bounds(d.left-b,d.bottom-b,d.right+b,d.top+b);}if(this.wrapDateLine){var a={rightTolerance:this.getResolution()};d=d.wrapDateLine(this.maxExtent,a);}return d;},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(b,e,d,f,a){this.layer=b;this.position=e.clone();this.bounds=d.clone();this.url=f;this.size=a.clone();this.id=OpenLayers.Util.createUniqueID("Tile_");this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload");}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.events.destroy();this.events=null;},clone:function(a){if(a==null){a=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size);}OpenLayers.Util.applyDefaults(a,this);return a;},draw:function(){var a=this.layer.maxExtent;var b=(a&&this.bounds.intersectsBounds(a,false));this.shouldDraw=(b||this.layer.displayOutsideMaxExtent);this.clear();return this.shouldDraw;},moveTo:function(d,b,a){if(a==null){a=true;}this.bounds=d.clone();this.position=b.clone();if(a){this.draw();}},clear:function(){},getBoundsFromBaseLayer:function(d){var b=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(b);var g=this.layer.map.getLonLatFromLayerPx(d);var f=d.clone();f.x+=this.size.w;f.y+=this.size.h;var e=this.layer.map.getLonLatFromLayerPx(f);if(g.lon>e.lon){if(g.lon<0){g.lon=-180-(g.lon+180);}else{e.lon=180+e.lon+180;}}var a=new OpenLayers.Bounds(g.lon,e.lat,e.lon,g.lat);return a;},showTile:function(){if(this.shouldDraw){this.show();}},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:false,lastRatio:1,isFirstDraw:true,backBufferTile:null,initialize:function(b,e,d,f,a){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=f;this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute";this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();},destroy:function(){if(this.imgDiv!=null){if(this.layerAlphaHack){OpenLayers.Event.stopObservingElement(this.imgDiv.childNodes[0]);}OpenLayers.Event.stopObservingElement(this.imgDiv);if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null;}this.imgDiv.urls=null;this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif";}this.imgDiv=null;if((this.frame!=null)&&(this.frame.parentNode==this.layer.div)){this.layer.div.removeChild(this.frame);}this.frame=null;if(this.backBufferTile){this.backBufferTile.destroy();this.backBufferTile=null;}this.layer.events.unregister("loadend",this,this.resetBackBuffer);OpenLayers.Tile.prototype.destroy.apply(this,arguments);},clone:function(a){if(a==null){a=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size);}a=OpenLayers.Tile.prototype.clone.apply(this,[a]);a.imgDiv=null;return a;},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position);}var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if((OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1)||this.layer.singleTile){if(a){if(!this.backBufferTile){this.backBufferTile=this.clone();this.backBufferTile.hide();this.backBufferTile.isBackBuffer=true;this.events.register("loadend",this,this.resetBackBuffer);this.layer.events.register("loadend",this,this.resetBackBuffer);}this.startTransition();}else{if(this.backBufferTile){this.backBufferTile.clear();}}}else{if(a&&this.isFirstDraw){this.events.register("loadend",this,this.showTile);this.isFirstDraw=false;}}if(!a){return false;}if(this.isLoading){this.events.triggerEvent("reload");}else{this.isLoading=true;this.events.triggerEvent("loadstart");}return this.renderTile();},resetBackBuffer:function(){this.showTile();if(this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=false;var a=this.layer.maxExtent;var b=(a&&this.bounds.intersectsBounds(a,false));if(b){this.backBufferTile.position=this.position;this.backBufferTile.bounds=this.bounds;this.backBufferTile.size=this.size;this.backBufferTile.imageSize=this.layer.getImageSize(this.bounds)||this.size;this.backBufferTile.imageOffset=this.layer.imageOffset;this.backBufferTile.resolution=this.layer.getResolution();this.backBufferTile.renderTile();}this.backBufferTile.hide();}},renderTile:function(){if(this.imgDiv==null){this.initImgDiv();}this.imgDiv.viewRequestID=this.layer.map.viewRequestID;if(this.layer.async){this.layer.getURLasync(this.bounds,this,"url",this.positionImage);}else{if(this.layer.url instanceof Array){this.imgDiv.urls=this.layer.url.slice();}this.url=this.layer.getURL(this.bounds);this.positionImage();}return true;},positionImage:function(){if(this.layer===null){return;}OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);
var a=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,a,this.url);}else{OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,a);this.imgDiv.src=this.url;}},clear:function(){if(this.imgDiv){this.hide();if(OpenLayers.Tile.Image.useBlankTile){this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif";}}},initImgDiv:function(){var b=this.layer.imageOffset;var e=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,b,e,null,"relative",null,null,null,true);}else{this.imgDiv=OpenLayers.Util.createImage(null,b,e,null,"relative",null,null,true);}this.imgDiv.className="olTileImage";this.frame.style.zIndex=this.isBackBuffer?0:1;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity);}this.imgDiv.map=this.layer.map;var a=function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend");}};if(this.layerAlphaHack){OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(a,this));}else{OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(a,this));}var d=function(){if(this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS){a.call(this);}};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(d,this));},checkImgURL:function(){if(this.layer){var a=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;if(!OpenLayers.Util.isEquivalentUrl(a,this.url)){this.hide();}}},startTransition:function(){if(!this.backBufferTile||!this.backBufferTile.imgDiv){return;}var g=1;if(this.backBufferTile.resolution){g=this.backBufferTile.resolution/this.layer.getResolution();}if(g!=this.lastRatio){if(this.layer.transitionEffect=="resize"){var f=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top);var e=new OpenLayers.Size(this.backBufferTile.size.w*g,this.backBufferTile.size.h*g);var d=this.layer.map.getLayerPxFromLonLat(f);OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,d,e);var a=this.backBufferTile.imageSize;a=new OpenLayers.Size(a.w*g,a.h*g);var b=this.backBufferTile.imageOffset;if(b){b=new OpenLayers.Pixel(b.x*g,b.y*g);}OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,b,a);this.backBufferTile.show();}}else{if(this.layer.singleTile){this.backBufferTile.show();}else{this.backBufferTile.hide();}}this.lastRatio=g;},show:function(){this.frame.style.display="";if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.frame.scrollLeft=this.frame.scrollLeft;}}},hide:function(){this.frame.style.display="none";},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.useBlankTile=(OpenLayers.Util.getBrowserName()=="safari"||OpenLayers.Util.getBrowserName()=="opera");OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(a,f,d,b,e){this.url=f;this.extent=d;this.maxExtent=d;this.size=b;OpenLayers.Layer.prototype.initialize.apply(this,[a,e]);this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w);},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null;}OpenLayers.Layer.prototype.destroy.apply(this,arguments);},clone:function(a){if(a==null){a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions());}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a;},setMap:function(a){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w;}OpenLayers.Layer.prototype.setMap.apply(this,arguments);},moveTo:function(a,d,b){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var e=(this.tile==null);if(d||e){this.setTileSize();var g=new OpenLayers.LonLat(this.extent.left,this.extent.top);var f=this.map.getLayerPxFromLonLat(g);if(e){this.tile=new OpenLayers.Tile.Image(this,f,this.extent,null,this.tileSize);this.addTileMonitoringHooks(this.tile);}else{this.tile.size=this.tileSize.clone();this.tile.position=f.clone();}this.tile.draw();}},setTileSize:function(){var b=this.extent.getWidth()/this.map.getResolution();var a=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(b,a);},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("loadstart");};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.events.triggerEvent("loadend");};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd);},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this});},setUrl:function(a){this.url=a;this.tile.draw();},getURL:function(a){return this.url;},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(a!=null){this.addComponents(a);}},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments);},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");for(var i=0,len=this.components.length;i<len;i++){geometry.addComponent(this.components[i].clone());}OpenLayers.Util.applyDefaults(geometry,this);return geometry;},getComponentsString:function(){var d=[];for(var a=0,b=this.components.length;a<b;a++){d.push(this.components[a].toShortString());}return d.join(",");},calculateBounds:function(){this.bounds=null;if(this.components&&this.components.length>0){this.setBounds(this.components[0].getBounds());for(var b=1,a=this.components.length;b<a;b++){this.extendBounds(this.components[b].getBounds());}}},addComponents:function(a){if(!(a instanceof Array)){a=[a];}for(var d=0,b=a.length;d<b;d++){this.addComponent(a[d]);}},addComponent:function(f,e){var b=false;if(f){if(this.componentTypes==null||(OpenLayers.Util.indexOf(this.componentTypes,f.CLASS_NAME)>-1)){if(e!=null&&(e<this.components.length)){var d=this.components.slice(0,e);var a=this.components.slice(e,this.components.length);d.push(f);this.components=d.concat(a);}else{this.components.push(f);}f.parent=this;this.clearBounds();b=true;}}return b;},removeComponents:function(b){if(!(b instanceof Array)){b=[b];}for(var a=b.length-1;a>=0;--a){this.removeComponent(b[a]);}},removeComponent:function(a){OpenLayers.Util.removeItem(this.components,a);this.clearBounds();},getLength:function(){var a=0;for(var d=0,b=this.components.length;d<b;d++){a+=this.components[d].getLength();}return a;},getArea:function(){var a=0;for(var d=0,b=this.components.length;d<b;d++){a+=this.components[d].getArea();}return a;},getGeodesicArea:function(e){var b=0;for(var a=0,d=this.components.length;a<d;a++){b+=this.components[a].getGeodesicArea(e);}return b;},getCentroid:function(g){if(!g){return this.components.length&&this.components[0].getCentroid();}var q=this.components.length;if(!q){return false;}var o=[];var a=[];var d=0;var h=Number.MAX_VALUE;var b;for(var m=0;m<q;++m){b=this.components[m];var e=b.getArea();var f=b.getCentroid(true);if(isNaN(e)||isNaN(f.x)||isNaN(f.y)){continue;}o.push(e);d+=e;h=(e<h&&e>0)?e:h;a.push(f);}q=o.length;if(d===0){for(var m=0;m<q;++m){o[m]=1;}d=o.length;}else{for(var m=0;m<q;++m){o[m]/=h;}d/=h;}var j=0,l=0,f,e;for(var m=0;m<q;++m){f=a[m];e=o[m];j+=f.x*e;l+=f.y*e;}return new OpenLayers.Geometry.Point(j/d,l/d);},getGeodesicLength:function(e){var b=0;for(var a=0,d=this.components.length;a<d;a++){b+=this.components[a].getGeodesicLength(e);}return b;},move:function(e,b){for(var a=0,d=this.components.length;a<d;a++){this.components[a].move(e,b);
}},rotate:function(b,e){for(var a=0,d=this.components.length;a<d;++a){this.components[a].rotate(b,e);}},resize:function(b,d,a){for(var e=0;e<this.components.length;++e){this.components[e].resize(b,d,a);}return this;},distanceTo:function(a,b){var g=!(b&&b.edge===false);var d=g&&b&&b.details;var e,h,f;var j=Number.POSITIVE_INFINITY;for(var l=0,m=this.components.length;l<m;++l){e=this.components[l].distanceTo(a,b);f=d?e.distance:e;if(f<j){j=f;h=e;if(j==0){break;}}}return h;},equals:function(b){var e=true;if(!b||!b.CLASS_NAME||(this.CLASS_NAME!=b.CLASS_NAME)){e=false;}else{if(!(b.components instanceof Array)||(b.components.length!=this.components.length)){e=false;}else{for(var a=0,d=this.components.length;a<d;++a){if(!this.components[a].equals(b.components[a])){e=false;break;}}}}return e;},transform:function(d,a){if(d&&a){for(var b=0,e=this.components.length;b<e;b++){var f=this.components[b];f.transform(d,a);}this.bounds=null;}return this;},intersects:function(b){var e=false;for(var a=0,d=this.components.length;a<d;++a){e=b.intersects(this.components[a]);if(e){break;}}return e;},getVertices:function(e){var a=[];for(var b=0,d=this.components.length;b<d;++b){Array.prototype.push.apply(a,this.components[b].getVertices(e));}return a;},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b);},clone:function(a){if(a==null){a=new OpenLayers.Geometry.Point(this.x,this.y);}OpenLayers.Util.applyDefaults(a,this);return a;},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y);},distanceTo:function(l,e){var h=!(e&&e.edge===false);var d=h&&e&&e.details;var f,j,a,g,m,b;if(l instanceof OpenLayers.Geometry.Point){j=this.x;a=this.y;g=l.x;m=l.y;f=Math.sqrt(Math.pow(j-g,2)+Math.pow(a-m,2));b=!d?f:{x0:j,y0:a,x1:g,y1:m,distance:f};}else{b=l.distanceTo(this,e);if(d){b={x0:b.x1,y0:b.y1,x1:b.x0,y1:b.y0,distance:b.distance};}}return b;},equals:function(a){var b=false;if(a!=null){b=((this.x==a.x&&this.y==a.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)));}return b;},toShortString:function(){return(this.x+", "+this.y);},move:function(a,b){this.x=this.x+a;this.y=this.y+b;this.clearBounds();},rotate:function(b,e){b*=Math.PI/180;var d=this.distanceTo(e);var a=b+Math.atan2(this.y-e.y,this.x-e.x);this.x=e.x+(d*Math.cos(a));this.y=e.y+(d*Math.sin(a));this.clearBounds();},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y);},resize:function(a,b,d){d=(d==undefined)?1:d;this.x=b.x+(a*d*(this.x-b.x));this.y=b.y+(a*(this.y-b.y));this.clearBounds();return this;},intersects:function(b){var a=false;if(b.CLASS_NAME=="OpenLayers.Geometry.Point"){a=this.equals(b);}else{a=b.intersects(this);}return a;},transform:function(b,a){if((b&&a)){OpenLayers.Projection.transform(this,b,a);this.bounds=null;}return this;},getVertices:function(a){return[this];},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},addPoint:function(a,b){this.addComponent(a,b);},removePoint:function(a){this.removeComponent(a);},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments);},getLength:function(){var a=0;if(this.components&&(this.components.length>1)){for(var d=1,b=this.components.length;d<b;d++){a+=this.components[d-1].distanceTo(this.components[d]);}}return a;},getGeodesicLength:function(b){var f=this;if(b){var d=new OpenLayers.Projection("EPSG:4326");if(!d.equals(b)){f=this.clone().transform(b,d);}}var g=0;if(f.components&&(f.components.length>1)){var j,h;for(var e=1,a=f.components.length;e<a;e++){j=f.components[e-1];h=f.components[e];g+=OpenLayers.Util.distVincenty({lon:j.x,lat:j.y},{lon:h.x,lat:h.y});}}return g*1000;},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(a){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments);},removeComponent:function(a){if(this.components&&(this.components.length>2)){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);}},intersects:function(m){var s=false;var d=m.CLASS_NAME;if(d=="OpenLayers.Geometry.LineString"||d=="OpenLayers.Geometry.LinearRing"||d=="OpenLayers.Geometry.Point"){var g=this.getSortedSegments();var e;if(d=="OpenLayers.Geometry.Point"){e=[{x1:m.x,y1:m.y,x2:m.x,y2:m.y}];}else{e=m.getSortedSegments();}var o,w,u,q,l,h,t,r;outer:for(var a=0,b=g.length;a<b;++a){o=g[a];w=o.x1;u=o.x2;q=o.y1;l=o.y2;inner:for(var v=0,f=e.length;v<f;++v){h=e[v];if(h.x1>u){break;}if(h.x2<w){continue;}t=h.y1;r=h.y2;if(Math.min(t,r)>Math.max(q,l)){continue;}if(Math.max(t,r)<Math.min(q,l)){continue;}if(OpenLayers.Geometry.segmentsIntersect(o,h)){s=true;break outer;}}}}else{s=m.intersects(this);}return s;},getSortedSegments:function(){var d=this.components.length-1;var e=new Array(d),a,g;for(var f=0;f<d;++f){a=this.components[f];g=this.components[f+1];if(a.x<g.x){e[f]={x1:a.x,y1:a.y,x2:g.x,y2:g.y};}else{e[f]={x1:g.x,y1:g.y,x2:a.x,y2:a.y};}}function b(j,h){return j.x1-h.x1;}return e.sort(b);},splitWithSegment:function(z,b){var d=!(b&&b.edge===false);var u=b&&b.tolerance;var a=[];var C=this.getVertices();var s=[];var t=[];var j=false;var f,e,o;var l,w,q;var g={point:true,tolerance:u};var h=null;for(var r=0,m=C.length-2;r<=m;++r){f=C[r];s.push(f.clone());e=C[r+1];q={x1:f.x,y1:f.y,x2:e.x,y2:e.y};o=OpenLayers.Geometry.segmentsIntersect(z,q,g);if(o instanceof OpenLayers.Geometry.Point){if((o.x===z.x1&&o.y===z.y1)||(o.x===z.x2&&o.y===z.y2)||o.equals(f)||o.equals(e)){w=true;}else{w=false;}if(w||d){if(!o.equals(t[t.length-1])){t.push(o.clone());}if(r===0){if(o.equals(f)){continue;}}if(o.equals(e)){continue;}j=true;if(!o.equals(f)){s.push(o);}a.push(new OpenLayers.Geometry.LineString(s));s=[o.clone()];}}}if(j){s.push(e.clone());a.push(new OpenLayers.Geometry.LineString(s));}if(t.length>0){var v=z.x1<z.x2?1:-1;var B=z.y1<z.y2?1:-1;h={lines:a,points:t.sort(function(E,D){return(v*E.x-v*D.x)||(B*E.y-B*D.y);})};}return h;},split:function(u,b){var q=null;var e=b&&b.mutual;var m,f,o,d;if(u instanceof OpenLayers.Geometry.LineString){var s=this.getVertices();var h,g,r,l,a,v;var B=[];o=[];for(var C=0,t=s.length-2;C<=t;++C){h=s[C];g=s[C+1];r={x1:h.x,y1:h.y,x2:g.x,y2:g.y};d=d||[u];if(e){B.push(h.clone());}for(var z=0;z<d.length;++z){l=d[z].splitWithSegment(r,b);if(l){a=l.lines;if(a.length>0){a.unshift(z,1);Array.prototype.splice.apply(d,a);z+=a.length-2;}if(e){for(var w=0,D=l.points.length;w<D;++w){v=l.points[w];if(!v.equals(h)){B.push(v);o.push(new OpenLayers.Geometry.LineString(B));if(v.equals(g)){B=[];}else{B=[v.clone()];}}}}}}}if(e&&o.length>0&&B.length>0){B.push(g.clone());o.push(new OpenLayers.Geometry.LineString(B));}}else{q=u.splitWith(this,b);}if(d&&d.length>1){f=true;}else{d=[];}if(o&&o.length>1){m=true;}else{o=[];}if(f||m){if(e){q=[o,d];}else{q=d;}}return q;},splitWith:function(b,a){return b.split(this,a);},getVertices:function(a){var b;if(a===true){b=[this.components[0],this.components[this.components.length-1]];}else{if(a===false){b=this.components.slice(1,this.components.length-1);}else{b=this.components.slice();}}return b;},distanceTo:function(b,a){var d=!(a&&a.edge===false);var v=d&&a&&a.details;var s,F={};var z=Number.POSITIVE_INFINITY;if(b instanceof OpenLayers.Geometry.Point){var u=this.getSortedSegments();var q=b.x;var o=b.y;var r;for(var h=0,m=u.length;h<m;++h){r=u[h];s=OpenLayers.Geometry.distanceToSegment(b,r);if(s.distance<z){z=s.distance;F=s;if(z===0){break;}}else{if(r.x2>q&&((o>r.y1&&o<r.y2)||(o<r.y1&&o>r.y2))){break;
}}}if(v){F={distance:F.distance,x0:F.x,y0:F.y,x1:q,y1:o};}else{F=F.distance;}}else{if(b instanceof OpenLayers.Geometry.LineString){var E=this.getSortedSegments();var D=b.getSortedSegments();var C,B,l,t,G;var f=D.length;var e={point:true};outer:for(var h=0,m=E.length;h<m;++h){C=E[h];t=C.x1;G=C.y1;for(var g=0;g<f;++g){B=D[g];l=OpenLayers.Geometry.segmentsIntersect(C,B,e);if(l){z=0;F={distance:0,x0:l.x,y0:l.y,x1:l.x,y1:l.y};break outer;}else{s=OpenLayers.Geometry.distanceToSegment({x:t,y:G},B);if(s.distance<z){z=s.distance;F={distance:z,x0:t,y0:G,x1:s.x,y1:s.y};}}}}if(!v){F=F.distance;}if(z!==0){if(C){s=b.distanceTo(new OpenLayers.Geometry.Point(C.x2,C.y2),a);var w=v?s.distance:s;if(w<z){if(v){F={distance:z,x0:s.x1,y0:s.y1,x1:s.x0,y1:s.y0};}else{F=w;}}}}}else{F=b.distanceTo(this,a);if(v){F={distance:F.distance,x0:F.x1,y0:F.y1,x1:F.x0,y1:F.y0};}}}return F;},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments);},addComponent:function(e,f){var a=false;var b=this.components.pop();if(f!=null||!e.equals(b)){a=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments);}var d=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[d]);return a;},removeComponent:function(a){if(this.components.length>4){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var b=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[b]);}},move:function(e,b){for(var a=0,d=this.components.length;a<d-1;a++){this.components[a].move(e,b);}},rotate:function(b,e){for(var a=0,d=this.components.length;a<d-1;++a){this.components[a].rotate(b,e);}},resize:function(d,f,b){for(var a=0,e=this.components.length;a<e-1;++a){this.components[a].resize(d,f,b);}return this;},transform:function(d,a){if(d&&a){for(var b=0,e=this.components.length;b<e-1;b++){var f=this.components[b];f.transform(d,a);}this.bounds=null;}return this;},getCentroid:function(){if(this.components&&(this.components.length>2)){var j=0;var h=0;for(var f=0;f<this.components.length-1;f++){var e=this.components[f];var d=this.components[f+1];j+=(e.x+d.x)*(e.x*d.y-d.x*e.y);h+=(e.y+d.y)*(e.x*d.y-d.x*e.y);}var g=-1*this.getArea();var a=j/(6*g);var l=h/(6*g);return new OpenLayers.Geometry.Point(a,l);}else{return null;}},getArea:function(){var e=0;if(this.components&&(this.components.length>2)){var d=0;for(var h=0,g=this.components.length;h<g-1;h++){var a=this.components[h];var f=this.components[h+1];d+=(a.x+f.x)*(f.y-a.y);}e=-d/2;}return e;},getGeodesicArea:function(b){var e=this;if(b){var d=new OpenLayers.Projection("EPSG:4326");if(!d.equals(b)){e=this.clone().transform(b,d);}}var g=0;var a=e.components&&e.components.length;if(a>2){var j,h;for(var f=0;f<a-1;f++){j=e.components[f];h=e.components[f+1];g+=OpenLayers.Util.rad(h.x-j.x)*(2+Math.sin(OpenLayers.Util.rad(j.y))+Math.sin(OpenLayers.Util.rad(h.y)));}g=g*6378137*6378137/2;}return g;},containsPoint:function(r){var l=OpenLayers.Number.limitSigDigs;var q=14;var o=l(r.x,q);var m=l(r.y,q);function w(B,C,z,D,E){return(((C-D)*B)+((D*z)-(C*E)))/(z-E);}var a=this.components.length-1;var h,g,v,e,t,b,f,d;var j=0;for(var s=0;s<a;++s){h=this.components[s];v=l(h.x,q);e=l(h.y,q);g=this.components[s+1];t=l(g.x,q);b=l(g.y,q);if(e==b){if(m==e){if(v<=t&&(o>=v&&o<=t)||v>=t&&(o<=v&&o>=t)){j=-1;break;}}continue;}f=l(w(m,v,e,t,b),q);if(f==o){if(e<b&&(m>=e&&m<=b)||e>b&&(m<=e&&m>=b)){j=-1;break;}}if(f<=o){continue;}if(v!=t&&(f<Math.min(v,t)||f>Math.max(v,t))){continue;}if(e<b&&(m>=e&&m<b)||e>b&&(m<e&&m>=b)){++j;}}var u=(j==-1)?1:!!(j&1);return u;},intersects:function(b){var e=false;if(b.CLASS_NAME=="OpenLayers.Geometry.Point"){e=this.containsPoint(b);}else{if(b.CLASS_NAME=="OpenLayers.Geometry.LineString"){e=b.intersects(this);}else{if(b.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){e=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[b]);}else{for(var a=0,d=b.components.length;a<d;++a){e=b.components[a].intersects(this);if(e){break;}}}}}return e;},getVertices:function(a){return(a===true)?[]:this.components.slice(0,this.components.length-1);},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(b,e,d){OpenLayers.Util.extend(this,d);this.control=b;this.callbacks=e;var a=this.map||b.map;if(a){this.setMap(a);}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},setMap:function(a){this.map=a;},checkModifiers:function(a){if(this.keyMask==null){return true;}var b=(a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0);return(b==this.keyMask);},activate:function(){if(this.active){return false;}var a=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var d=0,b=a.length;d<b;d++){if(this[a[d]]){this.register(a[d],this[a[d]]);}}this.active=true;return true;},deactivate:function(){if(!this.active){return false;}var a=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var d=0,b=a.length;d<b;d++){if(this[a[d]]){this.unregister(a[d],this[a[d]]);}}this.active=false;return true;},callback:function(b,a){if(b&&this.callbacks[b]){this.callbacks[b].apply(this.control,a);}},register:function(a,b){this.map.events.registerPriority(a,this,b);this.map.events.registerPriority(a,this,this.setEvent);},unregister:function(a,b){this.map.events.unregister(a,this,b);this.map.events.unregister(a,this,this.setEvent);},setEvent:function(a){this.evt=a;return true;},destroy:function(){this.deactivate();this.control=this.map=null;},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,drawing:false,mouseDown:false,lastDown:null,lastUp:null,persist:false,layerOptions:null,initialize:function(a,d,b){if(!(b&&b.layerOptions&&b.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{});}OpenLayers.Handler.prototype.initialize.apply(this,arguments);},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false;}var a=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);return true;},createFeature:function(a){var b=this.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true});},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false;}if(this.drawing){this.cancel();}this.destroyFeature();if(this.layer.map!=null){this.layer.destroy(false);}this.layer=null;return true;},destroyFeature:function(){if(this.layer){this.layer.destroyFeatures();}this.point=null;},finalize:function(b){var a=b?"cancel":"done";this.drawing=false;this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.callback(a,[this.geometryClone()]);if(b||!this.persist){this.destroyFeature();}},cancel:function(){this.finalize(true);},click:function(a){OpenLayers.Event.stop(a);return false;},dblclick:function(a){OpenLayers.Event.stop(a);return false;},modifyFeature:function(a){var b=this.map.getLonLatFromPixel(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.drawFeature();},drawFeature:function(){this.layer.drawFeature(this.point,this.style);},getGeometry:function(){var a=this.point&&this.point.geometry;
if(a&&this.multi){a=new OpenLayers.Geometry.MultiPoint([a]);}return a;},geometryClone:function(){var a=this.getGeometry();return a&&a.clone();},mousedown:function(a){if(!this.checkModifiers(a)){return true;}if(this.lastDown&&this.lastDown.equals(a.xy)){return true;}this.drawing=true;if(this.lastDown==null){if(this.persist){this.destroyFeature();}this.createFeature(a.xy);}else{this.modifyFeature(a.xy);}this.lastDown=a.xy;return false;},mousemove:function(a){if(this.drawing){this.modifyFeature(a.xy);}return true;},mouseup:function(a){if(this.drawing){this.finalize();return false;}else{return true;}},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,freehand:false,freehandToggle:"shiftKey",initialize:function(a,d,b){OpenLayers.Handler.Point.prototype.initialize.apply(this,arguments);},createFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:true});},destroyFeature:function(){OpenLayers.Handler.Point.prototype.destroyFeature.apply(this);this.line=null;},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point]);}},addPoint:function(a){this.layer.removeFeatures([this.point]);var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();},freehandMode:function(a){return(this.freehandToggle&&a[this.freehandToggle])?!this.freehand:this.freehand;},modifyFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.drawFeature();},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style);},getSketch:function(){return this.line;},getGeometry:function(){var a=this.line&&this.line.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiLineString([a]);}return a;},mousedown:function(a){if(this.lastDown&&this.lastDown.equals(a.xy)){return false;}if(this.lastDown==null){if(this.persist){this.destroyFeature();}this.createFeature(a.xy);}else{if((this.lastUp==null)||!this.lastUp.equals(a.xy)){this.addPoint(a.xy);}}this.mouseDown=true;this.lastDown=a.xy;this.drawing=true;return false;},mousemove:function(a){if(this.drawing){if(this.mouseDown&&this.freehandMode(a)){this.addPoint(a.xy);}else{this.modifyFeature(a.xy);}}return true;},mouseup:function(a){this.mouseDown=false;if(this.drawing){if(this.freehandMode(a)){this.removePoint();this.finalize();}else{if(this.lastUp==null){this.addPoint(a.xy);}this.lastUp=a.xy;}return false;}return true;},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[b]);this.removePoint();this.finalize();}return false;},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},getArea:function(){var a=0;if(this.components&&(this.components.length>0)){a+=Math.abs(this.components[0].getArea());for(var d=1,b=this.components.length;d<b;d++){a-=Math.abs(this.components[d].getArea());}}return a;},getGeodesicArea:function(e){var b=0;if(this.components&&(this.components.length>0)){b+=Math.abs(this.components[0].getGeodesicArea(e));for(var a=1,d=this.components.length;a<d;a++){b-=Math.abs(this.components[a].getGeodesicArea(e));}}return b;},containsPoint:function(e){var d=this.components.length;var a=false;if(d>0){a=this.components[0].containsPoint(e);if(a!==1){if(a&&d>1){var b;for(var f=1;f<d;++f){b=this.components[f].containsPoint(e);if(b){if(b===1){a=1;}else{a=false;}break;}}}}}return a;},intersects:function(d){var f=false;var b,e;if(d.CLASS_NAME=="OpenLayers.Geometry.Point"){f=this.containsPoint(d);}else{if(d.CLASS_NAME=="OpenLayers.Geometry.LineString"||d.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(b=0,e=this.components.length;b<e;++b){f=d.intersects(this.components[b]);if(f){break;}}if(!f){for(b=0,e=d.components.length;b<e;++b){f=this.containsPoint(d.components[b]);if(f){break;}}}}else{for(b=0,e=d.components.length;b<e;++b){f=this.intersects(d.components[b]);if(f){break;}}}}if(!f&&d.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var a=this.components[0];for(b=0,e=a.components.length;b<e;++b){f=d.containsPoint(a.components[b]);if(f){break;}}}return f;},distanceTo:function(b,e){var a=!(e&&e.edge===false);var d;if(!a&&this.intersects(b)){d=0;}else{d=OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[b,e]);}return d;},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(o,j,d,e){var f=Math.PI*((1/d)-(1/2));if(e){f+=(e/180)*Math.PI;}var b,m,l;var a=[];for(var h=0;h<d;++h){b=f+(h*2*Math.PI/d);m=o.x+(j*Math.cos(b));l=o.y+(j*Math.sin(b));a.push(new OpenLayers.Geometry.Point(m,l));}var g=new OpenLayers.Geometry.LinearRing(a);return new OpenLayers.Geometry.Polygon([g]);};OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{polygon:null,initialize:function(a,d,b){OpenLayers.Handler.Path.prototype.initialize.apply(this,arguments);},createFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:true});},destroyFeature:function(){OpenLayers.Handler.Path.prototype.destroyFeature.apply(this);this.polygon=null;},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style);},getSketch:function(){return this.polygon;},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiPolygon([a]);}return a;},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[b]);this.removePoint();this.finalize();}return false;},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},split:function(r,m){var a=null;var l=m&&m.mutual;var e,o,g,h,q;var u=[];var f=[r];for(var v=0,b=this.components.length;v<b;++v){o=this.components[v];h=false;for(var t=0;t<f.length;++t){e=o.split(f[t],m);if(e){if(l){g=e[0];for(var s=0,d=g.length;s<d;++s){if(s===0&&u.length){u[u.length-1].addComponent(g[s]);}else{u.push(new OpenLayers.Geometry.MultiLineString([g[s]]));}}h=true;e=e[1];}if(e.length){e.unshift(t,1);Array.prototype.splice.apply(f,e);break;}}}if(!h){if(u.length){u[u.length-1].addComponent(o.clone());}else{u=[new OpenLayers.Geometry.MultiLineString(o.clone())];}}}if(u&&u.length>1){h=true;}else{u=[];}if(f&&f.length>1){q=true;}else{f=[];}if(h||q){if(l){a=[u,f];}else{a=f;}}return a;},splitWith:function(r,m){var a=null;var l=m&&m.mutual;
var e,s,g,h,o,u,f;if(r instanceof OpenLayers.Geometry.LineString){f=[];u=[r];for(var v=0,b=this.components.length;v<b;++v){o=false;s=this.components[v];for(var t=0;t<u.length;++t){e=u[t].split(s,m);if(e){if(l){g=e[0];if(g.length){g.unshift(t,1);Array.prototype.splice.apply(u,g);t+=g.length-2;}e=e[1];if(e.length===0){e=[s.clone()];}}for(var q=0,d=e.length;q<d;++q){if(q===0&&f.length){f[f.length-1].addComponent(e[q]);}else{f.push(new OpenLayers.Geometry.MultiLineString([e[q]]));}}o=true;}}if(!o){if(f.length){f[f.length-1].addComponent(s.clone());}else{f=[new OpenLayers.Geometry.MultiLineString([s.clone()])];}}}}else{a=r.split(this);}if(u&&u.length>1){h=true;}else{u=[];}if(f&&f.length>1){o=true;}else{f=[];}if(h||o){if(l){a=[u,f];}else{a=f;}}return a;},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:false,initialize:function(a){OpenLayers.Format.JSON.prototype.initialize.apply(this,[a]);},read:function(e,b,f){b=(b)?b:"FeatureCollection";var j=null;var h=null;if(typeof e=="string"){h=OpenLayers.Format.JSON.prototype.read.apply(this,[e,f]);}else{h=e;}if(!h){OpenLayers.Console.error("Bad JSON: "+e);}else{if(typeof(h.type)!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+e);}else{if(this.isValidType(h,b)){switch(b){case"Geometry":try{j=this.parseGeometry(h);}catch(g){OpenLayers.Console.error(g);}break;case"Feature":try{j=this.parseFeature(h);j.type="Feature";}catch(g){OpenLayers.Console.error(g);}break;case"FeatureCollection":j=[];switch(h.type){case"Feature":try{j.push(this.parseFeature(h));}catch(g){j=null;OpenLayers.Console.error(g);}break;case"FeatureCollection":for(var l=0,a=h.features.length;l<a;++l){try{j.push(this.parseFeature(h.features[l]));}catch(g){j=null;OpenLayers.Console.error(g);}}break;default:try{var d=this.parseGeometry(h);j.push(new OpenLayers.Feature.Vector(d));}catch(g){j=null;OpenLayers.Console.error(g);}}break;}}}}return j;},isValidType:function(a,b){var d=false;switch(b){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],a.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+a.type);}else{d=true;}break;case"FeatureCollection":d=true;break;default:if(a.type==b){d=true;}else{OpenLayers.Console.error("Cannot convert types from "+a.type+" to "+b);}}return d;},parseFeature:function(g){var e,b,d,a;d=(g.properties)?g.properties:{};a=(g.geometry&&g.geometry.bbox)||g.bbox;try{b=this.parseGeometry(g.geometry);}catch(f){throw f;}e=new OpenLayers.Feature.Vector(b,d);if(a){e.bounds=OpenLayers.Bounds.fromArray(a);}if(g.id){e.fid=g.id;}return e;},parseGeometry:function(g){if(g==null){return null;}var a,h=false;if(g.type=="GeometryCollection"){if(!(g.geometries instanceof Array)){throw"GeometryCollection must have geometries array: "+g;}var d=g.geometries.length;var f=new Array(d);for(var b=0;b<d;++b){f[b]=this.parseGeometry.apply(this,[g.geometries[b]]);}a=new OpenLayers.Geometry.Collection(f);h=true;}else{if(!(g.coordinates instanceof Array)){throw"Geometry must have coordinates array: "+g;}if(!this.parseCoords[g.type.toLowerCase()]){throw"Unsupported geometry type: "+g.type;}try{a=this.parseCoords[g.type.toLowerCase()].apply(this,[g.coordinates]);}catch(e){throw e;}}if(this.internalProjection&&this.externalProjection&&!h){a.transform(this.externalProjection,this.internalProjection);}return a;},parseCoords:{point:function(a){if(this.ignoreExtraDims==false&&a.length!=2){throw"Only 2D points are supported: "+a;}return new OpenLayers.Geometry.Point(a[0],a[1]);},multipoint:function(b){var f=[];var a=null;for(var e=0,d=b.length;e<d;++e){try{a=this.parseCoords.point.apply(this,[b[e]]);}catch(g){throw g;}f.push(a);}return new OpenLayers.Geometry.MultiPoint(f);},linestring:function(b){var f=[];var a=null;for(var e=0,d=b.length;e<d;++e){try{a=this.parseCoords.point.apply(this,[b[e]]);}catch(g){throw g;}f.push(a);}return new OpenLayers.Geometry.LineString(f);},multilinestring:function(b){var f=[];var e=null;for(var g=0,d=b.length;g<d;++g){try{e=this.parseCoords.linestring.apply(this,[b[g]]);}catch(a){throw a;}f.push(e);}return new OpenLayers.Geometry.MultiLineString(f);},polygon:function(a){var h=[];var g,d;for(var e=0,b=a.length;e<b;++e){try{d=this.parseCoords.linestring.apply(this,[a[e]]);}catch(f){throw f;}g=new OpenLayers.Geometry.LinearRing(d.components);h.push(g);}return new OpenLayers.Geometry.Polygon(h);},multipolygon:function(b){var e=[];var a=null;for(var f=0,d=b.length;f<d;++f){try{a=this.parseCoords.polygon.apply(this,[b[f]]);}catch(g){throw g;}e.push(a);}return new OpenLayers.Geometry.MultiPolygon(e);},box:function(a){if(a.length!=2){throw"GeoJSON box coordinates must have 2 elements";}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])]);}},write:function(g,f){var b={type:null};if(g instanceof Array){b.type="FeatureCollection";var a=g.length;b.features=new Array(a);for(var e=0;e<a;++e){var d=g[e];if(!d instanceof OpenLayers.Feature.Vector){var h="FeatureCollection only supports collections of features: "+d;throw h;}b.features[e]=this.extract.feature.apply(this,[d]);}}else{if(g.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){b=this.extract.geometry.apply(this,[g]);}else{if(g instanceof OpenLayers.Feature.Vector){b=this.extract.feature.apply(this,[g]);if(g.layer&&g.layer.projection){b.crs=this.createCRSObject(g);}}}}return OpenLayers.Format.JSON.prototype.write.apply(this,[b,f]);},createCRSObject:function(e){var a=e.layer.projection.toString();var d={};if(a.match(/epsg:/i)){var b=parseInt(a.substring(a.indexOf(":")+1));if(b==4326){d={type:"OGC",properties:{urn:"urn:ogc:def:crs:OGC:1.3:CRS84"}};}else{d={type:"EPSG",properties:{code:b}};}}return d;},extract:{feature:function(b){var a=this.extract.geometry.apply(this,[b.geometry]);return{type:"Feature",id:b.fid==null?b.id:b.fid,properties:b.attributes,geometry:a};},geometry:function(b){if(b==null){return null;}if(this.internalProjection&&this.externalProjection){b=b.clone();b.transform(this.internalProjection,this.externalProjection);}var d=b.CLASS_NAME.split(".")[2];var a=this.extract[d.toLowerCase()].apply(this,[b]);var e;if(d=="Collection"){e={type:"GeometryCollection",geometries:a};}else{e={type:d,coordinates:a};}return e;},point:function(a){return[a.x,a.y];},multipoint:function(a){var b=[];for(var e=0,d=a.components.length;e<d;++e){b.push(this.extract.point.apply(this,[a.components[e]]));}return b;},linestring:function(e){var b=[];for(var a=0,d=e.components.length;a<d;++a){b.push(this.extract.point.apply(this,[e.components[a]]));}return b;},multilinestring:function(a){var b=[];for(var e=0,d=a.components.length;e<d;++e){b.push(this.extract.linestring.apply(this,[a.components[e]]));}return b;},polygon:function(a){var b=[];for(var e=0,d=a.components.length;e<d;++e){b.push(this.extract.linestring.apply(this,[a.components[e]]));}return b;},multipolygon:function(b){var a=[];for(var e=0,d=b.components.length;e<d;++e){a.push(this.extract.polygon.apply(this,[b.components[e]]));}return a;},collection:function(a){var d=a.components.length;var b=new Array(d);for(var e=0;e<d;++e){b[e]=this.extract.geometry.apply(this,[a.components[e]]);}return b;}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(a){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)};
OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b]);}var d=this.getElementsByTagNameNS(b.documentElement,this.gmlns,this.featureName);var a=[];for(var f=0;f<d.length;f++){var e=this.parseFeature(d[f]);if(e){a.push(e);}}return a;},parseFeature:function(r){var s=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"];var f,v,g,o;for(var d=0;d<s.length;++d){f=s[d];v=this.getElementsByTagNameNS(r,this.gmlns,f);if(v.length>0){o=this.parseGeometry[f.toLowerCase()];if(o){g=o.apply(this,[v[0]]);if(this.internalProjection&&this.externalProjection){g.transform(this.externalProjection,this.internalProjection);}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:f}));}break;}}var m;var b=this.getElementsByTagNameNS(r,this.gmlns,"Box");for(d=0;d<b.length;++d){var e=b[d];var q=this.parseGeometry.box.apply(this,[e]);var l=e.parentNode;var u=l.localName||l.nodeName.split(":").pop();if(u==="boundedBy"){m=q;}else{g=q.toGeometry();}}var a;if(this.extractAttributes){a=this.parseAttributes(r);}var h=new OpenLayers.Feature.Vector(g,a);h.bounds=m;h.gml={featureType:r.firstChild.nodeName.split(":")[1],featureNS:r.firstChild.namespaceURI,featureNSPrefix:r.firstChild.prefix};var j=r.firstChild;var t;while(j){if(j.nodeType==1){t=j.getAttribute("fid")||j.getAttribute("id");if(t){break;}}j=j.nextSibling;}h.fid=t;return h;},parseGeometry:{point:function(g){var e,d;var a=[];var e=this.getElementsByTagNameNS(g,this.gmlns,"pos");if(e.length>0){d=e[0].firstChild.nodeValue;d=d.replace(this.regExes.trimSpace,"");a=d.split(this.regExes.splitSpace);}if(a.length==0){e=this.getElementsByTagNameNS(g,this.gmlns,"coordinates");if(e.length>0){d=e[0].firstChild.nodeValue;d=d.replace(this.regExes.removeSpace,"");a=d.split(",");}}if(a.length==0){e=this.getElementsByTagNameNS(g,this.gmlns,"coord");if(e.length>0){var b=this.getElementsByTagNameNS(e[0],this.gmlns,"X");var f=this.getElementsByTagNameNS(e[0],this.gmlns,"Y");if(b.length>0&&f.length>0){a=[b[0].firstChild.nodeValue,f[0].firstChild.nodeValue];}}}if(a.length==2){a[2]=null;}if(this.xy){return new OpenLayers.Geometry.Point(a[0],a[1],a[2]);}else{return new OpenLayers.Geometry.Point(a[1],a[0],a[2]);}},multipoint:function(d){var f=this.getElementsByTagNameNS(d,this.gmlns,"Point");var b=[];if(f.length>0){var e;for(var a=0;a<f.length;++a){e=this.parseGeometry.point.apply(this,[f[a]]);if(e){b.push(e);}}}return new OpenLayers.Geometry.MultiPoint(b);},linestring:function(s,a){var t,r;var e=[];var g=[];t=this.getElementsByTagNameNS(s,this.gmlns,"posList");if(t.length>0){r=this.getChildValue(t[0]);r=r.replace(this.regExes.trimSpace,"");e=r.split(this.regExes.splitSpace);var f=parseInt(t[0].getAttribute("dimension"));var b,q,o,l;for(var d=0;d<e.length/f;++d){b=d*f;q=e[b];o=e[b+1];l=(f==2)?null:e[b+2];if(this.xy){g.push(new OpenLayers.Geometry.Point(q,o,l));}else{g.push(new OpenLayers.Geometry.Point(o,q,l));}}}if(e.length==0){t=this.getElementsByTagNameNS(s,this.gmlns,"coordinates");if(t.length>0){r=this.getChildValue(t[0]);r=r.replace(this.regExes.trimSpace,"");r=r.replace(this.regExes.trimComma,",");var m=r.split(this.regExes.splitSpace);for(var d=0;d<m.length;++d){e=m[d].split(",");if(e.length==2){e[2]=null;}if(this.xy){g.push(new OpenLayers.Geometry.Point(e[0],e[1],e[2]));}else{g.push(new OpenLayers.Geometry.Point(e[1],e[0],e[2]));}}}}var h=null;if(g.length!=0){if(a){h=new OpenLayers.Geometry.LinearRing(g);}else{h=new OpenLayers.Geometry.LineString(g);}}return h;},multilinestring:function(d){var f=this.getElementsByTagNameNS(d,this.gmlns,"LineString");var b=[];if(f.length>0){var e;for(var a=0;a<f.length;++a){e=this.parseGeometry.linestring.apply(this,[f[a]]);if(e){b.push(e);}}}return new OpenLayers.Geometry.MultiLineString(b);},polygon:function(d){var f=this.getElementsByTagNameNS(d,this.gmlns,"LinearRing");var b=[];if(f.length>0){var e;for(var a=0;a<f.length;++a){e=this.parseGeometry.linestring.apply(this,[f[a],true]);if(e){b.push(e);}}}return new OpenLayers.Geometry.Polygon(b);},multipolygon:function(d){var e=this.getElementsByTagNameNS(d,this.gmlns,"Polygon");var b=[];if(e.length>0){var a;for(var f=0;f<e.length;++f){a=this.parseGeometry.polygon.apply(this,[e[f]]);if(a){b.push(a);}}}return new OpenLayers.Geometry.MultiPolygon(b);},envelope:function(f){var j=[];var d;var l;var e=this.getElementsByTagNameNS(f,this.gmlns,"lowerCorner");if(e.length>0){var a=[];if(e.length>0){d=e[0].firstChild.nodeValue;d=d.replace(this.regExes.trimSpace,"");a=d.split(this.regExes.splitSpace);}if(a.length==2){a[2]=null;}if(this.xy){var h=new OpenLayers.Geometry.Point(a[0],a[1],a[2]);}else{var h=new OpenLayers.Geometry.Point(a[1],a[0],a[2]);}}var m=this.getElementsByTagNameNS(f,this.gmlns,"upperCorner");if(m.length>0){var a=[];if(m.length>0){d=m[0].firstChild.nodeValue;d=d.replace(this.regExes.trimSpace,"");a=d.split(this.regExes.splitSpace);}if(a.length==2){a[2]=null;}if(this.xy){var b=new OpenLayers.Geometry.Point(a[0],a[1],a[2]);}else{var b=new OpenLayers.Geometry.Point(a[1],a[0],a[2]);}}if(h&&b){j.push(new OpenLayers.Geometry.Point(h.x,h.y));j.push(new OpenLayers.Geometry.Point(b.x,h.y));j.push(new OpenLayers.Geometry.Point(b.x,b.y));j.push(new OpenLayers.Geometry.Point(h.x,b.y));j.push(new OpenLayers.Geometry.Point(h.x,h.y));var g=new OpenLayers.Geometry.LinearRing(j);l=new OpenLayers.Geometry.Polygon([g]);}return l;},box:function(a){var f=this.getElementsByTagNameNS(a,this.gmlns,"coordinates");var e;var b,d=null,g=null;if(f.length>0){e=f[0].firstChild.nodeValue;b=e.split(" ");if(b.length==2){d=b[0].split(",");g=b[1].split(",");}}if(d!==null&&g!==null){return new OpenLayers.Bounds(parseFloat(d[0]),parseFloat(d[1]),parseFloat(g[0]),parseFloat(g[1]));}}},parseAttributes:function(j){var l={};var d=j.firstChild;var h,m,g,e,b,f,a;while(d){if(d.nodeType==1){h=d.childNodes;for(m=0;m<h.length;++m){g=h[m];if(g.nodeType==1){e=g.childNodes;if(e.length==1){b=e[0];if(b.nodeType==3||b.nodeType==4){f=(g.prefix)?g.nodeName.split(":")[1]:g.nodeName;a=b.nodeValue.replace(this.regExes.trimSpace,"");l[f]=a;}}else{l[g.nodeName.split(":").pop()]=null;}}}break;}d=d.nextSibling;}return l;},write:function(a){if(!(a instanceof Array)){a=[a];}var d=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);for(var b=0;b<a.length;b++){d.appendChild(this.createFeatureXML(a[b]));}return OpenLayers.Format.XML.prototype.write.apply(this,[d]);},createFeatureXML:function(b){var m=b.geometry;var h=this.buildGeometryNode(m);var o=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);o.appendChild(h);var a=this.createElementNS(this.gmlns,"gml:"+this.featureName);var e=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);var f=b.fid||b.id;e.setAttribute("fid",f);e.appendChild(o);for(var l in b.attributes){var j=this.createTextNode(b.attributes[l]);var g=l.substring(l.lastIndexOf(":")+1);var d=this.createElementNS(this.featureNS,this.featurePrefix+":"+g);d.appendChild(j);e.appendChild(d);}a.appendChild(e);return a;},buildGeometryNode:function(b){if(this.externalProjection&&this.internalProjection){b=b.clone();b.transform(this.internalProjection,this.externalProjection);}var a=b.CLASS_NAME;var e=a.substring(a.lastIndexOf(".")+1);var d=this.buildGeometry[e.toLowerCase()];return d.apply(this,[b]);},buildGeometry:{point:function(b){var a=this.createElementNS(this.gmlns,"gml:Point");a.appendChild(this.buildCoordinatesNode(b));return a;},multipoint:function(b){var g=this.createElementNS(this.gmlns,"gml:MultiPoint");var f=b.components;var e,a;for(var d=0;d<f.length;d++){e=this.createElementNS(this.gmlns,"gml:pointMember");a=this.buildGeometry.point.apply(this,[f[d]]);e.appendChild(a);g.appendChild(e);}return g;},linestring:function(b){var a=this.createElementNS(this.gmlns,"gml:LineString");a.appendChild(this.buildCoordinatesNode(b));return a;},multilinestring:function(b){var g=this.createElementNS(this.gmlns,"gml:MultiLineString");
var d=b.components;var f,a;for(var e=0;e<d.length;++e){f=this.createElementNS(this.gmlns,"gml:lineStringMember");a=this.buildGeometry.linestring.apply(this,[d[e]]);f.appendChild(a);g.appendChild(f);}return g;},linearring:function(b){var a=this.createElementNS(this.gmlns,"gml:LinearRing");a.appendChild(this.buildCoordinatesNode(b));return a;},polygon:function(a){var f=this.createElementNS(this.gmlns,"gml:Polygon");var h=a.components;var e,g,d;for(var b=0;b<h.length;++b){d=(b==0)?"outerBoundaryIs":"innerBoundaryIs";e=this.createElementNS(this.gmlns,"gml:"+d);g=this.buildGeometry.linearring.apply(this,[h[b]]);e.appendChild(g);f.appendChild(e);}return f;},multipolygon:function(b){var g=this.createElementNS(this.gmlns,"gml:MultiPolygon");var d=b.components;var a,e;for(var f=0;f<d.length;++f){a=this.createElementNS(this.gmlns,"gml:polygonMember");e=this.buildGeometry.polygon.apply(this,[d[f]]);a.appendChild(e);g.appendChild(a);}return g;},bounds:function(b){var a=this.createElementNS(this.gmlns,"gml:Box");a.appendChild(this.buildCoordinatesNode(b));return a;}},buildCoordinatesNode:function(b){var d=this.createElementNS(this.gmlns,"gml:coordinates");d.setAttribute("decimal",".");d.setAttribute("cs",",");d.setAttribute("ts"," ");var a=[];if(b instanceof OpenLayers.Bounds){a.push(b.left+","+b.bottom);a.push(b.right+","+b.top);}else{var f=(b.components)?b.components:[b];for(var e=0;e<f.length;e++){a.push(f[e].x+","+f[e].y);}}var g=this.createTextNode(a.join(" "));d.appendChild(g);return d;},CLASS_NAME:"OpenLayers.Format.GML"});if(!OpenLayers.Format.GML){OpenLayers.Format.GML={};}OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.setGeometryTypes();if(a&&a.featureNS){this.setNamespace("feature",a.featureNS);}this.singleFeatureType=!a||(typeof a.featureType==="string");},read:function(d){if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d]);}if(d&&d.nodeType==9){d=d.documentElement;}var a=[];this.readNode(d,{features:a});if(a.length==0){var b=this.getElementsByTagNameNS(d,this.namespaces.gml,"featureMember");if(b.length){for(var f=0,e=b.length;f<e;++f){this.readNode(b[f],{features:a});}}else{var b=this.getElementsByTagNameNS(d,this.namespaces.gml,"featureMembers");if(b.length){this.readNode(b[0],{features:a});}}}return a;},readers:{gml:{featureMember:function(a,b){this.readChildNodes(a,b);},featureMembers:function(a,b){this.readChildNodes(a,b);},name:function(a,b){b.name=this.getChildValue(a);},boundedBy:function(d,a){var b={};this.readChildNodes(d,b);if(b.components&&b.components.length>0){a.bounds=b.components[0];}},Point:function(d,b){var a={points:[]};this.readChildNodes(d,a);if(!b.components){b.components=[];}b.components.push(a.points[0]);},coordinates:function(f,h){var j=this.getChildValue(f).replace(this.regExes.trimSpace,"");j=j.replace(this.regExes.trimComma,",");var a=j.split(this.regExes.splitSpace);var g;var e=a.length;var d=new Array(e);for(var b=0;b<e;++b){g=a[b].split(",");if(this.xy){d[b]=new OpenLayers.Geometry.Point(g[0],g[1],g[2]);}else{d[b]=new OpenLayers.Geometry.Point(g[1],g[0],g[2]);}}h.points=d;},coord:function(b,d){var a={};this.readChildNodes(b,a);if(!d.points){d.points=[];}d.points.push(new OpenLayers.Geometry.Point(a.x,a.y,a.z));},X:function(a,b){b.x=this.getChildValue(a);},Y:function(a,b){b.y=this.getChildValue(a);},Z:function(a,b){b.z=this.getChildValue(a);},MultiPoint:function(d,b){var a={components:[]};this.readChildNodes(d,a);b.components=[new OpenLayers.Geometry.MultiPoint(a.components)];},pointMember:function(a,b){this.readChildNodes(a,b);},LineString:function(d,b){var a={};this.readChildNodes(d,a);if(!b.components){b.components=[];}b.components.push(new OpenLayers.Geometry.LineString(a.points));},MultiLineString:function(d,b){var a={components:[]};this.readChildNodes(d,a);b.components=[new OpenLayers.Geometry.MultiLineString(a.components)];},lineStringMember:function(a,b){this.readChildNodes(a,b);},Polygon:function(d,b){var a={outer:null,inner:[]};this.readChildNodes(d,a);a.inner.unshift(a.outer);if(!b.components){b.components=[];}b.components.push(new OpenLayers.Geometry.Polygon(a.inner));},LinearRing:function(d,a){var b={};this.readChildNodes(d,b);a.components=[new OpenLayers.Geometry.LinearRing(b.points)];},MultiPolygon:function(d,b){var a={components:[]};this.readChildNodes(d,a);b.components=[new OpenLayers.Geometry.MultiPolygon(a.components)];},polygonMember:function(a,b){this.readChildNodes(a,b);},GeometryCollection:function(d,b){var a={components:[]};this.readChildNodes(d,a);b.components=[new OpenLayers.Geometry.Collection(a.components)];},geometryMember:function(a,b){this.readChildNodes(a,b);}},feature:{"*":function(a,b){var d;var e=a.localName||a.nodeName.split(":").pop();if(b.features){if(!this.singleFeatureType&&(OpenLayers.Util.indexOf(this.featureType,e)!==-1)){d="_typeName";}else{if(e===this.featureType){d="_typeName";}}}else{if(a.childNodes.length==0||(a.childNodes.length==1&&a.firstChild.nodeType==3)){if(this.extractAttributes){d="_attribute";}}else{d="_geometry";}}if(d){this.readers.feature[d].apply(this,[a,b]);}},_typeName:function(a,b){var e={components:[],attributes:{}};this.readChildNodes(a,e);if(e.name){e.attributes.name=e.name;}var f=new OpenLayers.Feature.Vector(e.components[0],e.attributes);if(!this.singleFeatureType){f.type=a.nodeName.split(":").pop();f.namespace=a.namespaceURI;}var d=a.getAttribute("fid")||this.getAttributeNS(a,this.namespaces.gml,"id");if(d){f.fid=d;}if(this.internalProjection&&this.externalProjection&&f.geometry){f.geometry.transform(this.externalProjection,this.internalProjection);}if(e.bounds){f.bounds=e.bounds;}b.features.push(f);},_geometry:function(a,b){this.readChildNodes(a,b);},_attribute:function(e,b){var d=e.localName||e.nodeName.split(":").pop();var a=this.getChildValue(e);b.attributes[d]=a;}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b);}}},write:function(a){var d;if(a instanceof Array){d="featureMembers";}else{d="featureMember";}var b=this.writeNode("gml:"+d,a);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b]);},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",a,b);return b;},MultiPoint:function(a){var d=this.createElementNSPlus("gml:MultiPoint");for(var b=0;b<a.components.length;++b){this.writeNode("pointMember",a.components[b],d);}return d;},pointMember:function(b){var a=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",b,a);return a;},MultiLineString:function(a){var d=this.createElementNSPlus("gml:MultiLineString");for(var b=0;b<a.components.length;++b){this.writeNode("lineStringMember",a.components[b],d);}return d;},lineStringMember:function(b){var a=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",b,a);return a;},MultiPolygon:function(a){var d=this.createElementNSPlus("gml:MultiPolygon");for(var b=0;b<a.components.length;++b){this.writeNode("polygonMember",a.components[b],d);}return d;},polygonMember:function(b){var a=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",b,a);return a;},GeometryCollection:function(b){var a=this.createElementNSPlus("gml:GeometryCollection");for(var e=0,d=b.components.length;e<d;++e){this.writeNode("geometryMember",b.components[e],a);}return a;},geometryMember:function(d){var b=this.createElementNSPlus("gml:geometryMember");
var a=this.writeNode("feature:_geometry",d);b.appendChild(a.firstChild);return b;}},feature:{_typeName:function(e){var a=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});if(e.geometry){this.writeNode("feature:_geometry",e.geometry,a);}for(var d in e.attributes){var b=e.attributes[d];if(b!=null){this.writeNode("feature:_attribute",{name:d,value:b},a);}}return a;},_geometry:function(a){if(this.externalProjection&&this.internalProjection){a=a.clone().transform(this.internalProjection,this.externalProjection);}var e=this.createElementNSPlus("feature:"+this.geometryName);var d=this.geometryTypes[a.CLASS_NAME];var b=this.writeNode("gml:"+d,a,e);if(this.srsName){b.setAttribute("srsName",this.srsName);}return e;},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value});}},wfs:{FeatureCollection:function(a){var b=this.createElementNSPlus("wfs:FeatureCollection");for(var e=0,d=a.length;e<d;++e){this.writeNode("gml:featureMember",a[e],b);}return b;}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"};},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a]);},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a,b){this.readChildNodes(a,b);},Curve:function(d,b){var a={points:[]};this.readChildNodes(d,a);if(!b.components){b.components=[];}b.components.push(new OpenLayers.Geometry.LineString(a.points));},segments:function(a,b){this.readChildNodes(a,b);},LineStringSegment:function(d,b){var a={};this.readChildNodes(d,a);if(a.points){Array.prototype.push.apply(b.points,a.points);}},pos:function(f,b){var d=this.getChildValue(f).replace(this.regExes.trimSpace,"");var a=d.split(this.regExes.splitSpace);var e;if(this.xy){e=new OpenLayers.Geometry.Point(a[0],a[1],a[2]);}else{e=new OpenLayers.Geometry.Point(a[1],a[0],a[2]);}b.points=[e];},posList:function(m,a){var g=this.getChildValue(m).replace(this.regExes.trimSpace,"");var r=g.split(this.regExes.splitSpace);var b=parseInt(m.getAttribute("dimension"))||2;var q,e,o,f;var l=r.length/b;var h=new Array(l);for(var s=0,d=r.length;s<d;s+=b){e=r[s];o=r[s+1];f=(b==2)?undefined:r[s+2];if(this.xy){h[s/b]=new OpenLayers.Geometry.Point(e,o,f);}else{h[s/b]=new OpenLayers.Geometry.Point(o,e,f);}}a.points=h;},Surface:function(a,b){this.readChildNodes(a,b);},patches:function(a,b){this.readChildNodes(a,b);},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b]);},exterior:function(d,b){var a={};this.readChildNodes(d,a);b.outer=a.components[0];},interior:function(d,b){var a={};this.readChildNodes(d,a);b.inner.push(a.components[0]);},MultiCurve:function(d,b){var a={components:[]};this.readChildNodes(d,a);if(a.components.length>0){b.components=[new OpenLayers.Geometry.MultiLineString(a.components)];}},curveMember:function(a,b){this.readChildNodes(a,b);},MultiSurface:function(d,b){var a={components:[]};this.readChildNodes(d,a);if(a.components.length>0){b.components=[new OpenLayers.Geometry.MultiPolygon(a.components)];}},surfaceMember:function(a,b){this.readChildNodes(a,b);},surfaceMembers:function(a,b){this.readChildNodes(a,b);},pointMembers:function(a,b){this.readChildNodes(a,b);},lineStringMembers:function(a,b){this.readChildNodes(a,b);},polygonMembers:function(a,b){this.readChildNodes(a,b);},geometryMembers:function(a,b){this.readChildNodes(a,b);},Envelope:function(b,f){var d={points:new Array(2)};this.readChildNodes(b,d);if(!f.components){f.components=[];}var a=d.points[0];var e=d.points[1];f.components.push(new OpenLayers.Bounds(a.x,a.y,e.x,e.y));},lowerCorner:function(d,b){var a={};this.readers.gml.pos.apply(this,[d,a]);b.points[0]=a.points[0];},upperCorner:function(d,b){var a={};this.readers.gml.pos.apply(this,[d,a]);b.points[1]=a.points[0];}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var d;if(a instanceof Array){d="featureMembers";}else{d="featureMember";}var b=this.writeNode("gml:"+d,a);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b]);},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a){var b=this.createElementNSPlus("gml:featureMembers");for(var e=0,d=a.length;e<d;++e){this.writeNode("feature:_typeName",a[e],b);}return b;},Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("pos",b,a);return a;},pos:function(a){var b=(this.xy)?(a.x+" "+a.y):(a.y+" "+a.x);return this.createElementNSPlus("gml:pos",{value:b});},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("posList",b.components,a);return a;},Curve:function(b){var a=this.createElementNSPlus("gml:Curve");this.writeNode("segments",b,a);return a;},segments:function(b){var a=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",b,a);return a;},LineStringSegment:function(b){var a=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",b.components,a);return a;},posList:function(b){var f=b.length;var d=new Array(f);var e;for(var a=0;a<f;++a){e=b[a];if(this.xy){d[a]=e.x+" "+e.y;}else{d[a]=e.y+" "+e.x;}}return this.createElementNSPlus("gml:posList",{value:d.join(" ")});},Surface:function(b){var a=this.createElementNSPlus("gml:Surface");this.writeNode("patches",b,a);return a;},patches:function(b){var a=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",b,a);return a;},PolygonPatch:function(b){var a=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",b.components[0],a);for(var e=1,d=b.components.length;e<d;++e){this.writeNode("interior",b.components[e],a);}return a;},Polygon:function(b){var a=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",b.components[0],a);for(var e=1,d=b.components.length;e<d;++e){this.writeNode("interior",b.components[e],a);}return a;},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",a,b);return b;},interior:function(a){var b=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",a,b);return b;},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",a.components,b);return b;},MultiCurve:function(b){var a=this.createElementNSPlus("gml:MultiCurve");for(var e=0,d=b.components.length;e<d;++e){this.writeNode("curveMember",b.components[e],a);}return a;},curveMember:function(b){var a=this.createElementNSPlus("gml:curveMember");if(this.curve){this.writeNode("Curve",b,a);}else{this.writeNode("LineString",b,a);}return a;},MultiSurface:function(b){var a=this.createElementNSPlus("gml:MultiSurface");for(var e=0,d=b.components.length;e<d;++e){this.writeNode("surfaceMember",b.components[e],a);}return a;},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");if(this.surface){this.writeNode("Surface",a,b);}else{this.writeNode("Polygon",a,b);}return b;},Envelope:function(b){var a=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",b,a);this.writeNode("upperCorner",b,a);if(this.srsName){a.setAttribute("srsName",this.srsName);}return a;},lowerCorner:function(a){var b=(this.xy)?(a.left+" "+a.bottom):(a.bottom+" "+a.left);return this.createElementNSPlus("gml:lowerCorner",{value:b});
},upperCorner:function(a){var b=(this.xy)?(a.right+" "+a.top):(a.top+" "+a.right);return this.createElementNSPlus("gml:upperCorner",{value:b});}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":(this.curve===true)?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":(this.multiCurve===false)?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":(this.surface===true)?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":(this.multiSurface===false)?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"};},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Element={visible:function(a){return OpenLayers.Util.getElement(a).style.display!="none";},toggle:function(){for(var a=0,d=arguments.length;a<d;a++){var e=OpenLayers.Util.getElement(arguments[a]);var b=OpenLayers.Element.visible(e)?"hide":"show";OpenLayers.Element[b](e);}},hide:function(){for(var a=0,b=arguments.length;a<b;a++){var d=OpenLayers.Util.getElement(arguments[a]);if(d){d.style.display="none";}}},show:function(){for(var a=0,b=arguments.length;a<b;a++){var d=OpenLayers.Util.getElement(arguments[a]);if(d){d.style.display="";}}},remove:function(a){a=OpenLayers.Util.getElement(a);a.parentNode.removeChild(a);},getHeight:function(a){a=OpenLayers.Util.getElement(a);return a.offsetHeight;},getDimensions:function(e){e=OpenLayers.Util.getElement(e);if(OpenLayers.Element.getStyle(e,"display")!="none"){return{width:e.offsetWidth,height:e.offsetHeight};}var d=e.style;var h=d.visibility;var f=d.position;var b=d.display;d.visibility="hidden";d.position="absolute";d.display="";var a=e.clientWidth;var g=e.clientHeight;d.display=b;d.position=f;d.visibility=h;return{width:a,height:g};},hasClass:function(d,b){var a=d.className;return(!!a&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a));},addClass:function(b,a){if(!OpenLayers.Element.hasClass(b,a)){b.className+=(b.className?" ":"")+a;}return b;},removeClass:function(d,b){var a=d.className;if(a){d.className=OpenLayers.String.trim(a.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "));}return d;},toggleClass:function(b,a){if(OpenLayers.Element.hasClass(b,a)){OpenLayers.Element.removeClass(b,a);}else{OpenLayers.Element.addClass(b,a);}return b;},getStyle:function(a,b){a=OpenLayers.Util.getElement(a);var d=null;if(a&&a.style){d=a.style[OpenLayers.String.camelize(b)];if(!d){if(document.defaultView&&document.defaultView.getComputedStyle){var f=document.defaultView.getComputedStyle(a,null);d=f?f.getPropertyValue(b):null;}else{if(a.currentStyle){d=a.currentStyle[OpenLayers.String.camelize(b)];}}}var e=["left","top","right","bottom"];if(window.opera&&(OpenLayers.Util.indexOf(e,b)!=-1)&&(OpenLayers.Element.getStyle(a,"position")=="static")){d="auto";}}return d=="auto"?null:d;}};OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:true,initialize:function(a,d,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null;},onWheelEvent:function(q){if(!this.map||!this.checkModifiers(q)){return;}var l=false;var g=false;var j=false;var d=OpenLayers.Event.element(q);while((d!=null)&&!j&&!l){if(!l){try{if(d.currentStyle){f=d.currentStyle.overflow;}else{var b=document.defaultView.getComputedStyle(d,null);var f=b.getPropertyValue("overflow");}l=(f&&(f=="auto")||(f=="scroll"));}catch(h){}}if(!g){for(var m=0,o=this.map.layers.length;m<o;m++){if(d==this.map.layers[m].div||d==this.map.layers[m].pane){g=true;break;}}}j=(d==this.map.div);d=d.parentNode;}if(!l&&j){if(g){var a=0;if(!q){q=window.event;}if(q.wheelDelta){a=q.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){a=-a;}}else{if(q.detail){a=-q.detail/3;}}this.delta=this.delta+a;if(this.interval){window.clearTimeout(this._timeoutId);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(q);},this),this.interval);}else{this.wheelZoom(q);}}OpenLayers.Event.stop(q);}},wheelZoom:function(a){var b=this.delta;this.delta=0;if(b){if(this.mousePosition){a.xy=this.mousePosition;}if(!a.xy){a.xy=this.map.getPixelFromLonLat(this.map.getCenter());}if(b<0){this.callback("down",[a,this.cumulative?b:-1]);}else{this.callback("up",[a,this.cumulative?b:1]);}}},mousemove:function(a){this.mousePosition=a.xy;},activate:function(a){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",b);OpenLayers.Event.observe(window,"mousewheel",b);OpenLayers.Event.observe(document,"mousewheel",b);return true;}else{return false;}},deactivate:function(a){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",b);OpenLayers.Event.stopObserving(window,"mousewheel",b);OpenLayers.Event.stopObserving(document,"mousewheel",b);return true;}else{return false;}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){if(this.map){this.map.zoomToMaxExtent();}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(b,a){OpenLayers.Util.extend(this,a);this.rules=[];if(a&&a.rules){this.addRules(a.rules);}this.setDefaultStyle(b||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){for(var b=0,a=this.rules.length;b<a;b++){this.rules[b].destroy();this.rules[b]=null;}this.rules=null;this.defaultStyle=null;},createSymbolizer:function(e){var d=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e);var b=this.rules;var a,f;var g=[];var l=false;for(var h=0,j=b.length;h<j;h++){a=b[h];var m=a.evaluate(e);if(m){if(a instanceof OpenLayers.Rule&&a.elseFilter){g.push(a);}else{l=true;this.applySymbolizer(a,d,e);}}}if(l==false&&g.length>0){l=true;for(var h=0,j=g.length;h<j;h++){this.applySymbolizer(g[h],d,e);}}if(b.length>0&&l==false){d.display="none";}return d;},applySymbolizer:function(b,g,e){var d=e.geometry?this.getSymbolizerPrefix(e.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];var f=b.symbolizer[d]||b.symbolizer;if(this.defaultsPerSymbolizer===true){var a=this.defaultStyle;OpenLayers.Util.applyDefaults(f,{pointRadius:a.pointRadius});if(f.stroke===true||f.graphic===true){OpenLayers.Util.applyDefaults(f,{strokeWidth:a.strokeWidth,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeDashstyle:a.strokeDashstyle,strokeLinecap:a.strokeLinecap});}if(f.fill===true||f.graphic===true){OpenLayers.Util.applyDefaults(f,{fillColor:a.fillColor,fillOpacity:a.fillOpacity});}if(f.graphic===true){OpenLayers.Util.applyDefaults(f,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset});}}return this.createLiterals(OpenLayers.Util.extend(g,f),e);},createLiterals:function(b,a){var e=OpenLayers.Util.extend({},a.attributes||a.data);OpenLayers.Util.extend(e,this.context);for(var d in this.propertyStyles){b[d]=OpenLayers.Style.createLiteral(b[d],e,a,d);}return b;},findPropertyStyles:function(){var e={};
var g=this.defaultStyle;this.addPropertyStyles(e,g);var j=this.rules;var f,h;for(var d=0,a=j.length;d<a;d++){f=j[d].symbolizer;for(var b in f){h=f[b];if(typeof h=="object"){this.addPropertyStyles(e,h);}else{this.addPropertyStyles(e,f);break;}}}return e;},addPropertyStyles:function(e,a){var b;for(var d in a){b=a[d];if(typeof b=="string"&&b.match(/\$\{\w+\}/)){e[d]=true;}}return e;},addRules:function(a){Array.prototype.push.apply(this.rules,a);this.propertyStyles=this.findPropertyStyles();},setDefaultStyle:function(a){this.defaultStyle=a;this.propertyStyles=this.findPropertyStyles();},getSymbolizerPrefix:function(b){var a=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var e=0,d=a.length;e<d;e++){if(b.CLASS_NAME.indexOf(a[e])!=-1){return a[e];}}},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var a=0,d=this.rules.length;a<d;++a){e.rules.push(this.rules[a].clone());}}e.context=this.context&&OpenLayers.Util.extend({},this.context);var b=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(b,e);},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(b,e,d,a){if(typeof b=="string"&&b.indexOf("${")!=-1){b=OpenLayers.String.format(b,e,[d,a]);b=(isNaN(b)||!b)?b:parseFloat(b);}return b;};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a);},destroy:function(){},evaluate:function(a){return true;},clone:function(){return null;},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,initialize:function(a){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[a]);},evaluate:function(a){for(var e=0,d=this.fids.length;e<d;e++){var b=a.fid||a.id;if(b==this.fids[e]){return true;}}return false;},clone:function(){var a=new OpenLayers.Filter.FeatureId();OpenLayers.Util.extend(a,this);a.fids=this.fids.slice();return a;},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[a]);},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this);},evaluate:function(a){switch(this.type){case OpenLayers.Filter.Logical.AND:for(var d=0,b=this.filters.length;d<b;d++){if(this.filters[d].evaluate(a)==false){return false;}}return true;case OpenLayers.Filter.Logical.OR:for(var d=0,b=this.filters.length;d<b;d++){if(this.filters[d].evaluate(a)==true){return true;}}return false;case OpenLayers.Filter.Logical.NOT:return(!this.filters[0].evaluate(a));}},clone:function(){var a=[];for(var d=0,b=this.filters.length;d<b;++d){a.push(this.filters[d].clone());}return new OpenLayers.Filter.Logical({type:this.type,filters:a});},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a]);},evaluate:function(a){if(a instanceof OpenLayers.Feature.Vector){a=a.attributes;}var e=false;var f=a[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:var d=this.value;if(!this.matchCase&&typeof f=="string"&&typeof d=="string"){e=(f.toUpperCase()==d.toUpperCase());}else{e=(f==d);}break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:var d=this.value;if(!this.matchCase&&typeof f=="string"&&typeof d=="string"){e=(f.toUpperCase()!=d.toUpperCase());}else{e=(f!=d);}break;case OpenLayers.Filter.Comparison.LESS_THAN:e=f<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:e=f>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:e=f<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:e=f>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:e=(f>=this.lowerBoundary)&&(f<=this.upperBoundary);break;case OpenLayers.Filter.Comparison.LIKE:var b=new RegExp(this.value,"gi");e=b.test(f);break;}return e;},value2regex:function(b,e,d){if(b=="."){var a="'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison";OpenLayers.Console.error(a);return null;}b=b?b:"*";e=e?e:".";d=d?d:"!";this.value=this.value.replace(new RegExp("\\"+d+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+e,"g"),".");this.value=this.value.replace(new RegExp("\\"+b,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+b);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+e);return this.value;},regex2value:function(){var a=this.value;a=a.replace(/!/g,"!!");a=a.replace(/(\\)?\\\./g,function(d,b){return b?d:"!.";});a=a.replace(/(\\)?\\\*/g,function(d,b){return b?d:"!*";});a=a.replace(/\\\\/g,"\\");a=a.replace(/\.\*/g,"*");return a;},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison(),this);},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},write:function(a,e){var d=(e&&e.version)||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=d){var b=OpenLayers.Format.Filter["v"+d.replace(/\./g,"_")];if(!b){throw"Can't find a Filter parser for version "+d;}this.parser=new b(this.options);}return this.parser.write(a);},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a]);}var d=this.version;if(!d){d=this.defaultVersion;}if(!this.parser||this.parser.VERSION!=d){var b=OpenLayers.Format.Filter["v"+d.replace(/\./g,"_")];if(!b){throw"Can't find a Filter parser for version "+d;}this.parser=new b(this.options);}var e=this.parser.read(a);return e;},CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,defaultFilter:null,initialize:function(a){a=a||{};OpenLayers.Util.extend(this,a);this.options=a;},mergeWithDefaultFilter:function(b){var a;if(b&&this.defaultFilter){a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,b]});}else{a=b||this.defaultFilter||undefined;}return a;},destroy:function(){this.options=null;this.format=null;},read:function(a){a=a||{};a.filter=this.mergeWithDefaultFilter(a.filter);},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(a){},createCallback:function(a,b,d){return OpenLayers.Function.bind(function(){a.apply(this,[b,d]);},this);},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,reqFeatures:null,priv:null,initialize:function(a){OpenLayers.Util.extend(this,a);},success:function(){return this.code>0;},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,wildcarded:false,initialize:function(a){a=a||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this);},read:function(b){OpenLayers.Protocol.prototype.read.apply(this,arguments);b=OpenLayers.Util.applyDefaults(b,this.options);
b.params=OpenLayers.Util.applyDefaults(b.params,this.options.params);if(b.filter){b.params=this.filterToParams(b.filter,b.params);}var d=(b.readWithPOST!==undefined)?b.readWithPOST:this.readWithPOST;var a=new OpenLayers.Protocol.Response({requestType:"read"});if(d){a.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleRead,a,b),data:OpenLayers.Util.getParameterString(b.params),headers:{"Content-Type":"application/x-www-form-urlencoded"}});}else{a.priv=OpenLayers.Request.GET({url:b.url,callback:this.createCallback(this.handleRead,a,b),params:b.params,headers:b.headers});}return a;},handleRead:function(b,a){this.handleResponse(b,a);},filterToParams:function(e,h){h=h||{};var d=e.CLASS_NAME;var f=d.substring(d.lastIndexOf(".")+1);switch(f){case"Spatial":switch(e.type){case OpenLayers.Filter.Spatial.BBOX:h.bbox=e.value.toArray();break;case OpenLayers.Filter.Spatial.DWITHIN:h.tolerance=e.distance;case OpenLayers.Filter.Spatial.WITHIN:h.lon=e.value.x;h.lat=e.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+e.type);}break;case"Comparison":var j=OpenLayers.Protocol.HTTP.COMP_TYPE_TO_OP_STR[e.type];if(j!==undefined){var g=e.value;if(e.type==OpenLayers.Filter.Comparison.LIKE){g=this.regex2value(g);if(this.wildcarded){g="%"+g+"%";}}h[e.property+"__"+j]=g;h.queryable=h.queryable||[];h.queryable.push(e.property);}else{OpenLayers.Console.warn("Unknown comparison filter type "+e.type);}break;case"Logical":if(e.type===OpenLayers.Filter.Logical.AND){for(var b=0,a=e.filters.length;b<a;b++){h=this.filterToParams(e.filters[b],h);}}else{OpenLayers.Console.warn("Unsupported logical filter type "+e.type);}break;default:OpenLayers.Console.warn("Unknown filter type "+f);}return h;},regex2value:function(a){a=a.replace(/%/g,"\\%");a=a.replace(/\\\\\.(\*)?/g,function(d,b){return b?d:"\\\\_";});a=a.replace(/\\\\\.\*/g,"\\\\%");a=a.replace(/(\\)?\.(\*)?/g,function(d,b,e){return b||e?d:"_";});a=a.replace(/(\\)?\.\*/g,function(d,b){return b?d:"%";});a=a.replace(/\\\./g,".");a=a.replace(/(\\)?\\\*/g,function(d,b){return b?d:"*";});return a;},create:function(d,b){b=OpenLayers.Util.applyDefaults(b,this.options);var a=new OpenLayers.Protocol.Response({reqFeatures:d,requestType:"create"});a.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleCreate,a,b),headers:b.headers,data:this.format.write(d)});return a;},handleCreate:function(b,a){this.handleResponse(b,a);},update:function(a,e){e=e||{};var d=e.url||a.url||this.options.url+"/"+a.fid;e=OpenLayers.Util.applyDefaults(e,this.options);var b=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"update"});b.priv=OpenLayers.Request.PUT({url:d,callback:this.createCallback(this.handleUpdate,b,e),headers:e.headers,data:this.format.write(a)});return b;},handleUpdate:function(b,a){this.handleResponse(b,a);},"delete":function(a,e){e=e||{};var d=e.url||a.url||this.options.url+"/"+a.fid;e=OpenLayers.Util.applyDefaults(e,this.options);var b=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"delete"});b.priv=OpenLayers.Request.DELETE({url:d,callback:this.createCallback(this.handleDelete,b,e),headers:e.headers});return b;},handleDelete:function(b,a){this.handleResponse(b,a);},handleResponse:function(a,b){var d=a.priv;if(b.callback){if(d.status>=200&&d.status<300){if(a.requestType!="delete"){a.features=this.parseFeatures(d);}a.code=OpenLayers.Protocol.Response.SUCCESS;}else{a.code=OpenLayers.Protocol.Response.FAILURE;}b.callback.call(b.scope,a);}},parseFeatures:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText;}if(!b||b.length<=0){return null;}return this.format.read(b);},commit:function(l,h){h=OpenLayers.Util.applyDefaults(h,this.options);var r=[],o=0;var d={};d[OpenLayers.State.INSERT]=[];d[OpenLayers.State.UPDATE]=[];d[OpenLayers.State.DELETE]=[];var f,g,m=[];for(var s=0,b=l.length;s<b;++s){f=l[s];g=d[f.state];if(g){g.push(f);m.push(f);}}var u=(d[OpenLayers.State.INSERT].length>0?1:0)+d[OpenLayers.State.UPDATE].length+d[OpenLayers.State.DELETE].length;var e=true;var j=new OpenLayers.Protocol.Response({reqFeatures:m});function a(w){var v=w.features?w.features.length:0;var z=new Array(v);for(var B=0;B<v;++B){z[B]=w.features[B].fid;}j.insertIds=z;q.apply(this,[w]);}function q(v){this.callUserCallback(v,h);e=e&&v.success();o++;if(o>=u){if(h.callback){j.code=e?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;h.callback.apply(h.scope,[j]);}}}var t=d[OpenLayers.State.INSERT];if(t.length>0){r.push(this.create(t,OpenLayers.Util.applyDefaults({callback:a,scope:this},h.create)));}t=d[OpenLayers.State.UPDATE];for(var s=t.length-1;s>=0;--s){r.push(this.update(t[s],OpenLayers.Util.applyDefaults({callback:q,scope:this},h.update)));}t=d[OpenLayers.State.DELETE];for(var s=t.length-1;s>=0;--s){r.push(this["delete"](t[s],OpenLayers.Util.applyDefaults({callback:q,scope:this},h["delete"])));}return r;},abort:function(a){if(a){a.priv.abort();}},callUserCallback:function(a,b){var d=b[a.requestType];if(d&&d.callback){d.callback.call(d.scope,a);}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});(function(){var a=OpenLayers.Protocol.HTTP.COMP_TYPE_TO_OP_STR={};a[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";a[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";a[OpenLayers.Filter.Comparison.LESS_THAN]="lt";a[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";a[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";a[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";a[OpenLayers.Filter.Comparison.LIKE]="ilike";})();OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a);},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null;},supported:function(){return false;},setExtent:function(a,b){this.extent=a.clone();if(b){this.resolution=null;}},setSize:function(a){this.size=a.clone();this.resolution=null;},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution;},drawFeature:function(f,g){if(g==null){g=f.style;}if(f.geometry){var a=f.geometry.getBounds();if(a){if(!a.intersectsBounds(this.extent)){g={display:"none"};}var b=this.drawGeometry(f.geometry,g,f.id);if(g.display!="none"&&g.label&&b!==false){var d=f.geometry.getCentroid();if(g.labelXOffset||g.labelYOffset){xOffset=isNaN(g.labelXOffset)?0:g.labelXOffset;yOffset=isNaN(g.labelYOffset)?0:g.labelYOffset;var e=this.getResolution();d.move(xOffset*e,yOffset*e);}this.drawText(f.id,g,d);}else{this.removeText(f.id);}return b;}}},drawGeometry:function(a,b,d){},drawText:function(a,d,b){},removeText:function(a){},clear:function(){},getFeatureIdFromEvent:function(a){},eraseFeatures:function(b){if(!(b instanceof Array)){b=[b];}for(var a=0,d=b.length;a<d;++a){var e=b[a];this.eraseGeometry(e.geometry,e.id);this.removeText(e.id);}},eraseGeometry:function(b,a){},moveRoot:function(a){},getRenderLayerId:function(){return this.container.id;},applyDefaultSymbolizer:function(b){var a=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);if(b.stroke===false){delete a.strokeWidth;delete a.strokeColor;}if(b.fill===false){delete a.fillColor;}OpenLayers.Util.extend(a,b);return a;},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0};OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.order=[];this.indices={};this.maxZIndex=0;},insert:function(f){if(this.exists(f)){this.remove(f);}var b=f.id;this.determineZIndex(f);var g=-1;var a=this.order.length;var d;while(a-g>1){d=parseInt((g+a)/2);var e=this.compare(this,f,OpenLayers.Util.getElement(this.order[d]));
if(e>0){g=d;}else{a=d;}}this.order.splice(a,0,b);this.indices[b]=this.getZIndex(f);return this.getNextElement(a);},remove:function(e){var b=e.id;var d=OpenLayers.Util.indexOf(this.order,b);if(d>=0){this.order.splice(d,1);delete this.indices[b];if(this.order.length>0){var a=this.order[this.order.length-1];this.maxZIndex=this.indices[a];}else{this.maxZIndex=0;}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0;},exists:function(a){return(this.indices[a.id]!=null);},getZIndex:function(a){return a._style.graphicZIndex;},determineZIndex:function(a){var b=a._style.graphicZIndex;if(b==null){b=this.maxZIndex;a._style.graphicZIndex=b;}else{if(b>this.maxZIndex){this.maxZIndex=b;}}},getNextElement:function(d){var b=d+1;if(b<this.order.length){var a=OpenLayers.Util.getElement(this.order[b]);if(a==undefined){a=this.getNextElement(b);}return a;}else{return null;}},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(a,g,e){var d=a.getZIndex(g);var b=0;if(e){var f=a.getZIndex(e);b=d-f;}return b;},Z_ORDER_DRAWING_ORDER:function(a,e,d){var b=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,e,d);if(d&&b==0){b=1;}return b;},Z_ORDER_Y_ORDER:function(b,a,f){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(b,a,f);if(f&&d===0){var e=f._boundsBottom-a._boundsBottom;d=(e===0)?1:e;}return d;}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(b&&(b.zIndexing||b.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering);}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments);},clear:function(){var b;var a=this.vectorRoot;if(a){while(b=a.firstChild){a.removeChild(b);}}a=this.textRoot;if(a){while(b=a.firstChild){a.removeChild(b);}}if(this.indexer){this.indexer.clear();}},getNodeType:function(b,a){},drawGeometry:function(h,e,g){var d=h.CLASS_NAME;var j=true;if((d=="OpenLayers.Geometry.Collection")||(d=="OpenLayers.Geometry.MultiPoint")||(d=="OpenLayers.Geometry.MultiLineString")||(d=="OpenLayers.Geometry.MultiPolygon")){for(var b=0,a=h.components.length;b<a;b++){j=this.drawGeometry(h.components[b],e,g)&&j;}return j;}j=false;if(e.display!="none"){if(e.backgroundGraphic){this.redrawBackgroundNode(h.id,h,e,g);}j=this.redrawNode(h.id,h,e,g);}if(j==false){var f=document.getElementById(h.id);if(f){if(f._style.backgroundGraphic){f.parentNode.removeChild(document.getElementById(h.id+this.BACKGROUND_ID_SUFFIX));}f.parentNode.removeChild(f);}}return j;},redrawNode:function(a,h,d,g){d=this.applyDefaultSymbolizer(d);var e=this.nodeFactory(a,this.getNodeType(h,d));e._featureId=g;e._boundsBottom=h.getBounds().bottom;e._geometryClass=h.CLASS_NAME;e._style=d;var b=this.drawGeometryNode(e,h,d);if(b===false){return false;}e=b.node;if(this.indexer){var f=this.indexer.insert(e);if(f){this.vectorRoot.insertBefore(e,f);}else{this.vectorRoot.appendChild(e);}}else{if(e.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(e);}}this.postDraw(e);return b.complete;},redrawBackgroundNode:function(d,b,f,a){var e=OpenLayers.Util.extend({},f);e.externalGraphic=e.backgroundGraphic;e.graphicXOffset=e.backgroundXOffset;e.graphicYOffset=e.backgroundYOffset;e.graphicZIndex=e.backgroundGraphicZIndex;e.graphicWidth=e.backgroundWidth||e.graphicWidth;e.graphicHeight=e.backgroundHeight||e.graphicHeight;e.backgroundGraphic=null;e.backgroundXOffset=null;e.backgroundYOffset=null;e.backgroundGraphicZIndex=null;return this.redrawNode(d+this.BACKGROUND_ID_SUFFIX,b,e,null);},drawGeometryNode:function(a,d,f){f=f||a._style;var e={isFilled:f.fill===undefined?true:f.fill,isStroked:f.stroke===undefined?!!f.strokeWidth:f.stroke};var b;switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":if(f.graphic===false){e.isFilled=false;e.isStroked=false;}b=this.drawPoint(a,d);break;case"OpenLayers.Geometry.LineString":e.isFilled=false;b=this.drawLineString(a,d);break;case"OpenLayers.Geometry.LinearRing":b=this.drawLinearRing(a,d);break;case"OpenLayers.Geometry.Polygon":b=this.drawPolygon(a,d);break;case"OpenLayers.Geometry.Surface":b=this.drawSurface(a,d);break;case"OpenLayers.Geometry.Rectangle":b=this.drawRectangle(a,d);break;default:break;}a._options=e;if(b!=false){return{node:this.setStyle(a,f,e,d),complete:b};}else{return false;}},postDraw:function(a){},drawPoint:function(a,b){},drawLineString:function(a,b){},drawLinearRing:function(a,b){},drawPolygon:function(a,b){},drawRectangle:function(a,b){},drawCircle:function(a,b){},drawSurface:function(a,b){},removeText:function(b){var a=document.getElementById(b+this.LABEL_ID_SUFFIX);if(a){this.textRoot.removeChild(a);}},getFeatureIdFromEvent:function(e){var b=e.target;var f=b&&b.correspondingUseElement;var a=f?f:(b||e.srcElement);var d=a._featureId;return d;},eraseGeometry:function(a,h){if((a.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")||(a.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(a.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")||(a.CLASS_NAME=="OpenLayers.Geometry.Collection")){for(var f=0,b=a.components.length;f<b;f++){this.eraseGeometry(a.components[f],h);}}else{var e=OpenLayers.Util.getElement(a.id);if(e&&e.parentNode){if(e.geometry){e.geometry.destroy();e.geometry=null;}e.parentNode.removeChild(e);if(this.indexer){this.indexer.remove(e);}if(e._style.backgroundGraphic){var d=a.id+this.BACKGROUND_ID_SUFFIX;var g=OpenLayers.Util.getElement(d);if(g&&g.parentNode){g.parentNode.removeChild(g);}}}}},nodeFactory:function(a,b){var d=OpenLayers.Util.getElement(a);if(d){if(!this.nodeTypeCompare(d,b)){d.parentNode.removeChild(d);d=this.nodeFactory(a,b);}}else{d=this.createNode(b,a);}return d;},nodeTypeCompare:function(b,a){},createNode:function(a,b){},moveRoot:function(b){var a=this.root;if(b.root.parentNode==this.rendererRoot){a=b.root;}a.parentNode.removeChild(a);b.rendererRoot.appendChild(a);},getRenderLayerId:function(){return this.root.parentNode.parentNode.id;},isComplexSymbol:function(a){return(a!="circle")&&!!a;},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(b,e,a,d){OpenLayers.Handler.prototype.initialize.apply(this,[b,a,d]);this.layer=e;},mousedown:function(a){this.down=a.xy;return this.handle(a)?!this.stopDown:true;},mouseup:function(a){this.up=a.xy;return this.handle(a)?!this.stopUp:true;},click:function(a){return this.handle(a)?!this.stopClick:true;},mousemove:function(a){if(!this.callbacks.over&&!this.callbacks.out){return true;}this.handle(a);return true;},dblclick:function(a){return !this.handle(a);},geometryTypeMatches:function(a){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1;},handle:function(d){if(this.feature&&!this.feature.layer){this.feature=null;}var f=d.type;var b=false;
var a=!!(this.feature);var g=(f=="click"||f=="dblclick");this.feature=this.layer.getFeatureFromEvent(d);if(this.feature&&!this.feature.layer){this.feature=null;}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null;}if(this.feature){var e=(this.feature!=this.lastFeature);if(this.geometryTypeMatches(this.feature)){if(a&&e){if(this.lastFeature){this.triggerCallback(f,"out",[this.lastFeature]);}this.triggerCallback(f,"in",[this.feature]);}else{if(!a||g){this.triggerCallback(f,"in",[this.feature]);}}this.lastFeature=this.feature;b=true;}else{if(this.lastFeature&&(a&&e||g)){this.triggerCallback(f,"out",[this.lastFeature]);}this.feature=null;}}else{if(this.lastFeature&&(a||g)){this.triggerCallback(f,"out",[this.lastFeature]);}}return b;},triggerCallback:function(b,d,f){var a=this.EVENTMAP[b][d];if(a){if(b=="click"&&this.up&&this.down){var e=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(e<=this.clickTolerance){this.callback(a,f);}}else{this.callback(a,f);}}},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true;}return a;},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true;}return a;},handleMapEvents:function(a){if(!a.property||a.property=="order"){this.moveLayerToTop();}},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a);},moveLayerBack:function(){var a=this.layer.getZIndex()-1;if(a>=this.map.Z_INDEX_BASE.Feature){this.layer.setZIndex(a);}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer));}},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(a,b){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(a instanceof OpenLayers.Style){this.styles["default"]=a;this.styles.select=a;this.styles.temporary=a;this.styles["delete"]=a;}else{if(typeof a=="object"){for(var d in a){if(a[d] instanceof OpenLayers.Style){this.styles[d]=a[d];}else{if(typeof a[d]=="object"){this.styles[d]=new OpenLayers.Style(a[d]);}else{this.styles["default"]=new OpenLayers.Style(a);this.styles.select=new OpenLayers.Style(a);this.styles.temporary=new OpenLayers.Style(a);this.styles["delete"]=new OpenLayers.Style(a);break;}}}}}OpenLayers.Util.extend(this,b);},destroy:function(){for(var a in this.styles){this.styles[a].destroy();}this.styles=null;},createSymbolizer:function(d,a){if(!d){d=new OpenLayers.Feature.Vector();}if(!this.styles[a]){a="default";}d.renderIntent=a;var b={};if(this.extendDefault&&a!="default"){b=this.styles["default"].createSymbolizer(d);}return OpenLayers.Util.extend(b,this.styles[a].createSymbolizer(d));},addUniqueValueRules:function(e,g,b,d){var a=[];for(var f in b){a.push(new OpenLayers.Rule({symbolizer:b[f],context:d,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:g,value:f})}));}this.styles[e].addRules(a);},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","beforefeaturesremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","sketchstarted","sketchmodified","sketchcomplete","refresh"],isBaseLayer:false,isFixed:false,isVector:true,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,initialize:function(a,e){this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES);OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer();}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError();}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap();}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var b=0,d=this.strategies.length;b<d;b++){this.strategies[b].setLayer(this);}}},destroy:function(){if(this.strategies){var a,d,b;for(d=0,b=this.strategies.length;d<b;d++){a=this.strategies[d];if(a.autoDestroy){a.destroy();}}this.strategies=null;}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy();}this.protocol=null;}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy();}this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments);},clone:function(d){if(d==null){d=new OpenLayers.Layer.Vector(this.name,this.getOptions());}d=OpenLayers.Layer.prototype.clone.apply(this,[d]);var a=this.features;var e=a.length;var b=new Array(e);for(var f=0;f<e;++f){b[f]=a[f].clone();}d.features=b;return d;},refresh:function(a){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",a);}},assignRenderer:function(){for(var a=0,d=this.renderers.length;a<d;a++){var e=this.renderers[a];var b=(typeof e=="function")?e:OpenLayers.Renderer[e];if(b&&b.prototype.supported()){this.renderer=new b(this.div,this.rendererOptions);break;}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}));}},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this);}else{this.renderer.map=this.map;this.renderer.setSize(this.map.getSize());}},afterAdd:function(){if(this.strategies){var a,d,b;for(d=0,b=this.strategies.length;d<b;d++){a=this.strategies[d];if(a.autoActivate){a.activate();}}}},removeMap:function(a){this.drawn=false;if(this.strategies){var b,e,d;for(e=0,d=this.strategies.length;e<d;e++){b=this.strategies[e];if(b.autoActivate){b.deactivate();}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);this.renderer.setSize(this.map.getSize());},moveTo:function(h,b,j){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var f=true;if(!j){this.renderer.root.style.visibility="hidden";this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var g=this.map.getExtent();f=this.renderer.setExtent(g,b);this.renderer.root.style.visibility="visible";if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.div.scrollLeft=this.div.scrollLeft;}if(!b&&f){for(var e in this.unrenderedFeatures){var d=this.unrenderedFeatures[e];this.drawFeature(d);}}}if(!this.drawn||b||!f){this.drawn=true;var d;for(var e=0,a=this.features.length;e<a;e++){this.renderer.locked=(e!==(a-1));d=this.features[e];this.drawFeature(d);}}},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);var b=this.div.style.display;if(b!=this.renderer.root.style.display){this.renderer.root.style.display=b;}},addFeatures:function(f,e){if(!(f instanceof Array)){f=[f];}var a=!e||!e.silent;if(a){var d={features:f};var m=this.events.triggerEvent("beforefeaturesadded",d);if(m===false){return;}f=d.features;}var h=[];for(var g=0,l=f.length;
g<l;g++){if(g!=(f.length-1)){this.renderer.locked=true;}else{this.renderer.locked=false;}var b=f[g];if(this.geometryType&&!(b.geometry instanceof this.geometryType)){var j=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});throw j;}b.layer=this;if(!b.style&&this.style){b.style=OpenLayers.Util.extend({},this.style);}if(a){if(this.events.triggerEvent("beforefeatureadded",{feature:b})===false){continue;}this.preFeatureInsert(b);}h.push(b);this.features.push(b);this.drawFeature(b);if(a){this.events.triggerEvent("featureadded",{feature:b});this.onFeatureInsert(b);}}if(a){this.events.triggerEvent("featuresadded",{features:h});}},removeFeatures:function(d,e){if(!d||d.length===0){return;}if(d===this.features){return this.removeAllFeatures(e);}if(!(d instanceof Array)){d=[d];}if(d===this.selectedFeatures){d=d.slice();}var b=!e||!e.silent;if(b){this.events.triggerEvent("beforefeaturesremoved",{features:d});}for(var a=d.length-1;a>=0;a--){if(a!=0&&d[a-1].geometry){this.renderer.locked=true;}else{this.renderer.locked=false;}var f=d[a];delete this.unrenderedFeatures[f.id];if(b){this.events.triggerEvent("beforefeatureremoved",{feature:f});}this.features=OpenLayers.Util.removeItem(this.features,f);f.layer=null;if(f.geometry){this.renderer.eraseFeatures(f);}if(OpenLayers.Util.indexOf(this.selectedFeatures,f)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,f);}if(b){this.events.triggerEvent("featureremoved",{feature:f});}}if(b){this.events.triggerEvent("featuresremoved",{features:d});}},removeAllFeatures:function(e){var b=!e||!e.silent;var d=this.features;if(b){this.events.triggerEvent("beforefeaturesremoved",{features:d});}var a;for(var f=d.length-1;f>=0;f--){a=d[f];if(b){this.events.triggerEvent("beforefeatureremoved",{feature:a});}a.layer=null;if(b){this.events.triggerEvent("featureremoved",{feature:a});}}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];if(b){this.events.triggerEvent("featuresremoved",{features:d});}},destroyFeatures:function(b,d){var a=(b==undefined);if(a){b=this.features;}if(b){this.removeFeatures(b,d);for(var e=b.length-1;e>=0;e--){b[e].destroy();}}},drawFeature:function(b,d){if(!this.drawn){return;}if(typeof d!="object"){if(!d&&b.state===OpenLayers.State.DELETE){d="delete";}var a=d||b.renderIntent;d=b.style||this.style;if(!d){d=this.styleMap.createSymbolizer(b,a);}}if(!this.renderer.drawFeature(b,d)){this.unrenderedFeatures[b.id]=b;}else{delete this.unrenderedFeatures[b.id];}},eraseFeatures:function(a){this.renderer.eraseFeatures(a);},getFeatureFromEvent:function(a){if(!this.renderer){OpenLayers.Console.error(OpenLayers.i18n("getFeatureError"));return null;}var b=this.renderer.getFeatureIdFromEvent(a);return this.getFeatureById(b);},getFeatureBy:function(d,b){var a=null;for(var f=0,e=this.features.length;f<e;++f){if(this.features[f][d]==b){a=this.features[f];break;}}return a;},getFeatureById:function(a){return this.getFeatureBy("id",a);},getFeatureByFid:function(a){return this.getFeatureBy("fid",a);},onFeatureInsert:function(a){},preFeatureInsert:function(a){},getDataExtent:function(){var f=null;var b=this.features;if(b&&(b.length>0)){f=new OpenLayers.Bounds();var d=null;for(var a=0,e=b.length;a<e;a++){d=b[a].geometry;if(d){f.extend(d.getBounds());}}}return f;},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(b,a){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[];},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments);},setOpacity:function(d){if(d!=this.opacity){this.opacity=d;for(var a=0,b=this.markers.length;a<b;a++){this.markers[a].setOpacity(this.opacity);}}},moveTo:function(b,f,d){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(f||!this.drawn){for(var a=0,e=this.markers.length;a<e;a++){this.drawMarker(this.markers[a]);}this.drawn=true;}},addMarker:function(a){this.markers.push(a);if(this.opacity!=null){a.setOpacity(this.opacity);}if(this.map&&this.map.getExtent()){a.map=this.map;this.drawMarker(a);}},removeMarker:function(a){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,a);a.erase();}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0]);}}},drawMarker:function(b){var d=this.map.getLayerPxFromLonLat(b.lonlat);if(d==null){b.display(false);}else{if(!b.isDrawn()){var a=b.draw(d);this.div.appendChild(a);}else{if(b.icon){b.icon.moveTo(d);}}}},getDataExtent:function(){var e=null;if(this.markers&&(this.markers.length>0)){var e=new OpenLayers.Bounds();for(var b=0,d=this.markers.length;b<d;b++){var a=this.markers[b];e.extend(a.lonlat);}}return e;},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:false,layers:null,initialize:function(b,a){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments);},display:function(){},getFeatureFromEvent:function(d){var b=this.layers;var a;for(var e=0;e<b.length;e++){a=b[e].getFeatureFromEvent(d);if(a){return a;}}},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();a.events.register("changelayer",this,this.handleChangeLayer);},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments);},collectRoots:function(){var b;for(var a=0;a<this.map.layers.length;++a){b=this.map.layers[a];if(OpenLayers.Util.indexOf(this.layers,b)!=-1){b.renderer.moveRoot(this.renderer);}}},resetRoots:function(){var b;for(var a=0;a<this.layers.length;++a){b=this.layers[a];if(this.renderer&&b.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(b.renderer);}}},handleChangeLayer:function(a){var b=a.layer;if(a.property=="order"&&OpenLayers.Util.indexOf(this.layers,b)!=-1){this.resetRoots();this.collectRoots();}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(a,b){this.EVENT_TYPES=OpenLayers.Control.SelectFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[b]);if(this.scope===null){this.scope=this;}this.initLayer(a);var d={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){d.over=this.overFeature;d.out=this.outFeature;}this.callbacks=OpenLayers.Util.extend(d,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"});}},initLayer:function(a){if(a instanceof Array){this.layers=a;this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a});}else{this.layer=a;}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer);}OpenLayers.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy();}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer);}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate();}}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate();
}if(this.layers){this.map.removeLayer(this.layer);}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},unselectAll:function(e){var b=this.layers||[this.layer];var a,g;for(var d=0;d<b.length;++d){a=b[d];for(var f=a.selectedFeatures.length-1;f>=0;--f){g=a.selectedFeatures[f];if(!e||e.except!=g){this.unselect(g);}}}},clickFeature:function(a){if(!this.hover){var b=(OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1);if(b){if(this.toggleSelect()){this.unselect(a);}else{if(!this.multipleSelect()){this.unselectAll({except:a});}}}else{if(!this.multipleSelect()){this.unselectAll({except:a});}this.select(a);}}},multipleSelect:function(){return this.multiple||(this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]);},toggleSelect:function(){return this.toggle||(this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]);},clickoutFeature:function(a){if(!this.hover&&this.clickout){this.unselectAll();}},overFeature:function(b){var a=b.layer;if(this.hover){if(this.highlightOnly){this.highlight(b);}else{if(OpenLayers.Util.indexOf(a.selectedFeatures,b)==-1){this.select(b);}}}},outFeature:function(a){if(this.hover){if(this.highlightOnly){if(a._lastHighlighter==this.id){if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);if(b){b.highlight(a);}}else{this.unhighlight(a);}}}else{this.unselect(a);}}},highlight:function(a){var e=a.layer;var d=this.events.triggerEvent("beforefeaturehighlighted",{feature:a});if(d!==false){a._prevHighlighter=a._lastHighlighter;a._lastHighlighter=this.id;var b=this.selectStyle||this.renderIntent;e.drawFeature(a,b);this.events.triggerEvent("featurehighlighted",{feature:a});}},unhighlight:function(b){var a=b.layer;b._lastHighlighter=b._prevHighlighter;delete b._prevHighlighter;a.drawFeature(b,b.style||b.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:b});},select:function(a){var b=this.onBeforeSelect.call(this.scope,a);var d=a.layer;if(b!==false){b=d.events.triggerEvent("beforefeatureselected",{feature:a});if(b!==false){d.selectedFeatures.push(a);this.highlight(a);if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=d.selectedFeatures[0];}d.events.triggerEvent("featureselected",{feature:a});this.onSelect.call(this.scope,a);}}},unselect:function(b){var a=b.layer;this.unhighlight(b);OpenLayers.Util.removeItem(a.selectedFeatures,b);a.events.triggerEvent("featureunselected",{feature:b});this.onUnselect.call(this.scope,b);},selectBox:function(h){if(h instanceof OpenLayers.Bounds){var o=this.map.getLonLatFromPixel(new OpenLayers.Pixel(h.left,h.bottom));var b=this.map.getLonLatFromPixel(new OpenLayers.Pixel(h.right,h.top));var a=new OpenLayers.Bounds(o.lon,o.lat,b.lon,b.lat);if(!this.multipleSelect()){this.unselectAll();}var q=this.multiple;this.multiple=true;var g=this.layers||[this.layer];var j;for(var d=0;d<g.length;++d){j=g[d];for(var e=0,m=j.features.length;e<m;++e){var f=j.features[e];if(!f.getVisibility()){continue;}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,f.geometry.CLASS_NAME)>-1){if(a.toGeometry().intersects(f.geometry)){if(OpenLayers.Util.indexOf(j.selectedFeatures,f)==-1){this.select(f);}}}}}this.multiple=q;}},setMap:function(a){this.handlers.feature.setMap(a);if(this.box){this.handlers.box.setMap(a);}OpenLayers.Control.prototype.setMap.apply(this,arguments);},setLayer:function(b){var a=this.active;this.unselectAll();this.deactivate();if(this.layers){this.layer.destroy();this.layers=null;}this.initLayer(b);this.handlers.feature.layer=this.layer;if(a){this.activate();}},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var d={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(d,this.previousOptions);this.previous=new OpenLayers.Control.Button(d);var a={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(a,this.nextOptions);this.next=new OpenLayers.Control.Button(a);this.clear();},onPreviousChange:function(b,a){if(b&&!this.previous.active){this.previous.activate();}else{if(!b&&this.previous.active){this.previous.deactivate();}}},onNextChange:function(b,a){if(b&&!this.next.active){this.next.activate();}else{if(!b&&this.next.active){this.next.deactivate();}}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var a in this){this[a]=null;}},setMap:function(a){this.map=a;this.next.setMap(a);this.previous.setMap(a);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw();},previousTrigger:function(){var b=this.previousStack.shift();var a=this.previousStack.shift();if(a!=undefined){this.nextStack.unshift(b);this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);}else{this.previousStack.unshift(b);}return a;},nextTrigger:function(){var a=this.nextStack.shift();if(a!=undefined){this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);}return a;},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate();},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units};},restore:function(a){var d,g;if(this.map.getProjectionObject()==a.projection){g=this.map.getZoomForResolution(a.resolution);d=a.center;}else{d=a.center.clone();d.transform(a.projection,this.map.getProjectionObject());var b=a.units;var e=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var f=b&&e?OpenLayers.INCHES_PER_UNIT[b]/OpenLayers.INCHES_PER_UNIT[e]:1;g=this.map.getZoomForResolution(f*a.resolution);}this.map.setCenter(d,g);},setListeners:function(){this.listeners={};for(var a in this.registry){this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=this.registry[a].apply(this,arguments);this.previousStack.unshift(b);if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);}if(this.previousStack.length>(this.limit+1)){this.previousStack.pop();}if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0);}}return true;},this);}},activate:function(){var a=false;if(this.map){if(OpenLayers.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners();}for(var b in this.listeners){this.map.events.register(b,this,this.listeners[b]);}a=true;if(this.previousStack.length==0){this.initStack();}}}return a;},initStack:function(){if(this.map.getCenter()){this.listeners.moveend();}},deactivate:function(){var b=false;if(this.map){if(OpenLayers.Control.prototype.deactivate.apply(this)){for(var a in this.listeners){this.map.events.unregister(a,this,this.listeners[a]);}if(this.clearOnDeactivate){this.clear();}b=true;}}return b;},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);
},destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div;},updateAttribution:function(){var b=[];if(this.map&&this.map.layers){for(var a=0,d=this.map.layers.length;a<d;a++){var e=this.map.layers[a];if(e.attribution&&e.getVisibility()){if(OpenLayers.Util.indexOf(b,e.attribution)===-1){b.push(e.attribution);}}}this.div.innerHTML=b.join(this.separator);}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,drillDown:false,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:false,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["beforegetfeatureinfo","nogetfeatureinfo","getfeatureinfo"],initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.WMSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions);}if(this.drillDown===true){this.hover=false;}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));}else{var b={};b[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{});}},activate:function(){if(!this.active){this.handler.activate();}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},getInfoForClick:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(a.xy,{});},getInfoForHover:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});this.request(a.xy,{hover:true});},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null;}},findLayers:function(){var a=this.layers||this.map.layers;var b=[];var g,e;for(var f=0,d=a.length;f<d;++f){g=a[f];if(g instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||g.getVisibility())){e=g.url instanceof Array?g.url[0]:g.url;if(this.drillDown===false&&!this.url){this.url=e;}if(this.drillDown===true||this.urlMatches(e)){b.push(g);}}}return b;},urlMatches:function(e){var b=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!b&&this.layerUrls){for(var a=0,d=this.layerUrls.length;a<d;++a){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[a],e)){b=true;break;}}}return b;},buildWMSOptions:function(f,j,g,d){var b=[],e=[];for(var l=0,a=j.length;l<a;l++){b=b.concat(j[l].params.LAYERS);e=e.concat(this.getStyleNames(j[l]));}var h=OpenLayers.Util.extend({service:"WMS",version:j[0].params.VERSION,request:"GetFeatureInfo",layers:b,query_layers:b,styles:e,bbox:this.map.getExtent().toBBOX(null,j[0].reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:d,info_format:this.infoFormat},(parseFloat(j[0].params.VERSION)>=1.3)?{crs:this.map.getProjection(),i:g.x,j:g.y}:{srs:this.map.getProjection(),x:g.x,y:g.y});OpenLayers.Util.applyDefaults(h,this.vendorParams);return{url:f,params:OpenLayers.Util.upperCaseObject(h),callback:function(m){this.handleResponse(g,m);},scope:this};},getStyleNames:function(b){var a;if(b.params.STYLES){a=b.params.STYLES;}else{if(b.params.LAYERS instanceof Array){a=new Array(b.params.LAYERS.length);}else{a=b.params.LAYERS.replace(/[^,]/g,"");}}return a;},request:function(q,b){var d=this.findLayers();if(d.length==0){this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");return;}b=b||{};if(this.drillDown===false){var m=this.buildWMSOptions(this.url,d,q,d[0].params.FORMAT);var a=OpenLayers.Request.GET(m);if(b.hover===true){this.hoverRequest=a;}}else{this._requestCount=0;this._numRequests=0;this.features=[];var j={},l;for(var e=0,h=d.length;e<h;e++){var f=d[e];var g,o=false;l=f.url instanceof Array?f.url[0]:f.url;if(l in j){j[l].push(f);}else{this._numRequests++;j[l]=[f];}}var d;for(var l in j){d=j[l];var m=this.buildWMSOptions(l,d,q,d[0].params.FORMAT);OpenLayers.Request.GET(m);}}},triggerGetFeatureInfo:function(d,a,b){this.events.triggerEvent("getfeatureinfo",{text:d.responseText,features:b,request:d,xy:a});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");},handleResponse:function(b,e){var a=e.responseXML;if(!a||!a.documentElement){a=e.responseText;}var d=this.format.read(a);if(this.drillDown===false){this.triggerGetFeatureInfo(e,b,d);}else{this._requestCount++;this._features=(this._features||[]).concat(d);if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(e,b,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests;}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},events:new OpenLayers.Events(this,null,["complete","success","failure"]),issue:function(g){var l=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});g=OpenLayers.Util.applyDefaults(g,l);var j=new OpenLayers.Request.XMLHttpRequest();var f=g.url;if(g.params){var h=OpenLayers.Util.getParameterString(g.params);if(h.length>0){var b=(f.indexOf("?")>-1)?"&":"?";f+=b+h;}}if(g.proxy&&(f.indexOf("http")==0)){if(typeof g.proxy=="function"){f=g.proxy(f);}else{f=g.proxy+encodeURIComponent(f);}}j.open(g.method,f,g.async,g.user,g.password);for(var a in g.headers){j.setRequestHeader(a,g.headers[a]);}var e=this.events;var d=this;j.onreadystatechange=function(){if(j.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var m=e.triggerEvent("complete",{request:j,config:g,requestUrl:f});if(m!==false){d.runCallbacks({request:j,config:g,requestUrl:f});}}};if(g.async===false){j.send(g.data);}else{window.setTimeout(function(){if(j._aborted!==true){j.send(g.data);}},0);}return j;},runCallbacks:function(g){var a=g.request;var f=g.config;var d=(f.scope)?OpenLayers.Function.bind(f.callback,f.scope):f.callback;var b;if(f.success){b=(f.scope)?OpenLayers.Function.bind(f.success,f.scope):f.success;}var e;if(f.failure){e=(f.scope)?OpenLayers.Function.bind(f.failure,f.scope):f.failure;}d(a);if(!a.status||(a.status>=200&&a.status<300)){this.events.triggerEvent("success",g);if(b){b(a);}}if(a.status&&(a.status<200||a.status>=300)){this.events.triggerEvent("failure",g);if(e){e(a);}}},GET:function(a){a=OpenLayers.Util.extend(a,{method:"GET"});return OpenLayers.Request.issue(a);},POST:function(a){a=OpenLayers.Util.extend(a,{method:"POST"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml";}return OpenLayers.Request.issue(a);},PUT:function(a){a=OpenLayers.Util.extend(a,{method:"PUT"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml";}return OpenLayers.Request.issue(a);},DELETE:function(a){a=OpenLayers.Util.extend(a,{method:"DELETE"});return OpenLayers.Request.issue(a);},HEAD:function(a){a=OpenLayers.Util.extend(a,{method:"HEAD"});return OpenLayers.Request.issue(a);
},OPTIONS:function(a){a=OpenLayers.Util.extend(a,{method:"OPTIONS"});return OpenLayers.Request.issue(a);}};(function(){var l=window.XMLHttpRequest;var f=!!window.controllers,d=window.document.all&&!window.opera,e=d&&window.navigator.userAgent.match(/MSIE ([\.0-9]+)/)&&RegExp.$1==7;function h(){this._object=l&&!e?new l:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[];}if(f&&l.wrapped){h.wrapped=l.wrapped;}h.UNSENT=0;h.OPENED=1;h.HEADERS_RECEIVED=2;h.LOADING=3;h.DONE=4;h.prototype.readyState=h.UNSENT;h.prototype.responseText="";h.prototype.responseXML=null;h.prototype.status=0;h.prototype.statusText="";h.prototype.onreadystatechange=null;h.onreadystatechange=null;h.onopen=null;h.onsend=null;h.onabort=null;h.prototype.open=function(s,v,r,m,q){delete this._headers;if(arguments.length<3){r=true;}this._async=r;var u=this,t=this.readyState,o;if(d&&r){o=function(){if(t!=h.DONE){j(u);u.abort();}};window.attachEvent("onunload",o);}if(h.onopen){h.onopen.apply(this,arguments);}if(arguments.length>4){this._object.open(s,v,r,m,q);}else{if(arguments.length>3){this._object.open(s,v,r,m);}else{this._object.open(s,v,r);}}if(!f&&!d){this.readyState=h.OPENED;g(this);}this._object.onreadystatechange=function(){if(f&&!r){return;}u.readyState=u._object.readyState;a(u);if(u._aborted){u.readyState=h.UNSENT;return;}if(u.readyState==h.DONE){j(u);if(d&&r){window.detachEvent("onunload",o);}}if(t!=u.readyState){g(u);}t=u.readyState;};};h.prototype.send=function(m){if(h.onsend){h.onsend.apply(this,arguments);}if(m&&m.nodeType){m=window.XMLSerializer?new window.XMLSerializer().serializeToString(m):m.xml;if(!this._headers["Content-Type"]){this._object.setRequestHeader("Content-Type","application/xml");}}this._object.send(m);if(f&&!this._async){this.readyState=h.OPENED;a(this);while(this.readyState<h.DONE){this.readyState++;g(this);if(this._aborted){return;}}}};h.prototype.abort=function(){if(h.onabort){h.onabort.apply(this,arguments);}if(this.readyState>h.UNSENT){this._aborted=true;}this._object.abort();j(this);};h.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders();};h.prototype.getResponseHeader=function(m){return this._object.getResponseHeader(m);};h.prototype.setRequestHeader=function(o,m){if(!this._headers){this._headers={};}this._headers[o]=m;return this._object.setRequestHeader(o,m);};h.prototype.addEventListener=function(s,r,q){for(var o=0,m;m=this._listeners[o];o++){if(m[0]==s&&m[1]==r&&m[2]==q){return;}}this._listeners.push([s,r,q]);};h.prototype.removeEventListener=function(s,r,q){for(var o=0,m;m=this._listeners[o];o++){if(m[0]==s&&m[1]==r&&m[2]==q){break;}}if(m){this._listeners.splice(o,1);}};h.prototype.dispatchEvent=function(q){var r={type:q.type,target:this,currentTarget:this,eventPhase:2,bubbles:q.bubbles,cancelable:q.cancelable,timeStamp:q.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};if(r.type=="readystatechange"&&this.onreadystatechange){(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[r]);}for(var o=0,m;m=this._listeners[o];o++){if(m[0]==r.type&&!m[2]){(m[1].handleEvent||m[1]).apply(this,[r]);}}};h.prototype.toString=function(){return"[object XMLHttpRequest]";};h.toString=function(){return"[XMLHttpRequest]";};function g(m){if(h.onreadystatechange){h.onreadystatechange.apply(m);}m.dispatchEvent({type:"readystatechange",bubbles:false,cancelable:false,timeStamp:new Date+0});}function b(m){var q=m.responseXML,o=m.responseText;if(d&&o&&q&&!q.documentElement&&m.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){q=new window.ActiveXObject("Microsoft.XMLDOM");q.async=false;q.validateOnParse=false;q.loadXML(o);}if(q){if((d&&q.parseError!=0)||!q.documentElement||(q.documentElement&&q.documentElement.tagName=="parsererror")){return null;}}return q;}function a(o){try{o.responseText=o._object.responseText;}catch(m){}try{o.responseXML=b(o._object);}catch(m){}try{o.status=o._object.status;}catch(m){}try{o.statusText=o._object.statusText;}catch(m){}}function j(m){m._object.onreadystatechange=new window.Function;}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(o,m){if(!m){m=[];}o.__func=this;o.__func(m[0],m[1],m[2],m[3],m[4]);delete o.__func;};}OpenLayers.Request.XMLHttpRequest=h;})();OpenLayers.ProxyHost="";OpenLayers.nullHandler=function(a){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:a.statusText}));};OpenLayers.loadURL=function(f,a,d,g,e){if(typeof a=="string"){a=OpenLayers.Util.getParameters(a);}var h=(g)?g:OpenLayers.nullHandler;var b=(e)?e:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:f,params:a,success:h,failure:b,scope:d});};OpenLayers.parseXMLString=function(a){var b=a.indexOf("<");if(b>0){a=a.substring(b);}var d=OpenLayers.Util.Try(function(){var e=new ActiveXObject("Microsoft.XMLDOM");e.loadXML(a);return e;},function(){return new DOMParser().parseFromString(a,"text/xml");},function(){var e=new XMLHttpRequest();e.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(a),false);if(e.overrideMimeType){e.overrideMimeType("text/xml");}e.send(null);return e.responseXML;});return d;};OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest();},function(){return new ActiveXObject("Msxml2.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");})||false;},activeRequestCount:0};OpenLayers.Ajax.Responders={responders:[],register:function(b){for(var a=0;a<this.responders.length;a++){if(b==this.responders[a]){return;}}this.responders.push(b);},unregister:function(a){OpenLayers.Util.removeItem(this.reponders,a);},dispatch:function(b,f,a){var d;for(var g=0;g<this.responders.length;g++){d=this.responders[g];if(d[b]&&typeof d[b]=="function"){try{d[b].apply(d,[f,a]);}catch(h){}}}}};OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++;},onComplete:function(){OpenLayers.Ajax.activeRequestCount--;}});OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/xml",parameters:""};OpenLayers.Util.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters);}}});OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:false,initialize:function(b,a){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[a]);if(OpenLayers.ProxyHost&&OpenLayers.String.startsWith(b,"http")){b=OpenLayers.ProxyHost+encodeURIComponent(b);}this.transport=OpenLayers.Ajax.getTransport();this.request(b);},request:function(f){this.url=f;this.method=this.options.method;var b=OpenLayers.Util.extend({},this.options.parameters);if(this.method!="get"&&this.method!="post"){b._method=this.method;this.method="post";}this.parameters=b;if(b=OpenLayers.Util.getParameterString(b)){if(this.method=="get"){this.url+=((this.url.indexOf("?")>-1)?"&":"?")+b;}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){b+="&_=";}}}try{var d=new OpenLayers.Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(d);}OpenLayers.Ajax.Responders.dispatch("onCreate",this,d);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10);}this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||b):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange();}}catch(a){this.dispatchException(a);}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!((a==4)&&this._complete)){this.respondToReadyState(this.transport.readyState);}},setRequestHeaders:function(){var d={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:true};
if(this.method=="post"){d["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){d.Connection="close";}}if(typeof this.options.requestHeaders=="object"){var a=this.options.requestHeaders;if(typeof a.push=="function"){for(var f=0,b=a.length;f<b;f+=2){d[a[f]]=a[f+1];}}else{for(var f in a){d[f]=a[f];}}}for(var e in d){this.transport.setRequestHeader(e,d[e]);}},success:function(){var a=this.getStatus();return !a||(a>=200&&a<300);},getStatus:function(){try{return this.transport.status||0;}catch(a){return 0;}},respondToReadyState:function(f){var a=OpenLayers.Ajax.Request.Events[f];var g=new OpenLayers.Ajax.Response(this);if(a=="Complete"){try{this._complete=true;(this.options["on"+g.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(g);}catch(b){this.dispatchException(b);}var d=g.getHeader("Content-type");}try{(this.options["on"+a]||OpenLayers.Ajax.emptyFunction)(g);OpenLayers.Ajax.Responders.dispatch("on"+a,this,g);}catch(b){this.dispatchException(b);}if(a=="Complete"){this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction;}},getHeader:function(a){try{return this.transport.getResponseHeader(a);}catch(b){return null;}},dispatchException:function(a){var b=this.options.onException;if(b){b(this,a);OpenLayers.Ajax.Responders.dispatch("onException",this,a);}else{var d=false;var e=OpenLayers.Ajax.Responders.responders;for(var f=0;f<e.length;f++){if(e[f].onException){d=true;break;}}if(d){OpenLayers.Ajax.Responders.dispatch("onException",this,a);}else{throw a;}}}});OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(a){this.request=a;var b=this.transport=a.transport,d=this.readyState=b.readyState;if((d>2&&!(!!(window.attachEvent&&!window.opera)))||d==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=b.responseText==null?"":String(b.responseText);}if(d==4){var e=b.responseXML;this.responseXML=e===undefined?null:e;}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||"";}catch(a){return"";}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(a){return this.transport.getResponseHeader(a);}});OpenLayers.Ajax.getElementsByTagNameNS=function(f,e,a,d){var b=null;if(f.getElementsByTagNameNS){b=f.getElementsByTagNameNS(e,d);}else{b=f.getElementsByTagName(a+":"+d);}return b;};OpenLayers.Ajax.serializeXMLToString=function(b){var d=new XMLSerializer();var a=d.serializeToString(b);return a;};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(b,a){this.lon=OpenLayers.Util.toFloat(b);this.lat=OpenLayers.Util.toFloat(a);},toString:function(){return("lon="+this.lon+",lat="+this.lat);},toShortString:function(){return(this.lon+", "+this.lat);},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat);},add:function(a,b){if((a==null)||(b==null)){var d=OpenLayers.i18n("lonlatAddError");OpenLayers.Console.error(d);return null;}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(a),this.lat+OpenLayers.Util.toFloat(b));},equals:function(b){var a=false;if(b!=null){a=((this.lon==b.lon&&this.lat==b.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(b.lon)&&isNaN(b.lat)));}return a;},transform:function(a,d){var b=OpenLayers.Projection.transform({x:this.lon,y:this.lat},a,d);this.lon=b.x;this.lat=b.y;return this;},wrapDateLine:function(a){var b=this.clone();if(a){while(b.lon<a.left){b.lon+=a.getWidth();}while(b.lon>a.right){b.lon-=a.getWidth();}}return b;},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(b){var a=b.split(",");return new OpenLayers.LonLat(a[0],a[1]);};OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a);this.h=parseFloat(b);},toString:function(){return("w="+this.w+",h="+this.h);},clone:function(){return new OpenLayers.Size(this.w,this.h);},equals:function(b){var a=false;if(b!=null){a=((this.w==b.w&&this.h==b.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(b.w)&&isNaN(b.h)));}return a;},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a);this.y=parseFloat(b);},toString:function(){return("x="+this.x+",y="+this.y);},clone:function(){return new OpenLayers.Pixel(this.x,this.y);},equals:function(a){var b=false;if(a!=null){b=((this.x==a.x&&this.y==a.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)));}return b;},add:function(b,a){if((b==null)||(a==null)){var d=OpenLayers.i18n("pixelAddError");OpenLayers.Console.error(d);return null;}return new OpenLayers.Pixel(this.x+b,this.y+a);},offset:function(a){var b=this.clone();if(a){b=this.add(a.x,a.y);}return b;},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode();}return OpenLayers.Lang.code;},setCode:function(e){var b;if(!e){e=(OpenLayers.Util.getBrowserName()=="msie")?navigator.userLanguage:navigator.language;}var a=e.split("-");a[0]=a[0].toLowerCase();if(typeof OpenLayers.Lang[a[0]]=="object"){b=a[0];}if(a[1]){var d=a[0]+"-"+a[1].toUpperCase();if(typeof OpenLayers.Lang[d]=="object"){b=d;}}if(!b){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+a.join("-")+" dictionary, falling back to default language");b=OpenLayers.Lang.defaultCode;}OpenLayers.Lang.code=b;},translate:function(e,d){var b=OpenLayers.Lang[OpenLayers.Lang.getCode()];var a=b[e];if(!a){a=e;}if(d){a=OpenLayers.String.format(a,d);}return a;}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Base Layer",sameProjection:"The overview map only works when it is in the same projection as the main map",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>",scale:"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",graticule:"Graticule",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition failed: element with id ${elemId} may be misplaced.",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type.",end:""};
OpenLayers.Lang.fr=OpenLayers.Util.applyDefaults({unhandledRequest:"Requte non gre, retournant ${statusText}",permalink:"Permalien",overlays:"Calques",baseLayer:"Calque de base",sameProjection:"La carte de situation ne fonctionne que lorsque sa projection est la mme que celle de la carte principale",readNotImplemented:"Lecture non implmente.",writeNotImplemented:"Ecriture non implmente.",noFID:"Impossible de mettre  jour un objet sans identifiant (fid).",errorLoadingGML:"Erreur au chargement du fichier GML ${url}",browserNotSupported:"Votre navigateur ne supporte pas le rendu vectoriel. Les renderers actuellement supports sont : \n${renderers}",componentShouldBe:"addFeatures : le composant devrait tre de type ${geomType}",getFeatureError:"getFeatureFromEvent a t appel sur un calque sans renderer. Cela signifie gnralement que vous avez dtruit cette couche, mais que vous avez conserv un handler qui lui tait associ.",minZoomLevelError:"La proprit minZoomLevel doit seulement tre utilise pour des couches FixedZoomLevels-descendent. Le fait que cette couche WFS vrifie la prsence de minZoomLevel est une relique du pass. Nous ne pouvons toutefois la supprimer sans casser des applications qui pourraient en dpendre. C'est pourquoi nous la dprcions -- la vrification du minZoomLevel sera supprime en version 3.0. A la place, merci d'utiliser les paramtres de rsolutions min/max tel que dcrit sur : http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transaction WFS : SUCCES ${response}",commitFailed:"Transaction WFS : ECHEC ${response}",googleWarning:"La couche Google n'a pas t en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le slecteur de couche en haut  droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement caus par la non-inclusion de la librairie Google Maps, ou alors parce que la cl de l'API ne correspond pas  votre site.\x3cbr\x3e\x3cbr\x3eDveloppeurs : pour savoir comment corriger ceci, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3ecliquez ici\x3c/a\x3e",getLayerWarning:"La couche ${layerType} n'est pas en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le slecteur de couche en haut  droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement caus par la non-inclusion de la librairie ${layerLib}.\x3cbr\x3e\x3cbr\x3eDveloppeurs : pour savoir comment corriger ceci, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3ecliquez ici\x3c/a\x3e",scale:"Echelle ~ 1 : ${scaleDenom}",W:"O",E:"E",N:"N",S:"S",layerAlreadyAdded:"Vous avez essay d'ajouter  la carte le calque : ${layerName}, mais il est dj prsent",reprojectDeprecated:"Vous utilisez l'option 'reproject' sur la couche ${layerName}. Cette option est dprcie : Son usage permettait d'afficher des donnes au dessus de couches raster commerciales.Cette fonctionalit est maintenant supporte en utilisant le support de la projection Mercator Sphrique. Plus d'information est disponible sur http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Cette mthode est dprcie, et sera supprime  la version 3.0. Merci d'utiliser ${newMethod}  la place.",boundsAddError:"Vous devez passer les deux valeurs x et y  la fonction add.",lonlatAddError:"Vous devez passer les deux valeurs lon et lat  la fonction add.",pixelAddError:"Vous devez passer les deux valeurs x et y  la fonction add.",unsupportedGeometryType:"Type de gomtrie non support : ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition a chou: l'lment d'id ${elemId} pourrait tre mal positionn.",filterEvaluateNotImplemented:"valuer n'a pas encore t implment pour ce type de filtre."});OpenLayers.Lang.de=OpenLayers.Util.applyDefaults({unhandledRequest:"Unbehandelte Anfragerckmeldung ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Grundkarte",sameProjection:"Die bersichtskarte funktioniert nur, wenn sie dieselbe Projektion wie die Hauptkarte verwendet",readNotImplemented:"Lesen nicht implementiert.",writeNotImplemented:"Schreiben nicht implementiert.",noFID:"Ein Feature, fr das keine FID existiert, kann nicht aktualisiert werden.",errorLoadingGML:"Fehler beim Laden der GML-Datei ${url}",browserNotSupported:"Ihr Browser untersttzt keine Vektordarstellung. Aktuell untersttzte Renderer:\n${renderers}",componentShouldBe:"addFeatures: Komponente muss vom Typ ${geomType} sein",getFeatureError:"getFeatureFromEvent wurde vom einem Layer ohne Renderer aufgerufen. Dies bedeutet normalerweise, dass ein Layer entfernt wurde, aber nicht Handler, die auf ihn verweisen.",minZoomLevelError:"Die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Eigenschaft ist nur fr die Verwendung mit \x3ccode\x3eFixedZoomLevels\x3c/code\x3e-untergeordneten Layers vorgesehen. Das dieser \x3ctt\x3ewfs\x3c/tt\x3e-Layer die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Eigenschaft berprft ist ein Relikt der Vergangenheit. Wir knnen diese berprfung nicht entfernen, ohne das OL basierende Applikationen nicht mehr funktionieren. Daher markieren wir es als veraltet - die \x3ccode\x3eminZoomLevel\x3c/code\x3e-berprfung wird in Version 3.0 entfernt werden. Bitte verwenden Sie stattdessen die Min-/Max-Lsung, wie sie unter http://trac.openlayers.org/wiki/SettingZoomLevels beschrieben ist.",commitSuccess:"WFS-Transaktion: Erfolgreich ${response}",commitFailed:"WFS-Transaktion: Fehlgeschlagen ${response}",googleWarning:"Der Google-Layer konnte nicht korrekt geladen werden.\x3cbr\x3e\x3cbr\x3eUm diese Meldung nicht mehr zu erhalten, whlen Sie einen anderen Hintergrundlayer aus dem LayerSwitcher in der rechten oberen Ecke.\x3cbr\x3e\x3cbr\x3eSehr wahrscheinlich tritt dieser Fehler auf, weil das Skript der Google-Maps-Bibliothek nicht eingebunden wurde oder keinen gltigen API-Schlssel fr Ihre URL enthlt.\x3cbr\x3e\x3cbr\x3eEntwickler: Besuche \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3edas Wiki\x3c/a\x3e fr Hilfe zum korrekten Einbinden des Google-Layers",getLayerWarning:"Der ${layerType}-Layer konnte nicht korrekt geladen werden.\x3cbr\x3e\x3cbr\x3eUm diese Meldung nicht mehr zu erhalten, whlen Sie einen anderen Hintergrundlayer aus dem LayerSwitcher in der rechten oberen Ecke.\x3cbr\x3e\x3cbr\x3eSehr wahrscheinlich tritt dieser Fehler auf, weil das Skript der '${layerLib}'-Bibliothek nicht eingebunden wurde.\x3cbr\x3e\x3cbr\x3eEntwickler: Besuche \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3edas Wiki\x3c/a\x3e fr Hilfe zum korrekten Einbinden von Layern",scale:"Mastab = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"S",layerAlreadyAdded:"Sie versuchen den Layer ${layerName} zur Karte hinzuzufgen, er wurde aber bereits hinzugefgt",reprojectDeprecated:"Sie verwenden die Reproject-Option des Layers ${layerName}. Diese Option ist veraltet: Sie wurde entwickelt um die Anzeige von Daten auf kommerziellen Basiskarten zu untersttzen, aber diese Funktion sollte jetzt durch Untersttzung der Spherical Mercator erreicht werden. Weitere Informationen sind unter http://trac.openlayers.org/wiki/SphericalMercator verfgbar.",methodDeprecated:"Die Methode ist veraltet und wird in 3.0 entfernt. Bitte verwende stattdessen ${newMethod}.",boundsAddError:"Beide Werte (x und y) mssen der add-Funktion bergeben werden.",lonlatAddError:"Beide Werte (lon und lat) mssen der add-Funktion bergeben werden.",pixelAddError:"Beide Werte (x und y) mssen der add-Funktion bergeben werden.",unsupportedGeometryType:"Nicht untersttzter Geometrie-Typ: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition fehlgeschlagen: Element mit Id ${elemId} mglicherweise falsch platziert.",filterEvaluateNotImplemented:"evaluate ist fr diesen Filter-Typ nicht implementiert."});OpenLayers.Lang.nl=OpenLayers.Util.applyDefaults({unhandledRequest:"Het verzoek is niet afgehandeld met de volgende melding: ${statusText}",permalink:"Permanente verwijzing",overlays:"Overlays",baseLayer:"Achtergrondkaart",sameProjection:"De overzichtskaart werkt alleen als de projectie gelijk is aan de projectie van de hoofdkaart",readNotImplemented:"Lezen is niet gemplementeerd.",writeNotImplemented:"Schrijven is niet gemplementeerd.",noFID:"Een optie die geen FID heeft kan niet bijgewerkt worden.",errorLoadingGML:"Er is een fout opgetreden bij het laden van het GML bestand van ${url}",browserNotSupported:"Uw browser ondersteunt het weergeven van vectoren niet.\nMomenteel ondersteunde weergavemogelijkheden:\n${renderers}",componentShouldBe:"addFeatures : component moet van het type ${geomType} zijn",getFeatureError:"getFeatureFromEvent is aangeroepen op een laag zonder rederer.\nDit betekent meestal dat u een laag hebt verwijderd, maar niet een handler die ermee geassocieerd was.",minZoomLevelError:"De eigenschap minZoomLevel is alleen bedoeld voor gebruik lagen met die afstammen van FixedZoomLevels-lagen.\nDat deze WFS-laag minZoomLevel controleert, is een overblijfsel uit het verleden.\nWe kunnen deze controle echter niet verwijderen zonder op OL gebaseerde applicaties die hervan afhankelijk zijn stuk te maken.\nDaarom heeft deze functionaliteit de eigenschap 'deprecated' gekregen - de minZoomLevel wordt verwijderd in versie 3.0.\nGebruik in plaats van deze functie de mogelijkheid om min/max voor resolutie in te stellen zoals op de volgende pagina wordt beschreven:\nhttp://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS-transactie: succesvol ${response}",commitFailed:"WFS-transactie: mislukt ${response}",googleWarning:"De Google-Layer kon niet correct geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct ingevoegd is.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen.",getLayerWarning:"De laag ${layerType} kon niet goed geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct is ingevoegd.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen.",scale:"Schaal = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"Z",layerAlreadyAdded:"U hebt geprobeerd om de laag  ${layerName} aan de kaart toe te voegen, maar deze is al toegevoegd",reprojectDeprecated:"U gebruikt de optie 'reproject' op de laag ${layerName}.\nDeze optie is vervallen: deze optie was ontwikkeld om gegevens over commercile basiskaarten weer te geven, maar deze functionaliteit wordt nu bereikt door ondersteuning van Spherical Mercator.\nMeer informatie is beschikbaar op http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Deze methode is verouderd en wordt verwijderd in versie 3.0.\nGebruik ${newMethod}.",boundsAddError:"U moet zowel de x- als de y-waarde doorgeven aan de toevoegfunctie.",lonlatAddError:"U moet zowel de lengte- als de breedtewaarde doorgeven aan de toevoegfunctie.",pixelAddError:"U moet zowel de x- als de y-waarde doorgeven aan de toevoegfunctie.",unsupportedGeometryType:"Dit geometrietype wordt niet ondersteund: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition is mislukt: het element met id ${elemId} is wellicht onjuist geplaatst.",filterEvaluateNotImplemented:"evalueren is niet gemplementeerd voor dit filtertype."});
OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,last:null,start:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(a,d,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);},down:function(a){},move:function(a){},up:function(a){},out:function(a){},mousedown:function(b){var a=true;this.dragging=false;if(this.checkModifiers(b)&&OpenLayers.Event.isLeftClick(b)){this.started=true;this.start=b.xy;this.last=b.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(b);this.callback("down",[b.xy]);OpenLayers.Event.stop(b);if(!this.oldOnselectstart){this.oldOnselectstart=(document.onselectstart)?document.onselectstart:OpenLayers.Function.True;}document.onselectstart=OpenLayers.Function.False;a=!this.stopDown;}else{this.started=false;this.start=null;this.last=null;}return a;},mousemove:function(a){if(this.started&&!this.timeoutId&&(a.xy.x!=this.last.x||a.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(a.element===document){this.adjustXY(a);this.setEvent(a);}else{this.destroyDocumentEvents();}}if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval);}this.dragging=true;this.move(a);this.callback("move",[a.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=OpenLayers.Function.False;}this.last=this.evt.xy;}return true;},removeTimeout:function(){this.timeoutId=null;},mouseup:function(b){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(b);this.destroyDocumentEvents();}var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(b);this.callback("up",[b.xy]);if(a){this.callback("done",[b.xy]);}document.onselectstart=this.oldOnselectstart;}return true;},mouseout:function(b){if(this.started&&OpenLayers.Util.mouseLeft(b,this.map.div)){if(this.documentDrag===true){this.documentEvents=new OpenLayers.Events(this,document,null,null,{includeXY:true});this.documentEvents.on({mousemove:this.mousemove,mouseup:this.mouseup});OpenLayers.Element.addClass(document.body,"olDragDown");}else{var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(b);this.callback("out",[]);if(a){this.callback("done",[b.xy]);}if(document.onselectstart){document.onselectstart=this.oldOnselectstart;}}}return true;},click:function(a){return(this.start==this.last);},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;a=true;}return a;},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.dragging=false;this.start=null;this.last=null;a=true;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");}return a;},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.div);a.xy.x-=b[0];a.xy.y-=b[1];},destroyDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents.destroy();this.documentEvents=null;},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxCharacteristics:null,initialize:function(a,d,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);var d={down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox};this.dragHandler=new OpenLayers.Handler.Drag(this,d,{keyMask:this.keyMask});},destroy:function(){if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null;}OpenLayers.Handler.prototype.destroy.apply(this,arguments);},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(a);}},startBox:function(a){this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.dragHandler.start);this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox");},moveBox:function(b){var g=this.dragHandler.start.x;var e=this.dragHandler.start.y;var f=Math.abs(g-b.x);var d=Math.abs(e-b.y);this.zoomBox.style.width=Math.max(1,f)+"px";this.zoomBox.style.height=Math.max(1,d)+"px";this.zoomBox.style.left=b.x<g?b.x+"px":g+"px";this.zoomBox.style.top=b.y<e?b.y+"px":e+"px";var a=this.getBoxCharacteristics();if(a.newBoxModel){if(b.x>g){this.zoomBox.style.width=Math.max(1,f-a.xOffset)+"px";}if(b.y>e){this.zoomBox.style.height=Math.max(1,d-a.yOffset)+"px";}}},endBox:function(d){var b;if(Math.abs(this.dragHandler.start.x-d.x)>5||Math.abs(this.dragHandler.start.y-d.y)>5){var a=this.dragHandler.start;var h=Math.min(a.y,d.y);var e=Math.max(a.y,d.y);var g=Math.min(a.x,d.x);var f=Math.max(a.x,d.x);b=new OpenLayers.Bounds(g,e,f,h);}else{b=this.dragHandler.start.clone();}this.removeBox();this.callback("done",[b]);},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxCharacteristics=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox");},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true;}else{return false;}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate();return true;}else{return false;}},getBoxCharacteristics:function(){if(!this.boxCharacteristics){var b=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"))+1;var a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"))+1;var d=OpenLayers.Util.getBrowserName()=="msie"?document.compatMode!="BackCompat":true;this.boxCharacteristics={xOffset:b,yOffset:a,newBoxModel:d};}return this.boxCharacteristics;},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,alwaysZoom:false,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask});},zoomBox:function(d){if(d instanceof OpenLayers.Bounds){var l;if(!this.out){var e=this.map.getLonLatFromPixel(new OpenLayers.Pixel(d.left,d.bottom));var r=this.map.getLonLatFromPixel(new OpenLayers.Pixel(d.right,d.top));l=new OpenLayers.Bounds(e.lon,e.lat,r.lon,r.lat);}else{var b=Math.abs(d.right-d.left);var h=Math.abs(d.top-d.bottom);var s=Math.min((this.map.size.h/h),(this.map.size.w/b));var f=this.map.getExtent();var g=this.map.getLonLatFromPixel(d.getCenterPixel());var o=g.lon-(f.getWidth()/2)*s;var a=g.lon+(f.getWidth()/2)*s;var m=g.lat-(f.getHeight()/2)*s;var q=g.lat+(f.getHeight()/2)*s;l=new OpenLayers.Bounds(o,m,a,q);}var j=this.map.getZoom();this.map.zoomToExtent(l);if(j==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(j+(this.out?-1:1));}}else{if(!this.out){this.map.setCenter(this.map.getLonLatFromPixel(d),this.map.getZoom()+1);}else{this.map.setCenter(this.map.getLonLatFromPixel(d),this.map.getZoom()-1);}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:25,documentDrag:false,draw:function(){this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone},{interval:this.interval,documentDrag:this.documentDrag});},panMap:function(a){this.panned=true;this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:this.handler.dragging,animate:false});},panMapDone:function(a){if(this.panned){this.panMap(a);this.panned=false;}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false,timerId:null,down:null,rightclickTimerId:null,initialize:function(a,d,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);
if(this.pixelTolerance!=null){this.mousedown=function(e){this.down=e.xy;return true;};}},mousedown:null,mouseup:function(b){var a=true;if(this.checkModifiers(b)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(b)){a=this.rightclick(b);}return a;},rightclick:function(d){if(this.passesTolerance(d)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[d]);return !this.stopDouble;}else{var b=this["double"]?OpenLayers.Util.extend({},d):this.callback("rightclick",[d]);var a=OpenLayers.Function.bind(this.delayedRightCall,this,b);this.rightclickTimerId=window.setTimeout(a,this.delay);}}return !this.stopSingle;},delayedRightCall:function(a){this.rightclickTimerId=null;if(a){this.callback("rightclick",[a]);}return !this.stopSingle;},dblclick:function(a){if(this.passesTolerance(a)){if(this["double"]){this.callback("dblclick",[a]);}this.clearTimer();}return !this.stopDouble;},click:function(b){if(this.passesTolerance(b)){if(this.timerId!=null){this.clearTimer();}else{var a=this.single?OpenLayers.Util.extend({},b):null;this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay);}}return !this.stopSingle;},passesTolerance:function(d){var a=true;if(this.pixelTolerance!=null&&this.down){var b=Math.sqrt(Math.pow(this.down.x-d.xy.x,2)+Math.pow(this.down.y-d.xy.y,2));if(b>this.pixelTolerance){a=false;}}return a;},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null;}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null;}},delayedCall:function(a){this.timerId=null;if(a){this.callback("click",[a]);}},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;a=true;}return a;},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,documentDrag:false,zoomBox:null,zoomBoxEnabled:true,zoomWheelEnabled:true,mouseWheelOptions:null,handleRightClicks:false,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:true,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy();}this.dragPan=null;if(this.zoomBox){this.zoomBox.destroy();}this.zoomBox=null;OpenLayers.Control.prototype.destroy.apply(this,arguments);},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate();}this.handlers.click.activate();if(this.zoomBoxEnabled){this.zoomBox.activate();}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False;}var a={dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};var b={"double":true,stopDouble:true};this.handlers.click=new OpenLayers.Handler.Click(this,a,b);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions);},defaultDblClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1);},defaultDblRightClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom-1);},wheelChange:function(b,g){var a=this.map.getZoom();var l=this.map.getZoom()+Math.round(g);l=Math.max(l,0);l=Math.min(l,this.map.getNumZoomLevels());if(l===a){return;}var e=this.map.getSize();var j=e.w/2-b.xy.x;var h=b.xy.y-e.h/2;var m=this.map.baseLayer.getResolutionForZoom(l);var d=this.map.getLonLatFromPixel(b.xy);var f=new OpenLayers.LonLat(d.lon+j*m,d.lat+h*m);this.map.setCenter(f,l);},wheelUp:function(a,b){this.wheelChange(a,b||1);},wheelDown:function(a,b){this.wheelChange(a,b||-1);},disableZoomBox:function(){this.zoomBoxEnabled=false;this.zoomBox.deactivate();},enableZoomBox:function(){this.zoomBoxEnabled=true;if(this.active){this.zoomBox.activate();}},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate();},enableZoomWheel:function(){this.zoomWheelEnabled=true;if(this.active){this.handlers.wheel.activate();}},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(b,a,d,f){var e=arguments;e=[b,f];OpenLayers.Layer.prototype.initialize.apply(this,e);this.url=a;this.params=OpenLayers.Util.extend({},d);},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments);},clone:function(a){if(a==null){a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions());}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a;},setUrl:function(a){this.url=a;},mergeNewParams:function(b){this.params=OpenLayers.Util.extend(this.params,b);var a=this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"params"});}return a;},redraw:function(a){if(a){return this.mergeNewParams({_olSalt:Math.random()});}else{return OpenLayers.Layer.prototype.redraw.apply(this,[]);}},selectUrl:function(d,b){var a=1;for(var f=0,e=d.length;f<e;f++){a*=d.charCodeAt(f)*this.URL_HASH_FACTOR;a-=Math.floor(a);}return b[Math.floor(a*b.length)];},getFullRequestString:function(a,f){var d=f||this.url;var h=OpenLayers.Util.extend({},this.params);h=OpenLayers.Util.extend(h,a);var g=OpenLayers.Util.getParameterString(h);if(d instanceof Array){d=this.selectUrl(g,d);}var b=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(d));for(var e in h){if(e.toUpperCase() in b){delete h[e];}}g=OpenLayers.Util.getParameterString(h);return OpenLayers.Util.urlAppend(d,g);},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,grid:null,singleTile:false,ratio:1.5,buffer:2,numLoadingTiles:0,initialize:function(a,e,b,d){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.events.addEventType("tileloaded");this.grid=[];},destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments);},clearGrid:function(){if(this.grid){for(var b=0,e=this.grid.length;b<e;b++){var a=this.grid[b];for(var f=0,d=a.length;f<d;f++){var g=a[f];this.removeTileMonitoringHooks(g);g.destroy();}}this.grid=[];}},clone:function(a){if(a==null){a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions());}a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone();}a.grid=[];return a;},moveTo:function(b,e,d){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);b=b||this.map.getExtent();if(b!=null){var a=!this.grid.length||e;var f=this.getTilesBounds();if(this.singleTile){if(a||(!d&&!f.containsBounds(b))){this.initSingleTile(b);}}else{if(a||!f.containsBounds(b,true)){this.initGriddedTiles(b);}else{this.moveGriddedTiles(b);}}}},setTileSize:function(a){if(this.singleTile){a=this.map.getSize();a.h=parseInt(a.h*this.ratio);a.w=parseInt(a.w*this.ratio);}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a]);},getGridBounds:function(){var a="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";OpenLayers.Console.warn(a);return this.getTilesBounds();},getTilesBounds:function(){var d=null;
if(this.grid.length){var e=this.grid.length-1;var b=this.grid[e][0];var f=this.grid[0].length-1;var a=this.grid[0][f];d=new OpenLayers.Bounds(b.bounds.left,b.bounds.bottom,a.bounds.right,a.bounds.top);}return d;},initSingleTile:function(g){var a=g.getCenterLonLat();var j=g.getWidth()*this.ratio;var b=g.getHeight()*this.ratio;var h=new OpenLayers.Bounds(a.lon-(j/2),a.lat-(b/2),a.lon+(j/2),a.lat+(b/2));var e=new OpenLayers.LonLat(h.left,h.top);var d=this.map.getLayerPxFromLonLat(e);if(!this.grid.length){this.grid[0]=[];}var f=this.grid[0][0];if(!f){f=this.addTile(h,d);this.addTileMonitoringHooks(f);f.draw();this.grid[0][0]=f;}else{f.moveTo(h,d);}this.removeExcessTiles(1,1);},calculateGridLayout:function(h,g,s){var l=s*this.tileSize.w;var m=s*this.tileSize.h;var d=h.left-g.left;var o=Math.floor(d/l)-this.buffer;var f=d/l-o;var t=-f*this.tileSize.w;var r=g.left+o*l;var j=h.top-(g.bottom+m);var b=Math.ceil(j/m)+this.buffer;var e=b-j/m;var q=-e*this.tileSize.h;var a=g.bottom+b*m;return{tilelon:l,tilelat:m,tileoffsetlon:r,tileoffsetlat:a,tileoffsetx:t,tileoffsety:q};},initGriddedTiles:function(a){var F=this.map.getSize();var j=Math.ceil(F.h/this.tileSize.h)+Math.max(1,2*this.buffer);var q=Math.ceil(F.w/this.tileSize.w)+Math.max(1,2*this.buffer);var m=this.getMaxExtent();var u=this.map.getResolution();var s=this.calculateGridLayout(a,m,u);var E=Math.round(s.tileoffsetx);var B=Math.round(s.tileoffsety);var d=s.tileoffsetlon;var l=s.tileoffsetlat;var D=s.tilelon;var b=s.tilelat;this.origin=new OpenLayers.Pixel(E,B);var g=E;var o=d;var e=0;var w=parseInt(this.map.layerContainerDiv.style.left);var v=parseInt(this.map.layerContainerDiv.style.top);do{var G=this.grid[e++];if(!G){G=[];this.grid.push(G);}d=o;E=g;var C=0;do{var z=new OpenLayers.Bounds(d,l,d+D,l+b);var h=E;h-=w;var f=B;f-=v;var r=new OpenLayers.Pixel(h,f);var t=G[C++];if(!t){t=this.addTile(z,r);this.addTileMonitoringHooks(t);G.push(t);}else{t.moveTo(z,r,false);}d+=D;E+=this.tileSize.w;}while((d<=a.right+D*this.buffer)||C<q);l-=b;B+=this.tileSize.h;}while((l>=a.bottom-b*this.buffer)||e<j);this.removeExcessTiles(e,C);this.spiralTileLoad();},getMaxExtent:function(){return this.maxExtent;},spiralTileLoad:function(){var d=[];var m=["right","down","left","up"];var l=0;var a=-1;var b=OpenLayers.Util.indexOf(m,"right");var e=0;while(e<m.length){var o=l;var f=a;switch(m[b]){case"right":f++;break;case"down":o++;break;case"left":f--;break;case"up":o--;break;}var j=null;if((o<this.grid.length)&&(o>=0)&&(f<this.grid[0].length)&&(f>=0)){j=this.grid[o][f];}if((j!=null)&&(!j.queued)){d.unshift(j);j.queued=true;e=0;l=o;a=f;}else{b=(b+1)%4;e++;}}for(var g=0,h=d.length;g<h;g++){var j=d[g];j.draw();j.queued=false;}},addTile:function(b,a){},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart");}this.numLoadingTiles++;};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend");}};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd);},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this});},moveGriddedTiles:function(a){var e=this.buffer||1;while(true){var d=this.grid[0][0].position;var b=this.map.getViewPortPxFromLayerPx(d);if(b.x>-this.tileSize.w*(e-1)){this.shiftColumn(true);}else{if(b.x<-this.tileSize.w*e){this.shiftColumn(false);}else{if(b.y>-this.tileSize.h*(e-1)){this.shiftRow(true);}else{if(b.y<-this.tileSize.h*e){this.shiftRow(false);}else{break;}}}}}},shiftRow:function(r){var m=(r)?0:(this.grid.length-1);var l=this.grid;var b=l[m];var a=this.map.getResolution();var e=(r)?-this.tileSize.h:this.tileSize.h;var d=a*-e;var o=(r)?l.pop():l.shift();for(var f=0,j=b.length;f<j;f++){var q=b[f];var h=q.bounds.clone();var g=q.position.clone();h.bottom=h.bottom+d;h.top=h.top+d;g.y=g.y+e;o[f].moveTo(h,g);}if(r){l.unshift(o);}else{l.push(o);}},shiftColumn:function(b){var d=(b)?-this.tileSize.w:this.tileSize.w;var a=this.map.getResolution();var m=a*d;for(var e=0,g=this.grid.length;e<g;e++){var q=this.grid[e];var j=(b)?0:(q.length-1);var o=q[j];var l=o.bounds.clone();var f=o.position.clone();l.left=l.left+m;l.right=l.right+m;f.x=f.x+d;var h=b?this.grid[e].pop():this.grid[e].shift();h.moveTo(l,f);if(b){q.unshift(h);}else{q.push(h);}}},removeExcessTiles:function(a,f){while(this.grid.length>a){var b=this.grid.pop();for(var e=0,d=b.length;e<d;e++){var g=b[e];this.removeTileMonitoringHooks(g);g.destroy();}}while(this.grid[0].length>f){for(var e=0,d=this.grid.length;e<d;e++){var b=this.grid[e];var g=b.pop();this.removeTileMonitoringHooks(g);g.destroy();}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize();}},getTileBounds:function(e){var d=this.maxExtent;var g=this.getResolution();var f=g*this.tileSize.w;var b=g*this.tileSize.h;var j=this.getLonLatFromViewPortPx(e);var a=d.left+(f*Math.floor((j.lon-d.left)/f));var h=d.bottom+(b*Math.floor((j.lat-d.bottom)/b));return new OpenLayers.Bounds(a,h,a+f,h+b);},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",exceptions:"application/vnd.ogc.se_inimage",format:"image/jpeg"},reproject:false,isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{"EPSG:4326":true},initialize:function(b,a,d,f){var e=[];d=OpenLayers.Util.upperCaseObject(d);if(parseFloat(d.VERSION)>=1.3&&!d.EXCEPTIONS){d.EXCEPTIONS="INIMAGE";}e.push(b,a,d,f);OpenLayers.Layer.Grid.prototype.initialize.apply(this,e);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((f==null)||(!f.isBaseLayer)){this.isBaseLayer=false;}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png";}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions());}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a;},reverseAxisOrder:function(){return(parseFloat(this.params.VERSION)>=1.3&&!!this.yx[this.map.getProjectionObject().getCode()]);},getURL:function(a){a=this.adjustBounds(a);var b=this.getImageSize();var d={};var f=this.reverseAxisOrder();d.BBOX=this.encodeBBOX?a.toBBOX(null,f):a.toArray(f);d.WIDTH=b.w;d.HEIGHT=b.h;var e=this.getFullRequestString(d);return e;},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize);},mergeNewParams:function(a){var d=OpenLayers.Util.upperCaseObject(a);var b=[d];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,b);},getFullRequestString:function(b,e){var d=this.map.getProjection();var a=(d=="none")?null:d;if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=a;}else{this.params.SRS=a;}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments);},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,sphericalMercator:false,zoomOffset:0,initialize:function(b,a,e){if(e&&e.sphericalMercator||this.sphericalMercator){e=OpenLayers.Util.extend({maxExtent:new OpenLayers.Bounds(-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339),maxResolution:156543.0339,numZoomLevels:19,units:"m",projection:"EPSG:900913"},e);}a=a||this.url;b=b||this.name;var d=[b,a,{},e];OpenLayers.Layer.Grid.prototype.initialize.apply(this,d);},clone:function(a){if(a==null){a=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions());}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a;},getURL:function(f){var d=this.map.getResolution();var a=Math.round((f.left-this.maxExtent.left)/(d*this.tileSize.w));
var j=Math.round((this.maxExtent.top-f.top)/(d*this.tileSize.h));var h=this.map.getZoom()+this.zoomOffset;var b=this.url;var e=""+a+j+h;if(b instanceof Array){b=this.selectUrl(e,b);}var g=OpenLayers.String.format(b,{x:a,y:j,z:h});return g;},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize);},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom);}},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:true,url:"http://tile.openstreetmap.org/${z}/${x}/${y}.png",clone:function(a){if(a==null){a=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions());}a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a]);return a;},CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,isGecko:null,supportUse:null,initialize:function(a){if(!this.supported()){return;}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.supportUse=(navigator.userAgent.toLowerCase().indexOf("applewebkit/5")==-1);this.isGecko=(navigator.userAgent.toLowerCase().indexOf("gecko/")!=-1);this.symbolMetrics={};},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments);},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1")));},inValidRange:function(e,d,f){var b=e+(f?0:this.translationParameters.x);var a=d+(f?0:this.translationParameters.y);return(b>=-this.MAX_PIXEL&&b<=this.MAX_PIXEL&&a>=-this.MAX_PIXEL&&a<=this.MAX_PIXEL);},setExtent:function(d,f){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var b=this.getResolution();var h=-d.left/b;var g=d.top/b;if(f){this.left=h;this.top=g;var e="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",e);this.translate(0,0);return true;}else{var a=this.translate(h-this.left,g-this.top);if(!a){this.setExtent(d,true);}return a;}},translate:function(b,a){if(!this.inValidRange(b,a,true)){return false;}else{var d="";if(b||a){d="translate("+b+","+a+")";}this.root.setAttributeNS(null,"transform",d);this.translationParameters={x:b,y:a};return true;}},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h);},getNodeType:function(a,d){var b=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":if(d.externalGraphic){b="image";}else{if(this.isComplexSymbol(d.graphicName)){b=this.supportUse===false?"svg":"use";}else{b="circle";}}break;case"OpenLayers.Geometry.Rectangle":b="rect";break;case"OpenLayers.Geometry.LineString":b="polyline";break;case"OpenLayers.Geometry.LinearRing":b="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":b="path";break;default:break;}return b;},setStyle:function(v,B,b){B=B||v._style;b=b||v._options;var m=parseFloat(v.getAttributeNS(null,"r"));var l=1;var e;if(v._geometryClass=="OpenLayers.Geometry.Point"&&m){v.style.visibility="";if(B.graphic===false){v.style.visibility="hidden";}else{if(B.externalGraphic){e=this.getPosition(v);if(B.graphicTitle){v.setAttributeNS(null,"title",B.graphicTitle);}if(B.graphicWidth&&B.graphicHeight){v.setAttributeNS(null,"preserveAspectRatio","none");}var u=B.graphicWidth||B.graphicHeight;var q=B.graphicHeight||B.graphicWidth;u=u?u:B.pointRadius*2;q=q?q:B.pointRadius*2;var s=(B.graphicXOffset!=undefined)?B.graphicXOffset:-(0.5*u);var g=(B.graphicYOffset!=undefined)?B.graphicYOffset:-(0.5*q);var a=B.graphicOpacity||B.fillOpacity;v.setAttributeNS(null,"x",(e.x+s).toFixed());v.setAttributeNS(null,"y",(e.y+g).toFixed());v.setAttributeNS(null,"width",u);v.setAttributeNS(null,"height",q);v.setAttributeNS(this.xlinkns,"href",B.externalGraphic);v.setAttributeNS(null,"style","opacity: "+a);}else{if(this.isComplexSymbol(B.graphicName)){var d=B.pointRadius*3;var o=d*2;var t=this.importSymbol(B.graphicName);e=this.getPosition(v);l=this.symbolMetrics[t][0]*3/o;var h=v.parentNode;var j=v.nextSibling;if(h){h.removeChild(v);}if(this.supportUse===false){var f=document.getElementById(t);v.firstChild&&v.removeChild(v.firstChild);v.appendChild(f.firstChild.cloneNode(true));v.setAttributeNS(null,"viewBox",f.getAttributeNS(null,"viewBox"));}else{v.setAttributeNS(this.xlinkns,"href","#"+t);}v.setAttributeNS(null,"width",o);v.setAttributeNS(null,"height",o);v.setAttributeNS(null,"x",e.x-d);v.setAttributeNS(null,"y",e.y-d);if(j){h.insertBefore(v,j);}else{if(h){h.appendChild(v);}}}else{v.setAttributeNS(null,"r",B.pointRadius);}}}var z=B.rotation;if((z!==undefined||v._rotation!==undefined)&&e){v._rotation=z;z|=0;if(v.nodeName!=="svg"){v.setAttributeNS(null,"transform","rotate("+z+" "+e.x+" "+e.y+")");}else{var w=this.symbolMetrics[t];v.firstChild.setAttributeNS(null,"transform","rotate("+B.rotation+" "+w[1]+" "+w[2]+")");}}}if(b.isFilled){v.setAttributeNS(null,"fill",B.fillColor);v.setAttributeNS(null,"fill-opacity",B.fillOpacity);}else{v.setAttributeNS(null,"fill","none");}if(b.isStroked){v.setAttributeNS(null,"stroke",B.strokeColor);v.setAttributeNS(null,"stroke-opacity",B.strokeOpacity);v.setAttributeNS(null,"stroke-width",B.strokeWidth*l);v.setAttributeNS(null,"stroke-linecap",B.strokeLinecap||"round");v.setAttributeNS(null,"stroke-linejoin","round");B.strokeDashstyle&&v.setAttributeNS(null,"stroke-dasharray",this.dashStyle(B,l));}else{v.setAttributeNS(null,"stroke","none");}if(B.pointerEvents){v.setAttributeNS(null,"pointer-events",B.pointerEvents);}if(B.cursor!=null){v.setAttributeNS(null,"cursor",B.cursor);}return v;},dashStyle:function(a,e){var d=a.strokeWidth*e;var b=a.strokeDashstyle;switch(b){case"solid":return"none";case"dot":return[1,4*d].join();case"dash":return[4*d,4*d].join();case"dashdot":return[4*d,4*d,1,4*d].join();case"longdash":return[8*d,4*d].join();case"longdashdot":return[8*d,4*d,1,4*d].join();default:return OpenLayers.String.trim(b).replace(/\s+/g,",");}},createNode:function(b,a){var d=document.createElementNS(this.xmlns,b);if(a){d.setAttributeNS(null,"id",a);}return d;},nodeTypeCompare:function(b,a){return(a==b.nodeName);},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg");},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g");},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a;},drawPoint:function(a,b){return this.drawCircle(a,b,1);},drawCircle:function(g,a,e){var f=this.getResolution();var d=(a.x/f+this.left);var b=(this.top-a.y/f);if(this.inValidRange(d,b)){g.setAttributeNS(null,"cx",d);g.setAttributeNS(null,"cy",b);g.setAttributeNS(null,"r",e);return g;}else{return false;}},drawLineString:function(d,a){var b=this.getComponentsString(a.components);if(b.path){d.setAttributeNS(null,"points",b.path);return(b.complete?d:null);}else{return false;}},drawLinearRing:function(d,a){var b=this.getComponentsString(a.components);if(b.path){d.setAttributeNS(null,"points",b.path);return(b.complete?d:null);}else{return false;}},drawPolygon:function(h,b){var a="";var e=true;var g=true;var l,f;for(var m=0,o=b.components.length;m<o;m++){a+=" M";l=this.getComponentsString(b.components[m].components," ");f=l.path;if(f){a+=" "+f;g=l.complete&&g;}else{e=false;}}a+=" z";if(e){h.setAttributeNS(null,"d",a);h.setAttributeNS(null,"fill-rule","evenodd");
return g?h:null;}else{return false;}},drawRectangle:function(a,b){var f=this.getResolution();var e=(b.x/f+this.left);var d=(this.top-b.y/f);if(this.inValidRange(e,d)){a.setAttributeNS(null,"x",e);a.setAttributeNS(null,"y",d);a.setAttributeNS(null,"width",b.width/f);a.setAttributeNS(null,"height",b.height/f);return a;}else{return false;}},drawSurface:function(g,a){var j=null;var h=true;for(var f=0,b=a.components.length;f<b;f++){if((f%3)==0&&(f/3)==0){var e=this.getShortString(a.components[f]);if(!e){h=false;}j="M "+e;}else{if((f%3)==1){var e=this.getShortString(a.components[f]);if(!e){h=false;}j+=" C "+e;}else{var e=this.getShortString(a.components[f]);if(!e){h=false;}j+=" "+e;}}}j+=" Z";if(h){g.setAttributeNS(null,"d",j);return g;}else{return false;}},drawText:function(h,f,e){var g=this.getResolution();var d=(e.x/g+this.left);var l=(e.y/g-this.top);var b=this.nodeFactory(h+this.LABEL_ID_SUFFIX,"text");var a=this.nodeFactory(h+this.LABEL_ID_SUFFIX+"_tspan","tspan");b.setAttributeNS(null,"x",d);b.setAttributeNS(null,"y",-l);if(f.fontColor){b.setAttributeNS(null,"fill",f.fontColor);}if(f.fontOpacity){b.setAttributeNS(null,"opacity",f.fontOpacity);}if(f.fontFamily){b.setAttributeNS(null,"font-family",f.fontFamily);}if(f.fontSize){b.setAttributeNS(null,"font-size",f.fontSize);}if(f.fontWeight){b.setAttributeNS(null,"font-weight",f.fontWeight);}if(f.labelSelect===true){b.setAttributeNS(null,"pointer-events","visible");b._featureId=h;a._featureId=h;a._geometry=e;a._geometryClass=e.CLASS_NAME;}else{b.setAttributeNS(null,"pointer-events","none");}var j=f.labelAlign||"cm";b.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[j[0]]||"middle");if(this.isGecko){b.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[j[1]]||"central");}else{a.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[j[1]]||"-35%");}a.textContent=f.label;if(!b.parentNode){b.appendChild(a);this.textRoot.appendChild(b);}},getComponentsString:function(j,h){var a=[];var f=true;var l=j.length;var e=[];var b,d;for(var g=0;g<l;g++){d=j[g];a.push(d);b=this.getShortString(d);if(b){e.push(b);}else{if(g>0){if(this.getShortString(j[g-1])){e.push(this.clipLine(j[g],j[g-1]));}}if(g<l-1){if(this.getShortString(j[g+1])){e.push(this.clipLine(j[g],j[g+1]));}}f=false;}}return{path:e.join(h||","),complete:f};},clipLine:function(j,a){if(a.equals(j)){return"";}var l=this.getResolution();var f=this.MAX_PIXEL-this.translationParameters.x;var d=this.MAX_PIXEL-this.translationParameters.y;var h=a.x/l+this.left;var e=this.top-a.y/l;var g=j.x/l+this.left;var b=this.top-j.y/l;var m;if(g<-f||g>f){m=(b-e)/(g-h);g=g<0?-f:f;b=e+(g-h)*m;}if(b<-d||b>d){m=(g-h)/(b-e);b=b<0?-d:d;g=h+(b-e)*m;}return g+","+b;},getShortString:function(e){var a=this.getResolution();var d=(e.x/a+this.left);var b=(this.top-e.y/a);if(this.inValidRange(d,b)){return d+","+b;}else{return false;}},getPosition:function(a){return({x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))});},importSymbol:function(a){if(!this.defs){this.defs=this.createDefs();}var l=this.container.id+"-"+a;if(document.getElementById(l)!=null){return l;}var r=OpenLayers.Renderer.symbol[a];if(!r){throw new Error(a+" is not a valid symbol name");}var d=this.nodeFactory(l,"symbol");var m=this.nodeFactory(null,"polygon");d.appendChild(m);var o=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var h=[];var f,e;for(var b=0;b<r.length;b=b+2){f=r[b];e=r[b+1];o.left=Math.min(o.left,f);o.bottom=Math.min(o.bottom,e);o.right=Math.max(o.right,f);o.top=Math.max(o.top,e);h.push(f,",",e);}m.setAttributeNS(null,"points",h.join(" "));var g=o.getWidth();var j=o.getHeight();var q=[o.left-g,o.bottom-j,g*3,j*3];d.setAttributeNS(null,"viewBox",q.join(" "));this.symbolMetrics[l]=[Math.max(g,j),o.getCenterLonLat().lon,o.getCenterLonLat().lat];this.defs.appendChild(d);return d.id;},getFeatureIdFromEvent:function(b){var a=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(this.supportUse===false&&!a){var d=b.target;a=d.parentNode&&d!=this.rendererRoot&&d.parentNode._featureId;}return a;},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,format:"image/png",serverResolutions:null,initialize:function(a,e,b,d){this.layername=b;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,e,{},d]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=(this.extension=="jpg")?"jpeg":this.extension;},clone:function(a){if(a==null){a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions());}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a;},getURL:function(d){var j=this.map.getResolution();var l=this.maxExtent;var e=this.tileSize;var a=Math.round((d.left-l.left)/(j*e.w));var b=Math.round((d.bottom-l.bottom)/(j*e.h));var m=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,j):this.map.getZoom();function h(r,q){r=String(r);var s=[];for(var t=0;t<q;++t){s.push("0");}return s.join("").substring(0,q-r.length)+r;}var g=[this.layername,h(m,2),h(parseInt(a/1000000),3),h((parseInt(a/1000)%1000),3),h((parseInt(a)%1000),3),h(parseInt(b/1000000),3),h((parseInt(b/1000)%1000),3),h((parseInt(b)%1000),3)+"."+this.extension];var o=g.join("/");var f=this.url;if(f instanceof Array){f=this.selectUrl(o,f);}f=(f.charAt(f.length-1)=="/")?f:f+"/";return f+o;},addTile:function(a,b){var d=this.getURL(a);return new OpenLayers.Tile.Image(this,b,a,d,this.tileSize);},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:false,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var a=this.topInUnits.length;this.div.appendChild(this.eTop);if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden";}else{this.eTop.style.visibility="visible";}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden";}else{this.eBottom.style.visibility="visible";}}this.map.events.register("moveend",this,this.update);this.update();return this.div;},getBarLen:function(f){var b=parseInt(Math.log(f)/Math.log(10));var e=Math.pow(10,b);var a=parseInt(f/e);var d;if(a>5){d=5;}else{if(a>2){d=2;}else{d=1;}}return d*e;},update:function(){var e=this.map.getResolution();if(!e){return;}var g=this.map.getUnits();var s=OpenLayers.INCHES_PER_UNIT;var o=this.maxWidth*e*s[g];var f=1;if(this.geodesic===true){var l=(this.map.getGeodesicPixelSize().w||0.000001)*this.maxWidth;var t=o/s.km;f=l/t;o*=f;}var h;var r;if(o>100000){h=this.topOutUnits;r=this.bottomOutUnits;}else{h=this.topInUnits;r=this.bottomInUnits;}var b=o/s[h];var j=o/s[r];var d=this.getBarLen(b);var a=this.getBarLen(j);b=d/s[g]*s[h];j=a/s[g]*s[r];var m=b/e/f;var q=j/e/f;if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(q)+"px";this.eBottom.innerHTML=a+" "+r;}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(m)+"px";this.eTop.innerHTML=d+" "+h;}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a]);
},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(d,b){var a={};this.readChildNodes(d,a);b.outer=a.components[0];},innerBoundaryIs:function(d,b){var a={};this.readChildNodes(d,a);b.inner.push(a.components[0]);},Box:function(b,f){var d={};this.readChildNodes(b,d);if(!f.components){f.components=[];}var a=d.points[0];var e=d.points[1];f.components.push(new OpenLayers.Bounds(a.x,a.y,e.x,e.y));}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var d;if(a instanceof Array){d="wfs:FeatureCollection";}else{d="gml:featureMember";}var b=this.writeNode(d,a);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b]);},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[b],a);return a;},coordinates:function(b){var a=b.length;var d=new Array(a);var e;for(var f=0;f<a;++f){e=b[f];if(this.xy){d[f]=e.x+","+e.y;}else{d[f]=e.y+","+e.x;}if(e.z!=undefined){d[f]+=","+e.z;}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:(a==1)?d[0]:d.join(" ")});},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",b.components,a);return a;},Polygon:function(a){var d=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",a.components[0],d);for(var b=1;b<a.components.length;++b){this.writeNode("innerBoundaryIs",a.components[b],d);}return d;},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",a,b);return b;},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",a,b);return b;},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",a.components,b);return b;},Box:function(b){var a=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:b.left,y:b.bottom},{x:b.right,y:b.top}],a);if(this.srsName){a.setAttribute("srsName",this.srsName);}return a;}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a]);},read:function(json,filter){try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var object=eval("("+json+")");if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i]);}}}return filter(k,v);}object=walk("",object);}if(this.keepData){this.data=object;}return object;}}catch(e){}return null;},write:function(d,a){this.pretty=!!a;var e=null;var f=typeof d;if(this.serialize[f]){try{e=this.serialize[f].apply(this,[d]);}catch(b){OpenLayers.Console.error("Trouble serializing: "+b);}}return e;},writeIndent:function(){var b=[];if(this.pretty){for(var a=0;a<this.level;++a){b.push(this.indent);}}return b.join("");},writeNewline:function(){return(this.pretty)?this.newline:"";},writeSpace:function(){return(this.pretty)?this.space:"";},serialize:{object:function(f){if(f==null){return"null";}if(f.constructor==Date){return this.serialize.date.apply(this,[f]);}if(f.constructor==Array){return this.serialize.array.apply(this,[f]);}var b=["{"];this.level+=1;var g,e,a;var d=false;for(g in f){if(f.hasOwnProperty(g)){e=OpenLayers.Format.JSON.prototype.write.apply(this,[g,this.pretty]);a=OpenLayers.Format.JSON.prototype.write.apply(this,[f[g],this.pretty]);if(e!=null&&a!=null){if(d){b.push(",");}b.push(this.writeNewline(),this.writeIndent(),e,":",this.writeSpace(),a);d=true;}}}this.level-=1;b.push(this.writeNewline(),this.writeIndent(),"}");return b.join("");},array:function(d){var a;var b=["["];this.level+=1;for(var f=0,e=d.length;f<e;++f){a=OpenLayers.Format.JSON.prototype.write.apply(this,[d[f],this.pretty]);if(a!=null){if(f>0){b.push(",");}b.push(this.writeNewline(),this.writeIndent(),a);}}this.level-=1;b.push(this.writeNewline(),this.writeIndent(),"]");return b.join("");},string:function(b){var a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(b)){return'"'+b.replace(/([\x00-\x1f\\"])/g,function(d,f){var e=a[f];if(e){return e;}e=f.charCodeAt();return"\\u00"+Math.floor(e/16).toString(16)+(e%16).toString(16);})+'"';}return'"'+b+'"';},number:function(a){return isFinite(a)?String(a):"null";},"boolean":function(a){return String(a);},date:function(a){function b(d){return(d<10)?"0"+d:d;}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"';}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(a){var b={};this.readers.ogc.Filter.apply(this,[a,b]);return b.filter;},readers:{ogc:{Filter:function(d,b){var a={fids:[],filters:[]};this.readChildNodes(d,a);if(a.fids.length>0){b.filter=new OpenLayers.Filter.FeatureId({fids:a.fids});}else{if(a.filters.length>0){b.filter=a.filters[0];}}},FeatureId:function(b,d){var a=b.getAttribute("fid");if(a){d.fids.push(a);}},And:function(d,a){var b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(d,b);a.filters.push(b);},Or:function(d,a){var b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(d,b);a.filters.push(b);},Not:function(d,a){var b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(d,b);a.filters.push(b);},PropertyIsLessThan:function(d,a){var b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(d,b);a.filters.push(b);},PropertyIsGreaterThan:function(d,a){var b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(d,b);a.filters.push(b);},PropertyIsLessThanOrEqualTo:function(d,a){var b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(d,b);a.filters.push(b);},PropertyIsGreaterThanOrEqualTo:function(d,a){var b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(d,b);a.filters.push(b);},PropertyIsBetween:function(d,a){var b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(d,b);a.filters.push(b);},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a));},PropertyName:function(b,a){a.property=this.getChildValue(b);},LowerBoundary:function(b,a){a.lowerBoundary=OpenLayers.String.numericIf(this.readOgcExpression(b));},UpperBoundary:function(b,a){a.upperBoundary=OpenLayers.String.numericIf(this.readOgcExpression(b));},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS);},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN);},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS);},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN);},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a));b.distanceUnits=a.getAttribute("units");}}},readSpatial:function(a,b,e){var d=new OpenLayers.Filter.Spatial({type:e});
this.readChildNodes(a,d);d.value=d.components[0];delete d.components;b.filters.push(d);},readOgcExpression:function(b){var a={};this.readChildNodes(b,a);var d=a.value;if(d===undefined){d=this.getChildValue(b);}return d;},write:function(a){return this.writers.ogc.Filter.apply(this,[a]);},writers:{ogc:{Filter:function(a){var b=this.createElementNSPlus("ogc:Filter");var e=a.CLASS_NAME.split(".").pop();if(e=="FeatureId"){for(var d=0;d<a.fids.length;++d){this.writeNode("FeatureId",a.fids[d],b);}}else{this.writeNode(this.getFilterType(a),a,b);}return b;},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}});},And:function(a){var b=this.createElementNSPlus("ogc:And");var e;for(var d=0;d<a.filters.length;++d){e=a.filters[d];this.writeNode(this.getFilterType(e),e,b);}return b;},Or:function(a){var b=this.createElementNSPlus("ogc:Or");var e;for(var d=0;d<a.filters.length;++d){e=a.filters[d];this.writeNode(this.getFilterType(e),e,b);}return b;},Not:function(d){var a=this.createElementNSPlus("ogc:Not");var b=d.filters[0];this.writeNode(this.getFilterType(b),b,a);return a;},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",a,b);this.writeNode("LowerBoundary",a,b);this.writeNode("UpperBoundary",a,b);return b;},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property});},Literal:function(a){return this.createElementNSPlus("ogc:Literal",{value:a});},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");this.writeNode("Literal",a.lowerBoundary,b);return b;},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",a.upperBoundary,b);return b;},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects");},WITHIN:function(a){return this.writeSpatial(a,"Within");},CONTAINS:function(a){return this.writeSpatial(a,"Contains");},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");this.writeNode("Distance",a,b);return b;},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance});}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b){throw"Filter writing not supported for rule type: "+a.type;}return b;},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a]);},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(d,a){var b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(d,b);a.filters.push(b);},PropertyIsNotEqualTo:function(d,a){var b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(d,b);a.filters.push(b);},PropertyIsLike:function(g,a){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(g,f);var b=g.getAttribute("wildCard");var e=g.getAttribute("singleChar");var d=g.getAttribute("escape");f.value2regex(b,e,d);a.filters.push(f);}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b;},BBOX:function(b){var a=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",b,a);var d=this.writeNode("gml:Box",b.value,a);if(b.projection){d.setAttribute("srsName",b.projection);}return a;}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,d){var a=this.createElementNSPlus("ogc:"+d);this.writeNode("PropertyName",e,a);var b;if(e.value instanceof OpenLayers.Geometry){b=this.writeNode("feature:_geometry",e.value).firstChild;}else{b=this.writeNode("gml:Box",e.value);}if(e.projection){b.setAttribute("srsName",e.projection);}a.appendChild(b);return a;},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a]);},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,b){var a=e.getAttribute("matchCase");var d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(a==="false"||a==="0")});this.readChildNodes(e,d);b.filters.push(d);},PropertyIsNotEqualTo:function(e,b){var a=e.getAttribute("matchCase");var d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(a==="false"||a==="0")});this.readChildNodes(e,d);b.filters.push(d);},PropertyIsLike:function(g,a){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(g,f);var b=g.getAttribute("wildCard");var e=g.getAttribute("singleChar");var d=g.getAttribute("escapeChar");f.value2regex(b,e,d);a.filters.push(f);}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b;},BBOX:function(b){var a=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",b,a);var d=this.writeNode("gml:Envelope",b.value);if(b.projection){d.setAttribute("srsName",b.projection);}a.appendChild(d);
return a;}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,d){var a=this.createElementNSPlus("ogc:"+d);this.writeNode("PropertyName",e,a);var b;if(e.value instanceof OpenLayers.Geometry){b=this.writeNode("feature:_geometry",e.value).firstChild;}else{b=this.writeNode("gml:Envelope",e.value);}if(e.projection){b.setAttribute("srsName",e.projection);}a.appendChild(b);return a;},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",ows:"http://www.opengis.net/ows"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a]);}if(a&&a.nodeType==9){a=a.documentElement;}var b={};this.readNode(a,b);return b;},readers:{csw:{GetRecordsResponse:function(d,a){a.records=[];this.readChildNodes(d,a);var b=this.getAttributeNS(d,"","version");if(b!=""){a.version=b;}},RequestId:function(a,b){b.RequestId=this.getChildValue(a);},SearchStatus:function(b,a){a.SearchStatus={};var d=this.getAttributeNS(b,"","timestamp");if(d!=""){a.SearchStatus.timestamp=d;}},SearchResults:function(g,a){this.readChildNodes(g,a);var e=g.attributes;var b={};for(var f=0,d=e.length;f<d;++f){if((e[f].name=="numberOfRecordsMatched")||(e[f].name=="numberOfRecordsReturned")||(e[f].name=="nextRecord")){b[e[f].name]=parseInt(e[f].nodeValue);}else{b[e[f].name]=e[f].nodeValue;}}a.SearchResults=b;},SummaryRecord:function(d,a){var b={type:"SummaryRecord"};this.readChildNodes(d,b);a.records.push(b);},BriefRecord:function(d,a){var b={type:"BriefRecord"};this.readChildNodes(d,b);a.records.push(b);},DCMIRecord:function(d,a){var b={type:"DCMIRecord"};this.readChildNodes(d,b);a.records.push(b);},Record:function(d,a){var b={type:"Record"};this.readChildNodes(d,b);a.records.push(b);}},dc:{"*":function(h,a){var f=h.localName||h.nodeName.split(":").pop();if(!(a[f] instanceof Array)){a[f]=new Array();}var e={};var d=h.attributes;for(var g=0,b=d.length;g<b;++g){e[d[g].name]=d[g].nodeValue;}e.value=this.getChildValue(h);a[f].push(e);}},dct:{"*":function(d,a){var b=d.localName||d.nodeName.split(":").pop();if(!(a[b] instanceof Array)){a[b]=new Array();}a[b].push(this.getChildValue(d));}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(a,b){if(b.bounds){b.BoundingBox=[{crs:b.projection,value:[b.bounds.left,b.bounds.bottom,b.bounds.right,b.bounds.top]}];delete b.projection;delete b.bounds;}OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments);}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(a){var b=this.writeNode("csw:GetRecords",a);return OpenLayers.Format.XML.prototype.write.apply(this,[b]);},writers:{csw:{GetRecords:function(f){if(!f){f={};}var d=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:f.requestId||this.requestId,resultType:f.resultType||this.resultType,outputFormat:f.outputFormat||this.outputFormat,outputSchema:f.outputSchema||this.outputSchema,startPosition:f.startPosition||this.startPosition,maxRecords:f.maxRecords||this.maxRecords}});if(f.DistributedSearch||this.DistributedSearch){this.writeNode("csw:DistributedSearch",f.DistributedSearch||this.DistributedSearch,d);}var b=f.ResponseHandler||this.ResponseHandler;if(b instanceof Array&&b.length>0){for(var a=0,e=b.length;a<e;a++){this.writeNode("csw:ResponseHandler",b[a],d);}}this.writeNode("Query",f.Query||this.Query,d);return d;},DistributedSearch:function(a){var b=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:a.hopCount}});return b;},ResponseHandler:function(a){var b=this.createElementNSPlus("csw:ResponseHandler",{value:a.value});return b;},Query:function(f){if(!f){f={};}var d=this.createElementNSPlus("csw:Query",{attributes:{typeNames:f.typeNames||"csw:Record"}});var b=f.ElementName;if(b instanceof Array&&b.length>0){for(var a=0,e=b.length;a<e;a++){this.writeNode("csw:ElementName",b[a],d);}}else{this.writeNode("csw:ElementSetName",f.ElementSetName||{value:"summary"},d);}if(f.Constraint){this.writeNode("csw:Constraint",f.Constraint,d);}return d;},ElementName:function(a){var b=this.createElementNSPlus("csw:ElementName",{value:a.value});return b;},ElementSetName:function(a){var b=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:a.typeNames},value:a.value});return b;},Constraint:function(d){var e=this.createElementNSPlus("csw:Constraint",{attributes:{version:d.version}});if(d.Filter){var a=new OpenLayers.Format.Filter({version:d.version});e.appendChild(a.write(d.Filter));}else{if(d.CqlText){var b=this.createElementNSPlus("CqlText",{value:d.CqlText.value});e.appendChild(b);}}return e;}}},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.1",version:null,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a;},read:function(d){if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d]);}var a=d.documentElement;var f=this.version||a.getAttribute("version")||this.defaultVersion;if(!this.parser||this.parser.version!==f){var b=OpenLayers.Format.WMSCapabilities["v"+f.replace(/\./g,"_")];if(!b){throw"Can't find a WMS capabilities parser for version "+f;}this.parser=new b(this.options);}var e=this.parser.read(d);e.version=f;return e;},CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b]);}if(b&&b.nodeType==9){b=b.documentElement;}var a={};this.readNode(b,a);this.postProcessLayers(a);return a;},postProcessLayers:function(f){if(f.capability){f.capability.layers=[];var d=f.capability.nestedLayers;for(var b=0,e=d.length;b<e;++b){var a=d[b];this.processLayer(f.capability,a);}}},processLayer:function(o,l,a){if(l.formats===undefined){l.formats=o.request.getmap.formats;}if(a){l.styles=l.styles.concat(a.styles);var f=["queryable","cascaded","fixedWidth","fixedHeight","opaque","noSubsets","llbbox","minScale","maxScale","attribution"];var e=["srs","bbox","dimensions","authorityURLs"];var r;for(var d=0;d<f.length;d++){r=f[d];if(r in a){if(l[r]==null){l[r]=a[r];}if(l[r]==null){var h=["cascaded","fixedWidth","fixedHeight"];var q=["queryable","opaque","noSubsets"];if(OpenLayers.Util.indexOf(h,r)!=-1){l[r]=0;}if(OpenLayers.Util.indexOf(q,r)!=-1){l[r]=false;}}}}for(var d=0;d<e.length;d++){r=e[d];l[r]=OpenLayers.Util.extend(l[r],a[r]);}}for(var g=0,m=l.nestedLayers.length;g<m;g++){var b=l.nestedLayers[g];this.processLayer(o,b,l);}if(l.name){o.layers.push(l);}},readers:{wms:{Service:function(a,b){b.service={};this.readChildNodes(a,b.service);},Name:function(a,b){b.name=this.getChildValue(a);},Title:function(a,b){b.title=this.getChildValue(a);},Abstract:function(a,b){b["abstract"]=this.getChildValue(a);},BoundingBox:function(e,a){var b={};
b.bbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))];var d={x:parseFloat(e.getAttribute("resx")),y:parseFloat(e.getAttribute("resy"))};if(!(isNaN(d.x)&&isNaN(d.y))){b.res=d;}return b;},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href");},ContactInformation:function(a,b){b.contactInformation={};this.readChildNodes(a,b.contactInformation);},ContactPersonPrimary:function(a,b){b.personPrimary={};this.readChildNodes(a,b.personPrimary);},ContactPerson:function(a,b){b.person=this.getChildValue(a);},ContactOrganization:function(a,b){b.organization=this.getChildValue(a);},ContactPosition:function(a,b){b.position=this.getChildValue(a);},ContactAddress:function(a,b){b.contactAddress={};this.readChildNodes(a,b.contactAddress);},AddressType:function(a,b){b.type=this.getChildValue(a);},Address:function(a,b){b.address=this.getChildValue(a);},City:function(a,b){b.city=this.getChildValue(a);},StateOrProvince:function(a,b){b.stateOrProvince=this.getChildValue(a);},PostCode:function(a,b){b.postcode=this.getChildValue(a);},Country:function(a,b){b.country=this.getChildValue(a);},ContactVoiceTelephone:function(a,b){b.phone=this.getChildValue(a);},ContactFacsimileTelephone:function(a,b){b.fax=this.getChildValue(a);},ContactElectronicMailAddress:function(a,b){b.email=this.getChildValue(a);},Fees:function(d,a){var b=this.getChildValue(d);if(b&&b.toLowerCase()!="none"){a.fees=b;}},AccessConstraints:function(b,d){var a=this.getChildValue(b);if(a&&a.toLowerCase()!="none"){d.accessConstraints=a;}},Capability:function(a,b){b.capability={nestedLayers:[]};this.readChildNodes(a,b.capability);},Request:function(a,b){b.request={};this.readChildNodes(a,b.request);},GetCapabilities:function(a,b){b.getcapabilities={formats:[]};this.readChildNodes(a,b.getcapabilities);},Format:function(a,b){if(b.formats instanceof Array){b.formats.push(this.getChildValue(a));}else{b.format=this.getChildValue(a);}},DCPType:function(a,b){this.readChildNodes(a,b);},HTTP:function(a,b){this.readChildNodes(a,b);},Get:function(a,b){this.readChildNodes(a,b);},Post:function(a,b){this.readChildNodes(a,b);},GetMap:function(a,b){b.getmap={formats:[]};this.readChildNodes(a,b.getmap);},GetFeatureInfo:function(a,b){b.getfeatureinfo={formats:[]};this.readChildNodes(a,b.getfeatureinfo);},Exception:function(a,b){b.exception={formats:[]};this.readChildNodes(a,b.exception);},Layer:function(d,h){var e=d.getAttributeNode("queryable");var f=(e&&e.specified)?d.getAttribute("queryable"):null;e=d.getAttributeNode("cascaded");var o=(e&&e.specified)?d.getAttribute("cascaded"):null;e=d.getAttributeNode("opaque");var j=(e&&e.specified)?d.getAttribute("opaque"):null;var b=d.getAttribute("noSubsets");var a=d.getAttribute("fixedWidth");var m=d.getAttribute("fixedHeight");var l={nestedLayers:[],styles:[],srs:{},metadataURLs:[],bbox:{},dimensions:{},authorityURLs:{},identifiers:{},keywords:[],queryable:(f&&f!=="")?(f==="1"||f==="true"):null,cascaded:(o!==null)?parseInt(o):null,opaque:j?(j==="1"||j==="true"):null,noSubsets:(b!==null)?(b==="1"||b==="true"):null,fixedWidth:(a!=null)?parseInt(a):null,fixedHeight:(m!=null)?parseInt(m):null};h.nestedLayers.push(l);this.readChildNodes(d,l);if(l.name){var g=l.name.split(":");if(g.length>0){l.prefix=g[0];}}},Attribution:function(a,b){b.attribution={};this.readChildNodes(a,b.attribution);},LogoURL:function(a,b){b.logo={width:a.getAttribute("width"),height:a.getAttribute("height")};this.readChildNodes(a,b.logo);},Style:function(d,a){var b={};a.styles.push(b);this.readChildNodes(d,b);},LegendURL:function(d,a){var b={width:d.getAttribute("width"),height:d.getAttribute("height")};a.legend=b;this.readChildNodes(d,b);},MetadataURL:function(b,d){var a={type:b.getAttribute("type")};d.metadataURLs.push(a);this.readChildNodes(b,a);},DataURL:function(a,b){b.dataURL={};this.readChildNodes(a,b.dataURL);},FeatureListURL:function(a,b){b.featureListURL={};this.readChildNodes(a,b.featureListURL);},AuthorityURL:function(e,b){var d=e.getAttribute("name");var a={};this.readChildNodes(e,a);b.authorityURLs[d]=a.href;},Identifier:function(b,a){var d=b.getAttribute("authority");a.identifiers[d]=this.getChildValue(b);},KeywordList:function(a,b){this.readChildNodes(a,b);},SRS:function(a,b){b.srs[this.getChildValue(a)]=true;}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(a,b){this.readChildNodes(a,b);},Keyword:function(a,b){if(b.keywords){b.keywords.push(this.getChildValue(a));}},DescribeLayer:function(a,b){b.describelayer={formats:[]};this.readChildNodes(a,b.describelayer);},GetLegendGraphic:function(a,b){b.getlegendgraphic={formats:[]};this.readChildNodes(a,b.getlegendgraphic);},GetStyles:function(a,b){b.getstyles={formats:[]};this.readChildNodes(a,b.getstyles);},PutStyles:function(a,b){b.putstyles={formats:[]};this.readChildNodes(a,b.putstyles);},UserDefinedSymbolization:function(b,d){var a={supportSLD:parseInt(b.getAttribute("SupportSLD"))==1,userLayer:parseInt(b.getAttribute("UserLayer"))==1,userStyle:parseInt(b.getAttribute("UserStyle"))==1,remoteWFS:parseInt(b.getAttribute("RemoteWFS"))==1};d.userSymbols=a;},LatLonBoundingBox:function(a,b){b.llbbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))];},BoundingBox:function(b,d){var a=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[b,d]);a.srs=b.getAttribute("SRS");d.bbox[a.srs]=a;},ScaleHint:function(a,b){var g=a.getAttribute("min");var d=a.getAttribute("max");var f=Math.pow(2,0.5);var e=OpenLayers.INCHES_PER_UNIT.m;b.maxScale=parseFloat(((g/f)*e*OpenLayers.DOTS_PER_INCH).toPrecision(13));b.minScale=parseFloat(((d/f)*e*OpenLayers.DOTS_PER_INCH).toPrecision(13));},Dimension:function(e,b){var d=e.getAttribute("name").toLowerCase();var a={name:d,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};b.dimensions[a.name]=a;},Extent:function(b,d){var f=b.getAttribute("name").toLowerCase();if(f in d.dimensions){var a=d.dimensions[f];a.nearestVal=b.getAttribute("nearestValue")==="1";a.multipleVal=b.getAttribute("multipleValues")==="1";a.current=b.getAttribute("current")==="1";a["default"]=b.getAttribute("default")||"";var e=this.getChildValue(b);a.values=e.split(",");}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",initialize:function(a){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[a]);},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){var g=this.getChildValue(a);var e=g.split(/ +/);for(var f=0,d=e.length;f<d;f++){b.srs[e[f]]=true;}}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",initialize:function(a){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[a]);},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){b.srs[this.getChildValue(a)]=true;}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(a,b){this.readChildNodes(a,b);},LayerLimit:function(a,b){b.layerLimit=parseInt(this.getChildValue(a));},MaxWidth:function(a,b){b.maxWidth=parseInt(this.getChildValue(a));},MaxHeight:function(a,b){b.maxHeight=parseInt(this.getChildValue(a));},BoundingBox:function(b,d){var a=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[b,d]);
a.srs=b.getAttribute("CRS");d.bbox[a.srs]=a;},CRS:function(a,b){this.readers.wms.SRS.apply(this,[a,b]);},EX_GeographicBoundingBox:function(a,b){b.llbbox=[];this.readChildNodes(a,b.llbbox);},westBoundLongitude:function(a,b){b[0]=this.getChildValue(a);},eastBoundLongitude:function(a,b){b[2]=this.getChildValue(a);},southBoundLatitude:function(a,b){b[1]=this.getChildValue(a);},northBoundLatitude:function(a,b){b[3]=this.getChildValue(a);},MinScaleDenominator:function(a,b){b.maxScale=parseFloat(this.getChildValue(a)).toPrecision(16);},MaxScaleDenominator:function(a,b){b.minScale=parseFloat(this.getChildValue(a)).toPrecision(16);},Dimension:function(e,b){var d=e.getAttribute("name").toLowerCase();var a={name:d,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:e.getAttribute("nearestValue")==="1",multipleVal:e.getAttribute("multipleValues")==="1","default":e.getAttribute("default")||"",current:e.getAttribute("current")==="1",values:this.getChildValue(e).split(",")};b.dimensions[a.name]=a;},Keyword:function(d,a){var b={value:this.getChildValue(d),vocabulary:d.getAttribute("vocabulary")};if(a.keywords){a.keywords.push(b);}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(a,b){this.readers.wms.UserDefinedSymbolization.apply(this,[a,b]);b.userSymbols.inlineFeature=parseInt(a.getAttribute("InlineFeature"))==1;b.userSymbols.remoteWCS=parseInt(a.getAttribute("RemoteWCS"))==1;},DescribeLayer:function(a,b){this.readers.wms.DescribeLayer.apply(this,[a,b]);},GetLegendGraphic:function(a,b){this.readers.wms.GetLegendGraphic.apply(this,[a,b]);}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:false,initialize:function(b,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.element=OpenLayers.Util.getElement(b);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.element=document.createElement("div");this.div.appendChild(this.element);}this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div;},updateScale:function(){var a;if(this.geodesic===true){var b=this.map.getUnits();if(!b){return;}var d=OpenLayers.INCHES_PER_UNIT;a=(this.map.getGeodesicPixelSize().w||0.000001)*d.km*OpenLayers.DOTS_PER_INCH;}else{a=this.map.getScale();}if(!a){return;}if(a>=9500&&a<=950000){a=Math.round(a/1000)+"K";}else{if(a>=950000){a=Math.round(a/1000000)+"M";}else{a=Math.round(a);}}this.element.innerHTML=OpenLayers.i18n("scale",{scaleDenom:a});},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],multi:false,featureAdded:function(){},handlerOptions:null,initialize:function(e,a,d){this.EVENT_TYPES=OpenLayers.Control.DrawFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[d]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(g,f){this.layer.events.triggerEvent("sketchmodified",{vertex:g,feature:f});},create:function(g,f){this.layer.events.triggerEvent("sketchstarted",{vertex:g,feature:f});}},this.callbacks);this.layer=e;this.handlerOptions=this.handlerOptions||{};if(!("multi" in this.handlerOptions)){this.handlerOptions.multi=this.multi;}var b=this.layer.styleMap&&this.layer.styleMap.styles.temporary;if(b){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":b})});}this.handler=new a(this,this.callbacks,this.handlerOptions);},drawFeature:function(a){var b=new OpenLayers.Feature.Vector(a);var d=this.layer.events.triggerEvent("sketchcomplete",{feature:b});if(d!==false){b.state=OpenLayers.State.INSERT;this.layer.addFeatures([b]);this.featureAdded(b);this.events.triggerEvent("featureadded",{feature:b});}},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={};OpenLayers.Util.extend(this,a);if(this.symbolizers){delete this.symbolizer;}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){for(var a in this.symbolizer){this.symbolizer[a]=null;}this.symbolizer=null;delete this.symbolizers;},evaluate:function(a){var e=this.getContext(a);var d=true;if(this.minScaleDenominator||this.maxScaleDenominator){var b=a.layer.map.getScale();}if(this.minScaleDenominator){d=b>=OpenLayers.Style.createLiteral(this.minScaleDenominator,e);}if(d&&this.maxScaleDenominator){d=b<OpenLayers.Style.createLiteral(this.maxScaleDenominator,e);}if(d&&this.filter){if(this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"){d=this.filter.evaluate(a);}else{d=this.filter.evaluate(e);}}return d;},getContext:function(b){var a=this.context;if(!a){a=b.attributes||b.data;}if(typeof this.context=="function"){a=this.context(b);}return a;},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.symbolizers){var d=this.symbolizers.length;e.symbolizers=new Array(d);for(var g=0;g<d;++g){e.symbolizers[g]=this.symbolizers[g].clone();}}else{e.symbolizer={};var b,a;for(var f in this.symbolizer){b=this.symbolizer[f];a=typeof b;if(a==="object"){e.symbolizer[f]=OpenLayers.Util.extend({},b);}else{if(a==="string"){e.symbolizer[f]=b;}}}}e.filter=this.filter&&this.filter.clone();e.context=this.context&&OpenLayers.Util.extend({},this.context);return new OpenLayers.Rule(e);},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,initialize:function(a,d,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);},mousemove:function(a){if(this.passesTolerance(a.xy)){this.clearTimer();this.callback("move",[a]);this.px=a.xy;a=OpenLayers.Util.extend({},a);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay);}return !this.stopMove;},mouseout:function(a){if(OpenLayers.Util.mouseLeft(a,this.map.div)){this.clearTimer();this.callback("move",[a]);}return true;},passesTolerance:function(d){var a=true;if(this.pixelTolerance&&this.px){var b=Math.sqrt(Math.pow(this.px.x-d.x,2)+Math.pow(this.px.y-d.y,2));if(b<this.pixelTolerance){a=false;}}return a;},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null;}},delayedCall:function(a){this.callback("pause",[a]);},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();a=true;}return a;},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.MouseDefaults=OpenLayers.Class(OpenLayers.Control,{performedDrag:false,wheelObserver:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){if(this.handler){this.handler.destroy();}this.handler=null;this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver);OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver);this.wheelObserver=null;OpenLayers.Control.prototype.destroy.apply(this,arguments);},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});
this.registerWheelEvents();},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver);OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver);},defaultClick:function(b){if(!OpenLayers.Event.isLeftClick(b)){return;}var a=!this.performedDrag;this.performedDrag=false;return a;},defaultDblClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1);OpenLayers.Event.stop(b);return false;},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return;}this.mouseDragStart=a.xy.clone();this.performedDrag=false;if(a.shiftKey){this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);}document.onselectstart=OpenLayers.Function.False;OpenLayers.Event.stop(a);},defaultMouseMove:function(a){this.mousePosition=a.xy.clone();if(this.mouseDragStart!=null){if(this.zoomBox){var g=Math.abs(this.mouseDragStart.x-a.xy.x);var e=Math.abs(this.mouseDragStart.y-a.xy.y);this.zoomBox.style.width=Math.max(1,g)+"px";this.zoomBox.style.height=Math.max(1,e)+"px";if(a.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=a.xy.x+"px";}if(a.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=a.xy.y+"px";}}else{var g=this.mouseDragStart.x-a.xy.x;var e=this.mouseDragStart.y-a.xy.y;var b=this.map.getSize();var d=new OpenLayers.Pixel(b.w/2+g,b.h/2+e);var f=this.map.getLonLatFromViewPortPx(d);this.map.setCenter(f,null,true);this.mouseDragStart=a.xy.clone();this.map.div.style.cursor="move";}this.performedDrag=true;}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return;}if(this.zoomBox){this.zoomBoxEnd(a);}else{if(this.performedDrag){this.map.setCenter(this.map.center);}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor="";},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.div)){if(this.zoomBox){this.removeZoomBox();}this.mouseDragStart=null;}},defaultWheelUp:function(a){if(this.map.getZoom()<=this.map.getNumZoomLevels()){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()+1);}},defaultWheelDown:function(a){if(this.map.getZoom()>0){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()-1);}},zoomBoxEnd:function(b){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-b.xy.x)>5||Math.abs(this.mouseDragStart.y-b.xy.y)>5){var j=this.map.getLonLatFromViewPortPx(this.mouseDragStart);var a=this.map.getLonLatFromViewPortPx(b.xy);var h=Math.max(j.lat,a.lat);var d=Math.min(j.lat,a.lat);var g=Math.min(j.lon,a.lon);var e=Math.max(j.lon,a.lon);var f=new OpenLayers.Bounds(g,d,e,h);this.map.zoomToExtent(f);}else{var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(new OpenLayers.LonLat((a.lon),(a.lat)),this.map.getZoom()+1);}this.removeZoomBox();}},removeZoomBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;},onWheelEvent:function(a){var f=false;var d=OpenLayers.Event.element(a);while(d!=null){if(this.map&&d==this.map.div){f=true;break;}d=d.parentNode;}if(f){var b=0;if(!a){a=window.event;}if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){b=-b;}}else{if(a.detail){b=-a.detail/3;}}if(b){a.xy=this.mousePosition;if(b<0){this.defaultWheelDown(a);}else{this.defaultWheelUp(a);}}OpenLayers.Event.stop(a);}},CLASS_NAME:"OpenLayers.Control.MouseDefaults"});OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments);},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.map.events.register("mousemove",this,this.redraw);this.map.events.register("mouseout",this,this.reset);this.redraw();return true;}else{return false;}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("mousemove",this,this.redraw);this.map.events.unregister("mouseout",this,this.reset);this.element.innerHTML="";return true;}else{return false;}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.left="";this.div.top="";this.element=this.div;}return this.div;},redraw:function(b){var a;if(b==null){this.reset();return;}else{if(this.lastXy==null||Math.abs(b.xy.x-this.lastXy.x)>this.granularity||Math.abs(b.xy.y-this.lastXy.y)>this.granularity){this.lastXy=b.xy;return;}a=this.map.getLonLatFromPixel(b.xy);if(!a){return;}if(this.displayProjection){a.transform(this.map.getProjectionObject(),this.displayProjection);}this.lastXy=b.xy;}var d=this.formatOutput(a);if(d!=this.element.innerHTML){this.element.innerHTML=d;}},reset:function(a){if(this.emptyString!=null){this.element.innerHTML=this.emptyString;}},formatOutput:function(d){var a=parseInt(this.numDigits);var b=this.prefix+d.lon.toFixed(a)+this.separator+d.lat.toFixed(a)+this.suffix;return b;},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:false,irregular:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(a,d,b){if(!(b&&b.layerOptions&&b.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{});}OpenLayers.Handler.prototype.initialize.apply(this,[a,d,b]);this.options=(b)?b:{};},setOptions:function(a){OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a);},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);a=true;}return a;},deactivate:function(){var a=false;if(OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel();}if(this.layer.map!=null){this.layer.destroy(false);if(this.feature){this.feature.destroy();}}this.layer=null;this.feature=null;a=true;}return a;},down:function(a){this.fixedRadius=!!(this.radius);var b=this.map.getLonLatFromPixel(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution();}if(this.persist){this.clear();}this.feature=new OpenLayers.Feature.Vector();this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:true});this.layer.drawFeature(this.feature,this.style);},move:function(e){var h=this.map.getLonLatFromPixel(e.xy);var b=new OpenLayers.Geometry.Point(h.lon,h.lat);if(this.irregular){var a=Math.sqrt(2)*Math.abs(b.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,a);}else{if(this.fixedRadius){this.origin=b;}else{this.calculateAngle(b,e);this.radius=Math.max(this.map.getResolution()/2,b.distanceTo(this.origin));}}this.modifyGeometry();if(this.irregular){var f=b.x-this.origin.x;var d=b.y-this.origin.y;var g;if(d==0){g=f/(this.radius*Math.sqrt(2));}else{g=f/d;}this.feature.geometry.resize(1,this.origin,g);this.feature.geometry.move(f/2,d/2);}this.layer.drawFeature(this.feature,this.style);},up:function(a){this.finalize();
if(this.start==this.last){this.callback("done",[a.xy]);}},out:function(a){this.finalize();},createGeometry:function(){this.angle=Math.PI*((1/this.sides)-(1/2));if(this.snapAngle){this.angle+=this.snapAngle*(Math.PI/180);}this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle);},modifyGeometry:function(){var b,d;var e=this.feature.geometry.components[0];if(e.components.length!=(this.sides+1)){this.createGeometry();e=this.feature.geometry.components[0];}for(var a=0;a<this.sides;++a){d=e.components[a];b=this.angle+(a*2*Math.PI/this.sides);d.x=this.origin.x+(this.radius*Math.cos(b));d.y=this.origin.y+(this.radius*Math.sin(b));d.clearBounds();}},calculateAngle:function(d,e){var b=Math.atan2(d.y-this.origin.y,d.x-this.origin.x);if(this.snapAngle&&(this.snapToggle&&!e[this.snapToggle])){var a=(Math.PI/180)*this.snapAngle;this.angle=Math.round(b/a)*a;}else{this.angle=b;}},cancel:function(){this.callback("cancel",null);this.finalize();},finalize:function(){this.origin=null;this.radius=this.options.radius;},clear:function(){if(this.layer){this.layer.renderer.clear();this.layer.destroyFeatures();}},callback:function(b,a){if(this.callbacks[b]){this.callbacks[b].apply(this.control,[this.feature.geometry.clone()]);}if(!this.persist&&(b=="done"||b=="cancel")){this.clear();}},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(f){if(!this.supported()){return;}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var d=document.createStyleSheet();var a=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];for(var b=0,e=a.length;b<e;b++){d.addRule("olv\\:"+a[b],"behavior: url(#default#VML); position: absolute; display: inline-block;");}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments);},supported:function(){return !!(document.namespaces);},setExtent:function(o,b){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var f=this.getResolution();var d=(o.left/f)|0;var j=(o.top/f-this.size.h)|0;if(b||!this.offset){this.offset={x:d,y:j};d=0;j=0;}else{d=d-this.offset.x;j=j-this.offset.y;}var e=d+" "+j;this.root.coordorigin=e;var m=[this.root,this.vectorRoot,this.textRoot];var l;for(var g=0,h=m.length;g<h;++g){l=m[g];var a=this.size.w+" "+this.size.h;l.coordsize=a;}this.root.style.flip="y";return true;},setSize:function(j){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);var f=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];var e=this.size.w+"px";var a=this.size.h+"px";var d;for(var g=0,b=f.length;g<b;++g){d=f[g];d.style.width=e;d.style.height=a;}},getNodeType:function(a,d){var b=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":if(d.externalGraphic){b="olv:rect";}else{if(this.isComplexSymbol(d.graphicName)){b="olv:shape";}else{b="olv:oval";}}break;case"OpenLayers.Geometry.Rectangle":b="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":b="olv:shape";break;default:break;}return b;},setStyle:function(s,m,h,d){m=m||s._style;h=h||s._options;var o=m.fillColor;if(s._geometryClass==="OpenLayers.Geometry.Point"){if(m.externalGraphic){if(m.graphicTitle){s.title=m.graphicTitle;}var r=m.graphicWidth||m.graphicHeight;var l=m.graphicHeight||m.graphicWidth;r=r?r:m.pointRadius*2;l=l?l:m.pointRadius*2;var u=this.getResolution();var a=(m.graphicXOffset!=undefined)?m.graphicXOffset:-(0.5*r);var t=(m.graphicYOffset!=undefined)?m.graphicYOffset:-(0.5*l);s.style.left=(((d.x/u-this.offset.x)+a)|0)+"px";s.style.top=(((d.y/u-this.offset.y)-(t+l))|0)+"px";s.style.width=r+"px";s.style.height=l+"px";s.style.flip="y";o="none";h.isStroked=false;}else{if(this.isComplexSymbol(m.graphicName)){var j=this.importSymbol(m.graphicName);s.path=j.path;s.coordorigin=j.left+","+j.bottom;var g=j.size;s.coordsize=g+","+g;this.drawCircle(s,d,m.pointRadius);s.style.flip="y";}else{this.drawCircle(s,d,m.pointRadius);}}}if(h.isFilled){s.fillcolor=o;}else{s.filled="false";}var b=s.getElementsByTagName("fill");var f=(b.length==0)?null:b[0];if(!h.isFilled){if(f){s.removeChild(f);}}else{if(!f){f=this.createNode("olv:fill",s.id+"_fill");}f.opacity=m.fillOpacity;if(s._geometryClass==="OpenLayers.Geometry.Point"&&m.externalGraphic){if(m.graphicOpacity){f.opacity=m.graphicOpacity;}f.src=m.externalGraphic;f.type="frame";if(!(m.graphicWidth&&m.graphicHeight)){f.aspect="atmost";}}if(f.parentNode!=s){s.appendChild(f);}}var e=m.rotation;if((e!==undefined||s._rotation!==undefined)){s._rotation=e;if(m.externalGraphic){this.graphicRotate(s,a,t,m);f.opacity=0;}else{if(s._geometryClass==="OpenLayers.Geometry.Point"){s.style.rotation=e||0;}}}var v=s.getElementsByTagName("stroke");var q=(v.length==0)?null:v[0];if(!h.isStroked){s.stroked=false;if(q){q.on=false;}}else{if(!q){q=this.createNode("olv:stroke",s.id+"_stroke");s.appendChild(q);}q.on=true;q.color=m.strokeColor;q.weight=m.strokeWidth+"px";q.opacity=m.strokeOpacity;q.endcap=m.strokeLinecap=="butt"?"flat":(m.strokeLinecap||"round");if(m.strokeDashstyle){q.dashstyle=this.dashStyle(m);}}if(m.cursor!="inherit"&&m.cursor!=null){s.style.cursor=m.cursor;}return s;},graphicRotate:function(s,w,f,v){var v=v||s._style;var t=v.rotation||0;var a,m;if(!(v.graphicWidth&&v.graphicHeight)){var z=new Image();z.onreadystatechange=OpenLayers.Function.bind(function(){if(z.readyState=="complete"||z.readyState=="interactive"){a=z.width/z.height;m=Math.max(v.pointRadius*2,v.graphicWidth||0,v.graphicHeight||0);w=w*a;v.graphicWidth=m*a;v.graphicHeight=m;this.graphicRotate(s,w,f,v);}},this);z.src=v.externalGraphic;return;}else{m=Math.max(v.graphicWidth,v.graphicHeight);a=v.graphicWidth/v.graphicHeight;}var r=Math.round(v.graphicWidth||m*a);var o=Math.round(v.graphicHeight||m);s.style.width=r+"px";s.style.height=o+"px";var q=document.getElementById(s.id+"_image");if(!q){q=this.createNode("olv:imagedata",s.id+"_image");s.appendChild(q);}q.style.width=r+"px";q.style.height=o+"px";q.src=v.externalGraphic;q.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var g=t*Math.PI/180;var j=Math.sin(g);var e=Math.cos(g);var h="progid:DXImageTransform.Microsoft.Matrix(M11="+e+",M12="+(-j)+",M21="+j+",M22="+e+",SizingMethod='auto expand')\n";var b=v.graphicOpacity||v.fillOpacity;if(b&&b!=1){h+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+b+")\n";}s.style.filter=h;var u=new OpenLayers.Geometry.Point(-w,-f);var d=new OpenLayers.Bounds(0,0,r,o).toGeometry();d.rotate(v.rotation,u);var l=d.getBounds();s.style.left=Math.round(parseInt(s.style.left)+l.left)+"px";s.style.top=Math.round(parseInt(s.style.top)-l.bottom)+"px";},postDraw:function(b){b.style.visibility="visible";var a=b._style.fillColor;var d=b._style.strokeColor;if(a=="none"&&b.fillcolor!=a){b.fillcolor=a;}if(d=="none"&&b.strokecolor!=d){b.strokecolor=d;}},setNodeDimension:function(f,d){var b=d.getBounds();if(b){var e=this.getResolution();var a=new OpenLayers.Bounds((b.left/e-this.offset.x)|0,(b.bottom/e-this.offset.y)|0,(b.right/e-this.offset.x)|0,(b.top/e-this.offset.y)|0);f.style.left=a.left+"px";f.style.top=a.top+"px";f.style.width=a.getWidth()+"px";f.style.height=a.getHeight()+"px";f.coordorigin=a.left+" "+a.top;f.coordsize=a.getWidth()+" "+a.getHeight();}},dashStyle:function(b){var a=b.strokeDashstyle;switch(a){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return a;default:var d=a.split(/[ ,]/);if(d.length==2){if(1*d[0]>=2*d[1]){return"longdash";}return(d[0]==1||d[1]==1)?"dot":"dash";}else{if(d.length==4){return(1*d[0]>=2*d[1])?"longdashdot":"dashdot";}}return"solid";}},createNode:function(b,a){var d=document.createElement(b);if(a){d.id=a;
}d.unselectable="on";d.onselectstart=OpenLayers.Function.False;return d;},nodeTypeCompare:function(a,f){var b=f;var e=b.indexOf(":");if(e!=-1){b=b.substr(e+1);}var d=a.nodeName;e=d.indexOf(":");if(e!=-1){d=d.substr(e+1);}return(b==d);},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div");},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group");},drawPoint:function(a,b){return this.drawCircle(a,b,1);},drawCircle:function(b,d,e){if(!isNaN(d.x)&&!isNaN(d.y)){var f=this.getResolution();b.style.left=(((d.x/f-this.offset.x)|0)-e)+"px";b.style.top=(((d.y/f-this.offset.y)|0)-e)+"px";var a=e*2;b.style.width=a+"px";b.style.height=a+"px";return b;}return false;},drawLineString:function(a,b){return this.drawLine(a,b,false);},drawLinearRing:function(a,b){return this.drawLine(a,b,true);},drawLine:function(d,b,l){this.setNodeDimension(d,b);var f=this.getResolution();var a=b.components.length;var h=new Array(a);var m,e,o;for(var j=0;j<a;j++){m=b.components[j];e=(m.x/f-this.offset.x)|0;o=(m.y/f-this.offset.y)|0;h[j]=" "+e+","+o+" l ";}var g=(l)?" x e":" e";d.path="m"+h.join("")+g;return d;},drawPolygon:function(r,o){this.setNodeDimension(r,o);var a=this.getResolution();var e=[];var f,d,b,h,m,g,q,l;for(b=0,h=o.components.length;b<h;b++){f=o.components[b];e.push("m");for(d=0,m=f.components.length;d<m;d++){g=f.components[d];q=(g.x/a-this.offset.x)|0;l=(g.y/a-this.offset.y)|0;e.push(" "+q+","+l);if(d==0){e.push(" l");}}e.push(" x ");}e.push("e");r.path=e.join("");return r;},drawRectangle:function(d,a){var b=this.getResolution();d.style.left=((a.x/b-this.offset.x)|0)+"px";d.style.top=((a.y/b-this.offset.y)|0)+"px";d.style.width=((a.width/b)|0)+"px";d.style.height=((a.height/b)|0)+"px";return d;},drawText:function(j,f,d){var b=this.nodeFactory(j+this.LABEL_ID_SUFFIX,"olv:rect");var a=this.nodeFactory(j+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");var h=this.getResolution();b.style.left=((d.x/h-this.offset.x)|0)+"px";b.style.top=((d.y/h-this.offset.y)|0)+"px";b.style.flip="y";a.innerText=f.label;if(f.fontColor){a.style.color=f.fontColor;}if(f.fontOpacity){a.style.filter="alpha(opacity="+(f.fontOpacity*100)+")";}if(f.fontFamily){a.style.fontFamily=f.fontFamily;}if(f.fontSize){a.style.fontSize=f.fontSize;}if(f.fontWeight){a.style.fontWeight=f.fontWeight;}if(f.labelSelect===true){b._featureId=j;a._featureId=j;a._geometry=d;a._geometryClass=d.CLASS_NAME;}a.style.whiteSpace="nowrap";a.inset="1px,0px,0px,0px";if(!b.parentNode){b.appendChild(a);this.textRoot.appendChild(b);}var l=f.labelAlign||"cm";if(l.length==1){l+="m";}var e=a.clientWidth*(OpenLayers.Renderer.VML.LABEL_SHIFT[l.substr(0,1)]);var g=a.clientHeight*(OpenLayers.Renderer.VML.LABEL_SHIFT[l.substr(1,1)]);b.style.left=parseInt(b.style.left)-e-1+"px";b.style.top=parseInt(b.style.top)+g+"px";},drawSurface:function(f,b){this.setNodeDimension(f,b);var g=this.getResolution();var e=[];var j,d,a;for(var h=0,l=b.components.length;h<l;h++){j=b.components[h];d=(j.x/g-this.offset.x)|0;a=(j.y/g-this.offset.y)|0;if((h%3)==0&&(h/3)==0){e.push("m");}else{if((h%3)==1){e.push(" c");}}e.push(" "+d+","+a);}e.push(" x e");f.path=e.join("");return f;},moveRoot:function(b){var a=this.map.getLayer(b.container.id);if(a instanceof OpenLayers.Layer.Vector.RootContainer){a=this.map.getLayer(this.container.id);}a&&a.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);a&&a.redraw();},importSymbol:function(g){var e=this.container.id+"-"+g;var a=this.symbolCache[e];if(a){return a;}var f=OpenLayers.Renderer.symbol[g];if(!f){throw new Error(g+" is not a valid symbol name");}var b=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var h=["m"];for(var j=0;j<f.length;j=j+2){var m=f[j];var l=f[j+1];b.left=Math.min(b.left,m);b.bottom=Math.min(b.bottom,l);b.right=Math.max(b.right,m);b.top=Math.max(b.top,l);h.push(m);h.push(l);if(j==0){h.push("l");}}h.push("x e");var d=h.join(" ");var o=(b.getWidth()-b.getHeight())/2;if(o>0){b.bottom=b.bottom-o;b.top=b.top+o;}else{b.left=b.left+o;b.right=b.right-o;}a={path:d,size:b.getWidth(),left:b.left,bottom:b.bottom};this.symbolCache[e]=a;return a;},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);},setMap:function(d){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var a=0,e=this.map.controls.length;a<e;a++){var b=this.map.controls[a];if((b!=this)&&(b.CLASS_NAME=="OpenLayers.Control.ArgParser")){if(b.displayProjection!=this.displayProjection){this.displayProjection=b.displayProjection;}break;}}if(a==this.map.controls.length){var f=OpenLayers.Util.getParameters();if(f.layers){this.layers=f.layers;this.map.events.register("addlayer",this,this.configureLayers);this.configureLayers();}if(f.lat&&f.lon){this.center=new OpenLayers.LonLat(parseFloat(f.lon),parseFloat(f.lat));if(f.zoom){this.zoom=parseInt(f.zoom);}this.map.events.register("changebaselayer",this,this.setCenter);this.setCenter();}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject());}this.map.setCenter(this.center,this.zoom);}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var a=0,d=this.layers.length;a<d;a++){var e=this.map.layers[a];var b=this.layers.charAt(a);if(b=="B"){this.map.setBaseLayer(e);}else{if((b=="T")||(b=="F")){e.setVisibility(b=="T");}}}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.LoadingPanel=OpenLayers.Class(OpenLayers.Control,{counter:0,maximized:false,visible:true,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);},setVisible:function(a){this.visible=a;if(a){OpenLayers.Element.show(this.div);}else{OpenLayers.Element.hide(this.div);}},getVisible:function(){return this.visible;},hide:function(){this.setVisible(false);},show:function(){this.setVisible(true);},toggle:function(){this.setVisible(!this.getVisible());},addLayer:function(a){if(a.layer){a.layer.events.register("loadstart",this,this.increaseCounter);a.layer.events.register("loadend",this,this.decreaseCounter);}},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("preaddlayer",this,this.addLayer);for(var d=0;d<this.map.layers.length;d++){var b=this.map.layers[d];b.events.register("loadstart",this,this.increaseCounter);b.events.register("loadend",this,this.decreaseCounter);}},increaseCounter:function(){this.counter++;if(this.counter>0){if(!this.maximized&&this.visible){this.maximizeControl();}}},decreaseCounter:function(){if(this.counter>0){this.counter--;}if(this.counter==0){if(this.maximized&&this.visible){this.minimizeControl();}}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);return this.div;},minimizeControl:function(a){this.div.style.display="none";this.div.style.width="0px";this.div.style.height="0px";this.maximized=false;if(a!=null){OpenLayers.Event.stop(a);}},maximizeControl:function(d){var b=this.map.getSize();var e=b.w;var a=b.h;this.div.style.width=e+"px";this.div.style.height=a+"px";this.div.style.display="block";this.maximized=true;if(d!=null){OpenLayers.Event.stop(d);}},destroy:function(){if(this.map){this.map.events.unregister("preaddlayer",this,this.addLayer);if(this.map.layers){for(var b=0;b<this.map.layers.length;b++){var a=this.map.layers[b];a.events.unregister("loadstart",this,this.increaseCounter);a.events.unregister("loadend",this,this.decreaseCounter);}}}OpenLayers.Control.prototype.destroy.apply(this,arguments);},CLASS_NAME:"OpenLayers.Control.LoadingPanel"});OpenLayers.Control.ScaleBar=OpenLayers.Class(OpenLayers.Control,{element:null,scale:1,displaySystem:"metric",minWidth:100,maxWidth:200,divisions:2,subdivisions:2,showMinorMeasures:false,abbreviateLabel:false,singleLine:false,align:"left",div:null,scaleText:"scale 1:",thousandsSeparator:"",measurementProperties:{english:{units:["miles","feet","inches"],abbr:["mi","ft","in"],inches:[63360,12,1]},metric:{units:["kilometers","meters","centimeters"],abbr:["km","m","cm"],inches:[39370.07874,39.370079,0.393701]}},limitedStyle:false,customStyles:null,defaultStyles:{Bar:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},BarAlt:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMajor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMinor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},NumbersBox:{height:13,width:40,top:24},LabelBox:{height:15,top:-2},LabelBoxSingleLine:{height:15,width:35,top:5,left:10}},appliedStyles:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);
if(!document.styleSheets){this.limitedStyle=true;}if(this.limitedStyle){this.appliedStyles=OpenLayers.Util.extend({},this.defaultStyles);OpenLayers.Util.extend(this.appliedStyles,this.customStyles);}this.element=document.createElement("div");this.element.style.position="relative";this.element.className=this.displayClass+"Wrapper";this.labelContainer=document.createElement("div");this.labelContainer.className=this.displayClass+"Units";this.labelContainer.style.position="absolute";this.graphicsContainer=document.createElement("div");this.graphicsContainer.style.position="absolute";this.graphicsContainer.className=this.displayClass+"Graphics";this.numbersContainer=document.createElement("div");this.numbersContainer.style.position="absolute";this.numbersContainer.className=this.displayClass+"Numbers";this.element.appendChild(this.graphicsContainer);this.element.appendChild(this.labelContainer);this.element.appendChild(this.numbersContainer);},destroy:function(){this.map.events.unregister("moveend",this,this.onMoveend);this.div.innerHTML="";OpenLayers.Control.prototype.destroy.apply(this);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.dxMarkerMajor=(this.styleValue("MarkerMajor","borderLeftWidth")+this.styleValue("MarkerMajor","width")+this.styleValue("MarkerMajor","borderRightWidth"))/2;this.dxMarkerMinor=(this.styleValue("MarkerMinor","borderLeftWidth")+this.styleValue("MarkerMinor","width")+this.styleValue("MarkerMinor","borderRightWidth"))/2;this.dxBar=(this.styleValue("Bar","borderLeftWidth")+this.styleValue("Bar","borderRightWidth"))/2;this.dxBarAlt=(this.styleValue("BarAlt","borderLeftWidth")+this.styleValue("BarAlt","borderRightWidth"))/2;this.dxNumbersBox=this.styleValue("NumbersBox","width")/2;var b=["Bar","BarAlt","MarkerMajor","MarkerMinor"];if(this.singleLine){b.push("LabelBoxSingleLine");}else{b.push("NumbersBox","LabelBox");}var d=0;for(var a=0;a<b.length;++a){var e=b[a];d=Math.max(d,this.styleValue(e,"top")+this.styleValue(e,"height"));}this.element.style.height=d+"px";this.xOffsetSingleLine=this.styleValue("LabelBoxSingleLine","width")+this.styleValue("LabelBoxSingleLine","left");this.div.appendChild(this.element);this.map.events.register("moveend",this,this.onMoveend);this.update();return this.div;},onMoveend:function(){this.update();},update:function(a){if(this.map.baseLayer==null||!this.map.getScale()){return;}this.scale=(a!=undefined)?a:this.map.getScale();this.element.title=this.scaleText+OpenLayers.Number.format(this.scale);this.element.style.width=this.maxWidth+"px";var f=this.getComp();this.setSubProps(f);this.labelContainer.innerHTML="";this.graphicsContainer.innerHTML="";this.numbersContainer.innerHTML="";var q=this.divisions*this.subdivisions;var h={left:0+(this.singleLine?0:this.dxNumbersBox),center:(this.maxWidth/2)-(q*this.subProps.pixels/2)-(this.singleLine?this.xOffsetSingleLine/2:0),right:this.maxWidth-(q*this.subProps.pixels)-(this.singleLine?this.xOffsetSingleLine:this.dxNumbersBox)};var e,g,b,r,o;for(var l=0;l<this.divisions;++l){e=l*this.subdivisions*this.subProps.pixels+h[this.align];this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",e-this.dxMarkerMajor));if(!this.singleLine){g=(l==0)?0:OpenLayers.Number.format((l*this.subdivisions)*this.subProps.length,this.subProps.dec,this.thousandsSeparator);this.numbersContainer.appendChild(this.createElement("NumbersBox",g,e-this.dxNumbersBox));}for(var d=0;d<this.subdivisions;++d){if((d%2)==0){r="Bar";o=e-this.dxBar;}else{r="BarAlt";o=e-this.dxBarAlt;}this.graphicsContainer.appendChild(this.createElement(r," ",o,this.subProps.pixels));if(d<this.subdivisions-1){b=(l*this.subdivisions)+d+1;e=b*this.subProps.pixels+h[this.align];this.graphicsContainer.appendChild(this.createElement("MarkerMinor"," ",e-this.dxMarkerMinor));if(this.showMinorMeasures&&!this.singleLine){g=b*this.subProps.length;this.numbersContainer.appendChild(this.createElement("NumbersBox",g,e-this.dxNumbersBox));}}}}e=q*this.subProps.pixels;e+=h[this.align];this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",e-this.dxMarkerMajor));g=OpenLayers.Number.format(q*this.subProps.length,this.subProps.dec,this.thousandsSeparator);if(!this.singleLine){this.numbersContainer.appendChild(this.createElement("NumbersBox",g,e-this.dxNumbersBox));}var m=document.createElement("div");m.style.position="absolute";var j;if(this.singleLine){j=g;m.className=this.displayClass+"LabelBoxSingleLine";m.style.left=Math.round(e+this.styleValue("LabelBoxSingleLine","left"))+"px";}else{j="";m.className=this.displayClass+"LabelBox";m.style.textAlign="center";m.style.width=Math.round(q*this.subProps.pixels)+"px";m.style.left=Math.round(h[this.align])+"px";m.style.overflow="hidden";}if(this.abbreviateLabel){j+=" "+this.subProps.abbr;}else{j+=" "+this.subProps.units;}m.appendChild(document.createTextNode(j));this.labelContainer.appendChild(m);},createElement:function(e,d,b,a){var f=document.createElement("div");f.className=this.displayClass+e;OpenLayers.Util.extend(f.style,{position:"absolute",textAlign:"center",overflow:"hidden",left:Math.round(b)+"px"});f.appendChild(document.createTextNode(d));if(a){f.style.width=Math.round(a)+"px";}return f;},getComp:function(){var e=this.measurementProperties[this.displaySystem];var o=e.units.length;var t=new Array(o);var s=this.divisions*this.subdivisions;for(var r=0;r<o;++r){t[r]={};var f=OpenLayers.DOTS_PER_INCH*e.inches[r]/this.scale;var u=((this.minWidth-this.dxNumbersBox)/f)/s;var a=((this.maxWidth-this.dxNumbersBox)/f)/s;for(var v=0;v<s;++v){var g=u*(v+1);var d=a*(v+1);var j=this.getHandsomeNumber(g,d);var h={value:(j.value/(v+1)),score:0,tie:0,dec:0,displayed:0};for(var w=0;w<s;++w){var l=j.value*(w+1)/(v+1);var b=this.getHandsomeNumber(l,l);var q=((w+1)%this.subdivisions==0);var m=((w+1)==s);if((this.singleLine&&m)||(!this.singleLine&&(q||this.showMinorMeasures))){h.score+=b.score;h.tie+=b.tie;h.dec=Math.max(h.dec,b.dec);h.displayed+=1;}else{h.score+=b.score/this.subdivisions;h.tie+=b.tie/this.subdivisions;}}h.score*=(r+1)*h.tie/h.displayed;t[r][v]=h;}}return t;},setSubProps:function(b){var f=this.measurementProperties[this.displaySystem];var j=Number.POSITIVE_INFINITY;var g=Number.POSITIVE_INFINITY;for(var e=0;e<b.length;++e){var a=OpenLayers.DOTS_PER_INCH*f.inches[e]/this.scale;for(var h in b[e]){var d=b[e][h];if((d.score<j)||((d.score==j)&&(d.tie<g))){this.subProps={length:d.value,pixels:a*d.value,units:f.units[e],abbr:f.abbr[e],dec:d.dec};j=d.score;g=d.tie;}}}},styleValue:function(f,d){var b=0;if(this.limitedStyle){b=this.appliedStyles[f][d];}else{f="."+this.displayClass+f;rules:for(var j=document.styleSheets.length-1;j>=0;--j){var l=document.styleSheets[j];if(!l.disabled){var e;try{if(typeof(l.cssRules)=="undefined"){if(typeof(l.rules)=="undefined"){continue;}else{e=l.rules;}}else{e=l.cssRules;}}catch(g){continue;}for(var h=0;h<e.length;++h){var a=e[h];if(a.selectorText&&(a.selectorText.toLowerCase()==f.toLowerCase())){if(a.style[d]!=""){b=parseInt(a.style[d]);break rules;}}}}}}return b?b:0;},getHandsomeNumber:function(f,d,r){r=(r==null)?10:r;var h={value:f,score:Number.POSITIVE_INFINITY,tie:Number.POSITIVE_INFINITY,dec:3};var o,l,b,e,q,m,a;for(var j=0;j<3;++j){o=Math.pow(2,(-1*j));l=Math.floor(Math.log(d/o)/Math.LN10);for(var g=l;g>(l-r+1);--g){b=Math.max(j-g,0);e=o*Math.pow(10,g);if((e*Math.floor(d/e))>=f){if(f%e==0){q=f/e;}else{q=Math.floor(f/e)+1;}m=q+(2*j);a=(g<0)?(Math.abs(g)+1):g;if((m<h.score)||((m==h.score)&&(a<h.tie))){h.value=parseFloat((e*q).toFixed(b));h.score=m;h.tie=a;h.dec=b;}}}}return h;},CLASS_NAME:"OpenLayers.Control.ScaleBar"});OpenLayers.Format.CSWGetRecords.v2_0_2_GeoNetwork=OpenLayers.Class(OpenLayers.Format.CSWGetRecords.v2_0_2,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",ows:"http://www.opengis.net/ows",geonet:"http://www.fao.org/geonetwork"},initialize:function(a){OpenLayers.Format.CSWGetRecords.v2_0_2.prototype.initialize.apply(this,[a]);
},readers:{csw:{GetRecordsResponse:function(d,a){a.records=[];this.readChildNodes(d,a);var b=this.getAttributeNS(d,"","version");if(b!=""){a.version=b;}},RequestId:function(a,b){b.RequestId=this.getChildValue(a);},SearchStatus:function(b,a){a.SearchStatus={};var d=this.getAttributeNS(b,"","timestamp");if(d!=""){a.SearchStatus.timestamp=d;}},SearchResults:function(g,a){this.readChildNodes(g,a);var e=g.attributes;var b={};for(var f=0,d=e.length;f<d;++f){if((e[f].name=="numberOfRecordsMatched")||(e[f].name=="numberOfRecordsReturned")||(e[f].name=="nextRecord")){b[e[f].name]=parseInt(e[f].nodeValue);}else{b[e[f].name]=e[f].nodeValue;}}a.SearchResults=b;},SummaryRecord:function(d,a){var b={type:"SummaryRecord"};this.readChildNodes(d,b);a.records.push(b);},BriefRecord:function(d,a){var b={type:"BriefRecord"};this.readChildNodes(d,b);a.records.push(b);},DCMIRecord:function(d,a){var b={type:"DCMIRecord"};this.readChildNodes(d,b);a.records.push(b);},Record:function(d,a){var b={type:"Record"};this.readChildNodes(d,b);a.records.push(b);},"*":function(d,b){var a=d.localName;if(!(b.geonet_info[a] instanceof Array)){b.geonet_info[a]=new Array();}var e=this.getChildValue(d);b.geonet_info[a].push(e);}},dc:{"*":function(h,a){var f=h.localName||h.nodeName.split(":").pop();if(!(a[f] instanceof Array)){a[f]=new Array();}var e={};var d=h.attributes;for(var g=0,b=d.length;g<b;++g){e[d[g].name]=d[g].nodeValue;}e.value=this.getChildValue(h);a[f].push(e);}},dct:{"*":function(d,a){var b=d.localName||d.nodeName.split(":").pop();if(!(a[b] instanceof Array)){a[b]=new Array();}a[b].push(this.getChildValue(d));}},geonet:{info:function(a,b){if(!(b.geonet_info instanceof Array)){b.geonet_info=new Array();}this.readChildNodes(a,b);}},ows:{WGS84BoundingBox:function(h,j){if(!(j.BoundingBox instanceof Array)){j.BoundingBox=new Array();}var g=this.getChildValue(this.getElementsByTagNameNS(h,this.namespaces.ows,"LowerCorner")[0]).split(" ",2);var b=this.getChildValue(this.getElementsByTagNameNS(h,this.namespaces.ows,"UpperCorner")[0]).split(" ",2);var e={value:[parseFloat(g[0]),parseFloat(g[1]),parseFloat(b[0]),parseFloat(b[1])]};var d=h.attributes;for(var f=0,a=d.length;f<a;++f){e[d[f].name]=d[f].nodeValue;}j.BoundingBox.push(e);},BoundingBox:function(a,b){this.readers.ows.WGS84BoundingBox.apply(this,[a,b]);}}},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2_GeoNetwork"});OpenLayers.Format.GeoNetworkRecords=OpenLayers.Class(OpenLayers.Format.XML,{defaultPrefix:"nons",namespaces:{nons:"",geonet:"http://www.fao.org/geonetwork"},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a]);}if(a&&a.nodeType==9){a=a.documentElement;}var b={};this.readNode(a,b);return b;},readers:{nons:{response:function(d,e){e.records=[];this.readChildNodes(d,e);var b=this.getAttributeNS(d,"","from");if(b!=""){e.from=b;}var a=this.getAttributeNS(d,"","to");if(a!=""){e.to=a;}},summary:function(b,d){d.summary={};var f=b.attributes;for(var a=0,e=f.length;a<e;++a){d.summary[f[a].name]=f[a].nodeValue;}this.readChildNodes(b,d.summary);},metadata:function(d,a){var b={type:"metadata"};this.readChildNodes(d,b);a.records.push(b);},geoBox:function(j,m){if(!(m.BoundingBox instanceof Array)){m.BoundingBox=new Array();}var f,d,a,h;if(j.firstChild.nodeValue&&j.firstChild.nodeValue.indexOf("|")){var b=j.firstChild.nodeValue.split("|");d=b[0];f=b[1];a=b[2];h=b[3];}else{for(var g=j.firstChild;g;g=g.nextSibling){switch(g.nodeName){case"southBL":f=this.getChildValue(g);break;case"westBL":d=this.getChildValue(g);break;case"eastBL":a=this.getChildValue(g);break;case"northBL":h=this.getChildValue(g);break;}}}var l={value:[parseFloat(d),parseFloat(f),parseFloat(a),parseFloat(h)]};m.BoundingBox.push(l);},"*":function(f,j){var d=f.localName||f.nodeName.split(":").pop();var h=f.parentNode.localName||f.parentNode.nodeName.split(":").pop();var g={};g.value=this.getChildValue(f);if(h=="info"){if(!(j.geonet_info[d] instanceof Array)){j.geonet_info[d]=new Array();}j.geonet_info[d].push(g);if(d=="harvestInfo"||d=="valid_details"){this.readChildNodes(f,j.geonet_info[d]);}}else{if(!(j[d] instanceof Array)){j[d]=new Array();}var b=f.attributes;for(var e=0,a=b.length;e<a;++e){g[b[e].name]=b[e].nodeValue;}j[d].push(g);this.readChildNodes(f,j[d]);}}},geonet:{info:function(a,b){if(!(b.geonet_info instanceof Array)){b.geonet_info=new Array();}this.readChildNodes(a,b);}}},CLASS_NAME:"OpenLayers.Format.GeoNetworkRecords"});(function(){var a=function(d,b){return function(e){if(b&&b[d]){b[d].call(b.scope||window,{responseText:e.responseText,responseXML:e.responseXML,argument:b.argument});}};};Ext.apply(Ext.lib.Ajax,{request:function(f,b,e,d,g){g=g||{};f=f||g.method;var h=g.headers;if(g.xmlData){if(!h||!h["Content-Type"]){h=h||{};h["Content-Type"]="text/xml";}f=f||"POST";d=g.xmlData;}else{if(g.jsonData){if(!h||!h["Content-Type"]){h=h||{};h["Content-Type"]="application/json";}f=f||"POST";d=typeof g.jsonData=="object"?Ext.encode(g.jsonData):g.jsonData;}}if((f&&f.toLowerCase()=="post")&&(g.form||g.params)&&(!h||!h["Content-Type"])){h=h||{};h["Content-Type"]="application/x-www-form-urlencoded";}return OpenLayers.Request.issue({success:a("success",e),failure:a("failure",e),method:f,headers:h,data:d,url:b});},isCallInProgress:function(b){return true;},abort:function(b){b.abort();}});})();Ext.namespace("GeoExt");GeoExt.singleFile=true;(function(){var j=(typeof GeoExt=="object"&&GeoExt.singleFile);var m=j?"GeoExt.js":"lib/GeoExt.js";var l=function(){var s="";var u=document.documentElement.getElementsByTagName("script");for(var z=0,v=u.length;z<v;z++){var t=u[z].getAttribute("src");if(t){var w=t.lastIndexOf(m);var h=t.lastIndexOf("?");if(h<0){h=t.length;}if((w>-1)&&(w+m.length==h)){s=t.slice(0,h-m.length);break;}}}return s;};if(!j){var o=new Array("GeoExt/data/AttributeReader.js","GeoExt/data/AttributeStore.js","GeoExt/data/FeatureRecord.js","GeoExt/data/FeatureReader.js","GeoExt/data/FeatureStore.js","GeoExt/data/LayerRecord.js","GeoExt/data/LayerReader.js","GeoExt/data/LayerStore.js","GeoExt/data/ScaleStore.js","GeoExt/data/WMSCapabilitiesReader.js","GeoExt/data/WMSCapabilitiesStore.js","GeoExt/data/WFSCapabilitiesReader.js","GeoExt/data/WFSCapabilitiesStore.js","GeoExt/data/WMSDescribeLayerReader.js","GeoExt/data/WMSDescribeLayerStore.js","GeoExt/data/WMCReader.js","GeoExt/widgets/Action.js","GeoExt/data/ProtocolProxy.js","GeoExt/widgets/FeatureRenderer.js","GeoExt/widgets/MapPanel.js","GeoExt/widgets/Popup.js","GeoExt/widgets/form.js","GeoExt/widgets/form/SearchAction.js","GeoExt/widgets/form/BasicForm.js","GeoExt/widgets/form/FormPanel.js","GeoExt/widgets/tips/SliderTip.js","GeoExt/widgets/tips/LayerOpacitySliderTip.js","GeoExt/widgets/tips/ZoomSliderTip.js","GeoExt/widgets/tree/LayerNode.js","GeoExt/widgets/tree/TreeNodeUIEventMixin.js","GeoExt/plugins/TreeNodeComponent.js","GeoExt/plugins/TreeNodeRadioButton.js","GeoExt/widgets/tree/LayerLoader.js","GeoExt/widgets/tree/LayerContainer.js","GeoExt/widgets/tree/BaseLayerContainer.js","GeoExt/widgets/tree/OverlayLayerContainer.js","GeoExt/widgets/tree/LayerParamNode.js","GeoExt/widgets/tree/LayerParamLoader.js","GeoExt/widgets/tree/WMSCapabilitiesLoader.js","GeoExt/widgets/LayerOpacitySlider.js","GeoExt/widgets/LayerLegend.js","GeoExt/widgets/LegendImage.js","GeoExt/widgets/UrlLegend.js","GeoExt/widgets/WMSLegend.js","GeoExt/widgets/VectorLegend.js","GeoExt/widgets/LegendPanel.js","GeoExt/widgets/ZoomSlider.js","GeoExt/widgets/grid/FeatureSelectionModel.js","GeoExt/data/PrintPage.js","GeoExt/data/PrintProvider.js","GeoExt/plugins/PrintPageField.js","GeoExt/plugins/PrintProviderField.js","GeoExt/plugins/PrintExtent.js","GeoExt/plugins/AttributeForm.js","GeoExt/widgets/PrintMapPanel.js","GeoExt/state/PermalinkProvider.js");var a=navigator.userAgent;var d=(a.match("MSIE")||a.match("Safari"));if(d){var q=new Array(o.length);}var r=l()+"lib/";for(var b=0,g=o.length;b<g;b++){if(d){q[b]="<script src='"+r+o[b]+"'><\/script>";
}else{var e=document.createElement("script");e.src=r+o[b];var f=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;f.appendChild(e);}}if(d){document.write(q.join(""));}}})();Ext.namespace("GeoExt.data");GeoExt.data.AttributeReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WFSDescribeFeatureType();}GeoExt.data.AttributeReader.superclass.constructor.call(this,a,b||a.fields);if(a.feature){this.recordType.prototype.fields.add(new Ext.data.Field("value"));}};Ext.extend(GeoExt.data.AttributeReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText;}return this.readRecords(b);},readRecords:function(b){var u;if(b instanceof Array){u=b;}else{u=this.meta.format.read(b).featureTypes[0].properties;}var m=this.meta.feature;var s=this.recordType;var h=s.prototype.fields;var v=h.length;var e,l,o,d,f,g,r=[];for(var a=0,q=u.length;a<q;++a){f=false;e=u[a];l={};for(var t=0;t<v;++t){o=h.items[t].name;g=e[o];if(this.ignoreAttribute(o,g)){f=true;break;}l[o]=g;}if(m){g=m.attributes[l.name];if(g!==undefined){if(this.ignoreAttribute("value",g)){f=true;}else{l.value=g;}}}if(!f){r[r.length]=new s(l);}}return{success:true,records:r,totalRecords:r.length};},ignoreAttribute:function(d,a){var b=false;if(this.meta.ignore&&this.meta.ignore[d]){var e=this.meta.ignore[d];if(typeof e=="string"){b=(e===a);}else{if(e instanceof Array){b=(e.indexOf(a)>-1);}else{if(e instanceof RegExp){b=(e.test(a));}}}}return b;}});Ext.namespace("GeoExt.data");GeoExt.data.AttributeStoreMixin=function(){return{constructor:function(a){a=a||{};arguments.callee.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.AttributeReader(a,a.fields||["name","type","restriction"])}));if(this.feature){this.bind();}},bind:function(){this.on({update:this.onUpdate,load:this.onLoad,add:this.onAdd,scope:this});var a=[];this.each(function(b){a.push(b);});this.updateFeature(a);},onUpdate:function(a,b,d){this.updateFeature([b]);},onLoad:function(d,b,a){if(!a||a.add!==true){this.updateFeature(b);}},onAdd:function(d,b,a){this.updateFeature(b);},updateFeature:function(h){var e=this.feature,m=e.layer;var j,a,l,g,b,d,f;for(j=0,a=h.length;j<a;j++){l=h[j];g=l.get("name");b=l.get("value");d=e.attributes[g];if(d!==b){f=true;}}if(f&&m&&m.events&&m.events.triggerEvent("beforefeaturemodified",{feature:e})!==false){for(j=0,a=h.length;j<a;j++){l=h[j];g=l.get("name");b=l.get("value");e.attributes[g]=b;}m.events.triggerEvent("featuremodified",{feature:e});m.drawFeature(e);}}};};GeoExt.data.AttributeStore=Ext.extend(Ext.data.Store,GeoExt.data.AttributeStoreMixin());Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.FeatureReader=function(a,b){a=a||{};if(!(b instanceof Function)){b=GeoExt.data.FeatureRecord.create(b||a.fields||{});}GeoExt.data.FeatureReader.superclass.constructor.call(this,a,b);};Ext.extend(GeoExt.data.FeatureReader,Ext.data.DataReader,{totalRecords:null,read:function(a){return this.readRecords(a.features);},readRecords:function(t){var u=[];if(t){var b=this.recordType,r=b.prototype.fields;var o,d,h,a,q,m,g,l;for(o=0,d=t.length;o<d;o++){q=t[o];m={};if(q.attributes){for(h=0,a=r.length;h<a;h++){g=r.items[h];if(/[\[\.]/.test(g.mapping)){try{l=new Function("obj","return obj."+g.mapping)(q.attributes);}catch(f){l=g.defaultValue;}}else{l=q.attributes[g.mapping||g.name]||g.defaultValue;}if(g.convert){l=g.convert(l);}m[g.name]=l;}}m.feature=q;m.state=q.state;m.fid=q.fid;var s=(q.state===OpenLayers.State.INSERT)?undefined:q.id;u[u.length]=new b(m,s);}}return{records:u,totalRecords:this.totalRecords!=null?this.totalRecords:u.length};}});Ext.namespace("GeoExt.data");GeoExt.data.FeatureStoreMixin=function(){return{layer:null,reader:null,featureFilter:null,constructor:function(d){d=d||{};d.reader=d.reader||new GeoExt.data.FeatureReader({},d.fields);var a=d.layer;delete d.layer;if(d.features){d.data=d.features;}delete d.features;var b={initDir:d.initDir};delete d.initDir;arguments.callee.superclass.constructor.call(this,d);if(a){this.bind(a,b);}},bind:function(g,e){if(this.layer){return;}this.layer=g;e=e||{};var b=e.initDir;if(e.initDir==undefined){b=GeoExt.data.FeatureStore.LAYER_TO_STORE|GeoExt.data.FeatureStore.STORE_TO_LAYER;}var a=g.features.slice(0);if(b&GeoExt.data.FeatureStore.STORE_TO_LAYER){var d=this.getRange();for(var f=d.length-1;f>=0;f--){this.layer.addFeatures([d[f].getFeature()]);}}if(b&GeoExt.data.FeatureStore.LAYER_TO_STORE){this.loadData(a,true);}g.events.on({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this});},unbind:function(){if(this.layer){this.layer.events.un({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});this.un("load",this.onLoad,this);this.un("clear",this.onClear,this);this.un("add",this.onAdd,this);this.un("remove",this.onRemove,this);this.un("update",this.onUpdate,this);this.layer=null;}},getRecordFromFeature:function(a){var b=null;if(a.state!==OpenLayers.State.INSERT){b=this.getById(a.id);}else{var d=this.findBy(function(e){return e.getFeature()===a;});if(d>-1){b=this.getAt(d);}}return b;},onFeaturesAdded:function(e){if(!this._adding){var b=e.features,a=b;if(this.featureFilter){a=[];var g,d,f;for(var g=0,d=b.length;g<d;g++){f=b[g];if(this.featureFilter.evaluate(f)!==false){a.push(f);}}}this._adding=true;this.loadData(a,true);delete this._adding;}},onFeaturesRemoved:function(f){if(!this._removing){var d=f.features,b,e,a;for(a=d.length-1;a>=0;a--){b=d[a];e=this.getRecordFromFeature(b);if(e!==undefined){this._removing=true;this.remove(e);delete this._removing;}}}},onFeatureModified:function(d){if(!this._updating){var e=d.feature;var h=this.getRecordFromFeature(e);if(h!==undefined){h.beginEdit();var f=e.attributes;if(f){var j=this.recordType.prototype.fields;for(var g=0,l=j.length;g<l;g++){var a=j.items[g];var b=a.mapping||a.name;if(b in f){h.set(a.name,a.convert(f[b]));}}}h.set("state",e.state);h.set("fid",e.fid);h.setFeature(e);this._updating=true;h.endEdit();delete this._updating;}}},addFeaturesToLayer:function(e){var a,d,b;b=new Array((d=e.length));for(a=0;a<d;a++){b[a]=e[a].getFeature();}if(b.length>0){this._adding=true;this.layer.addFeatures(b);delete this._adding;}},onLoad:function(d,b,a){if(!a||a.add!==true){this._removing=true;this.layer.removeFeatures(this.layer.features);delete this._removing;this.addFeaturesToLayer(b);}},onClear:function(a){this._removing=true;this.layer.removeFeatures(this.layer.features);delete this._removing;},onAdd:function(d,b,a){if(!this._adding){this.addFeaturesToLayer(b);}},onRemove:function(e,d,a){if(!this._removing){var b=d.getFeature();if(this.layer.getFeatureById(b.id)!=null){this._removing=true;this.layer.removeFeatures([d.getFeature()]);delete this._removing;}}},onUpdate:function(g,d,f){if(!this._updating){var a=new GeoExt.data.FeatureRecord().fields;var h=d.getFeature();if(d.fields){var b=this.layer.events.triggerEvent("beforefeaturemodified",{feature:h});if(b!==false){var e=h.attributes;d.fields.each(function(l){var j=l.mapping||l.name;if(!a.containsKey(j)){e[j]=d.get(l.name);}});this._updating=true;this.layer.events.triggerEvent("featuremodified",{feature:h});delete this._updating;if(this.layer.getFeatureById(h.id)!=null){this.layer.drawFeature(h);}}}}}};};GeoExt.data.FeatureStore=Ext.extend(Ext.data.Store,new GeoExt.data.FeatureStoreMixin);GeoExt.data.FeatureStore.LAYER_TO_STORE=1;GeoExt.data.FeatureStore.STORE_TO_LAYER=2;Ext.namespace("GeoExt.data");GeoExt.data.LayerRecord=Ext.data.Record.create([{name:"layer"},{name:"title",type:"string",mapping:"name"}]);GeoExt.data.LayerRecord.prototype.getLayer=function(){return this.get("layer");};GeoExt.data.LayerRecord.prototype.setLayer=function(a){if(a!==this.data.layer){this.dirty=true;
if(!this.modified){this.modified={};}if(this.modified.layer===undefined){this.modified.layer=this.data.layer;}this.data.layer=a;if(!this.editing){this.afterEdit();}}};GeoExt.data.LayerRecord.prototype.clone=function(b){var a=this.getLayer()&&this.getLayer().clone();return new this.constructor(Ext.applyIf({layer:a},this.data),b||a.id);};GeoExt.data.LayerRecord.create=function(d){var a=Ext.extend(GeoExt.data.LayerRecord,{});var b=a.prototype;b.fields=new Ext.util.MixedCollection(false,function(f){return f.name;});GeoExt.data.LayerRecord.prototype.fields.each(function(f){b.fields.add(f);});if(d){for(var g=0,e=d.length;g<e;g++){b.fields.add(new Ext.data.Field(d[g]));}}a.getField=function(f){return b.fields.get(f);};return a;};Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.LayerReader=function(a,b){a=a||{};if(!(b instanceof Function)){b=GeoExt.data.LayerRecord.create(b||a.fields||{});}GeoExt.data.LayerReader.superclass.constructor.call(this,a,b);};Ext.extend(GeoExt.data.LayerReader,Ext.data.DataReader,{totalRecords:null,readRecords:function(f){var o=[];if(f){var a=this.recordType,l=a.prototype.fields;var g,b,d,r,h,e,m,q;for(g=0,b=f.length;g<b;g++){h=f[g];e={};for(d=0,r=l.length;d<r;d++){m=l.items[d];q=h[m.mapping||m.name]||m.defaultValue;q=m.convert(q);e[m.name]=q;}e.layer=h;o[o.length]=new a(e,h.id);}}return{records:o,totalRecords:this.totalRecords!=null?this.totalRecords:o.length};}});Ext.namespace("GeoExt.data");GeoExt.data.LayerStoreMixin=function(){return{map:null,reader:null,constructor:function(d){d=d||{};d.reader=d.reader||new GeoExt.data.LayerReader({},d.fields);delete d.fields;var a=d.map instanceof GeoExt.MapPanel?d.map.map:d.map;delete d.map;if(d.layers){d.data=d.layers;}delete d.layers;var b={initDir:d.initDir};delete d.initDir;arguments.callee.superclass.constructor.call(this,d);if(a){this.bind(a,b);}},bind:function(b,d){if(this.map){return;}this.map=b;d=d||{};var e=d.initDir;if(d.initDir==undefined){e=GeoExt.data.LayerStore.MAP_TO_STORE|GeoExt.data.LayerStore.STORE_TO_MAP;}var a=b.layers.slice(0);if(e&GeoExt.data.LayerStore.STORE_TO_MAP){this.each(function(f){this.map.addLayer(f.getLayer());},this);}if(e&GeoExt.data.LayerStore.MAP_TO_STORE){this.loadData(a,true);}b.events.on({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this});this.data.on({replace:this.onReplace,scope:this});},unbind:function(){if(this.map){this.map.events.un({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});this.un("load",this.onLoad,this);this.un("clear",this.onClear,this);this.un("add",this.onAdd,this);this.un("remove",this.onRemove,this);this.data.un("replace",this.onReplace,this);this.map=null;}},onChangeLayer:function(f){var d=f.layer;var a=this.findBy(function(g,h){return g.getLayer()===d;});if(a>-1){var e=this.getAt(a);if(f.property==="order"){if(!this._adding&&!this._removing){var b=this.map.getLayerIndex(d);if(b!==a){this._removing=true;this.remove(e);delete this._removing;this._adding=true;this.insert(b,[e]);delete this._adding;}}}else{if(f.property==="name"){e.set("title",d.name);}else{this.fireEvent("update",this,e,Ext.data.Record.EDIT);}}}},onAddLayer:function(a){if(!this._adding){var b=a.layer;this._adding=true;this.loadData([b],true);delete this._adding;}},onRemoveLayer:function(a){if(this.map.unloadDestroy){if(!this._removing){var b=a.layer;this._removing=true;this.remove(this.getById(b.id));delete this._removing;}}else{this.unbind();}},onLoad:function(e,d,g){if(!Ext.isArray(d)){d=[d];}if(g&&!g.add){this._removing=true;for(var h=this.map.layers.length-1;h>=0;h--){this.map.removeLayer(this.map.layers[h]);}delete this._removing;var b=d.length;if(b>0){var a=new Array(b);for(var f=0;f<b;f++){a[f]=d[f].getLayer();}this._adding=true;this.map.addLayers(a);delete this._adding;}}},onClear:function(a){this._removing=true;for(var b=this.map.layers.length-1;b>=0;b--){this.map.removeLayer(this.map.layers[b]);}delete this._removing;},onAdd:function(f,e,a){if(!this._adding){this._adding=true;var d;for(var b=e.length-1;b>=0;--b){d=e[b].getLayer();this.map.addLayer(d);if(a!==this.map.layers.length-1){this.map.setLayerIndex(d,a);}}delete this._adding;}},onRemove:function(e,d,a){if(!this._removing){var b=d.getLayer();if(this.map.getLayer(b.id)!=null){this._removing=true;this.removeMapLayer(d);delete this._removing;}}},onUpdate:function(a,e,f){if(f===Ext.data.Record.EDIT){if(e.modified&&e.modified.title){var b=e.getLayer();var d=e.get("title");if(d!==b.name){b.setName(d);}}}},removeMapLayer:function(a){this.map.removeLayer(a.getLayer());},onReplace:function(a,b,d){this.removeMapLayer(b);},getByLayer:function(b){var a=this.findBy(function(d){return d.getLayer()===b;});if(a>-1){return this.getAt(a);}},destroy:function(){this.unbind();GeoExt.data.LayerStore.superclass.destroy.call(this);}};};GeoExt.data.LayerStore=Ext.extend(Ext.data.Store,new GeoExt.data.LayerStoreMixin);GeoExt.data.LayerStore.MAP_TO_STORE=1;GeoExt.data.LayerStore.STORE_TO_MAP=2;Ext.namespace("GeoExt.data");GeoExt.data.ScaleStore=Ext.extend(Ext.data.Store,{map:null,constructor:function(a){var b=(a.map instanceof GeoExt.MapPanel?a.map.map:a.map);delete a.map;a=Ext.applyIf(a,{reader:new Ext.data.JsonReader({},["level","resolution","scale"])});GeoExt.data.ScaleStore.superclass.constructor.call(this,a);if(b){this.bind(b);}},bind:function(b,a){this.map=(b instanceof GeoExt.MapPanel?b.map:b);this.map.events.register("changebaselayer",this,this.populateFromMap);if(this.map.baseLayer){this.populateFromMap();}else{this.map.events.register("addlayer",this,this.populateOnAdd);}},unbind:function(){if(this.map){this.map.events.unregister("addlayer",this,this.populateOnAdd);this.map.events.unregister("changebaselayer",this,this.populateFromMap);delete this.map;}},populateOnAdd:function(a){if(a.layer.isBaseLayer){this.populateFromMap();this.map.events.unregister("addlayer",this,this.populateOnAdd);}},populateFromMap:function(){var a=[];var e=this.map.baseLayer.resolutions;var f=this.map.baseLayer.units;for(var d=e.length-1;d>=0;d--){var b=e[d];a.push({level:d,resolution:b,scale:OpenLayers.Util.getScaleFromResolution(b,f)});}this.loadData(a);},destroy:function(){this.unbind();GeoExt.data.ScaleStore.superclass.destroy.apply(this,arguments);}});Ext.namespace("GeoExt.data");GeoExt.data.PrintProvider=Ext.extend(Ext.util.Observable,{url:null,capabilities:null,method:"POST",customParams:null,scales:null,dpis:null,layouts:null,dpi:null,layout:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);if(!this.customParams){this.customParams={};}this.addEvents("loadcapabilities","layoutchange","dpichange","beforeprint","print","printexception","beforeencodelayer","encodelayer");GeoExt.data.PrintProvider.superclass.constructor.apply(this,arguments);this.scales=new Ext.data.JsonStore({root:"scales",sortInfo:{field:"value",direction:"DESC"},fields:["name",{name:"value",type:"float"}]});this.dpis=new Ext.data.JsonStore({root:"dpis",fields:["name",{name:"value",type:"float"}]});this.layouts=new Ext.data.JsonStore({root:"layouts",fields:["name",{name:"size",mapping:"map"},{name:"rotation",type:"boolean"}]});if(a.capabilities){this.loadStores();}else{if(this.url.split("/").pop()){this.url+="/";}this.initialConfig.autoLoad&&this.loadCapabilities();}},setLayout:function(a){this.layout=a;this.fireEvent("layoutchange",this,a);},setDpi:function(a){this.dpi=a;this.fireEvent("dpichange",this,a);},print:function(a,d,b){if(a instanceof GeoExt.MapPanel){a=a.map;}d=d instanceof Array?d:[d];b=b||{};if(this.fireEvent("beforeprint",this,a,d,b)===false){return;}var g=Ext.apply({units:a.getUnits(),srs:a.baseLayer.projection.getCode(),layout:this.layout.get("name"),dpi:this.dpi.get("value")},this.customParams);var q=d[0].feature.layer;var m=[];Ext.each(a.layers,function(s){if(s!==q&&s.getVisibility()===true){var r=this.encodeLayer(s);r&&m.push(r);
}},this);g.layers=m;var f=[];Ext.each(d,function(r){f.push(Ext.apply({center:[r.center.lon,r.center.lat],scale:r.scale.get("value"),rotation:r.rotation},r.customParams));},this);g.pages=f;if(b.overview){var j=[];Ext.each(b.overview.layers,function(s){var r=this.encodeLayer(s);r&&j.push(r);},this);g.overviewLayers=j;}if(b.legend){var h=b.legend;var e=h.rendered;if(!e){h=h.cloneConfig({renderTo:document.body,hidden:true});}var o=[];h.items.each(function(r){if(!r.hidden){var s=this.encoders.legends[r.getXType()];o=o.concat(s.call(this,r));}},this);if(!e){h.destroy();}g.legends=o;}if(this.method==="GET"){var l=Ext.urlAppend(this.capabilities.printURL,"spec="+encodeURIComponent(Ext.encode(g)));window.open(l);this.fireEvent("print",this,l);}else{Ext.Ajax.request({url:this.capabilities.createURL,jsonData:g,success:function(r){var s=Ext.decode(r.responseText).getURL+(Ext.isIE?"?inline=true":"");if(Ext.isOpera||Ext.isIE){window.open(s);}else{window.location.href=s;}this.fireEvent("print",this,s);},failure:function(r){this.fireEvent("printexception",this,r);},params:this.initialConfig.baseParams,scope:this});}},loadCapabilities:function(){if(!this.url){return;}var a=this.url+"info.json";Ext.Ajax.request({url:a,method:"GET",disableCaching:false,success:function(b){this.capabilities=Ext.decode(b.responseText);this.loadStores();},params:this.initialConfig.baseParams,scope:this});},loadStores:function(){this.scales.loadData(this.capabilities);this.dpis.loadData(this.capabilities);this.layouts.loadData(this.capabilities);this.setLayout(this.layouts.getAt(0));this.setDpi(this.dpis.getAt(0));this.fireEvent("loadcapabilities",this,this.capabilities);},encodeLayer:function(b){var d;for(var a in this.encoders.layers){if(OpenLayers.Layer[a]&&b instanceof OpenLayers.Layer[a]){if(this.fireEvent("beforeencodelayer",this,b)===false){return;}d=this.encoders.layers[a].call(this,b);this.fireEvent("encodelayer",this,b,d);break;}}return(d&&d.type)?d:null;},getAbsoluteUrl:function(d){var b;if(Ext.isIE){b=document.createElement("<a href='"+d+"'/>");b.style.display="none";document.body.appendChild(b);b.href=b.href;document.body.removeChild(b);}else{b=document.createElement("a");b.href=d;}return b.href;},encoders:{layers:{WMS:function(e){var d=this.encoders.layers.HTTPRequest.call(this,e);Ext.apply(d,{type:"WMS",layers:[e.params.LAYERS].join(",").split(","),format:e.params.FORMAT,styles:[e.params.STYLES].join(",").split(",")});var b;for(var a in e.params){b=a.toLowerCase();if(!e.DEFAULT_PARAMS[b]&&"layers,styles,width,height,srs".indexOf(b)==-1){if(!d.customParams){d.customParams={};}d.customParams[a]=e.params[a];}}return d;},OSM:function(b){var a=this.encoders.layers.TileCache.call(this,b);return Ext.apply(a,{type:"OSM",baseURL:a.baseURL.substr(0,a.baseURL.indexOf("$")),extension:"png"});},TMS:function(b){var a=this.encoders.layers.TileCache.call(this,b);return Ext.apply(a,{type:"TMS",format:b.type});},TileCache:function(b){var a=this.encoders.layers.HTTPRequest.call(this,b);return Ext.apply(a,{type:"TileCache",layer:b.layername,maxExtent:b.maxExtent.toArray(),tileSize:[b.tileSize.w,b.tileSize.h],extension:b.extension,resolutions:b.serverResolutions||b.resolutions});},KaMapCache:function(b){var a=this.encoders.layers.KaMap.call(this,b);return Ext.apply(a,{type:"KaMapCache",group:b.params.g,metaTileWidth:b.params.metaTileSize.w,metaTileHeight:b.params.metaTileSize.h});},KaMap:function(b){var a=this.encoders.layers.HTTPRequest.call(this,b);return Ext.apply(a,{type:"KaMap",map:b.params.map,extension:b.params.i,group:b.params.g||"",maxExtent:b.maxExtent.toArray(),tileSize:[b.tileSize.w,b.tileSize.h],resolutions:b.serverResolutions||b.resolutions});},HTTPRequest:function(a){return{baseURL:this.getAbsoluteUrl(a.url instanceof Array?a.url[0]:a.url),opacity:(a.opacity!=null)?a.opacity:1,singleTile:a.singleTile};},Image:function(a){return{type:"Image",baseURL:this.getAbsoluteUrl(a.getURL(a.extent)),opacity:(a.opacity!=null)?a.opacity:1,extent:a.extent.toArray(),pixelSize:[a.size.w,a.size.h],name:a.name};},Vector:function(o){if(!o.features.length){return;}var h=[];var e={};var m=o.features;var f=new OpenLayers.Format.GeoJSON();var r=new OpenLayers.Format.JSON();var l=1;var b={};var g,j,a,d,s;for(var u=0,q=m.length;u<q;++u){g=m[u];j=g.style||o.style||o.styleMap.createSymbolizer(g,g.renderIntent);a=r.write(j);d=b[a];if(d){s=d;}else{b[a]=s=l++;if(j.externalGraphic){e[s]=Ext.applyIf({externalGraphic:this.getAbsoluteUrl(j.externalGraphic)},j);}else{e[s]=j;}}var t=f.extract.feature.call(f,g);t.properties=OpenLayers.Util.extend({_gx_style:s},t.properties);h.push(t);}return{type:"Vector",styles:e,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:h},name:o.name,opacity:(o.opacity!=null)?o.opacity:1};}},legends:{gx_wmslegend:function(d){var f=this.encoders.legends.base.call(this,d);var b=[];for(var a=1,e=d.items.getCount();a<e;++a){b.push(this.getAbsoluteUrl(d.items.get(a).url));}f[0].classes[0]={name:"",icons:b};return f;},gx_urllegend:function(b){var a=this.encoders.legends.base.call(this,b);a[0].classes.push({name:"",icon:this.getAbsoluteUrl(b.items.get(1).url)});return a;},base:function(a){return[{name:a.items.get(0).text,classes:[]}];}}}});Ext.namespace("GeoExt.data");GeoExt.data.PrintPage=Ext.extend(Ext.util.Observable,{printProvider:null,feature:null,center:null,scale:null,rotation:0,customParams:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);if(!this.customParams){this.customParams={};}this.addEvents("change");GeoExt.data.PrintPage.superclass.constructor.apply(this,arguments);this.feature=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POLYGON((-1 -1,1 -1,1 1,-1 1,-1 -1))"));if(this.printProvider.capabilities){this.setScale(this.printProvider.scales.getAt(0));}else{this.printProvider.on({loadcapabilities:function(){this.setScale(this.printProvider.scales.getAt(0));},scope:this,single:true});}this.printProvider.on({layoutchange:this.onLayoutChange,scope:this});},getPrintExtent:function(a){a=a instanceof GeoExt.MapPanel?a.map:a;return this.calculatePageBounds(this.scale,a.getUnits());},setScale:function(d,e){var b=this.calculatePageBounds(d,e);var a=b.toGeometry();var f=this.rotation;if(f!=0){a.rotate(-f,a.getCentroid());}this.updateFeature(a,{scale:d});},setCenter:function(e){var b=this.feature.geometry;var d=b.getBounds().getCenterLonLat();var a=e.lon-d.lon;var f=e.lat-d.lat;b.move(a,f);this.updateFeature(b,{center:e});},setRotation:function(d,a){if(a||this.printProvider.layout.get("rotation")===true){var b=this.feature.geometry;b.rotate(this.rotation-d,b.getCentroid());this.updateFeature(b,{rotation:d});}},fit:function(a,e){e=e||{};var f=a,b;if(a instanceof GeoExt.MapPanel){f=a.map;}else{if(a instanceof OpenLayers.Feature.Vector){f=a.layer.map;b=a.geometry.getBounds();}}if(!b){b=f.getExtent();if(!b){return;}}this._updating=true;var d=b.getCenterLonLat();this.setCenter(d);var m=f.getUnits();var h=this.printProvider.scales.getAt(0);var g=Number.POSITIVE_INFINITY;var j=b.getWidth();var l=b.getHeight();this.printProvider.scales.each(function(q){var s=this.calculatePageBounds(q,m);if(e.mode=="closest"){var o=Math.abs(s.getWidth()-j)+Math.abs(s.getHeight()-l);if(o<g){g=o;h=q;}}else{var r=e.mode=="screen"?!b.containsBounds(s):s.containsBounds(b);if(r||(e.mode=="screen"&&!r)){h=q;}return r;}},this);this.setScale(h,m);delete this._updating;this.updateFeature(this.feature.geometry,{center:d,scale:h});},updateFeature:function(d,g){var b=this.feature;var e=b.geometry!==d;d.id=b.geometry.id;b.geometry=d;if(!this._updating){for(var a in g){if(g[a]===this[a]){delete g[a];}else{this[a]=g[a];e=true;}}Ext.apply(this,g);b.layer&&b.layer.drawFeature(b);e&&this.fireEvent("change",this,g);}},calculatePageBounds:function(g,o){var d=g.get("value");var m=this.feature;var q=this.feature.geometry;var b=q.getBounds().getCenterLonLat();var e=this.printProvider.layout.get("size");var o=o||(m.layer&&m.layer.map&&m.layer.map.getUnits())||"dd";var l=OpenLayers.INCHES_PER_UNIT[o];
var a=e.width/72/l*d/2;var j=e.height/72/l*d/2;return new OpenLayers.Bounds(b.lon-a,b.lat-j,b.lon+a,b.lat+j);},onLayoutChange:function(){if(this.printProvider.layout.get("rotation")===false){this.setRotation(0,true);}this.scale&&this.setScale(this.scale);},destroy:function(){this.printProvider.un("layoutchange",this.onLayoutChange,this);}});Ext.namespace("GeoExt.data");GeoExt.data.WMSCapabilitiesReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WMSCapabilities();}if(typeof b!=="function"){b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"queryable",type:"boolean"},{name:"opaque",type:"boolean"},{name:"noSubsets",type:"boolean"},{name:"cascaded",type:"int"},{name:"fixedWidth",type:"int"},{name:"fixedHeight",type:"int"},{name:"minScale",type:"float"},{name:"maxScale",type:"float"},{name:"prefix",type:"string"},{name:"formats"},{name:"styles"},{name:"srs"},{name:"dimensions"},{name:"bbox"},{name:"llbbox"},{name:"attribution"},{name:"keywords"},{name:"identifiers"},{name:"authorityURLs"},{name:"metadataURLs"}]);}GeoExt.data.WMSCapabilitiesReader.superclass.constructor.call(this,a,b);};Ext.extend(GeoExt.data.WMSCapabilitiesReader,Ext.data.DataReader,{attributionCls:"gx-attribution",read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText;}return this.readRecords(b);},serviceExceptionFormat:function(a){if(OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_inimage")>-1){return"application/vnd.ogc.se_inimage";}if(OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_xml")>-1){return"application/vnd.ogc.se_xml";}return a[0];},imageFormat:function(b){var a=b.formats;if(b.opaque&&OpenLayers.Util.indexOf(a,"image/jpeg")>-1){return"image/jpeg";}if(OpenLayers.Util.indexOf(a,"image/png")>-1){return"image/png";}if(OpenLayers.Util.indexOf(a,"image/png; mode=24bit")>-1){return"image/png; mode=24bit";}if(OpenLayers.Util.indexOf(a,"image/gif")>-1){return"image/gif";}return a[0];},imageTransparent:function(a){return a.opaque==undefined||!a.opaque;},readRecords:function(t){if(typeof t==="string"||t.nodeType){t=this.meta.format.read(t);}var f=t.version;var d=t.capability||{};var g=d.request&&d.request.getmap&&d.request.getmap.href;var l=d.layers;var h=d.exception?d.exception.formats:[];var z=this.serviceExceptionFormat(h);var w=[];if(g&&l){var o=this.recordType.prototype.fields;var q,b,e,C,a,m;for(var s=0,u=l.length;s<u;s++){q=l[s];if(q.name){b={};for(var r=0,B=o.length;r<B;r++){a=o.items[r];m=q[a.mapping||a.name]||a.defaultValue;m=a.convert(m);b[a.name]=m;}e={attribution:q.attribution?this.attributionMarkup(q.attribution):undefined,minScale:q.minScale,maxScale:q.maxScale};if(this.meta.layerOptions){Ext.apply(e,this.meta.layerOptions);}C={layers:q.name,exceptions:z,format:this.imageFormat(q),transparent:this.imageTransparent(q),version:f};if(this.meta.layerParams){Ext.apply(C,this.meta.layerParams);}b.layer=new OpenLayers.Layer.WMS(q.title||q.name,g,C,e);w.push(new this.recordType(b,b.layer.id));}}}return{totalRecords:w.length,success:true,records:w};},attributionMarkup:function(b){var d=[];if(b.logo){d.push("<img class='"+this.attributionCls+"-image' src='"+b.logo.href+"' />");}if(b.title){d.push("<span class='"+this.attributionCls+"-title'>"+b.title+"</span>");}if(b.href){for(var a=0;a<d.length;a++){d[a]="<a class='"+this.attributionCls+"-link' href="+b.href+">"+d[a]+"</a>";}}return d.join(" ");}});Ext.namespace("GeoExt.data");GeoExt.data.WMSCapabilitiesStore=function(a){a=a||{};GeoExt.data.WMSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSCapabilitiesReader(a,a.fields)}));};Ext.extend(GeoExt.data.WMSCapabilitiesStore,Ext.data.Store);Ext.namespace("GeoExt.data");GeoExt.data.WMSDescribeLayerReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WMSDescribeLayer();}if(!(typeof b==="function")){b=Ext.data.Record.create(b||a.fields||[{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}]);}GeoExt.data.WMSDescribeLayerReader.superclass.constructor.call(this,a,b);};Ext.extend(GeoExt.data.WMSDescribeLayerReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText;}return this.readRecords(b);},readRecords:function(d){if(typeof d==="string"||d.nodeType){d=this.meta.format.read(d);}var f=[],b;for(var a=0,e=d.length;a<e;a++){b=d[a];if(b){f.push(new this.recordType(b));}}return{totalRecords:f.length,success:true,records:f};}});Ext.namespace("GeoExt.data");GeoExt.data.WMSDescribeLayerStore=function(a){a=a||{};GeoExt.data.WMSDescribeLayerStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSDescribeLayerReader(a,a.fields)}));};Ext.extend(GeoExt.data.WMSDescribeLayerStore,Ext.data.Store);Ext.namespace("GeoExt");GeoExt.Action=Ext.extend(Ext.Action,{control:null,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(a){this.uScope=a.scope;this.uHandler=a.handler;this.uToggleHandler=a.toggleHandler;this.uCheckHandler=a.checkHandler;a.scope=this;a.handler=this.pHandler;a.toggleHandler=this.pToggleHandler;a.checkHandler=this.pCheckHandler;var b=this.control=a.control;delete a.control;if(b){if(a.map){a.map.addControl(b);delete a.map;}if((a.pressed||a.checked)&&b.map){b.activate();}b.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this});}arguments.callee.superclass.constructor.call(this,a);},pHandler:function(a){var b=this.control;if(b&&b.type==OpenLayers.Control.TYPE_BUTTON){b.trigger();}if(this.uHandler){this.uHandler.apply(this.uScope,arguments);}},pToggleHandler:function(a,b){this.changeControlState(b);if(this.uToggleHandler){this.uToggleHandler.apply(this.uScope,arguments);}},pCheckHandler:function(a,b){this.changeControlState(b);if(this.uCheckHandler){this.uCheckHandler.apply(this.uScope,arguments);}},changeControlState:function(a){if(a){if(!this._activating){this._activating=true;this.control.activate();this._activating=false;}}else{if(!this._deactivating){this._deactivating=true;this.control.deactivate();this._deactivating=false;}}},onCtrlActivate:function(){var a=this.control;if(a.type==OpenLayers.Control.TYPE_BUTTON){this.enable();}else{this.safeCallEach("toggle",[true]);this.safeCallEach("setChecked",[true]);}},onCtrlDeactivate:function(){var a=this.control;if(a.type==OpenLayers.Control.TYPE_BUTTON){this.disable();}else{this.safeCallEach("toggle",[false]);this.safeCallEach("setChecked",[false]);}},safeCallEach:function(d,f){var b=this.items;for(var a=0,e=b.length;a<e;a++){if(b[a][d]){b[a].rendered?b[a][d].apply(b[a],f):b[a].on({render:b[a][d].createDelegate(b[a],f),single:true});}}}});Ext.namespace("GeoExt");GeoExt.MapPanel=Ext.extend(Ext.Panel,{map:null,layers:null,center:null,zoom:null,prettyStateKeys:false,extent:null,stateEvents:["aftermapmove","afterlayervisibilitychange","afterlayeropacitychange"],initComponent:function(){if(!(this.map instanceof OpenLayers.Map)){this.map=new OpenLayers.Map(Ext.applyIf(this.map||{},{allOverlays:true}));}var a=this.layers;if(!a||a instanceof Array){this.layers=new GeoExt.data.LayerStore({layers:a,map:this.map.layers.length>0?this.map:null});}if(typeof this.center=="string"){this.center=OpenLayers.LonLat.fromString(this.center);}else{if(this.center instanceof Array){this.center=new OpenLayers.LonLat(this.center[0],this.center[1]);}}if(typeof this.extent=="string"){this.extent=OpenLayers.Bounds.fromString(this.extent);}else{if(this.extent instanceof Array){this.extent=OpenLayers.Bounds.fromArray(this.extent);}}GeoExt.MapPanel.superclass.initComponent.call(this);this.addEvents("aftermapmove","afterlayervisibilitychange","afterlayeropacitychange");this.map.events.on({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this});
},onMoveend:function(){this.fireEvent("aftermapmove");},onLayerchange:function(a){if(a.property){if(a.property==="visibility"){this.fireEvent("afterlayervisibilitychange");}else{if(a.property==="opacity"){this.fireEvent("afterlayeropacitychange");}}}},applyState:function(h){this.center=new OpenLayers.LonLat(h.x,h.y);this.zoom=h.zoom;var g,d,f,b,a,e;var j=this.map.layers;for(g=0,d=j.length;g<d;g++){f=j[g];b=this.prettyStateKeys?f.name:f.id;a=h["visibility_"+b];if(a!==undefined){a=(/^true$/i).test(a);if(f.isBaseLayer){if(a){this.map.setBaseLayer(f);}}else{f.setVisibility(a);}}e=h["opacity_"+b];if(e!==undefined){f.setOpacity(e);}}},getState:function(){var h;if(!this.map){return;}var b=this.map.getCenter();h={x:b.lon,y:b.lat,zoom:this.map.getZoom()};var g,e,f,d,a=this.map.layers;for(g=0,e=a.length;g<e;g++){f=a[g];d=this.prettyStateKeys?f.name:f.id;h["visibility_"+d]=f.getVisibility();h["opacity_"+d]=f.opacity==null?1:f.opacity;}return h;},updateMapSize:function(){if(this.map){this.map.updateSize();}},renderMap:function(){var a=this.map;a.render(this.body.dom);this.layers.bind(a);if(a.layers.length>0){if(this.center||this.zoom!=null){a.setCenter(this.center,this.zoom);}else{if(this.extent){a.zoomToExtent(this.extent);}else{a.zoomToMaxExtent();}}}},afterRender:function(){GeoExt.MapPanel.superclass.afterRender.apply(this,arguments);if(!this.ownerCt){this.renderMap();}else{this.ownerCt.on("move",this.updateMapSize,this);this.ownerCt.on({afterlayout:{fn:this.renderMap,scope:this,single:true}});}},onResize:function(){GeoExt.MapPanel.superclass.onResize.apply(this,arguments);this.updateMapSize();},onBeforeAdd:function(a){if(typeof a.addToMapPanel==="function"){a.addToMapPanel(this);}GeoExt.MapPanel.superclass.onBeforeAdd.apply(this,arguments);},remove:function(b,a){if(typeof b.removeFromMapPanel==="function"){b.removeFromMapPanel(this);}GeoExt.MapPanel.superclass.remove.apply(this,arguments);},beforeDestroy:function(){if(this.ownerCt){this.ownerCt.un("move",this.updateMapSize,this);}if(this.map&&this.map.events){this.map.events.un({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this});}if(!this.initialConfig.map||!(this.initialConfig.map instanceof OpenLayers.Map)){if(this.map&&this.map.destroy){this.map.destroy();}}delete this.map;GeoExt.MapPanel.superclass.beforeDestroy.apply(this,arguments);}});GeoExt.MapPanel.guess=function(){return Ext.ComponentMgr.all.find(function(a){return a instanceof GeoExt.MapPanel;});};Ext.reg("gx_mappanel",GeoExt.MapPanel);Ext.namespace("GeoExt");GeoExt.LegendImage=Ext.extend(Ext.BoxComponent,{url:null,defaultImgSrc:null,imgCls:null,initComponent:function(){GeoExt.LegendImage.superclass.initComponent.call(this);if(this.defaultImgSrc===null){this.defaultImgSrc=Ext.BLANK_IMAGE_URL;}this.autoEl={tag:"img","class":(this.imgCls?this.imgCls:""),src:this.defaultImgSrc};},setUrl:function(a){this.url=a;var b=this.getEl();if(b){b.un("error",this.onImageLoadError,this);b.on("error",this.onImageLoadError,this,{single:true});b.dom.src=a;}},onRender:function(b,a){GeoExt.LegendImage.superclass.onRender.call(this,b,a);if(this.url){this.setUrl(this.url);}},onDestroy:function(){var a=this.getEl();if(a){a.un("error",this.onImageLoadError,this);}GeoExt.LegendImage.superclass.onDestroy.apply(this,arguments);},onImageLoadError:function(){this.getEl().dom.src=this.defaultImgSrc;}});Ext.reg("gx_legendimage",GeoExt.LegendImage);Ext.namespace("GeoExt");GeoExt.LegendPanel=Ext.extend(Ext.Panel,{dynamic:true,layerStore:null,preferredTypes:null,filter:function(a){return true;},initComponent:function(){GeoExt.LegendPanel.superclass.initComponent.call(this);},onRender:function(){GeoExt.LegendPanel.superclass.onRender.apply(this,arguments);if(!this.layerStore){this.layerStore=GeoExt.MapPanel.guess().layers;}this.layerStore.each(function(a){this.addLegend(a);},this);if(this.dynamic){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,clear:this.onStoreClear,scope:this});}},recordIndexToPanelIndex:function(d){var e=this.layerStore;var b=e.getCount();var h=-1;var f=this.items?this.items.length:0;var j,l;for(var g=b-1;g>=0;--g){j=e.getAt(g);l=j.getLayer();var a=GeoExt.LayerLegend.getTypes(j);if(l.displayInLayerSwitcher&&a.length>0&&(e.getAt(g).get("hideInLegend")!==true)){++h;if(d===g||h>f-1){break;}}}return h;},getIdForLayer:function(a){return this.id+"-"+a.id;},onStoreAdd:function(f,e,g){var b=this.recordIndexToPanelIndex(g+e.length-1);for(var a=0,d=e.length;a<d;a++){this.addLegend(e[a],b);}this.doLayout();},onStoreRemove:function(d,b,a){this.removeLegend(b);},removeLegend:function(a){if(this.items){var b=this.getComponent(this.getIdForLayer(a.getLayer()));if(b){this.remove(b,true);this.doLayout();}}},onStoreClear:function(a){this.removeAllLegends();},removeAllLegends:function(){this.removeAll(true);this.doLayout();},addLegend:function(e,f){if(this.filter(e)===true){var b=e.getLayer();f=f||0;var d;var a=GeoExt.LayerLegend.getTypes(e,this.preferredTypes);if(b.displayInLayerSwitcher&&!e.get("hideInLegend")&&a.length>0){this.insert(f,{xtype:a[0],id:this.getIdForLayer(b),layerRecord:e,hidden:!((!b.map&&b.visibility)||(b.getVisibility()&&b.calculateInRange()))});}}},onDestroy:function(){if(this.layerStore){this.layerStore.un("add",this.onStoreAdd,this);this.layerStore.un("remove",this.onStoreRemove,this);this.layerStore.un("clear",this.onStoreClear,this);}GeoExt.LegendPanel.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gx_legendpanel",GeoExt.LegendPanel);Ext.namespace("GeoExt");GeoExt.LayerLegend=Ext.extend(Ext.Container,{layerRecord:null,showTitle:true,legendTitle:null,labelCls:null,layerStore:null,initComponent:function(){GeoExt.LayerLegend.superclass.initComponent.call(this);this.autoEl={};this.add({xtype:"label",text:this.getLayerTitle(this.layerRecord),cls:"x-form-item x-form-item-label"+(this.labelCls?" "+this.labelCls:"")});if(this.layerRecord&&this.layerRecord.store){this.layerStore=this.layerRecord.store;this.layerStore.on("update",this.onStoreUpdate,this);}},onStoreUpdate:function(a,d,e){if(d===this.layerRecord&&this.items.getCount()>0){var b=d.getLayer();this.setVisible(b.getVisibility()&&b.calculateInRange()&&b.displayInLayerSwitcher&&!d.get("hideInLegend"));this.update();}},update:function(){var a=this.getLayerTitle(this.layerRecord);if(this.items.get(0).text!==a){this.items.get(0).setText(a);}},getLayerTitle:function(a){var b=this.legendTitle||"";if(this.showTitle&&!b){if(a&&!a.get("hideTitle")){b=a.get("title")||a.get("name")||a.getLayer().name||"";}}return b;},beforeDestroy:function(){this.layerStore&&this.layerStore.un("update",this.onStoreUpdate,this);GeoExt.LayerLegend.superclass.beforeDestroy.apply(this,arguments);}});GeoExt.LayerLegend.getTypes=function(f,e){var b=(e||[]).concat();var a=[];for(var d in GeoExt.LayerLegend.types){if(GeoExt.LayerLegend.types[d].supports(f)){b.indexOf(d)==-1&&a.push(d);}else{b.remove(d);}}return b.concat(a);};GeoExt.LayerLegend.supports=function(a){};GeoExt.LayerLegend.types={};Ext.namespace("GeoExt");GeoExt.WMSLegend=Ext.extend(GeoExt.LayerLegend,{defaultStyleIsFirst:true,useScaleParameter:true,baseParams:null,initComponent:function(){GeoExt.WMSLegend.superclass.initComponent.call(this);var a=this.layerRecord.getLayer();this._noMap=!a.map;a.events.register("moveend",this,this.onLayerMoveend);this.update();},onLayerMoveend:function(a){if((a.zoomChanged===true&&this.useScaleParameter===true)||this._noMap){delete this._noMap;this.update();}},getLegendUrl:function(l,m){var h=this.layerRecord;var a;var e=h&&h.get("styles");var j=h.getLayer();m=m||[j.params.LAYERS].join(",").split(",");var b=j.params.STYLES&&[j.params.STYLES].join(",").split(",");var o=m.indexOf(l);var d=b&&b[o];if(e&&e.length>0){if(d){Ext.each(e,function(q){a=(q.name==d&&q.legend)&&q.legend.href;return !a;});}else{if(this.defaultStyleIsFirst===true&&!b&&!j.params.SLD&&!j.params.SLD_BODY){a=e[0].legend&&e[0].legend.href;}}}if(!a){a=j.getFullRequestString({REQUEST:"GetLegendGraphic",WIDTH:null,HEIGHT:null,EXCEPTIONS:"application/vnd.ogc.se_xml",LAYER:l,LAYERS:null,STYLE:(d!=="")?d:null,STYLES:null,SRS:null,FORMAT:null});
}if(this.useScaleParameter===true&&a.toLowerCase().indexOf("request=getlegendgraphic")!=-1){var f=j.map.getScale();a=Ext.urlAppend(a,"SCALE="+f);}var g=this.baseParams||{};Ext.applyIf(g,{FORMAT:"image/gif"});if(a.indexOf("?")>0){a=Ext.urlEncode(g,a);}return a;},update:function(){var e=this.layerRecord.getLayer();if(!(e&&e.map)){return;}GeoExt.WMSLegend.superclass.update.apply(this,arguments);var j,b,d,a;j=[e.params.LAYERS].join(",").split(",");var f=[];var h=this.items.get(0);this.items.each(function(l){d=j.indexOf(l.itemId);if(d<0&&l!=h){f.push(l);}else{if(l!==h){b=j[d];var m=this.getLegendUrl(b,j);if(!OpenLayers.Util.isEquivalentUrl(m,l.url)){l.setUrl(m);}}}},this);for(d=0,a=f.length;d<a;d++){var g=f[d];this.remove(g);g.destroy();}for(d=0,a=j.length;d<a;d++){b=j[d];if(!this.items||!this.getComponent(b)){this.add({xtype:"gx_legendimage",url:this.getLegendUrl(b,j),itemId:b});}}this.doLayout();},beforeDestroy:function(){if(this.useScaleParameter===true){var a=this.layerRecord.getLayer();a&&a.events&&a.events.unregister("moveend",this,this.onLayerMoveend);}GeoExt.WMSLegend.superclass.beforeDestroy.apply(this,arguments);}});GeoExt.WMSLegend.supports=function(a){return a.getLayer() instanceof OpenLayers.Layer.WMS;};GeoExt.LayerLegend.types.gx_wmslegend=GeoExt.WMSLegend;Ext.reg("gx_wmslegend",GeoExt.WMSLegend);Ext.namespace("GeoExt.tree");GeoExt.tree.LayerContainer=Ext.extend(Ext.tree.AsyncTreeNode,{constructor:function(a){a=Ext.applyIf(a||{},{text:"Layers"});this.loader=a.loader instanceof GeoExt.tree.LayerLoader?a.loader:new GeoExt.tree.LayerLoader(Ext.applyIf(a.loader||{},{store:a.layerStore}));GeoExt.tree.LayerContainer.superclass.constructor.call(this,a);},recordIndexToNodeIndex:function(f){var e=this.loader.store;var a=e.getCount();var d=this.childNodes.length;var b=-1;for(var g=a-1;g>=0;--g){if(this.loader.filter(e.getAt(g))===true){++b;if(f===g||b>d-1){break;}}}return b;},destroy:function(){delete this.layerStore;GeoExt.tree.LayerContainer.superclass.destroy.apply(this,arguments);}});Ext.tree.TreePanel.nodeTypes.gx_layercontainer=GeoExt.tree.LayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.BaseLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(a){a=Ext.applyIf(a||{},{text:"Base Layer",loader:{}});a.loader=Ext.applyIf(a.loader,{baseAttrs:Ext.applyIf(a.loader.baseAttrs||{},{iconCls:"gx-tree-baselayer-icon",checkedGroup:"baselayer"}),filter:function(b){var d=b.getLayer();return d.displayInLayerSwitcher===true&&d.isBaseLayer===true;}});GeoExt.tree.BaseLayerContainer.superclass.constructor.call(this,a);}});Ext.tree.TreePanel.nodeTypes.gx_baselayercontainer=GeoExt.tree.BaseLayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.LayerLoader=function(a){Ext.apply(this,a);this.addEvents("beforeload","load");GeoExt.tree.LayerLoader.superclass.constructor.call(this);};Ext.extend(GeoExt.tree.LayerLoader,Ext.util.Observable,{store:null,filter:function(a){return a.getLayer().displayInLayerSwitcher==true;},baseAttrs:null,uiProviders:null,load:function(a,b){if(this.fireEvent("beforeload",this,a)){this.removeStoreHandlers();while(a.firstChild){a.removeChild(a.firstChild);}if(!this.uiProviders){this.uiProviders=a.getOwnerTree().getLoader().uiProviders;}if(!this.store){this.store=GeoExt.MapPanel.guess().layers;}this.store.each(function(d){this.addLayerNode(a,d);},this);this.addStoreHandlers(a);if(typeof b=="function"){b();}this.fireEvent("load",this,a);}},onStoreAdd:function(e,d,f,a){if(!this._reordering){var b=a.recordIndexToNodeIndex(f+d.length-1);for(var g=0;g<d.length;++g){this.addLayerNode(a,d[g],b);}}},onStoreRemove:function(e,d,a,b){if(!this._reordering){this.removeLayerNode(b,d);}},addLayerNode:function(b,e,f){f=f||0;if(this.filter(e)===true){var d=this.createNode({nodeType:"gx_layer",layer:e.getLayer(),layerStore:this.store});var a=b.item(f);if(a){b.insertBefore(d,a);}else{b.appendChild(d);}d.on("move",this.onChildMove,this);}},removeLayerNode:function(d,b){if(this.filter(b)===true){var a=d.findChildBy(function(e){return e.layer==b.getLayer();});if(a){a.un("move",this.onChildMove,this);a.remove();d.reload();}}},onChildMove:function(e,f,a,b,l){this._reordering=true;var j=this.store.getByLayer(f.layer);if(b instanceof GeoExt.tree.LayerContainer&&this.store===b.loader.store){b.loader._reordering=true;this.store.remove(j);var d;if(b.childNodes.length>1){var m=(l===0)?l+1:l-1;d=this.store.findBy(function(o){return b.childNodes[m].layer===o.getLayer();});l===0&&d++;}else{if(a.parentNode===b.parentNode){var g=b;do{g=g.previousSibling;}while(g&&!(g instanceof GeoExt.tree.LayerContainer&&g.lastChild));if(g){d=this.store.findBy(function(o){return g.lastChild.layer===o.getLayer();});}else{var h=b;do{h=h.nextSibling;}while(h&&!(h instanceof GeoExt.tree.LayerContainer&&h.firstChild));if(h){d=this.store.findBy(function(o){return h.firstChild.layer===o.getLayer();});}d++;}}}if(d!==undefined){this.store.insert(d,[j]);window.setTimeout(function(){b.reload();a.reload();});}else{this.store.insert(oldRecordIndex,[j]);}delete b.loader._reordering;}delete this._reordering;},addStoreHandlers:function(b){if(!this._storeHandlers){this._storeHandlers={add:this.onStoreAdd.createDelegate(this,[b],true),remove:this.onStoreRemove.createDelegate(this,[b],true)};for(var a in this._storeHandlers){this.store.on(a,this._storeHandlers[a],this);}}},removeStoreHandlers:function(){if(this._storeHandlers){for(var a in this._storeHandlers){this.store.un(a,this._storeHandlers[a],this);}delete this._storeHandlers;}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs);}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider);}attr.nodeType=attr.nodeType||"gx_layer";return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr);},destroy:function(){this.removeStoreHandlers();}});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{constructor:function(a){GeoExt.tree.LayerNodeUI.superclass.constructor.apply(this,arguments);},render:function(e){var d=this.node.attributes;if(d.checked===undefined){d.checked=this.node.layer.getVisibility();}GeoExt.tree.LayerNodeUI.superclass.render.apply(this,arguments);var b=this.checkbox;if(d.checkedGroup){var f=Ext.DomHelper.insertAfter(b,['<input type="radio" name="',d.checkedGroup,'_checkbox" class="',b.className,b.checked?'" checked="checked"':"",'"></input>'].join(""));f.defaultChecked=b.defaultChecked;Ext.get(b).remove();this.checkbox=f;}this.enforceOneVisible();},onClick:function(a){if(a.getTarget(".x-tree-node-cb",1)){this.toggleCheck(this.isChecked());}else{GeoExt.tree.LayerNodeUI.superclass.onClick.apply(this,arguments);}},toggleCheck:function(a){a=(a===undefined?!this.isChecked():a);GeoExt.tree.LayerNodeUI.superclass.toggleCheck.call(this,a);this.enforceOneVisible();},enforceOneVisible:function(){var f=this.node.attributes;var d=f.checkedGroup;if(d&&d!=="gx_baselayer"){var b=this.node.layer;var e=this.node.getOwnerTree().getChecked();var a=0;Ext.each(e,function(h){var g=h.layer;if(!h.hidden&&h.attributes.checkedGroup===d){a++;if(g!=b&&f.checked){g.setVisibility(false);}}});if(a===0&&f.checked==false){b.setVisibility(true);}}},appendDDGhost:function(a){var d=this.elNode.cloneNode(true);var b=Ext.DomQuery.select("input[type='radio']",d);Ext.each(b,function(e){e.name=e.name+"_clone";});a.appendChild(d);}});GeoExt.tree.LayerNode=Ext.extend(Ext.tree.AsyncTreeNode,{layer:null,layerStore:null,constructor:function(a){a.leaf=a.leaf||!(a.children||a.loader);if(!a.iconCls&&!a.children){a.iconCls="gx-tree-layer-icon";}if(a.loader&&!(a.loader instanceof Ext.tree.TreeLoader)){a.loader=new GeoExt.tree.LayerParamLoader(a.loader);}this.defaultUI=this.defaultUI||GeoExt.tree.LayerNodeUI;Ext.apply(this,{layer:a.layer,layerStore:a.layerStore});if(a.text){this.fixedText=true;}GeoExt.tree.LayerNode.superclass.constructor.apply(this,arguments);},render:function(d){var a=this.layer instanceof OpenLayers.Layer&&this.layer;if(!a){if(!this.layerStore||this.layerStore=="auto"){this.layerStore=GeoExt.MapPanel.guess().layers;
}var e=this.layerStore.findBy(function(f){return f.get("title")==this.layer;},this);if(e!=-1){a=this.layerStore.getAt(e).getLayer();}}if(!this.rendered||!a){var b=this.getUI();if(a){this.layer=a;if(a.isBaseLayer){this.draggable=false;Ext.applyIf(this.attributes,{checkedGroup:"gx_baselayer"});}if(!this.text){this.text=a.name;}b.show();this.addVisibilityEventHandlers();}else{b.hide();}if(this.layerStore instanceof GeoExt.data.LayerStore){this.addStoreEventHandlers(a);}}GeoExt.tree.LayerNode.superclass.render.apply(this,arguments);},addVisibilityEventHandlers:function(){this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});this.on({checkchange:this.onCheckChange,scope:this});},onLayerVisibilityChanged:function(){if(!this._visibilityChanging){this.getUI().toggleCheck(this.layer.getVisibility());}},onCheckChange:function(a,d){if(d!=this.layer.getVisibility()){this._visibilityChanging=true;var b=this.layer;if(d&&b.isBaseLayer&&b.map){b.map.setBaseLayer(b);}else{b.setVisibility(d);}delete this._visibilityChanging;}},addStoreEventHandlers:function(){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,update:this.onStoreUpdate,scope:this});},onStoreAdd:function(a,f,b){var e;for(var d=0;d<f.length;++d){e=f[d].getLayer();if(this.layer==e){this.getUI().show();break;}else{if(this.layer==e.name){this.render();break;}}}},onStoreRemove:function(d,b,a){if(this.layer==b.getLayer()){this.getUI().hide();}},onStoreUpdate:function(a,d,e){var b=d.getLayer();if(!this.fixedText&&(this.layer==b&&this.text!==b.name)){this.setText(b.name);}},destroy:function(){var b=this.layer;if(b instanceof OpenLayers.Layer){b.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this});}delete this.layer;var a=this.layerStore;if(a){a.un("add",this.onStoreAdd,this);a.un("remove",this.onStoreRemove,this);a.un("update",this.onStoreUpdate,this);}delete this.layerStore;this.un("checkchange",this.onCheckChange,this);GeoExt.tree.LayerNode.superclass.destroy.apply(this,arguments);}});Ext.tree.TreePanel.nodeTypes.gx_layer=GeoExt.tree.LayerNode;Ext.namespace("GeoExt.tree");GeoExt.tree.LayerParamLoader=function(a){Ext.apply(this,a);this.addEvents("beforeload","load");GeoExt.tree.LayerParamLoader.superclass.constructor.call(this);};Ext.extend(GeoExt.tree.LayerParamLoader,Ext.util.Observable,{param:null,delimiter:",",load:function(e,b){if(this.fireEvent("beforeload",this,e)){while(e.firstChild){e.removeChild(e.firstChild);}var a=(e.layer instanceof OpenLayers.Layer.HTTPRequest)&&e.layer.params[this.param];if(a){var d=(a instanceof Array)?a.slice():a.split(this.delimiter);Ext.each(d,function(g,h,f){this.addParamNode(g,f,e);},this);}if(typeof b=="function"){b();}this.fireEvent("load",this,e);}},addParamNode:function(e,f,b){var d=this.createNode({layer:b.layer,param:this.param,item:e,allItems:f,delimiter:this.delimiter});var a=b.item(0);if(a){b.insertBefore(d,a);}else{b.appendChild(d);}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs);}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider);}attr.nodeType=attr.nodeType||"gx_layerparam";return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr);}});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerParamNode=Ext.extend(Ext.tree.TreeNode,{layer:null,param:null,item:null,delimiter:null,allItems:null,constructor:function(a){var b=a||{};b.iconCls=b.iconCls||"gx-tree-layerparam-icon";b.text=b.text||b.item;this.param=b.param;this.item=b.item;this.delimiter=b.delimiter||",";this.allItems=b.allItems;GeoExt.tree.LayerParamNode.superclass.constructor.apply(this,arguments);this.getLayer();if(this.layer){if(!this.allItems){this.allItems=this.getItemsFromLayer();}if(this.attributes.checked==null){this.attributes.checked=this.layer.getVisibility()&&this.getItemsFromLayer().indexOf(this.item)>=0;}else{this.onCheckChange(this,this.attributes.checked);}this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});this.on({checkchange:this.onCheckChange,scope:this});}},getLayer:function(){if(!this.layer){var a=this.attributes.layer;if(typeof a=="string"){var b=this.attributes.layerStore||GeoExt.MapPanel.guess().layers;var d=b.findBy(function(e){return e.get("title")==a;});a=d!=-1?b.getAt(d).getLayer():null;}this.layer=a;}return this.layer;},getItemsFromLayer:function(){var a=this.layer.params[this.param];return a instanceof Array?a:(a?a.split(this.delimiter):[]);},createParams:function(a){var b={};b[this.param]=this.layer.params[this.param] instanceof Array?a:a.join(this.delimiter);return b;},onLayerVisibilityChanged:function(){if(this.getItemsFromLayer().length===0){this.layer.mergeNewParams(this.createParams(this.allItems));}var a=this.layer.getVisibility();if(a&&this.getItemsFromLayer().indexOf(this.item)!==-1){this.getUI().toggleCheck(true);}if(!a){this.layer.mergeNewParams(this.createParams([]));this.getUI().toggleCheck(false);}},onCheckChange:function(a,g){var f=this.layer;var e=[];var d=this.getItemsFromLayer();if(g===true&&f.getVisibility()===false&&d.length===this.allItems.length){d=[];}Ext.each(this.allItems,function(h){if((h!==this.item&&d.indexOf(h)!==-1)||(g===true&&h===this.item)){e.push(h);}},this);var b=(e.length>0);b&&f.mergeNewParams(this.createParams(e));if(b!==f.getVisibility()){f.setVisibility(b);}(!b)&&f.mergeNewParams(this.createParams([]));},destroy:function(){var a=this.layer;if(a instanceof OpenLayers.Layer){a.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this});}delete this.layer;this.un("checkchange",this.onCheckChange,this);GeoExt.tree.LayerParamNode.superclass.destroy.apply(this,arguments);}});Ext.tree.TreePanel.nodeTypes.gx_layerparam=GeoExt.tree.LayerParamNode;Ext.namespace("GeoExt.tree");GeoExt.tree.OverlayLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(a){a=Ext.applyIf(a||{},{text:"Overlays"});a.loader=Ext.applyIf(a.loader||{},{filter:function(b){var d=b.getLayer();return d.displayInLayerSwitcher===true&&d.isBaseLayer===false;}});GeoExt.tree.OverlayLayerContainer.superclass.constructor.call(this,a);}});Ext.tree.TreePanel.nodeTypes.gx_overlaylayercontainer=GeoExt.tree.OverlayLayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.TreeNodeUIEventMixin=function(){return{constructor:function(a){a.addEvents("rendernode","rawclicknode");this.superclass=arguments.callee.superclass;this.superclass.constructor.apply(this,arguments);},render:function(a){if(!this.rendered){this.superclass.render.apply(this,arguments);this.fireEvent("rendernode",this.node);}},onClick:function(a){if(this.fireEvent("rawclicknode",this.node,a)!==false){this.superclass.onClick.apply(this,arguments);}}};};Ext.namespace("GeoExt.plugins");GeoExt.plugins.TreeNodeRadioButton=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a));Ext.apply(this,a);this.addEvents("radiochange");GeoExt.plugins.TreeNodeRadioButton.superclass.constructor.apply(this,arguments);},init:function(a){a.on({rendernode:this.onRenderNode,rawclicknode:this.onRawClickNode,beforedestroy:this.onBeforeDestroy,scope:this});},onRenderNode:function(d){var b=d.attributes;if(b.radioGroup&&!b.radio){b.radio=Ext.DomHelper.insertBefore(d.ui.anchor,['<input type="radio" class="gx-tree-radio" name="',b.radioGroup,'_radio"></input>'].join(""));}},onRawClickNode:function(d,a){var b=a.getTarget(".gx-tree-radio",1);if(b){b.defaultChecked=b.checked;this.fireEvent("radiochange",d);return false;}},onBeforeDestroy:function(a){a.un("rendernode",this.onRenderNode,this);a.un("rawclicknode",this.onRenderNode,this);a.un("beforedestroy",this.onBeforeDestroy,this);}});Ext.preg("gx_treenoderadiobutton",GeoExt.plugins.TreeNodeRadioButton);Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintProviderField=Ext.extend(Ext.util.Observable,{target:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);GeoExt.plugins.PrintProviderField.superclass.constructor.apply(this,arguments);},init:function(b){this.target=b;
var a={scope:this,render:this.onRender,beforedestroy:this.onBeforeDestroy};a[b instanceof Ext.form.ComboBox?"select":"valid"]=this.onFieldChange;b.on(a);},onRender:function(a){var b=this.printProvider||a.ownerCt.printProvider;if(a.store===b.layouts){a.setValue(b.layout.get(a.displayField));b.on({layoutchange:this.onProviderChange,scope:this});}else{if(a.store===b.dpis){a.setValue(b.dpi.get(a.displayField));b.on({dpichange:this.onProviderChange,scope:this});}else{if(a.initialConfig.value===undefined){a.setValue(b.customParams[a.name]);}}}},onFieldChange:function(a,d){var b=this.printProvider||a.ownerCt.printProvider;var e=a.getValue();this._updating=true;if(d){switch(a.store){case b.layouts:b.setLayout(d);break;case b.dpis:b.setDpi(d);}}else{b.customParams[a.name]=e;}delete this._updating;},onProviderChange:function(b,a){if(!this._updating){this.target.setValue(a.get(this.target.displayField));}},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);this.target.un("render",this.onRender,this);this.target.un("select",this.onFieldChange,this);this.target.un("valid",this.onFieldChange,this);this.printProvider.un("layoutchange",this.onProviderChange,this);this.printProvider.un("dpichange",this.onProviderChange,this);}});Ext.preg("gx_printproviderfield",GeoExt.plugins.PrintProviderField);Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintPageField=Ext.extend(Ext.util.Observable,{printPage:null,target:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);GeoExt.plugins.PrintPageField.superclass.constructor.apply(this,arguments);},init:function(a){this.target=a;var d={beforedestroy:this.onBeforeDestroy,scope:this};var b=a instanceof Ext.form.ComboBox?"select":a instanceof Ext.form.Checkbox?"check":"valid";d[b]=this.onFieldChange;a.on(d);this.printPage.on({change:this.onPageChange,scope:this});this.printPage.printProvider.on({layoutchange:this.onLayoutChange,scope:this});this.setValue(this.printPage);},onFieldChange:function(a,d){var b=this.printPage.printProvider;var e=a.getValue();this._updating=true;if(a.store===b.scales||a.name==="scale"){this.printPage.setScale(d);}else{if(a.name=="rotation"){!isNaN(e)&&this.printPage.setRotation(e);}else{this.printPage.customParams[a.name]=e;}}delete this._updating;},onPageChange:function(a){if(!this._updating){this.setValue(a);}},onLayoutChange:function(a,d){var b=this.target;b.name=="rotation"&&b.setDisabled(!d.get("rotation"));},setValue:function(a){var b=this.target;b.suspendEvents();if(b.store===a.printProvider.scales||b.name==="scale"){if(a.scale){b.setValue(a.scale.get(b.displayField));}}else{if(b.name=="rotation"){b.setValue(a.rotation);}}b.resumeEvents();},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);this.target.un("select",this.onFieldChange,this);this.target.un("valid",this.onFieldChange,this);this.printPage.un("change",this.onPageChange,this);this.printPage.printProvider.un("layoutchange",this.onLayoutChange,this);}});Ext.preg("gx_printpagefield",GeoExt.plugins.PrintPageField);Ext.namespace("GeoExt");GeoExt.SliderTip=Ext.extend(Ext.slider.Tip,{hover:true,minWidth:10,offsets:[0,-10],dragging:false,init:function(a){GeoExt.SliderTip.superclass.init.apply(this,arguments);if(this.hover){a.on("render",this.registerThumbListeners,this);}this.slider=a;},registerThumbListeners:function(){var d,b;for(var e=0,a=this.slider.thumbs.length;e<a;++e){d=this.slider.thumbs[e];b=d.tracker.el;(function(f,g){g.on({mouseover:function(h){this.onSlide(this.slider,h,f);this.dragging=false;},mouseout:function(){if(!this.dragging){this.hide.apply(this,arguments);}},scope:this});}).apply(this,[d,b]);}},onSlide:function(d,a,b){this.dragging=true;return GeoExt.SliderTip.superclass.onSlide.apply(this,arguments);}});Ext.namespace("GeoExt");GeoExt.LayerOpacitySliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>{opacity}%</div>",compiledTemplate:null,init:function(a){this.compiledTemplate=new Ext.Template(this.template);GeoExt.LayerOpacitySliderTip.superclass.init.call(this,a);},getText:function(a){var b={opacity:a.value};return this.compiledTemplate.apply(b);}});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerOpacitySliderPlugin=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a));Ext.apply(this,a);this.addEvents("opacityslide");GeoExt.tree.LayerOpacitySliderPlugin.superclass.constructor.apply(this,arguments);},init:function(a){a.on({rendernode:this.onRenderNode,scope:this});},onRenderNode:function(f){var e=f.attributes;var h=f.layer;if(e.slider){this.indentMarkup=f.parentNode?f.parentNode.ui.getChildIndent():"";var g=f.id+"-tree-slider-";g=Ext.id(null,g);buf=["<br/>","<table><tr>","<td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>","<a id=",g,"></a>","</td>","</tr></table>"];Ext.DomHelper.insertAfter(f.ui.anchor,buf.join(""));var b=100;var d=new Ext.Slider({minValue:0,maxValue:100,value:b,width:100,aggressive:true,layer:h,plugins:new GeoExt.LayerOpacitySliderTip()});Ext.override(Ext.Slider,{getRatio:function(){var a=this.innerEl.getComputedWidth();var j=this.maxValue-this.minValue;return j==0?a:(a/j);}});d.on("change",function(j,l,a){this.layer.setOpacity(l/100);});d.render(g);}}});Ext.preg&&Ext.preg("gx_layeropacitysliderplugin",GeoExt.tree.LayerOpacitySliderPlugin);Ext.namespace("GeoNetwork");GeoNetwork.singleFile=true;Ext.namespace("GeoNetwork","GeoNetwork.Lang");GeoNetwork.Lang.de={featureInfoTooltipTitle:"Feature info",featureInfoTooltipText:"Click in the map to get feature info from all visible layers.",zoomToMaxExtentTooltipTitle:"Full extent",zoomToMaxExtentTooltipText:"Use this button to go to the full extent of the map.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Draw a box in the map to zoom in. You can also click in the map and map will zoom in by a factor of 2.",zoomoutTooltipTitle:"Zoom out",zoomoutTooltipText:"Click in the map or draw a box to zoom out.",dragTooltipTitle:"Pan map",dragTooltipText:"Press the left mouse button to drag the map.",previousTooltipTitle:"Previous map extent",previosTooltipText:"Click this button to go back to the previous map extent",nextTooltipTitle:"Next map extent",nextTooltipText:"Click this button to go to the next map extent",featureInfoTitle:"Feature info",layerManagerTabTitle:"Layer management",legendTabTitle:"Legend",scaleTitle:"Scale",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"There is no queryable map layer",WMSBrowserTab1:"Select",WMSBrowserTab3:"External",WMSBrowserPreviewTitle:"Preview layer",WMSBrowserAddButton:"Add",WMSBrowserDuplicateMsg:"Layer is already in the map",WMSBrowserPreviewWaitMsg:"Retrieving preview image",WMSBrowserConnectButton:"Connect",WMSBrowserConnectError:"There was an error connecting to the Web Map Service, please check the URL.",infoTitle:"Information","mf.print.mapTitle":"Title","mf.print.comment":"Comment","mf.print.dpi":"Resolution","mf.print.scale":"Scale","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Print","mf.print.generatingPDF":"Generating PDF","mf.print.unableToPrint":"It was not posible to print, try later","mf.error":"Error",selectExtentTooltipTitle:"Select extent",selectExtentTooltipText:"Select extent for catalog searches",printTooltipTitle:"Print",printTooltipText:"Print the current map",savewmcTooltipTitle:"Save web map context",savewmcTooltipText:"Saves web map context for current map","saveWMCFile.windowTitle":"Save Web Map Context","saveWMCFile.errorSaveWMC":"Could not save Web Map Context",loadwmcTooltipTitle:"Load web map context",loadwmcTooltipText:"Loads web map context in current map","selectWMCFile.windowTitle":"Load Web Map Context",selectWMCFile:"Select Web Map Context file","selectWMCFile.waitLoadingWMC":"Loading Web Map Context","selectWMCFile.loadButtonText":"Load","selectWMCFile.mergeButtonText":"Merge","selectWMCFile.errorLoadingWMC":"Could not load Web Map Context",opacityButtonText:"Opacity",opacityWindowTitle:"Opacity",metadataButtonText:"Metadata",removeButtonText:"Remove",addWMSButtonText:"Add WMS",addWMSWindowTitle:"Add WMS","layerInfoPanel.windowTitle":"Layer metadata","layerInfoPanel.titleField":"Title","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Queryable",layerList:"Layer list",baseLayerList:"Base layers","metadataResults.buttonText":"Metadata results","metadataResults.tooltipTitle":"Metadata results","metadataResults.tooltipText":"Go to metadata results page","metadataResults.alertTitle":"Metadata results","metadataResults.alertText":"No metadata results to show","mf.information":"Print","mf.print.pdfReady":"PDF ready","loadLayer.loadingMessage":"Loading layer","loadLayer.error.title":"Load layer","loadLayer.error.message":"The layer could not be loaded","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Loading...","disclaimer.buttonClose":"Close",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Straat",gazetteerAddressField3Label:"Plaats",gazetteerAddressField4Label:"Gemeente",gazetteerAddressField5Label:"Huisnummer",searchOptionButton:"Zoek",GazetteerWindowTitle:"Zoek adres",searchResults:"Zoekresultaten",errorTitle:"Fout",SearchOptionLoadFailureMsg:"Het is niet gelukt resultaten op te halen.\nMogelijk is de service tijdelijk niet beschikbaar. \n",gazetteerTooltipTitle:"Zoek op basis van een adres",gazetteerTooltipText:"Zoek een locatie op basis van een postcode, straatnaam, gemeente en/of plaats.",SearchOptionNoResults:"No results found",zoomlayerTooltipTitle:"Zoom auf Layer",zoomlayerTooltipText:"Verwenden Sie diese Taste, um das ganze Ausma der ausgewhlten Layer.","zoomlayer.selectLayerTitle":"Zoom auf Layer","zoomlayer.selectLayerText":"No layer selected",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Time position",WMSTimeMovieTitle:"Animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions"};
OpenLayers.Util.extend(OpenLayers.Lang.de,GeoNetwork.Lang.de);Ext.namespace("GeoNetwork","GeoNetwork.lang");GeoNetwork.lang.en={previousPage:"Move to previous page",nextPage:"Move to next page",upInPage:"Scroll up in the results",downInPage:"Scroll down in the results",example:"Example:",helper:"Suggestion:",toggleLayerManager:"Display map layer manager",tagName:"Element name:",enableTooltip:"Enable tooltips to get more information about each descriptors.",connectIssue:"Catalogue connection issue",connectIssueMsg:"Error 404. Can't connect to catalogue at url ",featureInfoTooltipTitle:"Feature info",featureInfoTooltipText:"Click in the map to get feature info from all visible layers.",zoomToMaxExtentTooltipTitle:"Full extent",zoomToMaxExtentTooltipText:"Use this button to go to the full extent of the map.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Draw a box in the map to zoom in. You can also click in the map and map will zoom in by a factor of 2.",zoomoutTooltipTitle:"Zoom out",zoomoutTooltipText:"Click in the map or draw a box to zoom out.",dragTooltipTitle:"Pan map",dragTooltipText:"Press the left mouse button to drag the map.",previousTooltipTitle:"Previous map extent",previosTooltipText:"Click this button to go back to the previous map extent",nextTooltipTitle:"Next map extent",nextTooltipText:"Click this button to go to the next map extent",featureInfoTitle:"Feature info",layerManagerTabTitle:"Layer management",legendTabTitle:"Legend",scaleTitle:"Scale",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"There is no queryable map layer",WMSBrowserTab1:"Select",WMSBrowserTab3:"External",WMSBrowserPreviewTitle:"Preview layer",WMSBrowserAddButton:"Add",WMSBrowserDuplicateMsg:"Layer is already in the map",WMSBrowserPreviewWaitMsg:"Retrieving preview image",WMSBrowserConnectButton:"Connect",WMSBrowserConnectError:"There was an error connecting to the Web Map Service, please check the URL.",infoTitle:"Information","mf.print.mapTitle":"Title","mf.print.comment":"Comment","mf.print.dpi":"Resolution","mf.print.scale":"Scale","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Print","mf.print.generatingPDF":"Generating PDF","mf.print.unableToPrint":"It was not possible to print, try later","mf.error":"Error",selectExtentTooltipTitle:"Select extent",selectExtentTooltipText:"Select extent for catalog searches",clearExtentTooltipTitle:"Remove extent",clearExtentTooltipText:"Remove extent (ie. no spatial criteria)",printTooltipTitle:"Print",printTooltipText:"Print the current map",savewmcTooltipTitle:"Save web map context",savewmcTooltipText:"Saves web map context for current map","saveWMCFile.windowTitle":"Save Web Map Context","saveWMCFile.errorSaveWMC":"Could not save Web Map Context",loadwmcTooltipTitle:"Load web map context",loadwmcTooltipText:"Loads web map context in current map","selectWMCFile.windowTitle":"Load Web Map Context",selectWMCFile:"Select Web Map Context file","selectWMCFile.waitLoadingWMC":"Loading Web Map Context","selectWMCFile.loadButtonText":"Load","selectWMCFile.mergeButtonText":"Merge","selectWMCFile.errorLoadingWMC":"Could not load Web Map Context",opacityButtonText:"Opacity",opacityWindowTitle:"Opacity",metadataButtonText:"Metadata",removeButtonText:"Remove",addWMSButtonText:"Add WMS",addWMSWindowTitle:"Add layer from a WMS service","layerInfoPanel.windowTitle":"Layer metadata","layerInfoPanel.titleField":"Title","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Queryable",layerList:"Layer list",baseLayerList:"Base layers","metadataResults.buttonText":"Metadata results","metadataResults.tooltipTitle":"Metadata results","metadataResults.tooltipText":"Go to metadata results page","metadataResults.alertTitle":"Metadata results","metadataResults.alertText":"No metadata results to show","featureInfoWindow.windowTitle":"Feature info","mf.information":"Print","mf.print.pdfReady":"PDF ready","loadLayer.loadingMessage":"Loading layer","loadLayer.error.title":"Load layer","loadLayer.error.message":"The layer could not be loaded","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Loading...","disclaimer.buttonClose":"Close",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Street",gazetteerAddressField3Label:"Place",gazetteerAddressField4Label:"'Gemeente'",gazetteerAddressField5Label:"House number",searchOptionButton:"Search",resetSearchForm:"Reset search form values.",GazetteerWindowTitle:"Search for address",searchResults:"Search results",errorTitle:"Error",SearchOptionLoadFailureMsg:"No results available. \n The service may be unavailable. \n",gazetteerTooltipTitle:"Search based on an address",gazetteerTooltipText:"Search for a location, based on postcode, street name, 'gemeente' or place.",SearchOptionNoResults:"No results found",zoomlayerTooltipTitle:"Zoom to layer",zoomlayerTooltipText:"Use this button to go to the full extent of the selected layer.","zoomlayer.selectLayerTitle":"Zoom to layer","zoomlayer.selectLayerText":"No layer selected",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Pick a time position",WMSTimeMovieTitle:"Play animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions",fullTextSearch:"Full text search",keyword:"Keyword",org:"Organisation",mapTypes:"Map types",rsIdentifier:"Resource identifier",inspireSearchOptions:"INSPIRE criteria",inspireannex:"INSPIRE annex",inspirerelated:"Related to INSPIRE",inspirerelatedtt:"INSPIRE dataset with report on the conformity regarding the data specification",inspiretheme:"INSPIRE theme",similarity:"Search accuracy",wkt:"WKT geometry",simpleViewMode:"Simple view",spatialSearch:"Spatial criteria",mdChangeDate:"Metadata change date",tempExtent:"Temporal extent",hitsPerPage:"Hits per page",sortBy:"Sort by",relevance:"Relevance",title:"Title",changeDate:"Change date",rating:"Rating",popularity:"Popularity",scaleDesc:"Scale (desc)",scaleAsc:"Scale (asc)","abstract":"Abstract",catalogue:"Catalogue",group:"Group",chooseGroup:"Select a group",md:"Metadata",tpl:"Template",category:"Category",advTextSearch:"Advanced text search options",eitherWords:"Either of the words",exactPhrase:"Exact phrase",allWords:"All of the words",withoutWords:"Without the words",precise:"Precise",imprecise:"Imprecise",relationType:"Relation type",within:"within",touches:"touches",crosses:"crosses",fullyOutsideOf:"fullyOutsideOf",encloses:"encloses",overlaps:"overlaps",intersection:"intersection",nearYou:"Near you",from:"From",to:"To",scaleNominator:"1:",scale:"Scale",digital:"Digital",hardCopy:"Hard copy",download:"Download",downloadable:"Download",interactive:"Interactive",resourceType:"Resource type",dataset:"Dataset",series:"Series",service:"Service",spatialRepType:"Spatial representation",video:"Video",vector:"Vector",textTable:"Text, table",tin:"Tin",stereoModel:"Stereo model",grid:"Grid",kind:"Kind",enterGetCapURL:"Enter a GetCapabilities URL to register a new service.",edit:"Edit",duplicate:"Duplicate","delete":"Delete",createChild:"Create child",privileges:"Privileges",categories:"Categories",otherActions:"Other actions",view:"View",zoomTo:"Zoom to",saveXml:"Save as XML",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",printSel:"Export (PDF)",printTT:"Print. Open a new page for printing.",newOwner:"New owner",updateCategories:"Update categories",updatePrivileges:"Update privileges",noneSelected:"None selected",none:"none",all:"all",allInPage:"all in page",select:"Select ",username:"User name",password:"password",login:"Login",logout:"Logout",administration:"Administration",validationReport:"Validation report",status:"Status",items:"items",item:"item",thumbnails:"Thumbnails",noimages:"No images to display",add:"Add",small:"Small",large:"Large",selectImage:"Select an image",selectFile:"Select a file",image:"Image",uploading:"Uploading ...",upload:"Upload",success:"Success",failure:"Failure",error:"Error",save:"Save",reset:"Reset",fileProcessedMsg:"Processed file ${res} on the server",suggestion:"Suggestion",logoSelect:"Select a logo",relatedResources:"Related resources",createLink:"Create links ...",featureCat:"Feature catalogue",serviceMd:"Service metadata",datasetMd:"Dataset metadata",parentMd:"Parent metadata",updateChildren:"Update children",records:"records",record:"record",help:"Help",publishError:"Publication failed.",outOfMemoryError:"Out of memory error.",publishErrorCode:"Error code:",saveAndCheck:"Save and check",saveAndClose:"Save and close",cancel:"Cancel",layout:"Layout",collapseAll:"Collapse all sections",editAttributes:"Manage attributes",chooseAType:"Choose a type",chooseAView:"Choose a view",viewMode:"View mode",errorAndStatusMsg:"Error. Status: ${status}, text: ${text}. Try again.",mdEditor:"Metadata editor",minorEditTT:"Do not update timestamp on save",editing:"Editing ${title} (${uuid})",GetCapabilitiesDocumentError:"Error loading service GetCapabilities document from URL: ",maxResults:"Number of results",mdTitle:"Metadata title",keywords:"Keywords",createRelation:"Create relation",createIfNotExistButton:"Create a new metadata record",getCapabilitiesLayer:"GetCapabilities layer",layerName:"Layer name",searching:"Searching ...",perThesaurus:" per thesaurus",anyThesaurus:"Any thesaurus",selectedKeywords:"Selected keywords",foundKeywords:"Available keywords",clear:"Clear",publish:"Publish",publishTooltip:"Publish current dataset to remote node. If dataset is already publish in that node, it will be updated.",publishSuccess:"Successful publication.",publishLayerAdded:" Layer added to map preview.",unpublish:"Unpublish",unpublishTooltip:"Remove current dataset from remote node.",unpublishSuccess:"Successful unpublication.",unpublishError:"Unpublication failed. ",check:"Check",errorDatasetNotFound:"Dataset not found.",datasetFound:"Dataset found and added to the map preview.",checkFailure:"Failed to check dataset in remote node.",addOnlineSourceTitle:"Link service to metadata",addOnlineSource:"Add links",addOnlineSourceTT:"Add an onlinesource section to the current metadata record pointing to the WMS/WFS/WCS services. If the service is a WMS, the layer could be displayed in the map viewer.",statusInformation:"Status information.",publishing:"Publishing ...",mapPreview:"Map preview",selectANode:"Select a node ...",geoPublisherWindowTitle:"Geo-publication: ",keywordSelectionWindowTitle:"Keywords selection",crsSelectionWindowTitle:"Coordinate reference system selection",linkedMetadataSelectionWindowTitle:"Related metadata selection",NotOwnerError:"You don't have privileges to update this related record.",ServiceUpdateError:"Error during service metadata update",associateService:"Link service metadata",associateDataset:"Link dataset metadata",logoSelectionWindow:"Choose a logo",fileUploadWindow:"Upload data or document",selectedCRS:"Selected coordinate systems",foundCRS:"Available coordinate systems",search:"Search",restrictSearchToMap:"Restrict search to map extent",selected:"selected",selectRegion:"Select a region ...",drawRectangle:"Draw rectangle",drawPolygon:"Draw polygon",drawPolygonTT:"Click the button and draw a polygon by clicking on the map for each points. Double click to create polygon last points.",drawCircle:"Draw circle",discovery:"Discovery",visualization:"Visualization",when:"When ?",anyTime:"Anytime",onSelection:"On selection",adminAction:"Other",newMetadata:"New metadata",chooseTemplate:"Select a template",process:"Process",suggestions:"Suggestions",applySelected:"Apply selected task",processParametersWindow:"Task parameters",noSuggestion:"No suggestion.",thumbnailUploadWindow:"Upload thumbnail",addThumbnail:"Add",createSmall:"Create small thumbnail",scalingFactor:"Scaling factor",smallScalingFactor:"Small scaling factor",type:"Record type",clickToClose:"Click to close",removeSelected:"Remove selected",ownerName:"Metadata record owner",setPrivileges:"Set privileges",setCategories:"Set categories",massiveOp:"Batch operation ",prepareDownload:"Download files",mdMenu:"Actions",deleteRecord:"Delete metadata record ?",deleteConfirm:"Are you sure to delete this metadata record?",deleteRecordSuccess:"Metadata deleted.",deleteRecordFailure:"Error when deleting metadata record.",advancedSearchOptions:"Advanced criteria",relatedservices:"Related service",relatedchildren:"Children",relatedfcats:"Related feature catalogue",relatedhasfeaturecat:"Datasets",relatedsources:"Source datasets",getMEF:"Export (ZIP)",metadataCategories:"Metadata categories",validityInfo:"Validation status: ",lastUpdate:"Last update: ",importMetadata:"Import metadata",validationStatus:"Validation status",valid:"Valid",notValid:"Not valid",notDetermined:"Not determined",addToMap:"Add to map: ",downloadLink:"Download: ",webLink:"Web link: ",viewKml:"Open in GoogleEarth: ",layerTree:"Layer manager",mdResultsLayer:"Search results",printLayer:"Print page",relatedservices:"Related services",relatedparent:"Parent",relateddatasets:"Related datasets",relatedchildren:"Children",relatedrelated:"Feature catalogue/dataset link",delete19110Relation:"Remove feature catalogue relation",newWindow:"New window",addAsXLink:"Add as linked element",contactSelectionWindowTitle:"Contact selection",selectedContacts:"Selected contacts",foundContacts:"Available",contactRole:"Contact role",mapNearYou:"Center map on your location",errorChangeProtocol:"Remove uploaded file before changing protocol of an online resource.",resultBy:" result(s) / ",subTemplateImport:"Directory entry import",xmlData:"XML",minorEdit:"Minor edit",minorEditTT:"",runASearch:"Run a search.",focusOnAny:"Move focus to the full text search field.",hideSearchForm:"Hide or display search form.",switchMode:"Switch visualization mode.",resetSearchForm:"Reset search form.",focusOnLogin:"Focus on the login form to access catalogue administration or logout if already logged in.",openAdmin:"Go to administration",displayInfoPanel:"Display the information panel.",displayHelpPanel:"Display this help.",SelectionWindowTitle:"Select from directory",found:"Records found",selected:"Selected","add-extent-from-geokeywordsreplace":"Replace existing extent","add-info-from-wmssetExtent":"Set extent","add-info-from-wmssetAndReplaceExtent":"Replace existing extent","add-info-from-wmssetCRS":"Set coordinate reference system","add-info-from-wmssetDynamicGraphicOverview":"Set graphic overview (using GetMap request URL)","add-info-from-wmswmsServiceUrl":"Service URL","linked-data-checkerlinkUrl":"URL to remove","related-metadata-checkeruuidToRemove":"Identifier to remove","add-service-info-from-wxssetAndReplaceOperations":"Replace existing operations","add-service-info-from-wxswxsServiceUrl":"Service URL",manageDirectories:"Manage directories",directory:"Directory",thesaurusManager:"Thesaurus manager",Theme:"Theme",thesaurusFilePath:"Thesaurus file (.rdf)",ThesaurusName:"Thesaurus name",createThesaurusFromURL:"from URL",createThesaurusFromRepository:"from thesaurus repository",creationMode:"Create",thesaurusFromRepository:"Thesaurus",externalThesaurusURL:"URL",thesaurusCreation:"Add a thesaurus",Type:"Type",Activated:"Activated",emptyThesaurus:"New empty thesaurus",thesaurusFromFile:"From local file",thesaurusFromURL:"From remote file (URL)",id:"Identifier",label:"Label",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Label",newDefinition:"Definition",selDirectoryTT:"Select a type of directory. A directory group all elements having the same root element name (eg. gmd:CI_ResponsibleParty is a contact directory)",privTplElTT:"Manage privileges for the current selection.",addTplElTT:"Add an element from an XML fragment to a directory. The destination directory is based on the root element name (eg. gmd:CI_ResponsibleParty).",copyTplElTT:"Create a new entry in the directory from the current selection.",delTplElTT:"Remove selected entry from the directory."};
OpenLayers.Util.extend(OpenLayers.Lang.en,GeoNetwork.lang.en);Ext.namespace("GeoNetwork","GeoNetwork.Lang");GeoNetwork.Lang.fr={previousPage:"Page prcdente",nextPage:"Page suivante",upInPage:"Se dplacer vers le haut des rsultats",downInPage:"Se dplacer vers le bas des rsultats",example:"Exemple :",helper:"Suggestion :",toggleLayerManager:"Afficher le gestionnaire de couches",tagName:"Nom de l'lment :",enableTooltip:"Activer les info-bulles pour obtenir une description complte de chaque champs.",connectIssue:"chec de connexion au catalogue",connectIssueMsg:"Erreur 404. Impossible de se connecter  l'URL ",featureInfoTooltipTitle:"caractristique",featureInfoTooltipText:"Cliquer sur la carte pour obtenir des informations sur les donnes affichees.",zoomToMaxExtentTooltipTitle:"Zoom optimal",zoomToMaxExtentTooltipText:"Utiliser ce bouton pour tout afficher.",zoominTooltipTitle:"Zoomer",zoominTooltipText:"Dessiner un rectangle sur la carte pour zoomer. En cliquant sur la carte, le facteur de zoom est 2.",zoomoutTooltipTitle:"Dzoomer",zoomoutTooltipText:"Cliquer sur la carte ou dessiner un rectangle pour dzoomer.",dragTooltipTitle:"Main",dragTooltipText:"Appuyer sur le bouton gauche de la souris pour dplacer la carte.",previousTooltipTitle:"Revenir au zoom prcdant",previosTooltipText:"Cliquer ici pour revenir au zoom prcdant",nextTooltipTitle:"Zoom suivant",nextTooltipText:"Cliquer ici pour avancer au zoom suivant",featureInfoTitle:"Caractristique",layerManagerTabTitle:"Grer les couches",legendTabTitle:"Lgende",scaleTitle:"Echelle",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"Il n'existe pas de carte correspondant  la requte",WMSBrowserTab1:"Slectionner",WMSBrowserTab3:"Externe",WMSBrowserPreviewTitle:"Aperu de la couche",WMSBrowserAddButton:"Ajouter",WMSBrowserDuplicateMsg:"La couche est dj affiche",WMSBrowserPreviewWaitMsg:"Rcuprer l'image precedente",WMSBrowserConnectButton:"Connexion",WMSBrowserConnectError:"Erreur de connexion au service Web, merci de vrifier l'URL.",infoTitle:"Information","mf.print.mapTitle":"Titre","mf.print.comment":"Commentaire","mf.print.dpi":"Rsolution","mf.print.scale":"chelle","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Imprimer","mf.print.generatingPDF":"Gnrer PDF","mf.print.unableToPrint":"Impression impossible, essayer plus tard","mf.error":"Erreur",selectExtentTooltipTitle:"Dfinir une emprise",selectExtentTooltipText:"Dessiner une emprise  utiliser comme critre gographique",clearExtentTooltipTitle:"Supprimer l'emprise",clearExtentTooltipText:"Supprimer l'emprise (ie. aucun critre gographique)",printTooltipTitle:"Imprimer",printTooltipText:"Imprimer la carte actuelle",savewmcTooltipTitle:"Sauvegarder environnement (vue, paramtres,etc.)",savewmcTooltipText:"Sauvegarder environnement pour la carte actuelle","saveWMCFile.windowTitle":"Sauvegarder l'environnement","saveWMCFile.errorSaveWMC":"Sauvegarde de l'environnement impossible",loadwmcTooltipTitle:"Restaurer l'environnement",loadwmcTooltipText:"Restaurer l'environnement dans la carte actuelle","selectWMCFile.windowTitle":"Restaurer l'environnement",selectWMCFile:"Ouvrir un environnement","selectWMCFile.waitLoadingWMC":"Restauration de l'environnement en cours...","selectWMCFile.loadButtonText":"Charger","selectWMCFile.mergeButtonText":"Fusionner","selectWMCFile.errorLoadingWMC":"Chargement de l'environnement impossible",opacityButtonText:"Transparence",opacityWindowTitle:"Transparence",metadataButtonText:"Metadata",removeButtonText:"Supprimer",addWMSButtonText:"Ajouter WMS",addWMSWindowTitle:"Ajouter WMS","layerInfoPanel.windowTitle":"Couche metadata","layerInfoPanel.titleField":"Titre","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Requte",layerList:"Liste des couches","metadataResults.buttonText":"Rsultats Metadata","metadataResults.tooltipTitle":"rsultats Metadata","metadataResults.tooltipText":"Aller a la page des rsultats Metadata","metadataResults.alertTitle":"Rsultats Metadata","metadataResults.alertText":"Pas de rsultats Metadata","mf.information":"Imprimer","mf.print.pdfReady":"PDF prt","loadLayer.loadingMessage":"Chargement de la couche","loadLayer.error.title":"Charger la couche","loadLayer.error.message":"La couche ne peut tre charge","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Chargement...","disclaimer.buttonClose":"Fermer",gazetteerAddressField1Label:"Code postal",gazetteerAddressField2Label:"Street",gazetteerAddressField3Label:"Place",gazetteerAddressField4Label:"Municipalit",gazetteerAddressField5Label:"Numro",searchOptionButton:"Recherche",GazetteerWindowTitle:"Rsultat pour l'adresse",searchResults:"Recherche les rsultats",resetSearchForm:"Rinitialiser le formulaire de recherche.",errorTitle:"Erreur",SearchOptionLoadFailureMsg:"Pas de rsultats trouvs. \n Le serveur peut tre indisponible. \n",gazetteerTooltipTitle:"Recherche base sur l'adresse",gazetteerTooltipText:"Recherche du lieu, bas sur le code postal, la rue, la municipalit ou place.",SearchOptionNoResults:"Pas de rsultats trouvs.",zoomlayerTooltipTitle:"Zoom sur une couche",zoomlayerTooltipText:"Utilisez ce bouton pour accder  la pleine mesure de le calque slectionn.","zoomlayer.selectLayerTitle":"Zoom sur une couche","zoomlayer.selectLayerText":"No de calque slectionn",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Time position",WMSTimeMovieTitle:"Animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions",fullTextSearch:"Rechercher ...",keyword:"Mots-cls",org:"Organisation",mapTypes:"Type de donnes",rsIdentifier:"Identifiant de la ressource",inspireSearchOptions:"INSPIRE",inspireannex:"Annexe",inspirerelated:"Donnes soumises  INSPIRE",inspirerelatedtt:"Donnes dcrivant un rapport sur la conformit vis--vis des spcifications sur les donnes INSPIRE.",inspiretheme:"Thme",similarity:"Prcision",wkt:"Geomtrie WKT",spatialSearch:"Critres gographiques",mdChangeDate:"Date de mise  jour des mtadonnes",tempExtent:"tendue temporelle",hitsPerPage:"Nombre par page",sortBy:"Trier par",relevance:"Pertinence",title:"Titre",changeDate:"Date de mise  jour",rating:"Note",popularity:"Popularit",scaleDesc:"chelle (desc)",scaleAsc:"chelle (asc)","abstract":"Rsum",catalogue:"Catalogue",group:"Groupe",md:"Mtadonne",tpl:"Modle",category:"Catgorie",advTextSearch:"Options avances",eitherWords:"Tous - au moins un des mots suivants",exactPhrase:"Cette expression exacte",allWords:"Tous les mots suivants",withoutWords:"Aucun des mots suivants",precise:"Prcis",imprecise:"Flou",relationType:"Type de relation",within:" l'intrieur",touches:"Touche",crosses:"Travers",fullyOutsideOf:"En dehors",encloses:"Contient",overlaps:"Chevauche",intersection:"Intersecte",nearYou:" proximit",from:"du",to:"au",scaleNominator:"1/",scale:"chelle",digital:"Numrique",hardCopy:"Copie papier",download:"Tlcharger",downloadable:"Tlchargeable",interactive:"Interactive",resourceType:"Type de ressource",dataset:"Srie de donnes",series:"Ensemble de sries de donnes",service:"Service",spatialRepType:"Reprsentation spatiale",video:"Vido",vector:"Vecteur",textTable:"Tableau, Texte",tin:"Tin",stereoModel:"Vue 3D",grid:"Raster",kind:"Type",enterGetCapURL:"Saisir l'URL d'un GetCapabilities pour enregistrer un nouveau service",edit:"diter",duplicate:"Dupliquer","delete":"Supprimer",createChild:"Crer un enfant",privileges:"Privilges",categories:"Catgories",otherActions:"Autres actions",view:"Consulter",zoomTo:"Zoomer vers",saveXml:"Export (XML)",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",printSel:"Export (PDF)",printTT:"Imprimer. Ouvre une nouvelle page adapte  l'impression.",newOwner:"Associer un autre auteur",updateCategories:"Mettre  jour les catgories",updatePrivileges:"Mettre  jour les privilges",noneSelected:"Slection vide",none:"aucun",all:"tous",allInPage:"tous dans la page",select:"Selectionner ",username:"Identifiant",password:"Mot de passe",login:"Connexion",logout:"Dconnexion",administration:"Administration",validationReport:"Rapport de validation",status:"Status",items:"lments",item:"lment",thumbnails:"Aperus",noimages:"Aucun aperu disponible",add:"Ajouter",small:"Petit",large:"Grand",selectImage:"Slectionner une image",selectFile:"Slectionner un fichier",image:"Image",uploading:"Transfert en cours ...",upload:"Transfrer",success:"Succs",failure:"chec",error:"Erreur",save:"Sauver",reset:"Rinitialiser",fileProcessedMsg:"Traitement du fichier ${res} ralis sur le serveur",suggestion:"Suggestion",logoSelect:"Slectionner un logo",relatedResources:"Ressources associes",createLink:"Associer ...",featureCat:"Catalogue d'attributs",serviceMd:"Mtadonnes de service",datasetMd:"Mtadonnes de donnes",parentMd:"Parent",updateChildren:"Mettre  jour les enfants",records:"enregistrements",record:"enregistrement",help:"Aide",publishError:"chec lors de la publication.",outOfMemoryError:"rreur de dpassement de mmoire.",publishErrorCode:"Code rreur :",saveAndCheck:"Sauver et valider",saveAndClose:"Sauver et fermer",cancel:"Annuler",layout:"Mise en page",Resolution:"Rsolution",collapseAll:"Rduire les sections",editAttributes:"Grer les attributs",chooseAType:"Choisir un type",chooseAView:"Choisir une vue",viewMode:"Affichage",errorAndStatusMsg:"rreur. Status : ${status}, description : ${text}. Essayer  nouveau.",mdEditor:"Editeur de mtadonne",editing:"${title} (${uuid}) en cours d'dition",GetCapabilitiesDocumentError:"Erreur lors de la tentative de rcupration des informations du service (ie. GetCapabilities) avec l'adresse: ",maxResults:"Nombre de rsultats",mdTitle:"Titre de la mtadonne",keywords:"Mots-cls",createRelation:"Crer la relation",createIfNotExistButton:"Crer une nouvelle mtadonne",getCapabilitiesLayer:"Couches du GetCapabilities",layerName:"Nom de la couche",searching:"Recherche en cours ...",perThesaurus:" par thesaurus",anyThesaurus:"Tous les thsaurus",selectedKeywords:"Mots cls selectionns",foundKeywords:"Mots cls trouvs",clear:"Effacer",publish:"Publier",publishTooltip:"Publier le jeu de donnes en cours dans le nud distant. Si le jeu de donnes est prsent, il est mis  jour.",publishSuccess:"Publication effectue.",publishLayerAdded:" Couche ajoute  la carte.",unpublish:"Dpublier",unpublishTooltip:"Supprimer le jeu de donnes en cours dans le nud distant.",unpublishSuccess:"Dpublication effectue.",unpublishError:"Echec de la dpublication. ",check:"Vrifier",errorDatasetNotFound:"Jeu de donnes non trouv.",datasetFound:"Jeu de donnes trouv et ajout  la carte.",checkFailure:"Echec de la vrification de la prsence du jeu de donnes dans le nud distant.",addOnlineSourceTitle:"Lier le service  la fiche",addOnlineSource:"Ajouter les liens",addOnlineSourceTT:"Ajouter les informations pour faire la liaison avec la couche dans le service WMS/WFS/WCS.",statusInformation:"Status.",publishing:"Publication en cours ...",mapPreview:"Carte",selectANode:"Choisir un nud ...",geoPublisherWindowTitle:"Go-publication : ",keywordSelectionWindowTitle:"Slection de mots cls",crsSelectionWindowTitle:"Slection des systmes de coordonnes",linkedMetadataSelectionWindowTitle:"Slection des mtadonnes associes",NotOwnerError:"Vous n'avez pas les privilges pour mettre  jour la mtadonne associe.",ServiceUpdateError:"Erreur lors de la mise  jour de la mtadonne.",associateService:"Associer une mtadonne de service",associateDataset:"Associer une mtadonne de donnes",logoSelectionWindow:"Slectionner un logo",fileUploadWindow:"Ajouter des donnes ou des documents",selectedCRS:"Systmes slectionns",foundCRS:"Systmes disponibles",search:"Rechercher",restrictSearchToMap:"Restreindre la recherche  la carte",selected:"slectionn(s)",selectRegion:"Choisir une rgion ...",drawRectangle:"Crer un rectangle",drawPolygon:"Crer un polygone",drawCircle:"Crer un cercle",discovery:"Dcouverte",visualization:"Visualisation",when:"Critres temporels",anyTime:"N'importe quand",onSelection:"Sur la slection",adminAction:"Autres",newMetadata:"Nouvelle mtadonne",chooseGroup:"Selectionner un groupe",chooseTemplate:"Slectionner un modle",process:"Traiter",suggestions:"Suggestions",applySelected:"Appliquer le traitement slectionn",processParametersWindow:"Paramtres du traitement",noSuggestion:"Aucune suggestion.",thumbnailUploadWindow:"Ajouter un aperu",addThumbnail:"Ajouter",createSmall:"Crer un petit aperu",scalingFactor:"Facteur d'chelle",smallScalingFactor:"Facteur d'chelle",type:"Type de fiche",clickToClose:"Cliquer pour fermer",removeSelected:"Supprimer la slection","metadata.update.new":"Chargement en cours ...","metadata.update.forget.new":"R-initialisation en cours ...",ownerName:"Rdacteur de la mtadonne",setPrivileges:"Dfinir les privilges",setCategories:"Choisir les catgories",massiveOp:"Opration sur la slection",prepareDownload:"Tlcharger les fichiers",mdMenu:"Actions",simpleViewMode:"Vue simplifie",deleteRecord:"Supprimer la mtadonne ?",deleteConfirm:"Confirmez-vous la suppression de la mtadonne ?",deleteRecordSuccess:"Metadonne supprime",deleteRecordFailure:"chec lors de la suppression de la mtadonne",advancedSearchOptions:"Critres avancs",getMEF:"Export (ZIP)",metadataCategories:"Catgories",validityInfo:"Information sur la validation",lastUpdate:"Dernire mise  jour : ",importMetadata:"Import de mtadonnes",validationStatus:"Validation ",valid:"Valide",notValid:"Non valide",notDetermined:"Non dtermin",addToMap:"Ajouter  la carte : ",downloadLink:"Tlcharger : ",webLink:"Site web : ",viewKml:"Visualiser avec GoogleEarth : ",layerTree:"Gestion des couches",mdResultsLayer:"Rsultats de la recherche",printLayer:"Page de l'impression",relatedservices:"Services associs",relatedparent:"Mtadonne parent",relateddatasets:"Mtadonnes associes",relatedchildren:"Enfants",relatedrelated:"Relation catalogue d'attributs/donnes",relatedfcats:"Relation catalogue d'attributs/donnes",relatedhasfeaturecat:"Donne",relatedsources:"Donnes sources",delete19110Relation:"Supprimer le lien cat. d'attributs",newWindow:"Nouvelle fentre",addAsXLink:"Ajout d'un lment li",contactSelectionWindowTitle:"Slection des contacts",selectedContacts:"Contacts slectionns",foundContacts:"Contacts disponibles",contactRole:"Rle du contact",mapNearYou:"Centrer la carte sur votre position",create:"Crer",errorChangeProtocol:"Impossible de changer le protocol lorsqu'un fichier est attach. Supprimer le fichier.",resultBy:" resultat(s) / ",subTemplateImport:"Importer un lment dans un annuaire",xmlData:"XML",minorEdit:"Modif. mineure",minorEditTT:"Lorsque cette option est active, la date de mise  jour des mtadonnes n'est pas change. Lors de l'utilisation des suggestions, ou de la mise  jour d'une imagette, cette option est sans effet, la date est mise  jour.",runSearch:"Lancer la recherche.",focusOnAny:"Dplacer le curseur sur le critre plein texte.",hideSearchForm:"Afficher ou cacher le formulaire de recherche.",switchMode:"Changer de mode de visualisation.",resetSearchForm:"Rinitialiser le formulaire de recherche.",focusOnLogin:"Dplacer le curseur sur le formulaire de connexion ou dconnexion si vous tes connect.",openAdmin:"Administrer le catalogue",displayInfoPanel:"Afficher la page d'information.",displayHelpPanel:"Afficher cette page d'aide.",SelectionWindowTitle:"Rechercher dans l'annuaire",found:"Enregistrements trouvs","add-extent-from-geokeywordsreplace":"Remplacer les tendues gographiques existantes","add-info-from-wmssetExtent":"Dfinir l'tendue","add-info-from-wmssetAndReplaceExtent":"Remplacer les tendues existantes","add-info-from-wmssetCRS":"Ajouter les systmes de coordonnes","add-info-from-wmssetDynamicGraphicOverview":"Dfinir l'aperu (en ajoutant une URL vers une requte GetMap)","add-info-from-wmswmsServiceUrl":"URL du service","linked-data-checkerlinkUrl":"Lien  supprimer","related-metadata-checkeruuidToRemove":"Identifiant  supprimer","add-service-info-from-wxssetAndReplaceOperations":"Remplacer les oprations existantes","add-service-info-from-wxswxsServiceUrl":"URL du service",manageDirectories:"Gestion des annuaires",directory:"Annuaire",thesaurusManager:"Gestion des thsaurus",Theme:"Thme",thesaurusFilePath:"Fichier (.rdf)",ThesaurusName:"Nom du thsaurus",createThesaurusFromURL:"A partir d'une URL",createThesaurusFromRepository:"A partir du dpt partag",creationMode:"Crer",thesaurusFromRepository:"Thsaurus",externalThesaurusURL:"URL",thesaurusCreation:"Ajout d'un thsaurus",Type:"Type",Activated:"Activ",emptyThesaurus:"Nouveau thsaurus vide",thesaurusFromFile:"A partir d'un fichier local",thesaurusFromURL:"A partir d'un fichier distant (URL)",id:"Identifiant",label:"Libell",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Libell",newDefinition:"Dfinition",selDirectoryTT:"Choisir un type d'annuaire. Un annuaire est constitu d'lments ayant la mme balise racine (eg. les lments gmd:CI_ResponsibleParty font partie de l'annuaire de contact)",privTplElTT:"Grer les privilges sur la slection.",addTplElTT:"Ajouter un lment  partir d'un fragment d'XML. L'annuaire cible est bas sur le nom de la balise racine (eg. gmd:CI_ResponsibleParty).",copyTplElTT:"Crer un nouvel lment dans l'annuaire  partir de l'lment slectionn.",delTplElTT:"Supprimer la slection."};
OpenLayers.Util.extend(OpenLayers.Lang.fr,GeoNetwork.Lang.fr);Ext.namespace("GeoNetwork","GeoNetwork.Lang");GeoNetwork.Lang.nl={featureInfoTooltipTitle:"Attribuut-informatie",featureInfoTooltipText:"Klik in de kaart om attribuut-informatie op te vragen van alle zichtbare lagen.",zoomToMaxExtentTooltipTitle:"Volledig kaartbeeld",zoomToMaxExtentTooltipText:"Klik op deze button om naar het volledig kaartbeeld te zoomen.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Trek een kader in kaart om in te zoomen. Ook kan er geklikt worden in de kaart waarna er met een factor 2 ingezoomd wordt.",zoomoutTooltipTitle:"Zoom uit",zoomoutTooltipText:"Klik in de kaart om gecentreerd op dit punt met een factor 2 uit te zoomen. Ook kan er een kader in de kaart getrokken worden, hoe kleiner dit kader hoe verder er uitgezoomd zal worden.",dragTooltipTitle:"Verschuif kaart",dragTooltipText:"Houd de linker muisknop ingedrukt en versleep de kaart.",previousTooltipTitle:"Vorige kaart extent",previosTooltipText:"Klik op deze button om terug te gaan naar de vorige kaart extent",nextTooltipTitle:"Volgende kaart extent",nextTooltipText:"Klik op deze button om verder te gaan naar de volgende kaart extent",featureInfoTitle:"Attribuut-informatie",layerManagerTabTitle:"Kaartlagenbeheer",legendTabTitle:"Legenda",scaleTitle:"Schaal",xTitle:"X",yTitle:"Y",projectionTitle:"Projectie",FeatureInfoNotQueryable:"Er is geen bevraagbare kaartlaag",WMSBrowserTab1:"Selecteren",WMSBrowserTab3:"Extern",WMSBrowserPreviewTitle:"Preview kaartlaag",WMSBrowserAddButton:"Voeg toe",WMSBrowserDuplicateMsg:"Kaartlaag is reeds aanwezig.",WMSBrowserPreviewWaitMsg:"Preview image ophalen",WMSBrowserConnectButton:"Maak verbinding",WMSBrowserConnectError:"Er is een fout opgetreden bij het maken van de verbinding, controleer de URL.",infoTitle:"Informatie","mf.print.mapTitle":"Titel","mf.print.comment":"Opmerkingen","mf.print.dpi":"Resolutie","mf.print.scale":"Schaal","mf.print.rotation":"Rotatie","mf.print.resetPos":"Terug naar begininstellingen","mf.print.print":"Print","mf.print.generatingPDF":"Aanmaken PDF","mf.print.unableToPrint":"Het was helaas niet mogelijk om te printen, probeert u het svp later nogmaals","mf.error":"Fout",selectExtentTooltipTitle:"Begrens zoekgebied",selectExtentTooltipText:"Begrens het zoekgebied door in de kaart een kader te trekken.",printTooltipTitle:"Print",printTooltipText:"Print de huidige kaart",savewmcTooltipTitle:"Opslaan WMC",savewmcTooltipText:"Sla een Web Map Context document op.","saveWMCFile.windowTitle":"Opslaan Web Map Context","saveWMCFile.errorSaveWMC":"Kon het WMC bestand niet opslaan",loadwmcTooltipTitle:"Open WMC",loadwmcTooltipText:"Opent een bestaand Web Map Context document in de kaart viewer","selectWMCFile.windowTitle":"Openen Web Map Context",selectWMCFile:"Select WMC bestand","selectWMCFile.waitLoadingWMC":"Laden Web Map Context","selectWMCFile.loadButtonText":"Openen","selectWMCFile.mergeButtonText":"Samenvoegen","selectWMCFile.errorLoadingWMC":"Kon het Web Map Context bestand niet openen",opacityButtonText:"Opaciteit",opacityWindowTitle:"Opaciteit",metadataButtonText:"Metadata",removeButtonText:"Verwijderen",addWMSButtonText:"Voeg WMS toe",addWMSWindowTitle:"Voeg WMS toe","layerInfoPanel.windowTitle":"Metadata van de kaartlaag","layerInfoPanel.titleField":"Titel","layerInfoPanel.descriptionField":"Samenvatting","layerInfoPanel.queryableField":"Bevraagbaar",layerList:"Kaartlagen",baseLayerList:"Ondergrond","metadataResults.buttonText":"Metadata resultaten","metadataResults.tooltipTitle":"Metadata resultaten","metadataResults.tooltipText":"Ga naar de metadata resultaatpagina","metadataResults.alertTitle":"Metadata resultaten","metadataResults.alertText":"Geen metadata resultaten om te tonen","featureInfoWindow.windowTitle":"Attribuut-informatie","mf.information":"Print","mf.print.pdfReady":"PDF gereed","loadLayer.loadingMessage":"Ophalen kaartlaag","loadLayer.error.title":"Ophalen kaartlaag","loadLayer.error.message":"De kaartlaag kon niet worden geladen","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Laden...","disclaimer.buttonClose":"Sluiten",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Straat",gazetteerAddressField3Label:"Plaats",gazetteerAddressField4Label:"Gemeente",gazetteerAddressField5Label:"Huisnummer",searchOptionButton:"Zoek",GazetteerWindowTitle:"Zoek adres",searchResults:"Zoekresultaten",errorTitle:"Fout",SearchOptionLoadFailureMsg:"Het is niet gelukt resultaten op te halen.\nMogelijk is de service tijdelijk niet beschikbaar. \n",gazetteerTooltipTitle:"Zoek op basis van een adres",gazetteerTooltipText:"Zoek een locatie op basis van een postcode, straatnaam, gemeente en/of plaats.",SearchOptionNoResults:"Geen resultaten gevonden",zoomlayerTooltipTitle:"Zoom naar laag",zoomlayerTooltipText:"Gebruik deze knop om naar de volledige omvang van de geselecteerde laag.","zoomlayer.selectLayerTitle":"Zoom naar laag","zoomlayer.selectLayerText":"Geen laag geselecteerd",layerStylesWindowTitle:"Kaartlaag stijlen",layerStylesPreviewTitle:"Maak een voorvertoning van de legenda",selectStyleButton:"Selecteer kaartstijl",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Kies een tijdstip",WMSTimeMovieTitle:"Speel een animatie af",wmsTimeUpdateButtonText:"Doorvoeren",WMSTimeAnimationCheckbox:"Speel laatste ${steps} tijdstippen af"};OpenLayers.Util.extend(OpenLayers.Lang.nl,GeoNetwork.Lang.nl);Ext.namespace("GeoNetwork");GeoNetwork.Lang={};GeoNetwork.Util={defaultLocale:"en",locales:[["ar","","ara"],["ca","Catal","cat"],["cn","","chi"],["de","Deutsch","ger"],["en","English","eng"],["es","Espaol","spa"],["fr","Franais","fre"],["nl","Nederlands","dut"],["no","Norsk","nor"],["pt","ortugus","por"],["ru","","rus"]],setLang:function(a,d){a=a||GeoNetwork.Util.defaultLocale;OpenLayers.Lang.setCode(a);var b=document.createElement("script");b.type="text/javascript";b.src=d+"/js/ext/src/locale/ext-lang-"+a+".js";document.getElementsByTagName("head")[0].appendChild(b);},getCatalogueLang:function(b){var a;for(a=0;a<GeoNetwork.Util.locales.length;a++){if(GeoNetwork.Util.locales[a][0]===b){return GeoNetwork.Util.locales[a][0];}}return GeoNetwork.Util.defaultLocale;},getISO3LangCode:function(b){var a;for(a=0;a<GeoNetwork.Util.locales.length;a++){if(GeoNetwork.Util.locales[a][0]===b){return GeoNetwork.Util.locales[a][2];}}return"eng";},getParameters:function(d){var e=OpenLayers.Util.getParameters(d);if(OpenLayers.String.contains(d,"#")){var f=d.indexOf("#")+1;var h=d.length;var b=d.substring(f,h);var g=b.split(/[\/]/);for(var l=0,m=g.length;l<m;++l){var j=g[l].split("=");var a=j[0];var o=j[1]||"";e[a]=o;}}return e;},getBaseUrl:function(a){return a.substring(0,a.indexOf("?")||a.indexOf("#")||a.length);}};Ext.namespace("GeoNetwork");GeoNetwork.Catalogue=Ext.extend(Ext.util.Observable,{SERVERURL:null,URL:null,LANG:"en",DEFAULT_LANG:"en",EDITOR_MODE:{IN_OTHER_WINDOW:1,IN_EDITOR_POPUP:2},editMode:1,hostUrl:null,servlet:null,extentMap:null,services:{},windowOption:"menubar=no,location=no,toolbar=no,directories=no",windowName:"",startRecord:1,mdStore:null,summaryStore:null,statusBarId:null,mdDisplayPanelId:undefined,resultsView:undefined,mdOverlayedCmpId:undefined,identifiedUser:undefined,adminUser:false,metadataEditFn:undefined,adminAppUrl:"",selectedRecords:0,constructor:function(a){a=a||{};Ext.apply(this,a);if(this.hostUrl){if(this.hostUrl.indexOf("http")===-1){this.hostUrl=window.location.href.match(/http.*\//,"")+this.hostUrl;}this.SERVERURL=this.hostUrl;}else{this.SERVERURL="http://"+window.location.host+"/";}if(this.hostUrl){this.URL=this.SERVERURL;}else{if(this.servlet){this.URL=this.SERVERURL+this.servlet;}else{this.URL=this.SERVERURL+"geonetwork";}}this.LANG=(this.lang?this.lang:this.DEFAULT_LANG);var b=this.URL+"/srv/"+this.LANG+"/";this.services={rootUrl:b,csw:b+"csw",xmlSearch:b+"xml.search",mdSelect:b+"metadata.select",mdView:b+"view",mdXMLInsert:b+"xml.metadata.insert",mdShow:b+"metadata.show.embedded",mdMEF:b+"mef.export",mdXMLGet:b+"xml.metadata.get",mdXMLGet19139:b+"xml_iso19139",mdXMLGetDC:b+"xml_dublin-core",mdXMLGetFGDC:b+"xml_fgdc-std",mdXMLGet19115:b+"xml_iso19115to19139",mdDuplicate:b+"metadata.duplicate.form",mdDelete:b+"metadata.delete",mdPrint:b+"pdf",mdEdit:b+"edit",mdCreate:b+"metadata.create.new",mdUpdate:b+"metadata.update.new",mdProcessingXml:b+"xml.metadata.processing",mdProcessing:b+"metadata.processing.new",mdMassiveChildrenForm:b+"metadata.batch.children.form",mdAdmin:b+"metadata.admin.form",mdValidate:b+"xml.metadata.validate",mdSuggestion:b+"metadata.suggestion",mdCategory:b+"metadata.category.form",mdRelationInsert:b+"xml.relation.insert",mdRelationDelete:b+"xml.relation.delete",mdRelation:b+"xml.relation",mdGetThumbnail:b+"metadata.thumbnail",mdSetThumbnail:b+"metadata.thumbnail.set.new",mdUnsetThumbnail:b+"metadata.thumbnail.unset.new",mdImport:b+"metadata.xmlinsert.form",subTemplateType:b+"subtemplate.types",subTemplate:b+"subtemplate",upload:b+"resources.upload.new",prepareDownload:b+"prepare.file.download",fileDisclaimer:b+"file.disclaimer",fileDownload:b+"file.download",geopublisher:b+"geoserver.publisher",login:b+"xml.user.login",logout:b+"xml.user.logout",mef:b+"mef.export?format=full&version=2",csv:b+"csv.search",pdf:b+"pdf.selection.search",harvestingStart:b+"xml.harvesting.start",harvestingStop:b+"xml.harvesting.stop",harvestingRun:b+"xml.harvesting.run",harvestingAdd:b+"xml.harvesting.add",harvestingUpdate:b+"xml.harvesting.update",harvestingRemove:b+"xml.harvesting.remove",thesaurusAdd:b+"thesaurus.add",thesaurusActivate:b+"thesaurus.activate",thesaurusDelete:b+"thesaurus.delete",thesaurusUpload:b+"xml.thesaurus.upload",thesaurusDownload:b+"thesaurus.download",thesaurusConceptAdd:b+"thesaurus.addelement",thesaurusConceptUpdate:b+"thesaurus.updateelement",thesaurusConceptDelete:b+"thesaurus.deleteelement",getIcons:b+"xml.harvesting.info?type=icons",opensearchSuggest:b+"main.search.suggest",massiveOp:{NewOwner:b+"metadata.batch.newowner.form",Categories:b+"metadata.batch.category.form",Delete:b+"metadata.batch.delete",Privileges:b+"metadata.batch.admin.form"},metadataMassiveUpdatePrivilege:b+"metadata.batch.update.privileges",metadataMassiveUpdateCategories:b+"metadata.batch.update.categories",getGroups:b+"xml.info?type=groups",getRegions:b+"xml.info?type=regions",getSources:b+"xml.info?type=sources",getUsers:b+"xml.info?type=users",getSiteInfo:b+"xml.info?type=site",schemaInfo:b+"xml.schema.info",getZ3950repositories:b+"xml.info?type=z3950repositories",getCategories:b+"xml.info?type=categories",getHarvesters:b+"xml.harvesting.get",rate:b+"xml.metadata.rate",xmlConfig:b+"xml.config.get",admin:b+"admin",xmlError:b+"xml.main.error",searchKeyword:b+"xml.search.keywords",getThesaurus:b+"xml.thesaurus.getList",getKeyword:b+"xml.keyword.get",searchCRS:b+"crs.search",getCRSTypes:b+"crs.types",logoAdd:b+"logo.add",logoUrl:this.URL+"/images/logos/",imgUrl:this.URL+"/images/",harvesterLogoUrl:this.URL+"/images/harvesting/"};
this.extentMap=new GeoNetwork.map.ExtentMap();this.addEvents("selectionchange","afterLogin","afterLogout","afterBadLogin","afterBadLogout","afterDelete");GeoNetwork.Catalogue.superclass.constructor.call(this,a);},setServiceUrl:function(b,a){this.services[b]=this.services.rootUrl+a;},isIdentified:function(){return !this.identifiedUser?false:true;},isAdmin:function(){return this.adminUser;},onAfterLogin:function(){this.fireEvent("afterLogin",this,this.isIdentified());},onAfterBadLogin:function(){this.fireEvent("afterBadLogin",this,this.isIdentified());},onAfterLogout:function(){this.fireEvent("afterLogout",this,this.isIdentified());},onAfterBadLogout:function(){this.fireEvent("afterBadLogout",this,this.isIdentified());},onAfterDelete:function(){this.fireEvent("afterDelete",this);},onAfterRating:function(){this.fireEvent("afterRating",this);},setSelectedRecords:function(a){this.selectedRecords=parseInt(a,10);this.onSelectionChange();},getSelectedRecords:function(){return this.selectedRecords;},onSelectionChange:function(){this.fireEvent("selectionchange",this,this.getSelectedRecords());},getInfo:function(){var b={};var e=["name","organization","siteId"];var a=OpenLayers.Request.GET({url:this.services.getSiteInfo,async:false});if(a.responseXML){var d=a.responseXML.documentElement;Ext.each(e,function(g,f){b[g]=d.getElementsByTagName(g)[0].childNodes[0].nodeValue;});}return b;},updateStatus:function(b){if(this.statusBarId){var a=Ext.getCmp(this.statusBarId);if(a){a.update(b);return;}a=Ext.getDom(this.statusBarId);if(a){a.innerHTML=b;return;}}},search:function(l,a,f,d,b,j,g,h){var e=this.metadataStore===j;if(e){this.updateStatus(OpenLayers.i18n("searching"));}if(b!==false){b=true;}if(!d){d=this.startRecord;}if(!a){a=Ext.emptyFn;}if(!f){f=Ext.emptyFn;}if(j===undefined){j=this.metadataStore;}if(g===undefined){g=this.summaryStore;}if(b){j.removeAll();}if(typeof l==="object"){GeoNetwork.util.SearchTools.doQueryFromParams(l,this,d,a,f,b,j,g,h);}else{GeoNetwork.util.SearchTools.doQueryFromForm(l,this,d,a,f,b,j,g,h);}},kvpSearch:function(h,j,e,b,g,a,f,d){if(g!==false){g=true;}if(!b){b=this.startRecord;}if(!j){j=Ext.emptyFn;}if(!e){e=Ext.emptyFn;}if(!a){a=this.metadataStore;}if(!f){f=this.summaryStore;}if(g){a.removeAll();}GeoNetwork.util.SearchTools.doQuery(h,this,b,j,e,g,a,f,d);},cswSearch:function(b,a,e,d){this.metadataCSWStore.removeAll();if(a){a=Ext.emptyFn;}if(e){e=Ext.emptyFn;}if(d){d=this.startRecord;}GeoNetwork.util.CSWSearchTools.doCSWQueryFromForm(b,this,d,a,null,e);},metadataSelect:function(a,e){this.setSelectedRecords(0);var b=this;var d=0;for(d=0;d<e.length;d++){OpenLayers.Request.GET({url:this.services.mdSelect,params:{id:e[d],selected:a},success:function(g){var f=g.responseXML.documentElement.getElementsByTagName("Selected")[0].childNodes[0].nodeValue;if(f){b.setSelectedRecords(f);}},failure:function(f){Ext.Msg.alert("Selection failed",f.responseText);}});}},metadataRate:function(d,b,a){OpenLayers.Request.GET({url:this.services.rate,params:{uuid:d,rating:b},success:function(f){var e=f.responseXML.documentElement.childNodes[0].nodeValue;if(a){a(e);}catalogue.onAfterRating();return e;},failure:function(e){Ext.Msg.alert("Rating failed",e.responseText);}});},metadataSelectAll:function(a){this.metadataSelection("add-all",a);},metadataSelectNone:function(a){this.metadataSelection("remove-all",a);},metadataSelection:function(b,a){var d=this;OpenLayers.Request.GET({url:this.services.mdSelect,params:{selected:b},success:function(f){var e=f.responseXML.documentElement.getElementsByTagName("Selected")[0].childNodes[0].nodeValue;if(e){d.setSelectedRecords(e);}if(a){a();}},failure:function(e){}});},csvExport:function(){window.open(this.services.csv,this.windowName,this.windowOption);},mefExport:function(){location.replace(this.services.mef);},pdfExport:function(){location.replace(this.services.pdf);},metadataShow:function(f,j,h,e){var g=this.services.mdView+"?uuid="+escape(f);var b=Ext.getBody();if(this.resultsView){var l=this.metadataStore.getAt(this.metadataStore.find("uuid",f));if(!l){var d=GeoNetwork.data.MetadataResultsFastStore();this.kvpSearch("fast=index&_uuid="+f,null,null,null,true,d,null,false);l=d.getAt(d.find("uuid",f));}var a=new GeoNetwork.view.ViewWindow({serviceUrl:g,lang:this.lang,currTab:GeoNetwork.defaultViewMode||"simple",printDefaultForTabs:GeoNetwork.printDefaultForTabs||false,catalogue:this,maximized:j||false,metadataUuid:f,record:l,resultsView:this.resultsView});a.show(this.resultsView);a.alignTo(b,"tr-tr");}else{window.open(this.services.mdShow+"?uuid="+f,this.windowName,this.windowOption);}},metadataShowById:function(j,d,g,a){var f=this.services.mdView+"?id="+j,b;if(this.resultsView){if(!b){var e=GeoNetwork.data.MetadataResultsFastStore();this.kvpSearch("fast=index&_id="+j,null,null,null,true,e,null,false);b=e.getAt(e.find("id",j));}var h=new GeoNetwork.view.ViewWindow({serviceUrl:f,currTab:GeoNetwork.defaultViewMode||"simple",catalogue:this,maximized:d||false,record:b,metadataUuid:b.get("uuid"),resultsView:this.resultsView});h.show(this.resultsView);h.alignTo(Ext.getBody(),"r-r");}},metadataXMLShow:function(a,b){var d=this.services.mdXMLGet;if(b==="iso19139"){d=this.services.mdXMLGet19139;}else{if(b==="dublin-core"){d=this.services.mdXMLGetDC;}else{if(b==="fgdc"){d=this.services.mdXMLGetFGDC;}else{if(b==="iso19115"){d=this.services.mdXMLGet19115;}}}}var e=d+"?uuid="+a;window.open(e,this.windowName,this.windowOption);},metadataPrint:function(b){var a=this.services.mdPrint+"?uuid="+b;location.replace(a);},metadataMEF:function(b){var a=this.services.mdMEF+"?version=2&uuid="+b;location.replace(a);},metadataEdit:function(d,f,a,b,e){switch(this.editMode){case this.EDITOR_MODE.IN_EDITOR_POPUP:if(this.metadataEditFn){this.metadataEditFn(d,f,a,b,e);}break;default:window.open(this.services.mdEdit+"?id="+d,this.windowName,this.windowOption);}},metadataDuplicate:function(a){window.open(this.services.mdDuplicate+"?uuid="+a,this.windowName,this.windowOption);},metadataCreateChild:function(a){window.open(this.services.mdDuplicate+"?child=y&uuid="+a,this.windowName,this.windowOption);},metadataDuplicateWithSchema:function(a,b){window.open(this.services.mdDuplicate+"?uuid="+a+"&schema="+b,this.windowName,this.windowOption);},metadataDelete:function(a){Ext.Msg.confirm(OpenLayers.i18n("deleteRecord"),OpenLayers.i18n("deleteConfirm"),this.metadataDeleteDo,a);},metadataDeleteDo:function(a){if(a==="yes"){var b={uuid:this};catalogue.doAction(catalogue.services.mdDelete,b,OpenLayers.i18n("deleteRecordSuccess"),OpenLayers.i18n("deleteRecordFailure"),catalogue.onAfterDelete.bind(catalogue));}},doAction:function(d,a,b,f,g,e){if(d.indexOf("http")===-1){d=this.services.rootUrl+d;}OpenLayers.Request.GET({url:d,params:a,success:function(h){if(b){Ext.Msg.alert(b,h.responseText);}if(g){g(h);}},failure:function(h){if(f){Ext.Msg.alert(f,h.responseText);}if(e){e(h);}}});},isLoggedIn:function(){var b=OpenLayers.Request.GET({url:this.services.admin,async:false}),a;a=b.responseText.indexOf("Exception")!==-1;if(b.status===200&&!a){this.identifiedUser={firstName:"",surName:"",role:""};this.onAfterLogin();return true;}else{if(b.status===404){this.showError(OpenLayers.i18n("connectIssue"),OpenLayers.i18n("connectIssueMsg")+this.services.rootUrl+".");}else{if(a){this.checkError();return false;}else{var d=Ext.state.Manager.getProvider();if(d){d.set("user",undefined);}return false;}}}},login:function(b,e){var a=this,d;OpenLayers.Request.GET({url:this.services.login,params:{username:b,password:e,info:"true"},success:function(f){d=f.responseXML.getElementsByTagName("record")[0];a.identifiedUser={username:d?d.getElementsByTagName("username")[0].firstChild.nodeValue:"-",name:d?d.getElementsByTagName("name")[0].firstChild.nodeValue:"-",surname:d?d.getElementsByTagName("surname")[0].firstChild.nodeValue:"-",role:d?d.getElementsByTagName("profile")[0].firstChild.nodeValue:"guest"};a.onAfterLogin();},failure:function(f){a.identifiedUser=undefined;a.onAfterBadLogin();}});},logout:function(){var a=this;
OpenLayers.Request.GET({url:this.services.logout,success:function(b){a.identifiedUser=undefined;a.onAfterLogout();},failure:function(b){a.identifiedUser=undefined;a.onAfterBadLogout();}});},checkError:function(e){var b=this,d,a;OpenLayers.Request.GET({url:this.services.xmlError,success:function(f){d=b.parseError(f.responseXML);a=d.info+" "+d.exc+"<br/>"+d.stack;b.showError("Catalogue error",a);if(e){e(b,f);}},failure:function(f){b.showError("Catalogue error",f.status);}});},showError:function(b,a){Ext.MessageBox.show({title:b,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});},parseError:function(b){var a=b.getElementsByTagName("error")[0];return{stack:a.getElementsByTagName("Stack")[0].firstChild.nodeValue,exc:a.getElementsByTagName("Exception")[0].firstChild.nodeValue,resource:a.getElementsByTagName("Resource")[0].firstChild.nodeValue,msg:a.getElementsByTagName("Message")[0].firstChild.nodeValue,provider:a.getElementsByTagName("Provider")[0].firstChild.nodeValue,info:a.getElementsByTagName("Error")[0].firstChild.nodeValue};},admin:function(){location.replace(this.adminAppUrl);},metadataImport:function(){location.replace(this.services.mdImport);},massiveOp:function(a,b){var d=this.services.massiveOp[a];this.modalAction(OpenLayers.i18n("massiveOp")+" - "+a,d,b);},modalAction:function(b,e,d){if(e){var a=new Ext.Window({id:"modalWindow",layout:"fit",width:700,height:400,closeAction:"destroy",plain:true,modal:true,draggable:false,title:b,items:new Ext.Panel({autoLoad:{url:e,callback:d,scope:a},border:false,frame:false})});a.show(this);a.alignTo(Ext.getBody(),"t-t");}},metadataAdmin:function(b){var a=this.services.mdAdmin+"?id="+b;this.modalAction(OpenLayers.i18n("setPrivileges"),a);},metadataCategory:function(b){var a=this.services.mdCategory+"?id="+b;this.modalAction(OpenLayers.i18n("setCategories"),a);},metadataPrepareDownload:function(b){var a=this.services.prepareDownload+"?id="+b;this.modalAction(OpenLayers.i18n("prepareDownload"),a);}});Ext.reg("gn_catalogue",GeoNetwork.Catalogue);Ext.namespace("GeoNetwork.util");GeoNetwork.util.HelpTools={fields:[{name:"name",mapping:"@name"},{name:"id",mapping:"@id"},{name:"label"},{name:"description"},{name:"help",convert:function(d,b){var g=[],f,e;var a=b.getElementsByTagName("help");for(f=0;f<a.length;f++){var h=a[f].getElementsByTagName("p");if(h.length!==0){for(e=0;e<a.length;e++){g.push(h[e].firstChild.nodeValue);}}else{if(a[f].firstChild){g.push(a[f].firstChild.nodeValue);}}}return g;}},{name:"example"},{name:"helper",convert:function(e,b){var g=[],h,f;var d=b.getElementsByTagName("helper");if(d.length===1){var a=d[0].getElementsByTagName("option");for(f=0;f<a.length;f++){g.push({title:a[f].getAttribute("title"),label:a[f].firstChild.nodeValue,value:a[f].getAttribute("value")});}}return g;}}],Templates:{SIMPLE:['<div class="help">{description}',"<tpl if=\"values.example != ''\">","<div><span>"+OpenLayers.i18n("example")+"</span> {example}</div>","</tpl></div>"],COMPLETE:['<div class="help"><span class="title">{label}</span>',"<div>{description}</div>",'<tpl for="help">',"<div>{.}</div>","</tpl>","<tpl if=\"values.example != ''\">","<div><span>"+OpenLayers.i18n("example")+"</span> {example}</div>","</tpl>","<tpl if=\"values.helper != ''\">","<div><span>"+OpenLayers.i18n("helper")+"</span><ul>",'<tpl for="helper">','<li title="{values.title}">{values.label}</li>',"</tpl>","</ul></div>","</tpl>","<div>"+OpenLayers.i18n("tagName")+" {name}</div>","</div>"]},get:function(b,f,e,d){var a=b.split("|"),g='<request><element schema="'+f+'" name="'+a[1]+'" context="'+a[2]+'" fullContext="'+a[3]+'" isoType="'+a[4]+'" /></request>';f=f||a[0].split(".")[1]||"iso19139";OpenLayers.Request.POST({url:e,data:g,success:function(l){var m=l.responseXML.getElementsByTagName("element");if(m[0]&&m[0].getAttribute("error")==="not-found"){return;}var j=new Ext.data.XmlReader({record:"element",fields:GeoNetwork.util.HelpTools.fields});var h=j.readRecords(l.responseXML);if(d){d(h);}}});}};Ext.namespace("GeoNetwork.util");GeoNetwork.util.SearchTools={fast:"false",output:"full",sortBy:"relevance",hitsPerPage:"50",doQuery:function(a,e,d,l,f,b,j,g,h){OpenLayers.Request.GET({url:e.services.rootUrl+j.service+"?"+a,async:h===false?false:true,success:function(o){if(b){var m=new OpenLayers.Format.GeoNetworkRecords();var q=m.read(o.responseText);var r=q.records;var t=e.metadataStore===j,u=e.summaryStore===g;if(r.length>0){j.loadData(q);}if(u){var s=q.summary;if(s&&s.count>0&&g){g.loadData(s);}}if(e&&t){e.updateStatus(q.from+"-"+q.to+OpenLayers.i18n("resultBy")+s.count);}}if(l){l(o,a);}},failure:function(m){if(f){f(m);}}});},doQueryFromForm:function(e,b,a,j,d,m,h,f,g){var l=GeoNetwork.util.SearchTools.buildQueryFromForm(Ext.getCmp(e),a,GeoNetwork.util.SearchTools.sortBy,h.fast);GeoNetwork.util.SearchTools.doQuery(l,b,a,j,d,m,h,f,g);},doQueryFromParams:function(h,e,b,l,d,o,j,f,g){var a=[],m;GeoNetwork.util.SearchTools.addFiltersFromPropertyMap(h,a,b);m=GeoNetwork.util.SearchTools.buildQueryGET(a,b,GeoNetwork.util.SearchTools.sortBy,j.fast);GeoNetwork.util.SearchTools.doQuery(m,e,b,l,d,o,j,f,g);},buildQueryFromForm:function(a,f,b,e){var d=GeoNetwork.util.SearchTools.getFormValues(a);var g=[];GeoNetwork.util.SearchTools.addFiltersFromPropertyMap(d,g,f);return GeoNetwork.util.SearchTools.buildQueryGET(g,f,b,e);},populateFormFromParams:function(a,b){a.cascade(function(e){if(e.getName){var d=e.getName();if(d.indexOf("_")!==-1){d=d.substring(2);if(b[d]){e.setValue(b[d]);}}else{if(b[d]){e.setValue(b[d]);}}}});},addFiltersFromPropertyMap:function(e,f,l){var j=".8",d,g=e.E_similarity,h=e.E_hitsperpage;if(g!==undefined){j=e.E_similarity;GeoNetwork.util.SearchTools.addFilter(f,"E_similarity",j);}if(!h){h=GeoNetwork.util.SearchTools.hitsPerPage;}var b=parseInt(l,10)+parseInt(h,10)-1;GeoNetwork.util.SearchTools.addFilter(f,"E_from",l);GeoNetwork.util.SearchTools.addFilter(f,"E_to",b);for(d in e){if(e.hasOwnProperty(d)){var a=e[d];if(a!==""&&d!=="E_similarity"){GeoNetwork.util.SearchTools.addFilter(f,d,a);}}}},addFilter:function(e,d,g){var a=d.match("^(\\[?)([^_]+)_(.*)$"),b,h=[];if(a){var f=a[3].split("|");for(b=0;b<f.length;++b){GeoNetwork.util.SearchTools.addFilterImpl(e,a[2],f[b],g);}}},addFilterImpl:function(a,e,d,b){if(e.charAt(0)==="E"){a.push(d+"="+encodeURIComponent(b)+"");}else{if(e==="B"){a.push(d+"="+(b?"on":"off")+"");}else{if(e==="O"){if(b){a.push(d+"=on");}}else{alert("Cannot parse "+e);}}}},sortByMappings:{relevance:{name:"relevance",order:""},rating:{name:"changeDate",order:""},popularity:{name:"popularity",order:""},date:{name:"date",order:""},title:{name:"title",order:"reverse"}},buildQueryGET:function(a,f,d,e){var b="fast="+(e?e:GeoNetwork.util.SearchTools.fast)+"&";if(a){b+=a.join("&");}return b;},getFormValues:function(b){var a=b.getForm().getValues()||{};b.cascade(function(e){if(e.disabled!==true&&e.rendered){if(e.isXType("boxselect")){if(e.getValue&&e.getValue()){a[e.getName()]=e.getValue();}}else{if(e.isXType("combo")){if(e.getValue&&e.getValue()){a[e.getName()]=e.getValue();}}else{if(e.isXType("fieldset")){if(e.checkbox){a[e.checkboxName]=!e.collapsed;}}else{if(e.isXType("radiogroup")){var d=e.items.get(0);a[d.getName()]=d.getGroupValue();}else{if(e.isXType("checkbox")){a[e.getName()]=e.getValue();}else{if(e.isXType("datefield")){if(e.getValue()!==""){a[e.getName()]=e.getValue().format("Y-m-d")+(e.postfix?e.postfix:"");}}else{if(e.getName){if(e.getValue&&e.getValue()!==""){a[e.getName()]=e.getValue();}}}}}}}}}return true;});return a;}};var translations={};function translate(a){return translations[a]||a;}function checkAllInputsIn(b,e){var a=Ext.getDom(b).getElementsByTagName("input"),d;for(d=0;d<a.length;d++){a[d].checked=e;}}function setAll(a){checkAllInputsIn(a,true);}function clearAll(a){checkAllInputsIn(a,false);}function checkBoxModalUpdate(b,d,a,g){var f=Ext.DomQuery.select('input[type="checkbox"]');var e="?";if(d==="metadata.admin"||d==="metadata.category"){e+="id="+Ext.getDom("metadataid").value;}Ext.each(f,function(h){if(h.checked&&h.name!=""){e+="&"+h.name+"=on";
}});catalogue.doAction(d+e,null,null,g,function(h){Ext.getDom(b).innerHTML=h.responseText;if(d==="metadata.admin"||d==="metadata.category"){Ext.getCmp("modalWindow").close();}},null);}function addGroups(e){var a=e.getElementsByTagName("group"),g;Ext.getDom("group").options.length=0;for(g=0;g<a.length;g++){var b=a[g].getElementsByTagName("id")[0].firstChild.nodeValue;var d=a[g].getElementsByTagName("name")[0].firstChild.nodeValue;var f=document.createElement("option");f.text=d;f.value=b;if(a.length===1){f.selected=true;}Ext.getDom("group").options.add(f);}}function doGroups(a){catalogue.doAction("xml.usergroups.list?id="+a,null,null,"Error retrieving groups",function(d){if(d.nodeName==="error"){Ext.getDom("group").options.length=0;Ext.getDom("group").value="";var b=Ext.getDom("user");for(i=0;i<b.options.length;i++){b.options[i].selected=false;}}else{addGroups(d.responseXML);}});}function checkMassiveNewOwner(e,b){var d=Ext.getDom("user").value;var a=Ext.getDom("group").value;if(d===""){Ext.Msg.alert(b,"selectNewOwner");return false;}if(a.value===""){Ext.Msg.alert(b,"selectOwnerGroup");return false;}catalogue.doAction(e+"?user="+d+"&group="+a,null,null,null,function(f){Ext.getDom("massivenewowner").parentNode.innerHTML=f.responseText;});}function doDownload(a,g){var h=Ext.getDom("downloadlist").getElementsByTagName("INPUT"),e="&id="+a+"&access=private",f=false;for(var d=0;d<h.length;d++){if(h[d].checked||g!==null){f=true;var b=h[d].getAttribute("name");e+="&fname="+b;}}if(!f){Ext.Msg.alert("Alert",OpenLayers.i18n("selectOneFile"));return;}catalogue.doAction(catalogue.services.fileDisclaimer+"?"+e,null,null,null,function(j){Ext.getDom("downloadlist").parentNode.innerHTML=j.responseText;});}function feedbackSubmit(){var a=Ext.getDom("feedbackf");catalogue.doAction(catalogue.services.fileDownload+"?"+Ext.Ajax.serializeForm(a),null,null,null,function(b){Ext.getDom("feedbackf").parentNode.innerHTML=b.responseText;});}function goSubmit(a){document.forms[a].submit();}Ext.namespace("GeoNetwork.util");GeoNetwork.util.INSPIRESearchFormTools={getAnnexField:function(a){var d=[["i","I"],["ii","II"],["iii","III"]],b={id:"inspireannex",name:"E_inspireannex",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("inspireannex"),store:new Ext.data.ArrayStore({id:0,fields:["id","label"],data:d}),valueField:"id",displayField:"label"};if(a){Ext.apply(b,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(b);}else{return new Ext.form.ComboBox(b);}},getRelatedField:function(){var a=new Ext.form.Checkbox({hideLabel:true,boxLabel:OpenLayers.i18n("inspirerelated"),tabTip:OpenLayers.i18n("inspirerelatedtt"),name:"O_inspirerelated"});return a;},getThemesFieldWithSuggestion:function(a){var b=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:a.opensearchSuggest,field:"inspiretheme",name:"E_inspiretheme",fieldLabel:OpenLayers.i18n("inspiretheme")});return b;},getThemesField:function(g,b){var d,f,a;d=Ext.data.Record.create([{name:"id"},{name:"value"},{name:"definition"},{name:"uri"}]);f=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:g.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pKeyword:"*",pThesauri:"external.theme.inspire-theme",pMode:"searchBox",maxResults:"35"},reader:new Ext.data.XmlReader({record:"keyword",id:"id"},d),fields:["id","value","definition","uri"],sortInfo:{field:"value"}});f.load();var e={id:"inspiretheme",name:"E_inspiretheme",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("inspiretheme"),store:f,valueField:"value",displayField:"value"};if(b){Ext.apply(e,{valueDelimiter:" or ",stackItems:true});return new Ext.ux.form.SuperBoxSelect(e);}else{return new Ext.form.ComboBox(e);}},getINSPIREFields:function(a,b){return[this.getAnnexField(b),this.getThemesField(a,b),this.getRelatedField()];}};Ext.namespace("GeoNetwork.util");GeoNetwork.util.SearchFormTools={getSimpleFormFields:function(d,h,f,b,j,a,e,g){var l=[];if(d){l.push(new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:true,width:285,minChars:2,loadingText:"...",hideTrigger:true,url:d.opensearchSuggest,listeners:{}}));}else{l.push(GeoNetwork.util.SearchFormTools.getFullTextField());}if(b){l.push(GeoNetwork.util.SearchFormTools.getTypesField(a,true));}if(h){l.push(GeoNetwork.util.SearchFormTools.getSimpleMap(h,f,j,e,g));}l.push(GeoNetwork.util.SearchFormTools.getOptions());return l;},getAdvancedFormFields:function(w,G,q){var a=[],d,E,m;if(w){d=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:true,width:285,minChars:2,loadingText:"...",hideTrigger:true,url:w.opensearchSuggest});m=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:w.opensearchSuggest,field:"orgName",name:"E_orgName",fieldLabel:OpenLayers.i18n("org")});E=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:w.opensearchSuggest,field:"keyword",name:"E_themekey",fieldLabel:OpenLayers.i18n("keyword")});}else{d=GeoNetwork.util.SearchFormTools.getFullTextField();E=GeoNetwork.util.SearchFormTools.getKeywordsField();m=GeoNetwork.util.SearchFormTools.getOrgNameField();}var b=GeoNetwork.util.SearchFormTools.getAdvancedTextFields();var z=GeoNetwork.util.SearchFormTools.getTitleField();var g=GeoNetwork.util.SearchFormTools.getAbstractField();var f=GeoNetwork.util.SearchFormTools.getTypesField();var t={xtype:"fieldset",title:OpenLayers.i18n("mapTypes"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:true,defaultType:"checkbox",defaults:{width:160},items:GeoNetwork.util.SearchFormTools.getMapTypesField()};var D={xtype:"fieldset",title:OpenLayers.i18n("similarity"),autoHeight:true,autoWidth:true,layout:"column",collapsible:true,collapsed:true,items:[GeoNetwork.util.SearchFormTools.getSimilarityField()]};var v=new Ext.form.TextField({name:"E_geometry",id:"geometry",fieldLabel:OpenLayers.i18n("wkt"),hideLabel:false});var H=[],e;for(e=0;e<G.length;e++){H.push(G[e].clone());}var I={xtype:"gn_geometrymapfield",geometryFieldId:"geometry",id:"geometryMap",layers:H,mapOptions:q};var s=GeoNetwork.util.SearchFormTools.getNearYouButton("geometry");var h=GeoNetwork.util.SearchFormTools.getRelationField();var u=GeoNetwork.util.SearchFormTools.getScaleDenominatorField(true);var j=new Ext.form.FieldSet({title:OpenLayers.i18n("spatialSearch"),autoWidth:true,collapsible:true,collapsed:true,items:[v,s,I,h]});var F=new Ext.form.FieldSet({title:OpenLayers.i18n("when"),autoWidth:true,defaultType:"datefield",collapsible:true,collapsed:true,items:GeoNetwork.util.SearchFormTools.getWhen()});var r=GeoNetwork.util.SearchFormTools.getCatalogueField(w.getSources,w.logoUrl);var o=GeoNetwork.util.SearchFormTools.getGroupField(w.getGroups);var C=GeoNetwork.util.SearchFormTools.getMetadataTypeField();var l=GeoNetwork.util.SearchFormTools.getCategoryField(w.getCategories,null,true);var B=GeoNetwork.util.SearchFormTools.getOptions();a.push(d,b,z,g,E,m,j,f,t,u,F,r,o,C,l,B,D);return a;},getSimpleMap:function(j,g,m,e,h){var a=[],d=[],l;var b=new Ext.form.TextField({name:"E_geometry",id:"geometry",inputType:"hidden"});for(l=0;l<j.length;l++){d.push(j[l].clone());}var f={xtype:"gn_geometrymapfield",geometryFieldId:"geometry",id:"geometryMap",layers:d,mapOptions:g,activated:m};if(e){Ext.applyIf(f,e);}a.push(b,f);if(h){a.push(GeoNetwork.util.SearchFormTools.getRelationField());}return a;},getOptions:function(d){var e=d||[["10"],["20"],["50"],["100"]];var b=GeoNetwork.util.SearchFormTools.getSortByCombo();var a=new Ext.form.ComboBox({id:"E_hitsperpage",name:"E_hitsperpage",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("hitsPerPage"),value:e[1],store:new Ext.data.ArrayStore({id:0,fields:["id"],data:e}),valueField:"id",displayField:"id"});var f=new Ext.form.FieldSet({title:"Options",autoWidth:true,collapsible:true,collapsed:true,defaults:{width:160},items:[b,a]});return f;},getSortByCombo:function(){var d=new Ext.form.TextField({name:"E_sortBy",id:"E_sortBy",inputType:"hidden"});
var b=new Ext.form.TextField({name:"E_sortOrder",id:"sortOrder",inputType:"hidden"});var a=new Ext.form.ComboBox({mode:"local",fieldLabel:OpenLayers.i18n("sortBy"),triggerAction:"all",value:"relevance",store:GeoNetwork.util.SearchFormTools.getSortByStore(),valueField:"id",displayField:"name",listeners:{change:function(g,f,h){var e=f.split("#");d.setValue(e[0]);b.setValue(e[1]);}}});return[d,b,a];},getSortByStore:function(){return new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["relevance#",OpenLayers.i18n("relevance")],["title#reverse",OpenLayers.i18n("title")],["changeDate#",OpenLayers.i18n("changeDate")],["rating#",OpenLayers.i18n("rating")],["popularity#",OpenLayers.i18n("popularity")],["denominator#",OpenLayers.i18n("scaleDesc")],["denominator#revers",OpenLayers.i18n("scaleAsc")]]});},getFullTextField:function(){return new Ext.form.TextField({name:"E_any",id:"E_any",fieldLabel:OpenLayers.i18n("fullTextSearch"),hideLabel:false});},getTitleField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_title",OpenLayers.i18n("title"));},getAbstractField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_abstract",OpenLayers.i18n("abstract"));},getKeywordsField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_themekey",OpenLayers.i18n("keyword"));},getOrgNameField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_orgName",OpenLayers.i18n("org"));},getTextField:function(b,a){return new Ext.form.TextField({name:b,fieldLabel:a,hideLabel:false});},getCatalogueField:function(g,b,a){var d=GeoNetwork.data.CatalogueSourceStore(g),f='<tpl for="."><div class="x-combo-list-item logo"><img src="'+b+'{id}.gif"/>{name}</div></tpl>';d.load();var e={name:"E_siteId",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("catalogue"),store:d,valueField:"id",displayField:"name",tpl:f};if(a){Ext.apply(e,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:'<img style="max-width:16px;" src="'+b+'{id}.gif"/>{name}'});return new Ext.ux.form.SuperBoxSelect(e);}else{return new Ext.form.ComboBox(e);}},getGroupField:function(a,d){var b=GeoNetwork.data.GroupStore(a),f='<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>";b.load();var e={name:"E_group",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:b,valueField:"id",displayField:"name",tpl:f};if(d){Ext.apply(e,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:"{[values.label."+OpenLayers.Lang.getCode()+"]}"});return new Ext.ux.form.SuperBoxSelect(e);}else{return new Ext.form.ComboBox(e);}},getMetadataTypeField:function(b){var a={name:"E_template",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("kind"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["n",OpenLayers.i18n("md")],["y",OpenLayers.i18n("tpl")]]}),valueField:"id",displayField:"name"};if(b){Ext.apply(a,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(a);}else{return new Ext.form.ComboBox(a);}},getCategoryField:function(g,a,h){var b=GeoNetwork.data.CategoryStore(g);b.load();var f=(a?'<tpl for="."><div class="x-combo-list-item"><img src="'+a+'{name}.png"/>{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>":'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>");var e={name:"E_category",mode:"local",fieldLabel:OpenLayers.i18n("category"),triggerAction:"all",store:b,valueField:"name",displayField:"name",tpl:f};if(h){var d=(a?'<img src="'+a+'{name}.png"/>{[values.label.'+OpenLayers.Lang.getCode()+"]}":"{[values.label."+OpenLayers.Lang.getCode()+"]}");Ext.apply(e,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:d});return new Ext.ux.form.SuperBoxSelect(e);}else{return new Ext.form.ComboBox(e);}},getAdvancedTextFields:function(){return{xtype:"fieldset",title:OpenLayers.i18n("advTextSearch"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:true,defaultType:"textfield",items:[{name:"E_or",fieldLabel:OpenLayers.i18n("eitherWords"),hideLabel:false},{name:"E_phrase",fieldLabel:OpenLayers.i18n("exactPhrase"),hideLabel:false},{name:"E_all",fieldLabel:OpenLayers.i18n("allWords"),hideLabel:false},{name:"E_without",fieldLabel:OpenLayers.i18n("withoutWords"),hideLabel:false}]};},getSimilarityField:function(){return{xtype:"radiogroup",items:[{xtype:"label",text:OpenLayers.i18n("precise")},{name:"E_similarity",inputValue:1},{name:"E_similarity",inputValue:0.8,checked:true},{name:"E_similarity",inputValue:0.6},{name:"E_similarity",inputValue:0.4},{name:"E_similarity",inputValue:0.2},{xtype:"label",text:OpenLayers.i18n("imprecise")}]};},getRelationField:function(){return new Ext.form.ComboBox({name:"E_relation",mode:"local",width:150,triggerAction:"all",fieldLabel:OpenLayers.i18n("relationType"),store:new Ext.data.ArrayStore({id:0,fields:["relation","label"],data:[["",""],["intersection",OpenLayers.i18n("intersection")],["overlaps",OpenLayers.i18n("overlaps")],["encloses",OpenLayers.i18n("encloses")],["fullyOutsideOf",OpenLayers.i18n("fullyOutsideOf")],["crosses",OpenLayers.i18n("crosses")],["touches",OpenLayers.i18n("touches")],["within",OpenLayers.i18n("within")]]}),valueField:"relation",displayField:"label"});},getNearYouButton:function(a){return new Ext.Button({text:OpenLayers.i18n("nearYou"),iconCls:"md-mn mn-user-location",iconAlign:"right",listeners:{click:function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(b){Ext.getCmp(a).setValue("POINT("+b.coords.latitude+" "+b.coords.longitude+")");});}}}});},registerDateVtype:function(){if(Ext.form.VTypes.daterange){return;}Ext.apply(Ext.form.VTypes,{daterange:function(b,a){var f=a.parseDate(b);if(!f){return false;}if(a.startDateField&&(!this.dateRangeMax||(f.getTime()!==this.dateRangeMax.getTime()))){var d=Ext.getCmp(a.startDateField);d.setMaxValue(f);d.validate();this.dateRangeMax=f;}else{if(a.endDateField&&(!this.dateRangeMin||(f.getTime()!==this.dateRangeMin.getTime()))){var e=Ext.getCmp(a.endDateField);e.setMinValue(f);e.validate();this.dateRangeMin=f;}}return true;}});},getWhen:function(){var b=new Ext.form.Checkbox({name:"timeType",checked:true,fieldLabel:OpenLayers.i18n("anyTime"),handler:function(d,e){d.ownerCt.items.each(function(h,f,g){if(e&&h.getXType()==="datefield"){h.setValue("");}});}});var a=[b,{xtype:"label",text:OpenLayers.i18n("mdChangeDate")}];a.push(GeoNetwork.util.SearchFormTools.getMetadataDateField(b));a.push({xtype:"label",text:OpenLayers.i18n("tempExtent")});a.push(GeoNetwork.util.SearchFormTools.getTemporalExtentField(b));return a;},getMetadataDateField:function(a){GeoNetwork.util.SearchFormTools.registerDateVtype();return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_dateFrom","from","dateFrom","E_dateTo","to","dateTo",a);},getTemporalExtentField:function(a){GeoNetwork.util.SearchFormTools.registerDateVtype();return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_extFrom","from","extFrom","E_extTo","to","extTo",a);},getDateRangeFields:function(d,f,j,h,g,b,e){GeoNetwork.util.SearchFormTools.registerDateVtype();var a=function(o,m,l){if(this&&m!==""){this.setValue(false);}};return[{fieldLabel:OpenLayers.i18n(f),name:d,id:j,width:120,vtype:"daterange",endDateField:b,format:"d/m/Y",listeners:{change:a,scope:e}},{fieldLabel:OpenLayers.i18n(g),name:h,id:b,width:120,vtype:"daterange",startDateField:j,format:"d/m/Y",listeners:{change:a,scope:e}}];},getScaleDenominatorField:function(h,j,m,b,g){j=j||1000;m=m||1000000;b=b||1000;g=g||230;var a=new Ext.slider.Tip({getText:function(o){return String.format("<b>"+OpenLayers.i18n("scaleNominator")+"{0}</b>",o.value);}});var l=new Ext.form.Field({name:"E_denominatorFrom",value:"",hidden:true});var e=new Ext.form.Field({name:"E_denominatorTo",value:"",hidden:true});var f=new Ext.slider.MultiSlider({disabled:h?true:false,width:g,minValue:j,maxValue:m,increment:b,values:[j,m],formFields:[l,e],plugins:a,listeners:{change:function(o,q,r){o.formFields[r.index].setValue(q);}}});
var d=new Ext.form.Checkbox({fieldLabel:OpenLayers.i18n("scale"),value:h?true:false,handler:function(o,q){f.setDisabled(!q);if(!q){l.setValue("");e.setValue("");}}});return[l,e,d,f];},getMapTypesField:function(){var a=GeoNetwork.util.SearchFormTools.getSpatialRepresentationTypeField(null,true);return[{hideLabel:true,boxLabel:OpenLayers.i18n("digital"),name:"B_digital"},{hideLabel:true,boxLabel:OpenLayers.i18n("hardCopy"),name:"B_paper"},{hideLabel:true,boxLabel:OpenLayers.i18n("downloadable"),name:"B_download"},{hideLabel:true,boxLabel:OpenLayers.i18n("interactive"),name:"B_dynamic"},a];},getValidField:function(b){var a={name:"E__valid",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("validationStatus"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["1",OpenLayers.i18n("valid")],["0",OpenLayers.i18n("notValid")],["-1",OpenLayers.i18n("notDetermined")]]}),valueField:"id",displayField:"name"};if(b){Ext.apply(a,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(a);}else{return new Ext.form.ComboBox(a);}},getTypesField:function(a,b){var e=[["dataset",OpenLayers.i18n("dataset")],["series",OpenLayers.i18n("series")],["service",OpenLayers.i18n("service")]],d={name:"E_type",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("resourceType"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:a||e}),valueField:"id",displayField:"name"};if(b){Ext.apply(d,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(d);}else{return new Ext.form.ComboBox(d);}},getSpatialRepresentationTypeField:function(a,b){var e=[["grid",OpenLayers.i18n("grid")],["stereoModel",OpenLayers.i18n("stereoModel")],["tin",OpenLayers.i18n("tin")],["textTabled",OpenLayers.i18n("textTable")],["vector",OpenLayers.i18n("vector")],["video",OpenLayers.i18n("video")]],d={name:"E_spatialRepresentationType",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("spatialRepType"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:a||e}),valueField:"id",displayField:"name"};if(b){Ext.apply(d,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(d);}else{return new Ext.form.ComboBox(d);}}};Ext.namespace("GeoNetwork.util");GeoNetwork.util.CSWSearchTools={cswMethod:"POST",resultsMode:"results_with_summary",sortBy:"",maxRecords:"50",doCSWQueryFromForm:function(d,b,j,l,g,e){var f=b.services.csw;var a=GeoNetwork.util.CSWSearchTools.buildCSWQueryFromForm(GeoNetwork.util.CSWSearchTools.cswMethod,Ext.getCmp(d),j,GeoNetwork.util.CSWSearchTools.sortBy,e);if(GeoNetwork.util.CSWSearchTools.cswMethod==="POST"){var h=GeoNetwork.util.CSWSearchTools.buildCSWQueryFromForm("GET",Ext.getCmp(d),j,GeoNetwork.util.CSWSearchTools.sortBy,e);OpenLayers.Request.POST({url:f,data:a,success:function(o){var m=new OpenLayers.Format.CSWGetRecords.v2_0_2();b.currentRecords=m.read(o.responseText);var q=b.currentRecords.records;if(q.length>0){b.metadataCSWStore.loadData(b.currentRecords);}if(l){l(o,h);}},failure:g});}else{OpenLayers.Request.GET({url:f,params:a,success:function(m){l(m,a);},failure:g});}},buildCSWQueryFromForm:function(j,f,b,h,g){var a=GeoNetwork.util.CSWSearchTools.getFormValues(f);var e=[];GeoNetwork.util.CSWSearchTools.addFiltersFromPropertyMap(a,e);g(a,e);if(e.length===0){e.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:"anyText",value:".*"}));}var d=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:e});if(j==="POST"){return GeoNetwork.util.CSWSearchTools.buildCSWQueryPOST(d,b,h);}else{return GeoNetwork.util.CSWSearchTools.buildCSWQueryGET(d,b,h);}},addFiltersFromPropertyMap:function(e,a){var d=".8",f=e.E_similarity,g;if(f!==null&&f!==undefined){d=e.E_similarity;GeoNetwork.util.CSWSearchTools.addFilter(a,"E_similarity",d,d);}for(g in e){if(e.hasOwnProperty(g)){var b=e[g];if(b!==""&&g!=="E_similarity"){GeoNetwork.util.CSWSearchTools.addFilter(a,g,b,d);}}}},addFilter:function(f,e,g,a){var j=e.match("^(\\[?)([^_]+)_(.*)$"),h=[],d;if(j){if(j[1]==="["){var b=g.split(",");for(d=0;d<b.length;++d){GeoNetwork.util.CSWSearchTools.addFilterImpl(b.length>1?h:f,j[2],j[3],b[d],a);}if(b.length>1){f.push(new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:h}));}}else{GeoNetwork.util.CSWSearchTools.addFilterImpl(f,j[2],j[3],g,a);}}},addFilterImpl:function(f,e,b,g,a){var d;if(e==="S"){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:b,value:g+".*"}));}else{if(e==="C"){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:b,value:".*"+g+".*"}));}else{if(e.charAt(0)==="E"){if(e.length>1){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:e.substring(1)}));}f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:g}));if(e.length>1){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:a}));}}else{if(e===">="){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,property:b,value:g}));}else{if(e==="<="){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:b,value:g}));}else{if(e==="T"){var j=g.split(" ");for(d=0;d<j.length;++d){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:j[d]}));}}else{if(e==="B"){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:g?1:0}));}else{if(e==="V"){var h=g.match("^([^/]+)/(.*)$");f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:"1.0"}));f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:h[1],value:h[2]}));f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:a}));}else{alert("Cannot parse "+e);}}}}}}}}},sortByMappings:{relevance:{name:"relevance",order:"D"},rating:{name:"rating",order:"D"},popularity:{name:"popularity",order:"D"},date:{name:"date",order:"D"},title:{name:"title",order:"A"}},buildCSWQueryPOST:function(g,e,b){var d='<?xml version="1.0" encoding="UTF-8"?>\n<csw:GetRecords xmlns:csw="http://www.opengis.net/cat/csw/2.0.2" service="CSW" version="2.0.2" resultType="'+this.resultsMode+'" startPosition="'+e+'" maxRecords="'+this.maxRecords+'">\n  <csw:Query typeNames="csw:Record">\n    <csw:ElementSetName>full</csw:ElementSetName>\n';if(b){var a=GeoNetwork.util.CSWSearchTools.sortByMappings[b];d+='    <ogc:SortBy xmlns:ogc="http://www.opengis.net/ogc">\n      <ogc:SortProperty>\n        <ogc:PropertyName>'+a.name+"</ogc:PropertyName>\n        <ogc:SortOrder>"+a.order+"</ogc:SortOrder>\n      </ogc:SortProperty>\n    </ogc:SortBy>\n";}if(g){var f=new OpenLayers.Format.XML().write(new OpenLayers.Format.Filter().write(g));f=f.replace(/^<\?xml[^?]*\?>/,"");d+='    <csw:Constraint version="1.0.0">\n';d+=f;d+="    </csw:Constraint>\n";}d+="  </csw:Query>\n</csw:GetRecords>";return d;},buildCSWQueryGET:function(g,e,b){var d={request:"GetRecords",service:"CSW",version:"2.0.2",resultType:this.resultsMode,namespace:"csw:http://www.opengis.net/cat/csw/2.0.2",typeNames:"csw:Record",constraintLanguage:"FILTER",constraint_language_version:"1.1.0",elementSetName:"full",startPosition:e,maxRecords:this.maxRecords};if(b){var a=GeoNetwork.util.CSWSearchTools.sortByMappings[b];d.sortBy=a.name+":"+a.order;}if(g){var f=new OpenLayers.Format.XML().write(new OpenLayers.Format.Filter().write(g));f=f.replace(/^<\?xml[^?]*\?>/,"");d.constraint=f;}return d;},getFormValues:function(b){var a=b.getForm().getValues()||{};b.cascade(function(e){if(e.disabled!==true){if(e.isXType("boxselect")){if(e.getValue&&e.getValue()){a[e.getName()]=e.getValue();}}else{if(e.isXType("combo")){if(e.getValue&&e.getValue()){a[e.getName()]=e.getValue();
}}else{if(e.isXType("fieldset")){if(e.checkbox){a[e.checkboxName]=!e.collapsed;}}else{if(e.isXType("radiogroup")){var d=e.items.get(0);a[d.getName()]=d.getGroupValue();}else{if(e.isXType("checkbox")){a[e.getName()]=e.getValue();}else{if(e.isXType("datefield")){if(e.getValue()!==""){a[e.getName()]=e.getValue().format("Y-m-d")+(e.postfix?e.postfix:"");}}else{if(e.getName){if(e.getValue&&e.getValue()!==""){a[e.getName()]=e.getValue();}}}}}}}}}return true;});return a;}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.CatalogueSourceStore=function(a){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"source",idPath:"id",fields:[{name:"id",mapping:"uuid"},{name:"name"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.CategoryStore=function(a){function b(h,g){var f={};var j=g.getElementsByTagName("label");var e;if(j.length===1){var l=j[0].childNodes;var d;for(e=0,len=l.length;e<len;++e){d=l[e];if(d.nodeType===1){f[d.nodeName]=d.firstChild.nodeValue;}}}return f;}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"category",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"name"},{name:"label",convert:b}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.CodeListStore=function(f){var g=f.schema||"iso19139";var a='<request><codelist schema="'+g+'" name="'+f.codeListName+'" /></request>';var e=[{name:"code"},{name:"label"},{name:"description"}];var b=Ext.data.Record.create(e);var d=new Ext.data.Store({fields:e});OpenLayers.Request.POST({url:f.url,data:a,success:function(m){var h=m.responseXML.getElementsByTagName("entry");for(var j=0;j<h.length;j++){var l=new b({code:h[j].getElementsByTagName("code")[0].firstChild.nodeValue,label:h[j].getElementsByTagName("label")[0].firstChild.nodeValue,description:h[j].getElementsByTagName("description")[0].firstChild.nodeValue});d.add(l);}}});return d;};Ext.namespace("GeoNetwork.data");GeoNetwork.data.GroupStore=function(a){function b(h,g){var f={};var e;var j=g.getElementsByTagName("label");if(j.length===1){var l=j[0].childNodes;var d;for(e=0,len=l.length;e<len;++e){d=l[e];if(d.nodeType===1){f[d.nodeName]=d.firstChild.nodeValue;}}}return f;}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"group",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"name"},{name:"description"},{name:"email"},{name:"referrer"},{name:"label",convert:b}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.HarvesterStore=function(d){function e(j,h){var m=[],g,f=h.getElementsByTagName("categories");if(f.length===1){var l=f[0].getElementsByTagName("category");for(g=0;g<l.length;g++){m.push(l[g].getAttribute("id"));}}return m;}function b(j,h){var m=[],l,f=h.getElementsByTagName("operation");for(l=0;l<f.length;l++){var g=f[l];m.push(g.getAttribute("name"));}return m;}function a(l,g){var j=Ext.data.Record.create([{name:"group_id",mapping:"@id"},{name:"operation",convert:b}]);var h=new Ext.data.XmlReader({record:"group"},j);var f=h.readRecords(g);return f;}return new Ext.data.XmlStore({autoDestroy:true,url:d,record:"node",idPath:"@id",fields:[{name:"id",mapping:"@id"},{name:"type",mapping:"@type"},{name:"site_name",mapping:"site/name"},{name:"site_uuid",mapping:"site/uuid"},{name:"site_host",mapping:"site/host"},{name:"site_servlet",mapping:"site/servlet"},{name:"site_port",mapping:"site/port"},{name:"site_url",mapping:"site/url"},{name:"site_icon",mapping:"site/icon"},{name:"site_ogctype",mapping:"site/ogctype"},{name:"options_lang",mapping:"options/lang"},{name:"options_topic",mapping:"options/topic"},{name:"options_createthumbnails",mapping:"options/createthumbnails"},{name:"options_uselayer",mapping:"options/uselayer"},{name:"options_uselayermd",mapping:"options/uselayermd"},{name:"options_datasetcategory",mapping:"options/datasetcategory"},{name:"privileges",convert:a},{name:"categories",convert:e},{name:"site_account_use",mapping:"site/account/use"},{name:"site_account_username",mapping:"site/account/username"},{name:"site_account_password",mapping:"site/account/password"},{name:"options_every",mapping:"options/every"},{name:"options_onerunonly",mapping:"options/onerunonly"},{name:"options_status",mapping:"options/status"},{name:"info_lastrun",mapping:"info/lastRun"},{name:"info_running",mapping:"info/running"},{name:"info_result_total",mapping:"info/result/total"},{name:"info_result_added",mapping:"info/result/added"},{name:"info_result_layer",mapping:"info/result/layer"},{name:"info_result_layerUuidExist",mapping:"info/result/layerUuidExist"},{name:"info_result_layerUsingMdUrl",mapping:"info/result/layerUsingMdUrl"},{name:"info_result_unknownSchema",mapping:"info/result/unknownSchema"},{name:"info_result_removed",mapping:"info/result/removed"},{name:"info_result_unretrievable",mapping:"info/result/unretrievable"},{name:"info_result_badFormat",mapping:"info/result/badFormat"},{name:"info_result_doesNotValidate",mapping:"info/result/doesNotValidate"},{name:"info_result_thumbnails",mapping:"info/result/thumbnails"},{name:"info_result_thumbnailsFailed",mapping:"info/result/thumbnailsFailed"},{name:"error_message",mapping:"error/message"},{name:"error_class",mapping:"error/class"},{name:"error_stack"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataCSWResultsStore=function(){function b(q,o){var r,m;if(o.URI){for(r=0;r<o.URI.length;r++){m=o.URI[r];if(m.name==="thumbnail"){if(m.value.indexOf("http")===-1){return GeoNetwork.Catalogue.URL+"/srv/en/"+m.value;}else{return m.value;}}}}return"";}function g(q,o){var r,m;if(o.URI){for(r=0;r<o.URI.length;r++){m=o.URI[r];if(m.protocol&&m.protocol.indexOf("http-get-capabilities")!==-1){return m.value;}}}return"";}function j(m,o){if(o.geonet_info){return o.geonet_info.source[0];}else{return"";}}function e(m,o){if(o.geonet_info){return o.geonet_info.popularity[0];}else{return"";}}function d(m,o){if(o.geonet_info){return o.geonet_info.rating[0];}else{return"";}}function f(m,o){if(o.geonet_info){return o.geonet_info.download[0];}else{return"";}}function h(m,o){if(o.geonet_info){return o.geonet_info.ownername[0];}else{return"";}}function l(m,o){if(o.geonet_info&&o.geonet_info.is_harvested){return o.geonet_info.is_harvested[0];}else{return"";}}function a(m,o){if(o.geonet_info&&o.geonet_info.edit){return o.geonet_info.edit;}else{return"false";}}return new Ext.data.JsonStore({totalProperty:"SearchResults.numberOfRecordsMatched",root:"records",fields:[{name:"title",mapping:"title[0].value",defaultValue:""},{name:"abstract",mapping:"abstract",defaultValue:""},{name:"subject",mapping:"subject"},{name:"uuid",mapping:"identifier[0].value",defaultValue:""},{name:"thumbnail",convert:b},{name:"uri",mapping:"uri",defaultValue:""},{name:"getCapabilitiesUrl",convert:g},{name:"isharvested",convert:l},{name:"source",convert:j},{name:"rating",convert:d},{name:"popularity",convert:e},{name:"download",convert:f},{name:"ownername",convert:h},{name:"edit",convert:a},{name:"bbox",mapping:"BoundingBox",defaultValue:""}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataRelationStore=function(a,d,b){var f=[{name:"id"},{name:"uuid"},{name:"title"},{name:"abstract"},{name:"keyword"},{name:"type",mapping:"@type"}];if(b){var e=new Ext.data.XmlReader({record:"relation",idProperty:"uuid"},f);return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:a,params:d,disableCaching:false}),reader:e,groupField:"type",sortInfo:{field:"type",direction:"ASC"}});}else{return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"relation",idPath:"uuid",fields:f});}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataResultsStore=function(){function l(D,C){if(C.title&&C.title){return C.title[0].value;}else{return"";}}function o(G,F){var C,E=[],D;if(F.geonet_info&&F.geonet_info.valid_details){D=F.geonet_info.valid_details;
for(C=0;C<D.length;C++){E.push({valid:D.status[C].value,type:D.type[C].value,ratio:D.ratio[C].value});}}return E;}function f(G,F){var C;var D="";var E;if(F.image){for(C=0;C<F.image.length;C++){E=F.image[C].value;if(E.indexOf("http")!==-1||C===0){D=E;}}}return D;}function r(G,F){var C,E=[],D,H;if(F.responsibleParty){for(C=0;C<F.responsibleParty.length;C++){D=F.responsibleParty[C];H=(F.responsibleParty.organisationName&&F.responsibleParty.organisationName[C]?F.responsibleParty.organisationName[C].value:"");E.push({applies:D.appliesTo,logo:D.logo,role:D.role,name:H});}}return E;}function q(D,C){if(C.link){return C.link;}return[];}function s(D,C){if(C.geonet_info&&C.geonet_info.source){return C.geonet_info.source[0].value;}else{return"";}}function z(D,C){if(C.geonet_info&&C.geonet_info.popularity){return C.geonet_info.popularity[0].value;}else{return"";}}function j(D,C){if(C.geonet_info&&C.geonet_info.rating){return C.geonet_info.rating[0].value;}else{return"";}}function a(D,C){if(C.geonet_info&&C.geonet_info.download){return C.geonet_info.download[0].value;}else{return"";}}function h(D,C){if(C.geonet_info&&C.geonet_info.ownername){return C.geonet_info.ownername[0].value;}else{return"";}}function B(D,C){if(C.geonet_info&&C.geonet_info.isHarvested){return C.geonet_info.isHarvested[0].value;}else{return"";}}function w(D,C){if(C.geonet_info&&C.geonet_info.harvestInfo&&C.geonet_info.harvestInfo.type){return C.geonet_info.harvestInfo.type[0].value;}else{return"";}}function e(D,C){if(C.geonet_info&&C.geonet_info.category){return C.geonet_info.category;}else{return"";}}function d(D,C){if(C.geonet_info&&C.geonet_info.changeDate){return C.geonet_info.changeDate[0].value;}else{return"";}}function m(D,C){if(C.geonet_info&&C.geonet_info.createDate){return C.geonet_info.createDate[0].value;}else{return"";}}function t(D,C){if(C.geonet_info&&C.geonet_info.selected){return C.geonet_info.selected[0].value;}else{return"";}}function u(D,C){if(C["abstract"]){return C["abstract"][0].value;}else{return"";}}function v(D,C){if(C.type){return C.type[0].value;}else{return"";}}function b(D,C){if(C.geonet_info&&C.geonet_info.edit){return C.geonet_info.edit[0].value;}else{return"false";}}function g(D,C){if(C.geonet_info&&C.geonet_info.displayOrder){return C.geonet_info.displayOrder[0].value;}else{return 0;}}return new Ext.data.JsonStore({totalProperty:"summary.count",root:"records",fast:"false",service:"xml.search",fields:[{name:"title",convert:l},{name:"abstract",convert:u},{name:"type",convert:v},{name:"subject",mapping:"keyword",defaultValue:""},{name:"uuid",mapping:"geonet_info.uuid[0].value",defaultValue:""},{name:"id",mapping:"geonet_info.id[0].value",defaultValue:""},{name:"schema",mapping:"geonet_info.schema[0].value",defaultValue:""},{name:"contact",convert:r},{name:"thumbnail",convert:f},{name:"links",convert:q},{name:"uri",mapping:"uri",defaultValue:""},{name:"isharvested",convert:B},{name:"harvestertype",convert:w},{name:"createdate",convert:m},{name:"changedate",convert:d},{name:"selected",convert:t},{name:"source",convert:s},{name:"category",convert:e},{name:"rating",convert:j},{name:"popularity",convert:z},{name:"download",convert:a},{name:"ownername",convert:h},{name:"edit",convert:b},{name:"bbox",mapping:"BoundingBox",defaultValue:""},{name:"displayOrder",convert:g,sortType:"asInt"},{name:"valid",mapping:"geonet_info.valid[0].value",defaultValue:"-1"},{name:"valid_details",convert:o}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataResultsFastStore=function(){var b="|";function j(F,E){if(E.title&&E.title){return E.title[0].value;}else{return"";}}function m(F,E){if(E.valid){return E.valid[0].value;}else{return"-1";}}function r(I,H){var K,G=[],F;for(var J in H){if(H.hasOwnProperty(J)&&J.indexOf("valid_")!==-1){var E=H[J];G.push({valid:E[0].value,type:J.split("_")[1],ratio:""});}}return G;}function e(I,H){var J;var E="";var G;if(H.image){for(J=0;J<H.image.length;J++){var F=H.image[J].value.split(b);G=F[1];if(G.indexOf("http")!==-1||J===0){E=G;}}}return E;}function s(I,H){var K,G=[],E,J;if(H.responsibleParty){for(K=0;K<H.responsibleParty.length;K++){var F=H.responsibleParty[K].value.split(b);G.push({applies:F[1],logo:F[3],role:F[0],name:F[2]});}}return G;}function q(E,G){var H=[];if(G.link){for(i=0;i<G.link.length;i++){var F=G.link[i].value.split(b);H.push({name:F[0],title:F[1],href:F[2],protocol:F[3],type:F[4]});}}return H;}function t(F,E){if(E.geonet_info&&E.geonet_info.source){return E.geonet_info.source[0].value;}else{return"";}}function B(F,E){if(E.popularity){return E.popularity[0].value;}else{return"";}}function h(F,E){if(E.rating){return E.rating[0].value;}else{return"";}}function C(F,E){if(E.download){return E.download[0].value;}else{return"";}}function g(H,G){if(G.userinfo&&G.userinfo[0].value){var E=G.userinfo[0].value.split(b);try{return E[2]+" "+E[1];}catch(F){return"";}}else{return"";}}function o(F,E){if(E.isHarvested){return E.isHarvested[0].value;}else{return"";}}function z(F,E){if(E.geonet_info&&E.geonet_info.harvestInfo&&E.geonet_info.harvestInfo.type){return E.geonet_info.harvestInfo.type[0].value;}else{return"";}}function d(F,E){if(E.category){return E.category;}else{return"";}}function a(F,E){if(E.geonet_info&&E.geonet_info.changeDate){return E.geonet_info.changeDate[0].value;}else{return"";}}function l(F,E){if(E.geonet_info&&E.geonet_info.createDate){return E.geonet_info.createDate[0].value;}else{return"";}}function u(F,E){if(E.geonet_info&&E.geonet_info.selected){return E.geonet_info.selected[0].value;}else{return"";}}function v(F,E){if(E["abstract"]){return E["abstract"][0].value;}else{return"";}}function w(F,E){if(E.type){return E.type[0].value;}else{return"";}}function D(F,E){if(E.geonet_info&&E.geonet_info.edit){return E.geonet_info.edit[0].value;}else{return"false";}}function f(F,E){if(E.geonet_info&&E.geonet_info.displayOrder){return E.geonet_info.displayOrder[0].value;}else{return 0;}}return new Ext.data.JsonStore({totalProperty:"summary.count",root:"records",fast:"index",service:"q",fields:[{name:"title",convert:j},{name:"abstract",convert:v},{name:"type",convert:w},{name:"subject",mapping:"keyword",defaultValue:""},{name:"uuid",mapping:"geonet_info.uuid[0].value",defaultValue:""},{name:"id",mapping:"geonet_info.id[0].value",defaultValue:""},{name:"schema",mapping:"geonet_info.schema[0].value",defaultValue:""},{name:"contact",convert:s},{name:"thumbnail",convert:e},{name:"links",convert:q},{name:"uri",mapping:"uri",defaultValue:""},{name:"isharvested",convert:o},{name:"harvestertype",convert:z},{name:"createdate",convert:l},{name:"changedate",convert:a},{name:"selected",convert:u},{name:"source",convert:t},{name:"category",convert:d},{name:"rating",convert:h},{name:"popularity",convert:B},{name:"download",convert:C},{name:"ownername",convert:g},{name:"edit",convert:D},{name:"bbox",mapping:"BoundingBox",defaultValue:""},{name:"displayOrder",convert:f,sortType:"asInt"},{name:"valid",convert:m},{name:"valid_details",convert:r}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataSummaryStore=function(){return new Ext.data.JsonStore({totalProperty:"count",root:"keywords.keyword",listeners:{load:function(b,a,e){var d="count";var h="class";var g="type";var j={};var f=6;b.each(function(l){l.set(g,b.root);var m=l.get(g);if(typeof j.type!=="object"){j.type={maxValue:0,minValue:1};}j.type.maxValue=Math.max(l.get(d),j.type.maxValue);j.type.minValue=Math.min(l.get(d),j.type.minValue);});b.each(function(l){var m=l.get(g);var o=0;if(j.type.maxValue!==j.type.minValue){o=(l.get(d)-j.type.minValue)/(j.type.maxValue-j.type.minValue)*f;}l.set(h,Math.round(o));});}},sortInfo:{field:"value",direction:"ASC"},fields:[{name:"type",defaultValue:null},{name:"value",mapping:"name",defaultValue:""},{name:"count",mapping:"count",defaultValue:""},{name:"class",defaultValue:"0"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataThumbnailStore=function(d,a){var b=[{name:"href"},{name:"desc"},{name:"type"},{name:"mimetype"}];return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:d,params:a,disableCaching:false}),record:"thumbnail",idPath:"href",fields:b});
};Ext.namespace("GeoNetwork.data");GeoNetwork.data.OpenSearchSuggestionReader=function(a,b){a=a||{};GeoNetwork.data.OpenSearchSuggestionReader.superclass.constructor.call(this,a,b||a.fields);};Ext.extend(GeoNetwork.data.OpenSearchSuggestionReader,Ext.data.JsonReader,{rootId:undefined,readRecords:function(w){this.arrayData=w;var u,r;var m=this.meta,e=m?Ext.num(m.idIndex,m.id):null,b=this.recordType,t=b.prototype.fields,z=[],g=true,h;this.rootId=1;var D=(!this.rootId?this.getRoot(w):w[this.rootId]);for(u=0,len=D.length;u<len;u++){var C=D[u],a={},q=((e||e===0)&&C[e]!==undefined&&C[e]!==""?C[e]:null);for(r=0,jlen=t.length;r<jlen;r++){var B=t.items[r],E=B.mapping!==undefined&&B.mapping!==null?B.mapping:r;h=C[E]!==undefined?C[E]:B.defaultValue;h=B.convert(h,C);a[B.name]=C;}var d=new b(a,q);d.json=C;z[z.length]=d;}var l=z.length;if(m.totalProperty){h=parseInt(this.getTotal(w),10);if(!isNaN(h)){l=h;}}if(m.successProperty){h=this.getSuccess(w);if(h===false||h==="false"){g=false;}}return{success:true,records:z,totalRecords:z.length};}});Ext.namespace("GeoNetwork.data");Ext.namespace("GeoNetwork.data");GeoNetwork.data.OpenSearchSuggestionStore=function(a){a=a||{};GeoNetwork.data.OpenSearchSuggestionStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoNetwork.data.OpenSearchSuggestionReader(a,a.fields||["value"])}));};Ext.extend(GeoNetwork.data.OpenSearchSuggestionStore,Ext.data.Store);Ext.namespace("GeoNetwork.data");GeoNetwork.data.RegionStore=function(a){function b(h,g){var f={};var e;var j=g.getElementsByTagName("label");if(j.length===1){var l=j[0].childNodes;var d;for(e=0,len=l.length;e<len;++e){d=l[e];if(d.nodeType===1){f[d.nodeName]=d.firstChild.nodeValue;}}}return f;}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"region",idPath:"@id",fields:[{name:"id",mapping:"@id"},{name:"north"},{name:"south"},{name:"east"},{name:"west"},{name:"label",convert:b}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.SubTemplateTypeStore=function(a){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"record",idPath:"type",fields:[{name:"type"},{name:"schema"},{name:"label"},{name:"description"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.SuggestionStore=function(f,b,g){function a(j,h){var l=h.getAttribute("type");return'<span class="'+l+'">&#160;</span>';}var e=[{name:"id",mapping:"@id"},{name:"name",mapping:"@process"},{name:"target",mapping:"@target"},{name:"category",mapping:"@category"},{name:"desc",mapping:"name"},{name:"params",mapping:"params"},{name:"operational",mapping:"operational"}];if(g){var d=new Ext.data.XmlReader({record:"suggestion",idProperty:"@id"},e);return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:f,params:b,disableCaching:false}),reader:d,groupField:"category",sortInfo:{field:"target",direction:"ASC"}});}else{return new Ext.data.XmlStore({autoDestroy:true,baseParams:b,proxy:new Ext.data.HttpProxy({method:"GET",url:f,disableCaching:false}),record:"suggestion",idPath:"@id",fields:e});}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.ThesaurusFeedStore=function(a){var b="http://geonetwork.svn.sourceforge.net/svnroot/geonetwork/utilities/repository/thesaurus.xml";var d=new Ext.data.XmlStore({autoDestroy:true,autoLoad:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a||b,disableCaching:false}),record:"entry",idPath:"id",fields:[{name:"id"},{name:"title"},{name:"link",mapping:"link/@href"},{name:"updated"},{name:"summary"},{name:"category"}]});return d;};Ext.namespace("GeoNetwork.data");GeoNetwork.data.ThesaurusStore=function(a){var b=Ext.data.Record.create([{name:"filename"},{name:"title"},{name:"theme",mapping:"dname"},{name:"id",mapping:"key"},{name:"type"},{name:"activated"}]);var e=new Ext.data.Store({url:a.url,reader:new Ext.data.XmlReader({record:"thesaurus"},b),sortInfo:{field:"id",direction:"ASC"},fields:["filename","theme","id","title","type","activated"]});if(a.allOption){var d=new b({filename:OpenLayers.i18n("anyThesaurus"),activated:"y"});d.set("id","");e.add(d);}if(a.activatedOnly){e.on("load",function(){var f=this.query("activated","n");f.each(function(g,h){this.removeAt(this.indexOf(g));},e);},e);}e.load({add:true});return e;};Ext.namespace("GeoNetwork.data");GeoNetwork.data.UserStore=function(a){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"user",idPath:"id",fields:[{name:"id"},{name:"username"},{name:"surname"},{name:"name"},{name:"profile"},{name:"address"},{name:"email"},{name:"city"},{name:"state"},{name:"zip"},{name:"country"},{name:"organisation"},{name:"kind"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.ValidationRuleStore=function(f,b,g){function a(j,h){var l=h.getAttribute("type");return'<span class="'+l+'">&#160;</span>';}var e=[{name:"id",mapping:"@id"},{name:"group",mapping:"@group"},{name:"status",mapping:"@type"},{name:"statusIcon",convert:a},{name:"title"},{name:"details"},{name:"msg"}];if(g){var d=new Ext.data.XmlReader({record:"rule",idProperty:"id"},e);return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:f,params:b,disableCaching:false}),reader:d,groupField:"group",sortInfo:{field:"status",direction:"ASC"}});}else{return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:f,params:b,disableCaching:false}),record:"rule",idPath:"@id",fields:e});}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.Z3950RepositoryStore=function(a){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"repository",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"code",mapping:"id/@code"},{name:"name",mapping:"label"}]});};Ext.namespace("GeoNetwork.form");GeoNetwork.form.GeometryMapField=Ext.extend(GeoExt.MapPanel,{layer_style:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),geometryFieldId:undefined,geometryField:undefined,mapOptions:undefined,extentBox:undefined,vectorLayer:undefined,nearYou:undefined,initStyle:function(){this.layer_style.fillOpacity=0;this.layer_style.strokeOpacity=0.8;this.layer_style.strokeDashstyle="dash";this.layer_style.strokeWidth=4;},createExtentControl:function(){var b;if(this.restrictToMapExtent){b=new Ext.form.Checkbox({boxLabel:OpenLayers.i18n("restrictSearchToMap"),checked:this.activated?true:false,listeners:{check:function(d,e){this.geometryField.setValue("");this.nearYou.toggle(false);if(e){this.on("aftermapmove",this.setField,this);this.fireEvent("aftermapmove");}else{this.un("aftermapmove",this.setField,this);}},scope:panel}});this.getTopToolbar().add(b);if(this.activated){this.on("aftermapmove",this.setField,this);}}else{this.initStyle();this.extentBox=new GeoNetwork.Control.ExtentBox({wktelement:this.geometryField,vectorLayerStyle:this.layer_style});b=new GeoExt.Action({control:this.extentBox,toggleGroup:this.map.id+"move",allowDepress:false,pressed:this.activated?true:false,map:this.map,tooltip:{title:OpenLayers.i18n("selectExtentTooltipTitle"),text:OpenLayers.i18n("selectExtentTooltipText")},iconCls:"selextent"});this.vectorLayer=this.extentBox.getOrCreateLayer();var a={iconCls:"clearPolygon",tooltip:{title:OpenLayers.i18n("clearExtentTooltipTitle"),text:OpenLayers.i18n("clearExtentTooltipText")},handler:function(){this.vectorLayer.destroyFeatures();this.geometryField.setValue("");},scope:this};this.getTopToolbar().add(b,a);}if(this.nearYouControl){this.getTopToolbar().add(this.nearYou);}return b;},createNavBar:function(){var g=[];var e=this;this.nearYou=new Ext.Button({iconCls:"md-mn mn-user-location",iconAlign:"right",tooltip:OpenLayers.i18n("mapNearYou"),enableToggle:true,toggleGroup:this.map.id+"move",listeners:{toggle:function(l,h){var j=this;
if(h){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(m){j.map.panTo(new OpenLayers.LonLat(m.coords.longitude,m.coords.latitude));j.geometryField.setValue("POINT("+m.coords.latitude+" "+m.coords.longitude+")");});}}else{j.geometryField.setValue("");}},scope:e}});var a=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent(),map:this.map,iconCls:"zoomfull",tooltip:{title:OpenLayers.i18n("zoomToMaxExtentTooltipTitle"),text:OpenLayers.i18n("zoomToMaxExtentTooltipText")}});var d=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox(),map:this.map,toggleGroup:this.map.id+"move",allowDepress:false,iconCls:"zoomin",tooltip:{title:OpenLayers.i18n("zoominTooltipTitle"),text:OpenLayers.i18n("zoominTooltipText")}});var f=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({displayClass:"ZoomOut",out:true}),map:this.map,toggleGroup:this.map.id+"move",allowDepress:false,tooltip:{title:OpenLayers.i18n("zoomoutTooltipTitle"),text:OpenLayers.i18n("zoomoutTooltipText")},iconCls:"zoomout"});var b=new GeoExt.Action({control:new OpenLayers.Control.DragPan({isDefault:true}),toggleGroup:this.map.id+"move",allowDepress:false,pressed:this.activated?false:true,map:this.map,iconCls:"pan",tooltip:{title:OpenLayers.i18n("dragTooltipTitle"),text:OpenLayers.i18n("dragTooltipText")}});g.push(a,d,f,b,"->");return g;},defaultConfig:{id:"geometryMap",width:290,height:180,border:false,activated:false,restrictToMapExtent:false,nearYouControl:true},initComponent:function(){Ext.applyIf(this,this.defaultConfig);var a=this.mapOptions||{projection:"EPSG:4326",units:"degrees",maxExtent:new OpenLayers.Bounds(-180,-90,180,90),restrictedExtent:new OpenLayers.Bounds(-180,-90,180,90),controls:[]};if(!a.controls){a.controls=[];}this.map=new OpenLayers.Map("search_map",a);this.map.addControl(new GeoNetwork.Control.ZoomWheel());this.map.addControl(new OpenLayers.Control.LoadingPanel());this.map.addControl(new OpenLayers.Control.MousePosition());this.tbar=this.createNavBar();this.geometryField=Ext.getCmp(this.geometryFieldId);GeoNetwork.form.GeometryMapField.superclass.initComponent.call(this);this.createExtentControl();},setExtent:function(a){if(a){this.extentBox.updateFields(a);}else{this.extentBox.updateFields(this.map.getMaxExtent());}},setField:function(){if(this.geometryField!==undefined){var b=this.map.getExtent().toArray();var a="POLYGON(("+b[0]+" "+b[1]+","+b[0]+" "+b[3]+","+b[2]+" "+b[3]+","+b[2]+" "+b[1]+","+b[0]+" "+b[1]+"))";this.geometryField.setValue(a);}}});Ext.reg("gn_geometrymapfield",GeoNetwork.form.GeometryMapField);Ext.namespace("GeoNetwork.form");GeoNetwork.form.OpenSearchSuggestionTextField=Ext.extend(Ext.form.ComboBox,{defaultConfig:{hideLabel:true,width:400,minChars:2,loadingText:"...",hideTrigger:true,forceLowerCase:true},url:undefined,field:"any",fieldLabel:undefined,name:"E_any",displayField:"value",tpl:undefined,mode:"remote",store:undefined,queryParam:"q",autoSelect:false,itemSelector:"div.search-item",initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.id="E_"+this.field;GeoNetwork.form.OpenSearchSuggestionTextField.superclass.initComponent.call(this);if(!this.tpl){var a='<tpl for="."><div class="search-item"><h3>{[values.value.replace(Ext.getDom(\''+this.id+"').value, '<span>' + Ext.getDom('"+this.id+"').value + '</span>')]}</h3></div></tpl>";this.tpl=new Ext.XTemplate(a);}if(this.forceLowerCase){this.on("beforequery",function(b){b.query=b.query.toLowerCase();});}this.store=new GeoNetwork.data.OpenSearchSuggestionStore({url:this.url,rootId:1,baseParams:{field:this.field}});}});Ext.reg("gn_opensearchsuggestiontextfield",GeoNetwork.form.OpenSearchSuggestionTextField);Ext.namespace("GeoNetwork.form");GeoNetwork.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){if(!this.store.baseParams){this.store.baseParams={};}GeoNetwork.form.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){if(b.getKey()===b.ENTER){this.onTrigger2Click();}},this);},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,hasSearch:false,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.store.baseParams[this.paramName]="";this.store.removeAll();this.el.dom.value="";this.triggers[0].hide();this.hasSearch=false;this.focus();}},onTrigger2Click:function(){var a=this.getRawValue();if(a.length<1){this.store.baseParams[this.paramName]="*";}else{this.store.baseParams[this.paramName]=a;}if(this.triggerAction){this.triggerAction(this.scope,a);}else{this.store.reload();}this.hasSearch=true;this.triggers[0].show();this.focus();}});Ext.reg("gn_searchfield",GeoNetwork.form.SearchField);Ext.namespace("GeoNetwork");GeoNetwork.LoginForm=Ext.extend(Ext.FormPanel,{url:"",catalogue:undefined,defaultConfig:{border:false,layout:"form",id:"loginForm",hideLoginLabels:true,width:340},defaultType:"textfield",userInfo:undefined,username:undefined,password:undefined,toggledFields:[],toggledFieldsOff:[],keys:[{key:[Ext.EventObject.ENTER],handler:function(){Ext.getCmp("btnLoginForm").fireEvent("click");}}],initComponent:function(){Ext.applyIf(this,this.defaultConfig);var g=this;var h=new Ext.Button({width:50,text:OpenLayers.i18n("login"),iconCls:"md-mn mn-login",id:"btnLoginForm",listeners:{click:function(){this.catalogue.login(this.username.getValue(),this.password.getValue());},scope:g}}),e=new Ext.Button({width:80,text:OpenLayers.i18n("administration"),listeners:{click:function(){catalogue.admin();},scope:this}}),f=new Ext.Button({width:80,text:OpenLayers.i18n("logout"),iconCls:"md-mn mn-logout",listeners:{click:function(){catalogue.logout();},scope:this}});this.username=new Ext.form.TextField({id:"username",name:"username",width:70,hideLabel:false,allowBlank:false,fieldLabel:OpenLayers.i18n("username"),emptyText:OpenLayers.i18n("username")});this.password=new Ext.form.TextField({name:"password",width:70,hideLabel:false,allowBlank:false,fieldLabel:OpenLayers.i18n("password"),emptyText:OpenLayers.i18n("password"),inputType:"password"});this.userInfo=new Ext.form.Label({width:170,text:"",cls:"loginInfo"});if(this.hideLoginLabels){this.toggledFields.push(this.username,this.password,h);}else{var a=new Ext.form.Label({html:OpenLayers.i18n("username")}),d=new Ext.form.Label({html:OpenLayers.i18n("password")});this.toggledFields.push(a,this.username,d,this.password,h);}this.toggledFieldsOff.push(this.userInfo,f);if(this.catalogue.adminAppUrl!==""){this.toggledFieldsOff.push(e);}this.items=[this.toggledFields,this.toggledFieldsOff];GeoNetwork.LoginForm.superclass.initComponent.call(this);var b=this.catalogue.isLoggedIn();this.login(this.catalogue,b);this.catalogue.on("afterLogin",this.login,this);this.catalogue.on("afterLogout",this.login,this);},login:function(b,a){var d=a?true:false;Ext.each(this.toggledFields,function(e){e.setVisible(!d);});Ext.each(this.toggledFieldsOff,function(e){e.setVisible(d);});if(b.identifiedUser&&b.identifiedUser.username){this.userInfo.setText(b.identifiedUser.name+" "+b.identifiedUser.surname+" <br/>("+b.identifiedUser.role+")",false);}else{this.userInfo.setText("");}this.doLayout(false,true);}});Ext.reg("gn_loginform",GeoNetwork.LoginForm);Ext.namespace("GeoNetwork");GeoNetwork.MetadataMenu=Ext.extend(Ext.menu.Menu,{record:undefined,setRecord:function(a){this.record=a;this.updateMenu();},resultsView:undefined,catalogue:undefined,editAction:undefined,deleteAction:undefined,zoomToAction:undefined,otherActions:undefined,adminMenuSeparator:undefined,duplicateAction:undefined,createChildAction:undefined,adminAction:undefined,categoryAction:undefined,viewAction:undefined,printAction:undefined,viewXMLAction:undefined,getMEFAction:undefined,ratingWidget:undefined,defaultConfig:{},create:function(){this.editAction=new Ext.Action({text:OpenLayers.i18n("edit"),iconCls:"md-mn-edit",handler:function(){var a=this.record.get("id");this.catalogue.metadataEdit(a);},scope:this});this.add(this.editAction);
this.deleteAction=new Ext.Action({text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){var a=this.record.get("uuid");this.catalogue.metadataDelete(a);},scope:this});this.add(this.deleteAction);this.duplicateAction=new Ext.Action({text:OpenLayers.i18n("duplicate"),iconCls:"md-mn-copy",handler:function(){var a=this.record.get("id");GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,a,OpenLayers.i18n("duplicate"),false);},scope:this});this.createChildAction=new Ext.Action({text:OpenLayers.i18n("createChild"),iconCls:"md-mn-copy",handler:function(){var a=this.record.get("id");GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,a,OpenLayers.i18n("createChild"),true);},scope:this});this.adminAction=new Ext.Action({text:OpenLayers.i18n("privileges"),iconCls:"privIcon",handler:function(){var a=this.record.get("id");this.catalogue.metadataAdmin(a);},scope:this});this.categoryAction=new Ext.Action({text:OpenLayers.i18n("categories"),handler:function(){var a=this.record.get("id");this.catalogue.metadataCategory(a);},scope:this});this.otherActions=new Ext.menu.Item({text:OpenLayers.i18n("otherActions"),menu:{items:[this.duplicateAction,this.createChildAction,this.adminAction,this.categoryAction]}});this.add(this.otherActions);this.adminMenuSeparator=new Ext.menu.Separator();this.add(this.adminMenuSeparator);this.viewAction=new Ext.Action({text:OpenLayers.i18n("view"),iconCls:"md-mn-view",handler:function(){var a=this.record.get("uuid");this.catalogue.metadataShow(a);},scope:this});this.add(this.viewAction);this.zoomToAction=new Ext.Action({text:OpenLayers.i18n("zoomTo"),iconCls:"zoomlayer",handler:function(){var a=this.record.get("uuid");this.resultsView.zoomTo(a);},scope:this});this.add(this.zoomToAction);this.viewXMLAction=new Ext.Action({text:OpenLayers.i18n("saveXml"),iconCls:"xmlIcon",handler:function(){var b=this.record.get("uuid");var a=this.record.get("schema");this.catalogue.metadataXMLShow(b,a);},scope:this});this.add(this.viewXMLAction);this.printAction=new Ext.Action({text:OpenLayers.i18n("printSel"),iconCls:"md-mn-pdf",handler:function(){this.catalogue.metadataPrint(this.record.get("uuid"));},scope:this});this.add(this.printAction);this.getMEFAction=new Ext.Action({text:OpenLayers.i18n("getMEF"),iconCls:"md-mn-zip",handler:function(){this.catalogue.metadataMEF(this.record.get("uuid"));},scope:this});this.add(this.getMEFAction);if(Ext.ux.RatingItem){this.ratingWidget=new Ext.ux.RatingItem(null,{canReset:false,name:"rating",disabled:true,nbStars:5,cls:"ux-menu-rating-item",listeners:{change:function(b,a,f){if(a){var d=this.record.get("uuid");this.catalogue.metadataRate(d,a,this.hide());this.ratingWidget.reset();}},scope:this}});this.add(this.ratingWidget);}this.updateMenu();},updateMenu:function(){if(!this.record){return;}var a=this.record.get("edit")==="true"?(this.record.get("isharvested")==="y"?GeoNetwork.Settings.editor.editHarvested||false:true):false,d=this.record.get("isharvested")==="y"?true:false,e=this.record.get("harvestertype"),b=this.catalogue.isIdentified();if(!b){this.editAction.hide();this.deleteAction.hide();}else{this.editAction.show();this.deleteAction.show();}this.otherActions.setVisible(b);this.adminMenuSeparator.setVisible(b);this.editAction.setDisabled(!a);this.adminAction.setDisabled(!a&&!d);this.categoryAction.setDisabled(!a&&!d);this.deleteAction.setDisabled(!a&&!d);if(this.ratingWidget){this.ratingWidget.reset();if(d&&e!=="geonetwork"){this.ratingWidget.disable();}else{this.ratingWidget.enable();}}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);GeoNetwork.MetadataMenu.superclass.initComponent.call(this);this.create();}});Ext.reg("gn_metadatamenu",GeoNetwork.MetadataMenu);Ext.namespace("GeoNetwork");GeoNetwork.MetadataResultsView=Ext.extend(Ext.DataView,{catalogue:undefined,templates:null,overClass:"md-over",itemSelector:"li.md",emptyText:"",autoWidth:true,maps:[],mapsProjection:"EPSG:4326",projectionFrom:undefined,projectionTo:undefined,mdSelectionUuids:[],layer_style:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),layer_style_hover:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),layer_style_selected:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),features:[],hover_feature:[],displayContextualMenu:true,contextMenu:undefined,contextMenuNodeId:undefined,acMenu:undefined,displaySerieMembers:false,maxOfMembers:50,relatedTpl:undefined,newMetadataWindow:undefined,plugins:[],listeners:{dblclick:{fn:function(f,d,a,b){if(this.maps.length!==0){var g=this.getStore().getAt(d);var h=g.get("uuid");this.zoomTo(h);}}},mouseenter:{fn:function(h,f,m,d){var a,q;if(this.maps.length!==0){var b=this.getStore().getAt(f);var g=b.get("uuid");for(q=0;q<this.maps.length;q++){var o=this.maps[q].layer;if(o.features){for(a=0;a<o.features.length;a++){if(g===o.features[a].attributes.id){if(!this.hover_feature[q]){o.drawFeature(o.features[a],this.layer_style_hover);this.hover_feature[q]=o.features[a];}continue;}}}}}this.actionMenuInit(f,m);}},mouseleave:{fn:function(h,d,a,b){var f;if(this.acMenu){this.acMenu.hide();}this.acMenu=undefined;for(f=0;f<this.maps.length;f++){if(this.hover_feature[f]){var g=this.maps[f].layer;g.drawFeature(this.hover_feature[f],this.layer_style);this.hover_feature[f]=null;continue;}}}},contextmenu:{fn:function(f,d,a,b){if(this.displayContextualMenu){this.contextMenuNodeId=d;this.createMenu(d,f);this.contextMenu.showAt(b.getXY());b.stopEvent();}}}},actionMenuInit:function(a,b){this.acMenu=Ext.get(Ext.DomQuery.selectNode("span.md-action-menu",b));this.acMenu.on("click",function(){this.createMenu(a,this);this.contextMenu.showAt([this.acMenu.getX(),this.acMenu.getY()+this.acMenu.getHeight()]);}.bind(this));this.acMenu.show();},createMenu:function(a,d){var b=this.getStore().getAt(a);if(!this.contextMenu){this.contextMenu=new GeoNetwork.MetadataMenu({floating:true,catalogue:catalogue,record:b,resultsView:d});}else{this.contextMenu.setRecord(b);}},zoomTo:function(b){var a,f;for(f=0;f<this.maps.length;f++){var e=this.maps[f].layer;if(e.features){for(a=0;a<e.features.length;a++){if(b===e.features[a].attributes.id){var d=e.features[a].geometry.getBounds();if(d){this.maps[f].map.zoomToExtent(d);}break;}}}}},initComponent:function(){var d;this.templates=this.templates||{SIMPLE:GeoNetwork.Templates.SIMPLE,THUMBNAIL:GeoNetwork.Templates.THUMBNAIL,FULL:GeoNetwork.Templates.FULL};GeoNetwork.MetadataResultsView.superclass.initComponent.call(this);this.setStore(this.catalogue.metadataStore);this.initStyle();this.relatedTpl=new Ext.XTemplate(this.relatedTpl||GeoNetwork.Templates.Relation.SHORT);if(this.maps){if(this.maps instanceof OpenLayers.Map){var a=this.maps;this.maps=[];this.addMap(a);}else{for(d=0;d<this.maps.length;d++){var b=this.maps[d];this.initMap(b);}}}else{this.maps=[];}this.on("selectionchange",this.selectionChange);},setStore:function(a){this.store=a;this.getStore().on({load:this.resultsLoaded,clear:this.destroyMetadataBbox,scope:this});},addMap:function(b,d){var a=false,f;for(f=0;f<this.maps.length;f++){if(this.maps[f].map.id===b.id){a=true;break;}}if(!a){var e={map:b,zoomToExtentOnSearch:d||false};this.mapsProjection=b.projection;this.projectionFrom=new OpenLayers.Projection("EPSG:4326");this.projectionTo=new OpenLayers.Projection(this.mapsProjection);this.maps.push(e);this.initMap(e);}},initMap:function(b){var a=new OpenLayers.Layer.Vector(OpenLayers.i18n("mdResultsLayer"),{style:this.layer_style});this.addCurrentFeatures(a);b.layer=a;b.map.addLayer(a);},removeMap:function(a){this.maps.splice(a,1);},getTemplates:function(){return this.templates;},removeTemplate:function(a){delete this.templates[a];},addTemplate:function(a,b){this.templates[a]=b;},applyTemplate:function(a){this.tpl=this.templates[a];this.refresh();},initStyle:function(){this.layer_style.fillOpacity=0;this.layer_style.graphicOpacity=1;this.layer_style_selected.fillOpacity=0.1;this.layer_style_hover.fillOpacity=0.3;this.layer_style_hover.strokeWidth=3;},destroyMetadataBbox:function(){var b;
for(b=0;b<this.maps.length;b++){var a=this.maps[b].layer;if(a.features){if(a.features.length>0){this.features=[];a.destroyFeatures();}}}},resultsLoaded:function(b,d,a){this.drawMetadataBbox(b,d,a);this.contextMenu=undefined;this.initRatingWidget();this.dislayLinks(d);},dislayLinks:function(d){var a="children",b=this;if(this.displaySerieMembers){Ext.each(d,function(h){var e=h.get("type")==="series",f=h.get("id");if(e){var g=new GeoNetwork.data.MetadataRelationStore(this.catalogue.services.mdRelation+"?type="+a+"&fast=false&uuid="+escape(h.get("uuid")),null,true);g.load();g.on("load",function(l,j){Ext.each(j,function(q){var r=Ext.query("#md-relation-"+f,b.el.dom.body),o=Ext.get(r[0]),m=o.parent();if(m&&m.isScrollable()){m.addClass("more");}if(o){o.insertHtml("beforeEnd",b.relatedTpl.apply(q.data));m.setVisible(true);}},this);});}},this);}},drawMetadataBbox:function(e,f,a){var b,g;if(this.maps.length===0){return;}this.features=[];Ext.each(f,function(q){var u=q.get("bbox");if(u){var z=[];for(g=0;g<u.length;g++){var m=u[g].value;var j=new OpenLayers.Geometry.Point(m[2],m[1]);var l=new OpenLayers.Geometry.Point(m[2],m[3]);var h=new OpenLayers.Geometry.Point(m[0],m[3]);var w=new OpenLayers.Geometry.Point(m[0],m[1]);if(this.mapsProjection!=="EPSG:4326"){j.transform(this.projectionFrom,this.projectionTo);l.transform(this.projectionFrom,this.projectionTo);h.transform(this.projectionFrom,this.projectionTo);w.transform(this.projectionFrom,this.projectionTo);}var o=[j,l,h,w,j];var s=new OpenLayers.Geometry.LinearRing(o);var v=new OpenLayers.Geometry.Polygon([s]);z.push(v.clone());}var t=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(z),{id:q.get("uuid")});this.features.push(t.clone());}},this);for(b=0;b<this.maps.length;b++){this.addCurrentFeatures(this.maps[b].layer);}if(this.features.length>0){for(b=0;b<this.maps.length;b++){var d=this.maps[b];if(d.zoomToExtentOnSearch){d.map.zoomToExtent(d.layer.getDataExtent());}}}},initRatingWidget:function(){var a=Ext.DomQuery.select("div.rating"),b;for(b=0;b<a.length;++b){if(Ext.ux.RatingItem){var d=new Ext.ux.RatingItem(a[b],{disabled:true,name:"rating"+b});}else{a[b].style.display="none";}}},selectAll:function(){var b=Ext.DomQuery.select("input.selector"),a;for(a=0;a<b.length;++a){b[a].checked=true;}},selectAllInPage:function(){var b=Ext.DomQuery.select("input.selector"),a;for(a=0;a<b.length;++a){b[a].checked=true;Ext.each(this.getRecords(this.getNodes()),function(e){var d=e.get("uuid");this.catalogue.metadataSelect("add",[d]);},this);}},selectNone:function(){var b=Ext.DomQuery.select("input.selector"),a;for(a=0;a<b.length;++a){b[a].checked=false;}},selectionChange:function(f,b){if(this.catalogue){var a=this.getRecords(b);var j={};var e=[];var h=[];var d;var g;for(d=0;d<a.length;d++){g=a[d].get("uuid");j[g]=true;}for(d=0;d<this.mdSelectionUuids.length;d++){g=this.mdSelectionUuids[d];if(j[g]){e.push(g);}else{h.push(g);}}for(g in j){if(j.hasOwnProperty(g)&&!this.mdSelectionUuids[g]){e.push(g);}}this.catalogue.metadataSelect("add",e);this.catalogue.metadataSelect("remove",h);this.mdSelectionUuids=e;}},addCurrentFeatures:function(f){var d=this.features.length,e;if(d>0){var g=[];g=[];var b,a;for(e=0;e<d;e++){b=this.features[e];a=b.clone();g[e]=a;}f.addFeatures(g);}},onDestroy:function(){GeoNetwork.MetadataResultsView.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gn_metadataresultsview",GeoNetwork.MetadataResultsView);Ext.namespace("GeoNetwork");GeoNetwork.MetadataResultsToolbar=Ext.extend(Ext.Toolbar,{catalogue:undefined,metadataResultsView:undefined,mdSelectionInfoCmp:undefined,searchBtCmp:undefined,sortByCmp:undefined,sortByCombo:undefined,mdSelectionInfo:"md-selection-info",selectionActions:[],deleteAction:undefined,otherItem:undefined,ownerAction:undefined,updateCategoriesAction:undefined,updatePrivilegesAction:undefined,createMetadataAction:undefined,newMetadataWindow:undefined,mdImportAction:undefined,adminAction:undefined,actionMenu:undefined,item:null,actionOnSelectionMenu:undefined,admin:false,initComponent:function(){var a=[];a.push(this.createSelectionToolBar());a.push(["->"]);var b=this.getSortByCombo();a.push(OpenLayers.i18n("sortBy"),b,"|");a.push(this.createTemplateMenu());a.push(this.createOtherActionMenu());GeoNetwork.MetadataResultsToolbar.superclass.initComponent.call(this);this.add(a);this.catalogue.on("selectionchange",this.updateSelectionInfo,this);this.catalogue.on("afterLogin",this.updatePrivileges,this);this.catalogue.on("afterLogout",this.updatePrivileges,this);this.updateSelectionInfo(this.catalogue,0);},getSortByCombo:function(){var a=this;this.sortByCombo=new Ext.form.ComboBox({mode:"local",id:"sortByToolBar",triggerAction:"all",value:"relevance",width:130,store:GeoNetwork.util.SearchFormTools.getSortByStore(),valueField:"id",displayField:"name",listeners:{select:function(d,e,b){if(this.sortByCmp){this.sortByCmp.setValue(d.getValue());var f=d.getValue().split("#");Ext.getCmp("E_sortBy").setValue(f[0]);Ext.getCmp("sortOrder").setValue(f[1]);}if(this.searchBtCmp){this.searchBtCmp.fireEvent("click");}},scope:a}});return this.sortByCombo;},clickTemplateMenu:function(a,b){if(b){this.applyTemplate(a.getId());}this.initRatingWidget();},createMassiveActionMenu:function(a){this.deleteAction=new Ext.menu.Item({text:OpenLayers.i18n("delete"),iconCls:"cancel",id:"deleteAction",handler:function(){this.catalogue.massiveOp("Delete",function(){this.catalogue.metadataSelectNone();});},scope:this,hidden:a});this.ownerAction=new Ext.menu.Item({text:OpenLayers.i18n("newOwner"),id:"ownerAction",handler:function(){this.catalogue.massiveOp("NewOwner");},scope:this,hidden:a});this.updateCategoriesAction=new Ext.menu.Item({text:OpenLayers.i18n("updateCategories"),id:"updateCategoriesAction",handler:function(){this.catalogue.massiveOp("Categories");},scope:this,hidden:a});this.updatePrivilegesAction=new Ext.menu.Item({text:OpenLayers.i18n("updatePrivileges"),id:"updatePrivilegesAction",iconCls:"privIcon",handler:function(){this.catalogue.massiveOp("Privileges");},scope:this,hidden:a});this.selectionActions.push(this.deleteAction,this.ownerAction,this.updateCategoriesAction,this.updatePrivilegesAction);this.actionMenu.addItem(this.deleteAction);this.actionMenu.addItem(this.ownerAction);this.actionMenu.addItem(this.updateCategoriesAction);this.actionMenu.addItem(this.updatePrivilegesAction);},createAdminMenu:function(a){this.actionMenu.addItem("-");this.otherItem=new Ext.menu.TextItem({html:'<b class="menu-title">'+OpenLayers.i18n("adminAction")+"</b>",hidden:true});this.actionMenu.addItem(this.otherItem);this.createMetadataAction=new Ext.menu.Item({text:OpenLayers.i18n("newMetadata"),iconCls:"addIcon",handler:function(){if(this.newMetadataWindow){this.newMetadataWindow.close();this.newMetadataWindow=undefined;}if(!this.newMetadataWindow){var b=new GeoNetwork.editor.NewMetadataPanel({getGroupUrl:this.catalogue.services.getGroups,catalogue:this.catalogue});this.newMetadataWindow=new Ext.Window({title:OpenLayers.i18n("newMetadata"),width:600,height:420,layout:"fit",modal:true,items:b,closeAction:"hide",constrain:true,iconCls:"addIcon"});}this.newMetadataWindow.show();},scope:this,hidden:a});this.actionMenu.addItem(this.createMetadataAction);this.mdImportAction=new Ext.menu.Item({text:OpenLayers.i18n("importMetadata"),handler:function(){this.catalogue.metadataImport();},scope:this,hidden:a});this.actionMenu.addItem(this.mdImportAction);this.adminAction=new Ext.menu.Item({text:OpenLayers.i18n("administration"),handler:function(){this.catalogue.admin();},scope:this,hidden:a});this.actionMenu.addItem(this.adminAction);},createTemplateMenu:function(){var b=this.metadataResultsView.getTemplates();var a=[];var d;for(d in b){if(b.hasOwnProperty(d)){var e=new Ext.Button({text:"",enableToggle:true,toggleGroup:"tpl",id:d,iconCls:"mn-view-"+d.toLowerCase(),toggleHandler:this.clickTemplateMenu,scope:this.metadataResultsView,pressed:(d==="FULL"?true:false)});a.push(e);}}return[a,"|"];},createOtherActionMenu:function(){this.actionMenu=new Ext.menu.Menu();
var a=new Ext.Action({text:OpenLayers.i18n("exportCsv"),handler:function(){this.catalogue.csvExport();},scope:this});var d=new Ext.Action({text:OpenLayers.i18n("exportZip"),iconCls:"md-mn-zip",handler:function(){this.catalogue.mefExport();},scope:this});var b=new Ext.Action({text:OpenLayers.i18n("printSel"),iconCls:"md-mn-pdf",handler:function(){this.catalogue.pdfExport();},scope:this});this.selectionActions.push(d,a,b);this.actionMenu.add('<b class="menu-title">'+OpenLayers.i18n("onSelection")+"</b>",d,a,b);this.createMassiveActionMenu(!this.catalogue.isIdentified());this.createAdminMenu(!this.catalogue.isIdentified());this.actionOnSelectionMenu=new Ext.Button({text:OpenLayers.i18n("otherActions"),menu:this.actionMenu});return this.actionOnSelectionMenu;},createSelectionToolBar:function(){var e=new Ext.Action({text:OpenLayers.i18n("allInPage"),handler:function(){this.metadataResultsView.selectAllInPage();},scope:this});var d=new Ext.Action({text:OpenLayers.i18n("all"),handler:function(){this.catalogue.metadataSelectAll();this.metadataResultsView.selectAll();},scope:this});var a=new Ext.Action({text:OpenLayers.i18n("none"),handler:function(){this.catalogue.metadataSelectNone();this.metadataResultsView.selectNone();},scope:this});var b={id:"md-selection-info",xtype:"tbtext",text:OpenLayers.i18n("noneSelected")};this.catalogue.on("selectionchange",this.updateSelectionInfo,this);return[b,"|",{xtype:"tbtext",text:OpenLayers.i18n("select")},e,{xtype:"tbtext",text:", "},d,{xtype:"tbtext",text:", "},a];},updateSelectionInfo:function(b,a){if(!this.mdSelectionInfoCmp){this.mdSelectionInfoCmp=Ext.getCmp(this.mdSelectionInfo);}Ext.each(this.selectionActions,function(d){if(a===0){d.disable();}else{d.enable();}});this.mdSelectionInfoCmp.setText(a+" "+OpenLayers.i18n("selected"));},updatePrivileges:function(a,b){var d=[this.deleteAction,this.ownerAction,this.updateCategoriesAction,this.updatePrivilegesAction,this.createMetadataAction,this.mdImportAction,this.mdImportAction,this.adminAction,this.otherItem];Ext.each(d,function(){this.setVisible(b);});},onDestroy:function(){GeoNetwork.MetadataResultsToolbar.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gn_metadataresultstoolbar",GeoNetwork.MetadataResultsToolbar);Ext.namespace("GeoNetwork");GeoNetwork.TagCloudView=Ext.extend(Ext.DataView,{catalogue:undefined,multiSelect:true,root:"keywords.keyword",qurey:undefined,searchField:"themekey",onSuccess:null,onFailure:null,overClass:"tag-cloud-hover",itemSelector:"li.tag-cloud",emptyText:"",autoWidth:true,initComponent:function(){GeoNetwork.TagCloudView.superclass.initComponent.call(this);this.tpl=this.tpl||new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="tag-cloud tag-cloud-{class}">','<a href="#" onclick="javascript:catalogue.kvpSearch(\'fast='+this.catalogue.metadataStore.fast+"&summaryOnly=0&from=1&to=20&hitsPerPage=20&"+this.searchField+"={value}', "+this.onSuccess+","+this.onFailure+', null);" alt="{value}" title="{count} records">{value}</a>',"</li>","</tpl>","</ul>");this.store=this.catalogue.summaryStore;if(this.query){this.catalogue.kvpSearch(this.query,null,null,null,true);}}});Ext.reg("gn_tagcloudview",GeoNetwork.TagCloudView);Ext.namespace("GeoNetwork");GeoNetwork.Templates=Ext.extend(Ext.XTemplate,{compiled:false,disableFormats:false,catalogue:null,sortOrder:0,abstractMaxSize:50,xmlTplMarkup:['<?xml version="1.0" encoding="UTF-8"?>','<node id="{id}" type="{type}">',"<site>","<name>{site_name}</name>",'<tpl if="values.site_ogctype">',"<ogctype>{site_ogctype}</ogctype>","</tpl>",'<tpl if="values.site_url">',"<url>{site_url}</url>","</tpl>",'<tpl if="values.site_icon">',"<icon>{site_icon}</icon>","</tpl>",'<tpl if="values.site_account_use">',"<account>","<use>{site_account_use}</use>","<username>{site_account_username}</username>","<password>{site_account_password}</password>","</account>","</tpl>","</site>","<options>",'<tpl if="values.options_every">',"<every>{options_every}</every>","</tpl>",'<tpl if="values.options_onerunonly">',"<oneRunOnly>{options_onerunonly}</oneRunOnly>","</tpl>",'<tpl if="values.options_lang">',"<lang>{options_lang}</lang>","</tpl>",'<tpl if="values.options_topic">',"<topic>{options_topic}</topic>","</tpl>",'<tpl if="values.options_createthumbnails">',"<createThumbnails>{options_createthumbnails}</createThumbnails>","</tpl>",'<tpl if="values.options_uselayer">',"<useLayer>{options_uselayer}</useLayer>","</tpl>",'<tpl if="values.options_uselayermd">',"<useLayerMd>{options_uselayermd}</useLayerMd>","</tpl>",'<tpl if="values.options_datasetcategory">',"<datasetcategory>{options_datasetcategory}</datasetcategory>","</tpl>","</options>","<content>","</content>","<privileges>","</privileges>",'<group id="1">','<operation name="view" />','<operation name="dynamic" />',"</group>","<categories>","</categories>",'<tpl if="values.info_result_total">',"</tpl>","</node>"],initComponent:function(){GeoNetwork.Templates.superclass.initComponent.call(this);},getHarvesterTemplate:function(){return new Ext.XTemplate(this.xmlTplMarkup);}});GeoNetwork.Templates.TITLE='<h1><input type="checkbox" <tpl if="selected==\'true\'">checked="true"</tpl> class="selector" onclick="javascript:catalogue.metadataSelect((this.checked?\'add\':\'remove\'), [\'{uuid}\']);"/><a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');return false;">{title}</a><span class="md-action-menu"> - <a rel="mdMenu">'+OpenLayers.i18n("mdMenu")+"</a></span></h1>";GeoNetwork.Templates.RATING_TPL='<tpl if="isharvested==\'n\' || harvestertype==\'geonetwork\'"><div class="rating"><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'1\'">checked="true"</tpl> value="1"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'2\'">checked="true"</tpl> value="2"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'3\'">checked="true"</tpl> value="3"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'4\'">checked="true"</tpl> value="4"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'5\'">checked="true"</tpl> value="5"/></div></tpl>';GeoNetwork.Templates.LOGO='<div class="md-logo"><img src="{[catalogue.URL]}/images/logos/{source}.gif"/></div>';GeoNetwork.Templates.SIMPLE=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-simple" title="{abstract}">','<table><tr><td style="width:30px;">',GeoNetwork.Templates.LOGO,'</td><td id="{uuid}">',GeoNetwork.Templates.TITLE,'<tpl if="subject">','<span class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></span>","</tpl>","</td></tr></table>","</li>","</tpl>","</ul>");GeoNetwork.Templates.THUMBNAIL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-thumbnail">','<div class="md-wrap" id="{uuid}" title="{abstract}">',GeoNetwork.Templates.TITLE,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="{thumbnail}"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>",'<tpl for="links">',"<tpl if=\"values.type == 'application/vnd.ogc.wms_xml'\">","<a href=\"#\" class=\"md-mn addLayer\" title=\"{title}\" alt=\"{title}\" onclick=\"app.switchMode('1', true);app.getIMap().addWMSLayer([['{title}', '{href}', '{name}', '{id}']]);\">&nbsp;</a>","</tpl>","</tpl>","</div>","</li>","</tpl>","</ul>");GeoNetwork.Templates.FULL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-full">',"<table><tr>",'<td class="left">',GeoNetwork.Templates.LOGO,"</td>",'<td id="{uuid}">',GeoNetwork.Templates.TITLE,'<p class="abstract">{[values.abstract.substring(0, 350)]} ...</p>','<tpl if="subject">','<p class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></p>","</tpl>",'<div class="md-links">','<tpl for="links">',"<tpl if=\"values.type == 'application/vnd.ogc.wms_xml' || values.type == 'OGC:WMS'\">",'<a href="#" class="md-mn addLayer" title="'+OpenLayers.i18n("addToMap")+" {title}\" alt=\"Add layer to map\" onclick=\"app.switchMode('1', true);app.getIMap().addWMSLayer([['{[escape(values.title)]}', '{href}', '{name}', '{id}']]);\">&nbsp;</a>","</tpl>","<tpl if=\"values.type == 'application/vnd.google-earth.kml+xml'\">",'<a href="{href}" class="md-mn md-mn-kml" title="'+OpenLayers.i18n("viewKml")+' {title}" alt="Open kml">&nbsp;</a>',"</tpl>","<tpl if=\"values.type == 'application/zip' || values.type == 'application/x-compressed'\">",'<a href="{href}" class="md-mn md-mn-zip" title="'+OpenLayers.i18n("downloadLink")+' {title}" alt="Download">&nbsp;</a>',"</tpl>","<tpl if=\"values.type == 'text/html'\">",'<a href="{href}" class="md-mn md-mn-www" title="'+OpenLayers.i18n("webLink")+' {title}" alt="Web link" target="_blank">&nbsp;</a>',"</tpl>","</tpl>",'<tpl if="this.hasDownloadLinks(values.links)">','<a href="#" onclick="catalogue.metadataPrepareDownload({id});" class="md-mn downloadAllIcon" title="'+OpenLayers.i18n("prepareDownload")+'" alt="download">&nbsp;</a>',"</tpl>","</div>",'</td><td class="thumb">',GeoNetwork.Templates.RATING_TPL,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="{thumbnail}"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>",'</td><td class="icon">','<div class="md-mn valid-{valid}" title="'+OpenLayers.i18n("validityInfo"),'<tpl for="valid_details">',"{values.type}: ","<tpl if=\"values.valid == '1'\">"+OpenLayers.i18n("valid")+"</tpl>","<tpl if=\"values.valid == '0'\">"+OpenLayers.i18n("notValid")+"</tpl>","<tpl if=\"values.valid == '-1'\">"+OpenLayers.i18n("notDetermined")+"</tpl>","<tpl if=\"values.ratio != ''\"> ({values.ratio}) </tpl> - ","</tpl>",'">&nbsp;</div>','</td><td class="icon" title="'+OpenLayers.i18n("metadataCategories")+'">','<tpl for="category">','<div class="md-mn cat-{value}" title="{value}">&nbsp;</div>',"</tpl>","</td></tr></table>",'<div class="relation" title="'+OpenLayers.i18n("relateddatasets")+'"><span></span><ul id="md-relation-{id}"></ul></div>','<div class="md-contact">','<tpl for="contact">',"<tpl if=\"applies=='resource'\">",'<span title="{role} - {applies}"><tpl if="values.logo !== undefined && values.logo !== \'\'">','<img src="{logo}" class="orgLogo"/>',"</tpl>","{name}&nbsp;&nbsp;</span>","</tpl>","</tpl>","<tpl if=\"edit=='true' && isharvested!='y'\">",'<br/><span class="md-mn md-mn-user" title="'+OpenLayers.i18n("ownerName")+'">{ownername} - '+OpenLayers.i18n("lastUpdate")+"{[values.changedate.split('T')[0]]}</span>","</tpl>","</div>","</li>","</tpl>","</ul>",{hasDownloadLinks:function(a){var b;
for(b=0;b<a.length;b++){if(a[b].type==="application/x-compressed"){return true;}}return false;}});GeoNetwork.Templates.Relation={SHORT:['<li class="{type}">','<a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');return false;" title="{abstract}">{title}</a>',"</li>"]};Ext.namespace("GeoNetwork.view");GeoNetwork.view.ViewWindow=Ext.extend(Ext.Window,{defaultConfig:{layout:"fit",width:700,height:740,border:false,lang:"en",autoScroll:true,closeAction:"destroy",currTab:"simple",displayTooltip:true,printDefaultForTabs:false,printMode:undefined,relationTypes:"service|children|related|parent|dataset|fcat",maximizable:true,maximized:false,collapsible:true,collapsed:false},serviceUrl:undefined,catalogue:undefined,metadataUuid:undefined,record:undefined,resultsView:undefined,actionMenu:undefined,tipTpl:undefined,metadataSchema:undefined,cache:{},tooltips:[],relatedTpl:undefined,getLinkedData:function(){var b=new GeoNetwork.data.MetadataRelationStore(this.catalogue.services.mdRelation+"?type="+this.relationTypes+"&fast=false&uuid="+escape(this.metadataUuid),null,true),a=this;b.load();b.on("load",function(){this.each(a.displayLinkedData,a);});},displayLinkedData:function(d){var b=Ext.query("table.related",this.body.dom),g=d.get("type");var f=Ext.get(b[0]);var e=f.child("tr td[class*="+g+"]");var a=this.relatedTpl.apply(d.data);if(e!==null){e.next().child("li").insertHtml("afterEnd",a);}else{f.child("tr").insertHtml("beforeBegin",'<tr><td class="main '+g+'"><span class="cat-'+g+' icon">'+OpenLayers.i18n("related"+g)+"</span></td><td><ul>"+a+"</ul></td></tr>");}},createActionMenu:function(){if(!this.actionMenu){this.actionMenu=new GeoNetwork.MetadataMenu({catalogue:this.catalogue,record:this.record,resultsView:this.resultsView});}var a={text:OpenLayers.i18n("mdMenu"),menu:this.actionMenu};return a;},createViewMenu:function(a){var b=['<b class="menu-title">'+OpenLayers.i18n("chooseAView")+"</b>"];this.viewMenu=new Ext.menu.Menu({items:b});var d={text:OpenLayers.i18n("viewMode"),iconCls:"viewModeIcon",menu:this.viewMenu};return d;},updateViewMenu:function(){var b=Ext.query("span.mode",this.body.dom),a=[],h,d,f,o=this.getId(),s=true;a.push([OpenLayers.i18n("simpleViewMode"),"view-simple",s]);Ext.ux.Lightbox.register("a[rel^=lightbox-viewset]",true);this.printMode=this.currTab;for(h=0;h<b.length;h++){if(b[h].firstChild){var t=b[h].getAttribute("id");var m=b[h].innerHTML;var l=Ext.get(b[h]).next();var g=l.query("LI");var r=l.query("LI[id="+this.currTab+"]");var q=r.length===1;if(!q){Ext.get(b[h]).parent().remove();}else{if(l&&g.length===1){l.remove();}else{for(d=0;d<g.length;d++){f=Ext.get(g[d]);if(this.printDefaultForTabs){this.printMode="default";}f.on("click",function(){Ext.getCmp(o).switchToTab(this);},f.getAttribute("id"));}}}a.push([m,t,q]);if(q===true){s=false;}}}a[0][2]=s;this.updateToolbar(a);},updateToolbar:function(a){var d,b;this.viewMenu.removeAll();for(d=0;d<a.length;d++){b=a[d];this.viewMenu.add({text:b[0],checked:false,disabled:b[2],group:"mode",value:b[1],listeners:{checkchange:this.onViewCheck,scope:this}});}this.viewMenu.doLayout();},switchToTab:function(a){this.currTab=a;this.onViewCheck({value:this.currTab},true);},onViewCheck:function(b,a){if(a){this.currTab=b.value;this.load({url:this.serviceUrl+"&currTab="+this.currTab,callback:this.afterMetadataLoad,scope:this});}},afterMetadataLoad:function(){this.cache={};this.tooltips=[];this.updateViewMenu();this.catalogue.extentMap.initMapDiv();if(this.currTab==="view-simple"||this.currTab==="inspire"||this.currTab==="simple"){this.getLinkedData();}this.registerTooltip();},createPrintMenu:function(){return new Ext.Button({iconCls:"print",tooltip:OpenLayers.i18n("printTT"),listeners:{click:function(b,a){window.open("print.html?uuid="+this.metadataUuid+"&currTab="+this.printMode+"&hl="+this.lang);},scope:this}});},createTooltipMenu:function(){return new Ext.Button({enableToggle:true,pressed:this.displayTooltip,iconCls:"book",tooltip:OpenLayers.i18n("enableTooltip"),listeners:{toggle:function(b,a){this.displayTooltip=a;this.enableTooltip();},scope:this}});},enableTooltip:function(){Ext.each(this.tooltips,function(b,a){if(this.displayTooltip){b.enable();}else{b.disable();}},this);},registerTooltip:function(){var a=Ext.query("th[id]",this.body.dom);a=a.concat(Ext.query("legend[id]",this.body.dom));Ext.each(a,function(g,l,d){var j=Ext.get(g);var b=j.getAttribute("id");if(j.is("TH")){var m=j.up("FIELDSET");var h=function(){if(this.displayTooltip){this.loadHelp(b,m);}};j.parent().on("mouseover",h,this);}else{var h=function(){if(this.displayTooltip){this.loadHelp(b);}};j.on("mouseover",h,this);}},this);},loadHelp:function(a,d){if(!this.cache[a]){var b=this;GeoNetwork.util.HelpTools.get(a,this.metadataSchema,this.catalogue.services.schemaInfo,function(f){b.cache[a]=b.tipTpl.apply(f.records[0].data);var e=new Ext.ToolTip({target:a,title:f.records[0].get("label"),anchor:d?"top":"bottom",anchorOffset:35,html:b.cache[a]});b.tooltips.push(e);});}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.tipTpl=new Ext.XTemplate(GeoNetwork.util.HelpTools.Templates.SIMPLE);this.relatedTpl=new Ext.XTemplate(this.relatedTpl||GeoNetwork.Templates.Relation.SHORT);this.tools=[{id:"newwindow",qtip:OpenLayers.i18n("newWindow"),handler:function(b,a,f,d){window.open(GeoNetwork.Util.getBaseUrl(location.href)+"#uuid="+this.metadataUuid);this.hide();},scope:this}];this.tbar=[this.createViewMenu(),this.createActionMenu(),"->",this.createPrintMenu(),this.createTooltipMenu()];GeoNetwork.view.ViewWindow.superclass.initComponent.call(this);this.metadataSchema=this.record?this.record.get("schema"):"";this.setTitle(this.record?this.record.get("title"):"");this.add(new Ext.Panel({autoLoad:{url:this.serviceUrl+"&currTab="+this.currTab,callback:this.afterMetadataLoad,scope:this},border:false,frame:false,autoScroll:true}));this.on("beforeshow",function(a){a.setSize(a.getWidth()>Ext.getBody().getWidth()?Ext.getBody().getWidth():a.getWidth(),a.getHeight()>Ext.getBody().getHeight()?Ext.getBody().getHeight():a.getHeight());});}});Ext.reg("gn_view_viewwindow",GeoNetwork.view.ViewWindow);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.SubTemplateSelectionPanel=Ext.extend(Ext.FormPanel,{border:false,catalogue:undefined,namespaces:{xlink:"http://www.w3.org/1999/xlink",gmd:"http://www.isotc211.org/2005/gmd",gmx:"http://www.isotc211.org/2005/gmx",gco:"http://www.isotc211.org/2005/gco",gts:"http://www.isotc211.org/2005/gts",gml:"http://www.opengis.net/gml"},id:"subTemplateSearchForm",contact:Ext.data.Record.create([{name:"xlink"},{name:"name"}]),subTemplateStore:undefined,codeListStore:undefined,subTplTypeField:undefined,addAsXLink:false,itemSelector:null,loadingMask:null,subTemplateCount:null,ref:null,name:null,elementName:null,codeListConfig:{"gmd:CI_ResponsibleParty":{xpath:"gmd:role/gmd:CI_RoleCode/@codeListValue",url:"",label:OpenLayers.i18n("contactRole"),code:"gmd:CI_RoleCode"}},codeListCombo:null,role:"",defaultRole:"pointOfContact",SubTemplateSelected:[],initComponent:function(){this.subTemplateStore=GeoNetwork.data.MetadataResultsStore();this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getSearchField()],items:[this.getSubTemplateItemSelector()]}];this.subTemplateStore.on({loadexception:function(){},beforeload:function(a,b){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();},load:function(){this.loadingMask.hide();},scope:this});this.addEvents("subTemplateSelected");this.bbar=["->",{id:"addAsXLinkCheckBox",xtype:"checkbox",checked:false,boxLabel:OpenLayers.i18n("addAsXLink"),listeners:{check:function(b,a){this.addAsXLink=a;},scope:this}},this.getCodeListCombo()," ",{id:"SubTemplateSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildSubTemplateXmlList();},scope:this}];GeoNetwork.editor.SubTemplateSelectionPanel.superclass.initComponent.call(this);
},getSearchField:function(){this.subTplTypeField=new Ext.form.TextField({name:"E__root",hidden:true,value:""});return[new GeoNetwork.form.SearchField({name:"E_any",store:this.catalogue.metadataStore,triggerAction:function(a){a.doSearch();},scope:this}),this.subTplTypeField,{xtype:"textfield",name:"E__isTemplate",hidden:true,value:"s"}];},setRef:function(a){this.ref=a;},setName:function(a){this.name=a;},setElementName:function(a){this.elementName=a;this.subTplTypeField.setValue(a);if(this.codeListConfig[a]){this.codeListCombo.setVisible(true);}else{this.codeListCombo.setVisible(false);}},setAddAsXLink:function(a){this.addAsXLink=a||false;Ext.getCmp("addAsXLinkCheckBox").setValue(this.addAsXLink);},getCodeListCombo:function(){this.codeListStore=GeoNetwork.data.CodeListStore({url:this.catalogue.services.schemaInfo,codeListName:"gmd:CI_RoleCode"});this.codeListCombo=new Ext.form.ComboBox({id:"codeList",store:this.codeListStore,triggerAction:"all",mode:"local",fieldLabel:"",displayField:"label",valueField:"code"});this.codeListStore.on({load:function(){Ext.getCmp("codeList").setValue(this.defaultRole);},scope:this});return this.codeListCombo;},getSubTemplateItemSelector:function(){var a='<tpl for="."><div class="ux-mselect-item';if(Ext.isIE||Ext.isIE7){a+='" unselectable=on';}else{a+=' x-unselectable"';}a+=">{title}</div></tpl>";this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["uuid","title"],toData:[],msWidth:320,msHeight:230,valueField:"uuid",fromTpl:a,toTpl:a,toLegend:OpenLayers.i18n("selected"),fromLegend:OpenLayers.i18n("found"),fromStore:this.subTemplateStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var b=this.getForm().findField("itemselector");b.reset.call(b);},scope:this}]});this.itemSelector.on({change:function(b){Ext.getCmp("SubTemplateSearchValidateButton").setDisabled(b.toStore.getCount()<1);}});return this.itemSelector;},buildSubTemplateXmlList:function(){if(!this.elementName){alert("Error: sub template root element name is not defined!");return;}var b="";var a="~";var e=this.itemSelector.toMultiselect.store;this.SubTemplateSelected=[];this.codeListValue="";this.subTemplateCount=0;if(this.codeListConfig[this.elementName]&&this.codeListConfig[this.elementName].xpath){b="&process="+this.codeListConfig[this.elementName].xpath+a+Ext.getCmp("codeList").getValue();}var d=this;xlinkCollection=e.collect("uuid");Ext.each(xlinkCollection,function(h,l,g){var f=d.catalogue.services.subTemplate+"?uuid="+h+b;++d.subTemplateCount;if(d.addAsXLink){var j="<"+d.name+d.generateNamespaceDeclaration()+" xlink:href='"+f+"'/>";d.SubTemplateSelected.push(j);}else{d.retrieveSubTemplate(f);}});if(this.addAsXLink){this.fireEvent("subTemplateSelected",this,this.SubTemplateSelected);this.ownerCt.hide();}e.clearFilter();},retrieveSubTemplate:function(a){Ext.getCmp("SubTemplateSearchValidateButton").disable();Ext.Ajax.request({url:a,method:"GET",scope:this,success:function(b){var d=b.responseText;if(d.indexOf(this.elementName)!==-1){this.SubTemplateSelected.push("<"+this.name+this.generateNamespaceDeclaration()+">"+b.responseText+"</"+this.name+">");}Ext.getCmp("SubTemplateSearchValidateButton").enable();this.subTemplateCount-=1;if(this.subTemplateCount===0){this.fireEvent("subTemplateSelected",this,this.SubTemplateSelected);this.ownerCt.hide();}}});},generateNamespaceDeclaration:function(b){var d="";for(var a in this.namespaces){if((b&&b[a])||!b){d+=" xmlns:"+a+'="'+this.namespaces[a]+'"';}}return d;},doSearch:function(){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();GeoNetwork.util.SearchTools.doQueryFromForm(this.id,this.catalogue,1,this.showResults.bind(this),null,false,this.subTemplateStore);},showResults:function(e){var b=new OpenLayers.Format.GeoNetworkRecords();var a=b.read(e.responseText);var d=a.records;if(d.length>0){this.subTemplateStore.loadData(a);}}});Ext.reg("gn_editor_subtemplateselectionpanel",GeoNetwork.editor.SubTemplateSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.CRSSelectionPanel=Ext.extend(Ext.FormPanel,{CRS:Ext.data.Record.create([{name:"authority"},{name:"code"},{name:"version"},{name:"codeSpace"},{name:"description"}]),crsStore:undefined,catalogue:undefined,border:false,first:null,itemSelector:null,loadingMask:null,crsCount:null,ref:null,crsSelected:"",initComponent:function(){this.crsStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchCRS,method:"GET"}),baseParams:{name:"",type:"",maxResults:50},reader:new Ext.data.XmlReader({record:"crs",id:"code"},this.CRS),fields:["code","codeSpace","authority","description","version"],sortInfo:{field:"description"}});this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getCRSTypeCombo()," ",this.getCRS(),"->",OpenLayers.i18n("maxResults"),this.getLimitInput()],items:[this.getCRSItemSelector()]}];this.crsStore.on({loadexception:function(){},beforeload:function(a,b){if(Ext.getCmp("maxResults")){a.baseParams.maxResults=Ext.getCmp("maxResults").getValue();}if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();},load:function(){this.loadingMask.hide();},scope:this});this.addEvents("crsSelected");this.bbar=["->",{id:"crsSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildCRSXmlList();},scope:this}];GeoNetwork.editor.CRSSelectionPanel.superclass.initComponent.call(this);},getCRS:function(){return new GeoNetwork.form.SearchField({id:"crsSearchField",width:240,store:this.crsStore,paramName:"name"});},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:50,width:40};},getCRSTypeCombo:function(){var a=Ext.data.Record.create([{name:"id"}]);var d=new Ext.data.Store({url:this.catalogue.services.getCRSTypes,reader:new Ext.data.XmlReader({record:"type"},a),fields:["id"]});var b=new a({filename:OpenLayers.i18n("any")});b.set("id","");d.add(b);d.load({add:true});return{xtype:"combo",width:150,id:"search-crs",value:0,store:d,triggerAction:"all",mode:"local",displayField:"id",valueField:"id",listWidth:250,listeners:{select:function(f,g,h){this.crsStore.removeAll();this.crsStore.baseParams.type=f.getValue();var e=Ext.getCmp("crsSearchField").getValue();if(e.length<1){this.crsStore.baseParams.name="";}else{this.crsStore.baseParams.name=e;}this.crsStore.reload();},clear:function(e){this.crsStore.load();},scope:this}};},getCRSItemSelector:function(){var a='<tpl for="."><div class="ux-mselect-item';if(Ext.isIE||Ext.isIE7){a+='" unselectable=on';}else{a+=' x-unselectable"';}a+=">{description}</div></tpl>";this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["code","codeSpace","authority","description","version"],toData:[],msWidth:320,msHeight:230,valueField:"code",fromTpl:a,toTpl:a,toLegend:OpenLayers.i18n("selectedCRS"),fromLegend:OpenLayers.i18n("foundCRS"),fromStore:this.crsStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var b=this.getForm().findField("itemselector");b.reset.call(b);},scope:this}]});this.itemSelector.on({change:function(b){Ext.getCmp("crsSearchValidateButton").setDisabled(b.toStore.getCount()<1);}});return this.itemSelector;},setRef:function(a){this.ref=a;},buildCRSXmlList:function(){this.crsSelected="";var a=this.itemSelector.toMultiselect.store;this.first=true;a.each(function(b){var d="<gmd:referenceSystemInfo xmlns:gmd='http://www.isotc211.org/2005/gmd'  xmlns:gco='http://www.isotc211.org/2005/gco'><gmd:MD_ReferenceSystem><gmd:referenceSystemIdentifier><gmd:RS_Identifier><gmd:code><gco:CharacterString>"+b.data.description+"</gco:CharacterString></gmd:code><gmd:codeSpace><gco:CharacterString>"+b.data.codeSpace+"</gco:CharacterString></gmd:codeSpace><gmd:version><gco:CharacterString>"+b.data.version+"</gco:CharacterString></gmd:version></gmd:RS_Identifier></gmd:referenceSystemIdentifier></gmd:MD_ReferenceSystem></gmd:referenceSystemInfo>";
this.crsSelected+=(this.first?"":"&amp;&amp;&amp;")+d;this.first=false;},this);if(this.crsSelected!==""){this.fireEvent("crsSelected",this.crsSelected);this.ownerCt.hide();}}});Ext.reg("gn_editor_crsselectionpanel",GeoNetwork.editor.CRSSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.EditorPanel=Ext.extend(Ext.Panel,{border:false,editUrl:undefined,updateUrl:undefined,frame:false,editorToolBar:undefined,tbarConfig:undefined,id:"editorPanel",defaultConfig:{defaultViewMode:"simple",layout:"border",height:800,xlinkOptions:{},utilityPanelCollapsed:false,utilityPanelConfig:{thumbnailPanel:{collapsed:false},relationPanel:{collapsed:true},validationPanel:{collapsed:true},suggestionPanel:{collapsed:true},helpPanel:{collapsed:false}}},catalogue:undefined,toolbar:undefined,validationPanel:undefined,relationPanel:undefined,helpPanel:undefined,suggestionPanel:undefined,thumbnailPanel:undefined,editorMainPanel:undefined,metadataId:undefined,versionId:undefined,metadataMode:undefined,metadataSchema:undefined,metadataType:undefined,position:undefined,relatedMetadataStore:undefined,keywordSelectionWindow:undefined,contactSelectionWindow:undefined,subTemplateSelectionWindow:undefined,crsSelectionWindow:undefined,logoSelectionWindow:undefined,linkedMetadataSelectionWindow:undefined,geoPublisherWindow:undefined,lang:undefined,fileUploadWindow:undefined,mask:undefined,managerInitialized:false,container:undefined,setContainer:function(a){if(!this.container){this.container=a;}},showLogoSelectionPanel:function(a){if(!this.logoSelectionWindow){var b=new GeoNetwork.editor.LogoSelectionPanel({ref:a,serviceUrl:this.catalogue.services.getIcons,logoAddUrl:this.catalogue.services.logoAdd,logoUrl:this.catalogue.services.harvesterLogoUrl,listeners:{logoselected:function(e,f){var d=e.store.getAt(f);Ext.getDom(e.ref).value=e.logoUrl+d.get("name");}}});this.logoSelectionWindow=new Ext.Window({title:OpenLayers.i18n("logoSelectionWindow"),width:300,height:300,layout:"fit",modal:true,items:b,closeAction:"hide",constrain:true,iconCls:"attached"});}this.logoSelectionWindow.items.get(0).setRef(a);this.logoSelectionWindow.show();},showFileUploadPanel:function(b,a){var d=this;if(this.fileUploadWindow){this.fileUploadWindow.close();this.fileUploadWindow=undefined;}if(!this.fileUploadWindow){var e=new Ext.form.FormPanel({fileUpload:true,defaultType:"textfield",items:[{name:"id",allowBlank:false,hidden:true,value:this.metadataId},{name:"access",allowBlank:false,hidden:true,value:"private"},{name:"ref",allowBlank:false,hidden:true,value:a},{name:"proto",hidden:true,value:""},{name:"overwrite",fieldLabel:"Overwrite",checked:true,xtype:"checkbox"},{xtype:"fileuploadfield",emptyText:OpenLayers.i18n("selectFile"),fieldLabel:"File",allowBlank:false,name:"f_"+a,buttonText:"",buttonCfg:{iconCls:"uploadIconAdd"}}],buttons:[{text:OpenLayers.i18n("upload"),iconCls:"attachedAdd",handler:function(){if(e.getForm().isValid()){e.getForm().submit({url:d.catalogue.services.upload,waitMsg:OpenLayers.i18n("uploading"),success:function(h,f){var g=f.result.fname;var j=Ext.getDom("_"+a);if(j){j.value=g;}d.save();d.fileUploadWindow.hide();}});}}},{text:OpenLayers.i18n("reset"),handler:function(){e.getForm().reset();}}]});this.fileUploadWindow=new Ext.Window({title:OpenLayers.i18n("fileUploadWindow"),width:300,height:300,layout:"fit",modal:true,items:e,closeAction:"hide",constrain:true,iconCls:"attached"});}this.fileUploadWindow.show();},showGeoPublisherPanel:function(g,d,b,f,l,a,j,e){var h=this;if(this.geoPublisherWindow){this.geoPublisherWindow.close();this.geoPublisherWindow=undefined;}if(!this.geoPublisherWindow){var m=new GeoNetwork.editor.GeoPublisherPanel({width:650,height:300,layers:GeoNetwork.map.BACKGROUND_LAYERS,extent:e,serviceUrl:this.catalogue.services.geopublisher,listeners:{addOnLineSource:function(r,w,v){var o;var t="";var s=(w.get("id").indexOf("mapserver")===-1?w.get("namespacePrefix")+":":"")+this.layerName;var q="_X"+j+"_"+a.replace(":","COLON");var u="<gmd:onLine xmlns:gmd=&quot;http://www.isotc211.org/2005/gmd&quot; xmlns:gco=&quot;http://www.isotc211.org/2005/gco&quot;><gmd:CI_OnlineResource><gmd:linkage><gmd:URL>${ogcurl}</gmd:URL></gmd:linkage><gmd:protocol><gco:CharacterString>${protocol}</gco:CharacterString></gmd:protocol><gmd:name><gco:CharacterString>${layerName}</gco:CharacterString></gmd:name><gmd:description><gco:CharacterString>${metadataTitle}</gco:CharacterString></gmd:description></gmd:CI_OnlineResource></gmd:onLine>";for(o in v){if(v.hasOwnProperty(o)&&v[o].checked===true){t+=OpenLayers.String.format(u,{ogcurl:w.get(o+"Url"),protocol:v[o].label,layerName:s,metadataTitle:this.metadataTitle+"("+v[o].label+")"})+"&&&";}}GeoNetwork.editor.EditorTools.addHiddenFormField(q,t);h.save();h.geoPublisherWindow.hide();}}});this.geoPublisherWindow=new Ext.Window({title:OpenLayers.i18n("geoPublisherWindowTitle"),layout:"fit",modal:true,items:m,closeAction:"hide",constrain:true,iconCls:"repository"});}this.geoPublisherWindow.items.get(0).setRef(g,d,b,f,l);this.geoPublisherWindow.setTitle(OpenLayers.i18n("geoPublisherWindowTitle")+" "+f);this.geoPublisherWindow.show();},showSubTemplateSelectionPanel:function(b,f,e){var a=this;if(this.subTemplateSelectionWindow){this.subTemplateSelectionWindow.close();this.subTemplateSelectionWindow=undefined;}if(!this.subTemplateSelectionWindow){var d=new GeoNetwork.editor.SubTemplateSelectionPanel({width:620,height:300,catalogue:this.catalogue,listeners:{subTemplateSelected:function(h,g){GeoNetwork.editor.EditorTools.addHiddenFormFieldForFragment(h,g,a);}}});this.subTemplateSelectionWindow=new Ext.Window({title:OpenLayers.i18n("SelectionWindowTitle"),layout:"fit",items:d,closeAction:"hide",constrain:true,iconCls:"searchIcon"});}this.subTemplateSelectionWindow.items.get(0).setRef(b);this.subTemplateSelectionWindow.items.get(0).setName(f);this.subTemplateSelectionWindow.items.get(0).setElementName(e);this.subTemplateSelectionWindow.items.get(0).setAddAsXLink(this.xlinkOptions.CONTACT);this.subTemplateSelectionWindow.show();},showKeywordSelectionPanel:function(b){var a=this;if(this.keywordSelectionWindow){this.keywordSelectionWindow.close();this.keywordSelectionWindow=undefined;}if(!this.keywordSelectionWindow){this.keywordSelectionPanel=new GeoNetwork.editor.KeywordSelectionPanel({catalogue:this.catalogue,listeners:{keywordselected:function(d,e){GeoNetwork.editor.EditorTools.addHiddenFormFieldForFragment(d,e,a);}}});this.keywordSelectionWindow=new Ext.Window({title:OpenLayers.i18n("keywordSelectionWindowTitle"),width:620,height:300,layout:"fit",modal:true,items:this.keywordSelectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"});}this.keywordSelectionWindow.items.get(0).setRef(b);this.keywordSelectionWindow.items.get(0).setAddAsXLink(this.xlinkOptions.KEYWORD);this.keywordSelectionWindow.show();},showCRSSelectionPanel:function(a,b){var d=this;if(!this.crsSelectionWindow){this.crsSelectionPanel=new GeoNetwork.editor.CRSSelectionPanel({catalogue:this.catalogue,listeners:{crsSelected:function(e){var f="_X"+a+"_"+b.replace(":","COLON");GeoNetwork.editor.EditorTools.addHiddenFormField(f,e);d.save();}}});this.crsSelectionWindow=new Ext.Window({title:OpenLayers.i18n("crsSelectionWindowTitle"),layout:"fit",width:620,height:300,modal:true,items:this.crsSelectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"});}this.crsSelectionWindow.items.get(0).setRef(a);this.crsSelectionWindow.show();},showLinkedMetadataSelectionPanel:function(a,e,b){var b=b||e;var d=((b==="uuidref"||b==="iso19110"||b==="")?true:false);var f=this;this.linkedMetadataSelectionPanel=new GeoNetwork.editor.LinkedMetadataSelectionPanel({ref:a,catalogue:this.catalogue,singleSelect:d,mode:b,listeners:{linkedmetadataselected:function(o,g){if(d){if(this.ref!==null){Ext.get("_"+this.ref+(e!==""?"_"+e:"")).dom.value=g[0].data.uuid;}else{if(this.mode==="iso19110"){var q=o.catalogue.services.mdRelationInsert+"?parentId="+document.mainForm.id.value+"&childUuid="+g[0].data.uuid;
var h=Ext.Ajax.request({url:q,method:"GET",success:function(r,t){var s=o.catalogue.services.mdProcessing+"?uuidref="+g[0].data.uuid+"&id="+document.mainForm.id.value+"&process=update-attachFeatureCatalogue";f.process(s);},failure:function(r,s){Ext.MessageBox.alert(OpenLayers.String.format(OpenLayers.i18n("errorAndStatusMsg"),{status:r.status,text:r.statusText}));setBunload(true);}});}}}else{var m=[];var l=g.length>1?true:false;Ext.each(g,function(s,r){if(l){e=e+"_"+r;}m.push({tag:"input",type:"hidden",id:e,name:e,value:s.data.uuid});});var j=Ext.DomHelper;j.append(Ext.get("hiddenFormElements"),m);}}}});this.linkedMetadataSelectionWindow=new Ext.Window({title:OpenLayers.i18n("linkedMetadataSelectionWindowTitle"),width:620,height:300,layout:"fit",items:this.linkedMetadataSelectionPanel,closeAction:"hide",constrain:true,iconCls:"linkIcon",modal:true});this.linkedMetadataSelectionWindow.show();},showLinkedServiceMetadataSelectionPanel:function(f,d,b){var a=this;d=Ext.getDom("serviceUrl")&&Ext.getDom("serviceUrl").value;var e=new GeoNetwork.editor.LinkedMetadataSelectionPanel({mode:f,autoWidth:true,ref:null,serviceUrl:d,catalogue:this.catalogue,region:"north",uuid:b,singleSelect:true,listeners:{linkedmetadataselected:function(m,h){var g=Ext.getCmp("getCapabilitiesLayerName").getValue();if(f==="attachService"){var l=a.catalogue.services.mdProcessingXml+"?uuid="+h[0].data.uuid+"&process=update-srv-attachDataset&uuidref="+document.mainForm.uuid.value+"&scopedName="+g;Ext.Ajax.request({url:l,method:"GET",success:function(q,s){var r=q.responseText;if(r.indexOf("Not owner")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("NotOwnerError"));}else{if(r.indexOf("error")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("error")+r);}}var o=a.catalogue.services.mdProcessing+"?id="+a.metadataId+"&process=update-onlineSrc&desc="+g+"&url="+escape(h[0].data.uri)+"&scopedName="+g;Ext.Ajax.request({url:o,method:"GET",success:function(t,u){a.updateEditor(t);},failure:function(t,u){Ext.MessageBox.alert(OpenLayers.i18n("datasetUpdateError"));setBunload(true);}});},failure:function(o,q){Ext.MessageBox.alert(OpenLayers.i18n("ServiceUpdateError"));setBunload(true);}});}else{var j=a.catalogue.services.mdProcessingXml+"?uuid="+h[0].data.uuid+"&process=update-onlineSrc&desc="+g+"&url="+d+"&scopedName="+g;Ext.Ajax.request({url:j,method:"GET",success:function(o,r){var q=o.responseText;if(q.indexOf("Not owner")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("NotOwnerError"));}else{if(q.indexOf("error")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("error")+q);}}a.process(a.catalogue.services.mdProcessing+"?uuid="+document.mainForm.uuid.value+"&process=update-srv-attachDataset&uuidref="+h[0].data.uuid+"&scopedName="+g);},failure:function(o,q){Ext.MessageBox.alert(OpenLayers.i18n("ServiceUpdateError"));setBunload(true);}});}},scope:this}});this.linkedMetadataSelectionWindow=new Ext.Window({title:(f==="attachService"?OpenLayers.i18n("associateService"):OpenLayers.i18n("associateDataset")),layout:"fit",width:620,height:400,items:e,closeAction:"hide",constrain:true,iconCls:"linkIcon",modal:true});this.linkedMetadataSelectionWindow.show();},switchToTab:function(a){Ext.getDom("currTab").value=a;this.save();},finish:function(){this.loadUrl("metadata.update.finish",undefined,this.closeCallback);},save:function(){this.loadUrl("metadata.update.new",undefined,this.loadCallback);},callAction:function(a){this.loadUrl(a,undefined,this.loadCallback);},validate:function(){this.loadUrl("metadata.update.new","validate",this.loadCallback);this.validationPanel.expand(true);},reset:function(){this.loadUrl("metadata.update.forget.new",undefined,this.loadCallback);},cancel:function(){this.loadUrl("metadata.update.forgetandfinish",undefined,this.closeCallback);},process:function(a){this.loadUrl(a,undefined,this.loadCallback,true);},init:function(b,f,g,a,e){var d;this.metadataId=b;if(f){d=this.createUrl+"?id="+this.metadataId+"&group="+g;if(a){d+="&child=y";}if(e){d+="&isTemplate="+e;}}else{d=this.editUrl+"?id="+this.metadataId;}d+="&currTab="+(document.mainForm?document.mainForm.currTab.value:this.defaultViewMode);this.loadUrl(d,undefined,this.loadCallback);if(this.disabled){this.setDisabled(false);}this.container.show();this.ownerCt.show();},loadUrl:function(b,d,e,f){if(document.mainForm){if(typeof d!=="undefined"){document.mainForm.showvalidationerrors.value="true";}else{document.mainForm.showvalidationerrors.value="false";}}var a=this.editorMainPanel.getUpdater();a.update({url:(b.indexOf("/")!==-1?b:this.catalogue.services.rootUrl+b),params:!f&&document.mainForm&&Ext.fly("editForm")!==null?Ext.Ajax.serializeForm("editForm"):undefined,callback:e,scope:this,loadScripts:true,text:OpenLayers.i18n(b)+" ("+b+")"});},closeCallback:function(){this.onEditorClosed();this.ownerCt.hide();},loadCallback:function(a,b,d,e){if(!this.managerInitialized){this.initManager();}if(b){this.metadataLoaded();}else{this.getError(d);}},getError:function(e){if(e&&e.responseText){var a=e.responseText,b,d,f,h,g;d=a.match(/<h2 class=\"error\"\>(.*)<\/h2\>/);b=d||a.match(/<div id=\"error\"\>\n[ ]*<h2>(.*)<\/h2\>/);f=a.match(/<\/h2\>\n[ ]*<p\><\/p\>(.*)/);if(!f){h=a.match(/<p id=\"error\">(.*)<\/p\>/);g=a.match(/<p id=\"stacktrace\">(.*)<\/p\>/);f=h[1]+g[1];}else{f=f[1];}if(b){Ext.Msg.alert(b[1],(f?f:""),function(){this.ownerCt.hide();},this);}}},updateEditor:function(a){this.editorMainPanel.update(a,false,this.metadataLoaded.bind(this));},metadataLoaded:function(){this.metadataSchema=document.mainForm.schema.value;this.metadataType=Ext.getDom("template");this.metadataId=document.mainForm.id.value;this.versionId=document.mainForm.version.value;this.toolbar.setIsMinor(document.mainForm.minor.value);this.toolbar.setIsTemplate(this.metadataType.value);if(this.disabled){this.setDisabled(false);}this.onMetadataUpdated();this.initCalendar();this.validateMetadataFields();this.catalogue.extentMap.initMapDiv();var a=Ext.query("th[id]",this.body.dom);a=a.concat(Ext.query("legend[id]",this.body.dom));Ext.each(a,function(j,f,g){var d=Ext.get(j);var h=d.getAttribute("id");if(d.is("TH")){var b=d.up("FIELDSET");d.parent().on("mouseover",function(){this.helpPanel.updateHelp(h,b);},this);}else{d.on("mouseover",function(){this.helpPanel.updateHelp(h);},this);}},this);this.updateViewMenu();},validateMetadataField:function(b){var d=b.getAttribute("onchange");var a=b.getAttribute("onkeyup");if(typeof d==="function"){d=d.toString();}if(typeof a==="function"){a=a.toString();}if(!b||(d!==null&&d.indexOf("validate")===-1)||(a!==null&&a.indexOf("validate")===-1)){return;}if(b.onkeyup){b.onkeyup();}if(b.onchange){b.onchange();}},validateMetadataFields:function(){var a=Ext.DomQuery.select("select.lang_selector");Ext.each(a,function(b){for(i=0;i<b.options.length;i+=1){if(b.options[i].getAttribute("code").toLowerCase()===this.lang){b.options[i].selected=true;}}});a=Ext.DomQuery.select("input,textarea,select");Ext.each(a,function(b){this.validateMetadataField(b);},this);},initCalendar:function(){var m=Ext.DomQuery.select("div.cal"),j;for(j=0;j<m.length;j++){var e=m[j];var f=e.id;e.id=f+"Id";if(e.firstChild===null||e.childNodes.length===1){var o="Y-m-d";var l=Ext.getDom(f+"_format",this.editorMainPanel.dom);if(l){o=l.value;}var h=Ext.getDom(f+"_cal",this.editorMainPanel.dom);var b=(h?h.value:"");var d=o.indexOf("T")===-1?false:true;if(d){var g=new Ext.ux.form.DateTime({renderTo:e.id,name:f,id:f,value:b,dateFormat:"Y-m-d",timeFormat:"H:i",hiddenFormat:"Y-m-d\\TH:i:s",dtSeparator:"T"});}else{var a=new Ext.form.DateField({renderTo:e,name:f,id:f,width:160,value:b,format:"Y-m-d"});}}}},updateViewMenu:function(){var d=Ext.query("span.mode",this.body.dom),b=[],l,h,q;for(l=0;l<d.length;l++){if(d[l].firstChild){var a=d[l].getAttribute("id");var m=Ext.get(d[l]).next();var f=d[l].innerHTML;var r=m.query("LI");var o=m.query("LI[id="+document.mainForm.currTab.value+"]");var g=o.length===1;if(!g){Ext.get(d[l]).parent().remove();}else{if(m&&r.length===1){m.remove();}else{for(h=0;h<r.length;h++){q=Ext.get(r[h]);
q.on("click",function(){Ext.getCmp("editorPanel").switchToTab(this);},q.getAttribute("id"));}}}b.push([f,a,g]);}}this.toolbar.updateViewMenu(b);},onMetadataUpdated:function(){this.fireEvent("metadataUpdated",this,this.metadataId,this.metadataSchema,this.versionId);},onEditorClosed:function(){this.fireEvent("editorClosed",this);},initManager:function(){var a=this.editorMainPanel.getUpdater();a.on("beforeupdate",function(d,b,e){this.position=this.editorMainPanel.getEl().parent().dom.scrollTop;},this);a.on("update",function(d,b){this.editorMainPanel.getEl().parent().dom.scrollTop=this.position;},this);this.managerInitialized=true;},initPanelLayout:function(){if(this.container){if(this.container.setIconClass){this.container.setIconClass("editing");}if(this.container.setTitle){if(this.metadataId){this.container.setTitle(OpenLayers.String.format(OpenLayers.i18n("editing"),{title:"",uuid:this.metadataId}));}else{}}}},initComponent:function(){var d;Ext.applyIf(this,this.defaultConfig);this.disabled=(this.metadataId?false:true);this.lang=(this.lang?this.lang:"en");this.editUrl=this.catalogue.services.mdEdit;this.createUrl=this.catalogue.services.mdCreate;this.updateUrl=this.catalogue.services.mdUpdate;GeoNetwork.editor.EditorPanel.superclass.initComponent.call(this);panel=this;this.editorMainPanel=new Ext.Panel({border:false,frame:false,id:"editorMainPanel"});var a={editor:panel};Ext.apply(a,this.tbarConfig);this.toolbar=new GeoNetwork.editor.EditorToolbar(a);var b={region:"center",split:true,autoScroll:true,tbar:this.toolbar,minHeigth:400,items:[this.editorMainPanel]};this.add(b);this.validationPanel=new GeoNetwork.editor.ValidationPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,serviceUrl:this.catalogue.services.mdValidate},this.utilityPanelConfig.validationPanel));this.helpPanel=new GeoNetwork.editor.HelpPanel(Ext.applyIf({editor:this,html:""},this.utilityPanelConfig.helpPanel));this.relationPanel=new GeoNetwork.editor.LinkedMetadataPanel(Ext.applyIf({editor:this,metadataId:this.metadataId,metadataSchema:this.metadataSchema,serviceUrl:this.catalogue.services.mdRelation},this.utilityPanelConfig.relationPanel));this.thumbnailPanel=new GeoNetwork.editor.ThumbnailPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,getThumbnail:this.catalogue.services.mdGetThumbnail,setThumbnail:this.catalogue.services.mdSetThumbnail,unsetThumbnail:this.catalogue.services.mdUnsetThumbnail},this.utilityPanelConfig.thumbnailPanel));this.suggestionPanel=new GeoNetwork.editor.SuggestionsPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,catalogue:this.catalogue},this.utilityPanelConfig.suggestionPanel));d={region:"east",split:true,collapsible:true,collapsed:this.utilityPanelCollapsed,hideCollapseTool:true,collapseMode:"mini",autoScroll:true,minWidth:280,width:280,items:[this.thumbnailPanel,this.relationPanel,this.suggestionPanel,this.validationPanel,this.helpPanel]};this.add(d);this.addEvents("metadataUpdated","editorClosed");this.on("added",function(f,g,e){if(g){this.setContainer(g);}this.initPanelLayout();},this);}});Ext.reg("gn_editor_editorpanel",GeoNetwork.editor.EditorPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.EditorToolbar=Ext.extend(Ext.Toolbar,{catalogue:undefined,editor:undefined,defaultConfig:{isTemplate:false,hideTypeMenu:false,editAttributes:false},mapOptions:undefined,layers:undefined,typeMenu:undefined,configMenu:undefined,viewMenu:undefined,saveAction:undefined,saveAndCloseAction:undefined,checkAction:undefined,resetAction:undefined,cancelAction:undefined,minorCheckbox:undefined,minorEdit:false,initComponent:function(){Ext.applyIf(this,this.defaultConfig);var a=[];if(!this.hideTypeMenu){a.push(this.createTypeMenu());a.push(["-"]);}this.saveAction=new Ext.Action({text:OpenLayers.i18n("save"),iconCls:"saveMetadata",handler:function(){this.save();},scope:this.editor});this.checkAction=new Ext.Action({text:OpenLayers.i18n("saveAndCheck"),iconCls:"validateMetadata",handler:function(){this.validationPanel.validate();},scope:this.editor});this.saveAndCloseAction=new Ext.Action({text:OpenLayers.i18n("saveAndClose"),iconCls:"quitMetadata",handler:function(){this.finish();},scope:this.editor});this.minorCheckbox=new Ext.Button({enableToggle:true,text:OpenLayers.i18n("minorEdit"),tooltip:OpenLayers.i18n("minorEditTT"),listeners:{toggle:function(d,b){document.mainForm.minor.value=this.minorEdit=b;},scope:this}});this.resetAction=new Ext.Action({text:OpenLayers.i18n("reset"),iconCls:"refreshMetadata",handler:function(){this.reset();},scope:this.editor});this.cancelAction=new Ext.Action({text:OpenLayers.i18n("cancel"),iconCls:"cancel",handler:function(){this.cancel();},scope:this.editor});a.push(this.createViewMenu(),["-"],this.saveAction,this.checkAction,this.saveAndCloseAction,this.minorCheckbox,["->"],this.resetAction,this.cancelAction,this.configMenu());GeoNetwork.editor.EditorToolbar.superclass.initComponent.call(this);this.add(a);},setIsTemplate:function(b){if(!this.hideTypeMenu){var a=b==="y";Ext.getCmp("type_y").setChecked(a);Ext.getCmp("type_n").setChecked(!a);}},setIsMinor:function(a){var b=true;if(a===""||a==="false"){b=false;}this.minorCheckbox.toggle(b);},createTypeMenu:function(){this.typeMenu={text:OpenLayers.i18n("type"),menu:{items:['<b class="menu-title">'+OpenLayers.i18n("chooseAType")+"</b>",{text:OpenLayers.i18n("md"),checked:true,value:"n",id:"type_n",group:"type",checkHandler:this.onTypeCheck},{text:OpenLayers.i18n("tpl"),checked:true,id:"type_y",group:"type",value:"y",checkHandler:this.onTypeCheck}]}};return this.typeMenu;},configMenu:function(){this.configMenu={iconCls:"configIcon",menu:{items:[{text:OpenLayers.i18n("collapseAll"),checked:false,checkHandler:function(){Ext.each(Ext.DomQuery.select("div.toggle"),function(a){if(a.onclick){a.onclick();}});}},{text:OpenLayers.i18n("editAttributes"),checked:this.editAttributes,checkHandler:function(b,a){this.editAttributes=a;this.editAttributesVisibility();},scope:this}]}};this.editor.on("metadataUpdated",function(){this.editAttributesVisibility();},this);return this.configMenu;},editAttributesVisibility:function(){Ext.each(Ext.select("div.toggle-attr"),function(a){a.setVisibilityMode(Ext.Element.DISPLAY);a.setVisible(this.editAttributes);},this);},createViewMenu:function(a){var b=['<b class="menu-title">'+OpenLayers.i18n("chooseAView")+"</b>"];this.viewMenu=new Ext.menu.Menu({items:b});var d={text:OpenLayers.i18n("viewMode"),iconCls:"viewModeIcon",menu:this.viewMenu};return d;},updateViewMenu:function(a){var d,b;this.viewMenu.removeAll();for(d=0;d<a.length;d++){b=a[d];this.viewMenu.add({text:b[0],checked:false,disabled:b[2],group:"mode",value:b[1],listeners:{checkchange:this.onViewCheck,scope:this}});}this.viewMenu.doLayout();},onViewCheck:function(b,a){if(a){this.editor.editorMainPanel.getEl().parent().scrollTo("top",0);document.mainForm.currTab.value=b.value;this.saveAction.execute();}},onTypeCheck:function(b,a){if(a){Ext.get("template").dom.value=b.value;}},onDestroy:function(){GeoNetwork.EditorToolbar.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gn_editor_editortoolbar",GeoNetwork.editor.EditorToolbar);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.EditorTools={addHiddenFormFieldForFragment:function(d,b,f){var a="_X"+d.ref+"_"+d.name.replace(":","COLON");var e;var g=true;Ext.each(b,function(j,h){b[h]=j.replace('<?xml version="1.0" encoding="UTF-8"?>',"").replace(/\&/g,"&amp;amp;").replace(/\"/g,"&quot;").replace(/\r\n/g,"");if(g){e=b[h];g=false;}else{e+="&amp;&amp;&amp;"+b[h];}});GeoNetwork.editor.EditorTools.addHiddenFormField(a,e);if(f){f.save();}},addHiddenFormField:function(e,b){var d={tag:"input",type:"hidden",id:e,name:e,value:b};var a=Ext.DomHelper;a.append(Ext.get("hiddenFormElements"),d);},showNewMetadataWindow:function(f,b,a,d,e){if(f.newMetadataWindow){f.newMetadataWindow.close();f.newMetadataWindow=undefined;}if(!f.newMetadataWindow){var g=new GeoNetwork.editor.NewMetadataPanel({selectedTpl:b,isChild:d,filter:e,getGroupUrl:f.catalogue.services.getGroups,catalogue:f.catalogue});
f.newMetadataWindow=new Ext.Window({title:a===undefined?OpenLayers.i18n("newMetadata"):a,width:300,height:100,layout:"fit",modal:true,items:g,closeAction:"destroy",constrain:true,iconCls:"addIcon"});}f.newMetadataWindow.show();}};lastclick=0;Checks={message:translate("loseYourChange"),_setMessage:function(a){this.message=a;},_onbeforeunload:function(a){}};function unloadMess(){mess=translate("loseYourChange");return mess;}function doEditorAlert(a,b){$(a).style.display="block";}function setBunload(a){if(a){Checks._setMessage(unloadMess());}else{Checks._setMessage(null);}}function noDoubleClick(){var a=(new Date()).valueOf();if((a-lastclick)>500){setBunload(false);lastclick=a;return true;}else{return false;}}function doNewElementAction(f,e,b,j,g,a){var h=null;var d=false;doNewElementAjax(f,e,b,h,j,g,a,d);}function doNewORElementAction(f,e,b,j,h,g,a){var d=true;doNewElementAjax(f,e,b,j,h,g,a,d);}function doNewAttributeAction(f,e,b,j,g){var h="geonet:attribute";var a=null;var d=false;doNewElementAjax(f,e,b,h,j,g,a,d);}function doNewElementAjax(l,j,a,g,d,e,b,o){var m=document.mainForm.id.value;var h="&id="+m+"&ref="+j+"&name="+a;if(g!=null){h+="&child="+g;}var f=Ext.get(d);Ext.Ajax.request({url:catalogue.services.rootUrl+l,method:"GET",params:h,success:function(s,r){var t=s.responseText;if(g=="geonet:attribute"){Ext.getCmp("editorPanel").save();return;}if(e=="replace"){Ext.DomHelper.insertHtml("afterEnd",f.dom,t);f.remove();}else{if(e=="add"||e=="after"){var q=f.insertHtml("afterEnd",t,true);setAddControls(q,o);}else{if(e=="before"){var q=f.insertHtml("beforeBegin",t,true);setAddControls(q,o);}else{Ext.MessageBox.alert("doNewElementAjax: invalid what: "+e+" should be one of replace, after or before.");}}}Ext.getCmp("editorPanel").metadataLoaded();setBunload(true);},onFailure:function(q){Ext.MessageBox.alert(translate("errorAddElement")+a+translate("errorFromDoc")+" / status "+q.status+" text: "+q.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doRemoveElementAction(l,j,g,f,a){var b=document.mainForm.id.value;var h=Ext.get(f);var d=h.next();var e=h.prev();Ext.Ajax.request({url:catalogue.services.rootUrl+l,method:"GET",params:{id:b,ref:j,parent:g},success:function(o,m){var q=o.responseText;if(q==""){if(bottomElement(h)&&document.mainForm.currTab.value!="simple"){swapControls(h,e);h.remove();h=e;}else{h.remove();h=d;}if(topElement(h)){topControls(h,a);}}else{if(orElement(h)){h.remove();}else{Ext.DomHelper.insertHtml("afterEnd",h.dom,q);h.remove();}}setBunload(true);},failure:function(o,m){Ext.MessageBox.alert(translate("errorDeleteElement")+name+" "+translate("errorFromDoc")+" / status "+o.status+" text: "+o.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doRemoveAttributeAction(a,f,b){var d=document.mainForm.id.value;var e=Ext.get(f+"_block");Ext.Ajax.request({url:catalogue.services.rootUrl+a,method:"GET",params:{id:d,ref:f},success:function(j,h){var l=j.responseText;var g=Ext.getCmp("editorPanel");g.save();setBunload(true);},failure:function(g,h){Ext.MessageBox.alert(translate("errorDeleteAttribute")+name+" "+translate("errorFromDoc")+" / status "+g.status+" text: "+g.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function updateEditorContent(b,a){var d=Ext.getCmp("editorPanel");d.updateEditor(b.responseText);setBunload(true);}function doProcessing(b,a){b.id=document.mainForm.id.value;b.remote="true";Ext.Ajax.request({url:catalogue.services.rootUrl+"metadata.processing",method:"POST",params:b,success:function(d,e){updateEditorContent(d,e);if(a){a();}},failure:function(d){Ext.MessageBox.alert(translate("errorSaveFailed")+"/ status "+d.status+" text: "+d.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doMoveElementAction(b,a,d){var f=Ext.get(d);var e={id:document.mainForm.id.value,ref:a};Ext.Ajax.request({url:catalogue.services.rootUrl+b,method:"POST",params:e,success:function(h){if(b.indexOf("elem.up")!=-1){var j=f.prev();f.insertSibling(j,"after");swapControls(f,j);}else{var g=f.next();f.insertSibling(g,"before");swapControls(f,g);}setBunload(true);},failure:function(g){Ext.MessageBox.alert(translate("errorMoveElement")+a+" / status "+g.status+" text: "+g.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doFileRemoveAction(a,e,d,b){setBunload(false);document.mainForm.access.value=d;document.mainForm.ref.value=e;document.mainForm.action=a;Ext.getCmp("editorPanel").callAction(a);}function checkForFileUpload(j,e,h){var g=Ext.getDom("_"+j);var m=Ext.getDom("s_"+e);var l=Ext.getDom("_"+e);var o=h.startsWith("WWW:DOWNLOAD");var b=m.value;var d=(b.startsWith("WWW:DOWNLOAD")&&b.indexOf("http")>0);if(o){if(!d){alert(OpenLayers.i18n("errorChangeProtocol"));m.value=l.value;}else{l.value=m.value;}return;}var a=Ext.get("di_"+j);var f=Ext.get("db_"+j);l.value=m.value;if(d){if(a!==null){a.hide();}if(f!==null){f.show();}Ext.getCmp("editorPanel").callAction("metadata.update.new");}else{if(a!==null){a.show();}if(f!==null){f.hide();}}}function handleCheckboxAsBoolean(a,b){if(a.checked){Ext.getDom(b).value="true";}else{Ext.getDom(b).value="false";}}function swapControls(g,f){var d=getControlsFromElement(g);var b=getControlsFromElement(f);for(var e=0;e<d.length;++e){var a=d[e].isVisible();var h=b[e]?b[e].isVisible():false;if(b[e]){if(a){b[e].show();}else{b[e].hide();}}if(h){d[e].show();}else{d[e].hide();}}}function getControlsFromElement(a){if(a===null){return[];}var b=a.getAttribute("id");var d=Ext.get("buttons_"+b).query("a");for(var e=0;e<d.length;e++){d[e]=Ext.get(d[e]).setVisibilityMode(Ext.Element.DISPLAY);}return d;}function topElement(a){if(a.prev()==undefined){return true;}else{return(!isSameElement(a.prev(),a));}}function bottomElement(a){if(a.next()==undefined){return true;}else{return(!isSameElement(a.next(),a));}}function getIdSplit(a){var b=a.getAttribute("id");if(b==null){return null;}return b.split("_");}function orElement(d){if(d.next()==undefined){return false;}else{var b=getIdSplit(d.next());var a=getIdSplit(d);if(b==null||a==null){return false;}if(b[0]=="child"&&b[1]==a[0]){return true;}else{return false;}}}function isSameElement(e,d){var b=getIdSplit(e);var a=getIdSplit(d);if(b==null||a==null){return false;}if(b[0]==a[0]){return true;}else{return false;}}function topControls(a,e){var b=getControlsFromElement(a);var d=0;if(b.length==5){d=1;}if(bottomElement(a)&&!orElement(a)){b[0].show();}else{b[0].hide();}if(d==1){if(bottomElement(a)&&!orElement(a)){b[d].show();}else{b[d].hide();}}if(bottomElement(a)){if(e==0){b[1+d].show();}else{b[1+d].hide();}}else{b[1+d].show();}b[2+d].hide();if(bottomElement(a)){b[3+d].hide();}else{b[3+d].show();}}function setAddControls(a,g){elDescs=getControlsFromElement(a);var d=0;if(elDescs.length==5){d=1;}if(g){elDescs[0].hide();}else{elDescs[0].show();}if(d==1){if(g){elDescs[d].hide();}else{elDescs[d].show();}}elDescs[1+d].show();elDescs[2+d].show();if(elDescs[3+d]){elDescs[3+d].hide();}if(topElement(a)){elDescs[2+d].hide();}else{var f=a.prev();var b=getControlsFromElement(f);var e=0;if(b.length==5){e=1;}b[0].hide();if(e==1){b[e].hide();}b[1+e].show();if(topElement(f)){b[2+e].hide();}else{b[2+e].show();}var a=b[3+e];if(a){a.show();}}}function validateNumber(e,g,d){var h=e.value;var b="0123456789";if(!g){if(!validateNonEmpty(e)){return false;}}if(d){b+=".";}var f=true;var a;for(i=0;i<h.length&&f;i++){a=h.charAt(i);if(a=="-"||a=="+"){if(i<0){f=false;}}else{if(b.indexOf(a)==-1){f=false;}}}if(!f){Ext.get(e).addClass("error");return false;}else{Ext.get(e).removeClass("error");return true;}}function validateNonEmpty(a){if(a.value.length<1){Ext.get(a).addClass("error");return false;}else{Ext.get(a).removeClass("error");return true;}}function validateEmail(a){if(!Ext.form.VTypes.email(a.value)){Ext.get(a).addClass("error");return false;}else{Ext.get(a).removeClass("error");return true;}}function toggleFieldset(d,e){var a=Ext.get(d);if(a.hasClass("tgDown")){a.removeClass("tgDown");e.style.display="none";a.addClass("tgRight");}else{a.removeClass("tgRight");
e.style.display="block";a.addClass("tgDown");}}function enableLocalInput(b,e){var a=b.value;var g=b.parentNode.parentNode;var f=g.getElementsByTagName("input");var d=g.getElementsByTagName("textarea");showLocalInput(f,a,e);showLocalInput(d,a,e);}function showLocalInput(a,b,d){for(index in a){var e=a[index];if(e.style!=null&&e.style.display!="none"){e.style.display="none";}}for(index in a){var e=a[index];if(e.name==b){e.style.display="block";if(d){e.focus();}}}}function clearSuggestion(a){if($(a)!=null){$(a).innerHTML="";}}function googleTranslate(e,b,h,a,g){var f={GE:"de",SP:"es",CH:"zh"};if(f[a]){a=f[a];}if(f[g]){g=f[g];}if($(e).value==""){Ext.Msg.alert(translate("translateWithGoogle.emptyInput"));return;}if($(e).value.length>5000){Ext.Msg.alert(translate("translateWithGoogle.maxSize"));return;}if($(b)!=null){$(b).innerHTML="";}try{google.language.translate($(e).value,a,g,function(j){if(!j.error){var l=j.translation.replace(/&#39;/g,"'").replace(/&quot;/g,'"');if($(h)!=null){$(h).value=l;}if($(b)!=null){$(b).innerHTML=l;$(b).style.display="block";}}else{Ext.Msg.alert(j.error.message+" ("+j.error.code+")");}validateMetadataField($(h));});}catch(d){Ext.Msg.alert("Translation service error","Check google translation API is loaded: "+d);}}function updateChildren(b,d,a){var f="&id="+document.mainForm.id.value+"&parentUuid="+Ext.getDom("parentUuid").value+"&schema="+Ext.getDom("schema").value+"&childrenIds="+Ext.getDom("childrenIds").value;var e=Ext.get(b).select('input[type="checkbox"]');e.each(function(h){var j=Ext.getDom(h);if(j.checked){f+="&"+j.name+"=true";}});var g=Ext.get(b).select('input[type="radio"]');g.each(function(h){var j=Ext.getDom(h);if(h.checked){f+="&"+j.name+"="+j.value;}});Ext.Ajax.request({url:catalogue.services.rootUrl+d,method:"GET",params:f,success:function(l,j){var h=l.responseXML;if(h.childNodes.length!==0&&h.childNodes[0].localName=="response"){var m=h.childNodes[0].childNodes[0].nodeValue;Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),m);Ext.get(b).hide();}else{Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),a);}},failure:function(h,j){Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),a);}});}Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.HelpPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,iconCls:"book",title:undefined,collapsible:true,collapsed:false},editor:undefined,tipTpl:undefined,cache:{},loadHelp:function(d,b,a,e){if(!this.cache[d]){var f=this;GeoNetwork.util.HelpTools.get(d,this.editor.metadataSchema,this.editor.catalogue.services.schemaInfo,function(g){f.cache[d]=f.tipTpl.apply(g.records[0].data);f.update(f.cache[d]);});}},updateHelp:function(b,g){if(this.collapsed){return;}var e=b;var a="";var f;var d=this;if(g){f=g.first().getAttribute("id");}if(this.cache[b]&&this.cache[f]){this.update(this.cache[b]+this.cache[f]);}else{if(f){this.loadHelp(f,null,false,d.loadHelp(b,f,true));}else{this.loadHelp(b,null,true);}}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.tipTpl=new Ext.XTemplate(GeoNetwork.util.HelpTools.Templates.COMPLETE);this.title=OpenLayers.i18n("help");GeoNetwork.editor.HelpPanel.superclass.initComponent.call(this);panel=this;}});Ext.reg("gn_editor_helppanel",GeoNetwork.editor.HelpPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.keyword={};GeoNetwork.editor.KeywordSelectionPanel=Ext.extend(Ext.FormPanel,{catalogue:undefined,Keyword:Ext.data.Record.create([{name:"value"},{name:"thesaurus"},{name:"uri"}]),keywordStore:undefined,border:false,addAsXLink:false,itemSelector:null,loadingMask:null,ThesaurusCount:null,ref:null,name:"gmd:descriptiveKeywords",keywordsSelected:[],initComponent:function(){this.keywordStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pThesauri:"",pMode:"searchBox"},reader:new Ext.data.XmlReader({record:"keyword",id:"uri"},this.Keyword),fields:["value","thesaurus","uri"],sortInfo:{field:"thesaurus"}});this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getThesaurusCombo()," ",this.getKeyword(),"->",OpenLayers.i18n("maxResults")+" "+OpenLayers.i18n("perThesaurus"),this.getLimitInput()],items:[this.getKeywordsItemSelector()]}];this.keywordStore.on({loadexception:function(){},beforeload:function(a,b){if(Ext.getCmp("maxResults")){a.baseParams.maxResults=Ext.getCmp("maxResults").getValue();}if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();},load:function(){this.loadingMask.hide();},scope:this});this.addEvents("keywordselected");this.bbar=["->",{id:"addAsXLinkCheckBox",xtype:"checkbox",checked:false,boxLabel:OpenLayers.i18n("addAsXLink"),listeners:{check:function(b,a){this.addAsXLink=a;},scope:this}},{id:"keywordSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildKeywordXmlList();},scope:this}];GeoNetwork.editor.KeywordSelectionPanel.superclass.initComponent.call(this);},getKeyword:function(){return new GeoNetwork.form.SearchField({id:"keywordSearchField",width:240,store:this.keywordStore,paramName:"pKeyword"});},setRef:function(a){this.ref=a;},setAddAsXLink:function(a){this.addAsXLink=a||false;Ext.getCmp("addAsXLinkCheckBox").setValue(this.addAsXLink);},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:50,width:40};},getThesaurusCombo:function(){GeoNetwork.editor.keyword.thesaurusStore=new GeoNetwork.data.ThesaurusStore({url:this.catalogue.services.getThesaurus,allOption:true,activatedOnly:true});return{xtype:"combo",width:150,id:"search-thesauri",value:0,store:GeoNetwork.editor.keyword.thesaurusStore,triggerAction:"all",mode:"local",displayField:"filename",valueField:"id",listWidth:250,listeners:{select:function(b,d,e){this.keywordStore.removeAll();this.keywordStore.baseParams.pThesauri=b.getValue();var a=Ext.getCmp("keywordSearchField").getValue();if(a.length<1){this.keywordStore.baseParams.pKeyword="*";}else{this.keywordStore.baseParams.pKeyword=a;}this.keywordStore.reload();},clear:function(a){this.keywordStore.load();},scope:this}};},getKeywordsItemSelector:function(){var a='<tpl for="."><div class="ux-mselect-item';if(Ext.isIE||Ext.isIE7){a+='" unselectable=on';}else{a+=' x-unselectable"';}a+='>{id} {value} <span class="ux-mselect-item-thesaurus">({thesaurus})</span></div></tpl>';this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["value","thesaurus"],toData:[],msWidth:320,msHeight:230,valueField:"value",toSortField:undefined,fromTpl:a,toTpl:a,toLegend:OpenLayers.i18n("selectedKeywords"),fromLegend:OpenLayers.i18n("foundKeywords"),fromStore:this.keywordStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var b=this.getForm().findField("itemselector");b.reset.call(b);},scope:this}]});this.itemSelector.on({change:function(b){Ext.getCmp("keywordSearchValidateButton").setDisabled(b.toStore.getCount()<1);}});return this.itemSelector;},buildKeywordXmlList:function(){this.keywordsSelected=[];var a=this;this.ThesaurusCount=0;var b=[];var d=this.itemSelector.toMultiselect.store;b=d.collect("thesaurus");Ext.each(b,function(e,o,f){d.filter("thesaurus",e);var l=d.collect("uri");Ext.each(l,function(r,q){l[q]=r.replace("#","%23");});var g=a.catalogue.services.getKeyword;var j=l.length>1?true:false;var h=g+"?thesaurus="+e+"&id="+l.join(",")+"&multiple="+j;++a.ThesaurusCount;if(a.addAsXLink){var m="<gmd:descriptiveKeywords xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:gmd='http://www.isotc211.org/2005/gmd'  xmlns:gco='http://www.isotc211.org/2005/gco' xlink:href='"+h+"'/>";a.keywordsSelected.push(m);}else{a.retrieveKeywordData(h);}});if(this.addAsXLink){this.fireEvent("keywordselected",this,this.keywordsSelected);
this.ownerCt.hide();}d.clearFilter();},retrieveKeywordData:function(a){Ext.getCmp("keywordSearchValidateButton").disable();Ext.Ajax.request({url:a,method:"GET",scope:this,success:function(d){var b=d.responseText;if(b.indexOf("<gmd:MD_Keywords")!==-1){this.keywordsSelected.push("<gmd:descriptiveKeywords xmlns:gmd='http://www.isotc211.org/2005/gmd'>"+d.responseText+"</gmd:descriptiveKeywords>");}Ext.getCmp("keywordSearchValidateButton").enable();this.ThesaurusCount-=1;if(this.ThesaurusCount===0){this.fireEvent("keywordselected",this,this.keywordsSelected);this.ownerCt.hide();}}});}});Ext.reg("gn_editor_keywordselectionpanel",GeoNetwork.editor.KeywordSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.LinkedMetadataPanel=Ext.extend(Ext.Panel,{title:undefined,editor:undefined,metadataId:undefined,selectedUuid:undefined,selectedType:undefined,metadataSchema:undefined,serviceUrl:undefined,store:undefined,parentAction:undefined,datasetAction:undefined,serviceAction:undefined,featureCatAction:undefined,delFeatureCatAction:undefined,updateChildrenAction:undefined,colModel:undefined,expander:undefined,defaultConfig:{border:false,frame:false,iconCls:"linkIcon",collapsible:true,collapsed:false},createColumnDef:function(){this.expander=new Ext.grid.RowExpander({tpl:new Ext.XTemplate('<div title=""><a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');">{title}</a></div>{msg}')});return[this.expander,{id:"type",header:OpenLayers.i18n("type"),width:60,sortable:true,hidden:true,dataIndex:"type"},{header:OpenLayers.i18n("title"),hidden:false,dataIndex:"title"}];},createColumnModel:function(){this.colModel=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:this.createColumnDef()});return this.colModel;},updatePanel:function(){this.reload();},clear:function(){this.store.removeAll();},reload:function(b,d,a){this.metadataId=d||this.metadataId;this.metadataSchema=a||this.metadataSchema;if(this.collapsed){return;}this.colModel.setConfig(this.createColumnDef());var f=this.metadataSchema.indexOf("iso19139")!==-1;var g=this.metadataSchema==="iso19110";this.parentAction.setDisabled(!f);this.serviceAction.setDisabled(!f);this.datasetAction.setDisabled(!f);this.featureCatAction.setDisabled(g);this.store.reload({params:{id:this.metadataId,fast:"false"}});},updateStatus:function(f,e,a){var b=f.find("type","children");this.updateChildrenAction.setDisabled(b===-1);var d=f.find("type","related");this.delFeatureCatAction.setDisabled(d===-1);},selectionChangeEvent:function(a,d,b){var f=a.getStore().getAt(d);this.selectedUuid=f.get("uuid");this.selectedType=f.get("type");this.delFeatureCatAction.setDisabled(this.selectedType!=="related");},getChildrenIds:function(){var a=[];this.store.each(function(b){if(b.get("type")==="children"){this.push(b.get("id"));}},a);return a;},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("relatedResources");this.tools=[{id:"refresh",handler:function(f,d,g,e){g.reload(g,g.metadataId);}}];this.parentAction=new Ext.Action({text:OpenLayers.i18n("parentMd"),handler:function(){this.switchToTab("metadata");},scope:this.editor});this.datasetAction=new Ext.Action({text:OpenLayers.i18n("datasetMd"),iconCls:"cat-dataset",handler:function(){this.showLinkedServiceMetadataSelectionPanel("coupledResource","","");},scope:this.editor});this.serviceAction=new Ext.Action({text:OpenLayers.i18n("serviceMd"),iconCls:"cat-service",handler:function(){this.showLinkedServiceMetadataSelectionPanel("attachService","","");},scope:this.editor});this.featureCatAction=new Ext.Action({text:OpenLayers.i18n("featureCat"),iconCls:"cat-featureCatalogue",handler:function(){this.showLinkedMetadataSelectionPanel(null,"iso19110");},scope:this.editor});this.delFeatureCatAction=new Ext.Action({text:OpenLayers.i18n("delete19110Relation"),handler:function(){this.editor.catalogue.doAction(this.editor.catalogue.services.mdRelationDelete,{childUuid:this.selectedUuid,parentId:this.metadataId},null,null,this.reload.bind(this),null);var d=this.editor.catalogue.services.mdProcessing+"?uuidref="+this.selectedUuid+"&id="+this.metadataId+"&process=update-detachFeatureCatalogue";this.editor.process(d);},scope:this,disabled:true});this.updateChildrenAction=new Ext.Action({text:OpenLayers.i18n("updateChildren"),handler:function(){this.editor.catalogue.modalAction(OpenLayers.i18n("updateChildren"),this.editor.catalogue.services.mdMassiveChildrenForm+"?parentUuid="+document.mainForm.uuid.value+"&schema="+document.mainForm.schema.value+"&childrenIds="+this.getChildrenIds().join(","));},scope:this,disabled:true});this.bbar=new Ext.Toolbar({items:[{text:OpenLayers.i18n("createLink"),iconCls:"relatedAddIcon",menu:new Ext.menu.Menu({items:[this.parentAction,this.datasetAction,this.serviceAction,this.featureCatAction]})},{text:OpenLayers.i18n("otherActions"),menu:new Ext.menu.Menu({items:[this.updateChildrenAction,this.delFeatureCatAction]})}]});GeoNetwork.editor.LinkedMetadataPanel.superclass.initComponent.call(this);this.store=new GeoNetwork.data.MetadataRelationStore(this.serviceUrl,{fast:false,id:this.metadataId},true);var a=this;var b=new Ext.grid.GridPanel({store:this.store,colModel:this.createColumnModel(),loadMask:true,plugins:this.expander,view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+OpenLayers.i18n("records")+'" : "'+OpenLayers.i18n("record")+'"]})'}),frame:false,height:150,autoWidth:true,listeners:{rowclick:this.selectionChangeEvent,scope:a}});this.add(b);if(this.metadataId){this.reload();}this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);this.store.on("load",this.updateStatus,this);}});Ext.reg("gn_editor_linkedmetadatapanel",GeoNetwork.editor.LinkedMetadataPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.Filter={SERVICE:[{name:"E_type",value:"service"}],DATASET:[{name:"E_type",value:"dataset"}],FEATURE_CATALOGUE:[{name:"E__schema",value:"iso19110"}]};GeoNetwork.editor.linkedMetadata={};GeoNetwork.editor.LinkedMetadataSelectionPanel=Ext.extend(Ext.FormPanel,{catalogue:undefined,border:false,layout:"fit",createIfNotExistURL:null,hiddenParameters:undefined,singleSelect:true,loadingMask:null,mdStore:null,ref:null,proxy:null,mode:null,serviceUrl:null,capabilitiesStore:null,linkedMetadataStore:undefined,initComponent:function(){this.addEvents("linkedmetadataselected");this.mdStore=GeoNetwork.data.MetadataResultsStore();this.linkedMetadataStore=GeoNetwork.data.MetadataCSWResultsStore();if(this.mode==="attachService"||this.mode==="coupledResource"){this.capabilitiesStore=new GeoExt.data.WMSCapabilitiesStore({url:this.serviceUrl,id:"capabilitiesStore",listeners:{exception:function(m,f,g,l,j,h){Ext.MessageBox.alert(OpenLayers.i18n("error"));},beforeload:function(){if(this.mode==="attachService"){var f=Ext.getCmp("linkedMetadataGrid").getSelectionModel().getSelections();if(f===undefined||f[0].data.uri===""){Ext.MessageBox.alert(OpenLayers.i18n("noServiceURLError"));}this.capabilitiesStore.baseParams.url=f[0].data.uri+"?&SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.1";}else{if(this.mode==="coupledResource"){this.capabilitiesStore.baseParams.url=this.serviceUrl;}}},loadexception:function(){Ext.MessageBox.alert(OpenLayers.i18n("GetCapabilitiesDocumentError")+this.capabilitiesStore.baseParams.url);},scope:this}});}if(this.mode==="attachService"){this.hiddenParameters=GeoNetwork.editor.Filter.SERVICE;}else{if(this.mode==="iso19110"){this.hiddenParameters=GeoNetwork.editor.Filter.FEATURE_CATALOGUE;}}var a=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:"",listeners:{selectionchange:function(){Ext.getCmp("linkedMetadataValidateButton").setDisabled(this.getSelections().length<1);}}});var b=[this.getSearchInput(),"->",OpenLayers.i18n("maxResults"),this.getLimitInput()];this.addHiddenFormInput(b);var e=new Ext.grid.GridPanel({id:"linkedMetadataGrid",xtype:"grid",layout:"fit",height:280,bodyStyle:"padding: 0px;",border:true,loadMask:true,tbar:b,store:this.linkedMetadataStore,columns:[a,{id:"title",header:OpenLayers.i18n("mdTitle"),dataIndex:"title"},{id:"subject",header:OpenLayers.i18n("keywords"),dataIndex:"subject",hidden:true},{id:"uri",header:OpenLayers.i18n("uri"),dataIndex:"getCapabilitiesUrl"}],sm:a,autoExpandColumn:"title",listeners:{rowclick:function(h,g,f){if(this.capabilitiesStore!==null&&this.mode!=="coupledResource"){this.serviceUrl=h.getStore().getAt(g).data.uri;
if(this.serviceUrl===""){this.capabilitiesStore.removeAll();}else{this.capabilitiesStore.baseParams.url=this.serviceUrl;this.capabilitiesStore.reload();}}},scope:this}});if(this.mode==="attachService"||this.mode==="coupledResource"){this.items=this.getScopedNamePanel(e);}else{this.items=e;}var d=this;this.bbar=["->",{id:"linkedMetadataValidateButton",iconCls:"relatedAddIcon",text:OpenLayers.i18n("createRelation"),disabled:true,handler:function(){var f=e.getSelectionModel().getSelections();this.fireEvent("linkedmetadataselected",this,f);this.ownerCt.close();},scope:d}];this.linkedMetadataStore.on({load:function(){if(this.loadingMask!==null){this.loadingMask.hide();}},scope:this});GeoNetwork.editor.LinkedMetadataSelectionPanel.superclass.initComponent.call(this);},getCreateIfNotExistButton:function(){if(!this.createIfNotExistURL){return"";}return{id:"createIfNotExistButton",iconCls:"addIcon",text:OpenLayers.i18n("createIfNotExistButton"),handler:function(){window.location.replace(this.createIfNotExistURL);},scope:this};},setRef:function(a){this.ref=a;},addHiddenFormInput:function(a){var b;if(this.hiddenParameters){for(b=0;b<this.hiddenParameters.length;b++){a.push({xtype:"textfield",fieldLabel:this.hiddenParameters[b].name,name:this.hiddenParameters[b].name,value:this.hiddenParameters[b].value,hidden:true});}}return a;},getSearchInput:function(){return new GeoNetwork.form.SearchField({name:"E.8_AnyText",width:240,store:this.linkedMetadataStore,triggerAction:function(a){a.doSearch();},scope:this});},getLimitInput:function(){return{xtype:"textfield",name:"nbResultPerPage",id:"nbResultPerPage",value:20,width:40};},getScopedNamePanel:function(a){var b={xtype:"combo",id:"getCapabilitiesLayerNameCombo",fieldLabel:OpenLayers.i18n("getCapabilitiesLayer"),store:this.capabilitiesStore,valueField:"name",displayField:"title",triggerAction:"all",listeners:{select:function(g,h,f){Ext.getCmp("getCapabilitiesLayerName").setValue(g.getValue());}}};var e={xtype:"textfield",id:"getCapabilitiesLayerName",fieldLabel:OpenLayers.i18n("layerName"),valueField:"name",displayField:"title"};var d={xtype:"panel",layout:"form",bodyStyle:"padding: 2px;",border:true,items:[a,b,e]};return d;},doSearch:function(){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();GeoNetwork.editor.nbResultPerPage=20;if(Ext.getCmp("nbResultPerPage")){GeoNetwork.editor.nbResultPerPage=Ext.getCmp("nbResultPerPage").getValue();}GeoNetwork.util.CSWSearchTools.doCSWQueryFromForm(this.id,this.catalogue,1,this.showResults.bind(this),null,Ext.emptyFn);},showResults:function(e){var b=new OpenLayers.Format.CSWGetRecords.v2_0_2();var a=b.read(e.responseText);var d=a.records;if(d.length>0){this.linkedMetadataStore.loadData(a);}}});Ext.reg("gn_editor_linkedmetadataselectionpanel",GeoNetwork.editor.LinkedMetadataSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.LogoSelectionPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoScroll:true,autoWidth:true,layout:"border"},store:undefined,view:undefined,uploadForm:undefined,serviceUrl:undefined,logoAddUrl:undefined,ref:undefined,setRef:function(a){this.ref=a;},getUploadForm:function(){this.uploadForm=new Ext.form.FormPanel({fileUpload:true,region:"south",height:80,split:true,items:{xtype:"fileuploadfield",allowBlank:false,emptyText:OpenLayers.i18n("logoSelect"),hideLabel:true,name:"fname",buttonCfg:{iconCls:"thumbnailAddIcon"}},buttons:[{text:OpenLayers.i18n("upload"),scope:this,iconCls:"thumbnailGoIcon",handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:this.logoAddUrl,scope:this,success:function(a,b){this.store.reload();},failure:function(a){Ext.Msg.alert(OpenLayers.i18n("failure"),a.responseText);}});}}}]});return this.uploadForm;},initComponent:function(){Ext.applyIf(this,this.defaultConfig);var a=new Ext.XTemplate('<tpl for="."><div class="logo-wrap"><div id="{name}" class="logo">','<img src="'+this.logoUrl+'{name}" title="{name}"/><span>{name}</span></div></div>',"</tpl>");var b=Ext.data.Record.create([{name:"name",mapping:""}]);this.store=new Ext.data.Store({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:this.serviceUrl,disableCaching:false}),reader:new Ext.data.XmlReader({record:"icon",id:"icon"},b),fields:["name"]});this.view=new Ext.DataView({store:this.store,tpl:a,singleSelect:true,selectedClass:"logo-selected",overClass:"logo-over",itemSelector:"div.logo-wrap",autoScroll:true,listeners:{selectionchange:function(d,e){var f=this.view.getSelectedIndexes();if(e){this.fireEvent("logoselected",this,f);this.ownerCt.hide();}},scope:this}});this.items=[new Ext.Panel({region:"center",split:true,border:true,autoScroll:true,items:[this.view]}),this.getUploadForm()];GeoNetwork.editor.LogoSelectionPanel.superclass.initComponent.call(this);this.addEvents("logoselected");this.store.load();}});Ext.reg("gn_editor_logoselectionpanel",GeoNetwork.editor.LogoSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.NewMetadataPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,isTemplate:"n"},editor:undefined,getGroupUrl:undefined,groupStore:undefined,catalogue:undefined,tplStore:undefined,selectedGroup:undefined,selectedTpl:undefined,isChild:undefined,filter:undefined,createBt:undefined,validate:function(){if(this.selectedGroup!==undefined&&this.selectedTpl!==undefined){this.createBt.setDisabled(false);}else{this.createBt.setDisabled(true);}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);var b,a;this.createBt=new Ext.Button({text:OpenLayers.i18n("create"),iconCls:"addIcon",disabled:true,handler:function(){this.catalogue.metadataEdit(this.selectedTpl,true,this.selectedGroup,this.isChild,this.isTemplate);this.ownerCt.hide();},scope:this});this.buttons=[this.createBt,{text:OpenLayers.i18n("cancel"),iconCls:"cancel",handler:function(){this.ownerCt.hide();},scope:this}];GeoNetwork.editor.NewMetadataPanel.superclass.initComponent.call(this);this.groupStore=GeoNetwork.data.GroupStore(this.getGroupUrl);this.groupStore.load();if(!this.selectedTpl){this.tplStore=GeoNetwork.Settings.mdStore?GeoNetwork.Settings.mdStore():GeoNetwork.data.MetadataResultsStore();this.tplStore.setDefaultSort("displayOrder");b=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:""});a=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[b,{header:"Schema",dataIndex:"schema"},{id:"title",header:"Title",dataIndex:"title"},{header:"Order",hidden:true,dataIndex:"displayOrder"}]});this.add(new Ext.grid.GridPanel({layout:"fit",title:OpenLayers.i18n("chooseTemplate"),border:false,autoScroll:true,height:330,store:this.tplStore,colModel:a,sm:b,autoExpandColumn:"title",listeners:{rowclick:function(f,e,d){var g=f.getStore().getAt(e).data;if(f.getSelectionModel().getCount()!==0){this.selectedTpl=g.id;}else{this.selectedTpl=undefined;}this.validate();},scope:this}}));this.catalogue.search({E_template:"y"},null,null,1,true,this.tplStore,null);}this.add(new Ext.form.ComboBox({name:"E_group",mode:"local",emptyText:OpenLayers.i18n("chooseGroup"),triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:this.groupStore,allowBlank:false,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>",listeners:{select:function(e,d,f){this.selectedGroup=d.get("id");this.validate();},scope:this}}));this.add({xtype:"textfield",name:"isTemplate",hidden:true,value:this.isTemplate});}});Ext.reg("gn_editor_newmetadatapanel",GeoNetwork.editor.NewMetadataPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.GeoPublisherPanel=Ext.extend(Ext.form.FormPanel,{border:false,serviceUrl:undefined,itemSelector:null,geoserverStore:undefined,loadingMask:null,metadataId:null,metadataUuid:null,metadataTitle:null,fileName:null,layerName:null,accessStatus:null,nodeId:null,geoPublicationMap:null,geoPublicationMapPanel:null,geoPublicationTb:null,layers:null,extent:null,stylerBt:null,publishBt:null,unpublishBt:null,checkBt:null,protocols:{wms:{checked:true,label:"OGC:WMS"},wfs:{checked:false,label:"OGC:WFS"},wcs:{checked:false,label:"OGC:WCS"}},addOnLineSourceBt:null,addOnLineSourceMenu:null,enableStyler:false,statusBar:null,layerPreviewName:"DatasetPreview",initComponent:function(){var a=this;
var f=Ext.data.Record.create([{name:"id"},{name:"name"},{name:"adminUrl"},{name:"wmsUrl"},{name:"wfsUrl"},{name:"wcsUrl"},{name:"stylerUrl"},{name:"namespacePrefix"}]);this.geoserverStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:a.serviceUrl+"?action=LIST",method:"GET"}),baseParams:{action:"LIST"},reader:new Ext.data.XmlReader({record:"node",id:"id"},f),sortInfo:{field:"name"}});this.publishBt=new Ext.Button({text:OpenLayers.i18n("publish"),tooltip:OpenLayers.i18n("publishTooltip"),iconCls:"addVector",handler:function(){this.statusBar.setText("");this.loadingMask.show();Ext.Ajax.request({url:a.serviceUrl,params:{metadataId:this.metadataId,metadataUuid:this.metadataUuid,metadataTitle:this.metadataTitle,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"CREATE"},method:"GET",success:function(j,h){if(j.responseText.indexOf("OutOfMemoryError")!==-1){this.statusBar.setText(OpenLayers.i18n("publishError")+OpenLayers.i18n("outOfMemoryError"));this.loadingMask.hide();return;}var g=j.responseXML.getElementsByTagName("Exception").item(0);if(g!==null){this.statusBar.setText(OpenLayers.i18n("publishError")+OpenLayers.i18n("publishErrorCode")+g.getAttribute("status"));this.loadingMask.hide();return;}this.statusBar.setText(OpenLayers.i18n("publishSuccess"));this.updatePrivileges(1);this.addLayer(this.layerPreviewName,this.layerName);this.statusBar.setText(this.statusBar.text+OpenLayers.i18n("publishLayerAdded"));this.loadingMask.hide();},failure:function(g,h){this.statusBar.setText(OpenLayers.i18n("publishError"));this.loadingMask.hide();},scope:this});},scope:this});this.unpublishBt=new Ext.Button({text:OpenLayers.i18n("unpublish"),tooltip:OpenLayers.i18n("unpublishTooltip"),iconCls:"delVector",handler:function(){this.statusBar.setText("");this.cleanLayerPreview();Ext.Ajax.request({url:a.serviceUrl,params:{metadataId:this.metadataId,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"DELETE"},method:"GET",success:function(g,h){this.statusBar.setText(OpenLayers.i18n("unpublishSuccess"));this.updatePrivileges(0);},failure:function(g,h){this.statusBar.setText(OpenLayers.i18n("unpublishError"));},scope:this});},scope:this});this.checkBt=new Ext.Button({text:OpenLayers.i18n("check"),iconCls:"connect",listeners:{click:function(){this.statusBar.setText("");Ext.Ajax.request({url:a.serviceUrl,params:{metadataId:this.metadataId,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"GET"},method:"GET",success:function(j,h){var g=j.responseXML.getElementsByTagName("Exception").item(0);if(g!==null){var l=g.getAttribute("status");this.statusBar.setText(OpenLayers.i18n("errorDatasetNotFound")+l);if(l.indexOf("No vector layer")!==-1||l.indexOf("404")!==-1){this.updatePrivileges(0);}else{this.updatePrivileges();}return;}this.statusBar.setText(OpenLayers.i18n("datasetFound"));this.updatePrivileges(1);this.addLayer(this.layerPreviewName,this.layerName);},failure:function(g,h){this.statusBar.setText(OpenLayers.i18n("checkFailure"));this.updatePrivileges();},scope:this});},scope:this}});this.addOnLineSourceBt={text:OpenLayers.i18n("addOnlineSource"),tooltip:"",iconCls:"processMetadata",handler:function(){var g=this.geoserverStore.getById(this.nodeId);this.fireEvent("addOnLineSource",this,g,this.protocols);},scope:this};var b=[];for(p in this.protocols){if(this.protocols.hasOwnProperty(p)){var d=this.protocols[p];b.push({text:d.label,canActivate:false,hideOnClick:false,checked:d.checked,checkHandler:this.protocolChecked,scope:d});}}b.push("-",this.addOnLineSourceBt);this.addOnLineSourceMenu=new Ext.Button({iconCls:"processMetadata",text:OpenLayers.i18n("addOnlineSourceTitle"),tooltip:OpenLayers.i18n("addOnlineSourceTT"),menu:new Ext.menu.Menu({items:b})});this.stylerBt=new Ext.Button({text:OpenLayers.i18n("Style"),iconCls:"styler",id:"stylerBt",tooltip:"",handler:function(){var h=this.geoserverStore.getById(this.nodeId);var g=h.get("stylerUrl")+"?namespace="+h.get("namespacePrefix")+"&layer="+h.get("namespacePrefix")+":"+this.layerName;window.open(g,"","toolbar=no,menubar=no,width=600,height=500");},scope:this});this.geoPublicationTb=new Ext.Toolbar({items:[this.getGeoserverCombo(),this.checkBt,this.publishBt,this.unpublishBt,this.addOnLineSourceMenu,this.stylerBt]});this.statusBar=new Ext.form.Label({id:"statusBar",html:OpenLayers.i18n("statusInformation")});var e=new Ext.Toolbar({items:[this.statusBar]});this.geoserverStore.load({add:false});this.tbar=this.geoPublicationTb;this.bbar=e;this.items=this.getGeoPublicationMapPanel();this.addEvents("addOnLineSource");GeoNetwork.editor.GeoPublisherPanel.superclass.initComponent.call(this);this.on("resize",function(h,j,g){h.geoPublicationMapPanel.setSize(j,g);});if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(Ext.getBody(),{msg:OpenLayers.i18n("publishing")});}},getGeoPublicationMapPanel:function(){var b={projection:GeoNetwork.map.PROJECTION,theme:null,maxExtent:GeoNetwork.map.EXTENT};var a=new OpenLayers.Map(b),d;this.geoPublicationMapPanel=new GeoExt.MapPanel({id:"mapPanel",layers:GeoNetwork.map.BACKGROUND_LAYERS||[],map:a,width:this.width,height:this.height});return this.geoPublicationMapPanel;},addLayer:function(d,e){var b=Ext.getCmp("mapPanel").map;var a=new OpenLayers.Bounds.fromArray(this.extent);if(GeoNetwork.map.PROJECTION!=="EPSG:4326"){a.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection(GeoNetwork.map.PROJECTION));}b.zoomToExtent(a||GeoNetwork.map.EXTENT);this.cleanLayerPreview();var f=new OpenLayers.Layer.WMS(d,this.geoserverStore.getById(this.nodeId).get("wmsUrl"),{transparent:"true",layers:e},{singleTile:true});b.addLayer(f);},cleanLayerPreview:function(){var b=Ext.getCmp("mapPanel").map;var a=b.getLayersByName(this.layerPreviewName);if(a.length>0){a[0].destroy();}},getGeoserverCombo:function(){return{xtype:"combo",tpl:'<tpl for="."><div ext:qtip="{name}. {adminUrl}" class="x-combo-list-item">{name}</div></tpl>',store:this.geoserverStore,displayField:"name",autoSelect:true,forceSelection:true,mode:"local",triggerAction:"all",emptyText:OpenLayers.i18n("selectANode"),id:"geoserverNode",listeners:{select:function(a,b,d){this.nodeId=b.get("id");this.cleanLayerPreview();this.enableStyler=(b.get("stylerUrl")===""?false:true);this.checkBt.fireEvent("click");},scope:this}};},setRef:function(a,b,e,h,d){this.metadataId=a;this.metadataUuid=b;this.metadataTitle=e;this.fileName=h;this.accessStatus=d;if(this.fileName.indexOf("jdbc")!==-1){this.layerName=this.fileName.substr(this.fileName.indexOf("#")+1,this.fileName.length);}else{if(this.accessStatus==="fileOrUrl"){var g=this.fileName.lastIndexOf("/")+1;var f=this.fileName.lastIndexOf(".");this.layerName=this.fileName.substr(g,f-g);}else{this.layerName=this.fileName.substr(0,this.fileName.indexOf("."));}}this.cleanLayerPreview();this.updatePrivileges();if(this.nodeId!==null){this.checkBt.fireEvent("click");}},protocolChecked:function(b,a){this.checked=a;},updatePrivileges:function(a){if(this.nodeId===null){this.checkBt.disable();}else{this.checkBt.enable();}this.publishBt.disable();this.unpublishBt.disable();this.addOnLineSourceMenu.disable();this.stylerBt.disable();switch(a){case 0:this.publishBt.enable();break;case 1:this.publishBt.enable();this.unpublishBt.enable();this.addOnLineSourceMenu.enable();if(this.fileName.indexOf("tif")!==-1||!this.enableStyler){this.stylerBt.disable();}else{this.stylerBt.enable();}break;}}});Ext.reg("gn_editor_geopublisherpanel",GeoNetwork.editor.GeoPublisherPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.SuggestionsPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,iconCls:"suggestionIcon",title:undefined,collapsible:true,collapsed:true},metadataId:undefined,processName:undefined,processParams:undefined,processParametersWindow:undefined,catalogue:undefined,editor:undefined,store:undefined,clear:function(){this.store.removeAll();},reload:function(a,b){this.metadataId=b||this.metadataId;if(this.collapsed){return;}this.store.reload({params:{id:this.metadataId}});
},runSuggestedProcess:function(){if(this.processName){if(this.processParams){this.generateForm();}else{var a=this.catalogue.services.mdProcessing+"?id="+this.metadataId+"&process="+this.processName;this.run(a);}}},run:function(a){this.editor.process(a);if(this.processParametersWindow){this.processParametersWindow.hide();this.processParametersWindow.destroy();this.processParametersWindow=undefined;}},selectionChangeEvent:function(d,a){var b=d.getRecords(a);if(b[0]){this.getBottomToolbar().setDisabled(false);this.processName=b[0].get("name");this.processParams=b[0].get("params");}else{this.getBottomToolbar().setDisabled(true);this.processName=undefined;this.processParams=undefined;}},generateForm:function(){this.processParametersWindow=undefined;if(!this.processParametersWindow){var g=new Ext.form.FormPanel({defaultType:"textfield",items:[{name:"id",allowBlank:false,hidden:true,value:this.metadataId},{name:"process",allowBlank:false,hidden:true,value:this.processName}],buttons:[{text:OpenLayers.i18n("process"),iconCls:"suggestionRunIcon",handler:function(){if(g.getForm().isValid()){var h=this.catalogue.services.mdProcessing+"?"+g.getForm().getValues(true);this.run(h);}},scope:this},{text:OpenLayers.i18n("reset"),iconCls:"cancel",handler:function(){g.getForm().reset();}}]});var e=Ext.util.JSON.decode(this.processParams),b,d="",f=false,a;for(a in e){if(e.hasOwnProperty(a)){if(e[a].type==="boolean"){b="checkbox";}else{b="textfield";}if(a==="gurl"&&this.catalogue.URL){d=this.catalogue.URL;f=true;}else{if(a==="lang"&&this.catalogue.LANG){d=this.catalogue.LANG;f=true;}else{f=false;d=e[a].defaultValue;}}g.add({xtype:b,name:a,fieldLabel:OpenLayers.i18n(this.processName+a),hidden:f,value:d});}}this.processParametersWindow=new Ext.Window({title:OpenLayers.i18n("processParametersWindow"),width:300,height:300,layout:"fit",modal:true,items:g,closeAction:"destroy",constrain:true,iconCls:"suggestionIcon"});}this.processParametersWindow.show();},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("suggestions");this.tools=[{id:"refresh",handler:function(f,d,g,e){g.reload(g,g.metadataId);}}];this.bbar=new Ext.Toolbar({disabled:true,items:[{text:OpenLayers.i18n("applySelected"),iconCls:"suggestionRunIcon",handler:this.runSuggestedProcess,scope:this}]});var a=new Ext.XTemplate('<ul><tpl for=".">','<li class="suggestion" title="{name}">{desc}','<span class="suggestion-{operational}"></span></li>',"</tpl></ul>");this.store=new GeoNetwork.data.SuggestionStore(this.catalogue.services.mdSuggestion,{action:"analyze",id:this.metadataId},false);var b=new Ext.DataView({store:this.store,tpl:a,singleSelect:true,autoHeight:true,loadingText:"...",selectedClass:"suggestion-selected",overClass:"suggestion-over",itemSelector:"li.suggestion",emptyText:OpenLayers.i18n("noSuggestion"),listeners:{selectionchange:this.selectionChangeEvent,scope:this}});GeoNetwork.editor.SuggestionsPanel.superclass.initComponent.call(this);this.add(b);this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);}});Ext.reg("gn_editor_suggestionspanel",GeoNetwork.editor.SuggestionsPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.ThumbnailPanel=Ext.extend(Ext.Panel,{title:undefined,metadataId:undefined,versionId:undefined,setThumbnail:undefined,unsetThumbnail:undefined,getThumbnail:undefined,uploadForm:undefined,idField:undefined,versionField:undefined,thumbnail:undefined,editor:undefined,dataView:undefined,store:undefined,thumbnailUploadWindow:undefined,addButton:undefined,delButton:undefined,defaultConfig:{border:false,frame:false,iconCls:"thumbnailIcon",collapsible:true,collapsed:false,autoScroll:true},clear:function(){this.store.removeAll();},reload:function(a,b,f,d){this.metadataId=b||this.metadataId;this.versionId=d||this.metadataId;if(this.collapsed){return;}this.idField.setValue(this.metadataId);this.versionField.setValue(this.versionId);this.store.reload({params:{id:this.metadataId}});},uploadThumbnail:function(){if(!this.thumbnailUploadWindow){this.thumbnailUploadWindow=new Ext.Window({title:OpenLayers.i18n("thumbnailUploadWindow"),width:300,height:300,layout:"fit",modal:true,items:this.uploadForm,closeAction:"hide",constrain:true,iconCls:"thumbnailAddIcon"});}this.thumbnailUploadWindow.show();},removeThumbnail:function(){var a=this,b=this.unsetThumbnail+"?id="+this.metadataId+"&version="+this.versionId+"&type="+(this.thumbnail==="thumbnail"?"small":"large");OpenLayers.Request.GET({url:b,success:function(d){a.editor.init(a.metadataId);},failure:function(d){}});},selectionChangeEvent:function(e,a){var d=a?e.getRecords(a):[],b=this.dataView.getStore().query("desc",/thumbnail|large_thumbnail/).length==2;if(d[0]){this.thumbnail=d[0].get("desc");if(this.thumbnail==="thumbnail"||this.thumbnail==="large_thumbnail"){this.delButton.setDisabled(false);}else{this.delButton.setDisabled(true);}}else{this.delButton.setDisabled(true);this.thumbnail=undefined;}this.addButton.setDisabled(b);},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("thumbnails");this.tools=[{id:"refresh",handler:function(f,d,g,e){g.reload(g,g.metadataId);}}];var a=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="thumbnail">','<img class="thumb-small" src="{href}" title="{desc}"><br/>','<a rel="lightbox-set" class="md-mn lightBox" href="{href}"></a>',"<span>{desc}</span>","</li>","</tpl>","</ul>");this.addButton=new Ext.Button({text:OpenLayers.i18n("addThumbnail"),iconCls:"thumbnailAddIcon",handler:this.uploadThumbnail,scope:this});this.delButton=new Ext.Button({text:OpenLayers.i18n("removeSelected"),iconCls:"thumbnailDelIcon",disabled:true,handler:this.removeThumbnail,scope:this});this.bbar=new Ext.Toolbar({items:[this.addButton,this.delButton]});this.store=new GeoNetwork.data.MetadataThumbnailStore(this.getThumbnail,{id:this.metadataId});this.store.on("load",function(){this.dataView.fireEvent("selectionchange",this);Ext.ux.Lightbox.register("a[rel^=lightbox-set]",true);},this);this.idField=new Ext.form.TextField({xtype:"textfield",name:"id",value:this.metadataId,hidden:true});this.versionField=new Ext.form.TextField({name:"version",value:this.versionId,hidden:true});var b=new Ext.slider.Tip({getText:function(d){return String.format("<b>{0} px</b>",d.value);}});this.uploadForm=new Ext.form.FormPanel({fileUpload:true,items:[this.idField,this.versionField,{xtype:"textfield",name:"scalingDir",value:"width",hidden:true},{xtype:"textfield",name:"smallScalingDir",value:"width",hidden:true},{xtype:"fileuploadfield",emptyText:OpenLayers.i18n("selectImage"),fieldLabel:OpenLayers.i18n("image"),name:"fname",allowBlank:false,buttonText:"",buttonCfg:{iconCls:"thumbnailAddIcon"}},{xtype:"radio",checked:true,fieldLabel:"Type",boxLabel:OpenLayers.i18n("large"),name:"type",value:"large"},{xtype:"radio",fieldLabel:"",boxLabel:OpenLayers.i18n("small"),name:"type",value:"small"},{xtype:"sliderfield",fieldLabel:OpenLayers.i18n("scalingFactor"),name:"scalingFactor",value:1000,minValue:400,maxValue:1800,increment:200},{xtype:"checkbox",checked:true,hideLabel:true,fieldLabel:"",labelSeparator:"",boxLabel:OpenLayers.i18n("createSmall"),name:"createSmall",value:"true"},{xtype:"sliderfield",fieldLabel:OpenLayers.i18n("smallScalingFactor"),name:"smallScalingFactor",value:180,minValue:100,maxValue:220,increment:20}],buttons:[{text:OpenLayers.i18n("upload"),formBind:true,iconCls:"thumbnailGoIcon",scope:this,handler:function(){if(this.uploadForm.getForm().isValid()){var d=this;this.uploadForm.getForm().submit({url:this.setThumbnail,waitMsg:OpenLayers.i18n("uploading"),success:function(f,e){d.editor.init(d.metadataId);d.thumbnailUploadWindow.hide();}});}}},{text:OpenLayers.i18n("reset"),iconCls:"cancel",scope:this,handler:function(){this.uploadForm.getForm().reset();}}]});GeoNetwork.editor.ThumbnailPanel.superclass.initComponent.call(this);this.dataView=new Ext.DataView({autoHeight:true,autoWidth:true,store:this.store,tpl:a,singleSelect:true,selectedClass:"thumbnail-selected",overClass:"thumbnail-over",itemSelector:"li.thumbnail",emptyText:OpenLayers.i18n("noimages"),listeners:{selectionchange:this.selectionChangeEvent,scope:this}});
this.add(this.dataView);if(this.metadataId){this.reload(this,this.metadataId);}this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);}});Ext.reg("gn_editor_thumbnailpanel",GeoNetwork.editor.ThumbnailPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.ValidationPanel=Ext.extend(Ext.Panel,{title:undefined,editor:undefined,metadataId:undefined,serviceUrl:undefined,store:undefined,defaultConfig:{border:false,frame:false,collapsible:true,collapsed:true,iconCls:"validateMetadata"},validate:function(){this.editor.validate(function(){this.updateValidationReport();}.bind(this));},updateValidationReport:function(){if(this.collapsed){this.toggleCollapse();}this.reload(this);},clear:function(){this.store.removeAll();},reload:function(a,b){this.metadataId=b||this.metadataId;if(this.collapsed){return;}this.store.reload({params:{id:this.metadataId}});},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("validationReport");this.tools=[{id:"refresh",handler:function(g,f,j,h){j.reload(j,j.metadataId);}}];GeoNetwork.editor.ValidationPanel.superclass.initComponent.call(this);this.store=new GeoNetwork.data.ValidationRuleStore(this.serviceUrl,{id:this.metadataId},true);var a=Ext.grid;var b=new a.RowExpander({tpl:new Ext.XTemplate('<div title="{details}"><b>{title}</b></div>{msg}')});var d=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:[b,{id:"group",header:OpenLayers.i18n("group"),width:60,sortable:true,hidden:true,dataIndex:"group"},{header:OpenLayers.i18n("status"),width:10,resizable:false,sortable:true,dataIndex:"statusIcon"},{header:OpenLayers.i18n("title"),hidden:false,dataIndex:"title"}]});var e=new a.GridPanel({store:this.store,colModel:d,loadMask:true,plugins:b,view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+OpenLayers.i18n("items")+'" : "'+OpenLayers.i18n("item")+'"]})'}),frame:false,height:300,autoWidth:true});this.add(e);this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);}});Ext.reg("gn_editor_validationpanel",GeoNetwork.editor.ValidationPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.AdminTools={showImportMetadataWindow:function(a,b){var d=new GeoNetwork.admin.MetadataInsertPanel({metadataType:a});var e=new Ext.Window({title:b||OpenLayers.i18n("importMetadata"),width:450,height:450,layout:"fit",modal:true,items:d,closeAction:"destroy",constrain:true,iconCls:"addIcon"});e.show();}};Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.HarvesterPanel=Ext.extend(Ext.Panel,{border:false,frame:false,layout:"border",height:800,catalogue:undefined,harvesterStore:undefined,harvesterTplMarkup:["Information: {site_name}<br/>","Last run: {info_lastrun}<br/>",'<tpl if="info_result_total">',"Total: {info_result_total}<br/>","Added: {info_result_added}<br/>","Removed: {info_result_removed}<br/>","Schema unknwon: {info_result_unknowSchema}<br/>","</tpl>"],harvesterTpl:undefined,xmlTpl:undefined,harvesterGrid:undefined,currentHarvester:undefined,initComponent:function(){GeoNetwork.admin.HarvesterPanel.superclass.initComponent.call(this);panel=this;this.createGrid();this.harvesterTpl=new Ext.XTemplate(this.harvesterTplMarkup);this.xmlTpl=new GeoNetwork.Templates().getHarvesterTemplate();this.harvesterGrid.getSelectionModel().on("rowselect",function(e,d,g){var f=Ext.getCmp("harvesterDetailPanel");this.harvesterTpl.overwrite(f.body,g.data);},this);var b={id:"harvesterDetailPanel",region:"east",split:true,minWidth:200,width:200,collapsible:true,hideCollapseTool:true,collapseMode:"mini",bodyStyle:{background:"#ffffff",padding:"7px"},html:"Please select a harvester to see additional details."};this.add(b);var a={id:"harvesterEditorPanel",region:"south",title:"Harvester configuration",split:true,autoScroll:true,minHeigth:400,items:[new Ext.FormPanel({border:false,frame:false,maxHeight:600,id:"harvesterEditorForm",items:[this.getHarvesterTypeField(),this.getSiteFields("geonetwork"),this.getOptionsFields("geonetwork")],buttons:[{text:"Save",listeners:{click:function(){var e=Ext.getCmp("harvesterEditorForm").getForm();if(e.isValid()){e.updateRecord(this.currentHarvester);var d=this.xmlTpl.apply(this.currentHarvester.data);this.addHarvester(this.catalogue.services.harvestingAdd,d);}},scope:panel}}]})]};this.add(a);},harvesterType:[["geonetwork","GeoNetwork"],["geonetwork20","GeoNetwork 2.0"],["webdav","webdav"],["csw","csw"],["ogcwxs","OGC WxS"],["thredds","thredds"],["z3950","z3950"],["oaipmh","oaipmh"],["metadatafragments","metadatafragments"],["arcsde","arcsde"],["filesystem","filesystem"]],switchMode:function(a){this.switchElement("site_servlet",false);this.switchElement("site_port",false);this.switchElement("site_host",false);this.switchElement("site_url",false);if(a=="geonetwork"||a=="geonetwork20"){this.switchElement("site_servlet",true);this.switchElement("site_port",true);this.switchElement("site_host",true);}else{this.switchElement("site_url",true);}if(a=="ogcwxs"){}},switchElement:function(h,g){var d=Ext.getCmp(h);var a=Ext.getCmp("harvesterEditorForm");var b=a.getForm().findField(h);if(g){b.container.up("div.x-form-item").show();d.enable();}else{b.container.up("div.x-form-item").hide();d.disable();}a.doLayout(false,true);},getHarvesterTypeField:function(){return new Ext.form.ComboBox({id:"type",name:"type",mode:"local",triggerAction:"all",fieldLabel:"Harvester type",store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:this.harvesterType}),valueField:"id",displayField:"name",listeners:{change:function(a,d,b){this.switchMode(d);},scope:this}});},ogcwxsType:[["WMS1.0.0","WMS 1.0.0"],["WMS1.1.1","WMS 1.1.1"],["WFS1.0.0","WFS 1.0.0"],["WFS1.1.0","WFS 1.1.0"],["WCS1.0.0","WCS 1.0.0"],["WPS0.4.0","WPS 0.4.0"],["WPS1.0.0","WPS 1.0.0"]],getSiteFields:function(j){var h=[];var d=new Ext.form.TextField({id:"id",name:"id",mode:"local",hidden:true});var o=new Ext.form.TextField({name:"site_name",mode:"local",fieldLabel:"Name"});h.push(d,o);var a=new Ext.form.TextField({id:"site_url",name:"site_url",mode:"local",fieldLabel:"URL"});var q=new Ext.form.ComboBox({id:"site_ogctype",name:"site_ogctype",mode:"local",fieldLabel:"Type of service",store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:this.ogcwxsType}),valueField:"id",displayField:"name"});h.push(a,q);var m=new Ext.form.TextField({id:"site_servlet",name:"site_servlet",mode:"local",fieldLabel:"Servlet"});var b=new Ext.form.TextField({id:"site_host",name:"site_host",mode:"local",fieldLabel:"Host"});var e=new Ext.form.TextField({id:"site_port",name:"site_port",mode:"local",fieldLabel:"Port"});h.push(b,e,m);var f=new Ext.form.Checkbox({id:"site_account_use",name:"site_account_use",mode:"local",fieldLabel:"Use account"});var g=new Ext.form.TextField({id:"site_account_username",name:"site_account_username",mode:"local",fieldLabel:"Username"});var l=new Ext.form.TextField({id:"site_account_password",name:"site_account_password",mode:"local",fieldLabel:"Password"});h.push(f,g,l);return{xtype:"fieldset",title:"Harvester main information",collapsible:true,items:h};},getOptionsFields:function(){var b=[];var h=new Ext.form.Checkbox({id:"options_createthumbnails",name:"options_createthumbnails",mode:"local",fieldLabel:"Create thumbnail for WMS layers"});var g=new Ext.form.Checkbox({id:"options_uselayer",name:"options_uselayer",mode:"local",fieldLabel:"Create metadata for layer elements using GetCapabilities information"});var d=new Ext.form.Checkbox({id:"options_uselayermd",name:"options_uselayermd",mode:"local",fieldLabel:"Create metadata for layer elements using MetadataURL attributes (if existing, if not use GetCapabilities)"});var f=new Ext.form.TextField({id:"options_lang",name:"options_lang",mode:"local",defaultValue:"eng",fieldLabel:"Language"});var e=new Ext.form.TextField({id:"options_topic",name:"options_topic",mode:"local",defaultValue:"",fieldLabel:"Topic category"});
b.push(h,g,d,f,e);var a=new Ext.form.Checkbox({id:"options_onerunonly",name:"options_onerunonly",mode:"local",fieldLabel:"One run only"});var j=new Ext.form.TextField({id:"options_every",name:"options_every",mode:"local",defaultValue:"90",fieldLabel:"Every"});b.push(a,j);return{xtype:"fieldset",title:"Harvester options",collapsible:true,items:b};},getPrivilegesFields:function(){return;},getCategoriesFields:function(){return;},createEditor:function(){var a=Ext.data.Record.create([{name:"id",mapping:"node/@id"},{name:"occupation"}]);},createGrid:function(){var a=new Ext.grid.CheckboxSelectionModel({singleSelect:true,header:"",listeners:{selectionchange:function(){Ext.getCmp("harvestEditBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestRemoveBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestActivateBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestDesactivateBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestRunBt").setDisabled(this.getSelections().length<1);}}});this.harvesterGrid=new Ext.grid.GridPanel({store:this.harvesterStore,split:true,id:"harvesterGrid",region:"center",sm:a,columns:[a,{id:"id",header:"id",width:60,sortable:true,dataIndex:"id",hidden:true},{header:"Name",width:125,sortable:true,dataIndex:"site_name"},{header:"Type",width:75,sortable:true,dataIndex:"type"},{header:"Status",width:80,sortable:true,dataIndex:"site_status"},{header:"Running",width:80,sortable:true,dataIndex:"info_running"},{header:"Every",width:80,sortable:true,dataIndex:"options_every"},{header:"Last run",width:160,sortable:true,dataIndex:"info_lastrun"}],stripeRows:true,maxHeight:250,height:250,stateful:true,stateId:"grid",listeners:{rowclick:function(f,j,g){var b=this.harvesterGrid.getStore().getAt(j);this.currentHarvester=b;console.log(b);var d=Ext.getCmp("harvesterEditorForm").getForm();d.loadRecord(b);},scope:this},buttons:[{text:"Add",listeners:{click:function(){}}},{text:"Activate",id:"harvestActivateBt",disabled:true,listeners:{click:function(){var b=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();var d={id:b.data.id};this.doAction(this.catalogue.services.harvestingStart,d,this.refreshHarvester,null,null,"Failed to activate the harvester");},scope:this}},{text:"Desactivate",id:"harvestDesactivateBt",disabled:true,listeners:{click:function(){var b=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();var d={id:b.data.id};this.doAction(this.catalogue.services.harvestingStop,d,this.refreshHarvester,null,null,"Failed to desactivate the harvester");},scope:this}},{id:"harvestEditBt",text:"Edit",disabled:true,listeners:{click:function(){},scope:this}},{text:"Run",id:"harvestRunBt",disabled:true,listeners:{click:function(){var b=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();var d={id:b.data.id};this.doAction(this.catalogue.services.harvestingRun,d,this.refreshHarvester,null,null,"Failed to start the harvester");},scope:this}},{id:"harvestRemoveBt",text:"Remove",icon:"../images/default/cross.png",disabled:true,listeners:{click:function(){var b=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();Ext.Msg.confirm("Delete ?","Are you sure to delete selected harvester and all its records?",this.removeHarvester,b.data.id);},scope:this}},{text:"Refresh",id:"harvestRefreshBt",listeners:{click:function(){this.harvesterGrid.getStore().reload();},scope:this}}]});this.add(this.harvesterGrid);},addHarvester:function(d,b){var a={url:d,data:b};OpenLayers.Util.applyDefaults(a,{success:function(e){Ext.Msg.alert("ok",e.responseText);},failure:function(e){Ext.Msg.alert("Failed",e.responseText);}});OpenLayers.Request.POST(a);},doAction:function(d,a,g,e,b,f){OpenLayers.Request.GET({url:d,params:a,success:function(h){if(b){Ext.Msg.alert(b,h.responseText);}if(g){g(h);}},failure:function(h){if(f){Ext.Msg.alert(f,h.responseText);}if(g){g(h);}}});},removeHarvester:function(a){if(a=="yes"){var b={id:this};this.doAction(this.catalogue.services.harvestingRemove,b,this.refreshHarvester,null,null,"Failed to delete the harvester");}},refreshHarvester:function(){Ext.getCmp("harvestRefreshBt").fireEvent("click");}});Ext.reg("gn_admin_harvesterpanel",GeoNetwork.admin.HarvesterPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.MetadataInsertPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoScroll:true,autoWidth:true,layout:"border"},store:undefined,view:undefined,uploadForm:undefined,serviceUrl:undefined,ref:undefined,setRef:function(a){this.ref=a;},getForm:function(){var a=GeoNetwork.data.GroupStore(catalogue.services.getGroups);a.load();this.uploadForm=new Ext.form.FormPanel({region:"center",split:true,errorReader:new Ext.data.XmlReader({record:"response"},["id"]),items:[{xtype:"textfield",hidden:true,name:"insert_mode",value:"0"},{xtype:"textfield",hidden:true,name:"template",value:"s"},{xtype:"textarea",name:"data",fieldLabel:OpenLayers.i18n("xmlData"),allowBlank:false,width:300,height:200},new Ext.form.ComboBox({name:"group",hiddenName:"group",mode:"local",emptyText:OpenLayers.i18n("chooseGroup"),triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:a,allowBlank:false,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>"})],buttons:[{text:OpenLayers.i18n("add"),scope:this,iconCls:"thumbnailGoIcon",handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:catalogue.services.mdXMLInsert,scope:this,success:function(b,d){if(this.ownerCt){this.ownerCt.close();}},failure:function(b){Ext.Msg.alert(OpenLayers.i18n("failure"),b.responseText);}});}}}]});return this.uploadForm;},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.items=[this.getForm()];GeoNetwork.admin.MetadataInsertPanel.superclass.initComponent.call(this);}});Ext.reg("gn_admin_metadatainsertpanel",GeoNetwork.admin.MetadataInsertPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.SubTemplateManagerPanel=Ext.extend(Ext.Panel,{border:false,frame:false,record:undefined,layout:"border",catalogue:undefined,toolbar:undefined,searchPanel:undefined,searchForm:undefined,searchField:undefined,newMetadataWindow:undefined,searchResultGrid:undefined,subTemplateEditor:undefined,subTemplateToolbar:undefined,subTemplateType:undefined,subTemplateTypeStore:undefined,defaultConfig:{defaultViewMode:"simple",height:800,autoWidth:true,layout:"border",iconCls:"subtemplateIcon"},getSubTemplateTypeField:function(){return{xtype:"combo",name:"E__root",mode:"local",title:OpenLayers.i18n("selDirectoryTT"),triggerAction:"all",store:this.subTemplateTypeStore,valueField:"type",tpl:'<tpl for="."><div class="x-combo-list-item" title="{description}">{label} ({type})</div></tpl>',displayField:"label"};},initComponent:function(b){Ext.apply(this,b);Ext.applyIf(this,this.defaultConfig);this.subTemplateTypeStore=new GeoNetwork.data.SubTemplateTypeStore(this.catalogue.services.subTemplateType);this.catalogue.metadataStore=GeoNetwork.data.MetadataResultsStore();this.catalogue.editMode=2;this.catalogue.metadataEditFn=function(f,g,h,e){this.editorPanel.init(f,g,h,e,"s");}.bind(this);GeoNetwork.admin.SubTemplateManagerPanel.superclass.initComponent.call(this);this.initSearch();this.initEditor();var a={region:"west",split:true,collapsible:true,collapsed:false,hideCollapseTool:true,collapseMode:"mini",autoScroll:true,minWidth:240,width:280,items:[this.searchForm,this.searchResultGrid]};var d={region:"center",split:true,autoScroll:true,minHeigth:400,items:[this.editorPanel]};this.add(a);this.add(d);this.searchField.focus(true);},search:function(){this.editorPanel.cancel();this.catalogue.search("searchForm",null,null);},initSearch:function(){var a=this;this.searchField=new GeoNetwork.form.SearchField({name:"E_any",store:this.catalogue.metadataStore,triggerAction:function(d){d.record=undefined;d.disableToolbar(true);d.search();},scope:a});this.searchForm=new Ext.FormPanel({id:"searchForm",border:false,defaults:{width:240,hideLabel:true},items:[this.getSubTemplateTypeField(),{xtype:"textfield",name:"E__isTemplate",hidden:true,value:"s"},this.searchField]});
var b=["afterDelete"];Ext.each(b,function(d){this.catalogue.on(d,function(){this.search();},this);},this);this.searchResultGrid=new Ext.grid.GridPanel({layout:"fit",autoHeight:true,height:500,border:false,store:this.catalogue.metadataStore,columns:[{id:"title",header:OpenLayers.i18n("title"),dataIndex:"title"},{id:"uuid",header:"Uuid",dataIndex:"uuid",hidden:true}],autoExpandColumn:"title",listeners:{rowclick:function(f,e,d){this.record=f.getStore().getAt(e).data;this.editorPanel.init(this.record.id,false);this.disableToolbar(false);},scope:a},bbar:{items:[{xtype:"button",text:OpenLayers.i18n("add"),tooltip:OpenLayers.i18n("addTplElTT"),iconCls:"addIcon",handler:function(){var d="s";GeoNetwork.admin.AdminTools.showImportMetadataWindow(d,OpenLayers.i18n("subTemplateImport"));},scope:this},{text:OpenLayers.i18n("duplicate"),tooltip:OpenLayers.i18n("copyTplElTT"),iconCls:"md-mn-copy",disabled:true,handler:function(){var d=this.record.id;GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,d,OpenLayers.i18n("duplicate"),false);},scope:this},{text:OpenLayers.i18n("delete"),tooltip:OpenLayers.i18n("delTplElTT"),iconCls:"md-mn-del",disabled:true,handler:function(){var d=this.record.uuid;this.catalogue.metadataDelete(d);},scope:this},{text:OpenLayers.i18n("privileges"),tooltip:OpenLayers.i18n("privTplElTT"),iconCls:"privIcon",disabled:true,handler:function(){var d=this.record.id;this.catalogue.metadataAdmin(d);},scope:this}]}});},disableToolbar:function(a){var b=this.searchResultGrid.getBottomToolbar();Ext.each(b.items,function(e,d){if(d!==0){b.get(d).setDisabled(a);}},b);},initEditor:function(){var a={collapsed:true,hidden:true};this.editorPanel=new GeoNetwork.editor.EditorPanel({defaultViewMode:this.defaultViewMode,tbarConfig:{hideTypeMenu:true},utilityPanelConfig:{thumbnailPanel:a,relationPanel:a,validationPanel:{collapsed:true},suggestionPanel:a,helpPanel:{collapsed:false}},catalogue:this.catalogue,utilityPanelCollapsed:true});},refresh:function(){this.subTemplateTypeStore.load();}});Ext.reg("gn_admin_subtemplatemanagerpanel",GeoNetwork.admin.SubTemplateManagerPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.ThesaurusManagerPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoWidth:true,layout:"border",maxResults:50,defaultThesaurusType:"theme"},border:false,frame:false,selectedThesaurus:undefined,layout:"border",catalogue:undefined,toolbar:undefined,thesaurusGrid:undefined,thesaurusStore:undefined,keywordGrid:undefined,createEmptyThesaurusWindow:undefined,createThesaurusFromLocalFileWindow:undefined,createThesaurusFromRemoteFileWindow:undefined,createEmptyThesaurusForm:undefined,createThesaurusFromLocalFileForm:undefined,createThesaurusFromRemoteFileForm:undefined,initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.thesaurusStore=new GeoNetwork.data.ThesaurusStore({url:this.catalogue.services.getThesaurus});var d=Ext.data.Record.create([{name:"id"},{name:"value"},{name:"thesaurus"},{name:"definition"},{name:"uri"},{name:"east"},{name:"west"},{name:"south"},{name:"north"}]);this.keywordStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pThesauri:"",pMode:"searchBox",maxResults:this.maxResults},reader:new Ext.data.XmlReader({record:"keyword",id:"id"},d),fields:["id","value","definition","thesaurus","uri","east","west","south","north"],sortInfo:{field:"value"}});GeoNetwork.admin.ThesaurusManagerPanel.superclass.initComponent.call(this);this.initThesaurusView();this.initKeywordView();var a={region:"west",split:true,autoScroll:true,minWidth:280,width:400,items:[this.thesaurusGrid]};var b={region:"center",split:true,autoScroll:true,minHeigth:400,items:[this.keywordGrid]};this.add(a);this.add(b);},initThesaurusView:function(){var d=this;var b=[["y"],["n"]];var a=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"title",header:OpenLayers.i18n("ThesaurusName"),dataIndex:"title",editable:false},{id:"filename",header:OpenLayers.i18n("id"),dataIndex:"filename",editable:false},{id:"theme",header:OpenLayers.i18n("Theme"),dataIndex:"theme",editable:false},{id:"type",header:OpenLayers.i18n("Type"),dataIndex:"type",editable:false},{id:"activated",header:OpenLayers.i18n("Activated"),dataIndex:"activated",width:50,editor:new Ext.form.ComboBox({mode:"local",editable:false,typeAhead:true,triggerAction:"all",lazyRender:true,allowBlank:false,listClass:"x-combo-list-small",store:new Ext.data.ArrayStore({id:0,fields:["id"],data:b}),valueField:"id",displayField:"id"})}]});this.thesaurusGrid=new Ext.grid.EditorGridPanel({layout:"fit",autoHeight:true,border:false,store:this.thesaurusStore,cm:a,autoExpandColumn:"title",clicksToEdit:1,listeners:{scope:this,afteredit:function(e){Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusActivate+"?ref="+e.record.data.id+"&activated="+e.record.data.activated,failure:function(){Ext.Msg.alert("Fail");}});},dblclick:function(e){this.keywordStore.setBaseParam("pKeyword","*");this.keywordStore.reload();}},sm:new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{scope:this,selectionchange:function(e){this.updateKeywordGridAndToolbar();this.updateThesaurusToolbar();this.updateKeywordToolbar();}}}),tbar:{disabled:false,items:[{text:OpenLayers.i18n("add"),iconCls:"addIcon",menu:{xtype:"menu",plain:true,items:[{text:OpenLayers.i18n("emptyThesaurus"),scope:this,handler:function(){if(!this.createEmptyThesaurusWindow){this.createEmptyThesaurusWindow=this.getCreateEmptyThesaurusWindow();}this.createEmptyThesaurusWindow.show(this);}},{text:OpenLayers.i18n("thesaurusFromFile"),scope:this,handler:function(){if(!this.createThesaurusFromLocalFileWindow){this.createThesaurusFromLocalFileWindow=this.getCreateThesaurusFromLocalFileWindow();}this.createThesaurusFromLocalFileWindow.show(this);}},{text:OpenLayers.i18n("thesaurusFromURL"),scope:this,handler:function(){if(!this.createThesaurusFromRemoteFileWindow){this.createThesaurusFromRemoteFileWindow=this.getCreateThesaurusFromRemoteFileWindow();}this.createThesaurusFromRemoteFileWindow.show(this);}}]}},{id:"delete_thesaurus_button",disabled:true,text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){OpenLayers.Request.GET({scope:this,url:this.catalogue.services.thesaurusDelete+"?ref="+this.keywordStore.baseParams.pThesauri,success:function(e){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(e){}});},scope:this},{id:"download_thesaurus_button",disabled:true,text:OpenLayers.i18n("download"),iconCls:"xmlIcon",handler:function(){location.replace(this.catalogue.services.thesaurusDownload+"?ref="+this.keywordStore.baseParams.pThesauri);},scope:this}]}});},initKeywordView:function(){var a=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"id",header:OpenLayers.i18n("id"),dataIndex:"uri",editor:new Ext.form.TextField({allowBlank:false})},{id:"hidden_id",header:OpenLayers.i18n("uri"),dataIndex:"id",hidden:true,editor:new Ext.form.TextField({allowBlank:false})},{id:"value",header:OpenLayers.i18n("label"),dataIndex:"value",editor:new Ext.form.TextField({allowBlank:false})},{id:"definition",header:OpenLayers.i18n("definition"),dataIndex:"definition",editor:new Ext.form.TextField({allowBlank:false})},{id:"west",header:OpenLayers.i18n("xmin"),dataIndex:"west",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"east",header:OpenLayers.i18n("xmax"),dataIndex:"east",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"south",header:OpenLayers.i18n("ymin"),dataIndex:"south",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"north",header:OpenLayers.i18n("ymax"),dataIndex:"north",hidden:true,editor:new Ext.form.TextField({allowBlank:true})}]});this.keywordGrid=new Ext.grid.EditorGridPanel({layout:"fit",autoHeight:true,height:500,border:false,store:this.keywordStore,cm:a,autoExpandColumn:"value",sm:new Ext.grid.CellSelectionModel({listeners:{scope:this,selectionchange:function(b){this.updateKeywordToolbar();
}}}),listeners:{scope:this,afteredit:function(g){var v=this.keywordStore.baseParams.pThesauri;var r=v.split(".")[1];var j=g.record.data.uri.split("#");var d=j[0];var b=j[1];var s=b;var t=this.catalogue.lang;var l=g.record.data.value;var u=g.record.data.definition;var h;if(g.field==="uri"){s=g.originalValue.split("#")[1];}if(r==="place"){var q=g.record.data.south;var f=g.record.data.north;var o=g.record.data.west;var m=g.record.data.east;h="<request><oldid>"+s+"</oldid><newid>"+b+"</newid><lang>"+t+"</lang><ref>"+v+"</ref><definition>"+u+"</definition><namespace>"+d+"#</namespace><north>"+f+"</north><south>"+q+"</south><east>"+m+"</east><prefLab>"+l+"</prefLab><west>"+o+"</west><refType>"+r+"</refType></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptUpdate,failure:function(){Ext.Msg.alert("Fail");},xmlData:h});}else{h="<request><newid>"+b+"</newid><refType>"+r+"</refType><definition>"+u+"</definition><namespace>"+d+"#</namespace><ref>"+v+"</ref><oldid>"+s+"</oldid><lang>"+t+"</lang><prefLab>"+l+"</prefLab></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptUpdate,failure:function(){Ext.Msg.alert("Fail");},xmlData:h});}g.record.commit();}},tbar:{disabled:true,items:[{id:"add_keyword_button",text:OpenLayers.i18n("add"),iconCls:"addIcon",handler:function(){var h=this.keywordGrid.store.recordType;var q="#"+new Date().getTime();var s=this.keywordStore.baseParams.pThesauri;var l=s.split(".")[1];var b=q.split("#")[1];var o=this.catalogue.lang;var r=OpenLayers.i18n("newLabel");var t=OpenLayers.i18n("newDefinition");var f;if(l==="place"){var j=-90;var e=90;var g=-180;var m=180;f="<request><oldid/><newid>"+b+"</newid><lang>"+o+"</lang><ref>"+s+"</ref><definition>"+t+"</definition><namespace>#</namespace><north>"+e+"</north><south>"+j+"</south><east>"+m+"</east><prefLab>"+r+"</prefLab><west>"+g+"</west><refType>"+l+"</refType></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptAdd,failure:function(){Ext.Msg.alert("Fail");},xmlData:f});}else{f="<request><newid>"+b+"</newid><refType>"+l+"</refType><definition>"+t+"</definition><namespace>#</namespace><ref>"+s+"</ref><oldid/><lang>"+o+"</lang><prefLab>"+r+"</prefLab></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptAdd,failure:function(){Ext.Msg.alert("Fail");},xmlData:f});}var d=new h({uri:q,value:r,definition:t,west:-180,east:180,south:-90,north:90});this.keywordGrid.stopEditing();this.keywordGrid.store.insert(0,d);this.keywordGrid.startEditing(0,0);},scope:this},{id:"delete_keyword_button",text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){var e=this.keywordGrid.getSelectionModel().getSelectedCell();var d=this.keywordGrid.store.getAt(e[0]);var g=this.keywordStore.baseParams.pThesauri;var b=d.data.uri.split("#");var h=b[0];var f=b[1];Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptDelete+"?pThesaurus="+g+"&namespace="+h+"%23&id="+f,failure:function(){Ext.Msg.alert("Fail");}});this.keywordGrid.store.removeAt(e[0]);},scope:this},"->",this.getKeyword(),OpenLayers.i18n("maxResults")+" "+OpenLayers.i18n("perThesaurus"),this.getLimitInput()]}});},updateThesaurusToolbar:function(){var a=this.thesaurusGrid.getSelectionModel().getSelected();Ext.getCmp("delete_thesaurus_button").setDisabled(!a);Ext.getCmp("download_thesaurus_button").setDisabled(!a);},updateKeywordToolbar:function(){var e=this.thesaurusGrid.getSelectionModel().getSelected();if(e){var b=e.data.type;var a=b==="local";if(a){var d=this.keywordGrid.getSelectionModel().getSelectedCell();Ext.getCmp("delete_keyword_button").setDisabled(!d);}}},updateKeywordGridAndToolbar:function(){var b=this.thesaurusGrid.getSelectionModel().getSelected();if(b){this.keywordGrid.getTopToolbar().enable();var e=b.data.theme;var a=b.data.type;var f=a==="local";var h=b.data.id;this.keywordStore.removeAll();this.keywordStore.baseParams.pThesauri=h;var g=(e!=="place");this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("east"),g);this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("west"),g);this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("south"),g);this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("north"),g);for(var d=0;d<this.keywordGrid.getColumnModel().getColumnCount();d++){this.keywordGrid.getColumnModel().setEditable(d,f);}Ext.getCmp("delete_keyword_button").setDisabled(!f);Ext.getCmp("add_keyword_button").setDisabled(!f);}else{this.keywordGrid.getTopToolbar().disable();}},getCreateEmptyThesaurusWindow:function(){var a=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateEmptyThesaurusForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){if(this.createEmptyThesaurusForm.getForm().isValid()){this.createEmptyThesaurusForm.getForm().getEl().dom.enctype="application/x-www-form-urlencoded";this.createEmptyThesaurusForm.bodyCfg.enctype="application/x-www-form-urlencoded";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusAdd,success:function(){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(){Ext.Msg.alert("Fail");},xmlData:"<request><fname>"+Ext.getCmp("empty_thesaurusName").getValue()+"</fname><dname>"+Ext.getCmp("empty_themeCmb").getValue()+"</dname><type>"+Ext.getCmp("empty_thesaurusType").getValue()+"</type></request>"});a.hide();}}}]});return a;},getCreateThesaurusFromLocalFileWindow:function(){var a=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateThesaurusFromLocalFileForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){console.log(this.createThesaurusFromLocalFileForm);if(this.createThesaurusFromLocalFileForm.getForm().isValid()){this.createThesaurusFromLocalFileForm.getForm().getEl().dom.enctype="multipart/form-data";this.createThesaurusFromLocalFileForm.bodyCfg.enctype="multipart/form-data";this.createThesaurusFromLocalFileForm.getForm().submit({url:this.catalogue.services.thesaurusUpload,scope:this,success:function(b,d){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(b){Ext.Msg.alert(OpenLayers.i18n("failure"),b.responseText);}});a.hide();}}}]});return a;},getCreateThesaurusFromRemoteFileWindow:function(){var a=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateThesaurusFromRemoteFileForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){if(this.createThesaurusFromRemoteFileForm.getForm().isValid()){this.createThesaurusFromRemoteFileForm.getForm().getEl().dom.enctype="application/x-www-form-urlencoded";this.createThesaurusFromRemoteFileForm.bodyCfg.enctype="application/x-www-form-urlencoded";this.createThesaurusFromRemoteFileForm.getForm().submit({url:this.catalogue.services.thesaurusUpload,scope:this,success:function(b){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(b){Ext.Msg.alert(OpenLayers.i18n("failure"),b.responseText);}});a.hide();}}}]});return a;},getCreateEmptyThesaurusForm:function(){this.createEmptyThesaurusForm=new Ext.form.FormPanel({fileUpload:false,region:"center",autoHeight:true,baseCls:"x-plain",labelWidth:170,split:true,items:[{xtype:"textfield",fieldLabel:OpenLayers.i18n("ThesaurusName"),id:"empty_thesaurusName",name:"fname",anchor:"-15"},this.createTypeCombo("empty_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"empty_thesaurusType",name:"type",value:"local",hidden:true,anchor:"-15"}]});
return this.createEmptyThesaurusForm;},getCreateThesaurusFromLocalFileForm:function(){this.createThesaurusFromLocalFileForm=new Ext.form.FormPanel({fileUpload:true,region:"center",autoHeight:true,baseCls:"x-plain",errorReader:new Ext.data.XmlReader({record:"record"},["Thesaurus"]),labelWidth:170,split:true,items:[{xtype:"fileuploadfield",allowBlank:true,fieldLabel:OpenLayers.i18n("thesaurusFilePath"),id:"local_fname",name:"fname",buttonCfg:{text:OpenLayers.i18n("selectFile")}},this.createTypeCombo("local_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"local_thesaurusType",name:"type",value:"external",hidden:true,anchor:"-15"},{xtype:"textfield",hidden:true,name:"mode",value:"file"}]});return this.createThesaurusFromLocalFileForm;},getCreateThesaurusFromRemoteFileForm:function(){this.createThesaurusFromRemoteFileForm=new Ext.form.FormPanel({fileUpload:false,region:"center",autoHeight:true,baseCls:"x-plain",labelWidth:170,split:true,errorReader:new Ext.data.XmlReader({record:"record"},["Thesaurus"]),listeners:{scope:this,afterrender:function(a){Ext.getCmp("remote_thesaurusURL").setVisible(true);Ext.getCmp("remote_thesaurusCmb").setVisible(false);Ext.getCmp("remote_themeCmb").setVisible(true);}},items:[{xtype:"radiogroup",id:"creationModeRadioGroup",columns:1,submitValue:false,fieldLabel:OpenLayers.i18n("creationMode"),items:[{boxLabel:OpenLayers.i18n("createThesaurusFromURL"),name:"rb-auto",inputValue:1,checked:true},{boxLabel:OpenLayers.i18n("createThesaurusFromRepository"),name:"rb-auto",inputValue:2}],listeners:{scope:this,change:function(b,a){Ext.getCmp("remote_thesaurusURL").setVisible(a.inputValue===1);Ext.getCmp("remote_thesaurusCmb").setVisible(a.inputValue===2);Ext.getCmp("remote_themeCmb").setVisible(a.inputValue!==2);}}},{xtype:"textfield",fieldLabel:OpenLayers.i18n("externalThesaurusURL"),id:"remote_thesaurusURL",name:"url",anchor:"-15"},{fieldLabel:OpenLayers.i18n("thesaurusFromRepository"),id:"remote_thesaurusCmb",anchor:"-15",xtype:"combo",mode:"local",triggerAction:"all",forceSelection:true,editable:false,displayField:"title",valueField:"link",submitValue:false,store:new GeoNetwork.data.ThesaurusFeedStore(),listeners:{scope:this,select:function(a,b,d){Ext.getCmp("remote_thesaurusURL").setValue(b.data.link);Ext.getCmp("remote_themeCmb").setValue(b.data.category);}}},this.createTypeCombo("remote_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"remote_thesaurusType",name:"type",value:"external",hidden:true,anchor:"-15"}]});return this.createThesaurusFromRemoteFileForm;},createTypeCombo:function(a){return new Ext.form.ComboBox({fieldLabel:OpenLayers.i18n("Theme"),id:a,name:"themeCmb",anchor:"-15",mode:"local",value:this.defaultThesaurusType,triggerAction:"all",forceSelection:true,editable:false,displayField:"name",valueField:"value",hiddenName:"dir",store:new Ext.data.JsonStore({fields:["name","value"],data:[{name:"Discipline",value:"discipline"},{name:"Place",value:"place"},{name:"Stratum",value:"stratum"},{name:"Temporal",value:"temporal"},{name:"Theme",value:"theme"}]})});},getKeyword:function(){return new GeoNetwork.form.SearchField({id:"keywordSearchField",width:240,store:this.keywordStore,paramName:"pKeyword"});},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:this.maxResults,width:40,listeners:{scope:this,change:function(a,d,b){this.keywordStore.baseParams.maxResults=d;}}};}});Ext.reg("gn_admin_thesaurusmanagerpanel",GeoNetwork.admin.ThesaurusManagerPanel);Ext.namespace("GeoNetwork");GeoNetwork.OGCServiceQuickRegister=Ext.extend(Ext.menu.Menu,{catalogue:undefined,harvesterStore:undefined,textInfo:undefined,textExample:"eg. http://services.sandre.eaufrance.fr/geo/ouvrage?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities",textValidButton:"Check & Add",urlFieldWidth:250,urlField:undefined,initComponent:function(){this.textInfo=OpenLayers.i18n("enterGetCapURL");var a=[];a.push({text:this.textInfo,canActivate:false});this.urlField={xtype:"textfield",width:this.urlFieldWidth,margins:"0 0 0 30",id:"OGCServiceQuickRegisterUrl",value:"",iconCls:"no-icon"};a.push(this.urlField);a.push({text:this.textExample,canActivate:false});a.push({xtype:"buttongroup",autoWidth:true,border:false,frame:false,columns:2,iconCls:"no-icon",defaults:{xtype:"button",iconAlign:"right"},items:[{text:this.textValidButton,iconCls:"md-mn md-mn-badd",handler:this.getCapabilities}]});Ext.apply(this,{defaultType:"menuitem",items:a});GeoNetwork.OGCServiceQuickRegister.superclass.initComponent.call(this);},getCapabilities:function(){var a=Ext.getCmp("OGCServiceQuickRegisterUrl").getValue();var b=this.ownerCt.ownerCt;OpenLayers.Request.GET({url:a,success:function(f){if(f.responseText.indexOf("Some unexpected")!==-1){Ext.Msg.alert("Failed to check service url.",f.responseText);return;}var g=f.responseXML;if(!g){Ext.Msg.alert("GetCapabilities failed","Null response returned - check proxy or service configuration.");return;}var e=new OpenLayers.Format.WMSCapabilities();var d=e.read(g);b.addHarvester(d.service.title,a,d.version);},failure:function(d){Ext.Msg.alert("Failed to check service url.",d.responseText);}});},addHarvester:function(b,g,d){var a=new Ext.data.Record({id:"",type:"ogcwxs",site_name:b,site_url:g.replace(/&/g,"&amp;"),site_ogctype:"WMS"+d,site_icon:"default.gif",site_account_use:"false",options_every:"90",options_topic:"",options_onerunonly:"true",options_lang:"en",options_createthumbnails:"true",options_uselayer:"true",options_uselayermd:"false"});var e=new GeoNetwork.Templates().getHarvesterTemplate();var f=e.apply(a.data);this.saveHarvester(f);},saveHarvester:function(b){var a=this;var d={url:this.catalogue.services.harvestingAdd,data:b};OpenLayers.Util.applyDefaults(d,{success:function(g){var e=g.responseXML;var f=e.firstChild.getAttribute("id");a.runHarvester(this.catalogue.services.harvestingRun,f);},failure:function(e){Ext.Msg.alert("Failed",e.responseText);}});OpenLayers.Request.POST(d);},runHarvester:function(b,a){var d=this;OpenLayers.Request.GET({url:b+"?id="+a,success:function(e){if(e.responseText.indexOf("nexpected")!==-1){Ext.Msg.alert("Activation or start failed.",e.responseText);return;}Ext.Msg.alert("Successfull registration","Wait a few minutes before having all layers and services registered in the catalogue.");if(d.harvesterStore){d.harvesterStore.reload();}},failure:function(e){Ext.Msg.alert("Registration failed",e.responseText);}});}});Ext.reg("gn_ogcservicequickregister",GeoNetwork.OGCServiceQuickRegister);Ext.namespace("GeoNetwork.map");GeoNetwork.map.ExtentMap=function(){var e=[];var D=[];var F=OpenLayers.Feature.Vector.style["default"];var f=null;var b=null;var H=null;var h=null;var g=null;var G=5;var j=OpenLayers.Class(OpenLayers.Geometry,{id:null,initialize:function(I){this.id=I;},CLASS_NAME:"GeoNetwork.map.ExtentMap.MultiPolygonReference"});var s=GeoNetwork.map.PROJECTION||"EPSG:4326";var v="EPSG:4326";var m=new OpenLayers.Projection(v);var t=null;var q="m";var E=null;function l(L,M){var K=new OpenLayers.Projection(M);var I=(K===m?new OpenLayers.Format.GML.v3():new OpenLayers.Format.GML.v3({externalProjection:m,internalProjection:K}));var J=I.writeNode("feature:_geometry",L.geometry);return OpenLayers.Format.XML.prototype.write.call(I,J.firstChild);}function o(){var I,L={units:q,projection:s,theme:null},K=new OpenLayers.Map(L);if(!h){var J=K.getControlsByClass("OpenLayers.Control.Navigation")[0];J.disableZoomWheel();K.removeControl(K.getControlsByClass("OpenLayers.Control.PanZoom")[0]);}K.addControl(new OpenLayers.Control.MousePosition());for(I=0;I<GeoNetwork.map.BACKGROUND_LAYERS.length;I++){K.addLayer(GeoNetwork.map.BACKGROUND_LAYERS[I].clone());}var M=new OpenLayers.Layer.Vector("VectorLayer",{});K.addLayer(M);M.events.on({sketchstarted:function(){this.destroyFeatures();},scope:M});e[g]=K;D[g]=M;return K;}function u(J,I,K,L){var M=I.split(","),N;for(N=0;N<M.length;++N){Ext.get(M[N]).on("change",function(){B(L,I,K,false);});Ext.get("_"+M[N]).on("change",function(){B(L,I,K,true);
});}}function B(K,O,Q,N){var M=K.getLayersByName("VectorLayer")[0];var J,S,U;var I=O.split(",");S=[];if(N){S[0]=Ext.get("_"+I[0]).getValue();S[1]=Ext.get("_"+I[1]).getValue();S[2]=Ext.get("_"+I[2]).getValue();S[3]=Ext.get("_"+I[3]).getValue();J=OpenLayers.Bounds.fromArray(S);U=J.clone();if(s!==m){U.transform(new OpenLayers.Projection(v),new OpenLayers.Projection(s));}}else{S[0]=Ext.get(I[0]).getValue();S[1]=Ext.get(I[1]).getValue();S[2]=Ext.get(I[2]).getValue();S[3]=Ext.get(I[3]).getValue();J=OpenLayers.Bounds.fromArray(S);U=J.clone();var P=null;var L=document.getElementsByName("proj_"+Q);for(i=0;i<L.length;i++){if(L[i].checked===true){P=L[i].value;}}if(P!==s){U.transform(new OpenLayers.Projection(P),new OpenLayers.Projection(s));}if(P!==v){J.transform(new OpenLayers.Projection(P),new OpenLayers.Projection(v));}Ext.get("_"+I[0]).dom.value=J.left;Ext.get("_"+I[1]).dom.value=J.bottom;Ext.get("_"+I[2]).dom.value=J.right;Ext.get("_"+I[3]).dom.value=J.top;}Ext.get(I[0]).dom.onkeyup();Ext.get(I[1]).dom.onkeyup();Ext.get(I[2]).dom.onkeyup();Ext.get(I[3]).dom.onkeyup();var T=new OpenLayers.Feature.Vector(U.toGeometry());M.destroyFeatures();M.addFeatures(T);r(e[Q],D[Q]);a(O,Q);}function a(J,K){function M(ac,V,P){var ad=ac.split(",");var S=Ext.get("_"+ad[0]).getValue();var Z=Ext.get("_"+ad[1]).getValue();var U=Ext.get("_"+ad[2]).getValue();var Q=Ext.get("_"+ad[3]).getValue();var T=S!==""?S:"0";var W=Z!==""?Z:"0";var ab=U!==""?U:"0";var Y=Q!==""?Q:"0";var aa=OpenLayers.Bounds.fromString(T+","+W+","+ab+","+Y);if(!V.equals(m)){aa.transform(m,V);}if(S!==""){S=aa.left.toFixed(P)+"";}Ext.get(ad[0]).dom.value=S;if(Z!==""){Z=aa.bottom.toFixed(P)+"";}Ext.get(ad[1]).dom.value=Z;if(U!==""){U=aa.right.toFixed(P)+"";}Ext.get(ad[2]).dom.value=U;if(Q!==""){Q=aa.top.toFixed(P)+"";}Ext.get(ad[3]).dom.value=Q;}var O=Ext.DomQuery.select("input.proj"),N;for(N=0;N<O.length;++N){var I=O[N];if(I.id.indexOf(K)!==-1){if(I.checked){M(J,new OpenLayers.Projection(I.value),G);}var L=Ext.get(I.id);L.on("click",function(){M(J,new OpenLayers.Projection(this.value),G);},L.dom);}}}function z(M){var J="WKT";var L,K;if(M!==null){J=M.format||"WKT";L=M.from;K=M.to;}var I=new OpenLayers.Format[J]();if(L!==null&&K!==null){I.internalProjection=L;I.externalProjection=K;}if(!this.vectorLayer.features.length){return null;}var N=this.vectorLayer.features[this.vectorLayer.features.length-1];return I.write(N);}function d(K,Q,J,I){if(K===""){return false;}var O="WKT";var M,N;if(Q!==null){O=Q.format||"WKT";M=Q.from;N=Q.to;}var L=new OpenLayers.Format[O]();if(M!==null&&N!==null){L.externalProjection=M;L.internalProjection=N;}K=K.replace(/\n/g,"");var P=L.read(K);if(!P){return false;}if(P.length){P=P[0];}J.addFeatures(P);if(Q.zoomToFeatures){r(I,J);}return true;}function C(N,P,L){var K=N.getLayersByName("VectorLayer")[0];var M;var O=P.split(",");var I=[];I[0]=Ext.get("_"+O[0]).getValue();I[1]=Ext.get("_"+O[1]).getValue();I[2]=Ext.get("_"+O[2]).getValue();I[3]=Ext.get("_"+O[3]).getValue();M=OpenLayers.Bounds.fromArray(I);M.transform(m,t);Ext.get(O[0]).dom.onkeyup();Ext.get(O[1]).dom.onkeyup();Ext.get(O[2]).dom.onkeyup();Ext.get(O[3]).dom.onkeyup();var J=new OpenLayers.Feature.Vector(M.toGeometry());K.destroyFeatures();K.addFeatures(J);r(N,K);a(P,L);}function w(K){var I=GeoNetwork.data.RegionStore(catalogue.services.getRegions);var J=new Ext.form.ComboBox({store:I,tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label[\''+OpenLayers.Lang.getCode()+"']]}</div></tpl>",typeAhead:true,mode:"local",triggerAction:"all",emptyText:OpenLayers.i18n("selectRegion"),selectOnFocus:true,width:135,listeners:{focus:{fn:function(L){L.getStore().load();}},select:{fn:K}},iconCls:"no-icon"});return J;}function r(K,M){var J=M.getDataExtent();if(J&&!isNaN(J.left)){var I=J.getWidth()/2;var L=J.getHeight()/2;J.left-=I;J.right+=I;J.bottom-=L;J.top+=L;K.zoomToExtent(J);}else{K.zoomToMaxExtent();}}return{init:function(){},initMapDiv:function(){var U,K,V,T,O;t=new OpenLayers.Projection(s);E=t;U=Ext.DomQuery.select(".extentViewer");K=Ext.id;for(V=0;V<U.length;++V){var Q=U[V];f=Q.getAttribute("target_polygon");b=Q.getAttribute("watched_bbox");h=Q.getAttribute("edit")==="true";g=Q.getAttribute("elt_ref");T=Q.getAttribute("desc_ref");H=Q.getAttribute("mode");var L=Q.childNodes;var P=[];for(O=0;O<L.length;O++){if(L[O].nodeType===1){P.push(L[O]);}}L=P;if(L.length>1){continue;}var J;J=Ext.id(Q);var I=o();if(h){var N,S=[];if(H==="bbox"){N=new OpenLayers.Control.DrawFeature(D[g],OpenLayers.Handler.RegularPolygon,{handlerOptions:{irregular:true,sides:4},featureAdded:function(W){var Y=W.geometry.getBounds(),Z;if(t!==m){Z=Y.clone().transform(t,m);}else{Z=Y;}var aa=this.watchedBbox.split(",");Ext.get("_"+aa[0]).dom.value=Z.left;Ext.get("_"+aa[1]).dom.value=Z.bottom;Ext.get("_"+aa[2]).dom.value=Z.right;Ext.get("_"+aa[3]).dom.value=Z.top;a(this.watchedBbox,this.eltRef);}.bind({watchedBbox:b,eltRef:g})});S.push(new GeoExt.Action({map:e[g],control:N,text:OpenLayers.i18n("drawRectangle"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawRectangle"}));S.push(w(function(Y,Z,W){var aa=this.watchedBbox.split(",");Ext.get("_"+aa[0]).dom.value=Z.data.west;Ext.get("_"+aa[1]).dom.value=Z.data.south;Ext.get("_"+aa[2]).dom.value=Z.data.east;Ext.get("_"+aa[3]).dom.value=Z.data.north;C(e[g],b,g,true);if(Ext.get("_"+this.descRef)!==null){Ext.get("_"+this.descRef).dom.value=Z.data.label[OpenLayers.Lang.getCode()];}}.bind({extentMap:this,map:e[g],watchedBbox:b,eltRef:g,descRef:T})));}else{if(H==="polygon"){N=new OpenLayers.Control.DrawFeature(D[g],OpenLayers.Handler.Polygon,{featureAdded:function(W){document.getElementById("_X"+this).value=l(W,s);}.bind(f)});S.push(new GeoExt.Action({map:e[g],control:N,text:OpenLayers.i18n("drawPolygon"),tooltip:OpenLayers.i18n("drawPolygonTT"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawPolygon"}));N=new OpenLayers.Control.DrawFeature(D[g],OpenLayers.Handler.RegularPolygon,{handlerOptions:{irregular:true,sides:60},featureAdded:function(W){document.getElementById("_X"+this).value=l(W,s);}.bind(f)});S.push(new GeoExt.Action({map:e[g],control:N,text:OpenLayers.i18n("drawCircle"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawCircle"}));}}S.push({text:OpenLayers.i18n("clear"),iconCls:"clearPolygon",handler:function(){this.vectorLayer.destroyFeatures();var W=document.getElementById("_X"+this.targetPolygon);if(W!==null){W.value="";}if(this.targetBbox!==""){var Y=this.targetBbox.split(",");Ext.get(Y[0]).dom.value="";Ext.get(Y[1]).dom.value="";Ext.get(Y[2]).dom.value="";Ext.get(Y[3]).dom.value="";Ext.get("_"+Y[0]).dom.value="";Ext.get("_"+Y[1]).dom.value="";Ext.get("_"+Y[2]).dom.value="";Ext.get("_"+Y[3]).dom.value="";$(Y[0]).onkeyup();$(Y[1]).onkeyup();$(Y[2]).onkeyup();$(Y[3]).onkeyup();}},scope:{vectorLayer:D[g],targetPolygon:f,targetBbox:b,eltRef:g}});}var M=new GeoExt.MapPanel({renderTo:J,height:300,width:400,map:e[g],tbar:(h?S:null)});if(L.length>0){d(L[0].innerHTML,{format:"WKT",zoomToFeatures:true,from:m,to:t},D[g],e[g]);}if(b!==""){a(b,g);u(D[g],b,g,e[g]);}}}};};GeoNetwork.map.ExtentMap.prev_geometry=OpenLayers.Format.GML.Base.prototype.writers.feature._geometry;OpenLayers.Format.GML.Base.prototype.writers.feature._geometry=function(a){if(a.CLASS_NAME==="GeoNetwork.map.ExtentMap.MultiPolygonReference"){var d=this.createElementNS(this.namespaces.gml,"gml:MultiPolygon");var b=this.createElementNS(this.namespaces.gml,"gml:MultiPolygon");b.setAttribute("gml:id",a.id);d.appendChild(b);return d;}else{return GeoNetwork.map.ExtentMap.prev_geometry.apply(this,arguments);}};if(!window.GeoNetwork){window.GeoNetwork={};}if(!GeoNetwork.Control){GeoNetwork.Control={};}GeoNetwork.Control.ZoomWheel=OpenLayers.Class(OpenLayers.Control,{wheelChange:OpenLayers.Control.Navigation.prototype.wheelChange,draw:function(){this.handler=new OpenLayers.Handler.MouseWheel(this,{up:OpenLayers.Control.Navigation.prototype.wheelUp,down:OpenLayers.Control.Navigation.prototype.wheelDown});this.activate();},CLASS_NAME:"GeoNetwork.Control.ZoomWheel"});
if(!window.GeoNetwork){window.GeoNetwork={};}if(!GeoNetwork.Control){GeoNetwork.Control={};}GeoNetwork.Control.ExtentBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,wktelement:null,minxelement:null,minyelement:null,maxxelement:null,maxyelement:null,EVENT_TYPES:["finishBox"],initialize:function(a){this.EVENT_TYPES=GeoNetwork.Control.ExtentBox.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.RegularPolygon(this,{create:this.startBox,done:this.endBox},{irregular:true});},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);},startBox:function(){this.getOrCreateLayer();this.vectorLayer.destroyFeatures();},endBox:function(){var a=this.handler.feature.geometry.getBounds();this.updateFields(a);this.events.triggerEvent("finishBox",null);},updateFields:function(d){var j=new OpenLayers.Feature.Vector(d.toGeometry(),null,this.vectorLayerStyle);this.vectorLayer.addFeatures([j]);this.vectorLayer.refresh();var a=this.map.getProjectionObject();var g=new OpenLayers.Projection("WGS84");var f=new OpenLayers.LonLat(d.left,d.bottom).transform(a,g);var h=new OpenLayers.LonLat(d.right,d.top).transform(a,g);var e=f.lon.toFixed(4),b=f.lat.toFixed(4),m=h.lon.toFixed(4),l=h.lat.toFixed(4);if(this.wktelement){this.wktelement.setValue("POLYGON(("+e+" "+b+","+e+" "+l+","+m+" "+l+","+m+" "+b+","+e+" "+b+"))");}else{if(this.minxelement){this.minxelement.dom.value=e;}if(this.maxxelement){this.maxxelement.dom.value=m;}if(this.minyelement){this.minyelement.dom.value=b;}if(this.maxyelement){this.maxyelement.dom.value=l;}}},updateMap:function(){if((!this.minxelement)||(!this.maxxelement)||(!this.minyelement)||(!this.maxyelement)){return;}this.getOrCreateLayer();var e=this.map.getProjectionObject();var h=new OpenLayers.Projection("WGS84");var d=new OpenLayers.LonLat(this.map.getExtent().left,this.map.getExtent().bottom).transform(e,h);var l=new OpenLayers.LonLat(this.map.getExtent().right,this.map.getExtent().top).transform(e,h);var j=parseFloat(this.minxelement.dom.value);if(isNaN(j)){this.minxelement.dom.value=d.lon;}j=parseFloat(this.maxxelement.dom.value);if(isNaN(j)){this.maxxelement.dom.value=l.lon;}j=parseFloat(this.minyelement.dom.value);if(isNaN(j)){this.minyelement.dom.value=d.lat;}j=parseFloat(this.maxyelement.dom.value);if(isNaN(j)){this.maxyelement.dom.value=l.lat;}this.minxelement.dom.value=parseFloat(this.minxelement.dom.value).toFixed(4);this.maxxelement.dom.value=parseFloat(this.maxxelement.dom.value).toFixed(4);this.minyelement.dom.value=parseFloat(this.minyelement.dom.value).toFixed(4);this.maxyelement.dom.value=parseFloat(this.maxyelement.dom.value).toFixed(4);this.vectorLayer.destroyFeatures();var f=new OpenLayers.LonLat(this.minxelement.dom.value,this.minyelement.dom.value).transform(h,e);var a=new OpenLayers.LonLat(this.maxxelement.dom.value,this.maxyelement.dom.value).transform(h,e);var g=new OpenLayers.Bounds();g.extend(f);g.extend(a);var b=new OpenLayers.Feature.Vector(g.toGeometry(),null,this.vectorLayerStyle);this.vectorLayer.addFeatures([b]);this.vectorLayer.refresh();},getOrCreateLayer:function(){if(!this.vectorLayer){this.vectorLayer=this.vectorLayer||new OpenLayers.Layer.Vector("ExtentBox",{style:this.vectorLayerStyle});this.map.addLayer(this.vectorLayer);}this.map.setLayerIndex(this.vectorLayer,this.map.getNumLayers());return this.vectorLayer;},clear:function(){if(this.vectorLayer){this.vectorLayer.destroyFeatures();}},zoomTo:function(){var d=this.map.getProjectionObject();var f=new OpenLayers.Projection("WGS84");var b=new OpenLayers.LonLat(this.minxelement.dom.value,this.minyelement.dom.value).transform(f,d);var e=new OpenLayers.LonLat(this.maxxelement.dom.value,this.maxyelement.dom.value).transform(f,d);var a=new OpenLayers.Bounds();a.extend(b);a.extend(e);this.map.zoomToExtent(a);},CLASS_NAME:"GeoNetwork.Control.ExtentBox"});Ext.namespace("GeoNetwork","GeoNetwork.OGCUtil");GeoNetwork.OGCUtil.getProtocolVersion=function(){return"1.3.0";};GeoNetwork.OGCUtil.getLanguage=function(){return GeoNetwork.Util.getISO3LangCode(catalogue.lang);};GeoNetwork.OGCUtil.ensureProperUrlEnd=function(e){if(e.indexOf("?")==-1){e+="?";}else{var d=e.substring(e.length-1);if(d!="&"&&d!="?"){e+="&";}}return e;};GeoNetwork.OGCUtil.reprojectMap=function(z,w,t){if(z.projection!=w.projCode){z.baseLayer.options.scales=z.scales;var q=z.getProjectionObject();z.projection=w.projCode;if(w.getUnits()===null){z.units="degrees";}else{z.units=w.getUnits();}var u=null;if(z.getControlsByClass("GeoNetwork.Control.CursorPos").length>0){u=z.getControlsByClass("GeoNetwork.Control.CursorPos")[0];}if(z.units=="m"&&u!==null){u.numdigits=0;}else{if(z.units=="degrees"&&u!==null){u.numdigits=4;}}z.maxExtent=z.maxExtent.transform(q,w);z.baseLayer.extent=z.maxExtent;var B=z.getExtent().transform(q,w);for(var s=0;s<z.layers.length;s++){var r=z.layers[s];r.units=z.units;r.projection=w;r.maxExtent=z.maxExtent;if(r.isBaseLayer){r.initResolutions();}else{r.resolutions=z.baseLayer.resolutions;r.minResolution=z.baseLayer.minResolution;r.maxResolution=z.baseLayer.maxResolution;}if(r instanceof OpenLayers.Layer.Vector){for(var v=0;v<r.features.length;v++){var j=r.features[v];if(j.geometry.projection!=z.projection){j.geometry.transform(new OpenLayers.Projection(j.geometry.projection),z.getProjectionObject());j.geometry.projection=z.projection;}}}}if(!t){z.zoomToExtent(B);}}};GeoNetwork.OGCUtil.layerExistsInMap=function(t,o){var s=false;for(var u=0,m=o.layers.length;u<m;u++){if(o.layers){var e=o.layers[u];if(e.params){try{var q=e.params.LAYERS.split(",");if((q.indexOf(t.params.LAYERS)!=-1)&&e.params.SERVICE==t.params.SERVICE&&e.url==t.url){s=e;break;}}catch(r){}}}}return s;};Ext.namespace("GeoNetwork","GeoNetwork.CatalogueInterface");GeoNetwork.CatalogueInterface=function(){var o;var l;var q;var r=function(a){o=a;};var m=function(g,v,d){var h=null;for(var f=0,a=v.length;f<a;++f){var e=v[f];try{var b=e.name.split(",");if(b.indexOf(d.params.LAYERS)!=-1){h=e;break;}}catch(w){}if(typeof(e.nestedLayers)!="undefined"){h=m(g,e.nestedLayers,d);if(h!==null){break;}}}return h;};var j=function(G){l.hide();var g=new OpenLayers.Format.WMSCapabilities();var H=g.read(G.responseXML||G.responseText);if(H.capability){var a=H.service.accessContraints;if((a)&&(a.toLowerCase()!="none")&&(a!="-")){var f=new GeoNetwork.DisclaimerWindow({disclaimer:a});f.show();f=null;}if(o){for(var E=0,C=q.length;E<C;E++){var e=q[E][0];var h=q[E][1];var D=q[E][2];var b=q[E][3];var F=new OpenLayers.Layer.WMS(e,h,{layers:D,format:"image/png",transparent:"TRUE",version:H.version,language:GeoNetwork.OGCUtil.getLanguage()},{queryable:true,singleTile:true,ratio:1,buffer:0,transitionEffect:"resize",metadata_id:b});if(!GeoNetwork.OGCUtil.layerExistsInMap(F,o)){F.events.on({loadstart:function(){this.isLoading=true;}});F.events.on({loadend:function(){this.isLoading=false;}});var d=m(H,H.capability.layers,F);if(d){F.queryable=d.queryable;F.name=d.title||F.name;F.llbbox=d.llbbox;F.styles=d.styles;F.dimensions=d.dimensions;}o.addLayer(F);}}}}};var s=function(a){l.hide();Ext.MessageBox.alert(OpenLayers.i18n("loadLayer.error.title"),OpenLayers.i18n("loadLayer.error.message"));};return{init:function(a){r(a);},addLayers:function(h){if(h.length===0){return;}var b=h[0][1];if(h[0][2]===""){GeoNetwork.WindowManager.showWindow("addwms");var d=Ext.getCmp(GeoNetwork.WindowManager.getWindow("addwms").browserPanel.id);d.setURL(b);return;}l=new Ext.LoadMask(o.div,{msg:OpenLayers.Lang.translate("loadLayer.loadingMessage")});l.show();q=h;var e={service:"WMS",request:"GetCapabilities",version:GeoNetwork.OGCUtil.getProtocolVersion(),language:GeoNetwork.OGCUtil.getLanguage()};var f=OpenLayers.Util.getParameterString(e);var g=(b.indexOf("?")>-1)?"&":"?";b+=g+f;var a=Ext.Ajax.request({url:b,method:"GET",success:j,failure:s,timeout:10000});}};};GeoNetwork.CatalogueInterface=new GeoNetwork.CatalogueInterface();Ext.namespace("GeoNetwork","GeoNetwork.WMC");
GeoNetwork.WMC=function(){return{loadWmc:function(l,j){try{var m=l.layers;for(var h=m.length-1;h>0;h--){if(!m[h].isBaseLayer){l.removeLayer(m[h]);}}Ext.getCmp("toctree").getSelectionModel().clearSelections();var o=new OpenLayers.Format.WMC({layerOptions:{buffer:0}});l=o.read(j,{map:l});}catch(q){Ext.MessageBox.alert(OpenLayers.i18n("selectWMCFile.errorLoadingWMC"));}},mergeWmc:function(h,g){try{var j=new OpenLayers.Format.WMC({layerOptions:{buffer:0}});h=j.read(g,{map:h});}catch(f){Ext.MessageBox.alert(OpenLayers.i18n("selectWMCFile.errorLoadingWMC"));}},saveContext:function(d){var e=new OpenLayers.Format.WMC();OpenLayers.Request.POST({url:"../../wmc/create.wmc",data:e.write(d),success:this.onSaveContextSuccess,failure:this.onSaveContextFailure});},onSaveContextSuccess:function(f){var e=f.responseText;var g=Ext.decode(e);if(g.success){window.location=g.url;}else{this.onSaveContextFailure();}},onSaveContextFailure:function(e,d){Ext.MessageBox.show({icon:Ext.MessageBox.ERROR,title:OpenLayers.i18n("saveWMCFile.windowTitle"),msg:OpenLayers.i18n("saveWMCFile.errorSaveWMC"),buttons:Ext.MessageBox.OK});}};};GeoNetwork.WMCManager=new GeoNetwork.WMC();Ext.namespace("GeoNetwork","GeoNetwork.tree");GeoNetwork.tree.WMSListGenerator=function(b){Ext.apply(this,b);if(this.node&&this.wmsStore){this.createWMSList();}};GeoNetwork.tree.WMSListGenerator.prototype={node:null,wmsStore:null,click:null,scope:null,createWMSList:function(){this.wmsStore.each(this.appendRecord,this);},appendRecord:function(e){var d=new Ext.tree.TreeNode({url:e.get("url"),text:e.get("title"),cls:"folder",leaf:false});d.appendChild(new Ext.tree.TreeNode({text:"",dummy:true}));d.addListener("beforeexpand",this.addNodesFromWMS,this);this.node.appendChild(d);},replaceNode:function(b){this.currentNode.parentNode.replaceChild(b,this.currentNode);b.ui.afterLoad();b.expand();},addNodesFromWMS:function(d){if(d.firstChild&&d.firstChild.attributes.dummy){d.removeChild(d.firstChild);d.ui.beforeLoad();this.scope.currentNode=d;var e=new GeoNetwork.tree.WMSTreeGenerator({click:this.click,callback:this.replaceNode,scope:this.scope});e.loadWMS(d.attributes.url);}}};Ext.namespace("GeoNetwork","GeoNetwork.tree");GeoNetwork.tree.WMSTreeGenerator=function(b){Ext.apply(this,b);};GeoNetwork.tree.WMSTreeGenerator.prototype={layerParams:{format:"image/png",transparent:"TRUE"},layerOptions:{ratio:1,singleTile:true,isBaseLayer:false},click:null,callback:null,scope:null,loadWMS:function(q){var s=(q.indexOf("version=")>-1);var o=q.toLowerCase();var s=(o.indexOf("version=")>-1);var t=(o.indexOf("service=wms")>-1);var v=(o.indexOf("request=getcapabilities")>-1);var u=(o.indexOf("language=")>-1);var z={};if(!s){z.version=GeoNetwork.OGCUtil.getProtocolVersion();}if(!t){z.service="WMS";}if(!v){z.request="GetCapabilities";}if(!u){z.language=GeoNetwork.OGCUtil.getLanguage();}var B=OpenLayers.Util.getParameterString(z);var w=(q.indexOf("?")>-1)?"&":"?";q+=w+B;var r=Ext.Ajax.request({url:q,method:"GET",failure:this.processFailure,success:this.processSuccess,disableCaching:false,scope:this});},processSuccess:function(h){if(!this.parser){this.parser=new OpenLayers.Format.WMSCapabilities();}var l=this.parser.read(h.responseXML||h.responseText);this.layerParams.VERSION=l.version;var m;if(l.capability){for(var o=0,j=l.capability.nestedLayers.length;o<j;++o){var q=l.capability.nestedLayers[o];m=this.addLayer(q,l.capability.request.getmap.href,null);this.processLayer(q,l.capability.request.getmap.href,m);}}Ext.callback(this.callback,this.scope,[m,l]);},processFailure:function(b){Ext.callback(this.callback,this.scope,null);},createWMSLayer:function(d,e){return new OpenLayers.Layer.WMS(d.title,e,OpenLayers.Util.extend({layers:d.name,language:GeoNetwork.OGCUtil.getLanguage()},this.layerParams),OpenLayers.Util.extend({minScale:d.minScale,queryable:d.queryable,maxScale:d.maxScale,metadataURL:d.metadataURL,dimensions:d.dimensions,styles:d.styles,llbbox:d.llbbox},this.layerOptions));},addLayer:function(q,h,j){var l=null;if(q.name){l=this.createWMSLayer(q,h);if(q.styles&&q.styles.length>0){var o=q.styles[0];if(o.legend&&o.legend.href){l.legendURL=o.legend.href;}}}var m=new Ext.tree.TreeNode({wmsLayer:l,text:q.title});m.addListener("click",this.click,this.scope);if(j){j.appendChild(m);}return m;},processLayer:function(e,f,g){Ext.each(e.nestedLayers,function(a){var b=this.addLayer(a,f,g);if(a.nestedLayers){this.processLayer(a,f,b);}},this);}};Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.BrowserPanel=function(b){Ext.apply(this,b);GeoNetwork.wms.BrowserPanel.superclass.constructor.call(this);};GeoNetwork.wms.BrowserPanel.ADDWMS=0;GeoNetwork.wms.BrowserPanel.WMSLIST=1;Ext.extend(GeoNetwork.wms.BrowserPanel,Ext.Panel,{previewPanel:null,treePanel:null,map:null,previewCenterPoint:null,mode:GeoNetwork.wms.BrowserPanel.WMSLIST,wmsStore:null,urlField:null,searchResultsGrid:null,searchField:null,parseBt:null,typeRadio:null,defaultConfig:{border:false,frame:false,layout:"border"},initComponent:function(l){Ext.apply(this,l);Ext.applyIf(this,this.defaultConfig);GeoNetwork.wms.BrowserPanel.superclass.initComponent.call(this);this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,previewCenterPoint:this.previewCenterPoint});var m;this.treePanel=new Ext.tree.TreePanel({rootVisible:false,autoScroll:true,autoHeight:true});m=new Ext.tree.TreeNode({text:"",draggable:false,cls:"folder"});this.treePanel.setRootNode(m);var g=[];if(this.mode==GeoNetwork.wms.BrowserPanel.ADDWMS){this.createForm();g.push(this.form);}g.push(this.treePanel);var h={autoScroll:true,region:"center",items:g,split:true,width:300,minWidth:300,border:false};var j={region:"east",border:false,items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};this.add(h);this.add(j);if(this.mode==GeoNetwork.wms.BrowserPanel.WMSLIST){this.treeGen=new GeoNetwork.tree.WMSListGenerator({click:this.nodeClick,scope:this,node:this.treePanel.getRootNode(),wmsStore:this.wmsStore});}else{if(this.mode==GeoNetwork.wms.BrowserPanel.ADDWMS){new GeoNetwork.tree.WMSListGenerator({click:this.nodeClick,scope:this,node:this.treePanel.getRootNode(),wmsStore:this.wmsStore});this.treeGen=new GeoNetwork.tree.WMSTreeGenerator({click:this.nodeClick,callback:this.showTree,scope:this});}}this.addButton({text:OpenLayers.i18n("WMSBrowserAddButton"),iconCls:"addLayerIcon",width:150},this.addLayerToMap,this);this.doLayout();},createForm:function(){this.form=new Ext.form.FormPanel({labelWidth:15,id:"serviceSearchForm"});this.typeRadio=new Ext.form.RadioGroup({items:[{name:"addWmsType",fieldLabel:"Search WMS",labelSeparator:"",inputValue:0,checked:true},{name:"addWmsType",labelSeparator:"",fieldLabel:" or add by URL",inputValue:1}],listeners:{change:function(d,a){var b=(a.getGroupValue()=="0");this.urlField.setVisible(!b);this.searchField.setVisible(b);this.searchResultsGrid.setVisible(b);},scope:this}});this.form.add(this.typeRadio);this.urlField=new Ext.form.TextField({name:"wmsurl",hideLabel:true,hidden:true,emptyText:"WMS server URL ...",width:250,autoHeight:true});this.form.add(this.urlField);var h=GeoNetwork.data.MetadataResultsStore();var g=GeoNetwork.data.MetadataSummaryStore();this.searchField=new GeoNetwork.form.SearchField({name:"E_any",hideLabel:true,width:250,minWidth:250,store:h,triggerAction:function(a){a.search("serviceSearchForm",null,null,1,true,h,g);},scope:catalogue});var j=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:""});this.searchResultsGrid=new Ext.grid.GridPanel({layout:"fit",height:80,border:false,store:h,columns:[j,{id:"title",header:"Title",dataIndex:"title"}],sm:j,autoExpandColumn:"title",listeners:{rowclick:function(e,a,b){var d=e.getStore().getAt(a).data;this.setValue(d.links[0].href);},scope:this.urlField}});var f=new Ext.form.TextField({inputType:"hidden",name:"E_serviceType",value:"OGC:WMS"});this.form.add(this.searchField,f,this.searchResultsGrid);this.parseBt=new Ext.Button({id:"parse",text:OpenLayers.i18n("WMSBrowserConnectButton"),iconCls:"connectIcon",width:150});
this.form.addButton(this.parseBt,this.getWMSCaps,this);},showTree:function(m,g){if(!m){Ext.MessageBox.alert(OpenLayers.i18n("errorTitle"),OpenLayers.i18n("WMSBrowserConnectError"));this.body.dom.style.cursor="default";}var l=g.service.accessContraints;if((l)&&(l.toLowerCase()!="none")&&(l!="-")){var j=new GeoNetwork.DisclaimerWindow({disclaimer:l});j.show();j=null;}var h=this.treePanel.getRootNode();if(m){this.treePanel.getRootNode().appendChild(m);}this.treePanel.show();this.body.dom.style.cursor="default";},getWMSCaps:function(d){var e=this.urlField.getValue();e=e.replace(/^\s+|\s+$/g,"");if(e!=""){this.body.dom.style.cursor="wait";this.treeGen.loadWMS(e);}},setURL:function(b){var b=this.urlField.setValue(b);this.typeRadio.setValue(1);this.getWMSCaps(this.parseBt);},nodeClick:function(b){this.previewPanel.showPreview(b.attributes.wmsLayer);},addLayerToMap:function(){if(this.previewPanel.currentLayer){var b=GeoNetwork.OGCUtil.layerExistsInMap(this.previewPanel.currentLayer,this.map);if(!b){this.previewPanel.currentLayer.events.on({loadstart:function(){this.isLoading=true;}});this.previewPanel.currentLayer.events.on({loadend:function(){this.isLoading=false;}});this.map.addLayers([this.previewPanel.currentLayer]);}else{Ext.MessageBox.alert(OpenLayers.i18n("infoTitle"),OpenLayers.i18n("WMSBrowserDuplicateMsg"));}}}});Ext.reg("gn_wmsbrowserpanel",GeoNetwork.wms.BrowserPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.LayerInfoPanel=function(b){Ext.apply(this,b);GeoNetwork.wms.LayerInfoPanel.superclass.constructor.call(this);};Ext.extend(GeoNetwork.wms.LayerInfoPanel,Ext.Panel,{previewPanel:null,map:null,previewCenterPoint:null,onlineresource:null,layer:null,initComponent:function(){GeoNetwork.wms.LayerInfoPanel.superclass.initComponent.call(this);this.layout="border";this.border=false;this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,previewCenterPoint:this.previewCenterPoint});this.store=new Ext.data.SimpleStore({reader:new Ext.data.ArrayReader({},[{name:"title",type:"string"},{name:"field",type:"string"}]),fields:["title","field"]});this.gridPanel=new Ext.grid.GridPanel({title:"",store:this.store,autoScroll:true,hideHeaders:false,columns:[]});this.layerInfo=new GeoNetwork.wms.WMSLayerInfo({callback:this._showLayerInfo,scope:this});var e={region:"center",layout:"fit",items:[this.gridPanel],split:true,width:300,minWidth:300};var d={region:"east",items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};this.add(e);this.add(d);this.doLayout();},showLayerInfo:function(){this.previewPanel.showPreview(this.layer);this.layerInfo.loadWMS(this.onlineresource,this.layer);},_showLayerInfo:function(e){if(!e){Ext.MessageBox.alert(OpenLayers.i18n("errorTitle"),OpenLayers.i18n("WMSBrowserConnectError"));this.body.dom.style.cursor="default";}else{var d=[[OpenLayers.i18n("layerInfoPanel.titleField"),e.title||e.name],[OpenLayers.i18n("layerInfoPanel.descriptionField"),e.description],[OpenLayers.i18n("layerInfoPanel.queryableField"),e.queryable]];this.gridPanel.reconfigure(this.store,new Ext.grid.ColumnModel([{header:"Field",dataIndex:"title",sortable:true},{id:"value",header:"Value",dataIndex:"field",sortable:true}]));this.gridPanel.autoExpandColumn="value";this.gridPanel.getStore().loadData(d);}this.body.dom.style.cursor="default";}});Ext.reg("gn_infolayerpanel",GeoNetwork.wms.LayerInfoPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.LayerStylesPanel=function(b){Ext.apply(this,b);GeoNetwork.wms.LayerStylesPanel.superclass.constructor.call(this);};Ext.extend(GeoNetwork.wms.LayerStylesPanel,Ext.Panel,{previewPanel:null,map:null,layer:null,selectedStyle:null,initComponent:function(){GeoNetwork.wms.LayerStylesPanel.superclass.initComponent.call(this);this.layout="border";this.border=false;this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,title:OpenLayers.i18n("layerStylesPreviewTitle")});this.store=new Ext.data.SimpleStore({reader:new Ext.data.ArrayReader({},[{name:"name",type:"string"},{name:"title",type:"string"},{name:"legendUrl",type:"string"}]),fields:["name","title","legendUrl"]});this.gridPanel=new Ext.grid.GridPanel({title:"",border:false,autoScroll:true,store:this.store,hideHeaders:false,columns:[{header:"Style",width:120,dataIndex:"name",sortable:false},{id:"description",header:"Description",width:180,dataIndex:"title",sortable:false}],autoExpandColumn:"description"});this.gridPanel.on("rowclick",this._selectStyle,this);var e={region:"center",layout:"fit",items:[this.gridPanel],split:true,width:300,minWidth:300};var d={region:"east",items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};this.add(e);this.add(d);this.doLayout();},showLayerStyles:function(m){var j=[];for(var g=0;g<m.styles.length;g++){var h="";if(m.styles[g].legend){h=m.styles[g].legend.href;}var l=[m.styles[g].name,m.styles[g].title,h];j.push(l);}this.gridPanel.getStore().loadData(j);},_selectStyle:function(e,l,q){var o=e.store.getAt(l);this.selectedStyle=o.get("name");e.getView().focusEl.focus();var j=o.get("legendUrl");if(j==""){return;}j=unescape(j);this.selectedStyleLegendUrl=j;var m=o.get("legendUrl")+"&style="+this.selectedStyle;this.previewPanel.showPreviewLegend(unescape(m));}});Ext.reg("gn_layerstylespanel",GeoNetwork.wms.LayerStylesPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.PreviewPanel=function(b){Ext.apply(this,b);GeoNetwork.wms.PreviewPanel.superclass.constructor.call(this);};Ext.extend(GeoNetwork.wms.PreviewPanel,Ext.Panel,{title:OpenLayers.i18n("WMSBrowserPreviewTitle"),baseCls:"x-plain",cls:"x-panel-title-variant1",imgCls:"preview-image",width:250,height:250,currentLayer:null,initComponent:function(){GeoNetwork.wms.PreviewPanel.superclass.initComponent.call(this);this.image=new Ext.BoxComponent({autoEl:{tag:"img","class":this.imgCls,src:Ext.BLANK_IMAGE_URL,width:this.width,height:this.height}});this.add(this.image);},hideMask:function(){if(this.mask){this.mask.hide();}},showMask:function(){if(!this.mask){this.mask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("WMSBrowserPreviewWaitMsg")});Ext.EventManager.addListener(this.image.getEl(),"load",this.hideMask,this);Ext.EventManager.addListener(this.image.getEl(),"error",this.hideMask,this);}this.mask.show();},calculateBBOX:function(v){var r;var q=(parseFloat(v.params.VERSION)>=1.3);if(v.llbbox){if(this.map.getProjection()!=="EPSG:4326"){var C=OpenLayers.Bounds.fromArray(v.llbbox);C=C.transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());r=C.toArray(q);}else{var C=OpenLayers.Bounds.fromArray(v.llbbox);r=C.toArray(q);}}else{r=this.map.maxExtent.toArray(q);}var D=OpenLayers.Bounds.fromArray(r).getCenterLonLat();if(v.minScale>0){var B;if(v.maxScale>0){B=(parseFloat(v.maxScale)+parseFloat(v.minScale))/2;}else{B=0.9*parseFloat(v.minScale);}var u=OpenLayers.Util.getResolutionFromScale(B,this.map.units);var w=Math.round(u*this.width);var z=Math.round(u*this.height);var s=D.lon;var t=D.lat;if(w!==0&&z!==0){if(q){r=[t-0.5*z,s-0.5*w,t+0.5*z,s+0.5*w];}else{r=[s-0.5*w,t-0.5*z,s+0.5*w,t+0.5*z];}}}return r.join(",");},showPreview:function(e){if(!e){return;}this.showMask();var g=e.map;if(g===null){e.map=this.map;}var f=e.getFullRequestString({BBOX:this.calculateBBOX(e),WIDTH:this.width,HEIGHT:this.height});if(g===null){e.map=g;}this.currentLayer=e;this.image.getEl().dom.src=f;},showPreviewLegend:function(b){this.remove(this.image);this.image=null;this.image=new Ext.BoxComponent({autoEl:{tag:"img","class":this.imgCls,src:b}});this.add(this.image);this.doLayout();}});Ext.reg("gn_wmspreview",GeoNetwork.wms.PreviewPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.WMSLayerInfo=function(b){Ext.apply(this,b);};GeoNetwork.wms.WMSLayerInfo.prototype={layerParams:{format:"image/png",transparent:"TRUE"},layerOptions:{ratio:1,singleTile:true,isBaseLayer:false},callback:null,scope:null,layer:null,loadWMS:function(r,w){this.layer=w;var q=r.toLowerCase();
var t=(q.indexOf("version=")>-1);var u=(q.indexOf("service=wms")>-1);var z=(q.indexOf("request=getcapabilities")>-1);var v=(q.indexOf("language=")>-1);var C={};if(!t){C.version=GeoNetwork.OGCUtil.getProtocolVersion();}if(!u){C.service="WMS";}if(!z){C.request="GetCapabilities";}if(!v){C.language=GeoNetwork.OGCUtil.getLanguage();}var D=OpenLayers.Util.getParameterString(C);var B=(r.indexOf("?")>-1)?"&":"?";r+=B+D;var s=Ext.Ajax.request({url:r,method:"GET",failure:this.processFailure,success:this.processSuccess,timeout:10000,scope:this});},processSuccess:function(f){if(!this.parser){this.parser=new OpenLayers.Format.WMSCapabilities();}var g=this.parser.read(f.responseXML||f.responseText);var e;if(g.capability){e=this.processLayers(g,g.capability.nestedLayers);}Ext.callback(this.callback,this.scope,[e,this.layer]);},processFailure:function(b){Ext.callback(this.callback,this.scope,[null,this.layer]);},createWMSLayer:function(d,e){return new OpenLayers.Layer.WMS(d.title,e,OpenLayers.Util.extend({layers:d.name},this.layerParams),OpenLayers.Util.extend({minScale:d.minScale,queryable:d.queryable,maxScale:d.maxScale,description:d.abstrack,metadataURL:d.metadataURL,llbbox:d.llbbox},this.layerOptions));},processLayers:function(r,o){var t=null;for(var s=0,m=o.length;s<m;++s){var e=o[s];try{var u=e.name.split(",");if(u.indexOf(this.layer.params.LAYERS)!=-1){t=this.createWMSLayer(e,r.service.href);break;}}catch(q){}if(typeof(e.nestedLayers)!="undefined"){t=this.processLayers(r,e.nestedLayers);if(t!=null){break;}}}return t;}};Ext.namespace("GeoNetwork");GeoNetwork.FeatureInfoPanel=function(b){Ext.apply(this,b);GeoNetwork.FeatureInfoPanel.superclass.constructor.call(this);};Ext.extend(GeoNetwork.FeatureInfoPanel,Ext.Panel,{features:null,treePanel:null,infoPanel:null,initComponent:function(){GeoNetwork.FeatureInfoPanel.superclass.initComponent.call(this);this.layout="border";this.treePanel=new Ext.tree.TreePanel({rootVisible:true,autoScroll:true});var e=new Ext.tree.TreeNode({text:OpenLayers.i18n("featureInfoTitle"),draggable:false,expanded:true,cls:"folder"});this.treePanel.setRootNode(e);var f={region:"center",items:[this.treePanel],split:true,minWidth:100};this.infoPanel=new Ext.Panel();this.infoPanel.on("render",function(){if(this.features){this.showFeatures(this.features);}},this);var g={region:"east",items:[this.infoPanel],split:true,plain:true,cls:"popup-variant1",width:400,autoScroll:true};this.add(f);this.add(g);this.doLayout();},setMap:function(b){this.map=b;},featureToHTML:function(h){var f='<table class="olFeatureInfoTable" cellspacing="1" cellpadding="1"><tbody>';for(var g in h.attributes){if(g){f+='<tr class="olFeatureInfoRow"><td width="50%" class="olFeatureInfoColumn">'+g+'</td><td width="50%" class="olFeatureInfoValue">'+h.attributes[g]+"</td></tr>";}}f+="</tbody></table>";var j=new Ext.XTemplate(f);j.overwrite(this.infoPanel.body,h);},click:function(j){if(j.attributes.features.length===0){var l='<table class="olFeatureInfoTable" cellpadding="1" cellspacing="1"><tbody>';l+='<tr class="olFeatureInfoRow"><td colspan="2" class="olFeatureInfoValue">'+OpenLayers.i18n("FeatureInfoNoInfo")+"</td></tr>";l+="</tbody></table>";Ext.DomHelper.overwrite(this.infoPanel.body,l);}for(var m=0,h=j.attributes.features.length;m<h;m++){var g=j.attributes.features[m];this.featureToHTML(g);}},clearInfoPanel:function(){if(this.infoPanel.body){Ext.DomHelper.overwrite(this.infoPanel.body,"");}},getLayerTitle:function(j){if(j==null){return"&nbsp";}var h=this.map.getLayersByClass("OpenLayers.Layer.WMS");for(var f=0,g=h.length;f<g;f++){if(h[f].params.LAYERS instanceof Array){if(OpenLayers.Util.indexOf(h[f].params.LAYERS,j)!==-1){return h[f].name;}}else{if(h[f].params.LAYERS.indexOf(j)!==-1){return h[f].name;}}}},showFeatures:function(s){this.clearInfoPanel();var j=this.treePanel.getRootNode();while(j.firstChild){j.removeChild(j.firstChild);}var t,o,m=[];for(t=0,o=s.length;t<o;t++){var q=false;for(var u=0;u<m.length;u++){if(m[u].title===s[t].type){m[u].features.push(s[t]);q=true;}}if(q===false){m.push({title:this.getLayerTitle(s[t].type),features:[s[t]]});}}for(t=0,o=m.length;t<o;t++){var r=new Ext.tree.TreeNode({text:m[t].title,features:m[t].features});r.addListener("click",this.click,this);j.appendChild(r);if(t===0){j.expand();this.click(r);this.treePanel.getSelectionModel().select(r);}}j.expand();}});Ext.reg("gn_featureinfo",GeoNetwork.FeatureInfoPanel);Ext.namespace("GeoNetwork");GeoNetwork.LegendPanel=Ext.extend(GeoExt.LegendPanel,{initComponent:function(){GeoNetwork.LegendPanel.superclass.initComponent.call(this);},onStoreAdd:function(o,q,m){GeoNetwork.LegendPanel.superclass.onStoreAdd.apply(this,arguments);for(var l=0,j=q.length;l<j;l++){var h=q[l];if(h.get("layer").legendURL!==undefined){h.set("legendURL",h.get("layer").legendURL);}}}});Ext.reg("gn_legendpanel",GeoNetwork.LegendPanel);Ext.namespace("GeoNetwork");GeoNetwork.ProjectionSelector=function(b){Ext.apply(this,b);GeoNetwork.ProjectionSelector.superclass.constructor.call(this);};Ext.extend(GeoNetwork.ProjectionSelector,Ext.form.ComboBox,{projections:null,initComponent:function(){GeoNetwork.ProjectionSelector.superclass.initComponent.call(this);this.on("select",this.reproject,this);this.valueField="value";this.autoWidth=true;this.autoHeight=true;this.displayField="text";this.triggerAction="all";this.mode="local";this.store=new Ext.data.Store({reader:new Ext.data.ArrayReader({},[{name:"value"},{name:"text"}]),data:this.projections});this.value=this.map.getProjection();},reproject:function(d,e){GeoNetwork.OGCUtil.reprojectMap(this.map,new OpenLayers.Projection(e.get("value")),false);}});Ext.reg("gn_projectionselector",GeoNetwork.ProjectionSelector);Ext.namespace("GeoNetwork");GeoNetwork.TimeSelector=function(b){Ext.apply(this,b);GeoNetwork.TimeSelector.superclass.constructor.call(this);};Ext.extend(GeoNetwork.TimeSelector,Ext.form.FormPanel,{layer:null,numberOfSteps:12,border:false,originalFormat:null,initComponent:function(){this.buttons=[new Ext.Button({text:OpenLayers.i18n("wmsTimeUpdateButtonText"),handler:this.updateValue,scope:this})];GeoNetwork.TimeSelector.superclass.initComponent.call(this);},beforeDestroy:function(){this.updateValue();GeoNetwork.TimeSelector.superclass.beforeDestroy.call(this);},setLayer:function(b){this.layer=b;this.originalFormat=this.layer.params.FORMAT||this.layer.params.format;if(this.layer.dimensions&&this.layer.dimensions.time){this.add(new Ext.form.Label({text:OpenLayers.i18n("WMSTimePositionTitle")}));this.add(new Ext.BoxComponent({height:10}));this.add(this.createDateTimeField());if(this.layer.dimensions.time.multipleVal){this.add(new Ext.BoxComponent({height:25}));this.add(new Ext.form.Label({text:OpenLayers.i18n("WMSTimeMovieTitle")}));this.add(new Ext.BoxComponent({height:10}));this.add({xtype:"checkbox",listeners:{check:{fn:this.playMovie,scope:this}},hideLabel:true,boxLabel:OpenLayers.i18n("WMSTimeAnimationCheckbox",{steps:this.numberOfSteps})});}this.doLayout();}},getInterval:function(b){return parseInt(b.substring(b.indexOf("PT")+2,b.indexOf("M")));},playMovie:function(r,m){if(m){var s,o,a;if(this.layer.dimensions.time.values&&this.layer.dimensions.time.values.length>0){var q=this.layer.dimensions.time.values[0].split("/");s=q[1];o=this.getInterval(q[2]);var l=Date.parseDate(s,"c");l=l-(1000*60*o*this.numberOfSteps);l=new Date(l);a=this.formatTimeAsUTC(l)+"/"+s;}this.layer.mergeNewParams({TIME:a,FORMAT:"image/gif"});}else{this.updateValue();}},formatTimeAsUTC:function(f){var e=f.dateFormat("c");var g=""+f.getUTCHours();if(g.length<2){g="0"+g;}e=e.replace(e.substring(e.indexOf("T"),e.indexOf("T")+3),"T"+g);e=e.replace(e.substring(e.indexOf("+"),e.indexOf("+")+6),"Z");return e;},updateValue:function(){this.layer.mergeNewParams({TIME:this.formatTimeAsUTC(this.getForm().findField("current").getValue()),FORMAT:this.originalFormat});},createDateTimeField:function(){var h,g,j;if(this.layer.dimensions.time.values&&this.layer.dimensions.time.values.length>0){var f=this.layer.dimensions.time.values[0].split("/");
h=f[0];g=f[1];j=this.getInterval(f[2]);}return new Ext.ux.form.DateTime({hiddenFormat:"c",dateFormat:null,hideLabel:true,name:"current",dateConfig:{minValue:Date.parseDate(h,"c"),maxValue:Date.parseDate(g,"c")},timeConfig:{increment:j},value:(this.layer.params.TIME)?this.layer.params.TIME:this.layer.dimensions.time["default"],width:340});}});Ext.reg("gn_timeselector",GeoNetwork.TimeSelector);Ext.namespace("GeoNetwork");GeoNetwork.BaseWindow=function(b){Ext.apply(this,b);GeoNetwork.BaseWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.BaseWindow,Ext.Window,{map:null,initComponent:function(){GeoNetwork.BaseWindow.superclass.initComponent.call(this);this.constrainHeader=true;this.collapsible=true;this.layout="fit";this.plain=true;this.stateful=false;}});Ext.namespace("GeoNetwork");GeoNetwork.SingletonWindowManager=function(){var e=new Object();var d=new Array();return{registerWindow:function(a,h,j){var b=new h(j);e[a]={windowz:b,classz:h,configz:j};},getWindow:function(a){if(e[a]){return e[a].windowz;}else{return null;}},showWindow:function(a){if(e[a]){if(Ext.isEmpty(Ext.getCmp(a))){var g=e[a];var b=new g.classz(g.configz);e[a]={windowz:b,classz:g.classz,configz:g.configz};}e[a].windowz.show();return true;}else{return false;}},hideAllWindows:function(){for(key in e){if(e[key].windowz.isVisible()){e[key].windowz.setVisible(false);d[d.length]=key;}}},restoreHiddenWindows:function(){for(var a=0,b=d.length;a<b;++a){e[d[a]].windowz.setVisible(true);}d=new Array();}};};GeoNetwork.WindowManager=new GeoNetwork.SingletonWindowManager();Ext.namespace("GeoNetwork");GeoNetwork.AddWmsLayerWindow=function(b){Ext.apply(this,b);GeoNetwork.AddWmsLayerWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.AddWmsLayerWindow,GeoNetwork.BaseWindow,{iconCls:"addLayerIcon",browserPanel:null,initComponent:function(){GeoNetwork.AddWmsLayerWindow.superclass.initComponent.call(this);this.title=this.title||OpenLayers.i18n("addWMSWindowTitle");this.width=600;this.height=500;var d=new Ext.data.Store({data:GeoNetwork.WMSList,reader:new Ext.data.ArrayReader({},[{name:"title"},{name:"url"}])});this.browserPanel={id:this.id+"wmsbrowserpanel",xtype:"gn_wmsbrowserpanel",mode:GeoNetwork.wms.BrowserPanel.ADDWMS,wmsStore:d,map:this.map};var e=new Ext.Panel({border:false,deferredRender:false,layout:"fit",items:[this.browserPanel]});this.add(e);this.doLayout();}});Ext.namespace("GeoNetwork");GeoNetwork.FeatureInfoWindow=function(b){Ext.apply(this,b);GeoNetwork.FeatureInfoWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.FeatureInfoWindow,GeoNetwork.BaseWindow,{control:null,initComponent:function(){GeoNetwork.FeatureInfoWindow.superclass.initComponent.call(this);this.title=this.title||OpenLayers.i18n("featureInfoWindow.windowTitle");this.width=600;this.height=250;this.cls="popup-variant1";var b=new GeoNetwork.FeatureInfoPanel();this.add(b);this.doLayout();},setFeatures:function(b){this.items.items[0].showFeatures(b);},setMap:function(b){this.items.items[0].setMap(b);}});Ext.namespace("GeoNetwork");GeoNetwork.LoadWmcWindow=function(b){Ext.apply(this,b);GeoNetwork.LoadWmcWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.LoadWmcWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.LoadWmcWindow.superclass.initComponent.call(this);this.width=480;this.title=this.title||OpenLayers.i18n("selectWMCFile.windowTitle");this.resizable=false;this.charset="UTF-8";var b=new Ext.FormPanel({fileUpload:true,height:100,bodyStyle:"padding: 10px 10px 0 10px;",labelWidth:0,plain:true,frame:true,border:false,defaults:{anchor:"90%",msgTarget:"side",allowBlank:false},items:[{xtype:"fileuploadfield",id:"form-file",width:120,emptyText:OpenLayers.i18n("selectWMCFile"),hideLabel:true,buttonText:"",name:"Fileconten",buttonCfg:{text:"",iconCls:"selectfile"}}],buttons:[{text:OpenLayers.i18n("selectWMCFile.loadButtonText"),scope:this,handler:function(){if(b.getForm().isValid()){b.getForm().submit({url:"../../wmc/load.wmc",success:this.onSuccessLoad,failure:this.onFailure,scope:this});}}},{text:OpenLayers.i18n("selectWMCFile.mergeButtonText"),scope:this,handler:function(){if(b.getForm().isValid()){b.getForm().submit({url:"../../wmc/load.wmc",success:this.onSuccessMerge,failure:this.onFailure,scope:this});}}}]});this.add(b);this.doLayout();},onSuccessLoad:function(m,l){var g=l.response.responseText;var j=Ext.decode(g);if(j.success){var h=OpenLayers.Function.bind(this.parseWMCLoad,this);OpenLayers.loadURL(j.url,null,null,h);}else{this.onAjaxFailure();}},onSuccessMerge:function(m,l){var g=l.response.responseText;var j=Ext.decode(g);if(j.success){var h=OpenLayers.Function.bind(this.parseWMCMerge,this);OpenLayers.loadURL(j.url,null,null,h);}else{this.onAjaxFailure();}},onFailure:function(e,d){Ext.MessageBox.show({icon:Ext.MessageBox.ERROR,title:OpenLayers.i18n("errorTitle"),msg:OpenLayers.i18n("InvalidWMC"),buttons:Ext.MessageBox.OK});},parseWMCLoad:function(b){GeoNetwork.WMCManager.loadWmc(this.map,b.responseText);Ext.WindowMgr.getActive().close();},parseWMCMerge:function(b){GeoNetwork.WMCManager.mergeWmc(this.map,b.responseText);Ext.WindowMgr.getActive().close();}});Ext.namespace("GeoNetwork");GeoNetwork.DisclaimerWindow=function(b){Ext.apply(this,b);GeoNetwork.DisclaimerWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.DisclaimerWindow,Ext.Window,{disclaimer:null,initComponent:function(){GeoNetwork.BaseWindow.superclass.initComponent.call(this);this.id="disclaimerwindow";this.constrainHeader=true;this.layout="fit";this.plain=true;this.stateful=false;this.title=OpenLayers.i18n("disclaimer.windowTitle");this.minWidth=440;this.minHeight=280;this.width=440;this.height=280;this.autoScroll=true;this.modal=true;this.addButton(OpenLayers.i18n("disclaimer.buttonClose"),function(){this.close();},this);if(this.disclaimer.startsWith("http://")){this.on("show",this.showDisclaimerUrl);}else{var b=new Ext.form.TextArea({hideLabel:true,name:"msg",value:this.disclaimer,anchor:"100% -53",enableKeyEvents:true,listeners:{keydown:function(e,a){if(!(a.getKey()==67&&a.ctrlKey)){a.stopEvent();}}}});this.add(b);}this.doLayout();},showDisclaimerUrl:function(){this.load({url:OpenLayers.ProxyHost+this.disclaimer,text:OpenLayers.i18n("disclaimer.loading"),timeout:30,scripts:false});}});Ext.namespace("GeoNetwork");GeoNetwork.LayerStylesWindow=function(b){Ext.apply(this,b);GeoNetwork.LayerStylesWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.LayerStylesWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.LayerStylesWindow.superclass.initComponent.call(this);this.title=this.title||OpenLayers.i18n("layerStylesWindowTitle");this.width=575;this.height=300;this.layerStylesPanel=new GeoNetwork.wms.LayerStylesPanel({map:this.map});this.add(this.layerStylesPanel);this.addButton(OpenLayers.i18n("selectStyleButton"),this._selectStyle,this);this.doLayout();},showLayerStyles:function(b){this.layer=b;this.layerStylesPanel.showLayerStyles(b);},_selectStyle:function(){this.layer.mergeNewParams({styles:this.layerStylesPanel.selectedStyle});this.layer.legendURL=this.layerStylesPanel.selectedStyleLegendUrl;}});Ext.namespace("GeoNetwork");GeoNetwork.WmsLayerMetadataWindow=function(b){Ext.apply(this,b);GeoNetwork.WmsLayerMetadataWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.WmsLayerMetadataWindow,GeoNetwork.BaseWindow,{layer:null,initComponent:function(){GeoNetwork.WmsLayerMetadataWindow.superclass.initComponent.call(this);this.title=this.title||OpenLayers.i18n("layerInfoPanel.windowTitle");this.width=575;this.height=300;this.infoLayerPanel=new GeoNetwork.wms.LayerInfoPanel({map:this.map});this.add(this.infoLayerPanel);this.doLayout();},showLayerInfo:function(b){this.infoLayerPanel.layer=b;this.infoLayerPanel.onlineresource=b.url;this.infoLayerPanel.showLayerInfo();}});Ext.namespace("GeoNetwork");GeoNetwork.WMSTimeWindow=function(b){Ext.apply(this,b);GeoNetwork.WMSTimeWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.WMSTimeWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.WMSTimeWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("WMSTimeWindowTitle");this.width=450;this.height=300;this.timeSelector=new GeoNetwork.TimeSelector({bodyStyle:"padding: 10px 10px 0 10px;"});this.add(this.timeSelector);this.doLayout();},setLayer:function(b){this.timeSelector.setLayer(b);}});GeoNetwork.Settings={};OpenLayers.ProxyHostURL="../../proxy?url=";OpenLayers.ProxyHost=function(a){if(a&&a.indexOf(window.location.host)!=-1){return a;}else{return OpenLayers.ProxyHostURL+encodeURIComponent(a);}};GeoNetwork.Util.defaultLocale="en";GeoNetwork.searchDefault={activeMapControlExtent:false};GeoNetwork.advancedFormButton=true;GeoNetwork.Settings.editor={defaultViewMode:"simple",editHarvested:false};GeoNetwork.printDefaultForTabs=false;GeoNetwork.hideLoginLabels=true;GeoNetwork.Settings.mdStore=GeoNetwork.data.MetadataResultsFastStore;GeoNetwork.Settings.latestQuery="from=1&to=6&sortBy=changeDate&fast=index";GeoNetwork.Settings.latestTpl=GeoNetwork.Templates.THUMBNAIL;GeoNetwork.MapModule=true;GeoNetwork.ProjectionList=[["EPSG:4326","WGS84 (lat/lon)"]];GeoNetwork.WMSList=[["Geoserver","http://localhost/geoserver/wms?"]];GeoNetwork.defaultViewMode="view-simple";Ext.BLANK_IMAGE_URL="../js/ext/resources/images/default/s.gif";OpenLayers.DOTS_PER_INCH=90.71;OpenLayers.ImgPath="../js/OpenLayers/img/";OpenLayers.IMAGE_RELOAD_ATTEMPTS=3;OpenLayers.Util.onImageLoadErrorColor="transparent";OpenLayers.Lang.setCode(GeoNetwork.defaultLocale);OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){this.src=this.src;}else{this.style.backgroundColor=OpenLayers.Util.onImageLoadErrorColor;this.style.display="none";}};Proj4js.defs["EPSG:2154"]="+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs";GeoNetwork.map.printCapabilities="../../pdf";GeoNetwork.map.PROJECTION="EPSG:4326";GeoNetwork.map.EXTENT=new OpenLayers.Bounds(-180,-90,180,90);GeoNetwork.map.BACKGROUND_LAYERS=[new OpenLayers.Layer.WMS("Background layer","/geoserver/wms",{layers:"gn:world,gn:ne_50m_boundary_da,gn:ne_50m_boundary_lines_land,gn:ne_50m_coastline",format:"image/jpeg"},{isBaseLayer:true})];GeoNetwork.map.MAP_OPTIONS={projection:GeoNetwork.map.PROJECTION,maxExtent:GeoNetwork.map.EXTENT,restrictedExtent:GeoNetwork.map.EXTENT,controls:[]};GeoNetwork.map.MAIN_MAP_OPTIONS={projection:GeoNetwork.map.PROJECTION,maxExtent:GeoNetwork.map.EXTENT,restrictedExtent:GeoNetwork.map.EXTENT,controls:[]};Ext.namespace("GeoNetwork");var mapInit=false;var activeIndex=0;GeoNetwork.mapApp=function(){var o,C,D,Q;var z,Y,t,j,Z,W,I;var m;var v;var H;var E;var K;var G;var S;var J=function(ab){H=ab;};var w=function(ac,ad){var ab=ac||{projection:"EPSG:4326",units:"degrees",maxExtent:new OpenLayers.Bounds(-180,-90,180,90),restrictedExtent:new OpenLayers.Bounds(-180,-90,180,90),controls:[]};H=new OpenLayers.Map("ol_map",ab);E=ad;};var l=function(ad,ac,ae,ab){H.addLayer(new OpenLayers.Layer.WMS(ad,ac,ae,ab));};var U=function(ab){H.addLayer(ab);};var T=function(){var ab=new OpenLayers.Layer.Image("Dummy","../../../js/OpenLayers/img/blank.gif",new OpenLayers.Bounds(0,300000,300000,625000),H.getSize(),{isBaseLayer:true,displayInLayerSwitcher:false});H.addLayer(ab);};var g=function(){H.addControl(new GeoNetwork.Control.ZoomWheel());H.addControl(new OpenLayers.Control.LoadingPanel());};var aa=function(ac){if(ac){var ab;ab=ac.attributes.layer;if(ab){if(!ab.isBaseLayer){if((typeof(ab.isLoading)=="undefined")||(ab.isLoading==false)){H.removeLayer(ab);if(v==ac){v=null;}u(v);Ext.getCmp("toctree").getSelectionModel().clearSelections();}}}}};var M=function(){var ab=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();aa(ab);};var F=function(ac){if(ac){var ab;ab=ac.attributes.layer;if(ab&&ab.dimensions&&ab.dimensions.time){GeoNetwork.WindowManager.showWindow("wmstime");GeoNetwork.WindowManager.getWindow("wmstime").setLayer(ab);}}};var B=function(){var ab=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();F(ab);};var q=function(ac){if(ac){var ab;ab=ac.attributes.layer;if((ab)&&(ab.styles)&&(ab.styles.length>1)){GeoNetwork.WindowManager.showWindow("layerstyles");GeoNetwork.WindowManager.getWindow("layerstyles").showLayerStyles(ab);}}};var L=function(){var ab=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();q(ab);};var s=function(ac){if(ac){var ab;ab=ac.attributes.layer;if(ab){GeoNetwork.WindowManager.showWindow("wmsinfo");GeoNetwork.WindowManager.getWindow("wmsinfo").showLayerInfo(ab);}}};var d=function(){var ab=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();s(ab);};var u=function(ab){if((ab)&&(ab.attributes.layer)){if(ab.parentNode.attributes.nodeType=="gx_baselayercontainer"){Ext.getCmp("tbRemoveButton").disable();}else{Ext.getCmp("tbRemoveButton").enable();}Ext.getCmp("tbMetadataButton").enable();Ext.getCmp("btnZoomToExtent").enable();}else{Ext.getCmp("tbRemoveButton").disable();Ext.getCmp("tbMetadataButton").disable();Ext.getCmp("btnZoomToExtent").disable();}};var N=function(){Z=new GeoExt.data.PrintProvider({method:"POST",url:GeoNetwork.map.printCapabilities,autoLoad:true});W=new GeoExt.data.PrintPage({printProvider:Z});I=new OpenLayers.Layer.Vector(OpenLayers.i18n("printLayer"),{visibility:false});I.addFeatures(W.feature);H.addLayer(I);H.events.register("moveend",H,function(){W.fit(this,{mode:"screen"});});j=new Ext.form.FormPanel({title:OpenLayers.i18n("mf.print.print"),bodyStyle:"padding:5px",labelAlign:"top",defaults:{anchor:"100%"},items:[{xtype:"textarea",name:"comment",value:"",fieldLabel:OpenLayers.i18n("mf.print.comment"),plugins:new GeoExt.plugins.PrintPageField({printPage:W})},{xtype:"combo",store:Z.layouts,displayField:"name",fieldLabel:OpenLayers.i18n("layout"),typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintProviderField({printProvider:Z})},{xtype:"combo",store:Z.dpis,displayField:"name",fieldLabel:OpenLayers.i18n("mf.print.dpi"),tpl:'<tpl for="."><div class="x-combo-list-item">{name} dpi</div></tpl>',typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintProviderField({printProvider:Z}),setValue:function(ab){ab=parseInt(ab,10)+" dpi";Ext.form.ComboBox.prototype.setValue.apply(this,arguments);}},{xtype:"combo",store:Z.scales,displayField:"name",fieldLabel:OpenLayers.i18n("mf.print.scale"),typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintPageField({printPage:W})},{xtype:"textfield",name:"rotation",fieldLabel:OpenLayers.i18n("mf.print.rotation"),plugins:new GeoExt.plugins.PrintPageField({printPage:W})}],buttons:[{text:OpenLayers.i18n("mf.print.generatingPDF"),handler:function(){Z.print(Ext.getCmp("mappanel"),W);}}],listeners:{beforeexpand:function(){this.setVisibility(true);},beforecollapse:function(){this.setVisibility(false);},scope:I}});};var e=function(){C=[];var ac=new GeoExt.Action({handler:function(){GeoNetwork.WindowManager.showWindow("addwms");},iconCls:"addLayer",tooltip:"Add layer"});C.push(ac);ac=new GeoExt.Action({id:"tbRemoveButton",handler:function(){aa(v);},iconCls:"deleteLayer",tooltip:"Remove layer"});C.push(ac);C.push("-");ac=new GeoExt.Action({id:"tbMetadataButton",handler:function(){s(v);},iconCls:"wmsInfo",tooltip:"WMS Information"});C.push(ac);o=[];ac=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent(),map:H,iconCls:"zoomfull"});o.push(ac);o.push("-");ac=new GeoExt.Action({iconCls:"zoomlayer",id:"btnZoomToExtent",handler:function(){var ai=v;var ag;if(ai){ag=ai.attributes.layer;if(ag){if(ag.llbbox){var aj=H.getProjectionObject();var af=new OpenLayers.Projection("WGS84");var ad=new OpenLayers.LonLat(ag.llbbox[0],ag.llbbox[1]).transform(af,aj);var ae=new OpenLayers.LonLat(ag.llbbox[2],ag.llbbox[3]).transform(af,aj);var ah=new OpenLayers.Bounds();ah.left=ad.lon;ah.right=ae.lon;ah.top=ae.lat;ah.bottom=ad.lat;H.zoomToExtent(ah);}else{H.zoomToMaxExtent();}}else{Ext.MessageBox.alert(OpenLayers.i18n("zoomlayer.selectLayerTitle"),OpenLayers.i18n("zoomlayer.selectLayerText"));
}}else{Ext.MessageBox.alert(OpenLayers.i18n("zoomlayer.selectLayerTitle"),OpenLayers.i18n("zoomlayer.selectLayerText"));}}});o.push(ac);o.push("-");ac=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox(),map:H,toggleGroup:"move",allowDepress:false,iconCls:"zoomin"});o.push(ac);ac=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({displayClass:"ZoomOut",out:true}),toggleGroup:"move",allowDepress:false,map:H,iconCls:"zoomout"});o.push(ac);ac=new GeoExt.Action({control:new OpenLayers.Control.DragPan({isDefault:true}),toggleGroup:"move",allowDepress:false,pressed:true,map:H,iconCls:"pan"});o.push(ac);o.push("-");m=new OpenLayers.Control.WMSGetFeatureInfo({drillDown:true,infoFormat:"application/vnd.ogc.gml"});var ab=function(ah){var ae=-1;for(var ag=0,ad=H.layers.length;ag<ad;ag++){var af=H.layers[ag];if(af!=ah){ae=Math.max(H.getLayerIndex(H.layers[ag]),ae);}}if(H.getLayerIndex(ah)<ae){H.setLayerIndex(ah,ae+1);}};K=new OpenLayers.Layer.Vector("Feature info",{displayInLayerSwitcher:false,styleMap:new OpenLayers.StyleMap({externalGraphic:OpenLayers.Util.getImagesLocation()+"marker.png",pointRadius:12})});m.events.on({getfeatureinfo:function(ae){var af=H.getLonLatFromViewPortPx(ae.xy);var ad=new OpenLayers.Geometry.Point(af.lon,af.lat);K.destroyFeatures();K.addFeatures(new OpenLayers.Feature.Vector(ad));ab(K);GeoNetwork.WindowManager.showWindow("featureinfo");GeoNetwork.WindowManager.getWindow("featureinfo").setMap(H);GeoNetwork.WindowManager.getWindow("featureinfo").setFeatures(ae.features);},deactivate:function(){K.destroyFeatures();}});ac=new GeoExt.Action({control:m,toggleGroup:"move",allowDepress:false,pressed:false,map:H,iconCls:"query"});o.push(ac);o.push("-");ctrl=new OpenLayers.Control.NavigationHistory();H.addControl(ctrl);ac=new GeoExt.Action({control:ctrl.previous,disabled:true,map:H,iconCls:"back"});o.push(ac);ac=new GeoExt.Action({control:ctrl.next,disabled:true,map:H,iconCls:"next"});o.push(ac);o.push("-");ac=new GeoExt.Action({iconCls:"savewmc",handler:function(){GeoNetwork.WMCManager.saveContext(H);}});o.push(ac);ac=new GeoExt.Action({iconCls:"loadwmc",handler:function(){GeoNetwork.WindowManager.showWindow("loadwmc");}});o.push(ac);o.push("->");o.push({xtype:"gn_projectionselector",projections:GeoNetwork.ProjectionList,fieldLabel:OpenLayers.i18n("projectionTitle"),map:H});};var b=function(){var ad=new Ext.Panel({cls:"olControlScaleLine overlay-element overlay-scaleline",border:false});ad.on("render",function(){var al=new OpenLayers.Control.ScaleLine({div:ad.body.dom});H.addControl(al);al.activate();},this);var ab;if(E&&E.length>0){var ai=[];var aj=E;var ag=H.baseLayer.units;for(var af=aj.length-1;af>=0;af--){var ac=aj[af];ai.push({level:af,resolution:OpenLayers.Util.getResolutionFromScale(ac,ag),scale:ac});}ab=new GeoExt.data.ScaleStore({});ab.loadData(ai);}else{ab=new GeoExt.data.ScaleStore({map:H});}var ak=new Ext.form.ComboBox({emptyText:"Zoom level",tpl:'<tpl for="."><div class="x-combo-list-item">1 : {[parseInt(values.scale)]}</div></tpl>',editable:false,triggerAction:"all",mode:"local",store:ab,width:110});ak.on("click",function(al){al.stopEvent();});ak.on("mousedown",function(al){al.stopEvent();});ak.on("select",function(an,al,am){H.zoomTo(al.data.level);},this);var ae=new Ext.Panel({items:[ak],cls:"overlay-element overlay-scalechooser",border:false});H.events.register("zoomend",this,function(){var al=ab.queryBy(function(am){return H.getZoom()==am.data.level;});if(al.length>0){al=al.items[0];ak.setValue("1 : "+parseInt(al.data.scale,10));}else{if(!ak.rendered){return;}ak.clearValue();}});var ah=new Ext.Panel({cls:"map-overlay",items:[ad,ae]});ah.on("afterlayout",function(){ad.body.dom.style.position="relative";ad.body.dom.style.display="inline";ah.getEl().on("click",function(al){al.stopEvent();});ah.getEl().on("mousedown",function(al){al.stopEvent();});},this);return ah;};var r=function(ad,ah){var af=new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:0.3}}})]})});var ac=function(){if(ab){ab.destroy();}};var ae=function(ak){var al=ak.measure;var ai=ak.units;ag.displaySystem="english";var an=ak.geometry.CLASS_NAME.indexOf("LineString")>-1?ag.getBestLength(ak.geometry):ag.getBestArea(ak.geometry);var aj=an[0];var am=an[1];ag.displaySystem="metric";var ao=ak.order==2?"<sup>2</sup>":"";return al.toFixed(2)+" "+ai+ao+"<br>"+aj.toFixed(2)+" "+am+ao;};var ab;var ag=new OpenLayers.Control.Measure(ad,{persist:true,handlerOptions:{layerOptions:{styleMap:af}},eventListeners:{measurepartial:function(aj){ac();ab=new Ext.ToolTip({html:ae(aj),title:ah,autoHide:false,closable:true,draggable:false,mouseOffset:[0,0],showDelay:1,listeners:{hide:ac}});if(aj.measure>0){var ai=ag.handler.lastUp;var ak=Ext.getCmp("mappanel").getPosition();ab.targetXY=[ak[0]+ai.x,ak[1]+ai.y];ab.show();}},measure:function(ai){ac();ab=new Ext.ToolTip({target:Ext.getBody(),html:ae(ai),title:ah,autoHide:false,closable:true,draggable:false,mouseOffset:[0,0],showDelay:1,listeners:{hide:function(){ag.cancel();ac();}}});},deactivate:ac,scope:this}});return ag;};var P=function(){var ab=new OpenLayers.Format.JSON().write([{nodeType:"gx_baselayercontainer"},{nodeType:"gx_overlaylayercontainer",expanded:true,loader:{baseAttrs:{radioGroup:"foo",slider:"layeropacityslider",uiProvider:"layernodeui"}}}],true);var ac=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin());z=new Ext.tree.TreePanel({title:OpenLayers.i18n("layerTree"),id:"toctree",enableDD:true,loader:new Ext.tree.TreeLoader({applyLoader:false,uiProviders:{layernodeui:ac}}),plugins:[new GeoExt.plugins.TreeNodeRadioButton({listeners:{radiochange:function(ad){v=ad;}}}),new GeoExt.tree.LayerOpacitySliderPlugin({listeners:{opacityslide:function(ad,ae){}}})],root:{nodeType:"async",children:Ext.decode(ab)},listeners:{contextmenu:function(ad,ae){if((ad.attributes.nodeType!="gx_overlaylayercontainer")&&(ad.attributes.nodeType!="gx_baselayercontainer")){ad.select();var af=ad.getOwnerTree().contextMenu;if(ad.parentNode.attributes.nodeType=="gx_baselayercontainer"){af.items.get("removeMenu").disable();}else{af.items.get("removeMenu").enable();}af.items.get("addMenu").hide();af.contextNode=ad;af.showAt(ae.getXY());}else{if(ad.attributes.nodeType=="gx_overlaylayercontainer"){ad.select();af=ad.getOwnerTree().contextMenu;af.items.get("addMenu").show();af.items.get("removeMenu").hide();af.items.get("metadataMenu").hide();af.contextNode=ad;af.showAt(ae.getXY());}}},scope:this},contextMenu:new Ext.menu.Menu({items:[{text:"Add layer",id:"addMenu",handler:function(){GeoNetwork.WindowManager.showWindow("addwms");}},{text:OpenLayers.i18n("removeButtonText"),id:"removeMenu",handler:M},{text:"WMS information",id:"metadataMenu",handler:d}]}),tbar:C,rootVisible:false,lines:false,border:false,region:"center"});};var O=function(){Y=new GeoExt.LegendPanel({defaults:{labelCls:"mylabel",style:"padding:5px"},title:"Legend",height:200,autoScroll:true,split:true,collapsible:true,collapsed:true,border:false,region:"south"});};var h=function(){e();P();O();N();var ac=b();var ab=new Ext.Panel({region:"center",border:false,layout:"accordion",deferredRender:false,items:[z,j]});Q=new Ext.Panel({layout:"border",border:false,items:[{id:"layerManager",region:"east",xtype:"panel",collapsible:true,collapsed:true,collapseMode:"mini",split:true,border:false,width:170,minSize:170,maxSize:300,layout:"border",items:[ab,Y]},{region:"center",layout:"fit",frame:false,border:false,margins:"0 0 0 0",items:[{id:"mappanel",xtype:"gx_mappanel",map:H,tbar:o,border:false,extent:GeoNetwork.map.EXTENT,items:[ac]}]}]});Ext.getCmp("toctree").on({click:function(ad){if(ad.ui.radio){ad.ui.radio.checked=true;ad.ui.fireEvent("radiochange",ad);
}u(ad);},scope:this});Ext.getCmp("toctree").on("nodedragover",function(ad){if((ad.dropNode.parentNode.attributes.nodeType=="gx_baselayercontainer")||(ad.target.attributes.nodeType=="gx_baselayercontainer")||(ad.target.parentNode.attributes.nodeType=="gx_baselayercontainer")||(ad.target.parentNode==ad.tree.root)){ad.cancel=true;}});u(v);};var V=function(ai){G.hide();var ac=new OpenLayers.Format.WMSCapabilities();var ah=ac.read(ai.responseXML||ai.responseText);if(ah.capability){var ag=ah.service.accessContraints;if((ag)&&(ag.toLowerCase()!="none")&&(ag!="-")){var ad=new GeoNetwork.DisclaimerWindow({disclaimer:ag});ad.show();ad=null;}if(H){for(var ak=0,am=S.length;ak<am;ak++){var ae=S[ak][0];var ab=S[ak][1];var al=S[ak][2];var af=S[ak][3];var aj=new OpenLayers.Layer.WMS(ae,ab,{layers:al,format:"image/png",transparent:"TRUE",version:ah.version,language:GeoNetwork.OGCUtil.getLanguage()},{queryable:true,singleTile:true,ratio:1,buffer:0,transitionEffect:"resize",metadata_id:af});if(!GeoNetwork.OGCUtil.layerExistsInMap(aj,H)){aj.events.on({loadstart:function(){this.isLoading=true;}});aj.events.on({loadend:function(){this.isLoading=false;}});var an=a(ah,ah.capability.layers,aj);if(an){aj.queryable=an.queryable;aj.name=an.title||aj.name;aj.llbbox=an.llbbox;aj.styles=an.styles;aj.dimensions=an.dimensions;}H.addLayer(aj);}}}}};var f=function(ab){G.hide();Ext.MessageBox.alert(OpenLayers.i18n("loadLayer.error.title"),OpenLayers.i18n("loadLayer.error.message"));};var a=function(ab,ai,ae){var aj=null;for(var ac=0,ag=ai.length;ac<ag;++ac){var ad=ai[ac];try{var af=ad.name.split(",");if(af.indexOf(ae.params.LAYERS)!=-1){aj=ad;break;}}catch(ah){}if(typeof(ad.childLayers)!="undefined"){aj=a(ab,ad.childLayers,ae);if(aj!==null){break;}}}return aj;};return{init:function(ae,ac,ab){w(ac,ab);for(var ad=0;ad<ae.length;ad++){U(ae[ad].clone());}GeoExt.MapPanel.guess=function(){return Ext.getCmp("mappanel");};h();g();GeoNetwork.WindowManager.registerWindow("addwms",GeoNetwork.AddWmsLayerWindow,{map:H,id:"addwms"});GeoNetwork.WindowManager.registerWindow("wmsinfo",GeoNetwork.WmsLayerMetadataWindow,{map:H,id:"wmsinfo"});GeoNetwork.WindowManager.registerWindow("loadwmc",GeoNetwork.LoadWmcWindow,{map:H,id:"loadwmc"});GeoNetwork.WindowManager.registerWindow("featureinfo",GeoNetwork.FeatureInfoWindow,{map:H,id:"featureinfo",control:m});H.addLayer(K);},addWMSLayer:function(ae){if(ae.length===0){return;}var ac=ae[0][1];if(ae[0][2]==""){GeoNetwork.WindowManager.showWindow("addwms");var ab=Ext.getCmp(GeoNetwork.WindowManager.getWindow("addwms").browserPanel.id);ab.setURL(ac);return;}G=new Ext.LoadMask(H.div,{msg:OpenLayers.Lang.translate("loadLayer.loadingMessage")});G.show();S=ae;var ah={service:"WMS",request:"GetCapabilities",version:"1.1.1"};var ag=OpenLayers.Util.getParameterString(ah);var af=(ac.indexOf("?")>-1)?"&":"?";ac+=af+ag;var ad=OpenLayers.Request.GET({url:ac,success:V,failure:f,timeout:10000});},getViewport:function(){return Q;},refreshViewport:function(){Ext.get("west_panel").setWidth(westPanelWidth);Q.doLayout();},getMap:function(){return H;}};};function initShortcut(){var b=[{key:"f",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("focusOnAny"),fn:function(){var l=Ext.get("E_any");l.highlight();l.dom.focus(true);}},{key:"s",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("runSearch"),fn:function(){var l=Ext.getCmp("searchBt");l.getEl().fadeIn();l.fireEvent("click");}},{key:Ext.EventObject.LEFT,keyLabel:"LEFT",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("previousPage"),fn:function(){Ext.getCmp("previousBt").handler();}},{key:Ext.EventObject.RIGHT,keyLabel:"RIGHT",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("nextPage"),fn:function(){Ext.getCmp("nextBt").handler();}},{key:Ext.EventObject.UP,keyLabel:"UP",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("upInPage"),fn:function(){catalogue.resultsView.getEl().scroll("t",170,true);}},{key:Ext.EventObject.DOWN,keyLabel:"DOWN",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("downInPage"),fn:function(){catalogue.resultsView.getEl().scroll("b",170,true);}},{key:"d",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("hideSearchForm"),fn:function(){var l=Ext.getCmp("west");l.toggleCollapse();}},{key:"r",ctrl:true,shift:true,label:OpenLayers.i18n("resetSearchForm"),fn:function(){var l=Ext.getCmp("resetBt");l.getEl().fadeIn();l.fireEvent("click");}},{key:"v",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("switchMode"),fn:function(){app.switchMode(null,true);}},{key:"m",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("toggleLayerManager"),fn:function(){var l=Ext.getCmp("layerManager");l.toggleCollapse();}},{key:"l",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("focusOnLogin"),fn:function(){var l=Ext.get("username");if(l.isVisible()){l.highlight();l.dom.focus(true);}else{catalogue.logout();}}},{key:"a",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("openAdmin"),fn:function(){catalogue.admin();}},{key:"i",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("displayInfoPanel"),fn:function(){var m=Ext.getCmp("infoPanel");var l=Ext.getCmp("resultsPanel");if(l.isVisible()){l.hide();}if(!m.isVisible()){m.show();}}},{key:"h",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("displayHelpPanel"),fn:function(){var l=Ext.getDom("shortcut").style;if(l.display=="block"){Ext.getDom("shortcut").style.display="none";}else{Ext.getDom("shortcut").style.display="block";}}}];var h=new Ext.KeyMap(document,b);h.enable();var e=Ext.getDom("shortcutHelp");if(e){var d="";for(var g=0;g<b.length;g++){var j=b[g];d+="<tr><td>"+(j.ctrl===true?'<span class="label">&lt;Ctrl&gt;</span> + ':"")+(j.shift===true?'<span class="label">&lt;Shift&gt;</span> + ':"")+'<span class="label">'+(j.keyLabel?j.keyLabel:j.key)+"</span>:</td><td>"+j.label+"</td></tr>";}var f="<table><tbody><tr><td>"+d+"</td></tr></tbody></table>";Ext.DomHelper.insertHtml("afterEnd",e,f);}var a=new Ext.KeyMap("searchForm",[{key:[10,13],fn:function(){Ext.getCmp("searchBt").fireEvent("click");}}]);a.enable();}Ext.namespace("GeoNetwork");var catalogue;var app;GeoNetwork.app=function(){var g;var P=false;var J;var s;var O;var m={};var I;var M;var l;var G;var j;var r,H;var Q,D,f;var L=false;function w(){var S={xtype:"radiogroup",id:"ms",hidden:!GeoNetwork.MapModule,items:[{name:"mode",ctCls:"mn-main",boxLabel:OpenLayers.i18n("discovery"),id:"discoveryMode",width:110,inputValue:0,checked:true},{name:"mode",ctCls:"mn-main",width:140,boxLabel:OpenLayers.i18n("visualization"),id:"visualizationMode",inputValue:1}],listeners:{change:function(T,U){app.switchMode(U.getGroupValue(),false);}}};return new Ext.form.FormPanel({renderTo:"mode-form",border:false,layout:"hbox",items:S});}function C(){M=new GeoNetwork.mapApp();M.init(GeoNetwork.map.BACKGROUND_LAYERS,GeoNetwork.map.MAIN_MAP_OPTIONS);j.addMap(M.getMap());L=true;}function u(S){return new Ext.form.FormPanel({renderTo:"lang-form",width:80,border:false,layout:"hbox",hidden:GeoNetwork.Util.locales.length===1?true:false,items:[new Ext.form.ComboBox({mode:"local",triggerAction:"all",width:80,store:new Ext.data.ArrayStore({idIndex:0,fields:["id","name"],data:GeoNetwork.Util.locales}),valueField:"id",displayField:"name",value:S,listeners:{select:function(U,V,T){window.location.replace("?hl="+U.getValue());}}})]});}function B(){var U=new GeoNetwork.LoginForm({renderTo:"login-form",catalogue:I,layout:"hbox",hideLoginLabels:GeoNetwork.hideLoginLabels});I.on("afterBadLogin",b,this);I.on("afterLogin",function(){var V=Ext.state.Manager.getProvider();V.set("user",I.identifiedUser);});I.on("afterLogout",function(){var V=Ext.state.Manager.getProvider();V.set("user",undefined);});var T=Ext.state.Manager.getProvider();var S=T.get("user");if(S){I.identifiedUser=S;U.login(I,true);}}function b(S,T){Ext.Msg.show({title:"Login",msg:"Login failed. Check your username and password.",icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK});}function o(){var W=[];var af=I.services;
var ag=new GeoNetwork.data.OpenSearchSuggestionStore({url:af.opensearchSuggest,rootId:1,baseParams:{field:"orgName"}});var ad=new Ext.ux.form.SuperBoxSelect({hideLabel:false,minChars:0,queryParam:"q",hideTrigger:false,id:"E_orgName",name:"E_orgName",store:ag,valueField:"value",displayField:"value",valueDelimiter:" or ",fieldLabel:OpenLayers.i18n("org")});var ai=new GeoNetwork.data.OpenSearchSuggestionStore({url:af.opensearchSuggest,rootId:1,baseParams:{field:"keyword"}});var ah=new Ext.ux.form.SuperBoxSelect({hideLabel:false,minChars:0,queryParam:"q",hideTrigger:false,id:"E_themekey",name:"E_themekey",store:ai,valueField:"value",displayField:"value",valueDelimiter:" or ",fieldLabel:OpenLayers.i18n("keyword")});var ab=new Ext.form.FieldSet({title:OpenLayers.i18n("when"),autoWidth:true,defaultType:"datefield",collapsible:true,collapsed:true,items:GeoNetwork.util.SearchFormTools.getWhen()});var aa=GeoNetwork.util.SearchFormTools.getCatalogueField(af.getSources,af.logoUrl,true);var T=GeoNetwork.util.SearchFormTools.getGroupField(af.getGroups,true);var aj=GeoNetwork.util.SearchFormTools.getMetadataTypeField(true);var S=GeoNetwork.util.SearchFormTools.getCategoryField(af.getCategories,"../images/default/category/",true);var U=GeoNetwork.util.SearchFormTools.getValidField(true);var ac=GeoNetwork.util.SearchFormTools.getSpatialRepresentationTypeField(null,true);var Z=GeoNetwork.util.SearchFormTools.getScaleDenominatorField(true);W.push(ah,ad,S,ab,ac,Z,aa,T,aj,U);var V={xtype:"fieldset",title:OpenLayers.i18n("advancedSearchOptions"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:(m.advanced?false:true),defaultType:"checkbox",defaults:{width:160},items:W};var ae=[];ae.push(GeoNetwork.util.SearchFormTools.getSimpleFormFields(I.services,GeoNetwork.map.BACKGROUND_LAYERS,GeoNetwork.map.MAP_OPTIONS,true,GeoNetwork.searchDefault.activeMapControlExtent,undefined,{width:290}),V);var Y=[T,aj,U];Ext.each(Y,function(ak){ak.setVisible(false);});I.on("afterLogin",function(){Ext.each(Y,function(ak){ak.setVisible(true);});});I.on("afterLogout",function(){Ext.each(Y,function(ak){ak.setVisible(false);});});return new Ext.FormPanel({id:"searchForm",border:false,padding:5,defaults:{width:180},listeners:{afterrender:function(){}},items:ae,buttons:[{tooltip:OpenLayers.i18n("resetSearchForm"),id:"resetBt",icon:"../images/default/cross.png",listeners:{click:function(){Ext.getCmp("searchForm").getForm().reset();}}},{text:OpenLayers.i18n("search"),id:"searchBt",icon:"../js/GeoNetwork/resources/images/default/find.png",iconAlign:"right",listeners:{click:function(){if(Ext.getCmp("geometryMap")){j.addMap(Ext.getCmp("geometryMap").map,true);}var ak=Ext.get("E_any");if(ak){if(ak.getValue()===OpenLayers.i18n("fullTextSearch")){ak.setValue("");}}I.startRecord=1;t();}}}]});}function t(){P=true;I.search("searchForm",app.loadResults,null,I.startRecord,true);}function N(){var U=Ext.getCmp("infoPanel"),S=Ext.getCmp("resultsPanel"),T=Ext.getCmp("tagCloudPanel");if(U.isVisible()){U.hide();}if(!S.isVisible()){S.show();}if(!T.isVisible()){T.show();}if(GeoNetwork.MapModule&&!L){C();}}function a(){var T=new Ext.Action({id:"previousBt",text:"&lt;&lt;",handler:function(){var U=I.startRecord-parseInt(Ext.getCmp("E_hitsperpage").getValue(),10);if(U>0){I.startRecord=U;t();}},scope:this});var S=new Ext.Action({id:"nextBt",text:"&gt;&gt;",handler:function(){I.startRecord+=parseInt(Ext.getCmp("E_hitsperpage").getValue(),10);t();},scope:this});return new Ext.Toolbar({items:[T,"|",S,"|",{xtype:"tbtext",text:"",id:"info"}]});}function e(){j=new GeoNetwork.MetadataResultsView({catalogue:I,displaySerieMembers:true,autoScroll:true,tpl:GeoNetwork.Templates.FULL});I.resultsView=j;r=new GeoNetwork.MetadataResultsToolbar({catalogue:I,searchBtCmp:Ext.getCmp("searchBt"),sortByCmp:Ext.getCmp("E_sortBy"),metadataResultsView:j});H=a();resultPanel=new Ext.Panel({id:"resultsPanel",border:false,hidden:true,bodyCssClass:"md-view",autoWidth:true,layout:"fit",tbar:r,items:j,bbar:H});return resultPanel;}function q(U,V,S,T){if(V){d();E();}else{Ext.get("infoPanel").getUpdater().update({url:"home_en.html"});Ext.get("helpPanel").getUpdater().update({url:"help_en.html"});}}function z(){return new Ext.Panel({border:true,id:"infoPanel",baseCls:"md-info",autoWidth:true,contentEl:"infoContent",autoLoad:{url:"home_"+I.LANG+".html",callback:q,scope:this,loadScripts:false}});}function h(){return new Ext.Panel({border:false,frame:false,baseCls:"none",id:"helpPanel",autoWidth:true,renderTo:"shortcut",autoLoad:{url:"help_"+I.LANG+".html",callback:initShortcut,scope:this,loadScripts:false}});}function d(){var S=new GeoNetwork.TagCloudView({catalogue:I,query:"fast=true&summaryOnly=true",renderTo:"tag",onSuccess:"app.loadResults"});return S;}function E(){var T=new GeoNetwork.MetadataResultsView({catalogue:I,autoScroll:true,tpl:GeoNetwork.Settings.latestTpl});var S=GeoNetwork.Settings.mdStore();T.setStore(S);S.on("load",function(){Ext.ux.Lightbox.register("a[rel^=lightbox]");});new Ext.Panel({border:false,bodyCssClass:"md-view",items:T,renderTo:"latest"});I.kvpSearch(GeoNetwork.Settings.latestQuery,null,null,null,true,T.getStore());}function K(){var S=new GeoNetwork.TagCloudView({catalogue:I});return new Ext.Panel({id:"tagCloudPanel",border:true,hidden:true,baseCls:"md-view",items:S});}function F(V,S,T,U){if(!this.editorWindow){this.editorPanel=new GeoNetwork.editor.EditorPanel({defaultViewMode:GeoNetwork.Settings.editor.defaultViewMode,catalogue:I,xlinkOptions:{CONTACT:true}});this.editorWindow=new Ext.Window({tools:[{id:"newwindow",qtip:OpenLayers.i18n("newWindow"),handler:function(aa,Z,Y,W){window.open(GeoNetwork.Util.getBaseUrl(location.href)+"#edit="+Y.getComponent("editorPanel").metadataId);Y.hide();},scope:this}],title:OpenLayers.i18n("mdEditor"),id:"editorWindow",layout:"fit",modal:false,items:this.editorPanel,closeAction:"hide",collapsible:true,collapsed:false,maximizable:true,maximized:true,resizable:true,width:980,height:800});this.editorPanel.setContainer(this.editorWindow);this.editorPanel.on("editorClosed",function(){Ext.getCmp("searchBt").fireEvent("click");});}if(V){this.editorWindow.show();this.editorPanel.init(V,S,T,U);}}function v(){var S=I.getInfo();Ext.getDom("title").innerHTML='<img class="catLogo" src="../../images/logos/'+S.siteId+'.gif"/>&nbsp;'+S.name;document.title=S.name;}return{init:function(){g=GeoNetwork.URL||window.location.href.match(/(http.*\/.*)\/apps\/search.*/,"")[1];m=GeoNetwork.Util.getParameters(location.href);var V=GeoNetwork.Util.getCatalogueLang(m.hl||GeoNetwork.defaultLocale);if(m.extent){m.bounds=new OpenLayers.Bounds(m.extent[0],m.extent[1],m.extent[2],m.extent[3]);}O=new Ext.state.CookieProvider({expires:new Date(new Date().getTime()+(1000*60*60*24*365))});Ext.state.Manager.setProvider(O);I=new GeoNetwork.Catalogue({statusBarId:"info",lang:V,hostUrl:g,mdOverlayedCmpId:"resultsPanel",adminAppUrl:g+"/srv/"+V+"/admin",metadataStore:GeoNetwork.Settings.mdStore?GeoNetwork.Settings.mdStore():GeoNetwork.data.MetadataResultsStore(),metadataCSWStore:GeoNetwork.data.MetadataCSWResultsStore(),summaryStore:GeoNetwork.data.MetadataSummaryStore(),editMode:2,metadataEditFn:F});v();l=o();w();u(V);B();F();G=e();f=z();helpPanel=h();D=K();var U="35 0 0 0";var S=new Ext.Viewport({layout:"border",id:"vp",items:[{region:"west",id:"west",split:true,minWidth:300,width:300,maxWidth:400,autoScroll:true,collapsible:true,hideCollapseTool:true,collapseMode:"mini",margins:U,forceLayout:true,layoutConfig:{animate:true},items:[l,D]},{region:"center",id:"center",split:true,margins:U,items:[f,resultPanel]},{region:"east",id:"east",layout:"fit",split:true,collapsible:true,hideCollapseTool:true,collapseMode:"mini",collapsed:true,hidden:!GeoNetwork.MapModule,margins:U,minWidth:300,width:500}]});if(m.mode){app.switchMode(m.mode,false);}GeoNetwork.util.SearchTools.populateFormFromParams(l,m);if(m.search!==undefined){Ext.getCmp("searchBt").fireEvent("click");}if(m.edit!==undefined&&m.edit!==""){I.metadataEdit(m.edit);}if(m.create!==undefined){resultPanel.getTopToolbar().createMetadataAction.fireEvent("click");
}if(m.uuid!==undefined){I.metadataShow(m.uuid,true);}else{if(m.id!==undefined){I.metadataShowById(m.id,true);}}Ext.get("E_any").setWidth(285);Ext.get("E_any").setHeight(28);if(GeoNetwork.searchDefault.activeMapControlExtent){Ext.getCmp("geometryMap").setExtent();}if(m.bounds){Ext.getCmp("geometryMap").map.zoomToExtent(m.bounds);}resultPanel.setHeight(Ext.getCmp("center").getHeight());var T=["afterDelete","afterRating","afterLogout","afterLogin"];Ext.each(T,function(W){I.on(W,function(){if(P===true){Ext.getCmp("searchBt").fireEvent("click");}});});},getIMap:function(){if(!M){C();}return M;},getCatalogue:function(){return I;},loadResults:function(S){N();Ext.getCmp("previousBt").setDisabled(I.startRecord===1);Ext.getCmp("nextBt").setDisabled(I.startRecord+parseInt(Ext.getCmp("E_hitsperpage").getValue(),10)>I.metadataStore.totalLength);if(Ext.getCmp("E_sortBy").getValue()){Ext.getCmp("sortByToolBar").setValue(Ext.getCmp("E_sortBy").getValue()+"#"+Ext.getCmp("sortOrder").getValue());}else{Ext.getCmp("sortByToolBar").setValue(Ext.getCmp("E_sortBy").getValue());}G.syncSize();G.setHeight(Ext.getCmp("center").getHeight());Ext.getCmp("west").syncSize();Ext.getCmp("center").syncSize();Ext.ux.Lightbox.register("a[rel^=lightbox]");},switchMode:function(Y,V){var T=Ext.getCmp("ms"),W=Ext.getCmp("east"),Z=Ext.getCmp("center"),S=Ext.getCmp("west"),U;if(Y===null){U=T.getValue().getGroupValue();if(U==="0"){T.onSetValue(Ext.getCmp("visualizationMode"),true);}else{T.onSetValue(Ext.getCmp("discoveryMode"),true);}Y=U=T.getValue().getGroupValue();}if(V){if(Y==="1"){T.onSetValue(Ext.getCmp("visualizationMode"),true);}else{T.onSetValue(Ext.getCmp("discoveryMode"),true);}}if(Y==="1"&&!L){C();}if(Y==="1"&&M){W.add(M.getViewport());W.doLayout();if(W.collapsed){W.toggleCollapse();}if(!S.collapsed){S.toggleCollapse();}Ext.getCmp("vp").syncSize();}else{if(!W.collapsed){W.toggleCollapse();}if(S.collapsed){S.toggleCollapse();}}}};};Ext.onReady(function(){var a=/hl=([a-z]{2})/.exec(location.href);GeoNetwork.Util.setLang(a&&a[1],"..");Ext.QuickTips.init();setTimeout(function(){Ext.get("loading").remove();Ext.get("loading-mask").fadeOut({remove:true});},250);app=new GeoNetwork.app();app.init();catalogue=app.getCatalogue();Ext.getDom("E_any").focus(true);});