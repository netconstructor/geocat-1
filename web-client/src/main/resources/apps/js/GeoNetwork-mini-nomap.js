Ext.namespace("Ext.ux.form");Ext.ux.form.TwinTriggerComboBox=function(a){Ext.ux.form.TwinTriggerComboBox.superclass.constructor.apply(this,arguments);};Ext.extend(Ext.ux.form.TwinTriggerComboBox,Ext.form.ComboBox,{trigger1Class:"x-form-clear-trigger",trigger2Class:"",trigger3Class:"x-form-trigger3-trigger",hideTrigger1:true,tooltipType:"qtip",initComponent:function(){Ext.ux.form.TwinTriggerComboBox.superclass.initComponent.call(this);this.addEvents({clear:true,trigger3:true});this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger2Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger3Class}]};},getTrigger:function(a){return this.triggers[a];},initTrigger:function(){var d=this.trigger.select(".x-form-trigger",true);var f=this;d.each(function(h,l,g){h.hide=function(){var m=f.wrap.getWidth();this.dom.style.display="none";f.el.setWidth(m-f.trigger.getWidth());};h.show=function(){var m=f.wrap.getWidth();this.dom.style.display="";f.el.setWidth(m-f.trigger.getWidth());};var j="Trigger"+(g+1);if(this["hide"+j]){h.dom.style.display="none";}h.on("click",this["on"+j+"Click"],this,{preventDefault:true});h.addClassOnOver("x-form-trigger-over");h.addClassOnClick("x-form-trigger-click");},this);this.triggers=d.elements;if(this.trigger3TipConfig){var a={target:this.getTrigger(2)};for(var b in this.helpTipConfig){a[b]=this.helpTipConfig[b];}var e=new Ext.ToolTip(a);}if(this.trigger3TipConfig){if(typeof this.trigger3TipConfig=="object"){Ext.QuickTips.register(Ext.apply({target:this.getTrigger(2)},this.trigger3TipConfig));}else{this.getTrigger(2).dom[this.tooltipType]=this.trigger3TipConfig;}}},onTrigger1Click:function(){this.clearValue();this.triggerBlur.defer(50,this);},onTrigger2Click:function(){this.onTriggerClick();},onTrigger3Click:function(){this.fireEvent("trigger3Click",this);},onSelect:function(a,b){Ext.ux.form.TwinTriggerComboBox.superclass.onSelect.apply(this,[a,b]);this.triggers[0].show();},clearValue:function(){Ext.ux.form.TwinTriggerComboBox.superclass.clearValue.call(this);this.triggers[0].hide();this.fireEvent("clear",this);},insert:function(a,b){this.reset();var d=new this.store.recordType(b);d.id=d.data.id;this.store.insert(a,d);this.setValue(d.data.id);this.fireEvent("select",this,d,a);}});Ext.reg("twintriggercombo",Ext.ux.form.TwinTriggerComboBox);
/*!
 * Ext Core Library $version&#xD;&#xA;http://extjs.com/&#xD;&#xA;Copyright(c) 2006-2009, $author.&#xD;&#xA;&#xD;&#xA;The MIT License&#xD;&#xA;&#xD;&#xA;Permission is hereby granted, free of charge, to any person obtaining a copy&#xD;&#xA;of this software and associated documentation files (the &quot;Software&quot;), to deal&#xD;&#xA;in the Software without restriction, including without limitation the rights&#xD;&#xA;to use, copy, modify, merge, publish, distribute, sublicense, and/or sell&#xD;&#xA;copies of the Software, and to permit persons to whom the Software is&#xD;&#xA;furnished to do so, subject to the following conditions:&#xD;&#xA;&#xD;&#xA;The above copyright notice and this permission notice shall be included in&#xD;&#xA;all copies or substantial portions of the Software.&#xD;&#xA;&#xD;&#xA;THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&#xD;&#xA;IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&#xD;&#xA;FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&#xD;&#xA;AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER&#xD;&#xA;LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,&#xD;&#xA;OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN&#xD;&#xA;THE SOFTWARE.&#xD;&#xA;
 */
Ext.ns("Ext.ux");Ext.ux.RatingItem=Ext.extend(Ext.Component,{starWidth:16,resetValue:"",defaultConfig:{defaultSelected:-1,nbStars:5,split:1,selected:-1,showTitles:true,cls:"",disabled:false},constructor:function(d,a){Ext.apply(this,a);Ext.applyIf(this,this.defaultConfig);Ext.ux.RatingItem.superclass.constructor.call(this);this.addEvents("change","reset");if(d==undefined){d=document.createElement("div");d.className=this.itemCls;this.text="";for(var b=0;b<(this.nbStars*this.split);b++){this.text+='<input type="radio" name="rating'+this.id+'" value="'+(b+1)/this.split+'" '+((b+1)/this.split==this.defaultSelected?' checked="true"':"")+'"/>';}d.innerHTML=this.text;}this.el=Ext.get(d);this.init();},onRender:function(){Ext.ux.RatingItem.superclass.onRender.apply(this,arguments);},init:function(){var a=this.disabled;this.values=[];this.titles=[];this.stars=[];this.container=this.el.createChild({cls:"ux-rating-container ux-rating-clearfix"+this.cls});if(this.canReset){this.resetEl=this.container.createChild({cls:"ux-rating-reset",cn:[{tag:"a",title:this.showTitles?(this.resetTitle||"Reset your vote"):"",html:"Reset"}]});this.resetEl.visibilityMode=Ext.Element.DISPLAY;this.resetEl.hover(function(){Ext.fly(this).addClass("ux-rating-reset-hover");},function(){Ext.fly(this).removeClass("ux-rating-reset-hover");});this.resetEl.on("click",this.reset,this);}this.radioBoxes=this.el.select("input[type=radio]");this.radioBoxes.each(this.initStar,this);this.input=this.container.createChild({tag:"input",type:"hidden",name:this.name,value:this.values[this.defaultSelected]||this.resetValue});this.radioBoxes.remove();this.select(this.defaultSelected===undefined?false:this.defaultSelected);if(a){this.disable();}else{this.enable();}},initStar:function(e,d,b){var a=Math.floor(this.starWidth/this.split);if(b==0){this.name=e.dom.name;this.disabled=e.dom.disabled;}this.values[b]=e.dom.value;this.titles[b]=e.dom.title;if(e.dom.checked){this.defaultSelected=b;}var h=this.container.createChild({cls:"ux-rating-star"});var g=h.createChild({tag:"a",html:this.values[b],title:this.showTitles?this.titles[b]:""});if(this.split){var f=(b%this.split);h.setWidth(a);g.setStyle("margin-left","-"+(f*a)+"px");}this.stars.push(h.dom);},onStarClick:function(b,a){if(!this.disabled){this.select(this.stars.indexOf(a));}},onStarOver:function(b,a){if(!this.disabled){this.fillTo(this.stars.indexOf(a),true);}},onStarOut:function(b,a){if(!this.disabled){this.fillTo(this.selected,false);}},reset:function(b,a){this.select(-1);},select:function(a){if(a===false||a===-1){this.value=this.resetValue;this.title="";this.input.dom.value="";if(this.canReset){this.resetEl.setOpacity(0.5);}this.fillNone();if(this.selected!==-1){this.fireEvent("change",this,this.values[a],this.stars[a]);}this.selected=-1;}else{if(a!==this.selected){this.selected=a;this.value=this.values[a];this.title=this.titles[a];this.input.dom.value=this.value;if(this.canReset){this.resetEl.setOpacity(0.99);}this.fillTo(a,false);this.fireEvent("change",this,this.values[a],this.stars[a]);}}},fillTo:function(a,b){if(a!=-1){var d=b?"ux-rating-star-hover":"ux-rating-star-on";var e=b?"ux-rating-star-on":"ux-rating-star-hover";Ext.each(this.stars.slice(0,a+1),function(){Ext.fly(this).removeClass(e).addClass(d);});Ext.each(this.stars.slice(a+1),function(){Ext.fly(this).removeClass([e,d]);});}else{this.fillNone();}},fillNone:function(){this.container.select(".ux-rating-star").removeClass(["ux-rating-star-hover","ux-rating-star-on"]);},enable:function(){if(this.canReset){this.resetEl.show();}this.input.dom.disabled=null;this.disabled=false;this.container.removeClass("ux-rating-disabled");this.container.on({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"});},disable:function(){if(this.canReset){this.resetEl.hide();}this.input.dom.disabled=true;this.disabled=true;this.container.addClass("ux-rating-disabled");this.container.un({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"});},getValue:function(){return this.values[this.selected]||this.resetValue;},destroy:function(){this.disable();
this.container.remove();this.radioBoxes.appendTo(this.el);if(this.selected!==-1){this.radioBoxes.elements[this.selected].checked=true;}}});Ext.reg("ratingitem",Ext.ux.RatingItem);Ext.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected");},onRender:function(d,a){Ext.form.FileUploadField.superclass.onRender.call(this,d,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1});var b=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:"x-form-file-btn"+(b.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth());}this.fileInput.on("change",function(){var e=this.fileInput.dom.value;this.setValue(e);this.fireEvent("fileselected",this,e);},this);},getFileInputId:function(){return this.id+"-file";},onResize:function(a,b){Ext.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a);}},preFocus:Ext.emptyFn,getResizeEl:function(){return this.wrap;},getPositionEl:function(){return this.wrap;},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0]);}});Ext.reg("fileuploadfield",Ext.form.FileUploadField);Ext.ns("Ext.ux.form");Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"input",type:"hidden"},timeWidth:100,dtSeparator:" ",hiddenFormat:"Y-m-d H:i:s",otherToNow:true,timePosition:"right",dateFormat:"m/d/y",timeFormat:"g:i A",initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);var b=Ext.apply({},{id:this.id+"-date",format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(b);this.df.ownerCt=this;delete (this.dateFormat);var a=Ext.apply({},{id:this.id+"-time",format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(a);this.tf.ownerCt=this;delete (this.timeFormat);this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);this.relayEvents(this.tf,["focus","specialkey","invalid","valid"]);},onRender:function(d,a){if(this.isRendered){return;}Ext.ux.form.DateTime.superclass.onRender.call(this,d,a);var b;if("below"===this.timePosition||"bellow"===this.timePosition){b=Ext.DomHelper.append(d,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",cls:"ux-datetime-time"}]}]},true);}else{b=Ext.DomHelper.append(d,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:4px",cls:"ux-datetime-date"},{tag:"td",cls:"ux-datetime-time"}]}]},true);}this.tableEl=b;this.wrap=b.wrap({cls:"x-form-field-wrap"});this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(b.child("td.ux-datetime-date"));this.tf.render(b.child("td.ux-datetime-time"));if(Ext.isIE&&Ext.isStrict){b.select("input").applyStyles({top:0});}this.on("specialkey",this.onSpecialKey,this);this.df.el.swallowEvent(["keydown","keypress"]);this.tf.el.swallowEvent(["keydown","keypress"]);if("side"===this.msgTarget){var e=this.el.findParent(".x-form-element",10,true);this.errorIcon=e.createChild({cls:"x-form-invalid-icon"});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon;}this.el.dom.name=this.hiddenName||this.name||this.id;this.df.el.dom.removeAttribute("name");this.tf.el.dom.removeAttribute("name");this.isRendered=true;this.updateHidden();},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0]);},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0);},clearInvalid:function(){this.df.clearInvalid();this.tf.clearInvalid();},markInvalid:function(a){this.df.markInvalid(a);this.tf.markInvalid(a);},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.df.destroy();this.tf.destroy();}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable();}this.disabled=true;this.df.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this;},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable();}this.disabled=false;this.df.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this;},focus:function(){this.df.focus();},getPositionEl:function(){return this.wrap;},getResizeEl:function(){return this.wrap;},getValue:function(){return this.dateValue?new Date(this.dateValue):"";},isValid:function(){return this.df.isValid()&&this.tf.isValid();},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible();},onBlur:function(a){if(this.wrapClick){a.focus();this.wrapClick=false;}if(a===this.df){this.updateDate();}else{this.updateTime();}this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var b=this.getValue();if(String(b)!==String(this.startValue)){this.fireEvent("change",this,b,this.startValue);}this.hasFocus=false;this.fireEvent("blur",this);}}).defer(100,this);},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this);}},onMouseDown:function(a){if(!this.disabled){this.wrapClick="td"===a.target.nodeName.toLowerCase();}},onSpecialKey:function(b,d){var a=d.getKey();if(a===d.TAB){if(b===this.df&&!d.shiftKey){d.stopEvent();this.tf.focus();}if(b===this.tf&&d.shiftKey){d.stopEvent();this.df.focus();}}if(a===d.ENTER){this.updateValue();}},setDate:function(a){this.df.setValue(a);},setTime:function(a){this.tf.setValue(a);},setSize:function(a,b){if(!a){return;}if("below"===this.timePosition){this.df.setSize(a,b);this.tf.setSize(a,b);if(Ext.isIE){this.df.el.up("td").setWidth(a);this.tf.el.up("td").setWidth(a);}}else{this.df.setSize(a-this.timeWidth-4,b);this.tf.setSize(this.timeWidth,b);if(Ext.isIE){this.df.el.up("td").setWidth(a-this.timeWidth-4);this.tf.el.up("td").setWidth(this.timeWidth);}}},setValue:function(d){if(!d&&true===this.emptyToNow){this.setValue(new Date());return;}else{if(!d){this.setDate("");this.setTime("");this.updateValue();return;}}if("number"===typeof d){d=new Date(d);}else{if("string"===typeof d&&this.hiddenFormat){d=Date.parseDate(d,this.hiddenFormat);}}d=d?d:new Date(1970,0,1,0,0,0);var a,b;if(d instanceof Date){this.setDate(d);this.setTime(d);this.dateValue=new Date(d);}else{a=d.split(this.dtSeparator);this.setDate(a[0]);if(a[1]){if(a[2]){a[1]+=a[2];}this.setTime(a[1]);}}this.updateValue();},setVisible:function(a){if(a){this.df.show();this.tf.show();}else{this.df.hide();this.tf.hide();}return this;},show:function(){return this.setVisible(true);},hide:function(){return this.setVisible(false);},updateDate:function(){var a=this.df.getValue();if(a){if(!(this.dateValue instanceof Date)){this.initDateValue();if(!this.tf.getValue()){this.setTime(this.dateValue);}}this.dateValue.setMonth(0);this.dateValue.setFullYear(a.getFullYear());this.dateValue.setMonth(a.getMonth(),a.getDate());}else{this.dateValue="";this.setTime("");}},updateTime:function(){var a=this.tf.getValue();if(a&&!(a instanceof Date)){a=Date.parseDate(a,this.tf.format);}if(a&&!this.df.getValue()){this.initDateValue();
this.setDate(this.dateValue);}if(this.dateValue instanceof Date){if(a){this.dateValue.setHours(a.getHours());this.dateValue.setMinutes(a.getMinutes());this.dateValue.setSeconds(a.getSeconds());}else{this.dateValue.setHours(0);this.dateValue.setMinutes(0);this.dateValue.setSeconds(0);}}},updateHidden:function(){if(this.isRendered){var a=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):"";this.el.dom.value=a;}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return;},validate:function(){return this.df.validate()&&this.tf.validate();},renderer:function(d){var b=d.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;b+=" "+(d.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);var a=function(f){var e=Ext.util.Format.date(f,b);return e;};return a;}});Ext.reg("xdatetime",Ext.ux.form.DateTime);
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl);}this.tpl.compile();}this.state={};this.bodyContent={};},getRowClass:function(a,f,e,d){e.cols=e.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,f);}if(b){e.body=b;}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed";},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this);},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this});}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this);}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav;}var a=this.grid.getView().mainBody;if(a){a.un("mousedown",this.onMouseDown,this);}},onRowDblClick:function(a,b,d){this.toggleRow(b);},onEnter:function(j){var h=this.grid;var l=h.getSelectionModel();var b=l.getSelections();for(var d=0,a=b.length;d<a;d++){var f=h.getStore().indexOf(b[d]);this.toggleRow(f);}},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data);}var d=this.bodyContent[a.id];if(!d){d=this.tpl.apply(a.data);this.bodyContent[a.id]=d;}return d;},onMouseDown:function(b,a){b.stopEvent();var d=b.getTarget(".x-grid3-row");this.toggleRow(d);},renderer:function(b,d,a){d.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>';},beforeExpand:function(b,a,d){if(this.fireEvent("beforeexpand",this,b,a,d)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,d);}return true;}else{return false;}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a);}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a);},expandRow:function(d){if(typeof d=="number"){d=this.grid.view.getRow(d);}var b=this.grid.store.getAt(d.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",d);if(this.beforeExpand(b,a,d.rowIndex)){this.state[b.id]=true;Ext.fly(d).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,d.rowIndex);}},collapseRow:function(d){if(typeof d=="number"){d=this.grid.view.getRow(d);}var b=this.grid.store.getAt(d.rowIndex);var a=Ext.fly(d).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,b,a,d.rowIndex)!==false){this.state[b.id]=false;Ext.fly(d).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,d.rowIndex);}}});Ext.preg("rowexpander",Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;Array.prototype.contains=function(a){return this.indexOf(a)!==-1;};Ext.namespace("Ext.ux");Ext.ux.DDView=function(b){if(!b.itemSelector){var a=b.tpl;if(this.classRe.test(a)){b.tpl=a.replace(this.classRe,"class=$1x-combo-list-item $2$1");}else{b.tpl=a.replace(this.tagRe,'$1 class="x-combo-list-item" $2');}b.itemSelector=".x-combo-list-item";}Ext.ux.DDView.superclass.constructor.call(this,Ext.apply(b,{border:false}));};Ext.extend(Ext.ux.DDView,Ext.DataView,{sortDir:"ASC",isFormField:true,classRe:/class=(['"])(.*)\1/,tagRe:/(<\w*)(.*?>)/,reset:Ext.emptyFn,clearInvalid:Ext.form.Field.prototype.clearInvalid,msgTarget:"qtip",afterRender:function(){Ext.ux.DDView.superclass.afterRender.call(this);if(this.dragGroup){this.setDraggable(this.dragGroup.split(","));}if(this.dropGroup){this.setDroppable(this.dropGroup.split(","));}if(this.deletable){this.setDeletable();}this.isDirtyFlag=false;this.addEvents("drop");},validate:function(){return true;},destroy:function(){this.purgeListeners();this.getEl().removeAllListeners();this.getEl().remove();if(this.dragZone){if(this.dragZone.destroy){this.dragZone.destroy();}}if(this.dropZone){if(this.dropZone.destroy){this.dropZone.destroy();}}},getName:function(){return this.name;},setValue:function(a){if(!this.store){throw"DDView.setValue(). DDView must be constructed with a valid Store";}var b={};b[this.store.reader.meta.root]=a?[].concat(a):[];this.store.proxy=new Ext.data.MemoryProxy(b);this.store.load();},getValue:function(){var a="(";this.store.each(function(b){a+=b.id+",";});return a.substr(0,a.length-1)+")";},getIds:function(){var b=0,a=new Array(this.store.getCount());this.store.each(function(d){a[b++]=d.id;});return a;},isDirty:function(){return this.isDirtyFlag;},getTargetFromEvent:function(b){var a=b.getTarget();while((a!==null)&&(a.parentNode!=this.el.dom)){a=a.parentNode;}if(!a){a=this.el.dom.lastChild||this.el.dom;}return a;},getDragData:function(f){var d=this.findItemFromChild(f.getTarget());if(d){if(!this.isSelected(d)){delete this.ignoreNextClick;this.onItemClick(d,this.indexOf(d),f);this.ignoreNextClick=true;}var b={sourceView:this,viewNodes:[],records:[],copy:this.copy||(this.allowCopy&&f.ctrlKey)};if(this.getSelectionCount()==1){var a=this.getSelectedIndexes()[0];var g=this.getNode(a);b.viewNodes.push(b.ddel=g);b.records.push(this.store.getAt(a));b.repairXY=Ext.fly(g).getXY();}else{b.ddel=document.createElement("div");b.ddel.className="multi-proxy";this.collectSelection(b);}return b;}return false;},getRepairXY:function(a){return this.dragData.repairXY;},collectSelection:function(b){b.repairXY=Ext.fly(this.getSelectedNodes()[0]).getXY();if(this.preserveSelectionOrder===true){Ext.each(this.getSelectedIndexes(),function(d){var f=this.getNode(d);var e=f.cloneNode(true);e.id=Ext.id();b.ddel.appendChild(e);b.records.push(this.store.getAt(d));b.viewNodes.push(f);},this);}else{var a=0;this.store.each(function(e){if(this.isSelected(a)){var f=this.getNode(a);var d=f.cloneNode(true);d.id=Ext.id();b.ddel.appendChild(d);b.records.push(this.store.getAt(a));b.viewNodes.push(f);}a++;},this);}},setDraggable:function(a){if(a instanceof Array){Ext.each(a,this.setDraggable,this);return;}if(this.dragZone){this.dragZone.addToGroup(a);}else{this.dragZone=new Ext.dd.DragZone(this.getEl(),{containerScroll:true,ddGroup:a});if(!this.multiSelect){this.singleSelect=true;}this.dragZone.getDragData=this.getDragData.createDelegate(this);this.dragZone.getRepairXY=this.getRepairXY;this.dragZone.onEndDrag=this.onEndDrag;}},setDroppable:function(a){if(a instanceof Array){Ext.each(a,this.setDroppable,this);return;}if(this.dropZone){this.dropZone.addToGroup(a);}else{this.dropZone=new Ext.dd.DropZone(this.getEl(),{owningView:this,containerScroll:true,ddGroup:a});this.dropZone.getTargetFromEvent=this.getTargetFromEvent.createDelegate(this);
this.dropZone.onNodeEnter=this.onNodeEnter.createDelegate(this);this.dropZone.onNodeOver=this.onNodeOver.createDelegate(this);this.dropZone.onNodeOut=this.onNodeOut.createDelegate(this);this.dropZone.onNodeDrop=this.onNodeDrop.createDelegate(this);}},getDropPoint:function(g,l,d){if(l==this.el.dom){return"above";}var f=Ext.lib.Dom.getY(l),a=f+l.offsetHeight;var j=f+(a-f)/2;var h=Ext.lib.Event.getPageY(g);if(h<=j){return"above";}else{return"below";}},isValidDropPoint:function(b,f,a){if(!a.viewNodes||(a.viewNodes.length!=1)){return true;}var e=a.viewNodes[0];if(e==f){return false;}if((b=="below")&&(f.nextSibling==e)){return false;}if((b=="above")&&(f.previousSibling==e)){return false;}return true;},onNodeEnter:function(f,a,d,b){if(this.highlightColor&&(b.sourceView!=this)){this.el.highlight(this.highlightColor);}return false;},onNodeOver:function(j,a,h,f){var b=this.dropNotAllowed;var g=this.getDropPoint(h,j,a);if(this.isValidDropPoint(g,j,f)){if(this.appendOnly||this.sortField){return"x-tree-drop-ok-below";}if(g){var d;if(g=="above"){b=j.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";d="x-view-drag-insert-above";}else{b=j.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";d="x-view-drag-insert-below";}if(this.lastInsertClass!=d){Ext.fly(j).replaceClass(this.lastInsertClass,d);this.lastInsertClass=d;}}}return b;},onNodeOut:function(f,a,d,b){this.removeDropIndicators(f);},onNodeDrop:function(d,m,j,g){if(this.fireEvent("drop",this,d,m,j,g)===false){return false;}var o=this.getDropPoint(j,d,m);var f=(this.appendOnly||(d==this.el.dom))?this.store.getCount():d.viewIndex;if(o=="below"){f++;}if(g.sourceView==this){if(o=="below"){if(g.viewNodes[0]==d){g.viewNodes.shift();}}else{if(g.viewNodes[g.viewNodes.length-1]==d){g.viewNodes.pop();}}if(!g.viewNodes.length){return false;}if(f>this.store.indexOf(g.records[0])){f--;}}if(g.node instanceof Ext.tree.TreeNode){var a=g.node.getOwnerTree().recordFromNode(g.node);if(a){g.records=[a];}}if(!g.records){alert("Programming problem. Drag data contained no Records");return false;}for(var h=0;h<g.records.length;h++){var a=g.records[h];var b=this.store.getById(a.id);if(b&&(m!=this.dragZone)){if(!this.allowDup&&!this.allowTrash){Ext.fly(this.getNode(this.store.indexOf(b))).frame("red",1);return true;}var l=new Ext.data.Record();a.id=l.id;delete l;}if(g.copy){this.store.insert(f++,a.copy());}else{if(g.sourceView){g.sourceView.isDirtyFlag=true;g.sourceView.store.remove(a);}if(!this.allowTrash){this.store.insert(f++,a);}}if(this.sortField){this.store.sort(this.sortField,this.sortDir);}this.isDirtyFlag=true;}this.dragZone.cachedTarget=null;return true;},onEndDrag:function(a,b){var f=Ext.get(this.dragData.ddel);if(f&&f.hasClass("multi-proxy")){f.remove();}},removeDropIndicators:function(a){if(a){Ext.fly(a).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass";}},setDeletable:function(a){if(!this.singleSelect&&!this.multiSelect){this.singleSelect=true;}var b=this.getContextMenu();this.contextMenu.on("itemclick",function(d){switch(d.id){case"delete":this.remove(this.getSelectedIndexes());break;}},this);this.contextMenu.add({icon:a||AU.resolveUrl("/images/delete.gif"),id:"delete",text:AU.getMessage("deleteItem")});},getContextMenu:function(){if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({id:this.id+"-contextmenu"});this.el.on("contextmenu",this.showContextMenu,this);}return this.contextMenu;},disableContextMenu:function(){if(this.contextMenu){this.el.un("contextmenu",this.showContextMenu,this);}},showContextMenu:function(b,a){a=this.findItemFromChild(b.getTarget());if(a){b.stopEvent();this.select(this.getNode(a),this.multiSelect&&b.ctrlKey,true);this.contextMenu.showAt(b.getXY());}},remove:function(b){b=[].concat(b);for(var a=0;a<b.length;a++){var d=this.store.getAt(b[a]);this.store.remove(d);}},onDblClick:function(g){var f=this.findItemFromChild(g.getTarget());if(f){if(this.fireEvent("dblclick",this,this.indexOf(f),f,g)===false){return false;}if(this.dragGroup){var a=Ext.dd.DragDropMgr.getRelated(this.dragZone,true);while(a.contains(this.dropZone)){a.remove(this.dropZone);}if((a.length==1)&&(a[0].owningView)){this.dragZone.cachedTarget=null;var b=Ext.get(a[0].getEl());var d=b.getBox(true);a[0].onNodeDrop(b.dom,{target:b.dom,xy:[d.x,d.y+d.height-1]},null,this.getDragData(g));}}}},onItemClick:function(b,a,d){if(this.ignoreNextClick){delete this.ignoreNextClick;return;}if(this.fireEvent("beforeclick",this,a,b,d)===false){return false;}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&d.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),a),false);}else{if(this.isSelected(b)&&d.ctrlKey){this.deselect(b);}else{this.deselect(b);this.select(b,this.multiSelect&&d.ctrlKey);this.lastSelection=b;}}d.preventDefault();}return true;}});Ext.ux.Multiselect=Ext.extend(Ext.form.Field,{store:null,dataFields:[],data:[],width:100,height:100,displayField:0,valueField:1,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",copy:false,allowDup:false,allowTrash:false,legend:null,focusClass:undefined,delimiter:",",view:null,dragGroup:null,dropGroup:null,tbar:null,appendOnly:false,sortField:null,sortDir:"ASC",defaultAutoCreate:{tag:"div"},tpl:null,initComponent:function(){Ext.ux.Multiselect.superclass.initComponent.call(this);this.addEvents({dblclick:true,click:true,change:true,drop:true});},onRender:function(f,b){var a,d,e;Ext.ux.Multiselect.superclass.onRender.call(this,f,b);d="ux-mselect";a=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:1px;",tbar:this.tbar});if(!this.legend){a.el.down("."+a.headerCls).remove();}a.body.addClass(d);if(!this.tpl){e='<tpl for="."><div class="'+d+"-item";if(Ext.isIE||Ext.isIE7){e+='" unselectable=on';}else{e+=' x-unselectable"';}e+=">{"+this.displayField+"}</div></tpl>";this.tpl=e;}if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data});}this.view=new Ext.ux.DDView({multiSelect:true,store:this.store,selectedClass:d+"-selected",tpl:this.tpl,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+d+"-item",isFormField:false,applyTo:a.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});a.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeClick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.view.on("drop",function(j,o,h,m,l){return this.fireEvent("drop",j,o,h,m,l);},this);this.hiddenName=this.name;var g={tag:"input",type:"hidden",value:"",name:this.name};if(this.isFormField){this.hiddenField=this.el.createChild(g);}else{this.hiddenField=Ext.get(document.body).createChild(g);}a.doLayout();},initValue:Ext.emptyFn,onViewClick:function(f,b,d,g){var a=this.preClickSelections.indexOf(b);if(a!=-1){this.preClickSelections.splice(a,1);this.view.clearSelections(true);this.view.select(this.preClickSelections);}this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,g);this.validate();},onViewBeforeClick:function(d,a,b,f){this.preClickSelections=this.view.getSelectedIndexes();if(this.disabled){return false;}},onViewDblClick:function(d,a,b,f){return this.fireEvent("dblclick",d,a,b,f);},getValue:function(a){var e=[];var d=this.view.getSelectedIndexes();if(d.length==0){return"";}for(var b=0;b<d.length;b++){e.push(this.store.getAt(d[b]).get(((a!=null)?a:this.valueField)));}return e.join(this.delimiter);},setValue:function(a){var b;var e=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!a||(a=="")){return;}if(!(a instanceof Array)){a=a.split(this.delimiter);}for(var d=0;
d<a.length;d++){b=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+a[d]+"$","i")).itemAt(0));e.push(b);}this.view.select(e);this.hiddenField.dom.value=this.getValue();this.validate();},selectAll:function(){var b=[];for(var a=0;a<this.view.store.getCount();a++){b.push(a);}this.view.select(b);this.hiddenField.dom.value=this.getValue();this.validate();},reset:function(){this.setValue("");},getRawValue:function(a){var b=this.getValue(a);if(b.length){b=b.split(this.delimiter);}else{b=[];}return b;},setRawValue:function(a){setValue(a);},validateValue:function(a){if(a.length<1){if(this.allowBlank){this.clearInvalid();return true;}else{this.markInvalid(this.blankText);return false;}}if(a.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false;}if(a.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false;}return true;}});Ext.reg("multiselect",Ext.ux.Multiselect);Ext.ux.ItemSelector=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,fromAllowDup:false,toAllowDup:false,fromAllowTrash:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},fromTpl:null,toTpl:null,initComponent:function(){Ext.ux.ItemSelector.superclass.initComponent.call(this);this.addEvents({rowdblclick:true,change:true});},onRender:function(e,a){Ext.ux.ItemSelector.superclass.onRender.call(this,e,a);this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.fromAllowDup,copy:this.fromAllowDup,allowTrash:this.fromAllowTrash,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir,tpl:this.fromTpl});this.fromMultiselect.on("dblclick",this.onRowDblClick,this);if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData});}this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.toAllowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.fromSortField,sortDir:this.fromSortDir,tpl:this.toTpl});this.toMultiselect.on("dblclick",this.onRowDblClick,this);var h=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});h.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);var d=new Ext.Panel({header:false});h.add(d);h.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);h.render(this.el);d.el.down("."+d.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/";}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var g=d.getEl();if(!this.toSortField){this.toTopIcon=g.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});g.createChild({tag:"br"});this.upIcon=g.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});g.createChild({tag:"br"});}this.addIcon=g.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});g.createChild({tag:"br"});this.removeIcon=g.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});g.createChild({tag:"br"});if(!this.toSortField){this.downIcon=g.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});g.createChild({tag:"br"});this.toBottomIcon=g.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}});}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this);}this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this);}if((!this.drawUpIcon||this.hideNavIcons)&&this.upIcon){this.upIcon.dom.style.display="none";}if((!this.drawDownIcon||this.hideNavIcons)&&this.downIcon){this.downIcon.dom.style.display="none";}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none";}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none";}if((!this.drawTopIcon||this.hideNavIcons)&&this.toTopIcon){this.toTopIcon.dom.style.display="none";}if((!this.drawBotIcon||this.hideNavIcons)&&this.toBottomIcon){this.toBottomIcon.dom.style.display="none";}var b=h.body.first();this.el.setWidth(h.body.first().getWidth());h.body.removeClass();this.hiddenName=this.name;var f={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(f);this.valueChanged(this.toStore);},initValue:Ext.emptyFn,toTop:function(){var d=this.toMultiselect.view.getSelectedIndexes();var a=[];if(d.length>0){d.sort();for(var b=0;b<d.length;b++){record=this.toMultiselect.view.store.getAt(d[b]);a.push(record);}d=[];for(var b=a.length-1;b>-1;b--){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);d.push(((a.length-1)-b));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d);},toBottom:function(){var d=this.toMultiselect.view.getSelectedIndexes();var a=[];if(d.length>0){d.sort();for(var b=0;b<d.length;b++){record=this.toMultiselect.view.store.getAt(d[b]);a.push(record);}d=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);d.push((this.toMultiselect.view.store.getCount())-(a.length-b));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d);},up:function(){var a=null;var d=this.toMultiselect.view.getSelectedIndexes();d.sort();var e=[];if(d.length>0){for(var b=0;b<d.length;b++){a=this.toMultiselect.view.store.getAt(d[b]);if((d[b]-1)>=0){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(d[b]-1,a);e.push(d[b]-1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(e);}},down:function(){var a=null;var d=this.toMultiselect.view.getSelectedIndexes();d.sort();d.reverse();var e=[];if(d.length>0){for(var b=0;b<d.length;b++){a=this.toMultiselect.view.store.getAt(d[b]);if((d[b]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(d[b]+1,a);e.push(d[b]+1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(e);}},fromTo:function(){var e=this.fromMultiselect.view.getSelectedIndexes();var b=[];if(e.length>0){for(var d=0;d<e.length;d++){record=this.fromMultiselect.view.store.getAt(e[d]);
b.push(record);}if(!this.toAllowDup){e=[];}for(var d=0;d<b.length;d++){record=b[d];if(this.toAllowDup){var a=new Ext.data.Record();record.id=a.id;delete a;this.toMultiselect.view.store.add(record);}else{if(this.fromAllowTrash){this.fromMultiselect.view.store.remove(record);}this.toMultiselect.view.store.add(record);e.push((this.toMultiselect.view.store.getCount()-1));}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir);}if(this.toAllowDup){this.fromMultiselect.view.select(e);}else{this.toMultiselect.view.select(e);}},toFrom:function(){var d=this.toMultiselect.view.getSelectedIndexes();var a=[];if(d.length>0){for(var b=0;b<d.length;b++){record=this.toMultiselect.view.store.getAt(d[b]);a.push(record);}d=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);if(!this.fromAllowDup){this.fromMultiselect.view.store.add(record);d.push((this.fromMultiselect.view.store.getCount()-1));}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir);}this.fromMultiselect.view.select(d);},valueChanged:function(d){var a=null;var b=[];for(var e=0;e<d.getCount();e++){a=d.getAt(e);b.push(a.get(this.valueField));}this.hiddenField.dom.value=b.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);},getValue:function(){return this.hiddenField.dom.value;},onRowDblClick:function(d,a,b,f){return this.fireEvent("rowdblclick",d,a,b,f);},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();if(!this.fromAllowDup){this.fromMultiselect.store.add(range);this.fromMultiselect.store.sort(this.displayField,"ASC");}this.valueChanged(this.toMultiselect.store);}});Ext.reg("itemselector",Ext.ux.ItemSelector);
/*!
 * Ext Core Library $version&#xD;&#xA;http://extjs.com/&#xD;&#xA;Copyright(c) 2006-2009, $author.&#xD;&#xA;&#xD;&#xA;The MIT License&#xD;&#xA;&#xD;&#xA;Permission is hereby granted, free of charge, to any person obtaining a copy&#xD;&#xA;of this software and associated documentation files (the &quot;Software&quot;), to deal&#xD;&#xA;in the Software without restriction, including without limitation the rights&#xD;&#xA;to use, copy, modify, merge, publish, distribute, sublicense, and/or sell&#xD;&#xA;copies of the Software, and to permit persons to whom the Software is&#xD;&#xA;furnished to do so, subject to the following conditions:&#xD;&#xA;&#xD;&#xA;The above copyright notice and this permission notice shall be included in&#xD;&#xA;all copies or substantial portions of the Software.&#xD;&#xA;&#xD;&#xA;THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&#xD;&#xA;IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&#xD;&#xA;FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&#xD;&#xA;AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER&#xD;&#xA;LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,&#xD;&#xA;OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN&#xD;&#xA;THE SOFTWARE.&#xD;&#xA;
 */
Ext.ns("Ext.ux");Ext.ux.Lightbox=(function(){var d={},a=[],e,f=false,b=[];return{overlayOpacity:0.85,animate:true,resizeSpeed:8,borderSize:10,labelImage:"Image",labelOf:"of",init:function(){this.resizeDuration=this.animate?((11-this.resizeSpeed)*0.15):0;this.overlayDuration=this.animate?0.2:0;if(!f){Ext.apply(this,Ext.util.Observable.prototype);Ext.util.Observable.constructor.call(this);this.addEvents("open","close");this.initMarkup();this.initEvents();f=true;}},initMarkup:function(){d.shim=Ext.DomHelper.append(document.body,{tag:"iframe",id:"ux-lightbox-shim"},true);d.overlay=Ext.DomHelper.append(document.body,{id:"ux-lightbox-overlay"},true);var h=new Ext.Template(this.getTemplate());d.lightbox=h.append(document.body,{},true);var j=["outerImageContainer","imageContainer","image","hoverNav","navPrev","navNext","loading","loadingLink","outerDataContainer","dataContainer","data","details","caption","imageNumber","bottomNav","navClose"];Ext.each(j,function(l){d[l]=Ext.get("ux-lightbox-"+l);});Ext.each([d.overlay,d.lightbox,d.shim],function(l){l.setVisibilityMode(Ext.Element.DISPLAY);l.hide();});var g=(this.animate?250:1)+"px";d.outerImageContainer.setStyle({width:g,height:g});},getTemplate:function(){return['<div id="ux-lightbox">','<div id="ux-lightbox-outerImageContainer">','<div id="ux-lightbox-imageContainer">','<img id="ux-lightbox-image">','<div id="ux-lightbox-hoverNav">','<a href="#" id="ux-lightbox-navPrev"></a>','<a href="#" id="ux-lightbox-navNext"></a>',"</div>",'<div id="ux-lightbox-loading">','<a id="ux-lightbox-loadingLink"></a>',"</div>","</div>","</div>",'<div id="ux-lightbox-outerDataContainer">','<div id="ux-lightbox-dataContainer">','<div id="ux-lightbox-data">','<div id="ux-lightbox-details">','<span id="ux-lightbox-caption"></span>','<span id="ux-lightbox-imageNumber"></span>',"</div>",'<div id="ux-lightbox-bottomNav">','<a href="#" id="ux-lightbox-navClose"></a>',"</div>","</div>","</div>","</div>","</div>"];},initEvents:function(){var g=function(h){h.preventDefault();this.close();};d.overlay.on("click",g,this);d.loadingLink.on("click",g,this);d.navClose.on("click",g,this);d.lightbox.on("click",function(h){if(h.getTarget().id=="ux-lightbox"){this.close();}},this);d.navPrev.on("click",function(h){h.preventDefault();this.setImage(e-1);},this);d.navNext.on("click",function(h){h.preventDefault();this.setImage(e+1);},this);},register:function(g,h){if(b.indexOf(g)===-1){b.push(g);Ext.fly(document).on("click",function(j){var l=j.getTarget(g);if(l){j.preventDefault();this.open(l,g,h);}},this);}},open:function(j,g,h){h=h||false;this.setViewSize();d.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,callback:function(){a=[];var l=0;if(!h){a.push([j.href,j.title]);}else{var m=Ext.query(g);Ext.each(m,function(s){if(s.href){a.push([s.href,s.title]);}});while(a[l][0]!=j.href){l++;}}var q=Ext.fly(document).getScroll();var r=q.top+(Ext.lib.Dom.getViewportHeight()/10);var o=q.left;d.lightbox.setStyle({top:r+"px",left:o+"px"}).show();this.setImage(l);this.fireEvent("open",a[l]);},scope:this});},setViewSize:function(){var h=this.getViewSize(),g=this.getDocumentSize();d.overlay.setStyle({width:g[0]+"px",height:g[1]+"px"});d.shim.setStyle({width:h[0]+"px",height:h[1]+"px"}).show();},setImage:function(h){e=h;this.disableKeyNav();if(this.animate){d.loading.show();}d.image.hide();d.hoverNav.hide();d.navPrev.hide();d.navNext.hide();d.dataContainer.setOpacity(0.0001);d.imageNumber.hide();var g=new Image();g.onload=(function(){d.image.dom.src=a[e][0];this.resizeImage(g.width,g.height);}).createDelegate(this);g.src=a[e][0];},resizeImage:function(r,j){var t=d.outerImageContainer.getWidth();var o=d.outerImageContainer.getHeight();var m=(r+this.borderSize*2);var l=(j+this.borderSize*2);var q=t-m;var g=o-l;var s=function(){d.hoverNav.setWidth(d.imageContainer.getWidth()+"px");d.navPrev.setHeight(j+"px");d.navNext.setHeight(j+"px");d.outerDataContainer.setWidth(m+"px");this.showImage();};if(g!=0||q!=0){d.outerImageContainer.shift({height:l,width:m,duration:this.resizeDuration,scope:this,callback:s,delay:50});}else{s.call(this);}},showImage:function(){d.loading.hide();d.image.fadeIn({duration:this.resizeDuration,scope:this,callback:function(){this.updateDetails();}});this.preloadImages();},updateDetails:function(){var g=d.data.getWidth(true)-d.navClose.getWidth()-10;d.details.setWidth((g>0?g:0)+"px");d.caption.update(a[e][1]);d.caption.show();if(a.length>1){d.imageNumber.update(this.labelImage+" "+(e+1)+" "+this.labelOf+"  "+a.length);d.imageNumber.show();}d.dataContainer.fadeIn({duration:this.resizeDuration/2,scope:this,callback:function(){var h=this.getDocumentSize();d.overlay.setHeight(h[1]+"px");this.updateNav();}});},updateNav:function(){this.enableKeyNav();
d.hoverNav.show();if(e>0){d.navPrev.show();}if(e<(a.length-1)){d.navNext.show();}},enableKeyNav:function(){Ext.fly(document).on("keydown",this.keyNavAction,this);},disableKeyNav:function(){Ext.fly(document).un("keydown",this.keyNavAction,this);},keyNavAction:function(g){var h=g.getKey();if(h==88||h==67||h==27){this.close();}else{if(h==80||h==37){if(e!=0){this.setImage(e-1);}}else{if(h==78||h==39){if(e!=(a.length-1)){this.setImage(e+1);}}}}},preloadImages:function(){var g,h;if(a.length>e+1){g=new Image();g.src=a[e+1][0];}if(e>0){h=new Image();h.src=a[e-1][0];}},close:function(){this.disableKeyNav();d.lightbox.hide();d.overlay.fadeOut({duration:this.overlayDuration});d.shim.hide();this.fireEvent("close",e);},getViewSize:function(){return[Ext.lib.Dom.getViewWidth(),Ext.lib.Dom.getViewHeight()];},getDocumentSize:function(){return[Ext.lib.Dom.getDocumentWidth(),Ext.lib.Dom.getDocumentHeight()];}};})();Ext.onReady(Ext.ux.Lightbox.init,Ext.ux.Lightbox);Ext.namespace("Ext.ux.form");Ext.ux.form.SuperBoxSelect=function(a){Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,a);this.addEvents("beforeadditem","additem","newitem","beforeremoveitem","removeitem","clear");};Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.form.ComboBox,{addNewDataOnBlur:false,allowAddNewData:false,allowQueryAll:true,backspaceDeletesLastItem:true,classField:null,clearBtnCls:"",clearLastQueryOnEscape:false,clearOnEscape:false,displayFieldTpl:null,extraItemCls:"",extraItemStyle:"",expandBtnCls:"",fixFocusOnTabSelect:true,forceFormValue:true,forceSameValueQuery:false,itemDelimiterKey:Ext.EventObject.ENTER,navigateItemsWithTab:true,pinList:true,preventDuplicates:true,queryFilterRe:"",queryValuesDelimiter:"|",queryValuesIndicator:"valuesqry",removeValuesFromStore:true,renderFieldBtns:true,stackItems:false,styleField:null,supressClearValueRemoveEvents:false,validationEvent:"blur",valueDelimiter:",",initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(false),usedRecords:new Ext.util.MixedCollection(false),addedRecords:[],remoteLookup:[],hideTrigger:true,grow:false,resizable:false,multiSelectMode:false,preRenderValue:null,filteredQueryData:""});if(this.queryFilterRe){if(Ext.isString(this.queryFilterRe)){this.queryFilterRe=new RegExp(this.queryFilterRe);}}if(this.transform){this.doTransform();}if(this.forceFormValue){this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this});}Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this);if(this.mode==="remote"&&this.store){this.store.on("load",this.onStoreLoad,this);}},onRender:function(b,a){var d=this.hiddenName;this.hiddenName=null;Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,b,a);this.hiddenName=d;this.manageNameAttribute();var e=(this.stackItems===true)?"x-superboxselect-stacked":"";if(this.renderFieldBtns){e+=" x-superboxselect-display-btns";}this.el.removeClass("x-form-text").addClass("x-superboxselect-input-field");this.wrapEl=this.el.wrap({tag:"ul"});this.outerWrapEl=this.wrapEl.wrap({tag:"div",cls:"x-form-text x-superboxselect "+e});this.inputEl=this.el.wrap({tag:"li",cls:"x-superboxselect-input"});if(this.renderFieldBtns){this.setupFieldButtons().manageClearBtn();}this.setupFormInterception();},doTransform:function(){var r=Ext.getDom(this.transform),g=[];if(!this.store){this.mode="local";var j=[],a=r.options;for(var f=0,h=a.length;f<h;f++){var e=a[f],q=Ext.get(e),l=q.getAttributeNS(null,"value")||"",m=q.getAttributeNS(null,"className")||"",b=q.getAttributeNS(null,"style")||"";if(e.selected){g.push(l);}j.push([l,e.text,m,typeof(b)==="string"?b:b.cssText]);}this.store=new Ext.data.SimpleStore({id:0,fields:["value","text","cls","style"],data:j});Ext.apply(this,{valueField:"value",displayField:"text",classField:"cls",styleField:"style"});}if(g.length){this.value=g.join(",");}},setupFieldButtons:function(){this.buttonWrap=this.outerWrapEl.createChild({cls:"x-superboxselect-btns"});this.buttonClear=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-clear "+this.clearBtnCls});if(this.allowQueryAll){this.buttonExpand=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-expand "+this.expandBtnCls});}this.initButtonEvents();return this;},initButtonEvents:function(){this.buttonClear.addClassOnOver("x-superboxselect-btn-over").on("click",function(a){a.stopEvent();if(this.disabled){return;}this.clearValue();this.el.focus();},this);if(this.allowQueryAll){this.buttonExpand.addClassOnOver("x-superboxselect-btn-over").on("click",function(a){a.stopEvent();if(this.disabled){return;}if(this.isExpanded()){this.multiSelectMode=false;}else{if(this.pinList){this.multiSelectMode=true;}}this.onTriggerClick();},this);}},removeButtonEvents:function(){this.buttonClear.removeAllListeners();if(this.allowQueryAll){this.buttonExpand.removeAllListeners();}return this;},clearCurrentFocus:function(){if(this.currentFocus){this.currentFocus.onLnkBlur();this.currentFocus=null;}return this;},initEvents:function(){var a=this.el;a.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this});this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this});this.wrapEl.on("click",this.onWrapClick,this);this.outerWrapEl.on("click",this.onWrapClick,this);this.inputEl.focus=function(){a.focus();};Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this);Ext.apply(this.keyNav,{tab:function(b){if(this.fixFocusOnTabSelect&&this.isExpanded()){b.stopEvent();a.blur();this.onViewClick(false);this.focus(false,10);return true;}this.onViewClick(false);if(a.dom.value!==""){this.setRawValue("");}return true;},down:function(b){if(!this.isExpanded()&&!this.currentFocus){if(this.allowQueryAll){this.onTriggerClick();}}else{this.inKeyMode=true;this.selectNext();}},enter:function(){}});},onClick:function(){this.clearCurrentFocus();this.collapse();this.autoSize();},beforeBlur:function(){if(this.allowAddNewData&&this.addNewDataOnBlur){var a=this.el.dom.value;if(a!==""){this.fireNewItemEvent(a);}}Ext.form.ComboBox.superclass.beforeBlur.call(this);},onFocus:function(){this.outerWrapEl.addClass(this.focusClass);Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this);},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass);this.clearCurrentFocus();if(this.el.dom.value!==""){this.applyEmptyText();this.autoSize();}Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this);},onCollapse:function(){this.view.clearSelections();this.multiSelectMode=false;},onWrapClick:function(a){a.stopEvent();this.collapse();this.el.focus();this.clearCurrentFocus();},markInvalid:function(d){var b,a;if(!this.rendered||this.preventMark){return;}this.outerWrapEl.addClass(this.invalidClass);d=d||this.invalidText;switch(this.msgTarget){case"qtip":Ext.apply(this.el.dom,{qtip:d,qclass:"x-form-invalid-tip"});Ext.apply(this.wrapEl.dom,{qtip:d,qclass:"x-form-invalid-tip"});if(Ext.QuickTips){Ext.QuickTips.enable();}break;case"title":this.el.dom.title=d;this.wrapEl.dom.title=d;this.outerWrapEl.dom.title=d;break;case"under":if(!this.errorEl){b=this.getErrorCt();if(!b){this.el.dom.title=d;break;}this.errorEl=b.createChild({cls:"x-form-invalid-msg"});this.errorEl.setWidth(b.getWidth(true)-20);}this.errorEl.update(d);Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);break;case"side":if(!this.errorIcon){b=this.getErrorCt();if(!b){this.el.dom.title=d;break;}this.errorIcon=b.createChild({cls:"x-form-invalid-icon"});}this.alignErrorIcon();Ext.apply(this.errorIcon.dom,{qtip:d,qclass:"x-form-invalid-tip"});this.errorIcon.show();this.on("resize",this.alignErrorIcon,this);break;default:a=Ext.getDom(this.msgTarget);a.innerHTML=d;a.style.display=this.msgDisplay;break;}this.fireEvent("invalid",this,d);},clearInvalid:function(){if(!this.rendered||this.preventMark){return;}this.outerWrapEl.removeClass(this.invalidClass);switch(this.msgTarget){case"qtip":this.el.dom.qtip="";this.wrapEl.dom.qtip="";break;
case"title":this.el.dom.title="";this.wrapEl.dom.title="";this.outerWrapEl.dom.title="";break;case"under":if(this.errorEl){Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this);}break;case"side":if(this.errorIcon){this.errorIcon.dom.qtip="";this.errorIcon.hide();this.un("resize",this.alignErrorIcon,this);}break;default:var a=Ext.getDom(this.msgTarget);a.innerHTML="";a.style.display="none";break;}this.fireEvent("valid",this);},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[Ext.isIE?5:2,3]);}},expand:function(){if(this.isExpanded()||!this.hasFocus){return;}if(this.bufferSize){this.doResize(this.bufferSize);delete this.bufferSize;}this.list.alignTo(this.outerWrapEl,this.listAlign).show();this.innerList.setOverflow("auto");this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent("expand",this);},restrictHeight:function(){var b=this.innerList.dom,d=b.scrollTop,g=this.list;b.style.height="";var j=g.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,e=Math.max(b.clientHeight,b.offsetHeight,b.scrollHeight),a=this.getPosition()[1]-Ext.getBody().getScroll().top,l=Ext.lib.Dom.getViewHeight()-a-this.getSize().height,f=Math.max(a,l,this.minHeight||0)-g.shadowOffset-j-5;e=Math.min(e,f,this.maxHeight);this.innerList.setHeight(e);g.beginUpdate();g.setHeight(e+j);g.alignTo(this.outerWrapEl,this.listAlign);g.endUpdate();if(this.multiSelectMode){b.scrollTop=d;}},validateValue:function(a){if(this.items.getCount()===0){if(this.allowBlank){this.clearInvalid();return true;}else{this.markInvalid(this.blankText);return false;}}this.clearInvalid();return true;},manageNameAttribute:function(){if(this.items.getCount()===0&&this.forceFormValue){this.el.dom.setAttribute("name",this.hiddenName||this.name);}else{this.el.dom.removeAttribute("name");}},setupFormInterception:function(){var a;this.findParentBy(function(d){if(d.getForm){a=d.getForm();}});if(a){var b=a.getValues;a.getValues=function(e){this.el.dom.disabled=true;var d=this.el.dom.value;this.setRawValue("");var f=b.call(a);this.el.dom.disabled=false;this.setRawValue(d);if(this.forceFormValue&&this.items.getCount()===0){f[this.name]="";}return e?Ext.urlEncode(f):f;}.createDelegate(this);}},onResize:function(a,d,f,b){var e=Ext.isIE6?4:Ext.isIE7?1:Ext.isIE8?1:0;if(this.wrapEl){this._width=a;this.outerWrapEl.setWidth(a-e);if(this.renderFieldBtns){e+=(this.buttonWrap.getWidth()+20);this.wrapEl.setWidth(a-e);}}Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,a,d,f,b);this.autoSize();},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this);this.items.each(function(a){a.enable();});if(this.renderFieldBtns){this.initButtonEvents();}},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this);this.items.each(function(a){a.disable();});if(this.renderFieldBtns){this.removeButtonEvents();}},clearValue:function(a){Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this);this.preventMultipleRemoveEvents=a||this.supressClearValueRemoveEvents||false;this.removeAllItems();this.preventMultipleRemoveEvents=false;this.fireEvent("clear",this);return this;},fireNewItemEvent:function(a){this.view.clearSelections();this.collapse();this.setRawValue("");if(this.queryFilterRe){a=a.replace(this.queryFilterRe,"");if(!a){return;}}this.fireEvent("newitem",this,a,this.filteredQueryData);},onKeyUp:function(a){if(this.editable!==false&&(!a.isSpecialKey()||a.getKey()===a.BACKSPACE)&&this.itemDelimiterKey.indexOf!==a.getKey()&&(!a.hasModifier()||a.shiftKey)){this.lastKey=a.getKey();this.dqTask.delay(this.queryDelay);}},onKeyDownHandler:function(h,d){var b,l,a;if(h.getKey()===h.ESC){if(!this.isExpanded()){if(this.el.dom.value!=""&&(this.clearOnEscape||this.clearLastQueryOnEscape)){if(this.clearOnEscape){this.el.dom.value="";}if(this.clearLastQueryOnEscape){this.lastQuery="";}h.stopEvent();}}}if((h.getKey()===h.DELETE||h.getKey()===h.SPACE)&&this.currentFocus){h.stopEvent();b=this.currentFocus;this.on("expand",function(){this.collapse();},this,{single:true});a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){l=this.items.itemAt(a+1);}b.preDestroy(true);if(l){(function(){l.onLnkFocus();this.currentFocus=l;}).defer(200,this);}return true;}var j=this.el.dom.value,f,g=h.ctrlKey;if(this.itemDelimiterKey===h.getKey()){h.stopEvent();if(j!==""){if(g||!this.isExpanded()){this.fireNewItemEvent(j);}else{this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this);}}}else{if(!this.isExpanded()){return;}this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this);}}return true;}if(j!==""){this.autoSize();return;}if(h.getKey()===h.HOME){h.stopEvent();if(this.items.getCount()>0){this.collapse();f=this.items.get(0);f.el.focus();}return true;}if(h.getKey()===h.BACKSPACE){h.stopEvent();if(this.currentFocus){b=this.currentFocus;this.on("expand",function(){this.collapse();},this,{single:true});a=this.items.indexOfKey(b.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){l=this.items.itemAt(a+1);}b.preDestroy(true);if(l){(function(){l.onLnkFocus();this.currentFocus=l;}).defer(200,this);}return;}else{f=this.items.get(this.items.getCount()-1);if(f){if(this.backspaceDeletesLastItem){this.on("expand",function(){this.collapse();},this,{single:true});f.preDestroy(true);}else{if(this.navigateItemsWithTab){f.onElClick();}else{this.on("expand",function(){this.collapse();this.currentFocus=f;this.currentFocus.onLnkFocus.defer(20,this.currentFocus);},this,{single:true});}}}return true;}}if(!h.isNavKeyPress()){this.multiSelectMode=false;this.clearCurrentFocus();return;}if(h.getKey()===h.LEFT||(h.getKey()===h.UP&&!this.isExpanded())){h.stopEvent();this.collapse();f=this.items.get(this.items.getCount()-1);if(this.navigateItemsWithTab){if(f){f.focus();}}else{if(this.currentFocus){a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a!==0){this.currentFocus=this.items.itemAt(a-1);this.currentFocus.onLnkFocus();}}else{this.currentFocus=f;if(f){f.onLnkFocus();}}}return true;}if(h.getKey()===h.DOWN){if(this.currentFocus){this.collapse();h.stopEvent();a=this.items.indexOfKey(this.currentFocus.key);if(a==(this.items.getCount()-1)){this.clearCurrentFocus.defer(10,this);}else{this.clearCurrentFocus();this.currentFocus=this.items.itemAt(a+1);if(this.currentFocus){this.currentFocus.onLnkFocus();}}return true;}}if(h.getKey()===h.RIGHT){this.collapse();f=this.items.itemAt(0);if(this.navigateItemsWithTab){if(f){f.focus();}}else{if(this.currentFocus){a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){this.currentFocus=this.items.itemAt(a+1);if(this.currentFocus){this.currentFocus.onLnkFocus();}}}else{this.currentFocus=f;if(f){f.onLnkFocus();}}}}},onKeyUpBuffered:function(a){if(!a.isNavKeyPress()){this.autoSize();}},reset:function(){this.killItems();Ext.ux.form.SuperBoxSelect.superclass.reset.call(this);this.addedRecords=[];this.autoSize().setRawValue("");},applyEmptyText:function(){this.setRawValue("");if(this.items.getCount()>0){this.el.removeClass(this.emptyClass);this.setRawValue("");return this;}if(this.rendered&&this.emptyText&&this.getRawValue().length<1){this.setRawValue(this.emptyText);this.el.addClass(this.emptyClass);}return this;},removeAllItems:function(){this.items.each(function(a){a.preDestroy(true);},this);this.manageClearBtn();return this;},killItems:function(){this.items.each(function(a){a.kill();},this);this.resetStore();this.items.clear();this.manageClearBtn();return this;},resetStore:function(){this.store.clearFilter();if(!this.removeValuesFromStore){return this;}this.usedRecords.each(function(a){this.store.add(a);},this);this.usedRecords.clear();if(!this.store.remoteSort){this.store.sort(this.displayField,"ASC");}return this;},sortStore:function(){var a=this.store.getSortState();if(a&&a.field){this.store.sort(a.field,a.direction);
}return this;},getCaption:function(d){if(typeof this.displayFieldTpl==="string"){this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl);}var b,a=d instanceof Ext.data.Record?d.data:d;if(this.displayFieldTpl){b=this.displayFieldTpl.apply(a);}else{if(this.displayField){b=a[this.displayField];}}return b;},addRecord:function(b){var f=b.data[this.displayField],d=this.getCaption(b),g=b.data[this.valueField],a=this.classField?b.data[this.classField]:"",e=this.styleField?b.data[this.styleField]:"";if(this.removeValuesFromStore){this.usedRecords.add(g,b);this.store.remove(b);}this.addItemBox(g,f,d,a,e);this.fireEvent("additem",this,g,b);},createRecord:function(a){if(!this.recordConstructor){var b=[{name:this.valueField},{name:this.displayField}];if(this.classField){b.push({name:this.classField});}if(this.styleField){b.push({name:this.styleField});}this.recordConstructor=Ext.data.Record.create(b);}return new this.recordConstructor(a);},addItems:function(a){if(Ext.isArray(a)){Ext.each(a,function(b){this.addItem(b);},this);}else{this.addItem(a);}},addNewItem:function(a){this.addItem(a,true);},addItem:function(a,d){var f=a[this.valueField];if(this.disabled){return false;}if(this.preventDuplicates&&this.hasValue(f)){return;}var b=this.findRecord(this.valueField,f);if(b){this.addRecord(b);return;}else{if(!this.allowAddNewData){return;}}if(this.mode==="remote"){this.remoteLookup.push(a);this.doQuery(f,false,false,d);return;}var e=this.createRecord(a);this.store.add(e);this.addRecord(e);return true;},addItemBox:function(d,f,l,j,e){var g,h=function(o){var m="";switch(typeof o){case"function":m=o.call();break;case"object":for(var q in o){m+=q+":"+o[q]+";";}break;case"string":m=o+";";}return m;},a=Ext.id(null,"sbx-item"),b=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+" "+j,style:h(this.extraItemStyle)+" "+e,caption:l,display:f,value:d,key:a,listeners:{remove:function(m){if(this.fireEvent("beforeremoveitem",this,m.value)===false){return false;}this.items.removeKey(m.key);if(this.removeValuesFromStore){if(this.usedRecords.containsKey(m.value)){this.store.add(this.usedRecords.get(m.value));this.usedRecords.removeKey(m.value);this.sortStore();if(this.view){this.view.render();}}}if(!this.preventMultipleRemoveEvents){this.fireEvent.defer(250,this,["removeitem",this,m.value,this.findInStore(m.value)]);}},destroy:function(){this.collapse();this.autoSize().manageClearBtn().validateValue();},scope:this}});b.render();g={tag:"input",type:"hidden",value:d,name:(this.hiddenName||this.name)};if(this.disabled){Ext.apply(g,{disabled:"disabled"});}b.hidden=this.el.insertSibling(g,"before");this.items.add(a,b);this.applyEmptyText().autoSize().manageClearBtn().validateValue();},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered){return this;}var a="x-superboxselect-btn-hide";if(this.items.getCount()===0){this.buttonClear.addClass(a);}else{this.buttonClear.removeClass(a);}return this;},findInStore:function(b){var a=this.store.find(this.valueField,b);if(a>-1){return this.store.getAt(a);}return false;},getSelectedRecords:function(){var a=[];if(this.removeValuesFromStore){a=this.usedRecords.getRange();}else{var b=[];this.items.each(function(d){b.push(d.value);});Ext.each(b,function(d){a.push(this.findInStore(d));},this);}return a;},findSelectedItem:function(b){var a;this.items.each(function(d){if(d.el.dom===b){a=d;return false;}});return a;},findSelectedRecord:function(b){var a,d=this.findSelectedItem(b);if(d){a=this.findSelectedRecordByValue(d.value);}return a;},findSelectedRecordByValue:function(b){var a;if(this.removeValuesFromStore){this.usedRecords.each(function(d){if(d.get(this.valueField)==b){a=d;return false;}},this);}else{a=this.findInStore(b);}return a;},getValue:function(){var a=[];this.items.each(function(b){a.push(b.value);});return a.join(this.valueDelimiter);},getCount:function(){return this.items.getCount();},getValueEx:function(){var a=[];this.items.each(function(d){var b={};b[this.valueField]=d.value;b[this.displayField]=d.display;if(this.classField){b[this.classField]=d.cls||"";}if(this.styleField){b[this.styleField]=d.style||"";}a.push(b);},this);return a;},initValue:function(){if(Ext.isObject(this.value)||Ext.isArray(this.value)){this.setValueEx(this.value);this.originalValue=this.getValue();}else{Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this);}if(this.mode==="remote"){this.setOriginal=true;}},addValue:function(d){if(Ext.isEmpty(d)){return;}var a=d;if(!Ext.isArray(d)){d=""+d;a=d.split(this.valueDelimiter);}Ext.each(a,function(f){var e=this.findRecord(this.valueField,f);if(e){this.addRecord(e);}else{if(this.mode==="remote"){this.remoteLookup.push(f);}}},this);if(this.mode==="remote"){var b=this.remoteLookup.join(this.queryValuesDelimiter);this.doQuery(b,false,true);}},setValue:function(a){if(!this.rendered){this.value=a;return;}this.removeAllItems().resetStore();this.remoteLookup=[];this.addValue(a);},setValueEx:function(a){if(!this.rendered){this.value=a;return;}this.removeAllItems().resetStore();if(!Ext.isArray(a)){a=[a];}this.remoteLookup=[];if(this.allowAddNewData&&this.mode==="remote"){Ext.each(a,function(e){var b=this.findRecord(this.valueField,e[this.valueField])||this.createRecord(e);this.addRecord(b);},this);return;}Ext.each(a,function(b){this.addItem(b);},this);},hasValue:function(b){var a=false;this.items.each(function(d){if(d.value==b){a=true;return false;}},this);return a;},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){var d=a.data[this.valueField];if(this.preventDuplicates&&this.hasValue(d)){return;}this.setRawValue("");this.lastSelectionText="";if(this.fireEvent("beforeadditem",this,d,a,this.filteredQueryData)!==false){this.addRecord(a);}if(this.store.getCount()===0||!this.multiSelectMode){this.collapse();}else{this.restrictHeight();}}},onDestroy:function(){this.items.purgeListeners();this.killItems();if(this.allowQueryAll){Ext.destroy(this.buttonExpand);}if(this.renderFieldBtns){Ext.destroy(this.buttonClear,this.buttonWrap);}Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl);Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this);},autoSize:function(){if(!this.rendered){return this;}if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el);}var e=this.el,b=e.dom.value,f=document.createElement("div");if(b===""&&this.emptyText&&this.items.getCount()<1){b=this.emptyText;}f.appendChild(document.createTextNode(b));b=f.innerHTML;f=null;b+="&#160;";var a=Math.max(this.metrics.getWidth(b)+24,24);if(typeof this._width!="undefined"){a=Math.min(this._width,a);}this.el.setWidth(a);if(Ext.isIE){this.el.dom.style.top="0";}this.fireEvent("autosize",this,a);return this;},shouldQuery:function(b){if(this.lastQuery){var a=b.match("^"+this.lastQuery);if(!a||this.store.getCount()){return true;}else{return(a[0]!==this.lastQuery);}}return true;},doQuery:function(g,f,b,e){g=Ext.isEmpty(g)?"":g;if(this.queryFilterRe){this.filteredQueryData="";var a=g.match(this.queryFilterRe);if(a&&a.length){this.filteredQueryData=a[0];}g=g.replace(this.queryFilterRe,"");if(!g&&a){return;}}var d={query:g,forceAll:f,combo:this,cancel:false};if(this.fireEvent("beforequery",d)===false||d.cancel){return false;}g=d.query;f=d.forceAll;if(f===true||(g.length>=this.minChars)||b&&!Ext.isEmpty(g)){if(e||this.forceSameValueQuery||this.shouldQuery(g)){this.lastQuery=g;if(this.mode=="local"){this.selectedIndex=-1;if(f){this.store.clearFilter();}else{this.store.filter(this.displayField,g);}this.onLoad();}else{this.store.baseParams[this.queryParam]=g;this.store.baseParams[this.queryValuesIndicator]=b;this.store.load({params:this.getParams(g)});if(!e){this.expand();}}}else{this.selectedIndex=-1;this.onLoad();}}},onStoreLoad:function(b,a,d){var g=d.params[this.queryParam]||b.baseParams[this.queryParam]||"",h=d.params[this.queryValuesIndicator]||b.baseParams[this.queryValuesIndicator];if(this.removeValuesFromStore){this.store.each(function(l){if(this.usedRecords.containsKey(l.get(this.valueField))){this.store.remove(l);
}},this);}if(h){var j=g.split(this.queryValuesDelimiter);Ext.each(j,function(l){this.remoteLookup.remove(l);var m=this.findRecord(this.valueField,l);if(m){this.addRecord(m);}},this);if(this.setOriginal){this.setOriginal=false;this.originalValue=this.getValue();}}if(g!==""&&this.allowAddNewData){Ext.each(this.remoteLookup,function(l){if(typeof l==="object"&&l[this.valueField]===g){this.remoteLookup.remove(l);if(a.length&&a[0].get(this.valueField)===g){this.addRecord(a[0]);return;}var m=this.createRecord(l);this.store.add(m);this.addRecord(m);this.addedRecords.push(m);(function(){if(this.isExpanded()){this.collapse();}}).defer(10,this);return;}},this);}var e=[];if(g===""){Ext.each(this.addedRecords,function(l){if(this.preventDuplicates&&this.usedRecords.containsKey(l.get(this.valueField))){return;}e.push(l);},this);}else{var f=new RegExp(Ext.escapeRe(g)+".*","i");Ext.each(this.addedRecords,function(l){if(this.preventDuplicates&&this.usedRecords.containsKey(l.get(this.valueField))){return;}if(f.test(l.get(this.displayField))){e.push(l);}},this);}this.store.add(e);this.sortStore();if(this.store.getCount()===0&&this.isExpanded()){this.collapse();}}});Ext.reg("superboxselect",Ext.ux.form.SuperBoxSelect);Ext.ux.form.SuperBoxSelectItem=function(a){Ext.apply(this,a);Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this);};Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this);},onElClick:function(b){var d=this.owner;d.clearCurrentFocus().collapse();if(d.navigateItemsWithTab){this.focus();}else{d.el.dom.focus();var a=this;(function(){this.onLnkFocus();d.currentFocus=this;}).defer(10,this);}},onLnkClick:function(a){if(a){a.stopEvent();}this.preDestroy();if(!this.owner.navigateItemsWithTab){this.owner.el.focus();}},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus");this.owner.outerWrapEl.addClass("x-form-focus");},onLnkBlur:function(){this.el.removeClass("x-superboxselect-item-focus");this.owner.outerWrapEl.removeClass("x-form-focus");},enableElListeners:function(){this.el.on("click",this.onElClick,this,{stopEvent:true});this.el.addClassOnOver("x-superboxselect-item x-superboxselect-item-hover");},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this});},enableAllListeners:function(){this.enableElListeners();this.enableLnkListeners();},disableAllListeners:function(){this.el.removeAllListeners();this.lnk.un("click",this.onLnkClick,this);this.lnk.un("focus",this.onLnkFocus,this);this.lnk.un("blur",this.onLnkBlur,this);},onRender:function(d,a){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,d,a);var f=this.el;if(f){f.remove();}this.el=f=d.createChild({tag:"li"},d.last());f.addClass("x-superboxselect-item");var e=this.owner.navigateItemsWithTab?(Ext.isSafari?"button":"a"):"span";var g=this.key;Ext.apply(f,{focus:function(){var h=this.down(e+".x-superboxselect-item-close");if(h){h.focus();}},preDestroy:function(){this.preDestroy();}.createDelegate(this)});this.enableElListeners();f.update(this.caption);var b={tag:e,"class":"x-superboxselect-item-close",tabIndex:this.owner.navigateItemsWithTab?"0":"-1"};if(e==="a"){b.href="#";}this.lnk=f.createChild(b);if(!this.disabled){this.enableLnkListeners();}else{this.disableAllListeners();}this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this});this.setupKeyMap();},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus("right");},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus("left");},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var a=this.owner.items.get(0).el.focus();if(a){a.el.focus();}},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus();},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]);this.keyMap.stopEvent=true;},moveFocus:function(a){var b=this.el[a=="left"?"prev":"next"]()||this.owner.el;b.focus.defer(100,b);},preDestroy:function(a){if(this.fireEvent("remove",this)===false){return;}var b=function(){if(this.owner.navigateItemsWithTab){this.moveFocus("right");}this.hidden.remove();this.hidden=null;this.destroy();};if(a){b.call(this);}else{this.el.hide({duration:0.2,callback:b,scope:this});}return this;},kill:function(){this.hidden.remove();this.hidden=null;this.purgeListeners();this.destroy();},onDisable:function(){if(this.hidden){this.hidden.dom.setAttribute("disabled","disabled");}this.keyMap.disable();Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this);},onEnable:function(){if(this.hidden){this.hidden.dom.removeAttribute("disabled");}this.keyMap.enable();Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this);},onDestroy:function(){Ext.destroy(this.lnk,this.el);Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this);}});Proj4js={defaultDatum:"WGS84",transform:function(e,b,a){if(!e.readyToUse||!b.readyToUse){this.reportError("Proj4js initialization for "+e.srsCode+" not yet complete");return a;}if((e.srsProjNumber=="900913"&&b.datumCode!="WGS84")||(b.srsProjNumber=="900913"&&e.datumCode!="WGS84")){var d=Proj4js.WGS84;this.transform(e,d,a);e=d;}if(e.projName=="longlat"){a.x*=Proj4js.common.D2R;a.y*=Proj4js.common.D2R;}else{if(e.to_meter){a.x*=e.to_meter;a.y*=e.to_meter;}e.inverse(a);}if(e.from_greenwich){a.x+=e.from_greenwich;}a=this.datum_transform(e.datum,b.datum,a);if(b.from_greenwich){a.x-=b.from_greenwich;}if(b.projName=="longlat"){a.x*=Proj4js.common.R2D;a.y*=Proj4js.common.R2D;}else{b.forward(a);if(b.to_meter){a.x/=b.to_meter;a.y/=b.to_meter;}}return a;},datum_transform:function(d,b,a){if(d.compare_datums(b)){return a;}if(d.datum_type==Proj4js.common.PJD_NODATUM||b.datum_type==Proj4js.common.PJD_NODATUM){return a;}if(d.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.");}if(b.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.");}if(d.es!=b.es||d.a!=b.a||d.datum_type==Proj4js.common.PJD_3PARAM||d.datum_type==Proj4js.common.PJD_7PARAM||b.datum_type==Proj4js.common.PJD_3PARAM||b.datum_type==Proj4js.common.PJD_7PARAM){d.geodetic_to_geocentric(a);if(d.datum_type==Proj4js.common.PJD_3PARAM||d.datum_type==Proj4js.common.PJD_7PARAM){d.geocentric_to_wgs84(a);}if(b.datum_type==Proj4js.common.PJD_3PARAM||b.datum_type==Proj4js.common.PJD_7PARAM){b.geocentric_from_wgs84(a);}b.geocentric_to_geodetic(a);}if(b.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.");}return a;},reportError:function(a){},extend:function(a,e){a=a||{};if(e){for(var d in e){var b=e[d];if(b!==undefined){a[d]=b;}}}return a;},Class:function(){var b=function(){this.initialize.apply(this,arguments);};var a={};var e;for(var d=0;d<arguments.length;++d){if(typeof arguments[d]=="function"){e=arguments[d].prototype;}else{e=arguments[d];}Proj4js.extend(a,e);}b.prototype=a;return b;},bind:function(d,b){var a=Array.prototype.slice.apply(arguments,[2]);return function(){var e=a.concat(Array.prototype.slice.apply(arguments,[0]));return d.apply(b,e);};},scriptName:"proj4js.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath){return this.libPath;}var f=this.scriptName;var e=f.length;var a=document.getElementsByTagName("script");for(var d=0;d<a.length;d++){var g=a[d].getAttribute("src");if(g){var b=g.lastIndexOf(f);if((b>-1)&&(b+e==g.length)){this.libPath=g.slice(0,-e);break;}}}return this.libPath||"";},loadScript:function(e,f,d,a){var b=document.createElement("script");b.defer=false;b.type="text/javascript";b.id=e;b.src=e;b.onload=f;b.onerror=d;b.loadCheck=a;if(/MSIE/.test(navigator.userAgent)){b.onreadystatechange=this.checkReadyState;
}document.getElementsByTagName("head")[0].appendChild(b);},checkReadyState:function(){if(this.readyState=="loaded"){if(!this.loadCheck()){this.onerror();}else{this.onload();}}}};Proj4js.Proj=Proj4js.Class({readyToUse:false,title:null,projName:null,units:null,datum:null,initialize:function(d){this.srsCodeInput=d;if(d.indexOf("urn:")==0){var a=d.split(":");if((a[1]=="ogc"||a[1]=="x-ogc")&&(a[2]=="def")&&(a[3]=="crs")&&a.length==7){d=a[4]+":"+a[6];}}else{if(d.indexOf("http://")==0){var b=d.split("#");if(b[0].match(/epsg.org/)){d="EPSG:"+b[1];}else{if(b[0].match(/RIG.xml/)){d="IGNF:"+b[1];}}}}this.srsCode=d.toUpperCase();if(this.srsCode.indexOf("EPSG")==0){this.srsCode=this.srsCode;this.srsAuth="epsg";this.srsProjNumber=this.srsCode.substring(5);}else{if(this.srsCode.indexOf("IGNF")==0){this.srsCode=this.srsCode;this.srsAuth="IGNF";this.srsProjNumber=this.srsCode.substring(5);}else{if(this.srsCode.indexOf("CRS")==0){this.srsCode=this.srsCode;this.srsAuth="CRS";this.srsProjNumber=this.srsCode.substring(4);}else{this.srsAuth="";this.srsProjNumber=this.srsCode;}}}this.loadProjDefinition();},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode]){this.defsLoaded();return;}var a=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(a,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this));},loadFromService:function(){var a=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js";Proj4js.loadScript(a,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this));},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName);},checkDefsLoaded:function(){if(Proj4js.defs[this.srsCode]){return true;}else{return false;}},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);Proj4js.extend(Proj4js.defs[this.srsCode],Proj4js.defs.WGS84);this.defsLoaded();},loadProjCode:function(b){if(Proj4js.Proj[b]){this.initTransforms();return;}var a=Proj4js.getScriptLocation()+"projCode/"+b+".js";Proj4js.loadScript(a,Proj4js.bind(this.loadProjCodeSuccess,this,b),Proj4js.bind(this.loadProjCodeFailure,this,b),Proj4js.bind(this.checkCodeLoaded,this,b));},loadProjCodeSuccess:function(a){if(Proj4js.Proj[a].dependsOn){this.loadProjCode(Proj4js.Proj[a].dependsOn);}else{this.initTransforms();}},loadProjCodeFailure:function(a){Proj4js.reportError("failed to find projection file for: "+a);},checkCodeLoaded:function(a){if(Proj4js.Proj[a]){return true;}else{return false;}},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=true;},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var e,b;var a=this.defData.split("+");for(var f=0;f<a.length;f++){var d=a[f].split("=");e=d[0].toLowerCase();b=d[1];switch(e.replace(/\s/gi,"")){case"":break;case"title":this.title=b;break;case"proj":this.projName=b.replace(/\s/gi,"");break;case"units":this.units=b.replace(/\s/gi,"");break;case"datum":this.datumCode=b.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=b.replace(/\s/gi,"");break;case"ellps":this.ellps=b.replace(/\s/gi,"");break;case"a":this.a=parseFloat(b);break;case"b":this.b=parseFloat(b);break;case"rf":this.rf=parseFloat(b);break;case"lat_0":this.lat0=b*Proj4js.common.D2R;break;case"lat_1":this.lat1=b*Proj4js.common.D2R;break;case"lat_2":this.lat2=b*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=b*Proj4js.common.D2R;break;case"lon_0":this.long0=b*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(b)*Proj4js.common.D2R;break;case"lonc":this.longc=b*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(b);break;case"y_0":this.y0=parseFloat(b);break;case"k_0":this.k0=parseFloat(b);break;case"k":this.k0=parseFloat(b);break;case"R_A":this.R=true;break;case"zone":this.zone=parseInt(b);break;case"south":this.utmSouth=true;break;case"towgs84":this.datum_params=b.split(",");break;case"to_meter":this.to_meter=parseFloat(b);break;case"from_greenwich":this.from_greenwich=b*Proj4js.common.D2R;break;case"pm":b=b.replace(/\s/gi,"");this.from_greenwich=Proj4js.PrimeMeridian[b]?Proj4js.PrimeMeridian[b]:parseFloat(b);this.from_greenwich*=Proj4js.common.D2R;break;case"no_defs":break;default:}}this.deriveConstants();},deriveConstants:function(){if(this.nagrids=="@null"){this.datumCode="none";}if(this.datumCode&&this.datumCode!="none"){var a=Proj4js.Datum[this.datumCode];if(a){this.datum_params=a.towgs84.split(",");this.ellps=a.ellipse;this.datumName=a.datumName?a.datumName:this.datumCode;}}if(!this.a){var b=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,b);}if(this.rf&&!this.b){this.b=(1-1/this.rf)*this.a;}if(Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=true;this.b=this.a;}this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);if(this.R_A){this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.RA4+this.es*Proj4js.RA6));this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=0;}this.ep2=(this.a2-this.b2)/this.b2;if(!this.k0){this.k0=1;}this.datum=new Proj4js.datum(this);}});Proj4js.Proj.longlat={init:function(){},forward:function(a){return a;},inverse:function(a){return a;}};Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:900913":"+title= Google Mercator EPSG:900913 +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:900913"];Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:0.7853981633974483,R2D:57.29577951308232,D2R:0.017453292519943295,SEC_TO_RAD:0.00000484813681109536,EPSLN:1e-10,MAX_ITER:20,COS_67P5:0.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:0.16666666666666666,RA4:0.04722222222222222,RA6:0.022156084656084655,RV4:0.06944444444444445,RV6:0.04243827160493827,msfnz:function(d,b,e){var a=d*b;return e/(Math.sqrt(1-a*a));},tsfnz:function(f,e,d){var a=f*d;var b=0.5*f;a=Math.pow(((1-a)/(1+a)),b);return(Math.tan(0.5*(this.HALF_PI-e))/a);},phi2z:function(g,f){var e=0.5*g;var a,b;var d=this.HALF_PI-2*Math.atan(f);for(i=0;i<=15;i++){a=g*Math.sin(d);b=this.HALF_PI-2*Math.atan(f*(Math.pow(((1-a)/(1+a)),e)))-d;d+=b;if(Math.abs(b)<=1e-10){return d;}}alert("phi2z has NoConvergence");return(-9999);},qsfnz:function(d,b,e){var a;if(d>1e-7){a=d*b;return((1-d*d)*(b/(1-a*a)-(0.5/d)*Math.log((1-a)/(1+a))));}else{return(2*b);}},asinz:function(a){if(Math.abs(a)>1){a=(a>1)?1:-1;}return Math.asin(a);},e0fn:function(a){return(1-0.25*a*(1+a/16*(3+1.25*a)));},e1fn:function(a){return(0.375*a*(1+0.25*a*(1+0.46875*a)));},e2fn:function(a){return(0.05859375*a*a*(1+0.75*a));},e3fn:function(a){return(a*a*a*(35/3072));},mlfn:function(f,e,d,b,a){return(f*a-e*Math.sin(2*a)+d*Math.sin(4*a)-b*Math.sin(6*a));},srat:function(a,b){return(Math.pow((1-a)/(1+a),b));},sign:function(a){if(a<0){return(-1);}else{return(1);}},adjust_lon:function(a){a=(Math.abs(a)<this.PI)?a:(a-(this.sign(a)*this.TWO_PI));return a;},adjust_lat:function(a){a=(Math.abs(a)<this.HALF_PI)?a:(a-(this.sign(a)*this.PI));return a;},latiso:function(e,d,b){if(Math.abs(d)>this.HALF_PI){return +Number.NaN;}if(d==this.HALF_PI){return Number.POSITIVE_INFINITY;}if(d==-1*this.HALF_PI){return -1*Number.POSITIVE_INFINITY;}var a=e*b;return Math.log(Math.tan((this.HALF_PI+d)/2))+e*Math.log((1-a)/(1+a))/2;},fL:function(b,a){return 2*Math.atan(b*Math.exp(a))-this.HALF_PI;},invlatiso:function(f,d){var b=this.fL(1,d);var e=0;var a=0;
do{e=b;a=f*Math.sin(e);b=this.fL(Math.exp(f*Math.log((1+a)/(1-a))/2),d);}while(Math.abs(b-e)>1e-12);return b;},sinh:function(a){var b=Math.exp(a);b=(b-1/b)/2;return b;},cosh:function(a){var b=Math.exp(a);b=(b+1/b)/2;return b;},tanh:function(a){var b=Math.exp(a);b=(b-1/b)/(b+1/b);return b;},asinh:function(a){var b=(a>=0?1:-1);return b*(Math.log(Math.abs(a)+Math.sqrt(a*a+1)));},acosh:function(a){return 2*Math.log(Math.sqrt((a+1)/2)+Math.sqrt((a-1)/2));},atanh:function(a){return Math.log((a-1)/(a+1))/2;},gN:function(b,g,f){var d=g*f;return b/Math.sqrt(1-d*d);}};Proj4js.datum=Proj4js.Class({initialize:function(b){this.datum_type=Proj4js.common.PJD_WGS84;if(b.datumCode&&b.datumCode=="none"){this.datum_type=Proj4js.common.PJD_NODATUM;}if(b&&b.datum_params){for(var a=0;a<b.datum_params.length;a++){b.datum_params[a]=parseFloat(b.datum_params[a]);}if(b.datum_params[0]!=0||b.datum_params[1]!=0||b.datum_params[2]!=0){this.datum_type=Proj4js.common.PJD_3PARAM;}if(b.datum_params.length>3){if(b.datum_params[3]!=0||b.datum_params[4]!=0||b.datum_params[5]!=0||b.datum_params[6]!=0){this.datum_type=Proj4js.common.PJD_7PARAM;b.datum_params[3]*=Proj4js.common.SEC_TO_RAD;b.datum_params[4]*=Proj4js.common.SEC_TO_RAD;b.datum_params[5]*=Proj4js.common.SEC_TO_RAD;b.datum_params[6]=(b.datum_params[6]/1000000)+1;}}}if(b){this.a=b.a;this.b=b.b;this.es=b.es;this.ep2=b.ep2;this.datum_params=b.datum_params;}},compare_datums:function(a){if(this.datum_type!=a.datum_type){return false;}else{if(this.a!=a.a||Math.abs(this.es-a.es)>5e-11){return false;}else{if(this.datum_type==Proj4js.common.PJD_3PARAM){return(this.datum_params[0]==a.datum_params[0]&&this.datum_params[1]==a.datum_params[1]&&this.datum_params[2]==a.datum_params[2]);}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){return(this.datum_params[0]==a.datum_params[0]&&this.datum_params[1]==a.datum_params[1]&&this.datum_params[2]==a.datum_params[2]&&this.datum_params[3]==a.datum_params[3]&&this.datum_params[4]==a.datum_params[4]&&this.datum_params[5]==a.datum_params[5]&&this.datum_params[6]==a.datum_params[6]);}else{if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT){return strcmp(pj_param(this.params,"snadgrids").s,pj_param(a.params,"snadgrids").s)==0;}else{return true;}}}}}},geodetic_to_geocentric:function(d){var q=d.x;var j=d.y;var e=d.z?d.z:0;var f;var b;var a;var m=0;var o;var l;var h;var g;if(j<-Proj4js.common.HALF_PI&&j>-1.001*Proj4js.common.HALF_PI){j=-Proj4js.common.HALF_PI;}else{if(j>Proj4js.common.HALF_PI&&j<1.001*Proj4js.common.HALF_PI){j=Proj4js.common.HALF_PI;}else{if((j<-Proj4js.common.HALF_PI)||(j>Proj4js.common.HALF_PI)){Proj4js.reportError("geocent:lat out of range:"+j);return null;}}}if(q>Proj4js.common.PI){q-=(2*Proj4js.common.PI);}l=Math.sin(j);g=Math.cos(j);h=l*l;o=this.a/(Math.sqrt(1-this.es*h));f=(o+e)*g*Math.cos(q);b=(o+e)*g*Math.sin(q);a=((o*(1-this.es))+e)*l;d.x=f;d.y=b;d.z=a;return m;},geocentric_to_geodetic:function(z){var F=1e-12;var B=(F*F);var g=30;var q;var j;var a;var s;var b;var r;var o;var E;var D;var m;var v;var u;var f;var C;var h=z.x;var e=z.y;var d=z.z?z.z:0;var l;var w;var t;f=false;q=Math.sqrt(h*h+e*e);j=Math.sqrt(h*h+e*e+d*d);if(q/this.a<F){f=true;l=0;if(j/this.a<F){w=Proj4js.common.HALF_PI;t=-this.b;return;}}else{l=Math.atan2(e,h);}a=d/j;s=q/j;b=1/Math.sqrt(1-this.es*(2-this.es)*s*s);E=s*(1-this.es)*b;D=a*b;C=0;do{C++;o=this.a/Math.sqrt(1-this.es*D*D);t=q*E+d*D-o*(1-this.es*D*D);r=this.es*o/(o+t);b=1/Math.sqrt(1-r*(2-r)*s*s);m=s*(1-r)*b;v=a*b;u=v*E-m*D;E=m;D=v;}while(u*u>B&&C<g);w=Math.atan(v/Math.abs(m));z.x=l;z.y=w;z.z=t;return z;},geocentric_to_geodetic_noniter:function(w){var e=w.x;var d=w.y;var a=w.z?w.z:0;var h;var v;var q;var f;var s;var u;var r;var m;var j;var l;var C;var g;var B;var z;var t;var o;var b;e=parseFloat(e);d=parseFloat(d);a=parseFloat(a);b=false;if(e!=0){h=Math.atan2(d,e);}else{if(d>0){h=Proj4js.common.HALF_PI;}else{if(d<0){h=-Proj4js.common.HALF_PI;}else{b=true;h=0;if(a>0){v=Proj4js.common.HALF_PI;}else{if(a<0){v=-Proj4js.common.HALF_PI;}else{v=Proj4js.common.HALF_PI;q=-this.b;return;}}}}}s=e*e+d*d;f=Math.sqrt(s);u=a*Proj4js.common.AD_C;m=Math.sqrt(u*u+s);l=u/m;g=f/m;C=l*l*l;r=a+this.b*this.ep2*C;o=f-this.a*this.es*g*g*g;j=Math.sqrt(r*r+o*o);B=r/j;z=o/j;t=this.a/Math.sqrt(1-this.es*B*B);if(z>=Proj4js.common.COS_67P5){q=f/z-t;}else{if(z<=-Proj4js.common.COS_67P5){q=f/-z-t;}else{q=a/B+t*(this.es-1);}}if(b==false){v=Math.atan(B/z);}w.x=h;w.y=v;w.z=q;return w;},geocentric_to_wgs84:function(b){if(this.datum_type==Proj4js.common.PJD_3PARAM){b.x+=this.datum_params[0];b.y+=this.datum_params[1];b.z+=this.datum_params[2];}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var g=this.datum_params[0];var e=this.datum_params[1];var l=this.datum_params[2];var f=this.datum_params[3];var m=this.datum_params[4];var j=this.datum_params[5];var h=this.datum_params[6];var d=h*(b.x-j*b.y+m*b.z)+g;var a=h*(j*b.x+b.y-f*b.z)+e;var o=h*(-m*b.x+f*b.y+b.z)+l;b.x=d;b.y=a;b.z=o;}}},geocentric_from_wgs84:function(d){if(this.datum_type==Proj4js.common.PJD_3PARAM){d.x-=this.datum_params[0];d.y-=this.datum_params[1];d.z-=this.datum_params[2];}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var h=this.datum_params[0];var e=this.datum_params[1];var m=this.datum_params[2];var g=this.datum_params[3];var o=this.datum_params[4];var l=this.datum_params[5];var j=this.datum_params[6];var f=(d.x-h)/j;var b=(d.y-e)/j;var a=(d.z-m)/j;d.x=f+l*b-o*a;d.y=-l*f+b+g*a;d.z=o*f-g*b+a;}}}});Proj4js.Point=Proj4js.Class({initialize:function(a,e,d){if(typeof a=="object"){this.x=a[0];this.y=a[1];this.z=a[2]||0;}else{if(typeof a=="string"){var b=a.split(",");this.x=parseFloat(b[0]);this.y=parseFloat(b[1]);this.z=parseFloat(b[2])||0;}else{this.x=a;this.y=e;this.z=d||0;}}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z);},toString:function(){return("x="+this.x+",y="+this.y);},toShortString:function(){return(this.x+", "+this.y);}});Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};
Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};Proj4js.WGS84=new Proj4js.Proj("WGS84");Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("aeaInitEqualLatitudes");return;}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e3=Math.sqrt(this.es);this.sin_po=Math.sin(this.lat1);this.cos_po=Math.cos(this.lat1);this.t1=this.sin_po;this.con=this.sin_po;this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat2);this.cos_po=Math.cos(this.lat2);this.t2=this.sin_po;this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat0);this.cos_po=Math.cos(this.lat0);this.t3=this.sin_po;this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1);}else{this.ns0=this.con;}this.c=this.ms1*this.ms1+this.ns0*this.qs1;this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0;},forward:function(f){var g=f.x;var e=f.y;this.sin_phi=Math.sin(e);this.cos_phi=Math.cos(e);var b=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi);var j=this.a*Math.sqrt(this.c-this.ns0*b)/this.ns0;var d=this.ns0*Proj4js.common.adjust_lon(g-this.long0);var a=j*Math.sin(d)+this.x0;var h=this.rh-j*Math.cos(d)+this.y0;f.x=a;f.y=h;return f;},inverse:function(f){var h,a,b,d,g,e;f.x-=this.x0;f.y=this.rh-f.y+this.y0;if(this.ns0>=0){h=Math.sqrt(f.x*f.x+f.y*f.y);b=1;}else{h=-Math.sqrt(f.x*f.x+f.y*f.y);b=-1;}d=0;if(h!=0){d=Math.atan2(b*f.x,b*f.y);}b=h*this.ns0/this.a;a=(this.c-b*b)/this.ns0;if(this.e3>=1e-10){b=1-0.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3;if(Math.abs(Math.abs(b)-Math.abs(a))>1e-10){e=this.phi1z(this.e3,a);}else{if(a>=0){e=0.5*PI;}else{e=-0.5*PI;}}}else{e=this.phi1z(e3,a);}g=Proj4js.common.adjust_lon(d/this.ns0+this.long0);f.x=g;f.y=e;return f;},phi1z:function(j,a){var b,d,e;var h=Proj4js.common.asinz(0.5*a);if(j<Proj4js.common.EPSLN){return h;}var g=j*j;for(var f=1;f<=25;f++){sinphi=Math.sin(h);cosphi=Math.cos(h);b=j*sinphi;d=1-b*b;e=0.5*d*d/cosphi*(a/(1-g)-sinphi/d+0.5/j*Math.log((1-b)/(1+b)));h=h+e;if(Math.abs(e)<=1e-7){return h;}}Proj4js.reportError("aea:phi1z:Convergence error");return null;}};Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);if(!this.rc){Proj4js.reportError("sterea:init:E_ERROR_0");return;}this.sinc0=Math.sin(this.phic0);this.cosc0=Math.cos(this.phic0);this.R2=2*this.rc;if(!this.title){this.title="Oblique Stereographic Alternative";}},forward:function(a){a.x=Proj4js.common.adjust_lon(a.x-this.long0);Proj4js.Proj.gauss.forward.apply(this,[a]);sinc=Math.sin(a.y);cosc=Math.cos(a.y);cosl=Math.cos(a.x);k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl);a.x=k*cosc*Math.sin(a.x);a.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl);a.x=this.a*a.x+this.x0;a.y=this.a*a.y+this.y0;return a;},inverse:function(b){var d,a;b.x=(b.x-this.x0)/this.a;b.y=(b.y-this.y0)/this.a;b.x/=this.k0;b.y/=this.k0;if((rho=Math.sqrt(b.x*b.x+b.y*b.y))){c=2*Math.atan2(rho,this.R2);sinc=Math.sin(c);cosc=Math.cos(c);a=Math.asin(cosc*this.sinc0+b.y*sinc*this.cosc0/rho);d=Math.atan2(b.x*sinc,rho*this.cosc0*cosc-b.y*this.sinc0*sinc);}else{a=this.phic0;d=0;}b.x=d;b.y=a;Proj4js.Proj.gauss.inverse.apply(this,[b]);b.x=Proj4js.common.adjust_lon(b.x+this.long0);return b;}};Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);},forward:function(d){var a=d.x;var q=d.y;var g=Proj4js.common.adjust_lon(a-this.long0);var e;var w,u;var v=Math.sin(q);var m=Math.cos(q);if(this.sphere){var s=m*Math.sin(g);if((Math.abs(Math.abs(s)-1))<1e-10){Proj4js.reportError("tmerc:forward: Point projects into infinity");return(93);}else{w=0.5*this.a*this.k0*Math.log((1+s)/(1-s));e=Math.acos(m*Math.cos(g)/Math.sqrt(1-s*s));if(q<0){e=-e;}u=this.a*this.k0*(e-this.lat0);}}else{var l=m*g;var j=Math.pow(l,2);var o=this.ep2*Math.pow(m,2);var r=Math.tan(q);var z=Math.pow(r,2);e=1-this.es*Math.pow(v,2);var f=this.a/Math.sqrt(e);var h=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,q);w=this.k0*f*l*(1+j/6*(1-z+o+j/20*(5-18*z+Math.pow(z,2)+72*o-58*this.ep2)))+this.x0;u=this.k0*(h-this.ml0+f*r*(j*(0.5+j/24*(5-z+9*o+4*Math.pow(o,2)+j/30*(61-58*z+Math.pow(z,2)+600*o-330*this.ep2)))))+this.y0;}d.x=w;d.y=u;return d;},inverse:function(C){var l,e;var L;var E;var q=6;var o,j;if(this.sphere){var H=Math.exp(C.x/(this.a*this.k0));var G=0.5*(H-1/H);var J=this.lat0+C.y/(this.a*this.k0);var F=Math.cos(J);l=Math.sqrt((1-F*F)/(1+G*G));o=Math.asinz(l);if(J<0){o=-o;}if((G==0)&&(F==0)){j=this.long0;}else{j=Proj4js.common.adjust_lon(Math.atan2(G,F)+this.long0);}}else{var u=C.x-this.x0;var s=C.y-this.y0;l=(this.ml0+s/this.k0)/this.a;e=l;for(E=0;;E++){L=((l+this.e1*Math.sin(2*e)-this.e2*Math.sin(4*e)+this.e3*Math.sin(6*e))/this.e0)-e;e+=L;if(Math.abs(L)<=Proj4js.common.EPSLN){break;}if(E>=q){Proj4js.reportError("tmerc:inverse: Latitude failed to converge");return(95);}}if(Math.abs(e)<Proj4js.common.HALF_PI){var b=Math.sin(e);var M=Math.cos(e);var v=Math.tan(e);var K=this.ep2*Math.pow(M,2);var m=Math.pow(K,2);var w=Math.pow(v,2);var a=Math.pow(w,2);l=1-this.es*Math.pow(b,2);var D=this.a/Math.sqrt(l);var z=D*(1-this.es)/l;var I=u/(D*this.k0);var B=Math.pow(I,2);o=e-(D*v*B/z)*(0.5-B/24*(5+3*w+10*K-4*m-9*this.ep2-B/30*(61+90*w+298*K+45*a-252*this.ep2-3*m)));j=Proj4js.common.adjust_lon(this.long0+(I*(1-B/6*(1+2*w+K-B/20*(5-2*K+28*w-3*m+8*this.ep2+24*a)))/M));}else{o=Proj4js.common.HALF_PI*Proj4js.common.sign(s);j=this.long0;}}C.x=j;C.y=o;return C;}};Proj4js.Proj.equi={init:function(){if(!this.x0){this.x0=0;}if(!this.y0){this.y0=0;}if(!this.lat0){this.lat0=0;}if(!this.long0){this.long0=0;}},forward:function(e){var f=e.x;var d=e.y;var b=Proj4js.common.adjust_lon(f-this.long0);var a=this.x0+this.a*b*Math.cos(this.lat0);var g=this.y0+this.a*d;this.t1=a;this.t2=Math.cos(this.lat0);e.x=a;e.y=g;return e;},inverse:function(b){b.x-=this.x0;b.y-=this.y0;var a=b.y/this.a;if(Math.abs(a)>Proj4js.common.HALF_PI){Proj4js.reportError("equi:Inv:DataError");}var d=Proj4js.common.adjust_lon(this.long0+b.x/(this.a*Math.cos(this.lat0)));b.x=d;b.y=a;}};Proj4js.Proj.merc={init:function(){if(this.lat_ts){if(this.sphere){this.k0=Math.cos(this.lat_ts);}else{this.k0=Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts));}}},forward:function(f){var g=f.x;var e=f.y;if(e*Proj4js.common.R2D>90&&e*Proj4js.common.R2D<-90&&g*Proj4js.common.R2D>180&&g*Proj4js.common.R2D<-180){Proj4js.reportError("merc:forward: llInputOutOfRange: "+g+" : "+e);return null;}var a,h;if(Math.abs(Math.abs(e)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("merc:forward: ll2mAtPoles");
return null;}else{if(this.sphere){a=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(g-this.long0);h=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+0.5*e));}else{var d=Math.sin(e);var b=Proj4js.common.tsfnz(this.e,e,d);a=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(g-this.long0);h=this.y0-this.a*this.k0*Math.log(b);}f.x=a;f.y=h;return f;}},inverse:function(e){var a=e.x-this.x0;var g=e.y-this.y0;var f,d;if(this.sphere){d=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-g/this.a*this.k0));}else{var b=Math.exp(-g/(this.a*this.k0));d=Proj4js.common.phi2z(this.e,b);if(d==-9999){Proj4js.reportError("merc:inverse: lat = -9999");return null;}}f=Proj4js.common.adjust_lon(this.long0+a/(this.a*this.k0));e.x=f;e.y=d;return e;}};Proj4js.Proj.sinu={init:function(){this.R=6370997;},forward:function(e){var a,g,b;var f=e.x;var d=e.y;b=Proj4js.common.adjust_lon(f-this.long0);a=this.R*b*Math.cos(d)+this.x0;g=this.R*d+this.y0;e.x=a;e.y=g;return e;},inverse:function(d){var b,a,e;d.x-=this.x0;d.y-=this.y0;b=d.y/this.R;if(Math.abs(b)>Proj4js.common.HALF_PI){Proj4js.reportError("sinu:Inv:DataError");}a=Math.abs(b)-Proj4js.common.HALF_PI;if(Math.abs(a)>Proj4js.common.EPSLN){a=this.long0+d.x/(this.R*Math.cos(b));e=Proj4js.common.adjust_lon(a);}else{e=this.long0;}d.x=e;d.y=b;return d;}};Proj4js.Proj.eqdc={init:function(){if(!this.mode){this.mode=0;}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.sinphi=Math.sin(this.lat1);this.cosphi=Math.cos(this.lat1);this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);if(this.mode!=0){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("eqdc:Init:EqualLatitudes");}this.sinphi=Math.sin(this.lat2);this.cosphi=Math.cos(this.lat2);this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);if(Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN){this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1);}else{this.ns=this.sinphi;}}else{this.ns=this.sinphi;}this.g=this.ml1+this.ms1/this.ns;this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);this.rh=this.a*(this.g-this.ml0);},forward:function(e){var f=e.x;var d=e.y;var j=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,d);var h=this.a*(this.g-j);var b=this.ns*Proj4js.common.adjust_lon(f-this.long0);var a=this.x0+h*Math.sin(b);var g=this.y0+this.rh-h*Math.cos(b);e.x=a;e.y=g;return e;},inverse:function(e){e.x-=this.x0;e.y=this.rh-e.y+this.y0;var a,h;if(this.ns>=0){var h=Math.sqrt(e.x*e.x+e.y*e.y);var a=1;}else{h=-Math.sqrt(e.x*e.x+e.y*e.y);a=-1;}var b=0;if(h!=0){b=Math.atan2(a*e.x,a*e.y);}var g=this.g-h/this.a;var d=this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3);var f=Proj4js.common.adjust_lon(this.long0+b/this.ns);e.x=f;e.y=d;return e;},phi3z:function(j,h,g,f,e){var d;var a;d=j;for(var b=0;b<15;b++){a=(j+g*Math.sin(2*d)-f*Math.sin(4*d)+e*Math.sin(6*d))/h-d;d+=a;if(Math.abs(a)<=1e-10){return d;}}Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null;}};function phi4z(e,l,j,h,g,C,B,z,f){var m,w,u,v,s,r,q,o,d,t;f=C;for(t=1;t<=15;t++){m=Math.sin(f);tanphi=Math.tan(f);z=tanphi*Math.sqrt(1-e*m*m);w=Math.sin(2*f);v=l*f-j*w+h*Math.sin(4*f)-g*Math.sin(6*f);s=l-2*j*Math.cos(2*f)+4*h*Math.cos(4*f)-6*g*Math.cos(6*f);r=2*v+z*(v*v+B)-2*C*(z*v+1);q=e*w*(v*v+B-2*C*v)/(2*z);o=2*(C-v)*(z*s-2/w)-2*s;d=r/(q+o);f+=d;if(Math.abs(d)<=1e-10){return(f);}}Proj4js.reportError("phi4z: No convergence");return null;}function e4fn(a){var b,d;b=1+a;d=1-a;return(Math.sqrt((Math.pow(b,b))*(Math.pow(d,d))));}Proj4js.Proj.poly={init:function(){var a;if(this.lat0=0){this.lat0=90;}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);},forward:function(e){var a,g;var j;var m;var f,h;var d;var q,o;var b=e.x;var l=e.y;f=Proj4js.common.adjust_lon(b-this.long0);if(Math.abs(l)<=1e-7){q=this.x0+this.a*f;o=this.y0-this.a*this.ml0;}else{a=Math.sin(l);g=Math.cos(l);h=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,l);d=Proj4js.common.msfnz(this.e,a,g);f=a;q=this.x0+this.a*d*Math.sin(f)/a;o=this.y0+this.a*(h-this.ml0+d*(1-Math.cos(f))/a);}e.x=q;e.y=o;return e;},inverse:function(d){var o,h;var g;var q;var l;var e,f;var m;var a,j;d.x-=this.x0;d.y-=this.y0;g=this.ml0+d.y/this.a;m=0;if(Math.abs(g)<=1e-7){a=d.x/this.a+this.long0;j=0;}else{q=g*g+(d.x/this.a)*(d.x/this.a);m=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,q,l,j);if(m!=1){return(m);}a=Proj4js.common.adjust_lon((asinz(d.x*l/this.a)/Math.sin(j))+this.long0);}d.x=a;d.y=j;return d;}};Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE;Proj4js.Proj.gstmerc={init:function(){var a=this.b/this.a;this.e=Math.sqrt(1-a*a);this.lc=this.long0;this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var d=Math.sin(this.lat0);var b=Math.asin(d/this.rs);var e=Math.sin(b);this.cp=Proj4js.common.latiso(0,b,e)-this.rs*Proj4js.common.latiso(this.e,this.lat0,d);this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*d*d);this.xs=this.x0;this.ys=this.y0-this.n2*b;if(!this.title){this.title="Gauss Schreiber transverse mercator";}},forward:function(f){var h=f.x;var e=f.y;var a=this.rs*(h-this.lc);var b=this.cp+(this.rs*Proj4js.common.latiso(this.e,e,Math.sin(e)));var g=Math.asin(Math.sin(a)/Proj4js.common.cosh(b));var d=Proj4js.common.latiso(0,g,Math.sin(g));f.x=this.xs+(this.n2*d);f.y=this.ys+(this.n2*Math.atan(Proj4js.common.sinh(b)/Math.cos(a)));return f;},inverse:function(e){var b=e.x;var g=e.y;var a=Math.atan(Proj4js.common.sinh((b-this.xs)/this.n2)/Math.cos((g-this.ys)/this.n2));var f=Math.asin(Math.sin((g-this.ys)/this.n2)/Proj4js.common.cosh((b-this.xs)/this.n2));var d=Proj4js.common.latiso(0,f,Math.sin(f));e.x=this.lc+a/this.rs;e.y=Proj4js.common.invlatiso(this.e,(d-this.cp)/this.rs);return e;}};Proj4js.Proj.ortho={init:function(a){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);},forward:function(d){var a,e;var q;var o;var f;var h;var b=d.x;var j=d.y;q=Proj4js.common.adjust_lon(b-this.long0);a=Math.sin(j);e=Math.cos(j);o=Math.cos(q);h=this.sin_p14*a+this.cos_p14*e*o;f=1;if((h>0)||(Math.abs(h)<=Proj4js.common.EPSLN)){var m=this.a*f*e*Math.sin(q);var l=this.y0+this.a*f*(this.cos_p14*a-this.sin_p14*e*o);}else{Proj4js.reportError("orthoFwdPointError");}d.x=m;d.y=l;return d;},inverse:function(b){var h;var g;var e,l;var j;var d;var a,f;b.x-=this.x0;b.y-=this.y0;h=Math.sqrt(b.x*b.x+b.y*b.y);if(h>this.a+1e-7){Proj4js.reportError("orthoInvDataError");}g=Proj4js.common.asinz(h/this.a);e=Math.sin(g);cosi=Math.cos(g);a=this.long0;if(Math.abs(h)<=Proj4js.common.EPSLN){f=this.lat0;}f=Proj4js.common.asinz(l*this.sin_p14+(y*e*this.cos_p14)/h);d=Math.abs(lat0)-Proj4js.common.HALF_PI;if(Math.abs(d)<=Proj4js.common.EPSLN){if(this.lat0>=0){a=Proj4js.common.adjust_lon(this.long0+Math.atan2(b.x,-b.y));}else{a=Proj4js.common.adjust_lon(this.long0-Math.atan2(-b.x,b.y));}}d=l-this.sin_p14*Math.sin(f);if((Math.abs(d)>=Proj4js.common.EPSLN)||(Math.abs(x)>=Proj4js.common.EPSLN)){a=Proj4js.common.adjust_lon(this.long0+Math.atan2((b.x*e*this.cos_p14),(d*h)));}b.x=a;b.y=f;return b;}};Proj4js.Proj.somerc={init:function(){var b=this.lat0;this.lambda0=this.long0;var a=Math.sin(b);var f=this.a;var d=this.rf;var g=1/d;var j=2*g-Math.pow(g,2);var h=this.e=Math.sqrt(j);this.R=f*Math.sqrt(1-j)/(1-j*Math.pow(a,2));this.alpha=Math.sqrt(1+j/(1-j)*Math.pow(Math.cos(b),4));this.b0=Math.asin(a/this.alpha);
this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+b/2))+this.alpha*h/2*Math.log((1+h*a)/(1-h*a));},forward:function(g){var l=Math.log(Math.tan(Math.PI/4-g.y/2));var h=this.e/2*Math.log((1+this.e*Math.sin(g.y))/(1-this.e*Math.sin(g.y)));var e=-this.alpha*(l+h)+this.K;var a=2*(Math.atan(Math.exp(e))-Math.PI/4);var d=this.alpha*(g.x-this.lambda0);var j=Math.atan(Math.sin(d)/(Math.sin(this.b0)*Math.tan(a)+Math.cos(this.b0)*Math.cos(d)));var f=Math.asin(Math.cos(this.b0)*Math.sin(a)-Math.sin(this.b0)*Math.cos(a)*Math.cos(d));g.y=this.R/2*Math.log((1+Math.sin(f))/(1-Math.sin(f)))+this.y0;g.x=this.R*j+this.x0;return g;},inverse:function(e){var d=e.x-this.x0;var f=e.y-this.y0;var q=d/this.R;var g=2*(Math.atan(Math.exp(f/this.R))-Math.PI/4);var m=Math.asin(Math.cos(this.b0)*Math.sin(g)+Math.sin(this.b0)*Math.cos(g)*Math.cos(q));var o=Math.atan(Math.sin(q)/(Math.cos(this.b0)*Math.cos(q)-Math.sin(this.b0)*Math.tan(g)));var l=this.lambda0+o/this.alpha;var j=0;var r=m;var a=-1000;var h=0;while(Math.abs(r-a)>1e-7){if(++h>20){Proj4js.reportError("omercFwdInfinity");return;}j=1/this.alpha*(Math.log(Math.tan(Math.PI/4+m/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(r))/2));a=r;r=2*Math.atan(Math.exp(j))-Math.PI/2;}e.x=l;e.y=r;return e;}};Proj4js.Proj.stere={ssfn_:function(a,d,b){d*=b;return(Math.tan(0.5*(Proj4js.common.HALF_PI+a))*Math.pow((1-d)/(1+d),0.5*b));},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var a=Math.abs(this.lat0);if((Math.abs(a)-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.mode=this.lat0<0?this.S_POLE:this.N_POLE;}else{this.mode=a>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT;}this.phits=Math.abs(this.phits);if(this.es){var b;switch(this.mode){case this.N_POLE:case this.S_POLE:if(Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e));}else{a=Math.sin(this.phits);this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,a);a*=this.e;this.akm1/=Math.sqrt(1-a*a);}break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:a=Math.sin(this.lat0);b=2*Math.atan(this.ssfn_(this.lat0,a,this.e))-Proj4js.common.HALF_PI;a*=this.e;this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-a*a);this.sinX1=Math.sin(b);this.cosX1=Math.cos(b);break;}}else{switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-0.5*this.phits):2*this.k0;break;}}},forward:function(d){var b=d.x;var g=d.y;var l,h;if(this.sphere){var a,e,j,f;a=Math.sin(g);e=Math.cos(g);j=Math.cos(b);f=Math.sin(b);switch(this.mode){case this.EQUIT:h=1+e*j;if(h<=Proj4js.common.EPSLN){F_ERROR;}h=this.akm1/h;l=h*e*f;h*=a;break;case this.OBLIQ:h=1+this.sinph0*a+this.cosph0*e*j;if(h<=Proj4js.common.EPSLN){F_ERROR;}h=this.akm1/h;l=h*e*f;h*=this.cosph0*a-this.sinph0*e*j;break;case this.N_POLE:j=-j;g=-g;case this.S_POLE:if(Math.abs(g-Proj4js.common.HALF_PI)<this.TOL){F_ERROR;}h=this.akm1*Math.tan(Proj4js.common.FORTPI+0.5*g);l=f*h;h*=j;break;}}else{j=Math.cos(b);f=Math.sin(b);a=Math.sin(g);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){X=2*Math.atan(this.ssfn_(g,a,this.e));sinX=Math.sin(X-Proj4js.common.HALF_PI);cosX=Math.cos(X);}switch(this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*j));h=A*(this.cosX1*sinX-this.sinX1*cosX*j);l=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*j);h=A*sinX;l=A*cosX;break;case this.S_POLE:g=-g;j=-j;a=-a;case this.N_POLE:l=this.akm1*Proj4js.common.tsfnz(this.e,g,a);h=-l*j;break;}l=l*f;}d.x=l*this.a+this.x0;d.y=h*this.a+this.y0;return d;},inverse:function(d){var t=(d.x-this.x0)/this.a;var q=(d.y-this.y0)/this.a;var b,o;var h,a,s=0,e=0,r,g=0,l=0;var j;if(this.sphere){var m,u,f,v;u=Math.sqrt(t*t+q*q);m=2*Math.atan(u/this.akm1);f=Math.sin(m);v=Math.cos(m);b=0;switch(this.mode){case this.EQUIT:if(Math.abs(u)<=Proj4js.common.EPSLN){o=0;}else{o=Math.asin(q*f/u);}if(v!=0||t!=0){b=Math.atan2(t*f,v*u);}break;case this.OBLIQ:if(Math.abs(u)<=Proj4js.common.EPSLN){o=this.phi0;}else{o=Math.asin(v*sinph0+q*f*cosph0/u);}m=v-sinph0*Math.sin(o);if(m!=0||t!=0){b=Math.atan2(t*f*cosph0,m*u);}break;case this.N_POLE:q=-q;case this.S_POLE:if(Math.abs(u)<=Proj4js.common.EPSLN){o=this.phi0;}else{o=Math.asin(this.mode==this.S_POLE?-v:v);}b=(t==0&&q==0)?0:Math.atan2(t,q);break;}}else{r=Math.sqrt(t*t+q*q);switch(this.mode){case this.OBLIQ:case this.EQUIT:s=2*Math.atan2(r*this.cosX1,this.akm1);h=Math.cos(s);a=Math.sin(s);if(r==0){e=Math.asin(h*this.sinX1);}else{e=Math.asin(h*this.sinX1+(q*a*this.cosX1/r));}s=Math.tan(0.5*(Proj4js.common.HALF_PI+e));t*=a;q=r*this.cosX1*h-q*this.sinX1*a;l=Proj4js.common.HALF_PI;g=0.5*this.e;break;case this.N_POLE:q=-q;case this.S_POLE:s=-r/this.akm1;e=Proj4js.common.HALF_PI-2*Math.atan(s);l=-Proj4js.common.HALF_PI;g=-0.5*this.e;break;}for(j=this.NITER;j--;e=o){a=this.e*Math.sin(e);o=2*Math.atan(s*Math.pow((1+a)/(1-a),g))-l;if(Math.abs(e-o)<this.CONV){if(this.mode==this.S_POLE){o=-o;}b=(t==0&&q==0)?0:Math.atan2(t,q);d.x=b;d.y=o;return d;}}}}};Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array();this.A[1]=+0.6399175073;this.A[2]=-0.1358797613;this.A[3]=+0.063294409;this.A[4]=-0.02526853;this.A[5]=+0.0117879;this.A[6]=-0.0055161;this.A[7]=+0.0026906;this.A[8]=-0.001333;this.A[9]=+0.00067;this.A[10]=-0.00034;this.B_re=new Array();this.B_im=new Array();this.B_re[1]=+0.7557853228;this.B_im[1]=0;this.B_re[2]=+0.249204646;this.B_im[2]=+0.003371507;this.B_re[3]=-0.001541739;this.B_im[3]=+0.04105856;this.B_re[4]=-0.10162907;this.B_im[4]=+0.01727609;this.B_re[5]=-0.26623489;this.B_im[5]=-0.36249218;this.B_re[6]=-0.6870983;this.B_im[6]=-1.1651967;this.C_re=new Array();this.C_im=new Array();this.C_re[1]=+1.3231270439;this.C_im[1]=0;this.C_re[2]=-0.577245789;this.C_im[2]=-0.007809598;this.C_re[3]=+0.508307513;this.C_im[3]=-0.112208952;this.C_re[4]=-0.15094762;this.C_im[4]=+0.18200602;this.C_re[5]=+1.01418179;this.C_im[5]=+1.64497696;this.C_re[6]=+1.9660549;this.C_im[6]=+2.5127645;this.D=new Array();this.D[1]=+1.5627014243;this.D[2]=+0.5185406398;this.D[3]=-0.03333098;this.D[4]=-0.1052906;this.D[5]=-0.0368594;this.D[6]=+0.007317;this.D[7]=+0.0122;this.D[8]=+0.00394;this.D[9]=-0.0013;},forward:function(d){var b=d.x;var s=d.y;var v=s-this.lat0;var l=b-this.long0;var e=v/Proj4js.common.SEC_TO_RAD*0.00001;var a=l;var o=1;var j=0;for(n=1;n<=10;n++){o=o*e;j=j+this.A[n]*o;}var m=j;var g=a;var q=1;var h=0;var u;var f;var t=0;var r=0;for(n=1;n<=6;n++){u=q*m-h*g;f=h*m+q*g;q=u;h=f;t=t+this.B_re[n]*q-this.B_im[n]*h;r=r+this.B_im[n]*q+this.B_re[n]*h;}x=(r*this.a)+this.x0;y=(t*this.a)+this.y0;d.x=x;d.y=y;return d;},inverse:function(w){var t=w.x;var s=w.y;var D=t-this.x0;var C=s-this.y0;var r=C/this.a;var f=D/this.a;var l=1;var J=0;var g;var G;var m=0;var a=0;for(n=1;n<=6;n++){g=l*r-J*f;G=J*r+l*f;l=g;J=G;m=m+this.C_re[n]*l-this.C_im[n]*J;a=a+this.C_im[n]*l+this.C_re[n]*J;}for(i=0;i<this.iterations;i++){var u=m;var j=a;var B;var v;var d=r;var F=f;for(n=2;n<=6;n++){B=u*m-j*a;v=j*m+u*a;u=B;j=v;d=d+(n-1)*(this.B_re[n]*u-this.B_im[n]*j);F=F+(n-1)*(this.B_im[n]*u+this.B_re[n]*j);}u=1;j=0;var b=this.B_re[1];var E=this.B_im[1];for(n=2;n<=6;n++){B=u*m-j*a;v=j*m+u*a;u=B;j=v;b=b+n*(this.B_re[n]*u-this.B_im[n]*j);E=E+n*(this.B_im[n]*u+this.B_re[n]*j);}var e=b*b+E*E;m=(d*b+F*E)/e;a=(F*b-d*E)/e;}var z=m;var q=a;var H=1;var I=0;for(n=1;n<=9;n++){H=H*z;I=I+this.D[n]*H;}var o=this.lat0+(I*Proj4js.common.SEC_TO_RAD*100000);var h=this.long0+q;w.x=h;w.y=o;return w;}};Proj4js.Proj.mill={init:function(){},forward:function(e){var f=e.x;var d=e.y;var b=Proj4js.common.adjust_lon(f-this.long0);var a=this.x0+this.a*b;var g=this.y0+this.a*Math.log(Math.tan((Proj4js.common.PI/4)+(d/2.5)))*1.25;
e.x=a;e.y=g;return e;},inverse:function(b){b.x-=this.x0;b.y-=this.y0;var d=Proj4js.common.adjust_lon(this.long0+b.x/this.a);var a=2.5*(Math.atan(Math.exp(0.8*b.y/this.a))-Proj4js.common.PI/4);b.x=d;b.y=a;return b;}};Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(!this.zone){Proj4js.reportError("utm:init: zone must be specified for UTM");return;}this.lat0=0;this.long0=((6*Math.abs(this.zone))-183)*Proj4js.common.D2R;this.x0=500000;this.y0=this.utmSouth?10000000:0;this.k0=0.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse;}};var GEOCENT_LAT_ERROR=1;var COS_67P5=0.3826834323650898;var AD_C=1.0026;function cs_geodetic_to_geocentric(o,d){var r=d.x;var j=d.y;var e=d.z;var f;var b;var a;var m=0;var q;var l;var h;var g;if(j<-HALF_PI&&j>-1.001*HALF_PI){j=-HALF_PI;}else{if(j>HALF_PI&&j<1.001*HALF_PI){j=HALF_PI;}else{if((j<-HALF_PI)||(j>HALF_PI)){m|=GEOCENT_LAT_ERROR;}}}if(!m){if(r>PI){r-=(2*PI);}l=Math.sin(j);g=Math.cos(j);h=l*l;q=o.a/(Math.sqrt(1-o.es*h));f=(q+e)*g*Math.cos(r);b=(q+e)*g*Math.sin(r);a=((q*(1-o.es))+e)*l;}d.x=f;d.y=b;d.z=a;return m;}function cs_geocentric_to_geodetic(o,z){var e=z.x;var d=z.y;var a=z.z;var h;var w;var r;var f;var t;var v;var s;var m;var j;var l;var D;var g;var C;var B;var u;var q;var b;e=parseFloat(e);d=parseFloat(d);a=parseFloat(a);b=false;if(e!=0){h=Math.atan2(d,e);}else{if(d>0){h=HALF_PI;}else{if(d<0){h=-HALF_PI;}else{b=true;h=0;if(a>0){w=HALF_PI;}else{if(a<0){w=-HALF_PI;}else{w=HALF_PI;r=-o.b;return;}}}}}t=e*e+d*d;f=Math.sqrt(t);v=a*AD_C;m=Math.sqrt(v*v+t);l=v/m;g=f/m;D=l*l*l;s=a+o.b*o.ep2*D;q=f-o.a*o.es*g*g*g;j=Math.sqrt(s*s+q*q);C=s/j;B=q/j;u=o.a/Math.sqrt(1-o.es*C*C);if(B>=COS_67P5){r=f/B-u;}else{if(B<=-COS_67P5){r=f/-B-u;}else{r=a/C+u*(o.es-1);}}if(b==false){w=Math.atan(C/B);}z.x=h;z.y=w;z.z=r;return 0;}function cs_geocentric_to_wgs84(j,b){if(j.datum_type==PJD_3PARAM){b.x+=j.datum_params[0];b.y+=j.datum_params[1];b.z+=j.datum_params[2];}else{var g=j.datum_params[0];var e=j.datum_params[1];var m=j.datum_params[2];var f=j.datum_params[3];var o=j.datum_params[4];var l=j.datum_params[5];var h=j.datum_params[6];var d=h*(b.x-l*b.y+o*b.z)+g;var a=h*(l*b.x+b.y-f*b.z)+e;var q=h*(-o*b.x+f*b.y+b.z)+m;b.x=d;b.y=a;b.z=q;}}function cs_geocentric_from_wgs84(l,d){if(l.datum_type==PJD_3PARAM){d.x-=l.datum_params[0];d.y-=l.datum_params[1];d.z-=l.datum_params[2];}else{var h=l.datum_params[0];var e=l.datum_params[1];var o=l.datum_params[2];var g=l.datum_params[3];var q=l.datum_params[4];var m=l.datum_params[5];var j=l.datum_params[6];var f=(d.x-h)/j;var b=(d.y-e)/j;var a=(d.z-o)/j;d.x=f+m*b-q*a;d.y=-m*f+b+g*a;d.z=q*f-g*b+a;}}Proj4js.Proj.vandg={init:function(){this.R=6370997;},forward:function(d){var a=d.x;var s=d.y;var w=Proj4js.common.adjust_lon(a-this.long0);var v,t;if(Math.abs(s)<=Proj4js.common.EPSLN){v=this.x0+this.R*w;t=this.y0;}var f=Proj4js.common.asinz(2*Math.abs(s/Proj4js.common.PI));if((Math.abs(w)<=Proj4js.common.EPSLN)||(Math.abs(Math.abs(s)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)){v=this.x0;if(s>=0){t=this.y0+Proj4js.common.PI*this.R*Math.tan(0.5*f);}else{t=this.y0+Proj4js.common.PI*this.R*-Math.tan(0.5*f);}}var q=0.5*Math.abs((Proj4js.common.PI/w)-(w/Proj4js.common.PI));var e=q*q;var r=Math.sin(f);var o=Math.cos(f);var l=o/(r+o-1);var j=l*l;var h=l*(2/r-1);var u=h*h;var b=Proj4js.common.PI*this.R*(q*(l-u)+Math.sqrt(e*(l-u)*(l-u)-(u+e)*(j-u)))/(u+e);if(w<0){b=-b;}v=this.x0+b;b=Math.abs(b/(Proj4js.common.PI*this.R));if(s>=0){t=this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-b*b-2*q*b);}else{t=this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-b*b-2*q*b);}d.x=v;d.y=t;return d;},inverse:function(f){var u;var a,q,t,l,j,h;var m,g;var e;var s;var b;var r;var o;f.x-=this.x0;f.y-=this.y0;b=Proj4js.common.PI*this.R;a=f.x/b;q=f.y/b;t=a*a+q*q;l=-Math.abs(q)*(1+t);j=l-2*q*q+a*a;h=-2*l+1+2*q*q+t*t;o=q*q/h+(2*j*j*j/h/h/h-9*l*j/h/h)/27;e=(l-j*j/3/h)/h;s=2*Math.sqrt(-e/3);b=((3*o)/e)/s;if(Math.abs(b)>1){if(b>=0){b=1;}else{b=-1;}}r=Math.acos(b)/3;if(f.y>=0){lat=(-s*Math.cos(r+Proj4js.common.PI/3)-j/3/h)*Proj4js.common.PI;}else{lat=-(-s*Math.cos(r+PI/3)-j/3/h)*Proj4js.common.PI;}if(Math.abs(a)<Proj4js.common.EPSLN){lon=this.long0;}lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(t-1+Math.sqrt(1+2*(a*a-q*q)+t*t))/2/a);f.x=lon;f.y=lat;return f;}};Proj4js.Proj.eqc={init:function(){if(!this.x0){this.x0=0;}if(!this.y0){this.y0=0;}if(!this.lat0){this.lat0=0;}if(!this.long0){this.long0=0;}if(!this.lat_ts){this.lat_ts=0;}if(!this.title){this.title="Equidistant Cylindrical (Plate Carre)";}this.rc=Math.cos(this.lat_ts);},forward:function(e){var f=e.x;var d=e.y;var b=Proj4js.common.adjust_lon(f-this.long0);var a=Proj4js.common.adjust_lat(d-this.lat0);e.x=this.x0+(this.a*b*this.rc);e.y=this.y0+(this.a*a);return e;},inverse:function(b){var a=b.x;var d=b.y;b.x=Proj4js.common.adjust_lon(this.long0+((a-this.x0)/(this.a*this.rc)));b.y=Proj4js.common.adjust_lat(this.lat0+((d-this.y0)/(this.a)));return b;}};Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0);cphi=Math.cos(this.lat0);cphi*=cphi;this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi);this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es));this.phic0=Math.asin(sphi/this.C);this.ratexp=0.5*this.C*this.e;this.K=Math.tan(0.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(0.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp));},forward:function(b){var d=b.x;var a=b.y;b.y=2*Math.atan(this.K*Math.pow(Math.tan(0.5*a+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(a),this.ratexp))-Proj4js.common.HALF_PI;b.x=this.C*d;return b;},inverse:function(e){var d=1e-14;var f=e.x/this.C;var b=e.y;num=Math.pow(Math.tan(0.5*b+Proj4js.common.FORTPI)/this.K,1/this.C);for(var a=Proj4js.common.MAX_ITER;a>0;--a){b=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(e.y),-0.5*this.e))-Proj4js.common.HALF_PI;if(Math.abs(b-e.y)<d){break;}e.y=b;}if(!a){Proj4js.reportError("gauss:inverse:convergence failed");return null;}e.x=f;e.y=b;return e;}};Proj4js.Proj.omerc={init:function(){if(!this.mode){this.mode=0;}if(!this.lon1){this.lon1=0;this.mode=1;}if(!this.lon2){this.lon2=0;}if(!this.lat2){this.lat2=0;}var a=this.b/this.a;var d=1-Math.pow(a,2);var b=Math.sqrt(d);this.sin_p20=Math.sin(this.lat0);this.cos_p20=Math.cos(this.lat0);this.con=1-this.es*this.sin_p20*this.sin_p20;this.com=Math.sqrt(1-d);this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-d));this.al=this.a*this.bl*this.k0*this.com/this.con;if(Math.abs(this.lat0)<Proj4js.common.EPSLN){this.ts=1;this.d=1;this.el=1;}else{this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20);this.con=Math.sqrt(this.con);this.d=this.bl*this.com/(this.cos_p20*this.con);if((this.d*this.d-1)>0){if(this.lat0>=0){this.f=this.d+Math.sqrt(this.d*this.d-1);}else{this.f=this.d-Math.sqrt(this.d*this.d-1);}}else{this.f=this.d;}this.el=this.f*Math.pow(this.ts,this.bl);}if(this.mode!=0){this.g=0.5*(this.f-1/this.f);this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d);this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl;this.con=Math.abs(this.lat0);if((this.con>Proj4js.common.EPSLN)&&(Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN)){this.singam=Math.sin(this.gama);this.cosgam=Math.cos(this.gama);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}}else{Proj4js.reportError("omerc:Init:DataError");}}else{this.sinphi=Math.sin(this.at1);this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi);this.sinphi=Math.sin(this.lat2);this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi);this.h=Math.pow(this.ts1,this.bl);this.l=Math.pow(this.ts2,this.bl);this.f=this.el/this.h;this.g=0.5*(this.f-1/this.f);this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h);this.p=(this.l-this.h)/(this.l+this.h);this.dlon=this.lon1-this.lon2;
if(this.dlon<-Proj4js.common.PI){this.lon2=this.lon2-2*Proj4js.common.PI;}if(this.dlon>Proj4js.common.PI){this.lon2=this.lon2+2*Proj4js.common.PI;}this.dlon=this.lon1-this.lon2;this.longc=0.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(0.5*this.bl*this.dlon)/this.p)/this.bl;this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc);this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g);this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama));if(Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError");}else{this.con=Math.abs(this.lat1);}if((this.con<=Proj4js.common.EPSLN)||(Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN)){Proj4js.reportError("omercInitDataError");}else{if(Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError");}}this.singam=Math.sin(this.gam);this.cosgam=Math.cos(this.gam);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}}},forward:function(B){var l;var e,I;var H;var G,u,d;var g,C,E;var z,m,F;var v,D;var w;var a;var h;var f=B.x;var j=B.y;e=Math.sin(j);a=Proj4js.common.adjust_lon(f-this.longc);F=Math.sin(this.bl*a);if(Math.abs(Math.abs(j)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){h=Proj4js.common.tsfnz(this.e,j,e);z=this.el/(Math.pow(h,this.bl));w=0.5*(z-1/z);u=0.5*(z+1/z);v=(w*this.singam-F*this.cosgam)/u;g=Math.cos(this.bl*a);if(Math.abs(g)<1e-7){m=this.al*this.bl*a;}else{m=this.al*Math.atan((w*this.cosgam+F*this.singam)/g)/this.bl;if(g<0){m=m+Proj4js.common.PI*this.al/this.bl;}}}else{if(j>=0){v=this.singam;}else{v=-this.singam;}m=this.al*j/this.bl;}if(Math.abs(Math.abs(v)-1)<=Proj4js.common.EPSLN){Proj4js.reportError("omercFwdInfinity");}D=0.5*this.al*Math.log((1-v)/(1+v))/this.bl;m=m-this.u;var r=this.x0+D*this.cosaz+m*this.sinaz;var o=this.y0+m*this.cosaz-D*this.sinaz;B.x=r;B.y=o;return B;},inverse:function(v){var I;var j;var f;var e,H;var G;var E,o,d;var g,w,C;var z,l,u,r,h;var D,m,F;var a;var B;v.x-=this.x0;v.y-=this.y0;B=0;z=v.x*this.cosaz-v.y*this.sinaz;l=v.y*this.cosaz+v.x*this.sinaz;l=l+this.u;u=Math.exp(-this.bl*z/this.al);r=0.5*(u-1/u);o=0.5*(u+1/u);D=Math.sin(this.bl*l/this.al);m=(D*this.cosgam+r*this.singam)/o;if(Math.abs(Math.abs(m)-1)<=Proj4js.common.EPSLN){lon=this.longc;if(m>=0){lat=Proj4js.common.HALF_PI;}else{lat=-Proj4js.common.HALF_PI;}}else{g=1/this.bl;h=Math.pow((this.el/Math.sqrt((1+m)/(1-m))),g);lat=Proj4js.common.phi2z(this.e,h);j=this.longc-Math.atan2((r*this.cosgam-D*this.singam),g)/this.bl;lon=Proj4js.common.adjust_lon(j);}v.x=lon;v.y=lat;return v;}};Proj4js.Proj.lcc={init:function(){if(!this.lat2){this.lat2=this.lat0;}if(!this.k0){this.k0=1;}if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("lcc:init: Equal Latitudes");return;}var m=this.b/this.a;this.e=Math.sqrt(1-m*m);var h=Math.sin(this.lat1);var f=Math.cos(this.lat1);var l=Proj4js.common.msfnz(this.e,h,f);var b=Proj4js.common.tsfnz(this.e,this.lat1,h);var g=Math.sin(this.lat2);var e=Math.cos(this.lat2);var j=Proj4js.common.msfnz(this.e,g,e);var a=Proj4js.common.tsfnz(this.e,this.lat2,g);var d=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns=Math.log(l/j)/Math.log(b/a);}else{this.ns=h;}this.f0=l/(this.ns*Math.pow(b,this.ns));this.rh=this.a*this.f0*Math.pow(d,this.ns);if(!this.title){this.title="Lambert Conformal Conic";}},forward:function(f){var g=f.x;var e=f.y;if(e<=90&&e>=-90&&g<=180&&g>=-180){}else{Proj4js.reportError("lcc:forward: llInputOutOfRange: "+g+" : "+e);return null;}var a=Math.abs(Math.abs(e)-Proj4js.common.HALF_PI);var d;if(a>Proj4js.common.EPSLN){d=Proj4js.common.tsfnz(this.e,e,Math.sin(e));rh1=this.a*this.f0*Math.pow(d,this.ns);}else{a=e*this.ns;if(a<=0){Proj4js.reportError("lcc:forward: No Projection");return null;}rh1=0;}var b=this.ns*Proj4js.common.adjust_lon(g-this.long0);f.x=this.k0*(rh1*Math.sin(b))+this.x0;f.y=this.k0*(this.rh-rh1*Math.cos(b))+this.y0;return f;},inverse:function(f){var h,a,d;var e,g;x=(f.x-this.x0)/this.k0;y=(this.rh-(f.y-this.y0)/this.k0);if(this.ns>0){h=Math.sqrt(x*x+y*y);a=1;}else{h=-Math.sqrt(x*x+y*y);a=-1;}var b=0;if(h!=0){b=Math.atan2((a*x),(a*y));}if((h!=0)||(this.ns>0)){a=1/this.ns;d=Math.pow((h/(this.a*this.f0)),a);e=Proj4js.common.phi2z(this.e,d);if(e==-9999){return null;}}else{e=-Proj4js.common.HALF_PI;}g=Proj4js.common.adjust_lon(b/this.ns+this.long0);f.x=g;f.y=e;return f;}};Proj4js.Proj.laea={init:function(){this.sin_lat_o=Math.sin(this.lat0);this.cos_lat_o=Math.cos(this.lat0);},forward:function(b){var a=b.x;var l=b.y;var f=Proj4js.common.adjust_lon(a-this.long0);var r=Math.sin(l);var m=Math.cos(l);var d=Math.sin(f);var e=Math.cos(f);var j=this.sin_lat_o*r+this.cos_lat_o*m*e;if(j==-1){Proj4js.reportError("laea:fwd:Point projects to a circle of radius "+2*R);return null;}var h=this.a*Math.sqrt(2/(1+j));var q=h*m*d+this.x0;var o=h*(this.cos_lat_o*r-this.sin_lat_o*m*e)+this.y0;b.x=q;b.y=o;return b;},inverse:function(g){g.x-=this.x0;g.y-=this.y0;var e=Math.sqrt(g.x*g.x+g.y*g.y);var d=e/(2*this.a);if(d>1){Proj4js.reportError("laea:Inv:DataError");return null;}var j=2*Proj4js.common.asinz(d);var b=Math.sin(j);var a=Math.cos(j);var h=this.long0;if(Math.abs(e)>Proj4js.common.EPSLN){var f=Proj4js.common.asinz(this.sin_lat_o*a+this.cos_lat_o*b*g.y/e);var d=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(d)>Proj4js.common.EPSLN){d=a-this.sin_lat_o*Math.sin(f);if(d!=0){h=Proj4js.common.adjust_lon(this.long0+Math.atan2(g.x*b*this.cos_lat_o,d*e));}}else{if(this.lat0<0){h=Proj4js.common.adjust_lon(this.long0-Math.atan2(-g.x,g.y));}else{h=Proj4js.common.adjust_lon(this.long0+Math.atan2(g.x,-g.y));}}}else{f=this.lat0;}g.x=h;g.y=f;return g;}};Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);this.cos_p12=Math.cos(this.lat0);},forward:function(d){var b=d.x;var l=d.y;var f;var a=Math.sin(d.y);var e=Math.cos(d.y);var o=Proj4js.common.adjust_lon(b-this.long0);var m=Math.cos(o);var h=this.sin_p12*a+this.cos_p12*e*m;if(Math.abs(Math.abs(h)-1)<Proj4js.common.EPSLN){f=1;if(h<0){Proj4js.reportError("aeqd:Fwd:PointError");return;}}else{var j=Math.acos(h);f=j/Math.sin(j);}d.x=this.x0+this.a*f*e*Math.sin(o);d.y=this.y0+this.a*f*(this.cos_p12*a-this.sin_p12*e*m);return d;},inverse:function(b){b.x-=this.x0;b.y-=this.y0;var h=Math.sqrt(b.x*b.x+b.y*b.y);if(h>(2*Proj4js.common.HALF_PI*this.a)){Proj4js.reportError("aeqdInvDataError");return;}var f=h/this.a;var e=Math.sin(f);var l=Math.cos(f);var a=this.long0;var g;if(Math.abs(h)<=Proj4js.common.EPSLN){g=this.lat0;}else{g=Proj4js.common.asinz(l*this.sin_p12+(b.y*e*this.cos_p12)/h);var d=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(d)<=Proj4js.common.EPSLN){if(lat0>=0){a=Proj4js.common.adjust_lon(this.long0+Math.atan2(b.x,-b.y));}else{a=Proj4js.common.adjust_lon(this.long0-Math.atan2(-b.x,b.y));}}else{d=l-this.sin_p12*Math.sin(g);if((Math.abs(d)<Proj4js.common.EPSLN)&&(Math.abs(b.x)<Proj4js.common.EPSLN)){}else{var j=Math.atan2((b.x*e*this.cos_p12),(d*h));a=Proj4js.common.adjust_lon(this.long0+Math.atan2((b.x*e*this.cos_p12),(d*h)));}}}b.x=a;b.y=g;return b;}};Proj4js.Proj.moll={init:function(){},forward:function(d){var a=d.x;var j=d.y;var g=Proj4js.common.adjust_lon(a-this.long0);var f=j;var e=Proj4js.common.PI*Math.sin(j);for(var h=0;;h++){var b=-(f+Math.sin(f)-e)/(1+Math.cos(f));f+=b;if(Math.abs(b)<Proj4js.common.EPSLN){break;}if(h>=50){Proj4js.reportError("moll:Fwd:IterationError");}}f/=2;if(Proj4js.common.PI/2-Math.abs(j)<Proj4js.common.EPSLN){g=0;}var m=0.900316316158*this.a*g*Math.cos(f)+this.x0;var l=1.4142135623731*this.a*Math.sin(f)+this.y0;d.x=m;d.y=l;return d;},inverse:function(e){var b;var a;e.x-=this.x0;var a=e.y/(1.4142135623731*this.a);if(Math.abs(a)>0.999999999999){a=0.999999999999;}var b=Math.asin(a);var f=Proj4js.common.adjust_lon(this.long0+(e.x/(0.900316316158*this.a*Math.cos(b))));
if(f<(-Proj4js.common.PI)){f=-Proj4js.common.PI;}if(f>Proj4js.common.PI){f=Proj4js.common.PI;}a=(2*b+Math.sin(2*b))/Proj4js.common.PI;if(Math.abs(a)>1){a=1;}var d=Math.asin(a);e.x=f;e.y=d;return e;}};var OpenLayers={singleFile:true};(function(){var l=(typeof OpenLayers=="object"&&OpenLayers.singleFile);var a;window.OpenLayers={_scriptName:(!l)?"lib/OpenLayers.js":"OpenLayers.js",_getScriptLocation:function(){if(a!=undefined){return a;}a="";var v=new RegExp("(^|(.*?\\/))("+OpenLayers._scriptName+")(\\?|$)");var r=document.getElementsByTagName("script");for(var t=0,h=r.length;t<h;t++){var u=r[t].getAttribute("src");if(u){var s=u.match(v);if(s){a=s[1];break;}}}return a;}};if(!l){var m=new Array("OpenLayers/Util.js","OpenLayers/BaseTypes.js","OpenLayers/BaseTypes/Class.js","OpenLayers/BaseTypes/Bounds.js","OpenLayers/BaseTypes/Element.js","OpenLayers/BaseTypes/LonLat.js","OpenLayers/BaseTypes/Pixel.js","OpenLayers/BaseTypes/Size.js","OpenLayers/Console.js","OpenLayers/Tween.js","Rico/Corner.js","Rico/Color.js","OpenLayers/Ajax.js","OpenLayers/Events.js","OpenLayers/Request.js","OpenLayers/Request/XMLHttpRequest.js","OpenLayers/Projection.js","OpenLayers/Map.js","OpenLayers/Layer.js","OpenLayers/Icon.js","OpenLayers/Marker.js","OpenLayers/Marker/Box.js","OpenLayers/Popup.js","OpenLayers/Tile.js","OpenLayers/Tile/Image.js","OpenLayers/Tile/Image/IFrame.js","OpenLayers/Tile/WFS.js","OpenLayers/Layer/Image.js","OpenLayers/Layer/SphericalMercator.js","OpenLayers/Layer/EventPane.js","OpenLayers/Layer/FixedZoomLevels.js","OpenLayers/Layer/Google.js","OpenLayers/Layer/Google/v3.js","OpenLayers/Layer/VirtualEarth.js","OpenLayers/Layer/Yahoo.js","OpenLayers/Layer/HTTPRequest.js","OpenLayers/Layer/Grid.js","OpenLayers/Layer/MapGuide.js","OpenLayers/Layer/MapServer.js","OpenLayers/Layer/MapServer/Untiled.js","OpenLayers/Layer/KaMap.js","OpenLayers/Layer/KaMapCache.js","OpenLayers/Layer/MultiMap.js","OpenLayers/Layer/Markers.js","OpenLayers/Layer/Text.js","OpenLayers/Layer/WorldWind.js","OpenLayers/Layer/ArcGIS93Rest.js","OpenLayers/Layer/WMS.js","OpenLayers/Layer/WMS/Untiled.js","OpenLayers/Layer/WMS/Post.js","OpenLayers/Layer/WMTS.js","OpenLayers/Layer/ArcIMS.js","OpenLayers/Layer/GeoRSS.js","OpenLayers/Layer/Boxes.js","OpenLayers/Layer/XYZ.js","OpenLayers/Layer/TMS.js","OpenLayers/Layer/TileCache.js","OpenLayers/Layer/Zoomify.js","OpenLayers/Popup/Anchored.js","OpenLayers/Popup/AnchoredBubble.js","OpenLayers/Popup/Framed.js","OpenLayers/Popup/FramedCloud.js","OpenLayers/Feature.js","OpenLayers/Feature/Vector.js","OpenLayers/Feature/WFS.js","OpenLayers/Handler.js","OpenLayers/Handler/Click.js","OpenLayers/Handler/Hover.js","OpenLayers/Handler/Point.js","OpenLayers/Handler/Path.js","OpenLayers/Handler/Polygon.js","OpenLayers/Handler/Feature.js","OpenLayers/Handler/Drag.js","OpenLayers/Handler/RegularPolygon.js","OpenLayers/Handler/Box.js","OpenLayers/Handler/MouseWheel.js","OpenLayers/Handler/Keyboard.js","OpenLayers/Control.js","OpenLayers/Control/Attribution.js","OpenLayers/Control/Button.js","OpenLayers/Control/ZoomBox.js","OpenLayers/Control/ZoomToMaxExtent.js","OpenLayers/Control/DragPan.js","OpenLayers/Control/Navigation.js","OpenLayers/Control/MouseDefaults.js","OpenLayers/Control/MousePosition.js","OpenLayers/Control/OverviewMap.js","OpenLayers/Control/KeyboardDefaults.js","OpenLayers/Control/PanZoom.js","OpenLayers/Control/PanZoomBar.js","OpenLayers/Control/ArgParser.js","OpenLayers/Control/Permalink.js","OpenLayers/Control/Scale.js","OpenLayers/Control/ScaleLine.js","OpenLayers/Control/Snapping.js","OpenLayers/Control/Split.js","OpenLayers/Control/LayerSwitcher.js","OpenLayers/Control/DrawFeature.js","OpenLayers/Control/DragFeature.js","OpenLayers/Control/ModifyFeature.js","OpenLayers/Control/Panel.js","OpenLayers/Control/SelectFeature.js","OpenLayers/Control/NavigationHistory.js","OpenLayers/Control/Measure.js","OpenLayers/Control/WMSGetFeatureInfo.js","OpenLayers/Control/WMTSGetFeatureInfo.js","OpenLayers/Control/Graticule.js","OpenLayers/Control/TransformFeature.js","OpenLayers/Control/SLDSelect.js","OpenLayers/Geometry.js","OpenLayers/Geometry/Rectangle.js","OpenLayers/Geometry/Collection.js","OpenLayers/Geometry/Point.js","OpenLayers/Geometry/MultiPoint.js","OpenLayers/Geometry/Curve.js","OpenLayers/Geometry/LineString.js","OpenLayers/Geometry/LinearRing.js","OpenLayers/Geometry/Polygon.js","OpenLayers/Geometry/MultiLineString.js","OpenLayers/Geometry/MultiPolygon.js","OpenLayers/Geometry/Surface.js","OpenLayers/Renderer.js","OpenLayers/Renderer/Elements.js","OpenLayers/Renderer/SVG.js","OpenLayers/Renderer/Canvas.js","OpenLayers/Renderer/VML.js","OpenLayers/Layer/Vector.js","OpenLayers/Layer/Vector/RootContainer.js","OpenLayers/Strategy.js","OpenLayers/Strategy/Filter.js","OpenLayers/Strategy/Fixed.js","OpenLayers/Strategy/Cluster.js","OpenLayers/Strategy/Paging.js","OpenLayers/Strategy/BBOX.js","OpenLayers/Strategy/Save.js","OpenLayers/Strategy/Refresh.js","OpenLayers/Filter.js","OpenLayers/Filter/FeatureId.js","OpenLayers/Filter/Logical.js","OpenLayers/Filter/Comparison.js","OpenLayers/Filter/Spatial.js","OpenLayers/Protocol.js","OpenLayers/Protocol/HTTP.js","OpenLayers/Protocol/SQL.js","OpenLayers/Protocol/SQL/Gears.js","OpenLayers/Protocol/WFS.js","OpenLayers/Protocol/WFS/v1.js","OpenLayers/Protocol/WFS/v1_0_0.js","OpenLayers/Protocol/WFS/v1_1_0.js","OpenLayers/Protocol/SOS.js","OpenLayers/Protocol/SOS/v1_0_0.js","OpenLayers/Layer/PointTrack.js","OpenLayers/Layer/GML.js","OpenLayers/Style.js","OpenLayers/Style2.js","OpenLayers/StyleMap.js","OpenLayers/Rule.js","OpenLayers/Format.js","OpenLayers/Format/XML.js","OpenLayers/Format/Context.js","OpenLayers/Format/ArcXML.js","OpenLayers/Format/ArcXML/Features.js","OpenLayers/Format/GML.js","OpenLayers/Format/GML/Base.js","OpenLayers/Format/GML/v2.js","OpenLayers/Format/GML/v3.js","OpenLayers/Format/Atom.js","OpenLayers/Format/KML.js","OpenLayers/Format/GeoRSS.js","OpenLayers/Format/WFS.js","OpenLayers/Format/WFSCapabilities.js","OpenLayers/Format/WFSCapabilities/v1.js","OpenLayers/Format/WFSCapabilities/v1_0_0.js","OpenLayers/Format/WFSCapabilities/v1_1_0.js","OpenLayers/Format/WFSDescribeFeatureType.js","OpenLayers/Format/WMSDescribeLayer.js","OpenLayers/Format/WMSDescribeLayer/v1_1.js","OpenLayers/Format/WKT.js","OpenLayers/Format/OSM.js","OpenLayers/Format/GPX.js","OpenLayers/Format/Filter.js","OpenLayers/Format/Filter/v1.js","OpenLayers/Format/Filter/v1_0_0.js","OpenLayers/Format/Filter/v1_1_0.js","OpenLayers/Format/SLD.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/SLD/v1_0_0.js","OpenLayers/Format/OWSCommon/v1.js","OpenLayers/Format/OWSCommon/v1_0_0.js","OpenLayers/Format/OWSCommon/v1_1_0.js","OpenLayers/Format/CSWGetDomain.js","OpenLayers/Format/CSWGetDomain/v2_0_2.js","OpenLayers/Format/CSWGetRecords.js","OpenLayers/Format/CSWGetRecords/v2_0_2.js","OpenLayers/Format/WFST.js","OpenLayers/Format/WFST/v1.js","OpenLayers/Format/WFST/v1_0_0.js","OpenLayers/Format/WFST/v1_1_0.js","OpenLayers/Format/Text.js","OpenLayers/Format/JSON.js","OpenLayers/Format/GeoJSON.js","OpenLayers/Format/WMC.js","OpenLayers/Format/WMC/v1.js","OpenLayers/Format/WMC/v1_0_0.js","OpenLayers/Format/WMC/v1_1_0.js","OpenLayers/Format/WMSCapabilities.js","OpenLayers/Format/WMSCapabilities/v1.js","OpenLayers/Format/WMSCapabilities/v1_1.js","OpenLayers/Format/WMSCapabilities/v1_1_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1.js","OpenLayers/Format/WMSCapabilities/v1_3.js","OpenLayers/Format/WMSCapabilities/v1_3_0.js","OpenLayers/Format/WMSGetFeatureInfo.js","OpenLayers/Format/SOSCapabilities.js","OpenLayers/Format/SOSCapabilities/v1_0_0.js","OpenLayers/Format/SOSGetObservation.js","OpenLayers/Format/SOSGetFeatureOfInterest.js","OpenLayers/Format/OWSContext.js","OpenLayers/Format/OWSContext/v0_3_1.js","OpenLayers/Format/WMTSCapabilities.js","OpenLayers/Format/WMTSCapabilities/v1_0_0.js","OpenLayers/Layer/WFS.js","OpenLayers/Control/GetFeature.js","OpenLayers/Control/MouseToolbar.js","OpenLayers/Control/NavToolbar.js","OpenLayers/Control/PanPanel.js","OpenLayers/Control/Pan.js","OpenLayers/Control/ZoomIn.js","OpenLayers/Control/ZoomOut.js","OpenLayers/Control/ZoomPanel.js","OpenLayers/Control/EditingToolbar.js","OpenLayers/Symbolizer.js","OpenLayers/Symbolizer/Point.js","OpenLayers/Symbolizer/Line.js","OpenLayers/Symbolizer/Polygon.js","OpenLayers/Symbolizer/Text.js","OpenLayers/Symbolizer/Raster.js","OpenLayers/Lang.js","OpenLayers/Lang/en.js","OpenLayers/Lang/fr.js");
var d=navigator.userAgent;var f=(d.match("MSIE")||d.match("Safari"));if(f){var b=new Array(m.length);}var o=OpenLayers._getScriptLocation()+"lib/";for(var e=0,j=m.length;e<j;e++){if(f){b[e]="<script src='"+o+m[e]+"'><\/script>";}else{var q=document.createElement("script");q.src=o+m[e];var g=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;g.appendChild(q);}}if(f){document.write(b.join(""));}}})();OpenLayers.VERSION_NUMBER="OpenLayers 2.10 -- $Revision: 10721 $";OpenLayers.Util={};OpenLayers.Util.getElement=function(){var e=[];for(var d=0,a=arguments.length;d<a;d++){var b=arguments[d];if(typeof b=="string"){b=document.getElementById(b);}if(arguments.length==1){return b;}e.push(b);}return e;};OpenLayers.Util.isElement=function(a){return !!(a&&a.nodeType===1);};if(typeof window.$==="undefined"){window.$=OpenLayers.Util.getElement;}OpenLayers.Util.extend=function(a,f){a=a||{};if(f){for(var e in f){var d=f[e];if(d!==undefined){a[e]=d;}}var b=typeof window.Event=="function"&&f instanceof window.Event;if(!b&&f.hasOwnProperty&&f.hasOwnProperty("toString")){a.toString=f.toString;}}return a;};OpenLayers.Util.removeItem=function(d,b){for(var a=d.length-1;a>=0;a--){if(d[a]==b){d.splice(a,1);}}return d;};OpenLayers.Util.clearArray=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"}));a.length=0;};OpenLayers.Util.indexOf=function(e,d){if(typeof e.indexOf=="function"){return e.indexOf(d);}else{for(var b=0,a=e.length;b<a;b++){if(e[b]==d){return b;}}return -1;}};OpenLayers.Util.modifyDOMElement=function(f,j,e,g,a,d,h,b){if(j){f.id=j;}if(e){f.style.left=e.x+"px";f.style.top=e.y+"px";}if(g){f.style.width=g.w+"px";f.style.height=g.h+"px";}if(a){f.style.position=a;}if(d){f.style.border=d;}if(h){f.style.overflow=h;}if(parseFloat(b)>=0&&parseFloat(b)<1){f.style.filter="alpha(opacity="+(b*100)+")";f.style.opacity=b;}else{if(parseFloat(b)==1){f.style.filter="";f.style.opacity="";}}};OpenLayers.Util.createDiv=function(a,l,j,g,f,d,b,h){var e=document.createElement("div");if(g){e.style.backgroundImage="url("+g+")";}if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv");}if(!f){f="absolute";}OpenLayers.Util.modifyDOMElement(e,a,l,j,f,d,b,h);return e;};OpenLayers.Util.createImage=function(a,j,h,f,e,d,g,l){var b=document.createElement("img");if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv");}if(!e){e="relative";}OpenLayers.Util.modifyDOMElement(b,a,j,h,e,d,null,g);if(l){b.style.display="none";OpenLayers.Event.observe(b,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,b));OpenLayers.Event.observe(b,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,b));}b.style.alt=a;b.galleryImg="no";if(f){b.src=f;}return b;};OpenLayers.Util.setOpacity=function(b,a){OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a);};OpenLayers.Util.onImageLoad=function(){if(!this.viewRequestID||(this.map&&this.viewRequestID==this.map.viewRequestID)){this.style.display="";}OpenLayers.Element.removeClass(this,"olImageLoadError");};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var e=this.urls;if(e&&e instanceof Array&&e.length>1){var f=this.src.toString();var d,a;for(a=0;d=e[a];a++){if(f.indexOf(d)!=-1){break;}}var g=Math.floor(e.length*Math.random());var b=e[g];a=0;while(b==d&&a++<4){g=Math.floor(e.length*Math.random());b=e[g];}this.src=f.replace(d,b);}else{this.src=this.src;}}else{OpenLayers.Element.addClass(this,"olImageLoadError");}this.style.display="";};OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var f=navigator.appVersion.split("MSIE");var a=parseFloat(f[1]);var b=false;try{b=!!(document.body.filters);}catch(d){}OpenLayers.Util.alphaHackNeeded=(b&&(a>=5.5)&&(a<7));}return OpenLayers.Util.alphaHackNeeded;};OpenLayers.Util.modifyAlphaImageDiv=function(a,b,m,l,h,g,d,e,j){OpenLayers.Util.modifyDOMElement(a,b,m,l,g,null,null,j);var f=a.childNodes[0];if(h){f.src=h;}OpenLayers.Util.modifyDOMElement(f,a.id+"_innerImage",null,l,"relative",d);if(OpenLayers.Util.alphaHack()){if(a.style.display!="none"){a.style.display="inline-block";}if(e==null){e="scale";}a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+f.src+"', sizingMethod='"+e+"')";if(parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1){a.style.filter+=" alpha(opacity="+a.style.opacity*100+")";}f.style.filter="alpha(opacity=0)";}};OpenLayers.Util.createAlphaImageDiv=function(b,m,l,h,g,d,e,j,o){var a=OpenLayers.Util.createDiv();var f=OpenLayers.Util.createImage(null,null,null,null,null,null,null,false);a.appendChild(f);if(o){f.style.display="none";OpenLayers.Event.observe(f,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,a));OpenLayers.Event.observe(f,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,a));}OpenLayers.Util.modifyAlphaImageDiv(a,b,m,l,h,g,d,e,j);return a;};OpenLayers.Util.upperCaseObject=function(b){var a={};for(var d in b){a[d.toUpperCase()]=b[d];}return a;};OpenLayers.Util.applyDefaults=function(e,d){e=e||{};var b=typeof window.Event=="function"&&d instanceof window.Event;for(var a in d){if(e[a]===undefined||(!b&&d.hasOwnProperty&&d.hasOwnProperty(a)&&!e.hasOwnProperty(a))){e[a]=d[a];}}if(!b&&d&&d.hasOwnProperty&&d.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")){e.toString=d.toString;}return e;};OpenLayers.Util.getParameterString=function(d){var b=[];for(var j in d){var h=d[j];if((h!=null)&&(typeof h!="function")){var e;if(typeof h=="object"&&h.constructor==Array){var f=[];var l;for(var a=0,g=h.length;a<g;a++){l=h[a];f.push(encodeURIComponent((l===null||l===undefined)?"":l));}e=f.join(",");}else{e=encodeURIComponent(h);}b.push(encodeURIComponent(j)+"="+e);}}return b.join("&");};OpenLayers.Util.urlAppend=function(a,b){var e=a;if(b){var d=(a+" ").split(/[?&]/);e+=(d.pop()===" "?b:d.length?"&"+b:"?"+b);}return e;};OpenLayers.ImgPath="";OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||(OpenLayers._getScriptLocation()+"img/");};OpenLayers.Util.Try=function(){var f=null;for(var d=0,a=arguments.length;d<a;d++){var b=arguments[d];try{f=b();break;}catch(g){}}return f;};OpenLayers.Util.getNodes=function(d,b){var a=OpenLayers.Util.Try(function(){return OpenLayers.Util._getNodes(d.documentElement.childNodes,b);},function(){return OpenLayers.Util._getNodes(d.childNodes,b);});return a;};OpenLayers.Util._getNodes=function(d,f){var b=[];for(var e=0,a=d.length;e<a;e++){if(d[e].nodeName==f){b.push(d[e]);}}return b;};OpenLayers.Util.getTagText=function(d,e,b){var a=OpenLayers.Util.getNodes(d,e);if(a&&(a.length>0)){if(!b){b=0;}if(a[b].childNodes.length>1){return a.childNodes[1].nodeValue;}else{if(a[b].childNodes.length==1){return a[b].firstChild.nodeValue;}}}else{return"";}};OpenLayers.Util.getXmlNodeValue=function(a){var b=null;OpenLayers.Util.Try(function(){b=a.text;if(!b){b=a.textContent;}if(!b){b=a.firstChild.nodeValue;}},function(){b=a.textContent;});return b;};OpenLayers.Util.mouseLeft=function(a,d){var b=(a.relatedTarget)?a.relatedTarget:a.toElement;while(b!=d&&b!=null){b=b.parentNode;}return(b!=d);};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(b,a){if(a==null){a=OpenLayers.Util.DEFAULT_PRECISION;}var b;if(a==0){b=parseFloat(b);}else{b=parseFloat(parseFloat(b).toPrecision(a));}return b;};OpenLayers.Util.rad=function(a){return a*Math.PI/180;};OpenLayers.Util.deg=function(a){return a*180/Math.PI;};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(h,g){var o=OpenLayers.Util.VincentyConstants;var U=o.a,T=o.b,O=o.f;var t=OpenLayers.Util.rad(g.lon-h.lon);var S=Math.atan((1-O)*Math.tan(OpenLayers.Util.rad(h.lat)));var Q=Math.atan((1-O)*Math.tan(OpenLayers.Util.rad(g.lat)));var r=Math.sin(S),l=Math.cos(S);var q=Math.sin(Q),j=Math.cos(Q);
var z=t,u=2*Math.PI;var w=20;while(Math.abs(z-u)>1e-12&&--w>0){var J=Math.sin(z),e=Math.cos(z);var V=Math.sqrt((j*J)*(j*J)+(l*q-r*j*e)*(l*q-r*j*e));if(V==0){return 0;}var M=r*q+l*j*e;var I=Math.atan2(V,M);var m=Math.asin(l*j*J/V);var N=Math.cos(m)*Math.cos(m);var v=M-2*r*q/N;var F=O/16*N*(4+O*(4-3*N));u=z;z=t+(1-F)*O*Math.sin(m)*(I+F*V*(v+F*M*(-1+2*v*v)));}if(w==0){return NaN;}var E=N*(U*U-T*T)/(T*T);var H=1+E/16384*(4096+E*(-768+E*(320-175*E)));var G=E/1024*(256+E*(-128+E*(74-47*E)));var K=G*V*(v+G/4*(M*(-1+2*v*v)-G/6*v*(-3+4*V*V)*(-3+4*v*v)));var D=T*H*(I-K);var P=D.toFixed(3)/1000;return P;};OpenLayers.Util.destinationVincenty=function(q,Y,M){var v=OpenLayers.Util;var l=v.VincentyConstants;var Z=l.a,W=l.b,S=l.f;var V=q.lon;var h=q.lat;var z=M;var K=v.rad(Y);var O=Math.sin(K);var j=Math.cos(K);var N=(1-S)*Math.tan(v.rad(h));var d=1/Math.sqrt((1+N*N)),m=N*d;var w=Math.atan2(N,j);var I=d*O;var Q=1-I*I;var E=Q*(Z*Z-W*W)/(W*W);var H=1+E/16384*(4096+E*(-768+E*(320-175*E)));var F=E/1024*(256+E*(-128+E*(74-47*E)));var G=z/(W*H),T=2*Math.PI;while(Math.abs(G-T)>1e-12){var r=Math.cos(2*w+G);var aa=Math.sin(G);var P=Math.cos(G);var J=F*aa*(r+F/4*(P*(-1+2*r*r)-F/6*r*(-3+4*aa*aa)*(-3+4*r*r)));T=G;G=z/(W*H)+J;}var U=m*aa-d*P*j;var e=Math.atan2(m*P+d*aa*j,(1-S)*Math.sqrt(I*I+U*U));var t=Math.atan2(aa*O,d*P-m*aa*j);var D=S/16*Q*(4+S*(4-3*Q));var o=t-(1-D)*S*I*(G+D*aa*(r+D*P*(-1+2*r*r)));var g=Math.atan2(I,-U);return new OpenLayers.LonLat(V+v.deg(o),v.deg(e));};OpenLayers.Util.getParameters=function(b){b=b||window.location.href;var a="";if(OpenLayers.String.contains(b,"?")){var d=b.indexOf("?")+1;var f=OpenLayers.String.contains(b,"#")?b.indexOf("#"):b.length;a=b.substring(d,f);}var o={};var e=a.split(/[&;]/);for(var h=0,j=e.length;h<j;++h){var g=e[h].split("=");if(g[0]){var m=decodeURIComponent(g[0]);var l=g[1]||"";l=decodeURIComponent(l.replace(/\+/g," ")).split(",");if(l.length==1){l=l[0];}o[m]=l;}}return o;};OpenLayers.Util.getArgs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"}));return OpenLayers.Util.getParameters(a);};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(a){if(a==null){a="id_";}OpenLayers.Util.lastSeqID+=1;return a+OpenLayers.Util.lastSeqID;};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:OpenLayers.INCHES_PER_UNIT.Meter*100,km:OpenLayers.INCHES_PER_UNIT.Meter*1000,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(b){var a=(b>1)?(1/b):b;return a;};OpenLayers.Util.getResolutionFromScale=function(e,a){var b;if(e){if(a==null){a="degrees";}var d=OpenLayers.Util.normalizeScale(e);b=1/(d*OpenLayers.INCHES_PER_UNIT[a]*OpenLayers.DOTS_PER_INCH);}return b;};OpenLayers.Util.getScaleFromResolution=function(b,a){if(a==null){a="degrees";}var d=b*OpenLayers.INCHES_PER_UNIT[a]*OpenLayers.DOTS_PER_INCH;return d;};OpenLayers.Util.safeStopPropagation=function(a){OpenLayers.Event.stop(a,true);};OpenLayers.Util.pagePosition=function(g){var a=0,f=0;var b=g;var h=g;while(b){if(b==document.body){if(OpenLayers.Element.getStyle(h,"position")=="absolute"){break;}}a+=b.offsetTop||0;f+=b.offsetLeft||0;h=b;try{b=b.offsetParent;}catch(d){OpenLayers.Console.error(OpenLayers.i18n("pagePositionFailed",{elemId:b.id}));break;}}b=g;while(b){a-=b.scrollTop||0;f-=b.scrollLeft||0;b=b.parentNode;}return[f,a];};OpenLayers.Util.isEquivalentUrl=function(g,f,d){d=d||{};OpenLayers.Util.applyDefaults(d,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var b=OpenLayers.Util.createUrlObject(g,d);var a=OpenLayers.Util.createUrlObject(f,d);for(var e in b){if(e!=="args"){if(b[e]!=a[e]){return false;}}}for(var e in b.args){if(b.args[e]!=a.args[e]){return false;}delete a.args[e];}for(var e in a.args){return false;}return true;};OpenLayers.Util.createUrlObject=function(d,o){o=o||{};if(!(/^\w+:\/\//).test(d)){var h=window.location;var f=h.port?":"+h.port:"";var j=h.protocol+"//"+h.host.split(":").shift()+f;if(d.indexOf("/")===0){d=j+d;}else{var g=h.pathname.split("/");g.pop();d=j+g.join("/")+"/"+d;}}if(o.ignoreCase){d=d.toLowerCase();}var l=document.createElement("a");l.href=d;var e={};e.host=l.host.split(":").shift();e.protocol=l.protocol;if(o.ignorePort80){e.port=(l.port=="80"||l.port=="0")?"":l.port;}else{e.port=(l.port==""||l.port=="0")?"80":l.port;
}e.hash=(o.ignoreHash||l.hash==="#")?"":l.hash;var b=l.search;if(!b){var m=d.indexOf("?");b=(m!=-1)?d.substr(m):"";}e.args=OpenLayers.Util.getParameters(b);e.pathname=(l.pathname.charAt(0)=="/")?l.pathname:"/"+l.pathname;return e;};OpenLayers.Util.removeTail=function(b){var d=null;var a=b.indexOf("?");var e=b.indexOf("#");if(a==-1){d=(e!=-1)?b.substr(0,e):b;}else{d=(e!=-1)?b.substr(0,Math.min(a,e)):b.substr(0,a);}return d;};OpenLayers.Util.getBrowserName=function(){var b="";var a=navigator.userAgent.toLowerCase();if(a.indexOf("opera")!=-1){b="opera";}else{if(a.indexOf("msie")!=-1){b="msie";}else{if(a.indexOf("safari")!=-1){b="safari";}else{if(a.indexOf("mozilla")!=-1){if(a.indexOf("firefox")!=-1){b="firefox";}else{b="mozilla";}}}}}return b;};OpenLayers.Util.getRenderedDimensions=function(b,s,t){var o,f;var a=document.createElement("div");a.style.visibility="hidden";var r=(t&&t.containerElement)?t.containerElement:document.body;if(s){if(s.w){o=s.w;a.style.width=o+"px";}else{if(s.h){f=s.h;a.style.height=f+"px";}}}if(t&&t.displayClass){a.className=t.displayClass;}var g=document.createElement("div");g.innerHTML=b;g.style.overflow="visible";if(g.childNodes){for(var e=0,d=g.childNodes.length;e<d;e++){if(!g.childNodes[e].style){continue;}g.childNodes[e].style.overflow="visible";}}a.appendChild(g);r.appendChild(a);var q=false;var m=a.parentNode;while(m&&m.tagName.toLowerCase()!="body"){var j=OpenLayers.Element.getStyle(m,"position");if(j=="absolute"){q=true;break;}else{if(j&&j!="static"){break;}}m=m.parentNode;}if(!q){a.style.position="absolute";}if(!o){o=parseInt(g.scrollWidth);a.style.width=o+"px";}if(!f){f=parseInt(g.scrollHeight);}a.removeChild(g);r.removeChild(a);return new OpenLayers.Size(o,f);};OpenLayers.Util.getScrollbarWidth=function(){var d=OpenLayers.Util._scrollbarWidth;if(d==null){var f=null;var e=null;var a=0;var b=0;f=document.createElement("div");f.style.position="absolute";f.style.top="-1000px";f.style.left="-1000px";f.style.width="100px";f.style.height="50px";f.style.overflow="hidden";e=document.createElement("div");e.style.width="100%";e.style.height="200px";f.appendChild(e);document.body.appendChild(f);a=e.offsetWidth;f.style.overflow="scroll";b=e.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=(a-b);d=OpenLayers.Util._scrollbarWidth;}return d;};OpenLayers.Util.getFormattedLonLat=function(j,b,f){if(!f){f="dms";}var e=Math.abs(j);var l=Math.floor(e);var a=(e-l)/(1/60);var d=a;a=Math.floor(a);var h=(d-a)/(1/60);h=Math.round(h*10);h/=10;if(l<10){l="0"+l;}var g=l+"\u00B0";if(f.indexOf("dm")>=0){if(a<10){a="0"+a;}g+=a+"'";if(f.indexOf("dms")>=0){if(h<10){h="0"+h;}g+=h+'"';}}if(b=="lon"){g+=j<0?OpenLayers.i18n("W"):OpenLayers.i18n("E");}else{g+=j<0?OpenLayers.i18n("S"):OpenLayers.i18n("N");}return g;};OpenLayers.String={startsWith:function(b,a){return(b.indexOf(a)==0);},contains:function(b,a){return(b.indexOf(a)!=-1);},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"");},camelize:function(g){var e=g.split("-");var b=e[0];for(var d=1,a=e.length;d<a;d++){var f=e[d];b+=f.charAt(0).toUpperCase()+f.substring(1);}return b;},format:function(e,d,a){if(!d){d=window;}var b=function(l,f){var j;var h=f.split(/\.+/);for(var g=0;g<h.length;g++){if(g==0){j=d;}j=j[h[g]];}if(typeof j=="function"){j=a?j.apply(null,a):j();}if(typeof j=="undefined"){return"undefined";}else{return j;}};return e.replace(OpenLayers.String.tokenRegEx,b);},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a);},numericIf:function(a){return OpenLayers.String.isNumeric(a)?parseFloat(a):a;}};if(!String.prototype.startsWith){String.prototype.startsWith=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"}));return OpenLayers.String.startsWith(this,a);};}if(!String.prototype.contains){String.prototype.contains=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"}));return OpenLayers.String.contains(this,a);};}if(!String.prototype.trim){String.prototype.trim=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"}));return OpenLayers.String.trim(this);};}if(!String.prototype.camelize){String.prototype.camelize=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"}));return OpenLayers.String.camelize(this);};}OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,d){var b=0;if(d>0){b=parseFloat(a.toPrecision(d));}return b;},format:function(d,a,h,l){a=(typeof a!="undefined")?a:0;h=(typeof h!="undefined")?h:OpenLayers.Number.thousandsSeparator;l=(typeof l!="undefined")?l:OpenLayers.Number.decimalSeparator;if(a!=null){d=parseFloat(d.toFixed(a));}var b=d.toString().split(".");if(b.length==1&&a==null){a=0;}var e=b[0];if(h){var f=/(-?[0-9]+)([0-9]{3})/;while(f.test(e)){e=e.replace(f,"$1"+h+"$2");}}var g;if(a==0){g=e;}else{var j=b.length>1?b[1]:"0";if(a!=null){j=j+new Array(a-j.length+1).join("0");}g=e+l+j;}return g;}};if(!Number.prototype.limitSigDigs){Number.prototype.limitSigDigs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"}));return OpenLayers.Number.limitSigDigs(this,a);};}OpenLayers.Function={bind:function(d,b){var a=Array.prototype.slice.apply(arguments,[2]);return function(){var e=a.concat(Array.prototype.slice.apply(arguments,[0]));return d.apply(b,e);};},bindAsEventListener:function(b,a){return function(d){return b.call(a,d||window.event);};},False:function(){return false;},True:function(){return true;}};if(!Function.prototype.bind){Function.prototype.bind=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"}));Array.prototype.unshift.apply(arguments,[this]);return OpenLayers.Function.bind.apply(null,arguments);};}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"}));return OpenLayers.Function.bindAsEventListener(this,a);};}OpenLayers.Array={filter:function(h,g,b){var e=[];if(Array.prototype.filter){e=h.filter(g,b);}else{var a=h.length;if(typeof g!="function"){throw new TypeError();}for(var d=0;d<a;d++){if(d in h){var f=h[d];if(g.call(b,f,d,h)){e.push(f);}}}}return e;}};OpenLayers.Date={toISOString:(function(){if("toISOString" in Date.prototype){return function(b){return b.toISOString();};}else{function a(d,b){var e=d+"";while(e.length<b){e="0"+e;}return e;}return function(b){var d;if(isNaN(b.getTime())){d="Invalid Date";}else{d=b.getUTCFullYear()+"-"+a(b.getUTCMonth()+1,2)+"-"+a(b.getUTCDate(),2)+"T"+a(b.getUTCHours(),2)+":"+a(b.getUTCMinutes(),2)+":"+a(b.getUTCSeconds(),2)+"."+a(b.getUTCMilliseconds(),3)+"Z";}return d;};}})(),parse:function(m){var b;var u=Date.parse(m);if(!isNaN(u)){b=new Date(u);}else{var j=m.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))?$/);var b;if(j&&(j[1]||j[7])){var o=parseInt(j[1],10)||0;var l=(parseInt(j[2],10)-1)||0;var r=parseInt(j[3],10)||1;b=new Date(Date.UTC(o,l,r));var q=j[7];if(q){var s=parseInt(j[4],10);var e=parseInt(j[5],10);var a=parseFloat(j[6]);var t=a|0;var d=Math.round(1000*(a-t));b.setUTCHours(s,e,t,d);if(q!=="Z"){var h=parseInt(q,10);var g=parseInt(j[8])||0;var f=-1000*(60*(h*60)+g*60);b=new Date(b.getTime()+f);}}}else{b=new Date("invalid");}}return b;}};OpenLayers.Class=function(){var f=function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments);}};var d={};var h,b,e;for(var g=0,a=arguments.length;g<a;++g){e=arguments[g];if(typeof e=="function"){if(g==0&&a>1){b=e.prototype.initialize;e.prototype.initialize=function(){};d=new e();if(b===undefined){delete e.prototype.initialize;
}else{e.prototype.initialize=b;}}h=e.prototype;}else{h=e;}OpenLayers.Util.extend(d,h);}f.prototype=d;return f;};OpenLayers.Class.isPrototype=function(){};OpenLayers.Class.create=function(){return function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments);}};};OpenLayers.Class.inherit=function(){var e=arguments[0];var f=new e(OpenLayers.Class.isPrototype);for(var d=1,a=arguments.length;d<a;d++){if(typeof arguments[d]=="function"){var b=arguments[d];arguments[d]=new b(OpenLayers.Class.isPrototype);}OpenLayers.Util.extend(f,arguments[d]);}return f;};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,a,b,d){if(e!=null){this.left=OpenLayers.Util.toFloat(e);}if(a!=null){this.bottom=OpenLayers.Util.toFloat(a);}if(b!=null){this.right=OpenLayers.Util.toFloat(b);}if(d!=null){this.top=OpenLayers.Util.toFloat(d);}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top);},equals:function(b){var a=false;if(b!=null){a=((this.left==b.left)&&(this.right==b.right)&&(this.top==b.top)&&(this.bottom==b.bottom));}return a;},toString:function(){return("left-bottom=("+this.left+","+this.bottom+") right-top=("+this.right+","+this.top+")");},toArray:function(a){if(a===true){return[this.bottom,this.left,this.top,this.right];}else{return[this.left,this.bottom,this.right,this.top];}},toBBOX:function(b,f){if(b==null){b=6;}var h=Math.pow(10,b);var g=Math.round(this.left*h)/h;var e=Math.round(this.bottom*h)/h;var d=Math.round(this.right*h)/h;var a=Math.round(this.top*h)/h;if(f===true){return e+","+g+","+a+","+d;}else{return g+","+e+","+d+","+a;}},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])]);},getWidth:function(){return(this.right-this.left);},getHeight:function(){return(this.top-this.bottom);},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight());},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2);},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2);}return this.centerLonLat;},scale:function(f,d){if(d==null){d=this.getCenterLonLat();}var a,j;if(d.CLASS_NAME=="OpenLayers.LonLat"){a=d.lon;j=d.lat;}else{a=d.x;j=d.y;}var h=(this.left-a)*f+a;var b=(this.bottom-j)*f+j;var e=(this.right-a)*f+a;var g=(this.top-j)*f+j;return new OpenLayers.Bounds(h,b,e,g);},add:function(a,d){if((a==null)||(d==null)){var b=OpenLayers.i18n("boundsAddError");OpenLayers.Console.error(b);return null;}return new OpenLayers.Bounds(this.left+a,this.bottom+d,this.right+a,this.top+d);},extend:function(a){var b=null;if(a){switch(a.CLASS_NAME){case"OpenLayers.LonLat":b=new OpenLayers.Bounds(a.lon,a.lat,a.lon,a.lat);break;case"OpenLayers.Geometry.Point":b=new OpenLayers.Bounds(a.x,a.y,a.x,a.y);break;case"OpenLayers.Bounds":b=a;break;}if(b){this.centerLonLat=null;if((this.left==null)||(b.left<this.left)){this.left=b.left;}if((this.bottom==null)||(b.bottom<this.bottom)){this.bottom=b.bottom;}if((this.right==null)||(b.right>this.right)){this.right=b.right;}if((this.top==null)||(b.top>this.top)){this.top=b.top;}}}},containsLonLat:function(b,a){return this.contains(b.lon,b.lat,a);},containsPixel:function(b,a){return this.contains(b.x,b.y,a);},contains:function(b,e,a){if(a==null){a=true;}if(b==null||e==null){return false;}b=OpenLayers.Util.toFloat(b);e=OpenLayers.Util.toFloat(e);var d=false;if(a){d=((b>=this.left)&&(b<=this.right)&&(e>=this.bottom)&&(e<=this.top));}else{d=((b>this.left)&&(b<this.right)&&(e>this.bottom)&&(e<this.top));}return d;},intersectsBounds:function(f,b){if(b==null){b=true;}var e=false;var j=(this.left==f.right||this.right==f.left||this.top==f.bottom||this.bottom==f.top);if(b||!j){var h=(((f.bottom>=this.bottom)&&(f.bottom<=this.top))||((this.bottom>=f.bottom)&&(this.bottom<=f.top)));var g=(((f.top>=this.bottom)&&(f.top<=this.top))||((this.top>f.bottom)&&(this.top<f.top)));var d=(((f.left>=this.left)&&(f.left<=this.right))||((this.left>=f.left)&&(this.left<=f.right)));var a=(((f.right>=this.left)&&(f.right<=this.right))||((this.right>=f.left)&&(this.right<=f.right)));e=((h||g)&&(d||a));}return e;},containsBounds:function(h,b,a){if(b==null){b=false;}if(a==null){a=true;}var d=this.contains(h.left,h.bottom,a);var e=this.contains(h.right,h.bottom,a);var g=this.contains(h.left,h.top,a);var f=this.contains(h.right,h.top,a);return(b)?(d||e||g||f):(d&&e&&g&&f);},determineQuadrant:function(d){var b="";var a=this.getCenterLonLat();b+=(d.lat<a.lat)?"b":"t";b+=(d.lon<a.lon)?"l":"r";return b;},transform:function(e,b){this.centerLonLat=null;var f=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,b);var a=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,b);var d=OpenLayers.Projection.transform({x:this.left,y:this.top},e,b);var g=OpenLayers.Projection.transform({x:this.right,y:this.top},e,b);this.left=Math.min(f.x,d.x);this.bottom=Math.min(f.y,a.y);this.right=Math.max(a.x,g.x);this.top=Math.max(d.y,g.y);return this;},wrapDateLine:function(a,d){d=d||{};var e=d.leftTolerance||0;var b=d.rightTolerance||0;var f=this.clone();if(a){while(f.left<a.left&&(f.right-b)<=a.left){f=f.add(a.getWidth(),0);}while((f.left+e)>=a.right&&f.right>a.right){f=f.add(-a.getWidth(),0);}}return f;},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(b){var a=b.split(",");return OpenLayers.Bounds.fromArray(a);};OpenLayers.Bounds.fromArray=function(a){return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));};OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0);};OpenLayers.Bounds.oppositeQuadrant=function(a){var b="";b+=(a.charAt(0)=="t")?"b":"t";b+=(a.charAt(1)=="l")?"r":"l";return b;};OpenLayers.Rico=new Object();OpenLayers.Rico.Corner={round:function(f,b){f=OpenLayers.Util.getElement(f);this._setOptions(b);var a=this.options.color;if(this.options.color=="fromElement"){a=this._background(f);}var d=this.options.bgColor;if(this.options.bgColor=="fromParent"){d=this._background(f.offsetParent);}this._roundCornersImpl(f,a,d);},changeColor:function(d,b){d.style.backgroundColor=b;var a=d.parentNode.getElementsByTagName("span");for(var e=0;e<a.length;e++){a[e].style.backgroundColor=b;}},changeOpacity:function(d,g){var e=g;var a="alpha(opacity="+g*100+")";d.style.opacity=e;d.style.filter=a;var b=d.parentNode.getElementsByTagName("span");for(var f=0;f<b.length;f++){b[f].style.opacity=e;b[f].style.filter=a;}},reRound:function(e,d){var b=e.parentNode.childNodes[0];var a=e.parentNode.childNodes[2];e.parentNode.removeChild(b);e.parentNode.removeChild(a);this.round(e.parentNode,d);},_roundCornersImpl:function(d,a,b){if(this.options.border){this._renderBorder(d,b);}if(this._isTopRounded()){this._roundTopCorners(d,a,b);}if(this._isBottomRounded()){this._roundBottomCorners(d,a,b);}},_renderBorder:function(e,f){var b="1px solid "+this._borderColor(f);var a="border-left: "+b;var g="border-right: "+b;var d="style='"+a+";"+g+"'";e.innerHTML="<div "+d+">"+e.innerHTML+"</div>";},_roundTopCorners:function(d,a,f){var e=this._createCorner(f);for(var b=0;b<this.options.numSlices;b++){e.appendChild(this._createCornerSlice(a,f,b,"top"));}d.style.paddingTop=0;d.insertBefore(e,d.firstChild);},_roundBottomCorners:function(d,a,f){var e=this._createCorner(f);for(var b=(this.options.numSlices-1);b>=0;b--){e.appendChild(this._createCornerSlice(a,f,b,"bottom"));}d.style.paddingBottom=0;d.appendChild(e);},_createCorner:function(b){var a=document.createElement("div");a.style.backgroundColor=(this._isTransparent()?"transparent":b);return a;},_createCornerSlice:function(d,e,h,a){var f=document.createElement("span");
var b=f.style;b.backgroundColor=d;b.display="block";b.height="1px";b.overflow="hidden";b.fontSize="1px";var g=this._borderColor(d,e);if(this.options.border&&h==0){b.borderTopStyle="solid";b.borderTopWidth="1px";b.borderLeftWidth="0px";b.borderRightWidth="0px";b.borderBottomWidth="0px";b.height="0px";b.borderColor=g;}else{if(g){b.borderColor=g;b.borderStyle="solid";b.borderWidth="0px 1px";}}if(!this.options.compact&&(h==(this.options.numSlices-1))){b.height="2px";}this._setMargin(f,h,a);this._setBorder(f,h,a);return f;},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};OpenLayers.Util.extend(this.options,a||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent()){this.options.blend=false;}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return"";}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return"";}if(this.options.corners.indexOf("tl")>=0){return"left";}else{if(this.options.corners.indexOf("tr")>=0){return"right";}}return"";},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return"";}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return"";}if(this.options.corners.indexOf("bl")>=0){return"left";}else{if(this.options.corners.indexOf("br")>=0){return"right";}}return"";},_borderColor:function(a,b){if(a=="transparent"){return b;}else{if(this.options.border){return this.options.border;}else{if(this.options.blend){return this._blend(b,a);}else{return"";}}}},_setMargin:function(e,f,b){var d=this._marginSize(f);var a=b=="top"?this._whichSideTop():this._whichSideBottom();if(a=="left"){e.style.marginLeft=d+"px";e.style.marginRight="0px";}else{if(a=="right"){e.style.marginRight=d+"px";e.style.marginLeft="0px";}else{e.style.marginLeft=d+"px";e.style.marginRight=d+"px";}}},_setBorder:function(e,f,b){var d=this._borderSize(f);var a=b=="top"?this._whichSideTop():this._whichSideBottom();if(a=="left"){e.style.borderLeftWidth=d+"px";e.style.borderRightWidth="0px";}else{if(a=="right"){e.style.borderRightWidth=d+"px";e.style.borderLeftWidth="0px";}else{e.style.borderLeftWidth=d+"px";e.style.borderRightWidth=d+"px";}}if(this.options.border!=false){e.style.borderLeftWidth=d+"px";e.style.borderRightWidth=d+"px";}},_marginSize:function(f){if(this._isTransparent()){return 0;}var e=[5,3,2,1];var a=[3,2,1,0];var d=[2,1];var b=[1,0];if(this.options.compact&&this.options.blend){return b[f];}else{if(this.options.compact){return d[f];}else{if(this.options.blend){return a[f];}else{return e[f];}}}},_borderSize:function(f){var e=[5,3,2,1];var b=[2,1,1,1];var a=[1,0];var d=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1;}else{if(this.options.compact){return a[f];}else{if(this.options.blend){return b[f];}else{if(this.options.border){return d[f];}else{if(this._isTransparent()){return e[f];}}}}}return 0;},_hasString:function(b){for(var a=1;a<arguments.length;a++){if(b.indexOf(arguments[a])>=0){return true;}}return false;},_blend:function(d,a){var b=OpenLayers.Rico.Color.createFromHex(d);b.blend(OpenLayers.Rico.Color.createFromHex(a));return b;},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex();}catch(b){return"#ffffff";}},_isTransparent:function(){return this.options.color=="transparent";},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr");},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br");},_hasSingleTextChild:function(a){return a.childNodes.length==1&&a.childNodes[0].nodeType==3;}};OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a);},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){var b=document.getElementsByTagName("script");for(var d=0,a=b.length;d<a;++d){if(b[d].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);break;}}}})();OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a;},destroy:function(){},read:function(a){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"));},write:function(a){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"));},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.CSWGetRecords=function(b){b=OpenLayers.Util.applyDefaults(b,OpenLayers.Format.CSWGetRecords.DEFAULTS);var a=OpenLayers.Format.CSWGetRecords["v"+b.version.replace(/\./g,"_")];if(!a){throw"Unsupported CSWGetRecords version: "+b.version;}return new a(b);};OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};OpenLayers.Event={observers:false,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement;},isLeftClick:function(a){return(((a.which)&&(a.which==1))||((a.button)&&(a.button==1)));},isRightClick:function(a){return(((a.which)&&(a.which==3))||((a.button)&&(a.button==2)));},stop:function(b,a){if(!a){if(b.preventDefault){b.preventDefault();}else{b.returnValue=false;}}if(b.stopPropagation){b.stopPropagation();}else{b.cancelBubble=true;}},findElement:function(d,b){var a=OpenLayers.Event.element(d);while(a.parentNode&&(!a.tagName||(a.tagName.toUpperCase()!=b.toUpperCase()))){a=a.parentNode;}return a;},observe:function(b,e,d,a){var f=OpenLayers.Util.getElement(b);a=a||false;if(e=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||f.attachEvent)){e="keydown";}if(!this.observers){this.observers={};}if(!f._eventCacheID){var g="eventCacheID_";if(f.id){g=f.id+"_"+g;}f._eventCacheID=OpenLayers.Util.createUniqueID(g);}var h=f._eventCacheID;if(!this.observers[h]){this.observers[h]=[];}this.observers[h].push({element:f,name:e,observer:d,useCapture:a});if(f.addEventListener){f.addEventListener(e,d,a);}else{if(f.attachEvent){f.attachEvent("on"+e,d);}}},stopObservingElement:function(a){var b=OpenLayers.Util.getElement(a);var d=b._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[d]);},_removeElementObservers:function(f){if(f){for(var b=f.length-1;b>=0;b--){var d=f[b];var a=new Array(d.element,d.name,d.observer,d.useCapture);var e=OpenLayers.Event.stopObserving.apply(this,a);}}},stopObserving:function(j,a,h,b){b=b||false;var g=OpenLayers.Util.getElement(j);var e=g._eventCacheID;if(a=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||g.detachEvent){a="keydown";}}var m=false;var d=OpenLayers.Event.observers[e];if(d){var f=0;while(!m&&f<d.length){var l=d[f];if((l.name==a)&&(l.observer==h)&&(l.useCapture==b)){d.splice(f,1);if(d.length==0){delete OpenLayers.Event.observers[e];}m=true;break;}f++;}}if(m){if(g.removeEventListener){g.removeEventListener(a,h,b);}else{if(g&&g.detachEvent){g.detachEvent("on"+a,h);}}}return m;},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b]);}OpenLayers.Event.observers=false;}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);if(window.Event){OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event);}else{var Event=OpenLayers.Event;}OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:false,clearMouseListener:null,initialize:function(d,f,h,g,b){OpenLayers.Util.extend(this,b);
this.object=d;this.fallThrough=g;this.listeners={};this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this);this.eventTypes=[];if(h!=null){for(var e=0,a=h.length;e<a;e++){this.addEventType(h[e]);}}if(f!=null){this.attachToElement(f);}},destroy:function(){if(this.element){OpenLayers.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener);}}this.element=null;this.listeners=null;this.object=null;this.eventTypes=null;this.fallThrough=null;this.eventHandler=null;},addEventType:function(a){if(!this.listeners[a]){this.eventTypes.push(a);this.listeners[a]=[];}},attachToElement:function(e){if(this.element){OpenLayers.Event.stopObservingElement(this.element);}this.element=e;for(var d=0,a=this.BROWSER_EVENTS.length;d<a;d++){var b=this.BROWSER_EVENTS[d];this.addEventType(b);OpenLayers.Event.observe(e,b,this.eventHandler);}OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop);},on:function(a){for(var b in a){if(b!="scope"){this.register(b,a.scope,a[b]);}}},register:function(b,e,d){if((d!=null)&&(OpenLayers.Util.indexOf(this.eventTypes,b)!=-1)){if(e==null){e=this.object;}var a=this.listeners[b];a.push({obj:e,func:d});}},registerPriority:function(b,e,d){if(d!=null){if(e==null){e=this.object;}var a=this.listeners[b];if(a!=null){a.unshift({obj:e,func:d});}}},un:function(a){for(var b in a){if(b!="scope"){this.unregister(b,a.scope,a[b]);}}},unregister:function(e,g,f){if(g==null){g=this.object;}var d=this.listeners[e];if(d!=null){for(var b=0,a=d.length;b<a;b++){if(d[b].obj==g&&d[b].func==f){d.splice(b,1);break;}}}},remove:function(a){if(this.listeners[a]!=null){this.listeners[a]=[];}},triggerEvent:function(f,b){var e=this.listeners[f];if(!e||e.length==0){return;}if(b==null){b={};}b.object=this.object;b.element=this.element;if(!b.type){b.type=f;}var e=e.slice(),g;for(var d=0,a=e.length;d<a;d++){var h=e[d];g=h.func.apply(h.obj,[b]);if((g!=undefined)&&(g==false)){break;}}if(!this.fallThrough){OpenLayers.Event.stop(b,true);}return g;},handleBrowserEvent:function(a){if(this.includeXY){a.xy=this.getMousePosition(a);}this.triggerEvent(a.type,a);},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null;},getMousePosition:function(a){if(!this.includeXY){this.clearMouseCache();}else{if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true;}}if(!this.element.scrolls){this.element.scrolls=[(document.documentElement.scrollLeft||document.body.scrollLeft),(document.documentElement.scrollTop||document.body.scrollTop)];}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)];}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element);this.element.offsets[0]+=this.element.scrolls[0];this.element.offsets[1]+=this.element.scrolls[1];}return new OpenLayers.Pixel((a.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(a.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1]);},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,e,d){this.url=a;this.size=(b)?b:new OpenLayers.Size(20,20);this.offset=e?e:new OpenLayers.Pixel(-(this.size.w/2),-(this.size.h/2));this.calculateOffset=d;var f=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(f);},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null;},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset);},setSize:function(a){if(a!=null){this.size=a;}this.draw();},setUrl:function(a){if(a!=null){this.url=a;}this.draw();},draw:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(a);return this.imageDiv;},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){OpenLayers.Element.remove(this.imageDiv);}},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a);},moveTo:function(a){if(a!=null){this.px=a;}if(this.imageDiv!=null){if(this.px==null){this.display(false);}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size);}var b=this.px.offset(this.offset);OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,b);}}},display:function(a){this.imageDiv.style.display=(a)?"":"none";},isDrawn:function(){var a=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));return a;},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(d,b){this.lonlat=d;var a=(b)?b:OpenLayers.Marker.defaultIcon();if(this.icon==null){this.icon=a;}else{this.icon.url=a.url;this.icon.size=a.size;this.icon.offset=a.offset;this.icon.calculateOffset=a.calculateOffset;}this.events=new OpenLayers.Events(this,this.icon.imageDiv,null);},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null;}},draw:function(a){return this.icon.draw(a);},erase:function(){if(this.icon!=null){this.icon.erase();}},moveTo:function(a){if((a!=null)&&(this.icon!=null)){this.icon.moveTo(a);}this.lonlat=this.map.getLonLatFromLayerPx(a);},isDrawn:function(){var a=(this.icon&&this.icon.isDrawn());return a;},onScreen:function(){var b=false;if(this.map){var a=this.map.getExtent();b=a.containsLonLat(this.lonlat);}return b;},inflate:function(b){if(this.icon){var a=new OpenLayers.Size(this.icon.size.w*b,this.icon.size.h*b);this.icon.setSize(a);}},setOpacity:function(a){this.icon.setOpacity(a);},setUrl:function(a){this.icon.setUrl(a);},display:function(a){this.icon.display(a);},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){var a=OpenLayers.Util.getImagesLocation()+"marker.png";var b=new OpenLayers.Size(21,25);var d=function(e){return new OpenLayers.Pixel(-(e.w/2),-e.h);};return new OpenLayers.Icon(a,b,null,d);};OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding);}},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,initialize:function(h,d,g,b,f,e){if(h==null){h=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");}this.id=h;this.lonlat=d;this.contentSize=(g!=null)?g:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);if(b!=null){this.contentHTML=b;}this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var a=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(a,null,null,null,"relative",null,"hidden");var h=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(h,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);if(f){this.addCloseBox(e);}this.registerEvents();},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide);
}this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv);}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;if(this.map!=null){this.map.removePopup(this);}this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null;},draw:function(a){if(a==null){if((this.lonlat!=null)&&(this.map!=null)){a=this.map.getLayerPxFromLonLat(this.lonlat);}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide);}if(!this.disableFirefoxOverflowHack&&OpenLayers.Util.getBrowserName()=="firefox"){this.map.events.register("movestart",this,function(){var b=document.defaultView.getComputedStyle(this.contentDiv,null);var d=b.getPropertyValue("overflow");if(d!="hidden"){this.contentDiv._oldOverflow=d;this.contentDiv.style.overflow="hidden";}});this.map.events.register("moveend",this,function(){var b=this.contentDiv._oldOverflow;if(b){this.contentDiv.style.overflow=b;this.contentDiv._oldOverflow=null;}});}this.moveTo(a);if(!this.autoSize&&!this.size){this.setSize(this.contentSize);}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView();}return this.div;},updatePosition:function(){if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);if(a){this.moveTo(a);}}},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px";}},visible:function(){return OpenLayers.Element.visible(this.div);},toggle:function(){if(this.visible()){this.hide();}else{this.show();}},show:function(){OpenLayers.Element.show(this.div);if(this.panMapIfOutOfView){this.panIntoView();}},hide:function(){OpenLayers.Element.hide(this.div);},setSize:function(d){this.size=d.clone();var b=this.getContentDivPadding();var a=b.left+b.right;var f=b.top+b.bottom;this.fixPadding();a+=this.padding.left+this.padding.right;f+=this.padding.top+this.padding.bottom;if(this.closeDiv){var e=parseInt(this.closeDiv.style.width);a+=e+b.right;}this.size.w+=a;this.size.h+=f;if(OpenLayers.Util.getBrowserName()=="msie"){this.contentSize.w+=b.left+b.right;this.contentSize.h+=b.bottom+b.top;}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px";}if(this.contentDiv!=null){this.contentDiv.style.width=d.w+"px";this.contentDiv.style.height=d.h+"px";}},updateSize:function(){var f="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var j=(this.map)?this.map.layerContainerDiv:document.body;var l=OpenLayers.Util.getRenderedDimensions(f,null,{displayClass:this.displayClass,containerElement:j});var h=this.getSafeContentSize(l);var g=null;if(h.equals(l)){g=l;}else{var b=new OpenLayers.Size();b.w=(h.w<l.w)?h.w:null;b.h=(h.h<l.h)?h.h:null;if(b.w&&b.h){g=h;}else{var e=OpenLayers.Util.getRenderedDimensions(f,b,{displayClass:this.contentDisplayClass,containerElement:j});var d=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if((d!="hidden")&&(e.equals(h))){var a=OpenLayers.Util.getScrollbarWidth();if(b.w){e.h+=a;}else{e.w+=a;}}g=this.getSafeContentSize(e);}}this.setSize(g);},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a;}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor;}},setOpacity:function(a){if(a!=undefined){this.opacity=a;}if(this.div!=null){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+this.opacity*100+")";}},setBorder:function(a){if(a!=undefined){this.border=a;}if(this.div!=null){this.div.style.border=this.border;}},setContentHTML:function(a){if(a!=null){this.contentHTML=a;}if((this.contentDiv!=null)&&(this.contentHTML!=null)&&(this.contentHTML!=this.contentDiv.innerHTML)){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize();}}},registerImageListeners:function(){var g=function(){this.popup.updateSize();if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView();}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad);};var b=this.contentDiv.getElementsByTagName("img");for(var f=0,a=b.length;f<a;f++){var d=b[f];if(d.width==0||d.height==0){var e={popup:this,img:d};d._onImgLoad=OpenLayers.Function.bind(g,e);OpenLayers.Event.observe(d,"load",d._onImgLoad);}}},getSafeContentSize:function(o){var e=o.clone();var l=this.getContentDivPadding();var m=l.left+l.right;var h=l.top+l.bottom;this.fixPadding();m+=this.padding.left+this.padding.right;h+=this.padding.top+this.padding.bottom;if(this.closeDiv){var d=parseInt(this.closeDiv.style.width);m+=d+l.right;}if(this.minSize){e.w=Math.max(e.w,(this.minSize.w-m));e.h=Math.max(e.h,(this.minSize.h-h));}if(this.maxSize){e.w=Math.min(e.w,(this.maxSize.w-m));e.h=Math.min(e.h,(this.maxSize.h-h));}if(this.map&&this.map.size){var g=0,f=0;if(this.keepInMap&&!this.panMapIfOutOfView){var j=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":g=j.x;f=this.map.size.h-j.y;break;case"tl":g=this.map.size.w-j.x;f=this.map.size.h-j.y;break;case"bl":g=this.map.size.w-j.x;f=j.y;break;case"br":g=j.x;f=j.y;break;default:g=j.x;f=this.map.size.h-j.y;break;}}var a=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-h-f;var b=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-m-g;e.w=Math.min(e.w,b);e.h=Math.min(e.h,a);}return e;},getContentDivPadding:function(){var a=this._contentDivPadding;if(!a){if(this.div.parentNode==null){this.div.style.display="none";document.body.appendChild(this.div);}a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=a;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display="";}}return a;},addCloseBox:function(d){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17));this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px";this.closeDiv.style.top=b.top+"px";this.groupDiv.appendChild(this.closeDiv);var a=d||function(f){this.hide();OpenLayers.Event.stop(f);};OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(a,this));},panIntoView:function(){var f=this.map.getSize();var e=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));var d=e.clone();if(e.x<this.map.paddingForPopups.left){d.x=this.map.paddingForPopups.left;}else{if((e.x+this.size.w)>(f.w-this.map.paddingForPopups.right)){d.x=f.w-this.map.paddingForPopups.right-this.size.w;}}if(e.y<this.map.paddingForPopups.top){d.y=this.map.paddingForPopups.top;}else{if((e.y+this.size.h)>(f.h-this.map.paddingForPopups.bottom)){d.y=f.h-this.map.paddingForPopups.bottom-this.size.h;}}var b=e.x-d.x;var a=e.y-d.y;this.map.pan(b,a);},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,true);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,scope:this});},onmousedown:function(a){this.mousedown=true;OpenLayers.Event.stop(a,true);},onmousemove:function(a){if(this.mousedown){OpenLayers.Event.stop(a,true);}},onmouseup:function(a){if(this.mousedown){this.mousedown=false;OpenLayers.Event.stop(a,true);}},onclick:function(a){OpenLayers.Event.stop(a,true);},onmouseout:function(a){this.mousedown=false;},ondblclick:function(a){OpenLayers.Event.stop(a,true);},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:true,anchor:null,initialize:function(j,e,h,d,b,g,f){var a=[j,e,h,d,g,f];
OpenLayers.Popup.prototype.initialize.apply(this,a);this.anchor=(b!=null)?b:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)};},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments);},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments);},moveTo:function(d){var b=this.relativePosition;this.relativePosition=this.calculateRelativePosition(d);var e=this.calculateNewPx(d);var a=new Array(e);OpenLayers.Popup.prototype.moveTo.apply(this,a);if(this.relativePosition!=b){this.updateRelativePosition();}},setSize:function(b){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(a);}},calculateRelativePosition:function(b){var e=this.map.getLonLatFromLayerPx(b);var d=this.map.getExtent();var a=d.determineQuadrant(e);return OpenLayers.Bounds.oppositeQuadrant(a);},updateRelativePosition:function(){},calculateNewPx:function(b){var f=b.offset(this.anchor.offset);var a=this.size||this.contentSize;var e=(this.relativePosition.charAt(0)=="t");f.y+=(e)?-(a.h+this.anchor.size.h):this.anchor.size.h;var d=(this.relativePosition.charAt(1)=="l");f.x+=(d)?-(a.w+this.anchor.size.w):this.anchor.size.w;return f;},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:false,initialize:function(h,d,g,b,a,f,e){this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);},draw:function(a){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);this.setContentHTML();this.setBackgroundColor();this.setOpacity();return this.div;},updateRelativePosition:function(){this.setRicoCorners();},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.setRicoCorners();},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a;}if(this.div!=null){if(this.contentDiv!=null){this.div.style.background="transparent";OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor);}}},setOpacity:function(a){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,a);if(this.div!=null){if(this.groupDiv!=null){OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity);}}},setBorder:function(a){this.border=0;},setRicoCorners:function(){var a=this.getCornersToRound(this.relativePosition);var b={corners:a,color:this.backgroundColor,bgColor:"transparent",blend:false};if(!this.rounded){OpenLayers.Rico.Corner.round(this.div,b);this.rounded=true;}else{OpenLayers.Rico.Corner.reRound(this.groupDiv,b);this.setBackgroundColor();this.setOpacity();}},getCornersToRound:function(){var a=["tl","tr","bl","br"];var b=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);OpenLayers.Util.removeItem(a,b);return a.join(" ");},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:OpenLayers.Popup.AnchoredBubble,popup:null,initialize:function(a,d,b){this.layer=a;this.lonlat=d;this.data=(b!=null)?b:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup);}}if(this.layer!=null&&this.marker!=null){this.layer.removeMarker(this.marker);}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null;}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null;}},onScreen:function(){var b=false;if((this.layer!=null)&&(this.layer.map!=null)){var a=this.layer.map.getExtent();b=a.containsLonLat(this.lonlat);}return b;},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon);}return this.marker;},destroyMarker:function(){this.marker.destroy();},createPopup:function(b){if(this.lonlat!=null){var d=this.id+"_popup";var a=(this.marker)?this.marker.icon:null;if(!this.popup){this.popup=new this.popupClass(d,this.lonlat,this.data.popupSize,this.data.popupContentHTML,a,b);}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow;}this.popup.feature=this;}return this.popup;},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null;}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",initialize:function(d,a,b){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,a]);this.lonlat=null;this.geometry=d?d:null;this.state=null;this.attributes={};if(a){this.attributes=OpenLayers.Util.extend(this.attributes,a);}this.style=b?b:null;},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null;}this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments);},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style);},onScreen:function(e){var d=false;if(this.layer&&this.layer.map){var a=this.layer.map.getExtent();if(e){var b=this.geometry.getBounds();d=a.intersectsBounds(b);}else{var f=a.toGeometry();d=f.intersects(this.geometry);}}return d;},getVisibility:function(){return !(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility());},createMarker:function(){return null;},destroyMarker:function(){},createPopup:function(){return null;},atPoint:function(b,e,d){var a=false;if(this.geometry){a=this.geometry.atPoint(b,e,d);}return a;},destroyPopup:function(){},move:function(a){if(!this.layer||!this.geometry.move){return;}var b;if(a.CLASS_NAME=="OpenLayers.LonLat"){b=this.layer.getViewPortPxFromLonLat(a);}else{b=a;}var e=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var d=this.layer.map.getResolution();this.geometry.move(d*(b.x-e.x),d*(e.y-b.y));this.layer.drawFeature(this);return e;},toState:function(a){if(a==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break;}}else{if(a==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a;break;}}else{if(a==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a;break;}}else{if(a==OpenLayers.State.UNKNOWN){this.state=a;}}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}};
OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM");}OpenLayers.Format.prototype.initialize.apply(this,[a]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var b in this.namespaces){this.namespaceAlias[this.namespaces[b]]=b;}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments);},setNamespace:function(a,b){this.namespaces[a]=b;this.namespaceAlias[b]=a;},read:function(d){var a=d.indexOf("<");if(a>0){d=d.substring(a);}var b=OpenLayers.Util.Try(OpenLayers.Function.bind((function(){var e;if(window.ActiveXObject&&!this.xmldom){e=new ActiveXObject("Microsoft.XMLDOM");}else{e=this.xmldom;}e.loadXML(d);return e;}),this),function(){return new DOMParser().parseFromString(d,"text/xml");},function(){var e=new XMLHttpRequest();e.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(d),false);if(e.overrideMimeType){e.overrideMimeType("text/xml");}e.send(null);return e.responseXML;});if(this.keepData){this.data=b;}return b;},write:function(b){var d;if(this.xmldom){d=b.xml;}else{var a=new XMLSerializer();if(b.nodeType==1){var e=document.implementation.createDocument("","",null);if(e.importNode){b=e.importNode(b,true);}e.appendChild(b);d=a.serializeToString(e);}else{d=a.serializeToString(b);}}return d;},createElementNS:function(d,a){var b;if(this.xmldom){if(typeof d=="string"){b=this.xmldom.createNode(1,a,d);}else{b=this.xmldom.createNode(1,a,"");}}else{b=document.createElementNS(d,a);}return b;},createTextNode:function(b){var a;if(typeof b!=="string"){b=String(b);}if(this.xmldom){a=this.xmldom.createTextNode(b);}else{a=document.createTextNode(b);}return a;},getElementsByTagNameNS:function(f,e,d){var a=[];if(f.getElementsByTagNameNS){a=f.getElementsByTagNameNS(e,d);}else{var b=f.getElementsByTagName("*");var l,g;for(var h=0,j=b.length;h<j;++h){l=b[h];g=(l.prefix)?(l.prefix+":"+d):d;if((d=="*")||(g==l.nodeName)){if((e=="*")||(e==l.namespaceURI)){a.push(l);}}}}return a;},getAttributeNodeNS:function(d,b,a){var l=null;if(d.getAttributeNodeNS){l=d.getAttributeNodeNS(b,a);}else{var f=d.attributes;var j,e;for(var g=0,h=f.length;g<h;++g){j=f[g];if(j.namespaceURI==b){e=(j.prefix)?(j.prefix+":"+a):a;if(e==j.nodeName){l=j;break;}}}}return l;},getAttributeNS:function(f,e,a){var b="";if(f.getAttributeNS){b=f.getAttributeNS(e,a)||"";}else{var d=this.getAttributeNodeNS(f,e,a);if(d){b=d.nodeValue;}}return b;},getChildValue:function(a,d){var b=d||"";if(a){for(var e=a.firstChild;e;e=e.nextSibling){switch(e.nodeType){case 3:case 4:b+=e.nodeValue;}}}return b;},concatChildValues:function(b,e){var d="";var f=b.firstChild;var a;while(f){a=f.nodeValue;if(a){d+=a;}f=f.nextSibling;}if(d==""&&e!=undefined){d=e;}return d;},isSimpleContent:function(a){var d=true;for(var b=a.firstChild;b;b=b.nextSibling){if(b.nodeType===1){d=false;break;}}return d;},contentType:function(d){var f=false,b=false;var a=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(var e=d.firstChild;e;e=e.nextSibling){switch(e.nodeType){case 1:b=true;break;case 8:break;default:f=true;}if(b&&f){break;}}if(b&&f){a=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;}else{if(b){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;}else{if(f){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE;}}}return a;},hasAttributeNS:function(d,b,a){var e=false;if(d.hasAttributeNS){e=d.hasAttributeNS(b,a);}else{e=!!this.getAttributeNodeNS(d,b,a);}return e;},setAttributeNS:function(e,d,a,f){if(e.setAttributeNS){e.setAttributeNS(d,a,f);}else{if(this.xmldom){if(d){var b=e.ownerDocument.createNode(2,a,d);b.nodeValue=f;e.setAttributeNode(b);}else{e.setAttribute(a,f);}}else{throw"setAttributeNS not implemented";}}},createElementNSPlus:function(b,a){a=a||{};var e=a.uri||this.namespaces[a.prefix];if(!e){var g=b.indexOf(":");e=this.namespaces[b.substring(0,g)];}if(!e){e=this.namespaces[this.defaultPrefix];}var d=this.createElementNS(e,b);if(a.attributes){this.setAttributes(d,a.attributes);}var f=a.value;if(f!=null){d.appendChild(this.createTextNode(f));}return d;},setAttributes:function(d,f){var e,b;for(var a in f){if(f[a]!=null&&f[a].toString){e=f[a].toString();b=this.namespaces[a.substring(0,a.indexOf(":"))]||null;this.setAttributeNS(d,b,a,e);}}},readNode:function(d,f){if(!f){f={};}var e=this.readers[d.namespaceURI?this.namespaceAlias[d.namespaceURI]:this.defaultPrefix];if(e){var b=d.localName||d.nodeName.split(":").pop();var a=e[b]||e["*"];if(a){a.apply(this,[d,f]);}}return f;},readChildNodes:function(e,f){if(!f){f={};}var d=e.childNodes;var g;for(var b=0,a=d.length;b<a;++b){g=d[b];if(g.nodeType==1){this.readNode(g,f);}}return f;},writeNode:function(a,g,e){var f,d;var b=a.indexOf(":");if(b>0){f=a.substring(0,b);d=a.substring(b+1);}else{if(e){f=this.namespaceAlias[e.namespaceURI];}else{f=this.defaultPrefix;}d=a;}var h=this.writers[f][d].apply(this,[g]);if(e){e.appendChild(h);}return h;},getChildEl:function(d,a,b){return d&&this.getThisOrNextEl(d.firstChild,a,b);},getNextEl:function(d,a,b){return d&&this.getThisOrNextEl(d.nextSibling,a,b);},getThisOrNextEl:function(e,a,d){outer:for(var b=e;b;b=b.nextSibling){switch(b.nodeType){case 1:if((!a||a===(b.localName||b.nodeName.split(":").pop()))&&(!d||d===b.namespaceURI)){break outer;}b=null;break outer;case 3:if(/^\s*$/.test(b.nodeValue)){break;}case 4:case 6:case 12:case 10:case 11:b=null;break outer;}}return b||null;},lookupNamespaceURI:function(f,g){var e=null;if(f){if(f.lookupNamespaceURI){e=f.lookupNamespaceURI(g);}else{outer:switch(f.nodeType){case 1:if(f.namespaceURI!==null&&f.prefix===g){e=f.namespaceURI;break outer;}var b=f.attributes.length;if(b){var a;for(var d=0;d<b;++d){a=f.attributes[d];if(a.prefix==="xmlns"&&a.name==="xmlns:"+g){e=a.value||null;break outer;}else{if(a.name==="xmlns"&&g===null){e=a.value||null;break outer;}}}}e=this.lookupNamespaceURI(f.parentNode,g);break outer;case 2:e=this.lookupNamespaceURI(f.ownerElement,g);break outer;case 9:e=this.lookupNamespaceURI(f.documentElement,g);break outer;case 6:case 12:case 10:case 11:break outer;default:e=this.lookupNamespaceURI(f.parentNode,g);break outer;}}}return e;},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);if(!OpenLayers.Format.OWSCommon){OpenLayers.Format.OWSCommon={};}OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},readers:{ows:{ServiceIdentification:function(a,b){b.serviceIdentification={};this.readChildNodes(a,b.serviceIdentification);},Title:function(a,b){b.title=this.getChildValue(a);},Abstract:function(a,b){b["abstract"]=this.getChildValue(a);},Keywords:function(a,b){b.keywords={};this.readChildNodes(a,b.keywords);},Keyword:function(b,a){a[this.getChildValue(b)]=true;},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)};},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=this.getChildValue(a);},Fees:function(a,b){b.fees=this.getChildValue(a);},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a);},ServiceProvider:function(a,b){b.serviceProvider={};this.readChildNodes(a,b.serviceProvider);},ProviderName:function(a,b){b.providerName=this.getChildValue(a);},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href");},ServiceContact:function(a,b){b.serviceContact={};this.readChildNodes(a,b.serviceContact);},IndividualName:function(b,a){a.individualName=this.getChildValue(b);},PositionName:function(b,a){a.positionName=this.getChildValue(b);},ContactInfo:function(b,a){a.contactInfo={};this.readChildNodes(b,a.contactInfo);},Phone:function(b,a){a.phone={};
this.readChildNodes(b,a.phone);},Voice:function(b,a){a.voice=this.getChildValue(b);},Address:function(b,a){a.address={};this.readChildNodes(b,a.address);},DeliveryPoint:function(b,a){a.deliveryPoint=this.getChildValue(b);},City:function(b,a){a.city=this.getChildValue(b);},AdministrativeArea:function(b,a){a.administrativeArea=this.getChildValue(b);},PostalCode:function(b,a){a.postalCode=this.getChildValue(b);},Country:function(b,a){a.country=this.getChildValue(b);},ElectronicMailAddress:function(b,a){a.electronicMailAddress=this.getChildValue(b);},Role:function(b,a){a.role=this.getChildValue(b);},OperationsMetadata:function(a,b){b.operationsMetadata={};this.readChildNodes(a,b.operationsMetadata);},Operation:function(d,b){var a=d.getAttribute("name");b[a]={};this.readChildNodes(d,b[a]);},DCP:function(b,a){a.dcp={};this.readChildNodes(b,a.dcp);},HTTP:function(b,a){a.http={};this.readChildNodes(b,a.http);},Get:function(b,a){a.get=this.getAttributeNS(b,this.namespaces.xlink,"href");},Post:function(b,a){a.post=this.getAttributeNS(b,this.namespaces.xlink,"href");},Parameter:function(d,a){if(!a.parameters){a.parameters={};}var b=d.getAttribute("name");a.parameters[b]={};this.readChildNodes(d,a.parameters[b]);},Value:function(a,b){b[this.getChildValue(a)]=true;},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)});this.readChildNodes(a,b);},WGS84BoundingBox:function(b,d){var a={};a.crs=b.getAttribute("crs");if(d.BoundingBox){d.BoundingBox.push(a);}else{d.projection=a.crs;a=d;}this.readChildNodes(b,a);},BoundingBox:function(a,b){this.readers.ows["WGS84BoundingBox"].apply(this,[a,b]);},LowerCorner:function(b,d){var e=this.getChildValue(b).replace(this.regExes.trimSpace,"");e=e.replace(this.regExes.trimComma,",");var a=e.split(this.regExes.splitSpace);d.left=a[0];d.bottom=a[1];},UpperCorner:function(b,d){var e=this.getChildValue(b).replace(this.regExes.trimSpace,"");e=e.replace(this.regExes.trimComma,",");var a=e.split(this.regExes.splitSpace);d.right=a[0];d.top=a[1];d.bounds=new OpenLayers.Bounds(d.left,d.bottom,d.right,d.top);delete d.left;delete d.bottom;delete d.right;delete d.top;}}},writers:{ows:{BoundingBox:function(a){var b=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:a.projection}});this.writeNode("ows:LowerCorner",a,b);this.writeNode("ows:UpperCorner",a,b);return b;},LowerCorner:function(a){var b=this.createElementNSPlus("ows:LowerCorner",{value:a.bounds.left+" "+a.bounds.bottom});return b;},UpperCorner:function(a){var b=this.createElementNSPlus("ows:UpperCorner",{value:a.bounds.right+" "+a.bounds.top});return b;},Title:function(b){var a=this.createElementNSPlus("ows:Title",{value:b});return a;},OutputFormat:function(b){var a=this.createElementNSPlus("ows:OutputFormat",{value:b});return a;}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.0",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",getParser:function(a){var b=a||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=b){var d=OpenLayers.Format.WMC["v"+b.replace(/\./g,"_")];if(!d){throw"Can't find a WMC parser for version "+b;}this.parser=new d(this.options);}return this.parser;},layerToContext:function(a){var d=this.getParser();var b={queryable:a.queryable,visibility:a.visibility,name:a.params.LAYERS,title:a.name,metadataURL:a.metadataURL,version:a.params.VERSION,url:a.url,maxExtent:a.maxExtent,transparent:a.params.TRANSPARENT,numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:(a.singleTile||!a.tileSize)?undefined:{width:a.tileSize.w,height:a.tileSize.h},minScale:(a.options.resolutions||a.options.scales||a.options.maxResolution||a.options.minScale)?a.minScale:undefined,maxScale:(a.options.resolutions||a.options.scales||a.options.minResolution||a.options.maxScale)?a.maxScale:undefined,formats:[{value:a.params.FORMAT,current:true}],styles:[{href:a.params.SLD,body:a.params.SLD_BODY,name:a.params.STYLES||d.defaultStyleName,title:d.defaultStyleTitle,current:true}]};return b;},toContext:function(g){var e={};var f=g.layers;if(g.CLASS_NAME=="OpenLayers.Map"){e.bounds=g.getExtent();e.maxExtent=g.maxExtent;e.projection=g.projection;e.size=g.getSize();}else{OpenLayers.Util.applyDefaults(e,g);if(e.layers!=undefined){delete (e.layers);}}if(e.layersContext==undefined){e.layersContext=[];}if(f!=undefined&&f instanceof Array){for(var d=0,a=f.length;d<a;d++){var b=f[d];if(b instanceof OpenLayers.Layer.WMS){e.layersContext.push(this.layerToContext(b));}}}return e;},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(a){var b=null;if(a==null){b=this.namespaces[this.defaultPrefix];}else{for(b in this.namespaces){if(this.namespaces[b]==a){break;}}}return b;},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(d){if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d]);}var a=d.documentElement;this.rootPrefix=a.prefix;var b={version:a.getAttribute("version")};this.runChildNodes(b,a);return b;},runChildNodes:function(f,e){var b=e.childNodes;var a,d,h,l;for(var g=0,j=b.length;g<j;++g){a=b[g];if(a.nodeType==1){h=this.getNamespacePrefix(a.namespaceURI);l=a.nodeName.split(":").pop();d=this["read_"+h+"_"+l];if(d){d.apply(this,[f,a]);}}}},read_wmc_General:function(a,b){this.runChildNodes(a,b);},read_wmc_BoundingBox:function(a,b){a.projection=b.getAttribute("SRS");a.bounds=new OpenLayers.Bounds(parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy")));},read_wmc_LayerList:function(a,b){a.layersContext=[];this.runChildNodes(a,b);},read_wmc_Layer:function(a,b){var d={visibility:(b.getAttribute("hidden")!="1"),queryable:(b.getAttribute("queryable")=="1"),formats:[],styles:[]};this.runChildNodes(d,b);a.layersContext.push(d);},read_wmc_Extension:function(b,a){this.runChildNodes(b,a);},read_ol_units:function(b,a){b.units=this.getChildValue(a);},read_ol_maxExtent:function(d,b){var a=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"));d.maxExtent=a;},read_ol_transparent:function(b,a){b.transparent=this.getChildValue(a);},read_ol_numZoomLevels:function(b,a){b.numZoomLevels=parseInt(this.getChildValue(a));},read_ol_opacity:function(b,a){b.opacity=parseFloat(this.getChildValue(a));},read_ol_singleTile:function(b,a){b.singleTile=(this.getChildValue(a)=="true");},read_ol_tileSize:function(b,a){var d={width:a.getAttribute("width"),height:a.getAttribute("height")};b.tileSize=d;},read_ol_isBaseLayer:function(b,a){b.isBaseLayer=(this.getChildValue(a)=="true");},read_ol_displayInLayerSwitcher:function(b,a){b.displayInLayerSwitcher=(this.getChildValue(a)=="true");},read_wmc_Server:function(d,b){d.version=b.getAttribute("version");var e={};var a=b.getElementsByTagName("OnlineResource");if(a.length>0){this.read_wmc_OnlineResource(e,a[0]);}d.url=e.href;},read_wmc_FormatList:function(b,a){this.runChildNodes(b,a);},read_wmc_Format:function(b,a){var d={value:this.getChildValue(a)};if(a.getAttribute("current")=="1"){d.current=true;}b.formats.push(d);},read_wmc_StyleList:function(b,a){this.runChildNodes(b,a);},read_wmc_Style:function(d,b){var a={};
this.runChildNodes(a,b);if(b.getAttribute("current")=="1"){a.current=true;}d.styles.push(a);},read_wmc_SLD:function(a,b){this.runChildNodes(a,b);},read_sld_StyledLayerDescriptor:function(d,b){var a=OpenLayers.Format.XML.prototype.write.apply(this,[b]);d.body=a;},read_wmc_OnlineResource:function(b,a){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href");},read_wmc_Name:function(d,b){var a=this.getChildValue(b);if(a){d.name=a;}},read_wmc_Title:function(b,a){var d=this.getChildValue(a);if(d){b.title=d;}},read_wmc_MetadataURL:function(d,b){var e={};var a=b.getElementsByTagName("OnlineResource");if(a.length>0){this.read_wmc_OnlineResource(e,a[0]);}d.metadataURL=e.href;},read_wmc_Abstract:function(d,b){var a=this.getChildValue(b);if(a){d["abstract"]=a;}},read_wmc_LegendURL:function(d,e){var b={width:e.getAttribute("width"),height:e.getAttribute("height")};var a=e.getElementsByTagName("OnlineResource");if(a.length>0){this.read_wmc_OnlineResource(b,a[0]);}d.legend=b;},write:function(d,b){var a=this.createElementDefaultNS("ViewContext");this.setAttributes(a,{version:this.VERSION,id:(b&&typeof b.id=="string")?b.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);a.appendChild(this.write_wmc_General(d));a.appendChild(this.write_wmc_LayerList(d));return OpenLayers.Format.XML.prototype.write.apply(this,[a]);},createElementDefaultNS:function(d,b,a){var e=this.createElementNS(this.namespaces[this.defaultPrefix],d);if(b){e.appendChild(this.createTextNode(b));}if(a){this.setAttributes(e,a);}return e;},setAttributes:function(b,e){var d;for(var a in e){d=e[a].toString();if(d.match(/[A-Z]/)){this.setAttributeNS(b,null,a,d);}else{b.setAttribute(a,d);}}},write_wmc_General:function(a){var d=this.createElementDefaultNS("General");if(a.size){d.appendChild(this.createElementDefaultNS("Window",null,{width:a.size.w,height:a.size.h}));}var b=a.bounds;d.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:b.left.toPrecision(18),miny:b.bottom.toPrecision(18),maxx:b.right.toPrecision(18),maxy:b.top.toPrecision(18),SRS:a.projection}));d.appendChild(this.createElementDefaultNS("Title",a.title));d.appendChild(this.write_ol_MapExtension(a));return d;},write_ol_MapExtension:function(b){var e=this.createElementDefaultNS("Extension");var d=b.maxExtent;if(d){var a=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(a,{minx:d.left.toPrecision(18),miny:d.bottom.toPrecision(18),maxx:d.right.toPrecision(18),maxy:d.top.toPrecision(18)});e.appendChild(a);}return e;},write_wmc_LayerList:function(d){var e=this.createElementDefaultNS("LayerList");for(var b=0,a=d.layersContext.length;b<a;++b){e.appendChild(this.write_wmc_Layer(d.layersContext[b]));}return e;},write_wmc_Layer:function(a){var b=this.createElementDefaultNS("Layer",null,{queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1"});b.appendChild(this.write_wmc_Server(a));b.appendChild(this.createElementDefaultNS("Name",a.name));b.appendChild(this.createElementDefaultNS("Title",a.title));if(a.metadataURL){b.appendChild(this.write_wmc_MetadataURL(a.metadataURL));}return b;},write_wmc_LayerExtension:function(b){var e=this.createElementDefaultNS("Extension");var a=b.maxExtent;var j=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(j,{minx:a.left.toPrecision(18),miny:a.bottom.toPrecision(18),maxx:a.right.toPrecision(18),maxy:a.top.toPrecision(18)});e.appendChild(j);if(b.tileSize&&!b.singleTile){var l=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(l,b.tileSize);e.appendChild(l);}var h=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"];var d;for(var f=0,g=h.length;f<g;++f){d=this.createOLPropertyNode(b,h[f]);if(d){e.appendChild(d);}}return e;},createOLPropertyNode:function(b,d){var a=null;if(b[d]!=null){a=this.createElementNS(this.namespaces.ol,"ol:"+d);a.appendChild(this.createTextNode(b[d].toString()));}return a;},write_wmc_Server:function(a){var b=this.createElementDefaultNS("Server");this.setAttributes(b,{service:"OGC:WMS",version:a.version});b.appendChild(this.write_wmc_OnlineResource(a.url));return b;},write_wmc_MetadataURL:function(b){var a=this.createElementDefaultNS("MetadataURL");a.appendChild(this.write_wmc_OnlineResource(b));return a;},write_wmc_FormatList:function(d){var e=this.createElementDefaultNS("FormatList");for(var b=0,a=d.formats.length;b<a;b++){var f=d.formats[b];e.appendChild(this.createElementDefaultNS("Format",f.value,(f.current&&f.current==true)?{current:"1"}:null));}return e;},write_wmc_StyleList:function(f){var d=this.createElementDefaultNS("StyleList");var m=f.styles;if(m&&m instanceof Array){var a;for(var e=0,g=m.length;e<g;e++){var o=m[e];var b=this.createElementDefaultNS("Style",null,(o.current&&o.current==true)?{current:"1"}:null);if(o.href){a=this.createElementDefaultNS("SLD");var h=this.write_wmc_OnlineResource(o.href);a.appendChild(h);a.appendChild(this.createElementDefaultNS("Name",o.name));if(o.title){a.appendChild(this.createElementDefaultNS("Title",o.title));}b.appendChild(a);}else{if(o.body){a=this.createElementDefaultNS("SLD");var j=OpenLayers.Format.XML.prototype.read.apply(this,[o.body]);var l=j.documentElement;if(a.ownerDocument&&a.ownerDocument.importNode){l=a.ownerDocument.importNode(l,true);}a.appendChild(l);a.appendChild(this.createElementDefaultNS("Name",o.name));if(o.title){a.appendChild(this.createElementDefaultNS("Title",o.title));}b.appendChild(a);}else{b.appendChild(this.createElementDefaultNS("Name",o.name));b.appendChild(this.createElementDefaultNS("Title",o.title));if(o["abstract"]){b.appendChild(this.createElementDefaultNS("Abstract",o["abstract"]));}}}d.appendChild(b);}}return d;},write_wmc_OnlineResource:function(a){var b=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(b,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(b,this.namespaces.xlink,"xlink:href",a);return b;},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a]);},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));b.appendChild(this.write_wmc_LayerExtension(a));},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a]);},read_sld_MinScaleDenominator:function(d,b){var a=parseFloat(this.getChildValue(b));if(a>0){d.maxScale=a;}},read_sld_MaxScaleDenominator:function(b,a){b.minScale=parseFloat(this.getChildValue(a));},write_wmc_Layer:function(b){var d=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[b]);if(b.maxScale){var e=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");e.appendChild(this.createTextNode(b.maxScale.toPrecision(16)));d.appendChild(e);}if(b.minScale){var a=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");a.appendChild(this.createTextNode(b.minScale.toPrecision(16)));d.appendChild(a);}d.appendChild(this.write_wmc_FormatList(b));d.appendChild(this.write_wmc_StyleList(b));d.appendChild(this.write_wmc_LayerExtension(b));return d;},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[a]);
},read:function(g){var f,e,j;var h=this.regExes.typeStr.exec(g);if(h){e=h[1].toLowerCase();j=h[2];if(this.parse[e]){f=this.parse[e].apply(this,[j]);}if(this.internalProjection&&this.externalProjection){if(f&&f.CLASS_NAME=="OpenLayers.Feature.Vector"){f.geometry.transform(this.externalProjection,this.internalProjection);}else{if(f&&e!="geometrycollection"&&typeof f=="object"){for(var d=0,a=f.length;d<a;d++){var b=f[d];b.geometry.transform(this.externalProjection,this.internalProjection);}}}}}return f;},write:function(a){var g,l,j,e,b;if(a.constructor==Array){g=a;b=true;}else{g=[a];b=false;}var d=[];if(b){d.push("GEOMETRYCOLLECTION(");}for(var f=0,h=g.length;f<h;++f){if(b&&f>0){d.push(",");}l=g[f].geometry;j=l.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[j]){return null;}if(this.internalProjection&&this.externalProjection){l=l.clone();l.transform(this.internalProjection,this.externalProjection);}e=this.extract[j].apply(this,[l]);d.push(j.toUpperCase()+"("+e+")");}if(b){d.push(")");}return d.join("");},extract:{point:function(a){return a.x+" "+a.y;},multipoint:function(d){var e=[];for(var b=0,a=d.components.length;b<a;++b){e.push("("+this.extract.point.apply(this,[d.components[b]])+")");}return e.join(",");},linestring:function(b){var e=[];for(var d=0,a=b.components.length;d<a;++d){e.push(this.extract.point.apply(this,[b.components[d]]));}return e.join(",");},multilinestring:function(d){var e=[];for(var b=0,a=d.components.length;b<a;++b){e.push("("+this.extract.linestring.apply(this,[d.components[b]])+")");}return e.join(",");},polygon:function(d){var e=[];for(var b=0,a=d.components.length;b<a;++b){e.push("("+this.extract.linestring.apply(this,[d.components[b]])+")");}return e.join(",");},multipolygon:function(e){var d=[];for(var b=0,a=e.components.length;b<a;++b){d.push("("+this.extract.polygon.apply(this,[e.components[b]])+")");}return d.join(",");}},parse:{point:function(b){var a=OpenLayers.String.trim(b).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a[0],a[1]));},multipoint:function(g){var b;var e=OpenLayers.String.trim(g).split(this.regExes.parenComma);var f=[];for(var d=0,a=e.length;d<a;++d){b=e[d].replace(this.regExes.trimParens,"$1");f.push(this.parse.point.apply(this,[b]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(f));},linestring:function(f){var d=OpenLayers.String.trim(f).split(",");var e=[];for(var b=0,a=d.length;b<a;++b){e.push(this.parse.point.apply(this,[d[b]]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(e));},multilinestring:function(g){var d;var b=OpenLayers.String.trim(g).split(this.regExes.parenComma);var f=[];for(var e=0,a=b.length;e<a;++e){d=b[e].replace(this.regExes.trimParens,"$1");f.push(this.parse.linestring.apply(this,[d]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(f));},polygon:function(j){var d,b,g;var h=OpenLayers.String.trim(j).split(this.regExes.parenComma);var f=[];for(var e=0,a=h.length;e<a;++e){d=h[e].replace(this.regExes.trimParens,"$1");b=this.parse.linestring.apply(this,[d]).geometry;g=new OpenLayers.Geometry.LinearRing(b.components);f.push(g);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(f));},multipolygon:function(g){var e;var b=OpenLayers.String.trim(g).split(this.regExes.doubleParenComma);var f=[];for(var d=0,a=b.length;d<a;++d){e=b[d].replace(this.regExes.trimParens,"$1");f.push(this.parse.polygon.apply(this,[e]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(f));},geometrycollection:function(f){f=f.replace(/,\s*([A-Za-z])/g,"|$1");var e=OpenLayers.String.trim(f).split("|");var d=[];for(var b=0,a=e.length;b<a;++b){d.push(OpenLayers.Format.WKT.prototype.read.apply(this,[e[b]]));}return d;}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},gmlFormat:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,arguments);OpenLayers.Util.extend(this,a);this.options=a;},read:function(f){var a;if(typeof f=="string"){f=OpenLayers.Format.XML.prototype.read.apply(this,[f]);}var b=f.documentElement;if(b){var d=this;var e=this["read_"+b.nodeName];if(e){a=e.call(this,b);}else{a=new OpenLayers.Format.GML((this.options?this.options:{})).read(f);}}else{a=f;}return a;},read_msGMLOutput:function(l){var f=[];var b=this.getSiblingNodesByTagCriteria(l,this.layerIdentifier);if(b){for(var m=0,r=b.length;m<r;++m){var d=b[m];var o=d.nodeName;if(d.prefix){o=o.split(":")[1];}var o=o.replace(this.layerIdentifier,"");var q=this.getSiblingNodesByTagCriteria(d,this.featureIdentifier);if(q){for(var h=0;h<q.length;h++){var a=q[h];var e=this.parseGeometry(a);var g=this.parseAttributes(a);var s=new OpenLayers.Feature.Vector(e.geometry,g,null);s.bounds=e.bounds;s.type=o;f.push(s);}}}}return f;},read_FeatureInfoResponse:function(g){var d=[];var l=this.getElementsByTagNameNS(g,"*","FIELDS");for(var h=0,m=l.length;h<m;h++){var a=l[h];var o=null;var f={};for(var e=0,q=a.attributes.length;e<q;e++){var b=a.attributes[e];f[b.nodeName]=b.nodeValue;}d.push(new OpenLayers.Feature.Vector(o,f,null));}return d;},getSiblingNodesByTagCriteria:function(g,l){var a=[];var d,f,e,h,b;if(g&&g.hasChildNodes()){d=g.childNodes;e=d.length;for(var j=0;j<e;j++){b=d[j];while(b&&b.nodeType!=1){b=b.nextSibling;j++;}f=(b?b.nodeName:"");if(f.length>0&&f.indexOf(l)>-1){a.push(b);}else{h=this.getSiblingNodesByTagCriteria(b,l);if(h.length>0){(a.length==0)?a=h:a.push(h);}}}}return a;},parseAttributes:function(f){var g={};if(f.nodeType==1){var d=f.childNodes;var e=d.length;for(var h=0;h<e;++h){var b=d[h];if(b.nodeType==1){var m=b.childNodes;if(m.length==1){var l=m[0];if(l.nodeType==3||l.nodeType==4){var a=(b.prefix)?b.nodeName.split(":")[1]:b.nodeName;var j=l.nodeValue.replace(this.regExes.trimSpace,"");g[a]=j;}}}}}return g;},parseGeometry:function(d){if(!this.gmlFormat){this.gmlFormat=new OpenLayers.Format.GML();}var a=this.gmlFormat.parseFeature(d);var e,b=null;if(a){e=a.geometry&&a.geometry.clone();b=a.bounds&&a.bounds.clone();a.destroy();}return{geometry:e,bounds:b};},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){this.id=null;this.bounds=null;},clone:function(){return new OpenLayers.Geometry();},setBounds:function(a){if(a){this.bounds=a.clone();}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds();}},extendBounds:function(b){var a=this.getBounds();if(!a){this.setBounds(b);}else{this.bounds.extend(b);}},getBounds:function(){if(this.bounds==null){this.calculateBounds();}return this.bounds;},calculateBounds:function(){},distanceTo:function(b,a){},getVertices:function(a){},atPoint:function(f,j,g){var d=false;var e=this.getBounds();if((e!=null)&&(f!=null)){var b=(j!=null)?j:0;var a=(g!=null)?g:0;var h=new OpenLayers.Bounds(this.bounds.left-b,this.bounds.bottom-a,this.bounds.right+b,this.bounds.top+a);d=h.containsLonLat(f);}return d;},getLength:function(){return 0;},getArea:function(){return 0;},getCentroid:function(){return null;},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this));},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(g){var h=arguments.callee.format;if(!h){h=new OpenLayers.Format.WKT();arguments.callee.format=h;}var e;var b=h.read(g);if(b instanceof OpenLayers.Feature.Vector){e=b.geometry;}else{if(b instanceof Array){var a=b.length;var f=new Array(a);for(var d=0;d<a;++d){f[d]=b[d].geometry;}e=new OpenLayers.Geometry.Collection(f);}}return e;};OpenLayers.Geometry.segmentsIntersect=function(a,L,b){var v=b&&b.point;var D=b&&b.tolerance;
var g=false;var F=a.x1-L.x1;var J=a.y1-L.y1;var s=a.x2-a.x1;var C=a.y2-a.y1;var w=L.y2-L.y1;var o=L.x2-L.x1;var H=(w*s)-(o*C);var f=(o*J)-(w*F);var e=(s*J)-(C*F);if(H==0){if(f==0&&e==0){g=true;}}else{var I=f/H;var G=e/H;if(I>=0&&I<=1&&G>=0&&G<=1){if(!v){g=true;}else{var l=a.x1+(I*s);var h=a.y1+(I*C);g=new OpenLayers.Geometry.Point(l,h);}}}if(D){var u;if(g){if(v){var r=[a,L];var E,l,h;outer:for(var B=0;B<2;++B){E=r[B];for(var z=1;z<3;++z){l=E["x"+z];h=E["y"+z];u=Math.sqrt(Math.pow(l-g.x,2)+Math.pow(h-g.y,2));if(u<D){g.x=l;g.y=h;break outer;}}}}}else{var r=[a,L];var t,K,l,h,q,m;outer:for(var B=0;B<2;++B){t=r[B];K=r[(B+1)%2];for(var z=1;z<3;++z){q={x:t["x"+z],y:t["y"+z]};m=OpenLayers.Geometry.distanceToSegment(q,K);if(m.distance<D){if(v){g=new OpenLayers.Geometry.Point(q.x,q.y);}else{g=true;}break outer;}}}}}return g;};OpenLayers.Geometry.distanceToSegment=function(o,e){var d=o.x;var m=o.y;var b=e.x1;var l=e.y1;var a=e.x2;var g=e.y2;var r=a-b;var q=g-l;var j=((r*(d-b))+(q*(m-l)))/(Math.pow(r,2)+Math.pow(q,2));var h,f;if(j<=0){h=b;f=l;}else{if(j>=1){h=a;f=g;}else{h=b+j*r;f=l+j*q;}}return{distance:Math.sqrt(Math.pow(h-d,2)+Math.pow(f-m,2)),x:h,y:f};};OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",autoActivate:false,active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners);}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners);}this.events.destroy();this.events=null;}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null;}if(this.handlers){for(var a in this.handlers){if(this.handlers.hasOwnProperty(a)&&typeof this.handlers[a].destroy=="function"){this.handlers[a].destroy();}}this.handlers=null;}if(this.map){this.map.removeControl(this);this.map=null;}},setMap:function(a){this.map=a;if(this.handler){this.handler.setMap(a);}},draw:function(a){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=OpenLayers.Function.False;}if(this.title!=""){this.div.title=this.title;}}if(a!=null){this.position=a.clone();}this.moveTo(this.position);return this.div;},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px";}},activate:function(){if(this.active){return false;}if(this.handler){this.handler.activate();}this.active=true;if(this.map){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");}this.events.triggerEvent("activate");return true;},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate();}this.active=false;if(this.map){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");}this.events.triggerEvent("deactivate");return true;}return false;},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(a){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);this.removeButtons();this.buttons=null;this.position=null;},draw:function(b){OpenLayers.Control.prototype.draw.apply(this,arguments);b=this.position;this.buttons=[];var d=new OpenLayers.Size(18,18);var a=new OpenLayers.Pixel(b.x+d.w/2,b.y);this._addButton("panup","north-mini.png",a,d);b.y=a.y+d.h;this._addButton("panleft","west-mini.png",b,d);this._addButton("panright","east-mini.png",b.add(d.w,0),d);this._addButton("pandown","south-mini.png",a.add(0,d.h*2),d);this._addButton("zoomin","zoom-plus-mini.png",a.add(0,d.h*3+5),d);this._addButton("zoomworld","zoom-world-mini.png",a.add(0,d.h*4+5),d);this._addButton("zoomout","zoom-minus-mini.png",a.add(0,d.h*5+5),d);return this.div;},_addButton:function(a,e,l,h){var g=OpenLayers.Util.getImagesLocation()+e;var b=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,l,h,g,"absolute");this.div.appendChild(b);OpenLayers.Event.observe(b,"mousedown",OpenLayers.Function.bindAsEventListener(this.buttonDown,b));OpenLayers.Event.observe(b,"dblclick",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));OpenLayers.Event.observe(b,"click",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));b.action=a;b.map=this.map;if(!this.slideRatio){var d=this.slideFactor;var f=function(){return d;};}else{var j=this.slideRatio;var f=function(m){return this.map.getSize()[m]*j;};}b.getSlideFactor=f;this.buttons.push(b);return b;},_removeButton:function(a){OpenLayers.Event.stopObservingElement(a);a.map=null;a.getSlideFactor=null;this.div.removeChild(a);OpenLayers.Util.removeItem(this.buttons,a);},removeButtons:function(){for(var a=this.buttons.length-1;a>=0;--a){this._removeButton(this.buttons[a]);}},doubleClick:function(a){OpenLayers.Event.stop(a);return false;},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return;}switch(this.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent();break;}OpenLayers.Event.stop(a);},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,divEvents:null,zoomWorldIcon:false,forceFixedZoomLevel:false,mouseDragStart:null,zoomStart:null,initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments);},destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart;},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.register("changebaselayer",this,this.redraw);},redraw:function(){if(this.div!=null){this.removeButtons();this._removeZoomBar();}this.draw();},draw:function(b){OpenLayers.Control.prototype.draw.apply(this,arguments);b=this.position.clone();this.buttons=[];var e=new OpenLayers.Size(18,18);var a=new OpenLayers.Pixel(b.x+e.w/2,b.y);var d=e.w;if(this.zoomWorldIcon){a=new OpenLayers.Pixel(b.x+e.w,b.y);}this._addButton("panup","north-mini.png",a,e);b.y=a.y+e.h;this._addButton("panleft","west-mini.png",b,e);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",b.add(e.w,0),e);d*=2;}this._addButton("panright","east-mini.png",b.add(d,0),e);this._addButton("pandown","south-mini.png",a.add(0,e.h*2),e);this._addButton("zoomin","zoom-plus-mini.png",a.add(0,e.h*3+5),e);a=this._addZoomBar(a.add(0,e.h*4+5));this._addButton("zoomout","zoom-minus-mini.png",a,e);return this.div;},_addZoomBar:function(a){var f=OpenLayers.Util.getImagesLocation();var h=this.id+"_"+this.map.id;var b=this.map.getNumZoomLevels()-1-this.map.getZoom();var d=OpenLayers.Util.createAlphaImageDiv(h,a.add(-1,b*this.zoomStopHeight),new OpenLayers.Size(20,9),f+"slider.png","absolute");
this.slider=d;this.sliderEvents=new OpenLayers.Events(this,d,null,true,{includeXY:true});this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var e=new OpenLayers.Size();e.h=this.zoomStopHeight*this.map.getNumZoomLevels();e.w=this.zoomStopWidth;var g=null;if(OpenLayers.Util.alphaHack()){var h=this.id+"_"+this.map.id;g=OpenLayers.Util.createAlphaImageDiv(h,a,new OpenLayers.Size(e.w,this.zoomStopHeight),f+"zoombar.png","absolute",null,"crop");g.style.height=e.h+"px";}else{g=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,e,f+"zoombar.png");}this.zoombarDiv=g;this.divEvents=new OpenLayers.Events(this,g,null,true,{includeXY:true});this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(g);this.startTop=parseInt(g.style.top);this.div.appendChild(d);this.map.events.register("zoomend",this,this.moveZoomBar);a=a.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());return a;},_removeZoomBar:function(){this.sliderEvents.un({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});this.sliderEvents.destroy();this.divEvents.un({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.divEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar);},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a);},divClick:function(a){if(!OpenLayers.Event.isLeftClick(a)){return;}var f=a.xy.y;var e=OpenLayers.Util.pagePosition(a.object)[1];var d=(f-e)/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom){d=Math.floor(d);}var b=(this.map.getNumZoomLevels()-1)-d;b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(b);OpenLayers.Event.stop(a);},zoomBarDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return;}this.map.events.on({mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=a.xy.clone();this.zoomStart=a.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(a);},zoomBarDrag:function(b){if(this.mouseDragStart!=null){var a=this.mouseDragStart.y-b.xy.y;var e=OpenLayers.Util.pagePosition(this.zoombarDiv);if((b.clientY-e[1])>0&&(b.clientY-e[1])<parseInt(this.zoombarDiv.style.height)-2){var d=parseInt(this.slider.style.top)-a;this.slider.style.top=d+"px";this.mouseDragStart=b.xy.clone();}OpenLayers.Event.stop(b);}},zoomBarUp:function(b){if(!OpenLayers.Event.isLeftClick(b)){return;}if(this.mouseDragStart){this.div.style.cursor="";this.map.events.un({mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var a=this.zoomStart.y-b.xy.y;var d=this.map.zoom;if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){d+=a/this.zoomStopHeight;d=Math.min(Math.max(d,0),this.map.getNumZoomLevels()-1);}else{d+=Math.round(a/this.zoomStopHeight);}this.map.zoomTo(d);this.mouseDragStart=null;this.zoomStart=null;OpenLayers.Event.stop(b);}},moveZoomBar:function(){var a=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px";},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:false,initialize:function(a){this.easing=(a)?a:OpenLayers.Easing.Expo.easeOut;},start:function(d,b,e,a){this.playing=true;this.begin=d;this.finish=b;this.duration=e;this.callbacks=a.callbacks;this.time=0;if(this.interval){window.clearInterval(this.interval);this.interval=null;}if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin);}this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL);},stop:function(){if(!this.playing){return;}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish);}window.clearInterval(this.interval);this.interval=null;this.playing=false;},play:function(){var g={};for(var d in this.begin){var a=this.begin[d];var e=this.finish[d];if(a==null||e==null||isNaN(a)||isNaN(e)){OpenLayers.Console.error("invalid value for Tween");}var h=e-a;g[d]=this.easing.apply(this,[this.time,a,h,this.duration]);}this.time++;if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,g);}if(this.time>this.duration){this.stop();}},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(e,a,g,f){return g*e/f+a;},easeOut:function(e,a,g,f){return g*e/f+a;},easeInOut:function(e,a,g,f){return g*e/f+a;},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(e,a,g,f){return(e==0)?a:g*Math.pow(2,10*(e/f-1))+a;},easeOut:function(e,a,g,f){return(e==f)?a+g:g*(-Math.pow(2,-10*e/f)+1)+a;},easeInOut:function(e,a,g,f){if(e==0){return a;}if(e==f){return a+g;}if((e/=f/2)<1){return g/2*Math.pow(2,10*(e-1))+a;}return g/2*(-Math.pow(2,-10*--e)+2)+a;},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(e,a,g,f){return g*(e/=f)*e+a;},easeOut:function(e,a,g,f){return -g*(e/=f)*(e-2)+a;},easeInOut:function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e+a;}return -g/2*((--e)*(e-2)-1)+a;},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},EVENT_TYPES:["preaddlayer","addlayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,initialize:function(j,e){if(arguments.length===1&&typeof j==="object"){e=j;j=e&&e.div;}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,e);this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(j);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px";}OpenLayers.Element.addClass(this.div,"olMap");var h=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(h,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);h=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(h);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:true});this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners);}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize);
}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy);}if(this.theme){var g=true;var d=document.getElementsByTagName("link");for(var f=0,a=d.length;f<a;++f){if(OpenLayers.Util.isEquivalentUrl(d.item(f).href,this.theme)){g=false;break;}}if(g){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(b);}}if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()];}else{this.controls=[];}}for(var f=0,a=this.controls.length;f<a;f++){this.addControlToMap(this.controls[f]);}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(e&&e.layers){this.addLayers(e.layers);if(e.center){this.setCenter(e.center,e.zoom);}}},render:function(a){this.div=OpenLayers.Util.getElement(a);OpenLayers.Element.addClass(this.div,"olMap");this.events.attachToElement(this.div);this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize();},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false;}if(this.panTween){this.panTween.stop();this.panTween=null;}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy);}else{this.events.unregister("resize",this,this.updateSize);}this.paddingForPopups=null;if(this.controls!=null){for(var a=this.controls.length-1;a>=0;--a){this.controls[a].destroy();}this.controls=null;}if(this.layers!=null){for(var a=this.layers.length-1;a>=0;--a){this.layers[a].destroy(false);}this.layers=null;}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv);}this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null;}this.events.destroy();this.events=null;},setOptions:function(a){OpenLayers.Util.extend(this,a);},getTileSize:function(){return this.tileSize;},getBy:function(f,d,a){var e=(typeof a.test=="function");var b=OpenLayers.Array.filter(this[f],function(g){return g[d]==a||(e&&a.test(g[d]));});return b;},getLayersBy:function(b,a){return this.getBy("layers",b,a);},getLayersByName:function(a){return this.getLayersBy("name",a);},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a);},getControlsBy:function(b,a){return this.getBy("controls",b,a);},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a);},getLayer:function(f){var b=null;for(var e=0,a=this.layers.length;e<a;e++){var d=this.layers[e];if(d.id==f){b=d;break;}}return b;},setLayerZIndex:function(b,a){b.setZIndex(this.Z_INDEX_BASE[b.isBaseLayer?"BaseLayer":"Overlay"]+a*5);},resetLayersZIndex:function(){for(var d=0,a=this.layers.length;d<a;d++){var b=this.layers[d];this.setLayerZIndex(b,d);}},addLayer:function(d){for(var b=0,a=this.layers.length;b<a;b++){if(this.layers[b]==d){var e=OpenLayers.i18n("layerAlreadyAdded",{layerName:d.name});OpenLayers.Console.warn(e);return false;}}if(this.allOverlays){d.isBaseLayer=false;}if(this.events.triggerEvent("preaddlayer",{layer:d})===false){return;}d.div.className="olLayerDiv";d.div.style.overflow="";this.setLayerZIndex(d,this.layers.length);if(d.isFixed){this.viewPortDiv.appendChild(d.div);}else{this.layerContainerDiv.appendChild(d.div);}this.layers.push(d);d.setMap(this);if(d.isBaseLayer||(this.allOverlays&&!this.baseLayer)){if(this.baseLayer==null){this.setBaseLayer(d);}else{d.setVisibility(false);}}else{d.redraw();}this.events.triggerEvent("addlayer",{layer:d});d.afterAdd();},addLayers:function(d){for(var b=0,a=d.length;b<a;b++){this.addLayer(d[b]);}},removeLayer:function(d,f){if(f==null){f=true;}if(d.isFixed){this.viewPortDiv.removeChild(d.div);}else{this.layerContainerDiv.removeChild(d.div);}OpenLayers.Util.removeItem(this.layers,d);d.removeMap(this);d.map=null;if(this.baseLayer==d){this.baseLayer=null;if(f){for(var b=0,a=this.layers.length;b<a;b++){var e=this.layers[b];if(e.isBaseLayer||this.allOverlays){this.setBaseLayer(e);break;}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:d});},getNumLayers:function(){return this.layers.length;},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a);},setLayerIndex:function(e,b){var f=this.getLayerIndex(e);if(b<0){b=0;}else{if(b>this.layers.length){b=this.layers.length;}}if(f!=b){this.layers.splice(f,1);this.layers.splice(b,0,e);for(var d=0,a=this.layers.length;d<a;d++){this.setLayerZIndex(this.layers[d],d);}this.events.triggerEvent("changelayer",{layer:e,property:"order"});if(this.allOverlays){if(b===0){this.setBaseLayer(e);}else{if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0]);}}}}},raiseLayer:function(b,d){var a=this.getLayerIndex(b)+d;this.setLayerIndex(b,a);},setBaseLayer:function(d){if(d!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,d)!=-1){var a=this.getCenter();var e=OpenLayers.Util.getResolutionFromScale(this.getScale(),d.units);if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false);}this.baseLayer=d;this.viewRequestID++;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(true);}if(a!=null){var b=this.getZoomForResolution(e||this.resolution,true);this.setCenter(a,b,false,true);}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer});}}},addControl:function(b,a){this.controls.push(b);this.addControlToMap(b,a);},addControls:function(b,h){var f=(arguments.length===1)?[]:h;for(var e=0,a=b.length;e<a;e++){var g=b[e];var d=(f[e])?f[e]:null;this.addControl(g,d);}},addControlToMap:function(b,a){b.outsideViewport=(b.div!=null);if(this.displayProjection&&!b.displayProjection){b.displayProjection=this.displayProjection;}b.setMap(this);var d=b.draw(a);if(d){if(!b.outsideViewport){d.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(d);}}if(b.autoActivate){b.activate();}},getControl:function(f){var b=null;for(var d=0,a=this.controls.length;d<a;d++){var e=this.controls[d];if(e.id==f){b=e;break;}}return b;},removeControl:function(a){if((a)&&(a==this.getControl(a.id))){if(a.div&&(a.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(a.div);}OpenLayers.Util.removeItem(this.controls,a);}},addPopup:function(a,e){if(e){for(var b=this.popups.length-1;b>=0;--b){this.removePopup(this.popups[b]);}}a.map=this;this.popups.push(a);var d=a.draw();if(d){d.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(d);}},removePopup:function(a){OpenLayers.Util.removeItem(this.popups,a);if(a.div){try{this.layerContainerDiv.removeChild(a.div);}catch(b){}}a.map=null;},getSize:function(){var a=null;if(this.size!=null){a=this.size.clone();}return a;},updateSize:function(){var d=this.getCurrentSize();if(d&&!isNaN(d.h)&&!isNaN(d.w)){this.events.clearMouseCache();var g=this.getSize();if(g==null){this.size=g=d;}if(!d.equals(g)){this.size=d;for(var e=0,b=this.layers.length;e<b;e++){this.layers[e].onMapResize();}var a=this.getCenter();if(this.baseLayer!=null&&a!=null){var f=this.getZoom();this.zoom=null;this.setCenter(a,f);}}}},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=this.div.offsetWidth;a.h=this.div.offsetHeight;}if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=parseInt(this.div.style.width);a.h=parseInt(this.div.style.height);}return a;},calculateBounds:function(a,b){var f=null;if(a==null){a=this.getCenter();}if(b==null){b=this.getResolution();}if((a!=null)&&(b!=null)){var e=this.getSize();var g=e.w*b;var d=e.h*b;f=new OpenLayers.Bounds(a.lon-g/2,a.lat-d/2,a.lon+g/2,a.lat+d/2);}return f;
},getCenter:function(){var a=null;if(this.center){a=this.center.clone();}return a;},getZoom:function(){return this.zoom;},pan:function(e,d,f){f=OpenLayers.Util.applyDefaults(f,{animate:true,dragging:false});var g=this.getViewPortPxFromLonLat(this.getCenter());var b=g.add(e,d);if(!f.dragging||!b.equals(g)){var a=this.getLonLatFromViewPortPx(b);if(f.animate){this.panTo(a);}else{this.setCenter(a,null,f.dragging);}}},panTo:function(b){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(b)){if(!this.panTween){this.panTween=new OpenLayers.Tween(this.panMethod);}var a=this.getCenter();if(b.lon==a.lon&&b.lat==a.lat){return;}var e={lon:a.lon,lat:a.lat};var d={lon:b.lon,lat:b.lat};this.panTween.start(e,d,this.panDuration,{callbacks:{start:OpenLayers.Function.bind(function(f){this.events.triggerEvent("movestart");},this),eachStep:OpenLayers.Function.bind(function(f){f=new OpenLayers.LonLat(f.lon,f.lat);this.moveTo(f,this.zoom,{dragging:true,noEvent:true});},this),done:OpenLayers.Function.bind(function(f){f=new OpenLayers.LonLat(f.lon,f.lat);this.moveTo(f,this.zoom,{noEvent:true});this.events.triggerEvent("moveend");},this)}});}else{this.setCenter(b);}},setCenter:function(d,a,b,e){this.moveTo(d,a,{dragging:b,forceZoomChange:e,caller:"setCenter"});},moveTo:function(h,r,u){if(!u){u={};}if(r!=null){r=parseFloat(r);if(!this.fractionalZoom){r=Math.round(r);}}var q=u.dragging;var d=u.forceZoomChange;var j=u.noEvent;if(this.panTween&&u.caller=="setCenter"){this.panTween.stop();}if(!this.center&&!this.isValidLonLat(h)){h=this.maxExtent.getCenterLonLat();}if(this.restrictedExtent!=null){if(h==null){h=this.getCenter();}if(r==null){r=this.getZoom();}var e=this.getResolutionForZoom(r);var s=this.calculateBounds(h,e);if(!this.restrictedExtent.containsBounds(s)){var t=this.restrictedExtent.getCenterLonLat();if(s.getWidth()>this.restrictedExtent.getWidth()){h=new OpenLayers.LonLat(t.lon,h.lat);}else{if(s.left<this.restrictedExtent.left){h=h.add(this.restrictedExtent.left-s.left,0);}else{if(s.right>this.restrictedExtent.right){h=h.add(this.restrictedExtent.right-s.right,0);}}}if(s.getHeight()>this.restrictedExtent.getHeight()){h=new OpenLayers.LonLat(h.lon,t.lat);}else{if(s.bottom<this.restrictedExtent.bottom){h=h.add(0,this.restrictedExtent.bottom-s.bottom);}else{if(s.top>this.restrictedExtent.top){h=h.add(0,this.restrictedExtent.top-s.top);}}}}}var b=d||((this.isValidZoomLevel(r))&&(r!=this.getZoom()));var f=(this.isValidLonLat(h))&&(!h.equals(this.center));if(b||f||!q){if(!this.dragging&&!j){this.events.triggerEvent("movestart");}if(f){if((!b)&&(this.center)){this.centerLayerContainer(h);}this.center=h.clone();}if((b)||(this.layerContainerOrigin==null)){this.layerContainerOrigin=this.center.clone();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px";}if(b){this.zoom=r;this.resolution=this.getResolutionForZoom(r);this.viewRequestID++;}var a=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(a,b,q);if(q){this.baseLayer.events.triggerEvent("move");}else{this.baseLayer.events.triggerEvent("moveend",{zoomChanged:b});}}a=this.baseLayer.getExtent();for(var g=0,m=this.layers.length;g<m;g++){var l=this.layers[g];if(l!==this.baseLayer&&!l.isBaseLayer){var o=l.calculateInRange();if(l.inRange!=o){l.inRange=o;if(!o){l.display(false);}this.events.triggerEvent("changelayer",{layer:l,property:"visibility"});}if(o&&l.visibility){l.moveTo(a,b,q);if(q){l.events.triggerEvent("move");}else{l.events.triggerEvent("moveend",{zoomChanged:b});}}}}if(b){for(var g=0,m=this.popups.length;g<m;g++){this.popups[g].updatePosition();}}this.events.triggerEvent("move");if(b){this.events.triggerEvent("zoomend");}}if(!q&&!j){this.events.triggerEvent("moveend");}this.dragging=!!q;},centerLayerContainer:function(b){var a=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var d=this.getViewPortPxFromLonLat(b);if((a!=null)&&(d!=null)){this.layerContainerDiv.style.left=Math.round(a.x-d.x)+"px";this.layerContainerDiv.style.top=Math.round(a.y-d.y)+"px";}},isValidZoomLevel:function(a){return((a!=null)&&(a>=0)&&(a<this.getNumZoomLevels()));},isValidLonLat:function(d){var b=false;if(d!=null){var a=this.getMaxExtent();b=a.containsLonLat(d);}return b;},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null;},getProjectionObject:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.projection;}return a;},getMaxResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.maxResolution;}return a;},getMaxExtent:function(b){var a=null;if(b&&b.restricted&&this.restrictedExtent){a=this.restrictedExtent;}else{if(this.baseLayer!=null){a=this.baseLayer.maxExtent;}}return a;},getNumZoomLevels:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.numZoomLevels;}return a;},getExtent:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getExtent();}return a;},getResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getResolution();}else{if(this.allOverlays===true&&this.layers.length>0){a=this.layers[0].getResolution();}}return a;},getUnits:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.units;}return a;},getScale:function(){var d=null;if(this.baseLayer!=null){var b=this.getResolution();var a=this.baseLayer.units;d=OpenLayers.Util.getScaleFromResolution(b,a);}return d;},getZoomForExtent:function(d,b){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getZoomForExtent(d,b);}return a;},getResolutionForZoom:function(b){var a=null;if(this.baseLayer){a=this.baseLayer.getResolutionForZoom(b);}return a;},getZoomForResolution:function(a,d){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getZoomForResolution(a,d);}return b;},zoomTo:function(a){if(this.isValidZoomLevel(a)){this.setCenter(null,a);}},zoomIn:function(){this.zoomTo(this.getZoom()+1);},zoomOut:function(){this.zoomTo(this.getZoom()-1);},zoomToExtent:function(e,d){var b=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var a=this.getMaxExtent();e=e.clone();while(e.right<e.left){e.right+=a.getWidth();}b=e.getCenterLonLat().wrapDateLine(a);}this.setCenter(b,this.getZoomForExtent(e,d));},zoomToMaxExtent:function(d){var b=(d)?d.restricted:true;var a=this.getMaxExtent({restricted:b});this.zoomToExtent(a);},zoomToScale:function(j,h){var e=OpenLayers.Util.getResolutionFromScale(j,this.baseLayer.units);var d=this.getSize();var g=d.w*e;var b=d.h*e;var a=this.getCenter();var f=new OpenLayers.Bounds(a.lon-g/2,a.lat-b/2,a.lon+g/2,a.lat+b/2);this.zoomToExtent(f,h);},getLonLatFromViewPortPx:function(a){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getLonLatFromViewPortPx(a);}return b;},getViewPortPxFromLonLat:function(b){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getViewPortPxFromLonLat(b);}return a;},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a);},getPixelFromLonLat:function(b){var a=this.getViewPortPxFromLonLat(b);a.x=Math.round(a.x);a.y=Math.round(a.y);return a;},getGeodesicPixelSize:function(h){var e=h?this.getLonLatFromPixel(h):(this.getCenter()||new OpenLayers.LonLat(0,0));var f=this.getResolution();var d=e.add(-f/2,0);var l=e.add(f/2,0);var b=e.add(0,-f/2);var g=e.add(0,f/2);var j=new OpenLayers.Projection("EPSG:4326");var a=this.getProjectionObject()||j;if(!a.equals(j)){d.transform(a,j);l.transform(a,j);b.transform(a,j);g.transform(a,j);}return new OpenLayers.Size(OpenLayers.Util.distVincenty(d,l),OpenLayers.Util.distVincenty(b,g));},getViewPortPxFromLayerPx:function(e){var d=null;if(e!=null){var b=parseInt(this.layerContainerDiv.style.left);var a=parseInt(this.layerContainerDiv.style.top);d=e.add(b,a);}return d;},getLayerPxFromViewPortPx:function(d){var e=null;if(d!=null){var b=-parseInt(this.layerContainerDiv.style.left);var a=-parseInt(this.layerContainerDiv.style.top);e=d.add(b,a);if(isNaN(e.x)||isNaN(e.y)){e=null;}}return e;},getLonLatFromLayerPx:function(a){a=this.getViewPortPxFromLayerPx(a);return this.getLonLatFromViewPortPx(a);},getLayerPxFromLonLat:function(b){var a=this.getPixelFromLonLat(b);
return this.getLayerPxFromViewPortPx(a);},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,initialize:function(b,a){OpenLayers.Util.extend(this,a);this.projCode=b;if(window.Proj4js){this.proj=new Proj4js.Proj(b);}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode;},getUnits:function(){return this.proj?this.proj.units:null;},toString:function(){return this.getCode();},equals:function(a){if(a&&a.getCode){return this.getCode()==a.getCode();}else{return false;}},destroy:function(){delete this.proj;delete this.projCode;},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.addTransform=function(d,b,a){if(!OpenLayers.Projection.transforms[d]){OpenLayers.Projection.transforms[d]={};}OpenLayers.Projection.transforms[d][b]=a;};OpenLayers.Projection.transform=function(a,d,b){if(d.proj&&b.proj){a=Proj4js.transform(d.proj,b.proj,a);}else{if(d&&b&&OpenLayers.Projection.transforms[d.getCode()]&&OpenLayers.Projection.transforms[d.getCode()][b.getCode()]){OpenLayers.Projection.transforms[d.getCode()][b.getCode()](a);}}return a;};OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend"],RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],metadata:{},initialize:function(b,a){this.addOptions(a);this.name=b;if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners);}}if(this.wrapDateLine){this.displayOutsideMaxExtent=true;}},destroy:function(a){if(a==null){a=true;}if(this.map!=null){this.map.removeLayer(this,a);}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners);}this.events.destroy();}this.eventListeners=null;this.events=null;},clone:function(a){if(a==null){a=new OpenLayers.Layer(this.name,this.getOptions());}OpenLayers.Util.applyDefaults(a,this);a.map=null;return a;},getOptions:function(){var a={};for(var b in this.options){a[b]=this[b];}return a;},setName:function(a){if(a!=this.name){this.name=a;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"});}}},addOptions:function(d){if(this.options==null){this.options={};}OpenLayers.Util.extend(this.options,d);OpenLayers.Util.extend(this,d);if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection);}if(this.projection&&this.projection.getUnits()){this.units=this.projection.getUnits();}if(this.map){var a=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var b in d){if(d.hasOwnProperty(b)&&OpenLayers.Util.indexOf(a,b)>=0){this.initResolutions();break;}}}},onMapResize:function(){},redraw:function(){var b=false;if(this.map){this.inRange=this.calculateInRange();var d=this.getExtent();if(d&&this.inRange&&this.visibility){var a=true;this.moveTo(d,a,false);this.events.triggerEvent("moveend",{zoomChanged:a});b=true;}}return b;},moveTo:function(b,a,d){var e=this.visibility;if(!this.isBaseLayer){e=e&&this.inRange;}this.display(e);},setMap:function(b){if(this.map==null){this.map=b;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection);}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var a=((this.visibility)&&(this.inRange));this.div.style.display=a?"":"none";}this.setTileSize();}},afterAdd:function(){},removeMap:function(a){},getImageSize:function(a){return(this.imageSize||this.tileSize);},setTileSize:function(a){var b=(a)?a:((this.tileSize)?this.tileSize:this.map.getTileSize());this.tileSize=b;if(this.gutter){this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter);this.imageSize=new OpenLayers.Size(b.w+(2*this.gutter),b.h+(2*this.gutter));}},getVisibility:function(){return this.visibility;},setVisibility:function(a){if(a!=this.visibility){this.visibility=a;this.display(a);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"});}this.events.triggerEvent("visibilitychanged");}},display:function(a){if(a!=(this.div.style.display!="none")){this.div.style.display=(a&&this.calculateInRange())?"block":"none";}},calculateInRange:function(){var b=false;if(this.alwaysInRange){b=true;}else{if(this.map){var a=this.map.getResolution();b=((a>=this.minResolution)&&(a<=this.maxResolution));}}return b;},setIsBaseLayer:function(a){if(a!=this.isBaseLayer){this.isBaseLayer=a;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this});}}},initResolutions:function(){var f,a;var g={},e=true;for(f=0,a=this.RESOLUTION_PROPERTIES.length;f<a;f++){var j=this.RESOLUTION_PROPERTIES[f];g[j]=this.options[j];if(e&&this.options[j]){e=false;}}if(this.alwaysInRange==null){this.alwaysInRange=e;}if(g.resolutions==null){g.resolutions=this.resolutionsFromScales(g.scales);}if(g.resolutions==null){g.resolutions=this.calculateResolutions(g);}if(g.resolutions==null){for(f=0,a=this.RESOLUTION_PROPERTIES.length;f<a;f++){var j=this.RESOLUTION_PROPERTIES[f];g[j]=this.options[j]!=null?this.options[j]:this.map[j];}if(g.resolutions==null){g.resolutions=this.resolutionsFromScales(g.scales);}if(g.resolutions==null){g.resolutions=this.calculateResolutions(g);}}var d;if(this.options.maxResolution&&this.options.maxResolution!=="auto"){d=this.options.maxResolution;}if(this.options.minScale){d=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units);}var b;if(this.options.minResolution&&this.options.minResolution!=="auto"){b=this.options.minResolution;}if(this.options.maxScale){b=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units);}if(g.resolutions){g.resolutions.sort(function(m,l){return(l-m);});if(!d){d=g.resolutions[0];}if(!b){var h=g.resolutions.length-1;b=g.resolutions[h];}}this.resolutions=g.resolutions;if(this.resolutions){a=this.resolutions.length;this.scales=new Array(a);for(f=0;f<a;f++){this.scales[f]=OpenLayers.Util.getScaleFromResolution(this.resolutions[f],this.units);}this.numZoomLevels=a;}this.minResolution=b;if(b){this.maxScale=OpenLayers.Util.getScaleFromResolution(b,this.units);}this.maxResolution=d;if(d){this.minScale=OpenLayers.Util.getScaleFromResolution(d,this.units);}},resolutionsFromScales:function(e){if(e==null){return;}var b,d,a;a=e.length;b=new Array(a);for(d=0;d<a;d++){b[d]=OpenLayers.Util.getResolutionFromScale(e[d],this.units);}return b;},calculateResolutions:function(m){var q=m.maxResolution;if(m.minScale!=null){q=OpenLayers.Util.getResolutionFromScale(m.minScale,this.units);}else{if(q=="auto"&&this.maxExtent!=null){var o=this.map.getSize();var l=this.maxExtent.getWidth()/o.w;var h=this.maxExtent.getHeight()/o.h;q=Math.max(l,h);}}var g=m.minResolution;if(m.maxScale!=null){g=OpenLayers.Util.getResolutionFromScale(m.maxScale,this.units);
}else{if(m.minResolution=="auto"&&this.minExtent!=null){var o=this.map.getSize();var l=this.minExtent.getWidth()/o.w;var h=this.minExtent.getHeight()/o.h;g=Math.max(l,h);}}var a=m.maxZoomLevel;var b=m.numZoomLevels;if(typeof g==="number"&&typeof q==="number"&&b===undefined){var j=q/g;b=Math.floor(Math.log(j)/Math.log(2))+1;}else{if(b===undefined&&a!=null){b=a+1;}}if(typeof b!=="number"||b<=0||(typeof q!=="number"&&typeof g!=="number")){return;}var e=new Array(b);var d=2;if(typeof g=="number"&&typeof q=="number"){d=Math.pow((q/g),(1/(b-1)));}var f;if(typeof q==="number"){for(f=0;f<b;f++){e[f]=q/Math.pow(d,f);}}else{for(f=0;f<b;f++){e[b-1-f]=g*Math.pow(d,f);}}return e;},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a);},getExtent:function(){return this.map.calculateBounds();},getZoomForExtent:function(b,d){var e=this.map.getSize();var a=Math.max(b.getWidth()/e.w,b.getHeight()/e.h);return this.getZoomForResolution(a,d);},getDataExtent:function(){},getResolutionForZoom:function(d){d=Math.max(0,Math.min(d,this.resolutions.length-1));var b;if(this.map.fractionalZoom){var a=Math.floor(d);var e=Math.ceil(d);b=this.resolutions[a]-((d-a)*(this.resolutions[a]-this.resolutions[e]));}else{b=this.resolutions[Math.round(d)];}return b;},getZoomForResolution:function(f,a){var r;if(this.map.fractionalZoom){var m=0;var d=this.resolutions.length-1;var e=this.resolutions[m];var b=this.resolutions[d];var l;for(var g=0,h=this.resolutions.length;g<h;++g){l=this.resolutions[g];if(l>=f){e=l;m=g;}if(l<=f){b=l;d=g;break;}}var j=e-b;if(j>0){r=m+((e-f)/j);}else{r=m;}}else{var o;var q=Number.POSITIVE_INFINITY;for(var g=0,h=this.resolutions.length;g<h;g++){if(a){o=Math.abs(this.resolutions[g]-f);if(o>q){break;}q=o;}else{if(this.resolutions[g]<f){break;}}}r=Math.max(0,g-1);}return r;},getLonLatFromViewPortPx:function(b){var f=null;if(b!=null){var e=this.map.getSize();var a=this.map.getCenter();if(a){var d=this.map.getResolution();var h=b.x-(e.w/2);var g=b.y-(e.h/2);f=new OpenLayers.LonLat(a.lon+h*d,a.lat-g*d);if(this.wrapDateLine){f=f.wrapDateLine(this.maxExtent);}}}return f;},getViewPortPxFromLonLat:function(e){var b=null;if(e!=null){var a=this.map.getResolution();var d=this.map.getExtent();b=new OpenLayers.Pixel((1/a*(e.lon-d.left)),(1/a*(d.top-e.lat)));}return b;},setOpacity:function(b){if(b!=this.opacity){this.opacity=b;for(var e=0,a=this.div.childNodes.length;e<a;++e){var d=this.div.childNodes[e].firstChild;OpenLayers.Util.modifyDOMElement(d,null,null,null,null,null,null,b);}if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"});}}},getZIndex:function(){return this.div.style.zIndex;},setZIndex:function(a){this.div.style.zIndex=a;},adjustBounds:function(b){if(this.gutter){var a=this.gutter*this.map.getResolution();b=new OpenLayers.Bounds(b.left-a,b.bottom-a,b.right+a,b.top+a);}if(this.wrapDateLine){var d={rightTolerance:this.getResolution()};b=b.wrapDateLine(this.maxExtent,d);}return b;},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(e,a,f,b,d){this.layer=e;this.position=a.clone();this.bounds=f.clone();this.url=b;this.size=d.clone();this.id=OpenLayers.Util.createUniqueID("Tile_");this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload");}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.events.destroy();this.events=null;},clone:function(a){if(a==null){a=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size);}OpenLayers.Util.applyDefaults(a,this);return a;},draw:function(){var a=this.layer.maxExtent;var b=(a&&this.bounds.intersectsBounds(a,false));this.shouldDraw=(b||this.layer.displayOutsideMaxExtent);this.clear();return this.shouldDraw;},moveTo:function(b,a,d){if(d==null){d=true;}this.bounds=b.clone();this.position=a.clone();if(d){this.draw();}},clear:function(){},getBoundsFromBaseLayer:function(a){var g=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(g);var e=this.layer.map.getLonLatFromLayerPx(a);var d=a.clone();d.x+=this.size.w;d.y+=this.size.h;var b=this.layer.map.getLonLatFromLayerPx(d);if(e.lon>b.lon){if(e.lon<0){e.lon=-180-(e.lon+180);}else{b.lon=180+b.lon+180;}}var f=new OpenLayers.Bounds(e.lon,b.lat,b.lon,e.lat);return f;},showTile:function(){if(this.shouldDraw){this.show();}},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:false,lastRatio:1,isFirstDraw:true,backBufferTile:null,initialize:function(e,a,f,b,d){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=b;this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute";this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();},destroy:function(){if(this.imgDiv!=null){if(this.layerAlphaHack){OpenLayers.Event.stopObservingElement(this.imgDiv.childNodes[0]);}OpenLayers.Event.stopObservingElement(this.imgDiv);if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null;}this.imgDiv.urls=null;this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif";}this.imgDiv=null;if((this.frame!=null)&&(this.frame.parentNode==this.layer.div)){this.layer.div.removeChild(this.frame);}this.frame=null;if(this.backBufferTile){this.backBufferTile.destroy();this.backBufferTile=null;}this.layer.events.unregister("loadend",this,this.resetBackBuffer);OpenLayers.Tile.prototype.destroy.apply(this,arguments);},clone:function(a){if(a==null){a=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size);}a=OpenLayers.Tile.prototype.clone.apply(this,[a]);a.imgDiv=null;return a;},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position);}var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if((OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1)||this.layer.singleTile){if(a){if(!this.backBufferTile){this.backBufferTile=this.clone();this.backBufferTile.hide();this.backBufferTile.isBackBuffer=true;this.events.register("loadend",this,this.resetBackBuffer);this.layer.events.register("loadend",this,this.resetBackBuffer);}this.startTransition();}else{if(this.backBufferTile){this.backBufferTile.clear();}}}else{if(a&&this.isFirstDraw){this.events.register("loadend",this,this.showTile);this.isFirstDraw=false;}}if(!a){return false;}if(this.isLoading){this.events.triggerEvent("reload");}else{this.isLoading=true;this.events.triggerEvent("loadstart");}return this.renderTile();},resetBackBuffer:function(){this.showTile();if(this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=false;var a=this.layer.maxExtent;var b=(a&&this.bounds.intersectsBounds(a,false));if(b){this.backBufferTile.position=this.position;this.backBufferTile.bounds=this.bounds;this.backBufferTile.size=this.size;this.backBufferTile.imageSize=this.layer.getImageSize(this.bounds)||this.size;this.backBufferTile.imageOffset=this.layer.imageOffset;this.backBufferTile.resolution=this.layer.getResolution();this.backBufferTile.renderTile();}this.backBufferTile.hide();}},renderTile:function(){if(this.imgDiv==null){this.initImgDiv();}this.imgDiv.viewRequestID=this.layer.map.viewRequestID;if(this.layer.async){this.layer.getURLasync(this.bounds,this,"url",this.positionImage);}else{if(this.layer.url instanceof Array){this.imgDiv.urls=this.layer.url.slice();}this.url=this.layer.getURL(this.bounds);this.positionImage();}return true;},positionImage:function(){if(this.layer===null){return;}OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);
var a=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,a,this.url);}else{OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,a);this.imgDiv.src=this.url;}},clear:function(){if(this.imgDiv){this.hide();if(OpenLayers.Tile.Image.useBlankTile){this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif";}}},initImgDiv:function(){var e=this.layer.imageOffset;var b=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,e,b,null,"relative",null,null,null,true);}else{this.imgDiv=OpenLayers.Util.createImage(null,e,b,null,"relative",null,null,true);}this.imgDiv.className="olTileImage";this.frame.style.zIndex=this.isBackBuffer?0:1;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity);}this.imgDiv.map=this.layer.map;var d=function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend");}};if(this.layerAlphaHack){OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(d,this));}else{OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(d,this));}var a=function(){if(this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS){d.call(this);}};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(a,this));},checkImgURL:function(){if(this.layer){var a=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;if(!OpenLayers.Util.isEquivalentUrl(a,this.url)){this.hide();}}},startTransition:function(){if(!this.backBufferTile||!this.backBufferTile.imgDiv){return;}var e=1;if(this.backBufferTile.resolution){e=this.backBufferTile.resolution/this.layer.getResolution();}if(e!=this.lastRatio){if(this.layer.transitionEffect=="resize"){var d=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top);var b=new OpenLayers.Size(this.backBufferTile.size.w*e,this.backBufferTile.size.h*e);var a=this.layer.map.getLayerPxFromLonLat(d);OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,a,b);var f=this.backBufferTile.imageSize;f=new OpenLayers.Size(f.w*e,f.h*e);var g=this.backBufferTile.imageOffset;if(g){g=new OpenLayers.Pixel(g.x*e,g.y*e);}OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,g,f);this.backBufferTile.show();}}else{if(this.layer.singleTile){this.backBufferTile.show();}else{this.backBufferTile.hide();}}this.lastRatio=e;},show:function(){this.frame.style.display="";if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.frame.scrollLeft=this.frame.scrollLeft;}}},hide:function(){this.frame.style.display="none";},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.useBlankTile=(OpenLayers.Util.getBrowserName()=="safari"||OpenLayers.Util.getBrowserName()=="opera");OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(d,b,f,e,a){this.url=b;this.extent=f;this.maxExtent=f;this.size=e;OpenLayers.Layer.prototype.initialize.apply(this,[d,a]);this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w);},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null;}OpenLayers.Layer.prototype.destroy.apply(this,arguments);},clone:function(a){if(a==null){a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions());}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a;},setMap:function(a){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w;}OpenLayers.Layer.prototype.setMap.apply(this,arguments);},moveTo:function(f,a,g){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var b=(this.tile==null);if(a||b){this.setTileSize();var e=new OpenLayers.LonLat(this.extent.left,this.extent.top);var d=this.map.getLayerPxFromLonLat(e);if(b){this.tile=new OpenLayers.Tile.Image(this,d,this.extent,null,this.tileSize);this.addTileMonitoringHooks(this.tile);}else{this.tile.size=this.tileSize.clone();this.tile.position=d.clone();}this.tile.draw();}},setTileSize:function(){var b=this.extent.getWidth()/this.map.getResolution();var a=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(b,a);},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("loadstart");};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.events.triggerEvent("loadend");};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd);},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this});},setUrl:function(a){this.url=a;this.tile.draw();},getURL:function(a){return this.url;},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(a!=null){this.addComponents(a);}},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments);},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");for(var i=0,len=this.components.length;i<len;i++){geometry.addComponent(this.components[i].clone());}OpenLayers.Util.applyDefaults(geometry,this);return geometry;},getComponentsString:function(){var b=[];for(var d=0,a=this.components.length;d<a;d++){b.push(this.components[d].toShortString());}return b.join(",");},calculateBounds:function(){this.bounds=null;if(this.components&&this.components.length>0){this.setBounds(this.components[0].getBounds());for(var b=1,a=this.components.length;b<a;b++){this.extendBounds(this.components[b].getBounds());}}},addComponents:function(d){if(!(d instanceof Array)){d=[d];}for(var b=0,a=d.length;b<a;b++){this.addComponent(d[b]);}},addComponent:function(b,a){var e=false;if(b){if(this.componentTypes==null||(OpenLayers.Util.indexOf(this.componentTypes,b.CLASS_NAME)>-1)){if(a!=null&&(a<this.components.length)){var f=this.components.slice(0,a);var d=this.components.slice(a,this.components.length);f.push(b);this.components=f.concat(d);}else{this.components.push(b);}b.parent=this;this.clearBounds();e=true;}}return e;},removeComponents:function(b){if(!(b instanceof Array)){b=[b];}for(var a=b.length-1;a>=0;--a){this.removeComponent(b[a]);}},removeComponent:function(a){OpenLayers.Util.removeItem(this.components,a);this.clearBounds();},getLength:function(){var d=0;for(var b=0,a=this.components.length;b<a;b++){d+=this.components[b].getLength();}return d;},getArea:function(){var d=0;for(var b=0,a=this.components.length;b<a;b++){d+=this.components[b].getArea();}return d;},getGeodesicArea:function(b){var e=0;for(var d=0,a=this.components.length;d<a;d++){e+=this.components[d].getGeodesicArea(b);}return e;},getCentroid:function(h){if(!h){return this.components.length&&this.components[0].getCentroid();}var o=this.components.length;if(!o){return false;}var b=[];var d=[];var e=0;var j=Number.MAX_VALUE;var q;for(var m=0;m<o;++m){q=this.components[m];var f=q.getArea();var g=q.getCentroid(true);if(isNaN(f)||isNaN(g.x)||isNaN(g.y)){continue;}b.push(f);e+=f;j=(f<j&&f>0)?f:j;d.push(g);}o=b.length;if(e===0){for(var m=0;m<o;++m){b[m]=1;}e=b.length;}else{for(var m=0;m<o;++m){b[m]/=j;}e/=j;}var l=0,a=0,g,f;for(var m=0;m<o;++m){g=d[m];f=b[m];l+=g.x*f;a+=g.y*f;}return new OpenLayers.Geometry.Point(l/e,a/e);},getGeodesicLength:function(b){var e=0;for(var d=0,a=this.components.length;d<a;d++){e+=this.components[d].getGeodesicLength(b);}return e;},move:function(b,e){for(var d=0,a=this.components.length;d<a;d++){this.components[d].move(b,e);
}},rotate:function(e,b){for(var d=0,a=this.components.length;d<a;++d){this.components[d].rotate(e,b);}},resize:function(e,a,d){for(var b=0;b<this.components.length;++b){this.components[b].resize(e,a,d);}return this;},distanceTo:function(j,l){var d=!(l&&l.edge===false);var a=d&&l&&l.details;var m,e,b;var f=Number.POSITIVE_INFINITY;for(var g=0,h=this.components.length;g<h;++g){m=this.components[g].distanceTo(j,l);b=a?m.distance:m;if(b<f){f=b;e=m;if(f==0){break;}}}return e;},equals:function(e){var b=true;if(!e||!e.CLASS_NAME||(this.CLASS_NAME!=e.CLASS_NAME)){b=false;}else{if(!(e.components instanceof Array)||(e.components.length!=this.components.length)){b=false;}else{for(var d=0,a=this.components.length;d<a;++d){if(!this.components[d].equals(e.components[d])){b=false;break;}}}}return b;},transform:function(f,d){if(f&&d){for(var e=0,a=this.components.length;e<a;e++){var b=this.components[e];b.transform(f,d);}this.bounds=null;}return this;},intersects:function(e){var b=false;for(var d=0,a=this.components.length;d<a;++d){b=e.intersects(this.components[d]);if(b){break;}}return b;},getVertices:function(b){var d=[];for(var e=0,a=this.components.length;e<a;++e){Array.prototype.push.apply(d,this.components[e].getVertices(b));}return d;},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b);},clone:function(a){if(a==null){a=new OpenLayers.Geometry.Point(this.x,this.y);}OpenLayers.Util.applyDefaults(a,this);return a;},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y);},distanceTo:function(g,m){var e=!(m&&m.edge===false);var a=e&&m&&m.details;var b,f,j,d,h,l;if(g instanceof OpenLayers.Geometry.Point){f=this.x;j=this.y;d=g.x;h=g.y;b=Math.sqrt(Math.pow(f-d,2)+Math.pow(j-h,2));l=!a?b:{x0:f,y0:j,x1:d,y1:h,distance:b};}else{l=g.distanceTo(this,m);if(a){l={x0:l.x1,y0:l.y1,x1:l.x0,y1:l.y0,distance:l.distance};}}return l;},equals:function(a){var b=false;if(a!=null){b=((this.x==a.x&&this.y==a.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)));}return b;},toShortString:function(){return(this.x+", "+this.y);},move:function(a,b){this.x=this.x+a;this.y=this.y+b;this.clearBounds();},rotate:function(e,b){e*=Math.PI/180;var a=this.distanceTo(b);var d=e+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+(a*Math.cos(d));this.y=b.y+(a*Math.sin(d));this.clearBounds();},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y);},resize:function(d,a,b){b=(b==undefined)?1:b;this.x=a.x+(d*b*(this.x-a.x));this.y=a.y+(d*(this.y-a.y));this.clearBounds();return this;},intersects:function(b){var a=false;if(b.CLASS_NAME=="OpenLayers.Geometry.Point"){a=this.equals(b);}else{a=b.intersects(this);}return a;},transform:function(b,a){if((b&&a)){OpenLayers.Projection.transform(this,b,a);this.bounds=null;}return this;},getVertices:function(a){return[this];},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},addPoint:function(a,b){this.addComponent(a,b);},removePoint:function(a){this.removeComponent(a);},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments);},getLength:function(){var d=0;if(this.components&&(this.components.length>1)){for(var b=1,a=this.components.length;b<a;b++){d+=this.components[b-1].distanceTo(this.components[b]);}}return d;},getGeodesicLength:function(b){var f=this;if(b){var d=new OpenLayers.Projection("EPSG:4326");if(!d.equals(b)){f=this.clone().transform(b,d);}}var g=0;if(f.components&&(f.components.length>1)){var j,h;for(var e=1,a=f.components.length;e<a;e++){j=f.components[e-1];h=f.components[e];g+=OpenLayers.Util.distVincenty({lon:j.x,lat:j.y},{lon:h.x,lat:h.y});}}return g*1000;},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(a){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments);},removeComponent:function(a){if(this.components&&(this.components.length>2)){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);}},intersects:function(q){var d=false;var o=q.CLASS_NAME;if(o=="OpenLayers.Geometry.LineString"||o=="OpenLayers.Geometry.LinearRing"||o=="OpenLayers.Geometry.Point"){var t=this.getSortedSegments();var r;if(o=="OpenLayers.Geometry.Point"){r=[{x1:q.x,y1:q.y,x2:q.x,y2:q.y}];}else{r=q.getSortedSegments();}var w,h,f,a,v,u,e,b;outer:for(var l=0,m=t.length;l<m;++l){w=t[l];h=w.x1;f=w.x2;a=w.y1;v=w.y2;inner:for(var g=0,s=r.length;g<s;++g){u=r[g];if(u.x1>f){break;}if(u.x2<h){continue;}e=u.y1;b=u.y2;if(Math.min(e,b)>Math.max(a,v)){continue;}if(Math.max(e,b)<Math.min(a,v)){continue;}if(OpenLayers.Geometry.segmentsIntersect(w,u)){d=true;break outer;}}}}else{d=q.intersects(this);}return d;},getSortedSegments:function(){var a=this.components.length-1;var b=new Array(a),f,e;for(var d=0;d<a;++d){f=this.components[d];e=this.components[d+1];if(f.x<e.x){b[d]={x1:f.x,y1:f.y,x2:e.x,y2:e.y};}else{b[d]={x1:e.x,y1:e.y,x2:f.x,y2:f.y};}}function g(j,h){return j.x1-h.x1;}return b.sort(g);},splitWithSegment:function(v,b){var d=!(b&&b.edge===false);var s=b&&b.tolerance;var a=[];var z=this.getVertices();var r=[];var C=[];var j=false;var f,e,o;var l,u,B;var g={point:true,tolerance:s};var h=null;for(var q=0,m=z.length-2;q<=m;++q){f=z[q];r.push(f.clone());e=z[q+1];B={x1:f.x,y1:f.y,x2:e.x,y2:e.y};o=OpenLayers.Geometry.segmentsIntersect(v,B,g);if(o instanceof OpenLayers.Geometry.Point){if((o.x===v.x1&&o.y===v.y1)||(o.x===v.x2&&o.y===v.y2)||o.equals(f)||o.equals(e)){u=true;}else{u=false;}if(u||d){if(!o.equals(C[C.length-1])){C.push(o.clone());}if(q===0){if(o.equals(f)){continue;}}if(o.equals(e)){continue;}j=true;if(!o.equals(f)){r.push(o);}a.push(new OpenLayers.Geometry.LineString(r));r=[o.clone()];}}}if(j){r.push(e.clone());a.push(new OpenLayers.Geometry.LineString(r));}if(C.length>0){var t=v.x1<v.x2?1:-1;var w=v.y1<v.y2?1:-1;h={lines:a,points:C.sort(function(E,D){return(t*E.x-t*D.x)||(w*E.y-w*D.y);})};}return h;},split:function(D,b){var q=null;var e=b&&b.mutual;var m,f,o,d;if(D instanceof OpenLayers.Geometry.LineString){var C=this.getVertices();var h,g,B,l,a,s;var v=[];o=[];for(var w=0,r=C.length-2;w<=r;++w){h=C[w];g=C[w+1];B={x1:h.x,y1:h.y,x2:g.x,y2:g.y};d=d||[D];if(e){v.push(h.clone());}for(var u=0;u<d.length;++u){l=d[u].splitWithSegment(B,b);if(l){a=l.lines;if(a.length>0){a.unshift(u,1);Array.prototype.splice.apply(d,a);u+=a.length-2;}if(e){for(var t=0,z=l.points.length;t<z;++t){s=l.points[t];if(!s.equals(h)){v.push(s);o.push(new OpenLayers.Geometry.LineString(v));if(s.equals(g)){v=[];}else{v=[s.clone()];}}}}}}}if(e&&o.length>0&&v.length>0){v.push(g.clone());o.push(new OpenLayers.Geometry.LineString(v));}}else{q=D.splitWith(this,b);}if(d&&d.length>1){f=true;}else{d=[];}if(o&&o.length>1){m=true;}else{o=[];}if(f||m){if(e){q=[o,d];}else{q=d;}}return q;},splitWith:function(b,a){return b.split(this,a);},getVertices:function(a){var b;if(a===true){b=[this.components[0],this.components[this.components.length-1]];}else{if(a===false){b=this.components.slice(1,this.components.length-1);}else{b=this.components.slice();}}return b;},distanceTo:function(l,h){var m=!(h&&h.edge===false);var G=m&&h&&h.details;var u,f={};var z=Number.POSITIVE_INFINITY;if(l instanceof OpenLayers.Geometry.Point){var v=this.getSortedSegments();var t=l.x;var s=l.y;var E;for(var C=0,D=v.length;C<D;++C){E=v[C];u=OpenLayers.Geometry.distanceToSegment(l,E);if(u.distance<z){z=u.distance;f=u;if(z===0){break;}}else{if(E.x2>t&&((s>E.y1&&s<E.y2)||(s<E.y1&&s>E.y2))){break;
}}}if(G){f={distance:f.distance,x0:f.x,y0:f.y,x1:t,y1:s};}else{f=f.distance;}}else{if(l instanceof OpenLayers.Geometry.LineString){var e=this.getSortedSegments();var d=l.getSortedSegments();var b,a,r,F,g;var q=d.length;var o={point:true};outer:for(var C=0,D=e.length;C<D;++C){b=e[C];F=b.x1;g=b.y1;for(var B=0;B<q;++B){a=d[B];r=OpenLayers.Geometry.segmentsIntersect(b,a,o);if(r){z=0;f={distance:0,x0:r.x,y0:r.y,x1:r.x,y1:r.y};break outer;}else{u=OpenLayers.Geometry.distanceToSegment({x:F,y:g},a);if(u.distance<z){z=u.distance;f={distance:z,x0:F,y0:g,x1:u.x,y1:u.y};}}}}if(!G){f=f.distance;}if(z!==0){if(b){u=l.distanceTo(new OpenLayers.Geometry.Point(b.x2,b.y2),h);var w=G?u.distance:u;if(w<z){if(G){f={distance:z,x0:u.x1,y0:u.y1,x1:u.x0,y1:u.y0};}else{f=w;}}}}}else{f=l.distanceTo(this,h);if(G){f={distance:f.distance,x0:f.x1,y0:f.y1,x1:f.x0,y1:f.y0};}}}return f;},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments);},addComponent:function(a,b){var d=false;var e=this.components.pop();if(b!=null||!a.equals(e)){d=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments);}var f=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[f]);return d;},removeComponent:function(a){if(this.components.length>4){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var b=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[b]);}},move:function(b,e){for(var d=0,a=this.components.length;d<a-1;d++){this.components[d].move(b,e);}},rotate:function(e,b){for(var d=0,a=this.components.length;d<a-1;++d){this.components[d].rotate(e,b);}},resize:function(f,b,e){for(var d=0,a=this.components.length;d<a-1;++d){this.components[d].resize(f,b,e);}return this;},transform:function(f,d){if(f&&d){for(var e=0,a=this.components.length;e<a-1;e++){var b=this.components[e];b.transform(f,d);}this.bounds=null;}return this;},getCentroid:function(){if(this.components&&(this.components.length>2)){var h=0;var g=0;for(var e=0;e<this.components.length-1;e++){var d=this.components[e];var l=this.components[e+1];h+=(d.x+l.x)*(d.x*l.y-l.x*d.y);g+=(d.y+l.y)*(d.x*l.y-l.x*d.y);}var f=-1*this.getArea();var a=h/(6*f);var j=g/(6*f);return new OpenLayers.Geometry.Point(a,j);}else{return null;}},getArea:function(){var g=0;if(this.components&&(this.components.length>2)){var f=0;for(var e=0,d=this.components.length;e<d-1;e++){var a=this.components[e];var h=this.components[e+1];f+=(a.x+h.x)*(h.y-a.y);}g=-f/2;}return g;},getGeodesicArea:function(b){var e=this;if(b){var d=new OpenLayers.Projection("EPSG:4326");if(!d.equals(b)){e=this.clone().transform(b,d);}}var g=0;var a=e.components&&e.components.length;if(a>2){var j,h;for(var f=0;f<a-1;f++){j=e.components[f];h=e.components[f+1];g+=OpenLayers.Util.rad(h.x-j.x)*(2+Math.sin(OpenLayers.Util.rad(j.y))+Math.sin(OpenLayers.Util.rad(h.y)));}g=g*6378137*6378137/2;}return g;},containsPoint:function(q){var w=OpenLayers.Number.limitSigDigs;var o=14;var m=w(q.x,o);var l=w(q.y,o);function v(E,B,D,z,C){return(((B-z)*E)+((z*D)-(B*C)))/(D-C);}var a=this.components.length-1;var h,g,u,e,s,b,f,d;var j=0;for(var r=0;r<a;++r){h=this.components[r];u=w(h.x,o);e=w(h.y,o);g=this.components[r+1];s=w(g.x,o);b=w(g.y,o);if(e==b){if(l==e){if(u<=s&&(m>=u&&m<=s)||u>=s&&(m<=u&&m>=s)){j=-1;break;}}continue;}f=w(v(l,u,e,s,b),o);if(f==m){if(e<b&&(l>=e&&l<=b)||e>b&&(l<=e&&l>=b)){j=-1;break;}}if(f<=m){continue;}if(u!=s&&(f<Math.min(u,s)||f>Math.max(u,s))){continue;}if(e<b&&(l>=e&&l<b)||e>b&&(l<e&&l>=b)){++j;}}var t=(j==-1)?1:!!(j&1);return t;},intersects:function(e){var b=false;if(e.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(e);}else{if(e.CLASS_NAME=="OpenLayers.Geometry.LineString"){b=e.intersects(this);}else{if(e.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);}else{for(var d=0,a=e.components.length;d<a;++d){b=e.components[d].intersects(this);if(b){break;}}}}}return b;},getVertices:function(a){return(a===true)?[]:this.components.slice(0,this.components.length-1);},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(e,b,a){OpenLayers.Util.extend(this,a);this.control=e;this.callbacks=b;var d=this.map||e.map;if(d){this.setMap(d);}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},setMap:function(a){this.map=a;},checkModifiers:function(a){if(this.keyMask==null){return true;}var b=(a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0);return(b==this.keyMask);},activate:function(){if(this.active){return false;}var d=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var b=0,a=d.length;b<a;b++){if(this[d[b]]){this.register(d[b],this[d[b]]);}}this.active=true;return true;},deactivate:function(){if(!this.active){return false;}var d=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var b=0,a=d.length;b<a;b++){if(this[d[b]]){this.unregister(d[b],this[d[b]]);}}this.active=false;return true;},callback:function(b,a){if(b&&this.callbacks[b]){this.callbacks[b].apply(this.control,a);}},register:function(a,b){this.map.events.registerPriority(a,this,b);this.map.events.registerPriority(a,this,this.setEvent);},unregister:function(a,b){this.map.events.unregister(a,this,b);this.map.events.unregister(a,this,this.setEvent);},setEvent:function(a){this.evt=a;return true;},destroy:function(){this.deactivate();this.control=this.map=null;},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,drawing:false,mouseDown:false,lastDown:null,lastUp:null,persist:false,layerOptions:null,initialize:function(d,b,a){if(!(a&&a.layerOptions&&a.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{});}OpenLayers.Handler.prototype.initialize.apply(this,arguments);},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false;}var a=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);return true;},createFeature:function(a){var b=this.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true});},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false;}if(this.drawing){this.cancel();}this.destroyFeature();if(this.layer.map!=null){this.layer.destroy(false);}this.layer=null;return true;},destroyFeature:function(){if(this.layer){this.layer.destroyFeatures();}this.point=null;},finalize:function(b){var a=b?"cancel":"done";this.drawing=false;this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.callback(a,[this.geometryClone()]);if(b||!this.persist){this.destroyFeature();}},cancel:function(){this.finalize(true);},click:function(a){OpenLayers.Event.stop(a);return false;},dblclick:function(a){OpenLayers.Event.stop(a);return false;},modifyFeature:function(a){var b=this.map.getLonLatFromPixel(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.drawFeature();},drawFeature:function(){this.layer.drawFeature(this.point,this.style);},getGeometry:function(){var a=this.point&&this.point.geometry;
if(a&&this.multi){a=new OpenLayers.Geometry.MultiPoint([a]);}return a;},geometryClone:function(){var a=this.getGeometry();return a&&a.clone();},mousedown:function(a){if(!this.checkModifiers(a)){return true;}if(this.lastDown&&this.lastDown.equals(a.xy)){return true;}this.drawing=true;if(this.lastDown==null){if(this.persist){this.destroyFeature();}this.createFeature(a.xy);}else{this.modifyFeature(a.xy);}this.lastDown=a.xy;return false;},mousemove:function(a){if(this.drawing){this.modifyFeature(a.xy);}return true;},mouseup:function(a){if(this.drawing){this.finalize();return false;}else{return true;}},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,freehand:false,freehandToggle:"shiftKey",initialize:function(d,b,a){OpenLayers.Handler.Point.prototype.initialize.apply(this,arguments);},createFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:true});},destroyFeature:function(){OpenLayers.Handler.Point.prototype.destroyFeature.apply(this);this.line=null;},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point]);}},addPoint:function(a){this.layer.removeFeatures([this.point]);var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();},freehandMode:function(a){return(this.freehandToggle&&a[this.freehandToggle])?!this.freehand:this.freehand;},modifyFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.drawFeature();},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style);},getSketch:function(){return this.line;},getGeometry:function(){var a=this.line&&this.line.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiLineString([a]);}return a;},mousedown:function(a){if(this.lastDown&&this.lastDown.equals(a.xy)){return false;}if(this.lastDown==null){if(this.persist){this.destroyFeature();}this.createFeature(a.xy);}else{if((this.lastUp==null)||!this.lastUp.equals(a.xy)){this.addPoint(a.xy);}}this.mouseDown=true;this.lastDown=a.xy;this.drawing=true;return false;},mousemove:function(a){if(this.drawing){if(this.mouseDown&&this.freehandMode(a)){this.addPoint(a.xy);}else{this.modifyFeature(a.xy);}}return true;},mouseup:function(a){this.mouseDown=false;if(this.drawing){if(this.freehandMode(a)){this.removePoint();this.finalize();}else{if(this.lastUp==null){this.addPoint(a.xy);}this.lastUp=a.xy;}return false;}return true;},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[b]);this.removePoint();this.finalize();}return false;},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},getArea:function(){var d=0;if(this.components&&(this.components.length>0)){d+=Math.abs(this.components[0].getArea());for(var b=1,a=this.components.length;b<a;b++){d-=Math.abs(this.components[b].getArea());}}return d;},getGeodesicArea:function(b){var e=0;if(this.components&&(this.components.length>0)){e+=Math.abs(this.components[0].getGeodesicArea(b));for(var d=1,a=this.components.length;d<a;d++){e-=Math.abs(this.components[d].getGeodesicArea(b));}}return e;},containsPoint:function(a){var f=this.components.length;var d=false;if(f>0){d=this.components[0].containsPoint(a);if(d!==1){if(d&&f>1){var e;for(var b=1;b<f;++b){e=this.components[b].containsPoint(a);if(e){if(e===1){d=1;}else{d=false;}break;}}}}}return d;},intersects:function(f){var b=false;var e,a;if(f.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(f);}else{if(f.CLASS_NAME=="OpenLayers.Geometry.LineString"||f.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(e=0,a=this.components.length;e<a;++e){b=f.intersects(this.components[e]);if(b){break;}}if(!b){for(e=0,a=f.components.length;e<a;++e){b=this.containsPoint(f.components[e]);if(b){break;}}}}else{for(e=0,a=f.components.length;e<a;++e){b=this.intersects(f.components[e]);if(b){break;}}}}if(!b&&f.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var d=this.components[0];for(e=0,a=d.components.length;e<a;++e){b=f.containsPoint(d.components[e]);if(b){break;}}}return b;},distanceTo:function(e,b){var d=!(b&&b.edge===false);var a;if(!d&&this.intersects(e)){a=0;}else{a=OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,b]);}return a;},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(l,g,b,o){var d=Math.PI*((1/b)-(1/2));if(o){d+=(o/180)*Math.PI;}var a,j,h;var m=[];for(var f=0;f<b;++f){a=d+(f*2*Math.PI/b);j=l.x+(g*Math.cos(a));h=l.y+(g*Math.sin(a));m.push(new OpenLayers.Geometry.Point(j,h));}var e=new OpenLayers.Geometry.LinearRing(m);return new OpenLayers.Geometry.Polygon([e]);};OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{polygon:null,initialize:function(d,b,a){OpenLayers.Handler.Path.prototype.initialize.apply(this,arguments);},createFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:true});},destroyFeature:function(){OpenLayers.Handler.Path.prototype.destroyFeature.apply(this);this.polygon=null;},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style);},getSketch:function(){return this.polygon;},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiPolygon([a]);}return a;},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[b]);this.removePoint();this.finalize();}return false;},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},split:function(q,v){var h=null;var u=v&&v.mutual;var r,a,t,o,b;var f=[];var s=[q];for(var g=0,l=this.components.length;g<l;++g){a=this.components[g];o=false;for(var e=0;e<s.length;++e){r=a.split(s[e],v);if(r){if(u){t=r[0];for(var d=0,m=t.length;d<m;++d){if(d===0&&f.length){f[f.length-1].addComponent(t[d]);}else{f.push(new OpenLayers.Geometry.MultiLineString([t[d]]));}}o=true;r=r[1];}if(r.length){r.unshift(e,1);Array.prototype.splice.apply(s,r);break;}}}if(!o){if(f.length){f[f.length-1].addComponent(a.clone());}else{f=[new OpenLayers.Geometry.MultiLineString(a.clone())];}}}if(f&&f.length>1){o=true;}else{f=[];}if(s&&s.length>1){b=true;}else{s=[];}if(o||b){if(u){h=[f,s];}else{h=s;}}return h;},splitWith:function(q,v){var h=null;var u=v&&v.mutual;
var r,d,t,o,a,f,s;if(q instanceof OpenLayers.Geometry.LineString){s=[];f=[q];for(var g=0,l=this.components.length;g<l;++g){a=false;d=this.components[g];for(var e=0;e<f.length;++e){r=f[e].split(d,v);if(r){if(u){t=r[0];if(t.length){t.unshift(e,1);Array.prototype.splice.apply(f,t);e+=t.length-2;}r=r[1];if(r.length===0){r=[d.clone()];}}for(var b=0,m=r.length;b<m;++b){if(b===0&&s.length){s[s.length-1].addComponent(r[b]);}else{s.push(new OpenLayers.Geometry.MultiLineString([r[b]]));}}a=true;}}if(!a){if(s.length){s[s.length-1].addComponent(d.clone());}else{s=[new OpenLayers.Geometry.MultiLineString([d.clone()])];}}}}else{h=q.split(this);}if(f&&f.length>1){o=true;}else{f=[];}if(s&&s.length>1){a=true;}else{s=[];}if(o||a){if(u){h=[f,s];}else{h=s;}}return h;},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:false,initialize:function(a){OpenLayers.Format.JSON.prototype.initialize.apply(this,[a]);},read:function(l,h,a){h=(h)?h:"FeatureCollection";var e=null;var d=null;if(typeof l=="string"){d=OpenLayers.Format.JSON.prototype.read.apply(this,[l,a]);}else{d=l;}if(!d){OpenLayers.Console.error("Bad JSON: "+l);}else{if(typeof(d.type)!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+l);}else{if(this.isValidType(d,h)){switch(h){case"Geometry":try{e=this.parseGeometry(d);}catch(b){OpenLayers.Console.error(b);}break;case"Feature":try{e=this.parseFeature(d);e.type="Feature";}catch(b){OpenLayers.Console.error(b);}break;case"FeatureCollection":e=[];switch(d.type){case"Feature":try{e.push(this.parseFeature(d));}catch(b){e=null;OpenLayers.Console.error(b);}break;case"FeatureCollection":for(var f=0,g=d.features.length;f<g;++f){try{e.push(this.parseFeature(d.features[f]));}catch(b){e=null;OpenLayers.Console.error(b);}}break;default:try{var j=this.parseGeometry(d);e.push(new OpenLayers.Feature.Vector(j));}catch(b){e=null;OpenLayers.Console.error(b);}}break;}}}}return e;},isValidType:function(d,a){var b=false;switch(a){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],d.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+d.type);}else{b=true;}break;case"FeatureCollection":b=true;break;default:if(d.type==a){b=true;}else{OpenLayers.Console.error("Cannot convert types from "+d.type+" to "+a);}}return b;},parseFeature:function(e){var b,g,a,f;a=(e.properties)?e.properties:{};f=(e.geometry&&e.geometry.bbox)||e.bbox;try{g=this.parseGeometry(e.geometry);}catch(d){throw d;}b=new OpenLayers.Feature.Vector(g,a);if(f){b.bounds=OpenLayers.Bounds.fromArray(f);}if(e.id){b.fid=e.id;}return b;},parseGeometry:function(f){if(f==null){return null;}var h,g=false;if(f.type=="GeometryCollection"){if(!(f.geometries instanceof Array)){throw"GeometryCollection must have geometries array: "+f;}var b=f.geometries.length;var e=new Array(b);for(var a=0;a<b;++a){e[a]=this.parseGeometry.apply(this,[f.geometries[a]]);}h=new OpenLayers.Geometry.Collection(e);g=true;}else{if(!(f.coordinates instanceof Array)){throw"Geometry must have coordinates array: "+f;}if(!this.parseCoords[f.type.toLowerCase()]){throw"Unsupported geometry type: "+f.type;}try{h=this.parseCoords[f.type.toLowerCase()].apply(this,[f.coordinates]);}catch(d){throw d;}}if(this.internalProjection&&this.externalProjection&&!g){h.transform(this.externalProjection,this.internalProjection);}return h;},parseCoords:{point:function(a){if(this.ignoreExtraDims==false&&a.length!=2){throw"Only 2D points are supported: "+a;}return new OpenLayers.Geometry.Point(a[0],a[1]);},multipoint:function(g){var d=[];var f=null;for(var b=0,a=g.length;b<a;++b){try{f=this.parseCoords.point.apply(this,[g[b]]);}catch(e){throw e;}d.push(f);}return new OpenLayers.Geometry.MultiPoint(d);},linestring:function(g){var d=[];var f=null;for(var b=0,a=g.length;b<a;++b){try{f=this.parseCoords.point.apply(this,[g[b]]);}catch(e){throw e;}d.push(f);}return new OpenLayers.Geometry.LineString(d);},multilinestring:function(g){var d=[];var b=null;for(var e=0,a=g.length;e<a;++e){try{b=this.parseCoords.linestring.apply(this,[g[e]]);}catch(f){throw f;}d.push(b);}return new OpenLayers.Geometry.MultiLineString(d);},polygon:function(h){var g=[];var f,b;for(var d=0,a=h.length;d<a;++d){try{b=this.parseCoords.linestring.apply(this,[h[d]]);}catch(e){throw e;}f=new OpenLayers.Geometry.LinearRing(b.components);g.push(f);}return new OpenLayers.Geometry.Polygon(g);},multipolygon:function(g){var b=[];var f=null;for(var d=0,a=g.length;d<a;++d){try{f=this.parseCoords.polygon.apply(this,[g[d]]);}catch(e){throw e;}b.push(f);}return new OpenLayers.Geometry.MultiPolygon(b);},box:function(a){if(a.length!=2){throw"GeoJSON box coordinates must have 2 elements";}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])]);}},write:function(f,e){var a={type:null};if(f instanceof Array){a.type="FeatureCollection";var h=f.length;a.features=new Array(h);for(var d=0;d<h;++d){var b=f[d];if(!b instanceof OpenLayers.Feature.Vector){var g="FeatureCollection only supports collections of features: "+b;throw g;}a.features[d]=this.extract.feature.apply(this,[b]);}}else{if(f.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){a=this.extract.geometry.apply(this,[f]);}else{if(f instanceof OpenLayers.Feature.Vector){a=this.extract.feature.apply(this,[f]);if(f.layer&&f.layer.projection){a.crs=this.createCRSObject(f);}}}}return OpenLayers.Format.JSON.prototype.write.apply(this,[a,e]);},createCRSObject:function(b){var d=b.layer.projection.toString();var a={};if(d.match(/epsg:/i)){var e=parseInt(d.substring(d.indexOf(":")+1));if(e==4326){a={type:"OGC",properties:{urn:"urn:ogc:def:crs:OGC:1.3:CRS84"}};}else{a={type:"EPSG",properties:{code:e}};}}return a;},extract:{feature:function(b){var a=this.extract.geometry.apply(this,[b.geometry]);return{type:"Feature",id:b.fid==null?b.id:b.fid,properties:b.attributes,geometry:a};},geometry:function(e){if(e==null){return null;}if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection);}var a=e.CLASS_NAME.split(".")[2];var d=this.extract[a.toLowerCase()].apply(this,[e]);var b;if(a=="Collection"){b={type:"GeometryCollection",geometries:d};}else{b={type:a,coordinates:d};}return b;},point:function(a){return[a.x,a.y];},multipoint:function(d){var e=[];for(var b=0,a=d.components.length;b<a;++b){e.push(this.extract.point.apply(this,[d.components[b]]));}return e;},linestring:function(b){var e=[];for(var d=0,a=b.components.length;d<a;++d){e.push(this.extract.point.apply(this,[b.components[d]]));}return e;},multilinestring:function(d){var e=[];for(var b=0,a=d.components.length;b<a;++b){e.push(this.extract.linestring.apply(this,[d.components[b]]));}return e;},polygon:function(d){var e=[];for(var b=0,a=d.components.length;b<a;++b){e.push(this.extract.linestring.apply(this,[d.components[b]]));}return e;},multipolygon:function(e){var d=[];for(var b=0,a=e.components.length;b<a;++b){d.push(this.extract.polygon.apply(this,[e.components[b]]));}return d;},collection:function(d){var a=d.components.length;var e=new Array(a);for(var b=0;b<a;++b){e[b]=this.extract.geometry.apply(this,[d.components[b]]);}return e;}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(a){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)};
OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e]);}var f=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName);var d=[];for(var b=0;b<f.length;b++){var a=this.parseFeature(f[b]);if(a){d.push(a);}}return d;},parseFeature:function(e){var f=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"];var t,j,u,d;for(var o=0;o<f.length;++o){t=f[o];j=this.getElementsByTagNameNS(e,this.gmlns,t);if(j.length>0){d=this.parseGeometry[t.toLowerCase()];if(d){u=d.apply(this,[j[0]]);if(this.internalProjection&&this.externalProjection){u.transform(this.externalProjection,this.internalProjection);}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:t}));}break;}}var b;var m=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(o=0;o<m.length;++o){var s=m[o];var r=this.parseGeometry.box.apply(this,[s]);var q=s.parentNode;var h=q.localName||q.nodeName.split(":").pop();if(h==="boundedBy"){b=r;}else{u=r.toGeometry();}}var l;if(this.extractAttributes){l=this.parseAttributes(e);}var v=new OpenLayers.Feature.Vector(u,l);v.bounds=b;v.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};var a=e.firstChild;var g;while(a){if(a.nodeType==1){g=a.getAttribute("fid")||a.getAttribute("id");if(g){break;}}a=a.nextSibling;}v.fid=g;return v;},parseGeometry:{point:function(e){var b,a;var f=[];var b=this.getElementsByTagNameNS(e,this.gmlns,"pos");if(b.length>0){a=b[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");f=a.split(this.regExes.splitSpace);}if(f.length==0){b=this.getElementsByTagNameNS(e,this.gmlns,"coordinates");if(b.length>0){a=b[0].firstChild.nodeValue;a=a.replace(this.regExes.removeSpace,"");f=a.split(",");}}if(f.length==0){b=this.getElementsByTagNameNS(e,this.gmlns,"coord");if(b.length>0){var g=this.getElementsByTagNameNS(b[0],this.gmlns,"X");var d=this.getElementsByTagNameNS(b[0],this.gmlns,"Y");if(g.length>0&&d.length>0){f=[g[0].firstChild.nodeValue,d[0].firstChild.nodeValue];}}}if(f.length==2){f[2]=null;}if(this.xy){return new OpenLayers.Geometry.Point(f[0],f[1],f[2]);}else{return new OpenLayers.Geometry.Point(f[1],f[0],f[2]);}},multipoint:function(f){var b=this.getElementsByTagNameNS(f,this.gmlns,"Point");var e=[];if(b.length>0){var a;for(var d=0;d<b.length;++d){a=this.parseGeometry.point.apply(this,[b[d]]);if(a){e.push(a);}}}return new OpenLayers.Geometry.MultiPoint(e);},linestring:function(d,f){var e,b;var r=[];var s=[];e=this.getElementsByTagNameNS(d,this.gmlns,"posList");if(e.length>0){b=this.getChildValue(e[0]);b=b.replace(this.regExes.trimSpace,"");r=b.split(this.regExes.splitSpace);var l=parseInt(e[0].getAttribute("dimension"));var g,q,o,m;for(var h=0;h<r.length/l;++h){g=h*l;q=r[g];o=r[g+1];m=(l==2)?null:r[g+2];if(this.xy){s.push(new OpenLayers.Geometry.Point(q,o,m));}else{s.push(new OpenLayers.Geometry.Point(o,q,m));}}}if(r.length==0){e=this.getElementsByTagNameNS(d,this.gmlns,"coordinates");if(e.length>0){b=this.getChildValue(e[0]);b=b.replace(this.regExes.trimSpace,"");b=b.replace(this.regExes.trimComma,",");var a=b.split(this.regExes.splitSpace);for(var h=0;h<a.length;++h){r=a[h].split(",");if(r.length==2){r[2]=null;}if(this.xy){s.push(new OpenLayers.Geometry.Point(r[0],r[1],r[2]));}else{s.push(new OpenLayers.Geometry.Point(r[1],r[0],r[2]));}}}}var t=null;if(s.length!=0){if(f){t=new OpenLayers.Geometry.LinearRing(s);}else{t=new OpenLayers.Geometry.LineString(s);}}return t;},multilinestring:function(f){var b=this.getElementsByTagNameNS(f,this.gmlns,"LineString");var e=[];if(b.length>0){var a;for(var d=0;d<b.length;++d){a=this.parseGeometry.linestring.apply(this,[b[d]]);if(a){e.push(a);}}}return new OpenLayers.Geometry.MultiLineString(e);},polygon:function(f){var b=this.getElementsByTagNameNS(f,this.gmlns,"LinearRing");var e=[];if(b.length>0){var a;for(var d=0;d<b.length;++d){a=this.parseGeometry.linestring.apply(this,[b[d],true]);if(a){e.push(a);}}}return new OpenLayers.Geometry.Polygon(e);},multipolygon:function(f){var a=this.getElementsByTagNameNS(f,this.gmlns,"Polygon");var e=[];if(a.length>0){var d;for(var b=0;b<a.length;++b){d=this.parseGeometry.polygon.apply(this,[a[b]]);if(d){e.push(d);}}}return new OpenLayers.Geometry.MultiPolygon(e);},envelope:function(b){var f=[];var a;var g;var m=this.getElementsByTagNameNS(b,this.gmlns,"lowerCorner");if(m.length>0){var j=[];if(m.length>0){a=m[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");j=a.split(this.regExes.splitSpace);}if(j.length==2){j[2]=null;}if(this.xy){var e=new OpenLayers.Geometry.Point(j[0],j[1],j[2]);}else{var e=new OpenLayers.Geometry.Point(j[1],j[0],j[2]);}}var h=this.getElementsByTagNameNS(b,this.gmlns,"upperCorner");if(h.length>0){var j=[];if(h.length>0){a=h[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");j=a.split(this.regExes.splitSpace);}if(j.length==2){j[2]=null;}if(this.xy){var l=new OpenLayers.Geometry.Point(j[0],j[1],j[2]);}else{var l=new OpenLayers.Geometry.Point(j[1],j[0],j[2]);}}if(e&&l){f.push(new OpenLayers.Geometry.Point(e.x,e.y));f.push(new OpenLayers.Geometry.Point(l.x,e.y));f.push(new OpenLayers.Geometry.Point(l.x,l.y));f.push(new OpenLayers.Geometry.Point(e.x,l.y));f.push(new OpenLayers.Geometry.Point(e.x,e.y));var d=new OpenLayers.Geometry.LinearRing(f);g=new OpenLayers.Geometry.Polygon([d]);}return g;},box:function(f){var d=this.getElementsByTagNameNS(f,this.gmlns,"coordinates");var b;var g,a=null,e=null;if(d.length>0){b=d[0].firstChild.nodeValue;g=b.split(" ");if(g.length==2){a=g[0].split(",");e=g[1].split(",");}}if(a!==null&&e!==null){return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(e[0]),parseFloat(e[1]));}}},parseAttributes:function(f){var g={};var a=f.firstChild;var e,h,d,m,l,b,j;while(a){if(a.nodeType==1){e=a.childNodes;for(h=0;h<e.length;++h){d=e[h];if(d.nodeType==1){m=d.childNodes;if(m.length==1){l=m[0];if(l.nodeType==3||l.nodeType==4){b=(d.prefix)?d.nodeName.split(":")[1]:d.nodeName;j=l.nodeValue.replace(this.regExes.trimSpace,"");g[b]=j;}}else{g[d.nodeName.split(":").pop()]=null;}}}break;}a=a.nextSibling;}return g;},write:function(d){if(!(d instanceof Array)){d=[d];}var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);for(var a=0;a<d.length;a++){b.appendChild(this.createFeatureXML(d[a]));}return OpenLayers.Format.XML.prototype.write.apply(this,[b]);},createFeatureXML:function(m){var j=m.geometry;var f=this.buildGeometryNode(j);var l=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);l.appendChild(f);var a=this.createElementNS(this.gmlns,"gml:"+this.featureName);var o=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);var d=m.fid||m.id;o.setAttribute("fid",d);o.appendChild(l);for(var h in m.attributes){var g=this.createTextNode(m.attributes[h]);var e=h.substring(h.lastIndexOf(":")+1);var b=this.createElementNS(this.featureNS,this.featurePrefix+":"+e);b.appendChild(g);o.appendChild(b);}a.appendChild(o);return a;},buildGeometryNode:function(e){if(this.externalProjection&&this.internalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection);}var d=e.CLASS_NAME;var b=d.substring(d.lastIndexOf(".")+1);var a=this.buildGeometry[b.toLowerCase()];return a.apply(this,[e]);},buildGeometry:{point:function(b){var a=this.createElementNS(this.gmlns,"gml:Point");a.appendChild(this.buildCoordinatesNode(b));return a;},multipoint:function(g){var e=this.createElementNS(this.gmlns,"gml:MultiPoint");var d=g.components;var b,f;for(var a=0;a<d.length;a++){b=this.createElementNS(this.gmlns,"gml:pointMember");f=this.buildGeometry.point.apply(this,[d[a]]);b.appendChild(f);e.appendChild(b);}return e;},linestring:function(b){var a=this.createElementNS(this.gmlns,"gml:LineString");a.appendChild(this.buildCoordinatesNode(b));return a;},multilinestring:function(g){var e=this.createElementNS(this.gmlns,"gml:MultiLineString");
var a=g.components;var d,f;for(var b=0;b<a.length;++b){d=this.createElementNS(this.gmlns,"gml:lineStringMember");f=this.buildGeometry.linestring.apply(this,[a[b]]);d.appendChild(f);e.appendChild(d);}return e;},linearring:function(b){var a=this.createElementNS(this.gmlns,"gml:LinearRing");a.appendChild(this.buildCoordinatesNode(b));return a;},polygon:function(h){var e=this.createElementNS(this.gmlns,"gml:Polygon");var g=h.components;var d,f,b;for(var a=0;a<g.length;++a){b=(a==0)?"outerBoundaryIs":"innerBoundaryIs";d=this.createElementNS(this.gmlns,"gml:"+b);f=this.buildGeometry.linearring.apply(this,[g[a]]);d.appendChild(f);e.appendChild(d);}return e;},multipolygon:function(g){var e=this.createElementNS(this.gmlns,"gml:MultiPolygon");var a=g.components;var f,b;for(var d=0;d<a.length;++d){f=this.createElementNS(this.gmlns,"gml:polygonMember");b=this.buildGeometry.polygon.apply(this,[a[d]]);f.appendChild(b);e.appendChild(f);}return e;},bounds:function(b){var a=this.createElementNS(this.gmlns,"gml:Box");a.appendChild(this.buildCoordinatesNode(b));return a;}},buildCoordinatesNode:function(g){var a=this.createElementNS(this.gmlns,"gml:coordinates");a.setAttribute("decimal",".");a.setAttribute("cs",",");a.setAttribute("ts"," ");var f=[];if(g instanceof OpenLayers.Bounds){f.push(g.left+","+g.bottom);f.push(g.right+","+g.top);}else{var d=(g.components)?g.components:[g];for(var b=0;b<d.length;b++){f.push(d[b].x+","+d[b].y);}}var e=this.createTextNode(f.join(" "));a.appendChild(e);return a;},CLASS_NAME:"OpenLayers.Format.GML"});if(!OpenLayers.Format.GML){OpenLayers.Format.GML={};}OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.setGeometryTypes();if(a&&a.featureNS){this.setNamespace("feature",a.featureNS);}this.singleFeatureType=!a||(typeof a.featureType==="string");},read:function(f){if(typeof f=="string"){f=OpenLayers.Format.XML.prototype.read.apply(this,[f]);}if(f&&f.nodeType==9){f=f.documentElement;}var d=[];this.readNode(f,{features:d});if(d.length==0){var e=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMember");if(e.length){for(var b=0,a=e.length;b<a;++b){this.readNode(e[b],{features:d});}}else{var e=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMembers");if(e.length){this.readNode(e[0],{features:d});}}}return d;},readers:{gml:{featureMember:function(a,b){this.readChildNodes(a,b);},featureMembers:function(a,b){this.readChildNodes(a,b);},name:function(a,b){b.name=this.getChildValue(a);},boundedBy:function(b,d){var a={};this.readChildNodes(b,a);if(a.components&&a.components.length>0){d.bounds=a.components[0];}},Point:function(b,a){var d={points:[]};this.readChildNodes(b,d);if(!a.components){a.components=[];}a.components.push(d.points[0]);},coordinates:function(f,h){var j=this.getChildValue(f).replace(this.regExes.trimSpace,"");j=j.replace(this.regExes.trimComma,",");var a=j.split(this.regExes.splitSpace);var g;var e=a.length;var d=new Array(e);for(var b=0;b<e;++b){g=a[b].split(",");if(this.xy){d[b]=new OpenLayers.Geometry.Point(g[0],g[1],g[2]);}else{d[b]=new OpenLayers.Geometry.Point(g[1],g[0],g[2]);}}h.points=d;},coord:function(a,b){var d={};this.readChildNodes(a,d);if(!b.points){b.points=[];}b.points.push(new OpenLayers.Geometry.Point(d.x,d.y,d.z));},X:function(a,b){b.x=this.getChildValue(a);},Y:function(a,b){b.y=this.getChildValue(a);},Z:function(a,b){b.z=this.getChildValue(a);},MultiPoint:function(b,a){var d={components:[]};this.readChildNodes(b,d);a.components=[new OpenLayers.Geometry.MultiPoint(d.components)];},pointMember:function(a,b){this.readChildNodes(a,b);},LineString:function(b,a){var d={};this.readChildNodes(b,d);if(!a.components){a.components=[];}a.components.push(new OpenLayers.Geometry.LineString(d.points));},MultiLineString:function(b,a){var d={components:[]};this.readChildNodes(b,d);a.components=[new OpenLayers.Geometry.MultiLineString(d.components)];},lineStringMember:function(a,b){this.readChildNodes(a,b);},Polygon:function(b,a){var d={outer:null,inner:[]};this.readChildNodes(b,d);d.inner.unshift(d.outer);if(!a.components){a.components=[];}a.components.push(new OpenLayers.Geometry.Polygon(d.inner));},LinearRing:function(b,d){var a={};this.readChildNodes(b,a);d.components=[new OpenLayers.Geometry.LinearRing(a.points)];},MultiPolygon:function(b,a){var d={components:[]};this.readChildNodes(b,d);a.components=[new OpenLayers.Geometry.MultiPolygon(d.components)];},polygonMember:function(a,b){this.readChildNodes(a,b);},GeometryCollection:function(b,a){var d={components:[]};this.readChildNodes(b,d);a.components=[new OpenLayers.Geometry.Collection(d.components)];},geometryMember:function(a,b){this.readChildNodes(a,b);}},feature:{"*":function(d,e){var a;var b=d.localName||d.nodeName.split(":").pop();if(e.features){if(!this.singleFeatureType&&(OpenLayers.Util.indexOf(this.featureType,b)!==-1)){a="_typeName";}else{if(b===this.featureType){a="_typeName";}}}else{if(d.childNodes.length==0||(d.childNodes.length==1&&d.firstChild.nodeType==3)){if(this.extractAttributes){a="_attribute";}}else{a="_geometry";}}if(a){this.readers.feature[a].apply(this,[d,e]);}},_typeName:function(d,e){var a={components:[],attributes:{}};this.readChildNodes(d,a);if(a.name){a.attributes.name=a.name;}var b=new OpenLayers.Feature.Vector(a.components[0],a.attributes);if(!this.singleFeatureType){b.type=d.nodeName.split(":").pop();b.namespace=d.namespaceURI;}var f=d.getAttribute("fid")||this.getAttributeNS(d,this.namespaces.gml,"id");if(f){b.fid=f;}if(this.internalProjection&&this.externalProjection&&b.geometry){b.geometry.transform(this.externalProjection,this.internalProjection);}if(a.bounds){b.bounds=a.bounds;}e.features.push(b);},_geometry:function(a,b){this.readChildNodes(a,b);},_attribute:function(b,e){var a=b.localName||b.nodeName.split(":").pop();var d=this.getChildValue(b);e.attributes[a]=d;}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b);}}},write:function(d){var b;if(d instanceof Array){b="featureMembers";}else{b="featureMember";}var a=this.writeNode("gml:"+b,d);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a]);},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",a,b);return b;},MultiPoint:function(d){var b=this.createElementNSPlus("gml:MultiPoint");for(var a=0;a<d.components.length;++a){this.writeNode("pointMember",d.components[a],b);}return b;},pointMember:function(b){var a=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",b,a);return a;},MultiLineString:function(d){var b=this.createElementNSPlus("gml:MultiLineString");for(var a=0;a<d.components.length;++a){this.writeNode("lineStringMember",d.components[a],b);}return b;},lineStringMember:function(b){var a=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",b,a);return a;},MultiPolygon:function(d){var b=this.createElementNSPlus("gml:MultiPolygon");for(var a=0;a<d.components.length;++a){this.writeNode("polygonMember",d.components[a],b);}return b;},polygonMember:function(b){var a=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",b,a);return a;},GeometryCollection:function(e){var d=this.createElementNSPlus("gml:GeometryCollection");for(var b=0,a=e.components.length;b<a;++b){this.writeNode("geometryMember",e.components[b],d);}return d;},geometryMember:function(b){var a=this.createElementNSPlus("gml:geometryMember");
var d=this.writeNode("feature:_geometry",b);a.appendChild(d.firstChild);return a;}},feature:{_typeName:function(b){var d=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:b.fid}});if(b.geometry){this.writeNode("feature:_geometry",b.geometry,d);}for(var a in b.attributes){var e=b.attributes[a];if(e!=null){this.writeNode("feature:_attribute",{name:a,value:e},d);}}return d;},_geometry:function(d){if(this.externalProjection&&this.internalProjection){d=d.clone().transform(this.internalProjection,this.externalProjection);}var b=this.createElementNSPlus("feature:"+this.geometryName);var a=this.geometryTypes[d.CLASS_NAME];var e=this.writeNode("gml:"+a,d,b);if(this.srsName){e.setAttribute("srsName",this.srsName);}return b;},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value});}},wfs:{FeatureCollection:function(d){var e=this.createElementNSPlus("wfs:FeatureCollection");for(var b=0,a=d.length;b<a;++b){this.writeNode("gml:featureMember",d[b],e);}return e;}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"};},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a]);},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a,b){this.readChildNodes(a,b);},Curve:function(b,a){var d={points:[]};this.readChildNodes(b,d);if(!a.components){a.components=[];}a.components.push(new OpenLayers.Geometry.LineString(d.points));},segments:function(a,b){this.readChildNodes(a,b);},LineStringSegment:function(b,a){var d={};this.readChildNodes(b,d);if(d.points){Array.prototype.push.apply(a.points,d.points);}},pos:function(b,e){var f=this.getChildValue(b).replace(this.regExes.trimSpace,"");var d=f.split(this.regExes.splitSpace);var a;if(this.xy){a=new OpenLayers.Geometry.Point(d[0],d[1],d[2]);}else{a=new OpenLayers.Geometry.Point(d[1],d[0],d[2]);}e.points=[a];},posList:function(a,e){var l=this.getChildValue(a).replace(this.regExes.trimSpace,"");var q=l.split(this.regExes.splitSpace);var f=parseInt(a.getAttribute("dimension"))||2;var b,r,o,h;var m=q.length/f;var s=new Array(m);for(var d=0,g=q.length;d<g;d+=f){r=q[d];o=q[d+1];h=(f==2)?undefined:q[d+2];if(this.xy){s[d/f]=new OpenLayers.Geometry.Point(r,o,h);}else{s[d/f]=new OpenLayers.Geometry.Point(o,r,h);}}e.points=s;},Surface:function(a,b){this.readChildNodes(a,b);},patches:function(a,b){this.readChildNodes(a,b);},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b]);},exterior:function(b,a){var d={};this.readChildNodes(b,d);a.outer=d.components[0];},interior:function(b,a){var d={};this.readChildNodes(b,d);a.inner.push(d.components[0]);},MultiCurve:function(b,a){var d={components:[]};this.readChildNodes(b,d);if(d.components.length>0){a.components=[new OpenLayers.Geometry.MultiLineString(d.components)];}},curveMember:function(a,b){this.readChildNodes(a,b);},MultiSurface:function(b,a){var d={components:[]};this.readChildNodes(b,d);if(d.components.length>0){a.components=[new OpenLayers.Geometry.MultiPolygon(d.components)];}},surfaceMember:function(a,b){this.readChildNodes(a,b);},surfaceMembers:function(a,b){this.readChildNodes(a,b);},pointMembers:function(a,b){this.readChildNodes(a,b);},lineStringMembers:function(a,b){this.readChildNodes(a,b);},polygonMembers:function(a,b){this.readChildNodes(a,b);},geometryMembers:function(a,b){this.readChildNodes(a,b);},Envelope:function(e,b){var f={points:new Array(2)};this.readChildNodes(e,f);if(!b.components){b.components=[];}var d=f.points[0];var a=f.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,a.x,a.y));},lowerCorner:function(b,a){var d={};this.readers.gml.pos.apply(this,[b,d]);a.points[0]=d.points[0];},upperCorner:function(b,a){var d={};this.readers.gml.pos.apply(this,[b,d]);a.points[1]=d.points[0];}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(d){var b;if(d instanceof Array){b="featureMembers";}else{b="featureMember";}var a=this.writeNode("gml:"+b,d);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a]);},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(d){var e=this.createElementNSPlus("gml:featureMembers");for(var b=0,a=d.length;b<a;++b){this.writeNode("feature:_typeName",d[b],e);}return e;},Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("pos",b,a);return a;},pos:function(a){var b=(this.xy)?(a.x+" "+a.y):(a.y+" "+a.x);return this.createElementNSPlus("gml:pos",{value:b});},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("posList",b.components,a);return a;},Curve:function(b){var a=this.createElementNSPlus("gml:Curve");this.writeNode("segments",b,a);return a;},segments:function(b){var a=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",b,a);return a;},LineStringSegment:function(b){var a=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",b.components,a);return a;},posList:function(e){var b=e.length;var f=new Array(b);var a;for(var d=0;d<b;++d){a=e[d];if(this.xy){f[d]=a.x+" "+a.y;}else{f[d]=a.y+" "+a.x;}}return this.createElementNSPlus("gml:posList",{value:f.join(" ")});},Surface:function(b){var a=this.createElementNSPlus("gml:Surface");this.writeNode("patches",b,a);return a;},patches:function(b){var a=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",b,a);return a;},PolygonPatch:function(e){var d=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],d);for(var b=1,a=e.components.length;b<a;++b){this.writeNode("interior",e.components[b],d);}return d;},Polygon:function(e){var d=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],d);for(var b=1,a=e.components.length;b<a;++b){this.writeNode("interior",e.components[b],d);}return d;},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",a,b);return b;},interior:function(a){var b=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",a,b);return b;},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",a.components,b);return b;},MultiCurve:function(e){var d=this.createElementNSPlus("gml:MultiCurve");for(var b=0,a=e.components.length;b<a;++b){this.writeNode("curveMember",e.components[b],d);}return d;},curveMember:function(b){var a=this.createElementNSPlus("gml:curveMember");if(this.curve){this.writeNode("Curve",b,a);}else{this.writeNode("LineString",b,a);}return a;},MultiSurface:function(e){var d=this.createElementNSPlus("gml:MultiSurface");for(var b=0,a=e.components.length;b<a;++b){this.writeNode("surfaceMember",e.components[b],d);}return d;},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");if(this.surface){this.writeNode("Surface",a,b);}else{this.writeNode("Polygon",a,b);}return b;},Envelope:function(b){var a=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",b,a);this.writeNode("upperCorner",b,a);if(this.srsName){a.setAttribute("srsName",this.srsName);}return a;},lowerCorner:function(a){var b=(this.xy)?(a.left+" "+a.bottom):(a.bottom+" "+a.left);return this.createElementNSPlus("gml:lowerCorner",{value:b});
},upperCorner:function(a){var b=(this.xy)?(a.right+" "+a.top):(a.top+" "+a.right);return this.createElementNSPlus("gml:upperCorner",{value:b});}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":(this.curve===true)?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":(this.multiCurve===false)?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":(this.surface===true)?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":(this.multiSurface===false)?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"};},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Element={visible:function(a){return OpenLayers.Util.getElement(a).style.display!="none";},toggle:function(){for(var d=0,a=arguments.length;d<a;d++){var b=OpenLayers.Util.getElement(arguments[d]);var e=OpenLayers.Element.visible(b)?"hide":"show";OpenLayers.Element[e](b);}},hide:function(){for(var d=0,a=arguments.length;d<a;d++){var b=OpenLayers.Util.getElement(arguments[d]);if(b){b.style.display="none";}}},show:function(){for(var d=0,a=arguments.length;d<a;d++){var b=OpenLayers.Util.getElement(arguments[d]);if(b){b.style.display="";}}},remove:function(a){a=OpenLayers.Util.getElement(a);a.parentNode.removeChild(a);},getHeight:function(a){a=OpenLayers.Util.getElement(a);return a.offsetHeight;},getDimensions:function(d){d=OpenLayers.Util.getElement(d);if(OpenLayers.Element.getStyle(d,"display")!="none"){return{width:d.offsetWidth,height:d.offsetHeight};}var b=d.style;var g=b.visibility;var e=b.position;var a=b.display;b.visibility="hidden";b.position="absolute";b.display="";var h=d.clientWidth;var f=d.clientHeight;b.display=a;b.position=e;b.visibility=g;return{width:h,height:f};},hasClass:function(b,a){var d=b.className;return(!!d&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(d));},addClass:function(b,a){if(!OpenLayers.Element.hasClass(b,a)){b.className+=(b.className?" ":"")+a;}return b;},removeClass:function(b,a){var d=b.className;if(d){b.className=OpenLayers.String.trim(d.replace(new RegExp("(^|\\s+)"+a+"(\\s+|$)")," "));}return b;},toggleClass:function(b,a){if(OpenLayers.Element.hasClass(b,a)){OpenLayers.Element.removeClass(b,a);}else{OpenLayers.Element.addClass(b,a);}return b;},getStyle:function(d,e){d=OpenLayers.Util.getElement(d);var f=null;if(d&&d.style){f=d.style[OpenLayers.String.camelize(e)];if(!f){if(document.defaultView&&document.defaultView.getComputedStyle){var b=document.defaultView.getComputedStyle(d,null);f=b?b.getPropertyValue(e):null;}else{if(d.currentStyle){f=d.currentStyle[OpenLayers.String.camelize(e)];}}}var a=["left","top","right","bottom"];if(window.opera&&(OpenLayers.Util.indexOf(a,e)!=-1)&&(OpenLayers.Element.getStyle(d,"position")=="static")){f="auto";}}return f=="auto"?null:f;}};OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:true,initialize:function(d,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null;},onWheelEvent:function(m){if(!this.map||!this.checkModifiers(m)){return;}var h=false;var q=false;var g=false;var b=OpenLayers.Event.element(m);while((b!=null)&&!g&&!h){if(!h){try{if(b.currentStyle){d=b.currentStyle.overflow;}else{var a=document.defaultView.getComputedStyle(b,null);var d=a.getPropertyValue("overflow");}h=(d&&(d=="auto")||(d=="scroll"));}catch(f){}}if(!q){for(var j=0,l=this.map.layers.length;j<l;j++){if(b==this.map.layers[j].div||b==this.map.layers[j].pane){q=true;break;}}}g=(b==this.map.div);b=b.parentNode;}if(!h&&g){if(q){var o=0;if(!m){m=window.event;}if(m.wheelDelta){o=m.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){o=-o;}}else{if(m.detail){o=-m.detail/3;}}this.delta=this.delta+o;if(this.interval){window.clearTimeout(this._timeoutId);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(m);},this),this.interval);}else{this.wheelZoom(m);}}OpenLayers.Event.stop(m);}},wheelZoom:function(a){var b=this.delta;this.delta=0;if(b){if(this.mousePosition){a.xy=this.mousePosition;}if(!a.xy){a.xy=this.map.getPixelFromLonLat(this.map.getCenter());}if(b<0){this.callback("down",[a,this.cumulative?b:-1]);}else{this.callback("up",[a,this.cumulative?b:1]);}}},mousemove:function(a){this.mousePosition=a.xy;},activate:function(a){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",b);OpenLayers.Event.observe(window,"mousewheel",b);OpenLayers.Event.observe(document,"mousewheel",b);return true;}else{return false;}},deactivate:function(a){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",b);OpenLayers.Event.stopObserving(window,"mousewheel",b);OpenLayers.Event.stopObserving(document,"mousewheel",b);return true;}else{return false;}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){if(this.map){this.map.zoomToMaxExtent();}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(b,a){OpenLayers.Util.extend(this,a);this.rules=[];if(a&&a.rules){this.addRules(a.rules);}this.setDefaultStyle(b||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){for(var b=0,a=this.rules.length;b<a;b++){this.rules[b].destroy();this.rules[b]=null;}this.rules=null;this.defaultStyle=null;},createSymbolizer:function(m){var a=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),m);var l=this.rules;var j,b;var d=[];var g=false;for(var e=0,f=l.length;e<f;e++){j=l[e];var h=j.evaluate(m);if(h){if(j instanceof OpenLayers.Rule&&j.elseFilter){d.push(j);}else{g=true;this.applySymbolizer(j,a,m);}}}if(g==false&&d.length>0){g=true;for(var e=0,f=d.length;e<f;e++){this.applySymbolizer(d[e],a,m);}}if(l.length>0&&g==false){a.display="none";}return a;},applySymbolizer:function(g,e,b){var a=b.geometry?this.getSymbolizerPrefix(b.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];var d=g.symbolizer[a]||g.symbolizer;if(this.defaultsPerSymbolizer===true){var f=this.defaultStyle;OpenLayers.Util.applyDefaults(d,{pointRadius:f.pointRadius});if(d.stroke===true||d.graphic===true){OpenLayers.Util.applyDefaults(d,{strokeWidth:f.strokeWidth,strokeColor:f.strokeColor,strokeOpacity:f.strokeOpacity,strokeDashstyle:f.strokeDashstyle,strokeLinecap:f.strokeLinecap});}if(d.fill===true||d.graphic===true){OpenLayers.Util.applyDefaults(d,{fillColor:f.fillColor,fillOpacity:f.fillOpacity});}if(d.graphic===true){OpenLayers.Util.applyDefaults(d,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset});}}return this.createLiterals(OpenLayers.Util.extend(e,d),b);},createLiterals:function(e,d){var b=OpenLayers.Util.extend({},d.attributes||d.data);OpenLayers.Util.extend(b,this.context);for(var a in this.propertyStyles){e[a]=OpenLayers.Style.createLiteral(e[a],b,d,a);}return e;},findPropertyStyles:function(){var e={};
var g=this.defaultStyle;this.addPropertyStyles(e,g);var j=this.rules;var f,h;for(var d=0,a=j.length;d<a;d++){f=j[d].symbolizer;for(var b in f){h=f[b];if(typeof h=="object"){this.addPropertyStyles(e,h);}else{this.addPropertyStyles(e,f);break;}}}return e;},addPropertyStyles:function(b,d){var e;for(var a in d){e=d[a];if(typeof e=="string"&&e.match(/\$\{\w+\}/)){b[a]=true;}}return b;},addRules:function(a){Array.prototype.push.apply(this.rules,a);this.propertyStyles=this.findPropertyStyles();},setDefaultStyle:function(a){this.defaultStyle=a;this.propertyStyles=this.findPropertyStyles();},getSymbolizerPrefix:function(e){var d=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var b=0,a=d.length;b<a;b++){if(e.CLASS_NAME.indexOf(d[b])!=-1){return d[b];}}},clone:function(){var b=OpenLayers.Util.extend({},this);if(this.rules){b.rules=[];for(var d=0,a=this.rules.length;d<a;++d){b.rules.push(this.rules[d].clone());}}b.context=this.context&&OpenLayers.Util.extend({},this.context);var e=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(e,b);},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(e,b,a,d){if(typeof e=="string"&&e.indexOf("${")!=-1){e=OpenLayers.String.format(e,b,[a,d]);e=(isNaN(e)||!e)?e:parseFloat(e);}return e;};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a);},destroy:function(){},evaluate:function(a){return true;},clone:function(){return null;},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,initialize:function(a){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[a]);},evaluate:function(d){for(var b=0,a=this.fids.length;b<a;b++){var e=d.fid||d.id;if(e==this.fids[b]){return true;}}return false;},clone:function(){var a=new OpenLayers.Filter.FeatureId();OpenLayers.Util.extend(a,this);a.fids=this.fids.slice();return a;},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[a]);},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this);},evaluate:function(d){switch(this.type){case OpenLayers.Filter.Logical.AND:for(var b=0,a=this.filters.length;b<a;b++){if(this.filters[b].evaluate(d)==false){return false;}}return true;case OpenLayers.Filter.Logical.OR:for(var b=0,a=this.filters.length;b<a;b++){if(this.filters[b].evaluate(d)==true){return true;}}return false;case OpenLayers.Filter.Logical.NOT:return(!this.filters[0].evaluate(d));}},clone:function(){var d=[];for(var b=0,a=this.filters.length;b<a;++b){d.push(this.filters[b].clone());}return new OpenLayers.Filter.Logical({type:this.type,filters:d});},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a]);},evaluate:function(d){if(d instanceof OpenLayers.Feature.Vector){d=d.attributes;}var a=false;var b=d[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:var f=this.value;if(!this.matchCase&&typeof b=="string"&&typeof f=="string"){a=(b.toUpperCase()==f.toUpperCase());}else{a=(b==f);}break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:var f=this.value;if(!this.matchCase&&typeof b=="string"&&typeof f=="string"){a=(b.toUpperCase()!=f.toUpperCase());}else{a=(b!=f);}break;case OpenLayers.Filter.Comparison.LESS_THAN:a=b<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:a=b>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:a=b<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:a=b>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:a=(b>=this.lowerBoundary)&&(b<=this.upperBoundary);break;case OpenLayers.Filter.Comparison.LIKE:var e=new RegExp(this.value,"gi");a=e.test(b);break;}return a;},value2regex:function(e,b,a){if(e=="."){var d="'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison";OpenLayers.Console.error(d);return null;}e=e?e:"*";b=b?b:".";a=a?a:"!";this.value=this.value.replace(new RegExp("\\"+a+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+b,"g"),".");this.value=this.value.replace(new RegExp("\\"+e,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+b);return this.value;},regex2value:function(){var a=this.value;a=a.replace(/!/g,"!!");a=a.replace(/(\\)?\\\./g,function(d,b){return b?d:"!.";});a=a.replace(/(\\)?\\\*/g,function(d,b){return b?d:"!*";});a=a.replace(/\\\\/g,"\\");a=a.replace(/\.\*/g,"*");return a;},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison(),this);},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},write:function(d,b){var a=(b&&b.version)||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=a){var e=OpenLayers.Format.Filter["v"+a.replace(/\./g,"_")];if(!e){throw"Can't find a Filter parser for version "+a;}this.parser=new e(this.options);}return this.parser.write(d);},read:function(d){if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d]);}var a=this.version;if(!a){a=this.defaultVersion;}if(!this.parser||this.parser.VERSION!=a){var e=OpenLayers.Format.Filter["v"+a.replace(/\./g,"_")];if(!e){throw"Can't find a Filter parser for version "+a;}this.parser=new e(this.options);}var b=this.parser.read(d);return b;},CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,defaultFilter:null,initialize:function(a){a=a||{};OpenLayers.Util.extend(this,a);this.options=a;},mergeWithDefaultFilter:function(b){var a;if(b&&this.defaultFilter){a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,b]});}else{a=b||this.defaultFilter||undefined;}return a;},destroy:function(){this.options=null;this.format=null;},read:function(a){a=a||{};a.filter=this.mergeWithDefaultFilter(a.filter);},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(a){},createCallback:function(d,a,b){return OpenLayers.Function.bind(function(){d.apply(this,[a,b]);},this);},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,reqFeatures:null,priv:null,initialize:function(a){OpenLayers.Util.extend(this,a);},success:function(){return this.code>0;},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,wildcarded:false,initialize:function(a){a=a||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this);},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments);a=OpenLayers.Util.applyDefaults(a,this.options);
a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params);if(a.filter){a.params=this.filterToParams(a.filter,a.params);}var b=(a.readWithPOST!==undefined)?a.readWithPOST:this.readWithPOST;var d=new OpenLayers.Protocol.Response({requestType:"read"});if(b){d.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,d,a),data:OpenLayers.Util.getParameterString(a.params),headers:{"Content-Type":"application/x-www-form-urlencoded"}});}else{d.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,d,a),params:a.params,headers:a.headers});}return d;},handleRead:function(b,a){this.handleResponse(b,a);},filterToParams:function(e,h){h=h||{};var d=e.CLASS_NAME;var f=d.substring(d.lastIndexOf(".")+1);switch(f){case"Spatial":switch(e.type){case OpenLayers.Filter.Spatial.BBOX:h.bbox=e.value.toArray();break;case OpenLayers.Filter.Spatial.DWITHIN:h.tolerance=e.distance;case OpenLayers.Filter.Spatial.WITHIN:h.lon=e.value.x;h.lat=e.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+e.type);}break;case"Comparison":var j=OpenLayers.Protocol.HTTP.COMP_TYPE_TO_OP_STR[e.type];if(j!==undefined){var g=e.value;if(e.type==OpenLayers.Filter.Comparison.LIKE){g=this.regex2value(g);if(this.wildcarded){g="%"+g+"%";}}h[e.property+"__"+j]=g;h.queryable=h.queryable||[];h.queryable.push(e.property);}else{OpenLayers.Console.warn("Unknown comparison filter type "+e.type);}break;case"Logical":if(e.type===OpenLayers.Filter.Logical.AND){for(var b=0,a=e.filters.length;b<a;b++){h=this.filterToParams(e.filters[b],h);}}else{OpenLayers.Console.warn("Unsupported logical filter type "+e.type);}break;default:OpenLayers.Console.warn("Unknown filter type "+f);}return h;},regex2value:function(a){a=a.replace(/%/g,"\\%");a=a.replace(/\\\\\.(\*)?/g,function(d,b){return b?d:"\\\\_";});a=a.replace(/\\\\\.\*/g,"\\\\%");a=a.replace(/(\\)?\.(\*)?/g,function(d,b,e){return b||e?d:"_";});a=a.replace(/(\\)?\.\*/g,function(d,b){return b?d:"%";});a=a.replace(/\\\./g,".");a=a.replace(/(\\)?\\\*/g,function(d,b){return b?d:"*";});return a;},create:function(b,a){a=OpenLayers.Util.applyDefaults(a,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:b,requestType:"create"});d.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleCreate,d,a),headers:a.headers,data:this.format.write(b)});return d;},handleCreate:function(b,a){this.handleResponse(b,a);},update:function(d,b){b=b||{};var a=b.url||d.url||this.options.url+"/"+d.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var e=new OpenLayers.Protocol.Response({reqFeatures:d,requestType:"update"});e.priv=OpenLayers.Request.PUT({url:a,callback:this.createCallback(this.handleUpdate,e,b),headers:b.headers,data:this.format.write(d)});return e;},handleUpdate:function(b,a){this.handleResponse(b,a);},"delete":function(d,b){b=b||{};var a=b.url||d.url||this.options.url+"/"+d.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var e=new OpenLayers.Protocol.Response({reqFeatures:d,requestType:"delete"});e.priv=OpenLayers.Request.DELETE({url:a,callback:this.createCallback(this.handleDelete,e,b),headers:b.headers});return e;},handleDelete:function(b,a){this.handleResponse(b,a);},handleResponse:function(d,a){var b=d.priv;if(a.callback){if(b.status>=200&&b.status<300){if(d.requestType!="delete"){d.features=this.parseFeatures(b);}d.code=OpenLayers.Protocol.Response.SUCCESS;}else{d.code=OpenLayers.Protocol.Response.FAILURE;}a.callback.call(a.scope,d);}},parseFeatures:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText;}if(!b||b.length<=0){return null;}return this.format.read(b);},commit:function(b,u){u=OpenLayers.Util.applyDefaults(u,this.options);var e=[],q=0;var m={};m[OpenLayers.State.INSERT]=[];m[OpenLayers.State.UPDATE]=[];m[OpenLayers.State.DELETE]=[];var t,o,d=[];for(var f=0,l=b.length;f<l;++f){t=b[f];o=m[t.state];if(o){o.push(t);d.push(t);}}var h=(m[OpenLayers.State.INSERT].length>0?1:0)+m[OpenLayers.State.UPDATE].length+m[OpenLayers.State.DELETE].length;var s=true;var a=new OpenLayers.Protocol.Response({reqFeatures:d});function j(w){var v=w.features?w.features.length:0;var B=new Array(v);for(var z=0;z<v;++z){B[z]=w.features[z].fid;}a.insertIds=B;r.apply(this,[w]);}function r(v){this.callUserCallback(v,u);s=s&&v.success();q++;if(q>=h){if(u.callback){a.code=s?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;u.callback.apply(u.scope,[a]);}}}var g=m[OpenLayers.State.INSERT];if(g.length>0){e.push(this.create(g,OpenLayers.Util.applyDefaults({callback:j,scope:this},u.create)));}g=m[OpenLayers.State.UPDATE];for(var f=g.length-1;f>=0;--f){e.push(this.update(g[f],OpenLayers.Util.applyDefaults({callback:r,scope:this},u.update)));}g=m[OpenLayers.State.DELETE];for(var f=g.length-1;f>=0;--f){e.push(this["delete"](g[f],OpenLayers.Util.applyDefaults({callback:r,scope:this},u["delete"])));}return e;},abort:function(a){if(a){a.priv.abort();}},callUserCallback:function(d,a){var b=a[d.requestType];if(b&&b.callback){b.callback.call(b.scope,d);}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});(function(){var a=OpenLayers.Protocol.HTTP.COMP_TYPE_TO_OP_STR={};a[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";a[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";a[OpenLayers.Filter.Comparison.LESS_THAN]="lt";a[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";a[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";a[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";a[OpenLayers.Filter.Comparison.LIKE]="ilike";})();OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a);},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null;},supported:function(){return false;},setExtent:function(a,b){this.extent=a.clone();if(b){this.resolution=null;}},setSize:function(a){this.size=a.clone();this.resolution=null;},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution;},drawFeature:function(d,e){if(e==null){e=d.style;}if(d.geometry){var f=d.geometry.getBounds();if(f){if(!f.intersectsBounds(this.extent)){e={display:"none"};}var g=this.drawGeometry(d.geometry,e,d.id);if(e.display!="none"&&e.label&&g!==false){var a=d.geometry.getCentroid();if(e.labelXOffset||e.labelYOffset){xOffset=isNaN(e.labelXOffset)?0:e.labelXOffset;yOffset=isNaN(e.labelYOffset)?0:e.labelYOffset;var b=this.getResolution();a.move(xOffset*b,yOffset*b);}this.drawText(d.id,e,a);}else{this.removeText(d.id);}return g;}}},drawGeometry:function(d,a,b){},drawText:function(d,b,a){},removeText:function(a){},clear:function(){},getFeatureIdFromEvent:function(a){},eraseFeatures:function(e){if(!(e instanceof Array)){e=[e];}for(var d=0,a=e.length;d<a;++d){var b=e[d];this.eraseGeometry(b.geometry,b.id);this.removeText(b.id);}},eraseGeometry:function(b,a){},moveRoot:function(a){},getRenderLayerId:function(){return this.container.id;},applyDefaultSymbolizer:function(b){var a=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);if(b.stroke===false){delete a.strokeWidth;delete a.strokeColor;}if(b.fill===false){delete a.fillColor;}OpenLayers.Util.extend(a,b);return a;},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0};OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.order=[];this.indices={};this.maxZIndex=0;},insert:function(d){if(this.exists(d)){this.remove(d);}var g=d.id;this.determineZIndex(d);var e=-1;var f=this.order.length;var a;while(f-e>1){a=parseInt((e+f)/2);var b=this.compare(this,d,OpenLayers.Util.getElement(this.order[a]));
if(b>0){e=a;}else{f=a;}}this.order.splice(f,0,g);this.indices[g]=this.getZIndex(d);return this.getNextElement(f);},remove:function(b){var e=b.id;var a=OpenLayers.Util.indexOf(this.order,e);if(a>=0){this.order.splice(a,1);delete this.indices[e];if(this.order.length>0){var d=this.order[this.order.length-1];this.maxZIndex=this.indices[d];}else{this.maxZIndex=0;}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0;},exists:function(a){return(this.indices[a.id]!=null);},getZIndex:function(a){return a._style.graphicZIndex;},determineZIndex:function(a){var b=a._style.graphicZIndex;if(b==null){b=this.maxZIndex;a._style.graphicZIndex=b;}else{if(b>this.maxZIndex){this.maxZIndex=b;}}},getNextElement:function(b){var a=b+1;if(a<this.order.length){var d=OpenLayers.Util.getElement(this.order[a]);if(d==undefined){d=this.getNextElement(a);}return d;}else{return null;}},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(f,e,b){var a=f.getZIndex(e);var g=0;if(b){var d=f.getZIndex(b);g=a-d;}return g;},Z_ORDER_DRAWING_ORDER:function(d,b,a){var e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(d,b,a);if(a&&e==0){e=1;}return e;},Z_ORDER_Y_ORDER:function(e,d,b){var f=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,d,b);if(b&&f===0){var a=b._boundsBottom-d._boundsBottom;f=(a===0)?1:a;}return f;}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(b&&(b.zIndexing||b.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering);}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments);},clear:function(){var b;var a=this.vectorRoot;if(a){while(b=a.firstChild){a.removeChild(b);}}a=this.textRoot;if(a){while(b=a.firstChild){a.removeChild(b);}}if(this.indexer){this.indexer.clear();}},getNodeType:function(b,a){},drawGeometry:function(h,e,g){var d=h.CLASS_NAME;var j=true;if((d=="OpenLayers.Geometry.Collection")||(d=="OpenLayers.Geometry.MultiPoint")||(d=="OpenLayers.Geometry.MultiLineString")||(d=="OpenLayers.Geometry.MultiPolygon")){for(var b=0,a=h.components.length;b<a;b++){j=this.drawGeometry(h.components[b],e,g)&&j;}return j;}j=false;if(e.display!="none"){if(e.backgroundGraphic){this.redrawBackgroundNode(h.id,h,e,g);}j=this.redrawNode(h.id,h,e,g);}if(j==false){var f=document.getElementById(h.id);if(f){if(f._style.backgroundGraphic){f.parentNode.removeChild(document.getElementById(h.id+this.BACKGROUND_ID_SUFFIX));}f.parentNode.removeChild(f);}}return j;},redrawNode:function(h,g,b,f){b=this.applyDefaultSymbolizer(b);var d=this.nodeFactory(h,this.getNodeType(g,b));d._featureId=f;d._boundsBottom=g.getBounds().bottom;d._geometryClass=g.CLASS_NAME;d._style=b;var a=this.drawGeometryNode(d,g,b);if(a===false){return false;}d=a.node;if(this.indexer){var e=this.indexer.insert(d);if(e){this.vectorRoot.insertBefore(d,e);}else{this.vectorRoot.appendChild(d);}}else{if(d.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(d);}}this.postDraw(d);return a.complete;},redrawBackgroundNode:function(f,e,b,d){var a=OpenLayers.Util.extend({},b);a.externalGraphic=a.backgroundGraphic;a.graphicXOffset=a.backgroundXOffset;a.graphicYOffset=a.backgroundYOffset;a.graphicZIndex=a.backgroundGraphicZIndex;a.graphicWidth=a.backgroundWidth||a.graphicWidth;a.graphicHeight=a.backgroundHeight||a.graphicHeight;a.backgroundGraphic=null;a.backgroundXOffset=null;a.backgroundYOffset=null;a.backgroundGraphicZIndex=null;return this.redrawNode(f+this.BACKGROUND_ID_SUFFIX,e,a,null);},drawGeometryNode:function(d,f,b){b=b||d._style;var a={isFilled:b.fill===undefined?true:b.fill,isStroked:b.stroke===undefined?!!b.strokeWidth:b.stroke};var e;switch(f.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.graphic===false){a.isFilled=false;a.isStroked=false;}e=this.drawPoint(d,f);break;case"OpenLayers.Geometry.LineString":a.isFilled=false;e=this.drawLineString(d,f);break;case"OpenLayers.Geometry.LinearRing":e=this.drawLinearRing(d,f);break;case"OpenLayers.Geometry.Polygon":e=this.drawPolygon(d,f);break;case"OpenLayers.Geometry.Surface":e=this.drawSurface(d,f);break;case"OpenLayers.Geometry.Rectangle":e=this.drawRectangle(d,f);break;default:break;}d._options=a;if(e!=false){return{node:this.setStyle(d,b,a,f),complete:e};}else{return false;}},postDraw:function(a){},drawPoint:function(a,b){},drawLineString:function(a,b){},drawLinearRing:function(a,b){},drawPolygon:function(a,b){},drawRectangle:function(a,b){},drawCircle:function(a,b){},drawSurface:function(a,b){},removeText:function(b){var a=document.getElementById(b+this.LABEL_ID_SUFFIX);if(a){this.textRoot.removeChild(a);}},getFeatureIdFromEvent:function(a){var e=a.target;var b=e&&e.correspondingUseElement;var d=b?b:(e||a.srcElement);var f=d._featureId;return f;},eraseGeometry:function(h,g){if((h.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")||(h.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(h.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")||(h.CLASS_NAME=="OpenLayers.Geometry.Collection")){for(var e=0,a=h.components.length;e<a;e++){this.eraseGeometry(h.components[e],g);}}else{var d=OpenLayers.Util.getElement(h.id);if(d&&d.parentNode){if(d.geometry){d.geometry.destroy();d.geometry=null;}d.parentNode.removeChild(d);if(this.indexer){this.indexer.remove(d);}if(d._style.backgroundGraphic){var b=h.id+this.BACKGROUND_ID_SUFFIX;var f=OpenLayers.Util.getElement(b);if(f&&f.parentNode){f.parentNode.removeChild(f);}}}}},nodeFactory:function(d,a){var b=OpenLayers.Util.getElement(d);if(b){if(!this.nodeTypeCompare(b,a)){b.parentNode.removeChild(b);b=this.nodeFactory(d,a);}}else{b=this.createNode(a,d);}return b;},nodeTypeCompare:function(b,a){},createNode:function(a,b){},moveRoot:function(b){var a=this.root;if(b.root.parentNode==this.rendererRoot){a=b.root;}a.parentNode.removeChild(a);b.rendererRoot.appendChild(a);},getRenderLayerId:function(){return this.root.parentNode.parentNode.id;},isComplexSymbol:function(a){return(a!="circle")&&!!a;},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(e,b,d,a){OpenLayers.Handler.prototype.initialize.apply(this,[e,d,a]);this.layer=b;},mousedown:function(a){this.down=a.xy;return this.handle(a)?!this.stopDown:true;},mouseup:function(a){this.up=a.xy;return this.handle(a)?!this.stopUp:true;},click:function(a){return this.handle(a)?!this.stopClick:true;},mousemove:function(a){if(!this.callbacks.over&&!this.callbacks.out){return true;}this.handle(a);return true;},dblclick:function(a){return !this.handle(a);},geometryTypeMatches:function(a){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1;},handle:function(a){if(this.feature&&!this.feature.layer){this.feature=null;}var d=a.type;var g=false;
var f=!!(this.feature);var e=(d=="click"||d=="dblclick");this.feature=this.layer.getFeatureFromEvent(a);if(this.feature&&!this.feature.layer){this.feature=null;}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null;}if(this.feature){var b=(this.feature!=this.lastFeature);if(this.geometryTypeMatches(this.feature)){if(f&&b){if(this.lastFeature){this.triggerCallback(d,"out",[this.lastFeature]);}this.triggerCallback(d,"in",[this.feature]);}else{if(!f||e){this.triggerCallback(d,"in",[this.feature]);}}this.lastFeature=this.feature;g=true;}else{if(this.lastFeature&&(f&&b||e)){this.triggerCallback(d,"out",[this.lastFeature]);}this.feature=null;}}else{if(this.lastFeature&&(f||e)){this.triggerCallback(d,"out",[this.lastFeature]);}}return g;},triggerCallback:function(e,f,b){var d=this.EVENTMAP[e][f];if(d){if(e=="click"&&this.up&&this.down){var a=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(a<=this.clickTolerance){this.callback(d,b);}}else{this.callback(d,b);}}},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true;}return a;},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true;}return a;},handleMapEvents:function(a){if(!a.property||a.property=="order"){this.moveLayerToTop();}},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a);},moveLayerBack:function(){var a=this.layer.getZIndex()-1;if(a>=this.map.Z_INDEX_BASE.Feature){this.layer.setZIndex(a);}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer));}},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(d,a){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(d instanceof OpenLayers.Style){this.styles["default"]=d;this.styles.select=d;this.styles.temporary=d;this.styles["delete"]=d;}else{if(typeof d=="object"){for(var b in d){if(d[b] instanceof OpenLayers.Style){this.styles[b]=d[b];}else{if(typeof d[b]=="object"){this.styles[b]=new OpenLayers.Style(d[b]);}else{this.styles["default"]=new OpenLayers.Style(d);this.styles.select=new OpenLayers.Style(d);this.styles.temporary=new OpenLayers.Style(d);this.styles["delete"]=new OpenLayers.Style(d);break;}}}}}OpenLayers.Util.extend(this,a);},destroy:function(){for(var a in this.styles){this.styles[a].destroy();}this.styles=null;},createSymbolizer:function(b,d){if(!b){b=new OpenLayers.Feature.Vector();}if(!this.styles[d]){d="default";}b.renderIntent=d;var a={};if(this.extendDefault&&d!="default"){a=this.styles["default"].createSymbolizer(b);}return OpenLayers.Util.extend(a,this.styles[d].createSymbolizer(b));},addUniqueValueRules:function(b,e,g,a){var f=[];for(var d in g){f.push(new OpenLayers.Rule({symbolizer:g[d],context:a,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:e,value:d})}));}this.styles[b].addRules(f);},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","beforefeaturesremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","sketchstarted","sketchmodified","sketchcomplete","refresh"],isBaseLayer:false,isFixed:false,isVector:true,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,initialize:function(d,b){this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES);OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer();}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError();}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap();}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var e=0,a=this.strategies.length;e<a;e++){this.strategies[e].setLayer(this);}}},destroy:function(){if(this.strategies){var d,b,a;for(b=0,a=this.strategies.length;b<a;b++){d=this.strategies[b];if(d.autoDestroy){d.destroy();}}this.strategies=null;}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy();}this.protocol=null;}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy();}this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments);},clone:function(f){if(f==null){f=new OpenLayers.Layer.Vector(this.name,this.getOptions());}f=OpenLayers.Layer.prototype.clone.apply(this,[f]);var d=this.features;var a=d.length;var e=new Array(a);for(var b=0;b<a;++b){e[b]=d[b].clone();}f.features=e;return f;},refresh:function(a){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",a);}},assignRenderer:function(){for(var d=0,a=this.renderers.length;d<a;d++){var b=this.renderers[d];var e=(typeof b=="function")?b:OpenLayers.Renderer[b];if(e&&e.prototype.supported()){this.renderer=new e(this.div,this.rendererOptions);break;}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}));}},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this);}else{this.renderer.map=this.map;this.renderer.setSize(this.map.getSize());}},afterAdd:function(){if(this.strategies){var d,b,a;for(b=0,a=this.strategies.length;b<a;b++){d=this.strategies[b];if(d.autoActivate){d.activate();}}}},removeMap:function(d){this.drawn=false;if(this.strategies){var e,b,a;for(b=0,a=this.strategies.length;b<a;b++){e=this.strategies[b];if(e.autoActivate){e.deactivate();}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);this.renderer.setSize(this.map.getSize());},moveTo:function(h,b,j){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var f=true;if(!j){this.renderer.root.style.visibility="hidden";this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var g=this.map.getExtent();f=this.renderer.setExtent(g,b);this.renderer.root.style.visibility="visible";if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.div.scrollLeft=this.div.scrollLeft;}if(!b&&f){for(var e in this.unrenderedFeatures){var d=this.unrenderedFeatures[e];this.drawFeature(d);}}}if(!this.drawn||b||!f){this.drawn=true;var d;for(var e=0,a=this.features.length;e<a;e++){this.renderer.locked=(e!==(a-1));d=this.features[e];this.drawFeature(d);}}},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);var b=this.div.style.display;if(b!=this.renderer.root.style.display){this.renderer.root.style.display=b;}},addFeatures:function(b,m){if(!(b instanceof Array)){b=[b];}var j=!m||!m.silent;if(j){var a={features:b};var h=this.events.triggerEvent("beforefeaturesadded",a);if(h===false){return;}b=a.features;}var e=[];for(var d=0,g=b.length;
d<g;d++){if(d!=(b.length-1)){this.renderer.locked=true;}else{this.renderer.locked=false;}var l=b[d];if(this.geometryType&&!(l.geometry instanceof this.geometryType)){var f=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});throw f;}l.layer=this;if(!l.style&&this.style){l.style=OpenLayers.Util.extend({},this.style);}if(j){if(this.events.triggerEvent("beforefeatureadded",{feature:l})===false){continue;}this.preFeatureInsert(l);}e.push(l);this.features.push(l);this.drawFeature(l);if(j){this.events.triggerEvent("featureadded",{feature:l});this.onFeatureInsert(l);}}if(j){this.events.triggerEvent("featuresadded",{features:e});}},removeFeatures:function(f,a){if(!f||f.length===0){return;}if(f===this.features){return this.removeAllFeatures(a);}if(!(f instanceof Array)){f=[f];}if(f===this.selectedFeatures){f=f.slice();}var e=!a||!a.silent;if(e){this.events.triggerEvent("beforefeaturesremoved",{features:f});}for(var d=f.length-1;d>=0;d--){if(d!=0&&f[d-1].geometry){this.renderer.locked=true;}else{this.renderer.locked=false;}var b=f[d];delete this.unrenderedFeatures[b.id];if(e){this.events.triggerEvent("beforefeatureremoved",{feature:b});}this.features=OpenLayers.Util.removeItem(this.features,b);b.layer=null;if(b.geometry){this.renderer.eraseFeatures(b);}if(OpenLayers.Util.indexOf(this.selectedFeatures,b)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,b);}if(e){this.events.triggerEvent("featureremoved",{feature:b});}}if(e){this.events.triggerEvent("featuresremoved",{features:f});}},removeAllFeatures:function(a){var e=!a||!a.silent;var f=this.features;if(e){this.events.triggerEvent("beforefeaturesremoved",{features:f});}var d;for(var b=f.length-1;b>=0;b--){d=f[b];if(e){this.events.triggerEvent("beforefeatureremoved",{feature:d});}d.layer=null;if(e){this.events.triggerEvent("featureremoved",{feature:d});}}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];if(e){this.events.triggerEvent("featuresremoved",{features:f});}},destroyFeatures:function(e,a){var d=(e==undefined);if(d){e=this.features;}if(e){this.removeFeatures(e,a);for(var b=e.length-1;b>=0;b--){e[b].destroy();}}},drawFeature:function(a,b){if(!this.drawn){return;}if(typeof b!="object"){if(!b&&a.state===OpenLayers.State.DELETE){b="delete";}var d=b||a.renderIntent;b=a.style||this.style;if(!b){b=this.styleMap.createSymbolizer(a,d);}}if(!this.renderer.drawFeature(a,b)){this.unrenderedFeatures[a.id]=a;}else{delete this.unrenderedFeatures[a.id];}},eraseFeatures:function(a){this.renderer.eraseFeatures(a);},getFeatureFromEvent:function(a){if(!this.renderer){OpenLayers.Console.error(OpenLayers.i18n("getFeatureError"));return null;}var b=this.renderer.getFeatureIdFromEvent(a);return this.getFeatureById(b);},getFeatureBy:function(f,e){var d=null;for(var b=0,a=this.features.length;b<a;++b){if(this.features[b][f]==e){d=this.features[b];break;}}return d;},getFeatureById:function(a){return this.getFeatureBy("id",a);},getFeatureByFid:function(a){return this.getFeatureBy("fid",a);},onFeatureInsert:function(a){},preFeatureInsert:function(a){},getDataExtent:function(){var b=null;var e=this.features;if(e&&(e.length>0)){b=new OpenLayers.Bounds();var f=null;for(var d=0,a=e.length;d<a;d++){f=e[d].geometry;if(f){b.extend(f.getBounds());}}}return b;},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(b,a){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[];},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments);},setOpacity:function(b){if(b!=this.opacity){this.opacity=b;for(var d=0,a=this.markers.length;d<a;d++){this.markers[d].setOpacity(this.opacity);}}},moveTo:function(e,b,f){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(b||!this.drawn){for(var d=0,a=this.markers.length;d<a;d++){this.drawMarker(this.markers[d]);}this.drawn=true;}},addMarker:function(a){this.markers.push(a);if(this.opacity!=null){a.setOpacity(this.opacity);}if(this.map&&this.map.getExtent()){a.map=this.map;this.drawMarker(a);}},removeMarker:function(a){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,a);a.erase();}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0]);}}},drawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);if(b==null){a.display(false);}else{if(!a.isDrawn()){var d=a.draw(b);this.div.appendChild(d);}else{if(a.icon){a.icon.moveTo(b);}}}},getDataExtent:function(){var b=null;if(this.markers&&(this.markers.length>0)){var b=new OpenLayers.Bounds();for(var e=0,a=this.markers.length;e<a;e++){var d=this.markers[e];b.extend(d.lonlat);}}return b;},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:false,layers:null,initialize:function(b,a){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments);},display:function(){},getFeatureFromEvent:function(a){var e=this.layers;var d;for(var b=0;b<e.length;b++){d=e[b].getFeatureFromEvent(a);if(d){return d;}}},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();a.events.register("changelayer",this,this.handleChangeLayer);},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments);},collectRoots:function(){var b;for(var a=0;a<this.map.layers.length;++a){b=this.map.layers[a];if(OpenLayers.Util.indexOf(this.layers,b)!=-1){b.renderer.moveRoot(this.renderer);}}},resetRoots:function(){var b;for(var a=0;a<this.layers.length;++a){b=this.layers[a];if(this.renderer&&b.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(b.renderer);}}},handleChangeLayer:function(a){var b=a.layer;if(a.property=="order"&&OpenLayers.Util.indexOf(this.layers,b)!=-1){this.resetRoots();this.collectRoots();}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(d,a){this.EVENT_TYPES=OpenLayers.Control.SelectFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);if(this.scope===null){this.scope=this;}this.initLayer(d);var b={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){b.over=this.overFeature;b.out=this.outFeature;}this.callbacks=OpenLayers.Util.extend(b,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"});}},initLayer:function(a){if(a instanceof Array){this.layers=a;this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a});}else{this.layer=a;}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer);}OpenLayers.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy();}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer);}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate();}}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate();
}if(this.layers){this.map.removeLayer(this.layer);}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},unselectAll:function(b){var g=this.layers||[this.layer];var f,e;for(var a=0;a<g.length;++a){f=g[a];for(var d=f.selectedFeatures.length-1;d>=0;--d){e=f.selectedFeatures[d];if(!b||b.except!=e){this.unselect(e);}}}},clickFeature:function(a){if(!this.hover){var b=(OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1);if(b){if(this.toggleSelect()){this.unselect(a);}else{if(!this.multipleSelect()){this.unselectAll({except:a});}}}else{if(!this.multipleSelect()){this.unselectAll({except:a});}this.select(a);}}},multipleSelect:function(){return this.multiple||(this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]);},toggleSelect:function(){return this.toggle||(this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]);},clickoutFeature:function(a){if(!this.hover&&this.clickout){this.unselectAll();}},overFeature:function(b){var a=b.layer;if(this.hover){if(this.highlightOnly){this.highlight(b);}else{if(OpenLayers.Util.indexOf(a.selectedFeatures,b)==-1){this.select(b);}}}},outFeature:function(a){if(this.hover){if(this.highlightOnly){if(a._lastHighlighter==this.id){if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);if(b){b.highlight(a);}}else{this.unhighlight(a);}}}else{this.unselect(a);}}},highlight:function(d){var b=d.layer;var a=this.events.triggerEvent("beforefeaturehighlighted",{feature:d});if(a!==false){d._prevHighlighter=d._lastHighlighter;d._lastHighlighter=this.id;var e=this.selectStyle||this.renderIntent;b.drawFeature(d,e);this.events.triggerEvent("featurehighlighted",{feature:d});}},unhighlight:function(b){var a=b.layer;b._lastHighlighter=b._prevHighlighter;delete b._prevHighlighter;a.drawFeature(b,b.style||b.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:b});},select:function(d){var a=this.onBeforeSelect.call(this.scope,d);var b=d.layer;if(a!==false){a=b.events.triggerEvent("beforefeatureselected",{feature:d});if(a!==false){b.selectedFeatures.push(d);this.highlight(d);if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=b.selectedFeatures[0];}b.events.triggerEvent("featureselected",{feature:d});this.onSelect.call(this.scope,d);}}},unselect:function(b){var a=b.layer;this.unhighlight(b);OpenLayers.Util.removeItem(a.selectedFeatures,b);a.events.triggerEvent("featureunselected",{feature:b});this.onUnselect.call(this.scope,b);},selectBox:function(f){if(f instanceof OpenLayers.Bounds){var j=this.map.getLonLatFromPixel(new OpenLayers.Pixel(f.left,f.bottom));var o=this.map.getLonLatFromPixel(new OpenLayers.Pixel(f.right,f.top));var a=new OpenLayers.Bounds(j.lon,j.lat,o.lon,o.lat);if(!this.multipleSelect()){this.unselectAll();}var m=this.multiple;this.multiple=true;var e=this.layers||[this.layer];var g;for(var b=0;b<e.length;++b){g=e[b];for(var d=0,h=g.features.length;d<h;++d){var q=g.features[d];if(!q.getVisibility()){continue;}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,q.geometry.CLASS_NAME)>-1){if(a.toGeometry().intersects(q.geometry)){if(OpenLayers.Util.indexOf(g.selectedFeatures,q)==-1){this.select(q);}}}}}this.multiple=m;}},setMap:function(a){this.handlers.feature.setMap(a);if(this.box){this.handlers.box.setMap(a);}OpenLayers.Control.prototype.setMap.apply(this,arguments);},setLayer:function(b){var a=this.active;this.unselectAll();this.deactivate();if(this.layers){this.layer.destroy();this.layers=null;}this.initLayer(b);this.handlers.feature.layer=this.layer;if(a){this.activate();}},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var b={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(b,this.previousOptions);this.previous=new OpenLayers.Control.Button(b);var d={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(d,this.nextOptions);this.next=new OpenLayers.Control.Button(d);this.clear();},onPreviousChange:function(b,a){if(b&&!this.previous.active){this.previous.activate();}else{if(!b&&this.previous.active){this.previous.deactivate();}}},onNextChange:function(b,a){if(b&&!this.next.active){this.next.activate();}else{if(!b&&this.next.active){this.next.deactivate();}}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var a in this){this[a]=null;}},setMap:function(a){this.map=a;this.next.setMap(a);this.previous.setMap(a);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw();},previousTrigger:function(){var b=this.previousStack.shift();var a=this.previousStack.shift();if(a!=undefined){this.nextStack.unshift(b);this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);}else{this.previousStack.unshift(b);}return a;},nextTrigger:function(){var a=this.nextStack.shift();if(a!=undefined){this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);}return a;},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate();},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units};},restore:function(f){var a,e;if(this.map.getProjectionObject()==f.projection){e=this.map.getZoomForResolution(f.resolution);a=f.center;}else{a=f.center.clone();a.transform(f.projection,this.map.getProjectionObject());var g=f.units;var b=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var d=g&&b?OpenLayers.INCHES_PER_UNIT[g]/OpenLayers.INCHES_PER_UNIT[b]:1;e=this.map.getZoomForResolution(d*f.resolution);}this.map.setCenter(a,e);},setListeners:function(){this.listeners={};for(var a in this.registry){this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=this.registry[a].apply(this,arguments);this.previousStack.unshift(b);if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);}if(this.previousStack.length>(this.limit+1)){this.previousStack.pop();}if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0);}}return true;},this);}},activate:function(){var a=false;if(this.map){if(OpenLayers.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners();}for(var b in this.listeners){this.map.events.register(b,this,this.listeners[b]);}a=true;if(this.previousStack.length==0){this.initStack();}}}return a;},initStack:function(){if(this.map.getCenter()){this.listeners.moveend();}},deactivate:function(){var b=false;if(this.map){if(OpenLayers.Control.prototype.deactivate.apply(this)){for(var a in this.listeners){this.map.events.unregister(a,this,this.listeners[a]);}if(this.clearOnDeactivate){this.clear();}b=true;}}return b;},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);
},destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div;},updateAttribution:function(){var e=[];if(this.map&&this.map.layers){for(var d=0,a=this.map.layers.length;d<a;d++){var b=this.map.layers[d];if(b.attribution&&b.getVisibility()){if(OpenLayers.Util.indexOf(e,b.attribution)===-1){e.push(b.attribution);}}}this.div.innerHTML=e.join(this.separator);}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,drillDown:false,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:false,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["beforegetfeatureinfo","nogetfeatureinfo","getfeatureinfo"],initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.WMSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions);}if(this.drillDown===true){this.hover=false;}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));}else{var b={};b[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{});}},activate:function(){if(!this.active){this.handler.activate();}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},getInfoForClick:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(a.xy,{});},getInfoForHover:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});this.request(a.xy,{hover:true});},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null;}},findLayers:function(){var f=this.layers||this.map.layers;var g=[];var e,b;for(var d=0,a=f.length;d<a;++d){e=f[d];if(e instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())){b=e.url instanceof Array?e.url[0]:e.url;if(this.drillDown===false&&!this.url){this.url=b;}if(this.drillDown===true||this.urlMatches(b)){g.push(e);}}}return g;},urlMatches:function(b){var e=OpenLayers.Util.isEquivalentUrl(this.url,b);if(!e&&this.layerUrls){for(var d=0,a=this.layerUrls.length;d<a;++d){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[d],b)){e=true;break;}}}return e;},buildWMSOptions:function(a,e,b,j){var h=[],l=[];for(var f=0,g=e.length;f<g;f++){h=h.concat(e[f].params.LAYERS);l=l.concat(this.getStyleNames(e[f]));}var d=OpenLayers.Util.extend({service:"WMS",version:e[0].params.VERSION,request:"GetFeatureInfo",layers:h,query_layers:h,styles:l,bbox:this.map.getExtent().toBBOX(null,e[0].reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:j,info_format:this.infoFormat},(parseFloat(e[0].params.VERSION)>=1.3)?{crs:this.map.getProjection(),i:b.x,j:b.y}:{srs:this.map.getProjection(),x:b.x,y:b.y});OpenLayers.Util.applyDefaults(d,this.vendorParams);return{url:a,params:OpenLayers.Util.upperCaseObject(d),callback:function(m){this.handleResponse(b,m);},scope:this};},getStyleNames:function(b){var a;if(b.params.STYLES){a=b.params.STYLES;}else{if(b.params.LAYERS instanceof Array){a=new Array(b.params.LAYERS.length);}else{a=b.params.LAYERS.replace(/[^,]/g,"");}}return a;},request:function(b,q){var e=this.findLayers();if(e.length==0){this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");return;}q=q||{};if(this.drillDown===false){var m=this.buildWMSOptions(this.url,e,b,e[0].params.FORMAT);var d=OpenLayers.Request.GET(m);if(q.hover===true){this.hoverRequest=d;}}else{this._requestCount=0;this._numRequests=0;this.features=[];var l={},a;for(var f=0,j=e.length;f<j;f++){var g=e[f];var h,o=false;a=g.url instanceof Array?g.url[0]:g.url;if(a in l){l[a].push(g);}else{this._numRequests++;l[a]=[g];}}var e;for(var a in l){e=l[a];var m=this.buildWMSOptions(a,e,b,e[0].params.FORMAT);OpenLayers.Request.GET(m);}}},triggerGetFeatureInfo:function(b,d,a){this.events.triggerEvent("getfeatureinfo",{text:b.responseText,features:a,request:b,xy:d});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");},handleResponse:function(e,b){var d=b.responseXML;if(!d||!d.documentElement){d=b.responseText;}var a=this.format.read(d);if(this.drillDown===false){this.triggerGetFeatureInfo(b,e,a);}else{this._requestCount++;this._features=(this._features||[]).concat(a);if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(b,e,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests;}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},events:new OpenLayers.Events(this,null,["complete","success","failure"]),issue:function(b){var f=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});b=OpenLayers.Util.applyDefaults(b,f);var e=new OpenLayers.Request.XMLHttpRequest();var a=b.url;if(b.params){var d=OpenLayers.Util.getParameterString(b.params);if(d.length>0){var h=(a.indexOf("?")>-1)?"&":"?";a+=h+d;}}if(b.proxy&&(a.indexOf("http")==0)){if(typeof b.proxy=="function"){a=b.proxy(a);}else{a=b.proxy+encodeURIComponent(a);}}e.open(b.method,a,b.async,b.user,b.password);for(var g in b.headers){e.setRequestHeader(g,b.headers[g]);}var l=this.events;var j=this;e.onreadystatechange=function(){if(e.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var m=l.triggerEvent("complete",{request:e,config:b,requestUrl:a});if(m!==false){j.runCallbacks({request:e,config:b,requestUrl:a});}}};if(b.async===false){e.send(b.data);}else{window.setTimeout(function(){if(e._aborted!==true){e.send(b.data);}},0);}return e;},runCallbacks:function(e){var f=e.request;var d=e.config;var a=(d.scope)?OpenLayers.Function.bind(d.callback,d.scope):d.callback;var g;if(d.success){g=(d.scope)?OpenLayers.Function.bind(d.success,d.scope):d.success;}var b;if(d.failure){b=(d.scope)?OpenLayers.Function.bind(d.failure,d.scope):d.failure;}a(f);if(!f.status||(f.status>=200&&f.status<300)){this.events.triggerEvent("success",e);if(g){g(f);}}if(f.status&&(f.status<200||f.status>=300)){this.events.triggerEvent("failure",e);if(b){b(f);}}},GET:function(a){a=OpenLayers.Util.extend(a,{method:"GET"});return OpenLayers.Request.issue(a);},POST:function(a){a=OpenLayers.Util.extend(a,{method:"POST"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml";}return OpenLayers.Request.issue(a);},PUT:function(a){a=OpenLayers.Util.extend(a,{method:"PUT"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml";}return OpenLayers.Request.issue(a);},DELETE:function(a){a=OpenLayers.Util.extend(a,{method:"DELETE"});return OpenLayers.Request.issue(a);},HEAD:function(a){a=OpenLayers.Util.extend(a,{method:"HEAD"});return OpenLayers.Request.issue(a);
},OPTIONS:function(a){a=OpenLayers.Util.extend(a,{method:"OPTIONS"});return OpenLayers.Request.issue(a);}};(function(){var f=window.XMLHttpRequest;var a=!!window.controllers,j=window.document.all&&!window.opera,l=j&&window.navigator.userAgent.match(/MSIE ([\.0-9]+)/)&&RegExp.$1==7;function d(){this._object=f&&!l?new f:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[];}if(a&&f.wrapped){d.wrapped=f.wrapped;}d.UNSENT=0;d.OPENED=1;d.HEADERS_RECEIVED=2;d.LOADING=3;d.DONE=4;d.prototype.readyState=d.UNSENT;d.prototype.responseText="";d.prototype.responseXML=null;d.prototype.status=0;d.prototype.statusText="";d.prototype.onreadystatechange=null;d.onreadystatechange=null;d.onopen=null;d.onsend=null;d.onabort=null;d.prototype.open=function(r,u,q,v,o){delete this._headers;if(arguments.length<3){q=true;}this._async=q;var t=this,s=this.readyState,m;if(j&&q){m=function(){if(s!=d.DONE){e(t);t.abort();}};window.attachEvent("onunload",m);}if(d.onopen){d.onopen.apply(this,arguments);}if(arguments.length>4){this._object.open(r,u,q,v,o);}else{if(arguments.length>3){this._object.open(r,u,q,v);}else{this._object.open(r,u,q);}}if(!a&&!j){this.readyState=d.OPENED;b(this);}this._object.onreadystatechange=function(){if(a&&!q){return;}t.readyState=t._object.readyState;g(t);if(t._aborted){t.readyState=d.UNSENT;return;}if(t.readyState==d.DONE){e(t);if(j&&q){window.detachEvent("onunload",m);}}if(s!=t.readyState){b(t);}s=t.readyState;};};d.prototype.send=function(m){if(d.onsend){d.onsend.apply(this,arguments);}if(m&&m.nodeType){m=window.XMLSerializer?new window.XMLSerializer().serializeToString(m):m.xml;if(!this._headers["Content-Type"]){this._object.setRequestHeader("Content-Type","application/xml");}}this._object.send(m);if(a&&!this._async){this.readyState=d.OPENED;g(this);while(this.readyState<d.DONE){this.readyState++;b(this);if(this._aborted){return;}}}};d.prototype.abort=function(){if(d.onabort){d.onabort.apply(this,arguments);}if(this.readyState>d.UNSENT){this._aborted=true;}this._object.abort();e(this);};d.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders();};d.prototype.getResponseHeader=function(m){return this._object.getResponseHeader(m);};d.prototype.setRequestHeader=function(m,o){if(!this._headers){this._headers={};}this._headers[m]=o;return this._object.setRequestHeader(m,o);};d.prototype.addEventListener=function(r,q,o){for(var m=0,s;s=this._listeners[m];m++){if(s[0]==r&&s[1]==q&&s[2]==o){return;}}this._listeners.push([r,q,o]);};d.prototype.removeEventListener=function(r,q,o){for(var m=0,s;s=this._listeners[m];m++){if(s[0]==r&&s[1]==q&&s[2]==o){break;}}if(s){this._listeners.splice(m,1);}};d.prototype.dispatchEvent=function(o){var q={type:o.type,target:this,currentTarget:this,eventPhase:2,bubbles:o.bubbles,cancelable:o.cancelable,timeStamp:o.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};if(q.type=="readystatechange"&&this.onreadystatechange){(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[q]);}for(var m=0,r;r=this._listeners[m];m++){if(r[0]==q.type&&!r[2]){(r[1].handleEvent||r[1]).apply(this,[q]);}}};d.prototype.toString=function(){return"[object XMLHttpRequest]";};d.toString=function(){return"[XMLHttpRequest]";};function b(m){if(d.onreadystatechange){d.onreadystatechange.apply(m);}m.dispatchEvent({type:"readystatechange",bubbles:false,cancelable:false,timeStamp:new Date+0});}function h(q){var o=q.responseXML,m=q.responseText;if(j&&m&&o&&!o.documentElement&&q.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){o=new window.ActiveXObject("Microsoft.XMLDOM");o.async=false;o.validateOnParse=false;o.loadXML(m);}if(o){if((j&&o.parseError!=0)||!o.documentElement||(o.documentElement&&o.documentElement.tagName=="parsererror")){return null;}}return o;}function g(m){try{m.responseText=m._object.responseText;}catch(o){}try{m.responseXML=h(m._object);}catch(o){}try{m.status=m._object.status;}catch(o){}try{m.statusText=m._object.statusText;}catch(o){}}function e(m){m._object.onreadystatechange=new window.Function;}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(m,o){if(!o){o=[];}m.__func=this;m.__func(o[0],o[1],o[2],o[3],o[4]);delete m.__func;};}OpenLayers.Request.XMLHttpRequest=d;})();OpenLayers.ProxyHost="";OpenLayers.nullHandler=function(a){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:a.statusText}));};OpenLayers.loadURL=function(e,h,b,f,d){if(typeof h=="string"){h=OpenLayers.Util.getParameters(h);}var g=(f)?f:OpenLayers.nullHandler;var a=(d)?d:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:e,params:h,success:g,failure:a,scope:b});};OpenLayers.parseXMLString=function(d){var a=d.indexOf("<");if(a>0){d=d.substring(a);}var b=OpenLayers.Util.Try(function(){var e=new ActiveXObject("Microsoft.XMLDOM");e.loadXML(d);return e;},function(){return new DOMParser().parseFromString(d,"text/xml");},function(){var e=new XMLHttpRequest();e.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(d),false);if(e.overrideMimeType){e.overrideMimeType("text/xml");}e.send(null);return e.responseXML;});return b;};OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest();},function(){return new ActiveXObject("Msxml2.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");})||false;},activeRequestCount:0};OpenLayers.Ajax.Responders={responders:[],register:function(b){for(var a=0;a<this.responders.length;a++){if(b==this.responders[a]){return;}}this.responders.push(b);},unregister:function(a){OpenLayers.Util.removeItem(this.reponders,a);},dispatch:function(h,d,g){var a;for(var b=0;b<this.responders.length;b++){a=this.responders[b];if(a[h]&&typeof a[h]=="function"){try{a[h].apply(a,[d,g]);}catch(f){}}}}};OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++;},onComplete:function(){OpenLayers.Ajax.activeRequestCount--;}});OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/xml",parameters:""};OpenLayers.Util.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters);}}});OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:false,initialize:function(b,a){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[a]);if(OpenLayers.ProxyHost&&OpenLayers.String.startsWith(b,"http")){b=OpenLayers.ProxyHost+encodeURIComponent(b);}this.transport=OpenLayers.Ajax.getTransport();this.request(b);},request:function(b){this.url=b;this.method=this.options.method;var f=OpenLayers.Util.extend({},this.options.parameters);if(this.method!="get"&&this.method!="post"){f._method=this.method;this.method="post";}this.parameters=f;if(f=OpenLayers.Util.getParameterString(f)){if(this.method=="get"){this.url+=((this.url.indexOf("?")>-1)?"&":"?")+f;}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){f+="&_=";}}}try{var a=new OpenLayers.Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(a);}OpenLayers.Ajax.Responders.dispatch("onCreate",this,a);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10);}this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||f):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange();}}catch(d){this.dispatchException(d);}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!((a==4)&&this._complete)){this.respondToReadyState(this.transport.readyState);}},setRequestHeaders:function(){var f={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:true};
if(this.method=="post"){f["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){f.Connection="close";}}if(typeof this.options.requestHeaders=="object"){var d=this.options.requestHeaders;if(typeof d.push=="function"){for(var b=0,e=d.length;b<e;b+=2){f[d[b]]=d[b+1];}}else{for(var b in d){f[b]=d[b];}}}for(var a in f){this.transport.setRequestHeader(a,f[a]);}},success:function(){var a=this.getStatus();return !a||(a>=200&&a<300);},getStatus:function(){try{return this.transport.status||0;}catch(a){return 0;}},respondToReadyState:function(a){var d=OpenLayers.Ajax.Request.Events[a];var b=new OpenLayers.Ajax.Response(this);if(d=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(b);}catch(f){this.dispatchException(f);}var g=b.getHeader("Content-type");}try{(this.options["on"+d]||OpenLayers.Ajax.emptyFunction)(b);OpenLayers.Ajax.Responders.dispatch("on"+d,this,b);}catch(f){this.dispatchException(f);}if(d=="Complete"){this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction;}},getHeader:function(a){try{return this.transport.getResponseHeader(a);}catch(b){return null;}},dispatchException:function(d){var e=this.options.onException;if(e){e(this,d);OpenLayers.Ajax.Responders.dispatch("onException",this,d);}else{var f=false;var a=OpenLayers.Ajax.Responders.responders;for(var b=0;b<a.length;b++){if(a[b].onException){f=true;break;}}if(f){OpenLayers.Ajax.Responders.dispatch("onException",this,d);}else{throw d;}}}});OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(d){this.request=d;var e=this.transport=d.transport,a=this.readyState=e.readyState;if((a>2&&!(!!(window.attachEvent&&!window.opera)))||a==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=e.responseText==null?"":String(e.responseText);}if(a==4){var b=e.responseXML;this.responseXML=b===undefined?null:b;}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||"";}catch(a){return"";}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(a){return this.transport.getResponseHeader(a);}});OpenLayers.Ajax.getElementsByTagNameNS=function(b,a,d,f){var e=null;if(b.getElementsByTagNameNS){e=b.getElementsByTagNameNS(a,f);}else{e=b.getElementsByTagName(d+":"+f);}return e;};OpenLayers.Ajax.serializeXMLToString=function(a){var b=new XMLSerializer();var d=b.serializeToString(a);return d;};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(b,a){this.lon=OpenLayers.Util.toFloat(b);this.lat=OpenLayers.Util.toFloat(a);},toString:function(){return("lon="+this.lon+",lat="+this.lat);},toShortString:function(){return(this.lon+", "+this.lat);},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat);},add:function(d,a){if((d==null)||(a==null)){var b=OpenLayers.i18n("lonlatAddError");OpenLayers.Console.error(b);return null;}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(d),this.lat+OpenLayers.Util.toFloat(a));},equals:function(b){var a=false;if(b!=null){a=((this.lon==b.lon&&this.lat==b.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(b.lon)&&isNaN(b.lat)));}return a;},transform:function(d,b){var a=OpenLayers.Projection.transform({x:this.lon,y:this.lat},d,b);this.lon=a.x;this.lat=a.y;return this;},wrapDateLine:function(a){var b=this.clone();if(a){while(b.lon<a.left){b.lon+=a.getWidth();}while(b.lon>a.right){b.lon-=a.getWidth();}}return b;},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(b){var a=b.split(",");return new OpenLayers.LonLat(a[0],a[1]);};OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a);this.h=parseFloat(b);},toString:function(){return("w="+this.w+",h="+this.h);},clone:function(){return new OpenLayers.Size(this.w,this.h);},equals:function(b){var a=false;if(b!=null){a=((this.w==b.w&&this.h==b.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(b.w)&&isNaN(b.h)));}return a;},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a);this.y=parseFloat(b);},toString:function(){return("x="+this.x+",y="+this.y);},clone:function(){return new OpenLayers.Pixel(this.x,this.y);},equals:function(a){var b=false;if(a!=null){b=((this.x==a.x&&this.y==a.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)));}return b;},add:function(a,d){if((a==null)||(d==null)){var b=OpenLayers.i18n("pixelAddError");OpenLayers.Console.error(b);return null;}return new OpenLayers.Pixel(this.x+a,this.y+d);},offset:function(a){var b=this.clone();if(a){b=this.add(a.x,a.y);}return b;},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode();}return OpenLayers.Lang.code;},setCode:function(b){var e;if(!b){b=(OpenLayers.Util.getBrowserName()=="msie")?navigator.userLanguage:navigator.language;}var d=b.split("-");d[0]=d[0].toLowerCase();if(typeof OpenLayers.Lang[d[0]]=="object"){e=d[0];}if(d[1]){var a=d[0]+"-"+d[1].toUpperCase();if(typeof OpenLayers.Lang[a]=="object"){e=a;}}if(!e){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+d.join("-")+" dictionary, falling back to default language");e=OpenLayers.Lang.defaultCode;}OpenLayers.Lang.code=e;},translate:function(b,a){var e=OpenLayers.Lang[OpenLayers.Lang.getCode()];var d=e[b];if(!d){d=b;}if(a){d=OpenLayers.String.format(d,a);}return d;}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Base Layer",sameProjection:"The overview map only works when it is in the same projection as the main map",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>",scale:"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",graticule:"Graticule",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition failed: element with id ${elemId} may be misplaced.",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type.",end:""};
OpenLayers.Lang.fr=OpenLayers.Util.applyDefaults({unhandledRequest:"Requête non gérée, retournant ${statusText}",permalink:"Permalien",overlays:"Calques",baseLayer:"Calque de base",sameProjection:"La carte de situation ne fonctionne que lorsque sa projection est la même que celle de la carte principale",readNotImplemented:"Lecture non implémentée.",writeNotImplemented:"Ecriture non implémentée.",noFID:"Impossible de mettre à jour un objet sans identifiant (fid).",errorLoadingGML:"Erreur au chargement du fichier GML ${url}",browserNotSupported:"Votre navigateur ne supporte pas le rendu vectoriel. Les renderers actuellement supportés sont : \n${renderers}",componentShouldBe:"addFeatures : le composant devrait être de type ${geomType}",getFeatureError:"getFeatureFromEvent a été appelé sur un calque sans renderer. Cela signifie généralement que vous avez détruit cette couche, mais que vous avez conservé un handler qui lui était associé.",minZoomLevelError:"La propriété minZoomLevel doit seulement être utilisée pour des couches FixedZoomLevels-descendent. Le fait que cette couche WFS vérifie la présence de minZoomLevel est une relique du passé. Nous ne pouvons toutefois la supprimer sans casser des applications qui pourraient en dépendre. C'est pourquoi nous la déprécions -- la vérification du minZoomLevel sera supprimée en version 3.0. A la place, merci d'utiliser les paramètres de résolutions min/max tel que décrit sur : http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transaction WFS : SUCCES ${response}",commitFailed:"Transaction WFS : ECHEC ${response}",googleWarning:"La couche Google n'a pas été en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le sélecteur de couche en haut à droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement causé par la non-inclusion de la librairie Google Maps, ou alors parce que la clé de l'API ne correspond pas à votre site.\x3cbr\x3e\x3cbr\x3eDéveloppeurs : pour savoir comment corriger ceci, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3ecliquez ici\x3c/a\x3e",getLayerWarning:"La couche ${layerType} n'est pas en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le sélecteur de couche en haut à droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement causé par la non-inclusion de la librairie ${layerLib}.\x3cbr\x3e\x3cbr\x3eDéveloppeurs : pour savoir comment corriger ceci, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3ecliquez ici\x3c/a\x3e",scale:"Echelle ~ 1 : ${scaleDenom}",W:"O",E:"E",N:"N",S:"S",layerAlreadyAdded:"Vous avez essayé d'ajouter à la carte le calque : ${layerName}, mais il est déjà présent",reprojectDeprecated:"Vous utilisez l'option 'reproject' sur la couche ${layerName}. Cette option est dépréciée : Son usage permettait d'afficher des données au dessus de couches raster commerciales.Cette fonctionalité est maintenant supportée en utilisant le support de la projection Mercator Sphérique. Plus d'information est disponible sur http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Cette méthode est dépréciée, et sera supprimée à la version 3.0. Merci d'utiliser ${newMethod} à la place.",boundsAddError:"Vous devez passer les deux valeurs x et y à la fonction add.",lonlatAddError:"Vous devez passer les deux valeurs lon et lat à la fonction add.",pixelAddError:"Vous devez passer les deux valeurs x et y à la fonction add.",unsupportedGeometryType:"Type de géométrie non supporté : ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition a échoué: l'élément d'id ${elemId} pourrait être mal positionné.",filterEvaluateNotImplemented:"évaluer n'a pas encore été implémenté pour ce type de filtre."});OpenLayers.Lang.de=OpenLayers.Util.applyDefaults({unhandledRequest:"Unbehandelte Anfragerückmeldung ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Grundkarte",sameProjection:"Die Übersichtskarte funktioniert nur, wenn sie dieselbe Projektion wie die Hauptkarte verwendet",readNotImplemented:"Lesen nicht implementiert.",writeNotImplemented:"Schreiben nicht implementiert.",noFID:"Ein Feature, für das keine FID existiert, kann nicht aktualisiert werden.",errorLoadingGML:"Fehler beim Laden der GML-Datei ${url}",browserNotSupported:"Ihr Browser unterstützt keine Vektordarstellung. Aktuell unterstützte Renderer:\n${renderers}",componentShouldBe:"addFeatures: Komponente muss vom Typ ${geomType} sein",getFeatureError:"getFeatureFromEvent wurde vom einem Layer ohne Renderer aufgerufen. Dies bedeutet normalerweise, dass ein Layer entfernt wurde, aber nicht Handler, die auf ihn verweisen.",minZoomLevelError:"Die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Eigenschaft ist nur für die Verwendung mit \x3ccode\x3eFixedZoomLevels\x3c/code\x3e-untergeordneten Layers vorgesehen. Das dieser \x3ctt\x3ewfs\x3c/tt\x3e-Layer die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Eigenschaft überprüft ist ein Relikt der Vergangenheit. Wir können diese Überprüfung nicht entfernen, ohne das OL basierende Applikationen nicht mehr funktionieren. Daher markieren wir es als veraltet - die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Überprüfung wird in Version 3.0 entfernt werden. Bitte verwenden Sie stattdessen die Min-/Max-Lösung, wie sie unter http://trac.openlayers.org/wiki/SettingZoomLevels beschrieben ist.",commitSuccess:"WFS-Transaktion: Erfolgreich ${response}",commitFailed:"WFS-Transaktion: Fehlgeschlagen ${response}",googleWarning:"Der Google-Layer konnte nicht korrekt geladen werden.\x3cbr\x3e\x3cbr\x3eUm diese Meldung nicht mehr zu erhalten, wählen Sie einen anderen Hintergrundlayer aus dem LayerSwitcher in der rechten oberen Ecke.\x3cbr\x3e\x3cbr\x3eSehr wahrscheinlich tritt dieser Fehler auf, weil das Skript der Google-Maps-Bibliothek nicht eingebunden wurde oder keinen gültigen API-Schlüssel für Ihre URL enthält.\x3cbr\x3e\x3cbr\x3eEntwickler: Besuche \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3edas Wiki\x3c/a\x3e für Hilfe zum korrekten Einbinden des Google-Layers",getLayerWarning:"Der ${layerType}-Layer konnte nicht korrekt geladen werden.\x3cbr\x3e\x3cbr\x3eUm diese Meldung nicht mehr zu erhalten, wählen Sie einen anderen Hintergrundlayer aus dem LayerSwitcher in der rechten oberen Ecke.\x3cbr\x3e\x3cbr\x3eSehr wahrscheinlich tritt dieser Fehler auf, weil das Skript der '${layerLib}'-Bibliothek nicht eingebunden wurde.\x3cbr\x3e\x3cbr\x3eEntwickler: Besuche \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3edas Wiki\x3c/a\x3e für Hilfe zum korrekten Einbinden von Layern",scale:"Maßstab = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"S",layerAlreadyAdded:"Sie versuchen den Layer „${layerName}“ zur Karte hinzuzufügen, er wurde aber bereits hinzugefügt",reprojectDeprecated:"Sie verwenden die „Reproject“-Option des Layers ${layerName}. Diese Option ist veraltet: Sie wurde entwickelt um die Anzeige von Daten auf kommerziellen Basiskarten zu unterstützen, aber diese Funktion sollte jetzt durch Unterstützung der „Spherical Mercator“ erreicht werden. Weitere Informationen sind unter http://trac.openlayers.org/wiki/SphericalMercator verfügbar.",methodDeprecated:"Die Methode ist veraltet und wird in 3.0 entfernt. Bitte verwende stattdessen ${newMethod}.",boundsAddError:"Beide Werte (x und y) müssen der add-Funktion übergeben werden.",lonlatAddError:"Beide Werte (lon und lat) müssen der add-Funktion übergeben werden.",pixelAddError:"Beide Werte (x und y) müssen der add-Funktion übergeben werden.",unsupportedGeometryType:"Nicht unterstützter Geometrie-Typ: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition fehlgeschlagen: Element mit Id ${elemId} möglicherweise falsch platziert.",filterEvaluateNotImplemented:"„evaluate“ ist für diesen Filter-Typ nicht implementiert."});OpenLayers.Lang.nl=OpenLayers.Util.applyDefaults({unhandledRequest:"Het verzoek is niet afgehandeld met de volgende melding: ${statusText}",permalink:"Permanente verwijzing",overlays:"Overlays",baseLayer:"Achtergrondkaart",sameProjection:"De overzichtskaart werkt alleen als de projectie gelijk is aan de projectie van de hoofdkaart",readNotImplemented:"Lezen is niet geïmplementeerd.",writeNotImplemented:"Schrijven is niet geïmplementeerd.",noFID:"Een optie die geen FID heeft kan niet bijgewerkt worden.",errorLoadingGML:"Er is een fout opgetreden bij het laden van het GML bestand van ${url}",browserNotSupported:"Uw browser ondersteunt het weergeven van vectoren niet.\nMomenteel ondersteunde weergavemogelijkheden:\n${renderers}",componentShouldBe:"addFeatures : component moet van het type ${geomType} zijn",getFeatureError:"getFeatureFromEvent is aangeroepen op een laag zonder rederer.\nDit betekent meestal dat u een laag hebt verwijderd, maar niet een handler die ermee geassocieerd was.",minZoomLevelError:"De eigenschap minZoomLevel is alleen bedoeld voor gebruik lagen met die afstammen van FixedZoomLevels-lagen.\nDat deze WFS-laag minZoomLevel controleert, is een overblijfsel uit het verleden.\nWe kunnen deze controle echter niet verwijderen zonder op OL gebaseerde applicaties die hervan afhankelijk zijn stuk te maken.\nDaarom heeft deze functionaliteit de eigenschap 'deprecated' gekregen - de minZoomLevel wordt verwijderd in versie 3.0.\nGebruik in plaats van deze functie de mogelijkheid om min/max voor resolutie in te stellen zoals op de volgende pagina wordt beschreven:\nhttp://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS-transactie: succesvol ${response}",commitFailed:"WFS-transactie: mislukt ${response}",googleWarning:"De Google-Layer kon niet correct geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct ingevoegd is.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen.",getLayerWarning:"De laag ${layerType} kon niet goed geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct is ingevoegd.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen.",scale:"Schaal = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"Z",layerAlreadyAdded:"U hebt geprobeerd om de laag  ${layerName} aan de kaart toe te voegen, maar deze is al toegevoegd",reprojectDeprecated:"U gebruikt de optie 'reproject' op de laag ${layerName}.\nDeze optie is vervallen: deze optie was ontwikkeld om gegevens over commerciële basiskaarten weer te geven, maar deze functionaliteit wordt nu bereikt door ondersteuning van Spherical Mercator.\nMeer informatie is beschikbaar op http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Deze methode is verouderd en wordt verwijderd in versie 3.0.\nGebruik ${newMethod}.",boundsAddError:"U moet zowel de x- als de y-waarde doorgeven aan de toevoegfunctie.",lonlatAddError:"U moet zowel de lengte- als de breedtewaarde doorgeven aan de toevoegfunctie.",pixelAddError:"U moet zowel de x- als de y-waarde doorgeven aan de toevoegfunctie.",unsupportedGeometryType:"Dit geometrietype wordt niet ondersteund: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition is mislukt: het element met id ${elemId} is wellicht onjuist geplaatst.",filterEvaluateNotImplemented:"evalueren is niet geïmplementeerd voor dit filtertype."});
OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,last:null,start:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(d,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);},down:function(a){},move:function(a){},up:function(a){},out:function(a){},mousedown:function(b){var a=true;this.dragging=false;if(this.checkModifiers(b)&&OpenLayers.Event.isLeftClick(b)){this.started=true;this.start=b.xy;this.last=b.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(b);this.callback("down",[b.xy]);OpenLayers.Event.stop(b);if(!this.oldOnselectstart){this.oldOnselectstart=(document.onselectstart)?document.onselectstart:OpenLayers.Function.True;}document.onselectstart=OpenLayers.Function.False;a=!this.stopDown;}else{this.started=false;this.start=null;this.last=null;}return a;},mousemove:function(a){if(this.started&&!this.timeoutId&&(a.xy.x!=this.last.x||a.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(a.element===document){this.adjustXY(a);this.setEvent(a);}else{this.destroyDocumentEvents();}}if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval);}this.dragging=true;this.move(a);this.callback("move",[a.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=OpenLayers.Function.False;}this.last=this.evt.xy;}return true;},removeTimeout:function(){this.timeoutId=null;},mouseup:function(b){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(b);this.destroyDocumentEvents();}var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(b);this.callback("up",[b.xy]);if(a){this.callback("done",[b.xy]);}document.onselectstart=this.oldOnselectstart;}return true;},mouseout:function(b){if(this.started&&OpenLayers.Util.mouseLeft(b,this.map.div)){if(this.documentDrag===true){this.documentEvents=new OpenLayers.Events(this,document,null,null,{includeXY:true});this.documentEvents.on({mousemove:this.mousemove,mouseup:this.mouseup});OpenLayers.Element.addClass(document.body,"olDragDown");}else{var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(b);this.callback("out",[]);if(a){this.callback("done",[b.xy]);}if(document.onselectstart){document.onselectstart=this.oldOnselectstart;}}}return true;},click:function(a){return(this.start==this.last);},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;a=true;}return a;},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.dragging=false;this.start=null;this.last=null;a=true;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");}return a;},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.div);a.xy.x-=b[0];a.xy.y-=b[1];},destroyDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents.destroy();this.documentEvents=null;},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxCharacteristics:null,initialize:function(d,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);var b={down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox};this.dragHandler=new OpenLayers.Handler.Drag(this,b,{keyMask:this.keyMask});},destroy:function(){if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null;}OpenLayers.Handler.prototype.destroy.apply(this,arguments);},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(a);}},startBox:function(a){this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.dragHandler.start);this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox");},moveBox:function(g){var e=this.dragHandler.start.x;var b=this.dragHandler.start.y;var d=Math.abs(e-g.x);var a=Math.abs(b-g.y);this.zoomBox.style.width=Math.max(1,d)+"px";this.zoomBox.style.height=Math.max(1,a)+"px";this.zoomBox.style.left=g.x<e?g.x+"px":e+"px";this.zoomBox.style.top=g.y<b?g.y+"px":b+"px";var f=this.getBoxCharacteristics();if(f.newBoxModel){if(g.x>e){this.zoomBox.style.width=Math.max(1,d-f.xOffset)+"px";}if(g.y>b){this.zoomBox.style.height=Math.max(1,a-f.yOffset)+"px";}}},endBox:function(b){var a;if(Math.abs(this.dragHandler.start.x-b.x)>5||Math.abs(this.dragHandler.start.y-b.y)>5){var h=this.dragHandler.start;var g=Math.min(h.y,b.y);var d=Math.max(h.y,b.y);var f=Math.min(h.x,b.x);var e=Math.max(h.x,b.x);a=new OpenLayers.Bounds(f,d,e,g);}else{a=this.dragHandler.start.clone();}this.removeBox();this.callback("done",[a]);},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxCharacteristics=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox");},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true;}else{return false;}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate();return true;}else{return false;}},getBoxCharacteristics:function(){if(!this.boxCharacteristics){var a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"))+1;var d=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"))+1;var b=OpenLayers.Util.getBrowserName()=="msie"?document.compatMode!="BackCompat":true;this.boxCharacteristics={xOffset:a,yOffset:d,newBoxModel:b};}return this.boxCharacteristics;},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,alwaysZoom:false,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask});},zoomBox:function(j){if(j instanceof OpenLayers.Bounds){var b;if(!this.out){var l=this.map.getLonLatFromPixel(new OpenLayers.Pixel(j.left,j.bottom));var r=this.map.getLonLatFromPixel(new OpenLayers.Pixel(j.right,j.top));b=new OpenLayers.Bounds(l.lon,l.lat,r.lon,r.lat);}else{var h=Math.abs(j.right-j.left);var m=Math.abs(j.top-j.bottom);var f=Math.min((this.map.size.h/m),(this.map.size.w/h));var s=this.map.getExtent();var a=this.map.getLonLatFromPixel(j.getCenterPixel());var d=a.lon-(s.getWidth()/2)*f;var g=a.lon+(s.getWidth()/2)*f;var q=a.lat-(s.getHeight()/2)*f;var e=a.lat+(s.getHeight()/2)*f;b=new OpenLayers.Bounds(d,q,g,e);}var o=this.map.getZoom();this.map.zoomToExtent(b);if(o==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(o+(this.out?-1:1));}}else{if(!this.out){this.map.setCenter(this.map.getLonLatFromPixel(j),this.map.getZoom()+1);}else{this.map.setCenter(this.map.getLonLatFromPixel(j),this.map.getZoom()-1);}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:25,documentDrag:false,draw:function(){this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone},{interval:this.interval,documentDrag:this.documentDrag});},panMap:function(a){this.panned=true;this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:this.handler.dragging,animate:false});},panMapDone:function(a){if(this.panned){this.panMap(a);this.panned=false;}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false,timerId:null,down:null,rightclickTimerId:null,initialize:function(d,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);
if(this.pixelTolerance!=null){this.mousedown=function(e){this.down=e.xy;return true;};}},mousedown:null,mouseup:function(b){var a=true;if(this.checkModifiers(b)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(b)){a=this.rightclick(b);}return a;},rightclick:function(b){if(this.passesTolerance(b)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[b]);return !this.stopDouble;}else{var a=this["double"]?OpenLayers.Util.extend({},b):this.callback("rightclick",[b]);var d=OpenLayers.Function.bind(this.delayedRightCall,this,a);this.rightclickTimerId=window.setTimeout(d,this.delay);}}return !this.stopSingle;},delayedRightCall:function(a){this.rightclickTimerId=null;if(a){this.callback("rightclick",[a]);}return !this.stopSingle;},dblclick:function(a){if(this.passesTolerance(a)){if(this["double"]){this.callback("dblclick",[a]);}this.clearTimer();}return !this.stopDouble;},click:function(b){if(this.passesTolerance(b)){if(this.timerId!=null){this.clearTimer();}else{var a=this.single?OpenLayers.Util.extend({},b):null;this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay);}}return !this.stopSingle;},passesTolerance:function(b){var d=true;if(this.pixelTolerance!=null&&this.down){var a=Math.sqrt(Math.pow(this.down.x-b.xy.x,2)+Math.pow(this.down.y-b.xy.y,2));if(a>this.pixelTolerance){d=false;}}return d;},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null;}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null;}},delayedCall:function(a){this.timerId=null;if(a){this.callback("click",[a]);}},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;a=true;}return a;},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,documentDrag:false,zoomBox:null,zoomBoxEnabled:true,zoomWheelEnabled:true,mouseWheelOptions:null,handleRightClicks:false,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:true,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy();}this.dragPan=null;if(this.zoomBox){this.zoomBox.destroy();}this.zoomBox=null;OpenLayers.Control.prototype.destroy.apply(this,arguments);},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate();}this.handlers.click.activate();if(this.zoomBoxEnabled){this.zoomBox.activate();}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False;}var a={dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};var b={"double":true,stopDouble:true};this.handlers.click=new OpenLayers.Handler.Click(this,a,b);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions);},defaultDblClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1);},defaultDblRightClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom-1);},wheelChange:function(l,d){var j=this.map.getZoom();var g=this.map.getZoom()+Math.round(d);g=Math.max(g,0);g=Math.min(g,this.map.getNumZoomLevels());if(g===j){return;}var m=this.map.getSize();var f=m.w/2-l.xy.x;var e=l.xy.y-m.h/2;var h=this.map.baseLayer.getResolutionForZoom(g);var a=this.map.getLonLatFromPixel(l.xy);var b=new OpenLayers.LonLat(a.lon+f*h,a.lat+e*h);this.map.setCenter(b,g);},wheelUp:function(a,b){this.wheelChange(a,b||1);},wheelDown:function(a,b){this.wheelChange(a,b||-1);},disableZoomBox:function(){this.zoomBoxEnabled=false;this.zoomBox.deactivate();},enableZoomBox:function(){this.zoomBoxEnabled=true;if(this.active){this.zoomBox.activate();}},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate();},enableZoomWheel:function(){this.zoomWheelEnabled=true;if(this.active){this.handlers.wheel.activate();}},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(e,d,f,b){var a=arguments;a=[e,b];OpenLayers.Layer.prototype.initialize.apply(this,a);this.url=d;this.params=OpenLayers.Util.extend({},f);},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments);},clone:function(a){if(a==null){a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions());}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a;},setUrl:function(a){this.url=a;},mergeNewParams:function(b){this.params=OpenLayers.Util.extend(this.params,b);var a=this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"params"});}return a;},redraw:function(a){if(a){return this.mergeNewParams({_olSalt:Math.random()});}else{return OpenLayers.Layer.prototype.redraw.apply(this,[]);}},selectUrl:function(f,e){var d=1;for(var b=0,a=f.length;b<a;b++){d*=f.charCodeAt(b)*this.URL_HASH_FACTOR;d-=Math.floor(d);}return e[Math.floor(d*e.length)];},getFullRequestString:function(h,e){var b=e||this.url;var g=OpenLayers.Util.extend({},this.params);g=OpenLayers.Util.extend(g,h);var f=OpenLayers.Util.getParameterString(g);if(b instanceof Array){b=this.selectUrl(f,b);}var a=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(b));for(var d in g){if(d.toUpperCase() in a){delete g[d];}}f=OpenLayers.Util.getParameterString(g);return OpenLayers.Util.urlAppend(b,f);},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,grid:null,singleTile:false,ratio:1.5,buffer:2,numLoadingTiles:0,initialize:function(d,b,e,a){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.events.addEventType("tileloaded");this.grid=[];},destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments);},clearGrid:function(){if(this.grid){for(var g=0,b=this.grid.length;g<b;g++){var f=this.grid[g];for(var d=0,a=f.length;d<a;d++){var e=f[d];this.removeTileMonitoringHooks(e);e.destroy();}}this.grid=[];}},clone:function(a){if(a==null){a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions());}a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone();}a.grid=[];return a;},moveTo:function(e,a,f){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);e=e||this.map.getExtent();if(e!=null){var d=!this.grid.length||a;var b=this.getTilesBounds();if(this.singleTile){if(d||(!f&&!b.containsBounds(e))){this.initSingleTile(e);}}else{if(d||!b.containsBounds(e,true)){this.initGriddedTiles(e);}else{this.moveGriddedTiles(e);}}}},setTileSize:function(a){if(this.singleTile){a=this.map.getSize();a.h=parseInt(a.h*this.ratio);a.w=parseInt(a.w*this.ratio);}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a]);},getGridBounds:function(){var a="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";OpenLayers.Console.warn(a);return this.getTilesBounds();},getTilesBounds:function(){var f=null;
if(this.grid.length){var a=this.grid.length-1;var e=this.grid[a][0];var b=this.grid[0].length-1;var d=this.grid[0][b];f=new OpenLayers.Bounds(e.bounds.left,e.bounds.bottom,d.bounds.right,d.bounds.top);}return f;},initSingleTile:function(g){var a=g.getCenterLonLat();var j=g.getWidth()*this.ratio;var b=g.getHeight()*this.ratio;var h=new OpenLayers.Bounds(a.lon-(j/2),a.lat-(b/2),a.lon+(j/2),a.lat+(b/2));var e=new OpenLayers.LonLat(h.left,h.top);var d=this.map.getLayerPxFromLonLat(e);if(!this.grid.length){this.grid[0]=[];}var f=this.grid[0][0];if(!f){f=this.addTile(h,d);this.addTileMonitoringHooks(f);f.draw();this.grid[0][0]=f;}else{f.moveTo(h,d);}this.removeExcessTiles(1,1);},calculateGridLayout:function(a,t,f){var o=f*this.tileSize.w;var d=f*this.tileSize.h;var l=a.left-t.left;var q=Math.floor(l/o)-this.buffer;var m=l/o-q;var g=-m*this.tileSize.w;var r=t.left+q*o;var b=a.top-(t.bottom+d);var j=Math.ceil(b/d)+this.buffer;var s=j-b/d;var e=-s*this.tileSize.h;var h=t.bottom+j*d;return{tilelon:o,tilelat:d,tileoffsetlon:r,tileoffsetlat:h,tileoffsetx:g,tileoffsety:e};},initGriddedTiles:function(l){var h=this.map.getSize();var D=Math.ceil(h.h/this.tileSize.h)+Math.max(1,2*this.buffer);var F=Math.ceil(h.w/this.tileSize.w)+Math.max(1,2*this.buffer);var t=this.getMaxExtent();var w=this.map.getResolution();var v=this.calculateGridLayout(l,t,w);var g=Math.round(v.tileoffsetx);var d=Math.round(v.tileoffsety);var o=v.tileoffsetlon;var s=v.tileoffsetlat;var f=v.tilelon;var m=v.tilelat;this.origin=new OpenLayers.Pixel(g,d);var C=g;var E=o;var B=0;var a=parseInt(this.map.layerContainerDiv.style.left);var z=parseInt(this.map.layerContainerDiv.style.top);do{var j=this.grid[B++];if(!j){j=[];this.grid.push(j);}o=E;g=C;var e=0;do{var b=new OpenLayers.Bounds(o,s,o+f,s+m);var r=g;r-=a;var q=d;q-=z;var u=new OpenLayers.Pixel(r,q);var G=j[e++];if(!G){G=this.addTile(b,u);this.addTileMonitoringHooks(G);j.push(G);}else{G.moveTo(b,u,false);}o+=f;g+=this.tileSize.w;}while((o<=l.right+f*this.buffer)||e<F);s-=m;d+=this.tileSize.h;}while((s>=l.bottom-m*this.buffer)||B<D);this.removeExcessTiles(B,e);this.spiralTileLoad();},getMaxExtent:function(){return this.maxExtent;},spiralTileLoad:function(){var b=[];var j=["right","down","left","up"];var h=0;var a=-1;var m=OpenLayers.Util.indexOf(j,"right");var o=0;while(o<j.length){var l=h;var d=a;switch(j[m]){case"right":d++;break;case"down":l++;break;case"left":d--;break;case"up":l--;break;}var g=null;if((l<this.grid.length)&&(l>=0)&&(d<this.grid[0].length)&&(d>=0)){g=this.grid[l][d];}if((g!=null)&&(!g.queued)){b.unshift(g);g.queued=true;o=0;h=l;a=d;}else{m=(m+1)%4;o++;}}for(var e=0,f=b.length;e<f;e++){var g=b[e];g.draw();g.queued=false;}},addTile:function(b,a){},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart");}this.numLoadingTiles++;};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend");}};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd);},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this});},moveGriddedTiles:function(d){var b=this.buffer||1;while(true){var a=this.grid[0][0].position;var e=this.map.getViewPortPxFromLayerPx(a);if(e.x>-this.tileSize.w*(b-1)){this.shiftColumn(true);}else{if(e.x<-this.tileSize.w*b){this.shiftColumn(false);}else{if(e.y>-this.tileSize.h*(b-1)){this.shiftRow(true);}else{if(e.y<-this.tileSize.h*b){this.shiftRow(false);}else{break;}}}}}},shiftRow:function(r){var d=(r)?0:(this.grid.length-1);var b=this.grid;var g=b[d];var f=this.map.getResolution();var j=(r)?-this.tileSize.h:this.tileSize.h;var h=f*-j;var q=(r)?b.pop():b.shift();for(var l=0,o=g.length;l<o;l++){var e=g[l];var a=e.bounds.clone();var m=e.position.clone();a.bottom=a.bottom+h;a.top=a.top+h;m.y=m.y+j;q[l].moveTo(a,m);}if(r){b.unshift(q);}else{b.push(q);}},shiftColumn:function(q){var e=(q)?-this.tileSize.w:this.tileSize.w;var d=this.map.getResolution();var m=d*e;for(var f=0,h=this.grid.length;f<h;f++){var o=this.grid[f];var l=(q)?0:(o.length-1);var b=o[l];var a=b.bounds.clone();var g=b.position.clone();a.left=a.left+m;a.right=a.right+m;g.x=g.x+e;var j=q?this.grid[f].pop():this.grid[f].shift();j.moveTo(a,g);if(q){o.unshift(j);}else{o.push(j);}}},removeExcessTiles:function(f,d){while(this.grid.length>f){var g=this.grid.pop();for(var b=0,a=g.length;b<a;b++){var e=g[b];this.removeTileMonitoringHooks(e);e.destroy();}}while(this.grid[0].length>d){for(var b=0,a=this.grid.length;b<a;b++){var g=this.grid[b];var e=g.pop();this.removeTileMonitoringHooks(e);e.destroy();}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize();}},getTileBounds:function(e){var d=this.maxExtent;var g=this.getResolution();var f=g*this.tileSize.w;var b=g*this.tileSize.h;var j=this.getLonLatFromViewPortPx(e);var a=d.left+(f*Math.floor((j.lon-d.left)/f));var h=d.bottom+(b*Math.floor((j.lat-d.bottom)/b));return new OpenLayers.Bounds(a,h,a+f,h+b);},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",exceptions:"application/vnd.ogc.se_inimage",format:"image/jpeg"},reproject:false,isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{"EPSG:4326":true},initialize:function(e,d,f,b){var a=[];f=OpenLayers.Util.upperCaseObject(f);if(parseFloat(f.VERSION)>=1.3&&!f.EXCEPTIONS){f.EXCEPTIONS="INIMAGE";}a.push(e,d,f,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((b==null)||(!b.isBaseLayer)){this.isBaseLayer=false;}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png";}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions());}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a;},reverseAxisOrder:function(){return(parseFloat(this.params.VERSION)>=1.3&&!!this.yx[this.map.getProjectionObject().getCode()]);},getURL:function(d){d=this.adjustBounds(d);var e=this.getImageSize();var f={};var b=this.reverseAxisOrder();f.BBOX=this.encodeBBOX?d.toBBOX(null,b):d.toArray(b);f.WIDTH=e.w;f.HEIGHT=e.h;var a=this.getFullRequestString(f);return a;},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize);},mergeNewParams:function(d){var b=OpenLayers.Util.upperCaseObject(d);var a=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a);},getFullRequestString:function(e,b){var a=this.map.getProjection();var d=(a=="none")?null:a;if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=d;}else{this.params.SRS=d;}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments);},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,sphericalMercator:false,zoomOffset:0,initialize:function(e,d,b){if(b&&b.sphericalMercator||this.sphericalMercator){b=OpenLayers.Util.extend({maxExtent:new OpenLayers.Bounds(-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339),maxResolution:156543.0339,numZoomLevels:19,units:"m",projection:"EPSG:900913"},b);}d=d||this.url;e=e||this.name;var a=[e,d,{},b];OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);},clone:function(a){if(a==null){a=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions());}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a;},getURL:function(f){var d=this.map.getResolution();var a=Math.round((f.left-this.maxExtent.left)/(d*this.tileSize.w));
var j=Math.round((this.maxExtent.top-f.top)/(d*this.tileSize.h));var h=this.map.getZoom()+this.zoomOffset;var b=this.url;var e=""+a+j+h;if(b instanceof Array){b=this.selectUrl(e,b);}var g=OpenLayers.String.format(b,{x:a,y:j,z:h});return g;},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize);},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom);}},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:true,url:"http://tile.openstreetmap.org/${z}/${x}/${y}.png",clone:function(a){if(a==null){a=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions());}a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a]);return a;},CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,isGecko:null,supportUse:null,initialize:function(a){if(!this.supported()){return;}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.supportUse=(navigator.userAgent.toLowerCase().indexOf("applewebkit/5")==-1);this.isGecko=(navigator.userAgent.toLowerCase().indexOf("gecko/")!=-1);this.symbolMetrics={};},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments);},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1")));},inValidRange:function(a,f,b){var e=a+(b?0:this.translationParameters.x);var d=f+(b?0:this.translationParameters.y);return(e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL&&d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL);},setExtent:function(b,e){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var a=this.getResolution();var g=-b.left/a;var f=b.top/a;if(e){this.left=g;this.top=f;var d="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",d);this.translate(0,0);return true;}else{var h=this.translate(g-this.left,f-this.top);if(!h){this.setExtent(b,true);}return h;}},translate:function(a,d){if(!this.inValidRange(a,d,true)){return false;}else{var b="";if(a||d){b="translate("+a+","+d+")";}this.root.setAttributeNS(null,"transform",b);this.translationParameters={x:a,y:d};return true;}},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h);},getNodeType:function(d,b){var a=null;switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="image";}else{if(this.isComplexSymbol(b.graphicName)){a=this.supportUse===false?"svg":"use";}else{a="circle";}}break;case"OpenLayers.Geometry.Rectangle":a="rect";break;case"OpenLayers.Geometry.LineString":a="polyline";break;case"OpenLayers.Geometry.LinearRing":a="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":a="path";break;default:break;}return a;},setStyle:function(u,z,b){z=z||u._style;b=b||u._options;var m=parseFloat(u.getAttributeNS(null,"r"));var l=1;var e;if(u._geometryClass=="OpenLayers.Geometry.Point"&&m){u.style.visibility="";if(z.graphic===false){u.style.visibility="hidden";}else{if(z.externalGraphic){e=this.getPosition(u);if(z.graphicTitle){u.setAttributeNS(null,"title",z.graphicTitle);}if(z.graphicWidth&&z.graphicHeight){u.setAttributeNS(null,"preserveAspectRatio","none");}var t=z.graphicWidth||z.graphicHeight;var q=z.graphicHeight||z.graphicWidth;t=t?t:z.pointRadius*2;q=q?q:z.pointRadius*2;var B=(z.graphicXOffset!=undefined)?z.graphicXOffset:-(0.5*t);var g=(z.graphicYOffset!=undefined)?z.graphicYOffset:-(0.5*q);var a=z.graphicOpacity||z.fillOpacity;u.setAttributeNS(null,"x",(e.x+B).toFixed());u.setAttributeNS(null,"y",(e.y+g).toFixed());u.setAttributeNS(null,"width",t);u.setAttributeNS(null,"height",q);u.setAttributeNS(this.xlinkns,"href",z.externalGraphic);u.setAttributeNS(null,"style","opacity: "+a);}else{if(this.isComplexSymbol(z.graphicName)){var d=z.pointRadius*3;var o=d*2;var s=this.importSymbol(z.graphicName);e=this.getPosition(u);l=this.symbolMetrics[s][0]*3/o;var h=u.parentNode;var j=u.nextSibling;if(h){h.removeChild(u);}if(this.supportUse===false){var f=document.getElementById(s);u.firstChild&&u.removeChild(u.firstChild);u.appendChild(f.firstChild.cloneNode(true));u.setAttributeNS(null,"viewBox",f.getAttributeNS(null,"viewBox"));}else{u.setAttributeNS(this.xlinkns,"href","#"+s);}u.setAttributeNS(null,"width",o);u.setAttributeNS(null,"height",o);u.setAttributeNS(null,"x",e.x-d);u.setAttributeNS(null,"y",e.y-d);if(j){h.insertBefore(u,j);}else{if(h){h.appendChild(u);}}}else{u.setAttributeNS(null,"r",z.pointRadius);}}}var w=z.rotation;if((w!==undefined||u._rotation!==undefined)&&e){u._rotation=w;w|=0;if(u.nodeName!=="svg"){u.setAttributeNS(null,"transform","rotate("+w+" "+e.x+" "+e.y+")");}else{var v=this.symbolMetrics[s];u.firstChild.setAttributeNS(null,"transform","rotate("+z.rotation+" "+v[1]+" "+v[2]+")");}}}if(b.isFilled){u.setAttributeNS(null,"fill",z.fillColor);u.setAttributeNS(null,"fill-opacity",z.fillOpacity);}else{u.setAttributeNS(null,"fill","none");}if(b.isStroked){u.setAttributeNS(null,"stroke",z.strokeColor);u.setAttributeNS(null,"stroke-opacity",z.strokeOpacity);u.setAttributeNS(null,"stroke-width",z.strokeWidth*l);u.setAttributeNS(null,"stroke-linecap",z.strokeLinecap||"round");u.setAttributeNS(null,"stroke-linejoin","round");z.strokeDashstyle&&u.setAttributeNS(null,"stroke-dasharray",this.dashStyle(z,l));}else{u.setAttributeNS(null,"stroke","none");}if(z.pointerEvents){u.setAttributeNS(null,"pointer-events",z.pointerEvents);}if(z.cursor!=null){u.setAttributeNS(null,"cursor",z.cursor);}return u;},dashStyle:function(d,b){var a=d.strokeWidth*b;var e=d.strokeDashstyle;switch(e){case"solid":return"none";case"dot":return[1,4*a].join();case"dash":return[4*a,4*a].join();case"dashdot":return[4*a,4*a,1,4*a].join();case"longdash":return[8*a,4*a].join();case"longdashdot":return[8*a,4*a,1,4*a].join();default:return OpenLayers.String.trim(e).replace(/\s+/g,",");}},createNode:function(a,d){var b=document.createElementNS(this.xmlns,a);if(d){b.setAttributeNS(null,"id",d);}return b;},nodeTypeCompare:function(b,a){return(a==b.nodeName);},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg");},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g");},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a;},drawPoint:function(a,b){return this.drawCircle(a,b,1);},drawCircle:function(e,f,b){var d=this.getResolution();var a=(f.x/d+this.left);var g=(this.top-f.y/d);if(this.inValidRange(a,g)){e.setAttributeNS(null,"cx",a);e.setAttributeNS(null,"cy",g);e.setAttributeNS(null,"r",b);return e;}else{return false;}},drawLineString:function(b,d){var a=this.getComponentsString(d.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null);}else{return false;}},drawLinearRing:function(b,d){var a=this.getComponentsString(d.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null);}else{return false;}},drawPolygon:function(b,l){var h="";var m=true;var a=true;var e,o;for(var f=0,g=l.components.length;f<g;f++){h+=" M";e=this.getComponentsString(l.components[f].components," ");o=e.path;if(o){h+=" "+o;a=e.complete&&a;}else{m=false;}}h+=" z";if(m){b.setAttributeNS(null,"d",h);b.setAttributeNS(null,"fill-rule","evenodd");
return a?b:null;}else{return false;}},drawRectangle:function(d,e){var b=this.getResolution();var a=(e.x/b+this.left);var f=(this.top-e.y/b);if(this.inValidRange(a,f)){d.setAttributeNS(null,"x",a);d.setAttributeNS(null,"y",f);d.setAttributeNS(null,"width",e.width/b);d.setAttributeNS(null,"height",e.height/b);return d;}else{return false;}},drawSurface:function(g,j){var h=null;var b=true;for(var f=0,a=j.components.length;f<a;f++){if((f%3)==0&&(f/3)==0){var e=this.getShortString(j.components[f]);if(!e){b=false;}h="M "+e;}else{if((f%3)==1){var e=this.getShortString(j.components[f]);if(!e){b=false;}h+=" C "+e;}else{var e=this.getShortString(j.components[f]);if(!e){b=false;}h+=" "+e;}}}h+=" Z";if(b){g.setAttributeNS(null,"d",h);return g;}else{return false;}},drawText:function(d,a,l){var b=this.getResolution();var j=(l.x/b+this.left);var f=(l.y/b-this.top);var h=this.nodeFactory(d+this.LABEL_ID_SUFFIX,"text");var g=this.nodeFactory(d+this.LABEL_ID_SUFFIX+"_tspan","tspan");h.setAttributeNS(null,"x",j);h.setAttributeNS(null,"y",-f);if(a.fontColor){h.setAttributeNS(null,"fill",a.fontColor);}if(a.fontOpacity){h.setAttributeNS(null,"opacity",a.fontOpacity);}if(a.fontFamily){h.setAttributeNS(null,"font-family",a.fontFamily);}if(a.fontSize){h.setAttributeNS(null,"font-size",a.fontSize);}if(a.fontWeight){h.setAttributeNS(null,"font-weight",a.fontWeight);}if(a.labelSelect===true){h.setAttributeNS(null,"pointer-events","visible");h._featureId=d;g._featureId=d;g._geometry=l;g._geometryClass=l.CLASS_NAME;}else{h.setAttributeNS(null,"pointer-events","none");}var e=a.labelAlign||"cm";h.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[e[0]]||"middle");if(this.isGecko){h.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[e[1]]||"central");}else{g.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[e[1]]||"-35%");}g.textContent=a.label;if(!h.parentNode){h.appendChild(g);this.textRoot.appendChild(h);}},getComponentsString:function(e,d){var g=[];var a=true;var f=e.length;var l=[];var h,j;for(var b=0;b<f;b++){j=e[b];g.push(j);h=this.getShortString(j);if(h){l.push(h);}else{if(b>0){if(this.getShortString(e[b-1])){l.push(this.clipLine(e[b],e[b-1]));}}if(b<f-1){if(this.getShortString(e[b+1])){l.push(this.clipLine(e[b],e[b+1]));}}a=false;}}return{path:l.join(d||","),complete:a};},clipLine:function(f,j){if(j.equals(f)){return"";}var g=this.getResolution();var b=this.MAX_PIXEL-this.translationParameters.x;var a=this.MAX_PIXEL-this.translationParameters.y;var e=j.x/g+this.left;var m=this.top-j.y/g;var d=f.x/g+this.left;var l=this.top-f.y/g;var h;if(d<-b||d>b){h=(l-m)/(d-e);d=d<0?-b:b;l=m+(d-e)*h;}if(l<-a||l>a){h=(d-e)/(l-m);l=l<0?-a:a;d=e+(l-m)*h;}return d+","+l;},getShortString:function(b){var d=this.getResolution();var a=(b.x/d+this.left);var e=(this.top-b.y/d);if(this.inValidRange(a,e)){return a+","+e;}else{return false;}},getPosition:function(a){return({x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))});},importSymbol:function(f){if(!this.defs){this.defs=this.createDefs();}var b=this.container.id+"-"+f;if(document.getElementById(b)!=null){return b;}var e=OpenLayers.Renderer.symbol[f];if(!e){throw new Error(f+" is not a valid symbol name");}var h=this.nodeFactory(b,"symbol");var d=this.nodeFactory(null,"polygon");h.appendChild(d);var q=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var m=[];var l,j;for(var g=0;g<e.length;g=g+2){l=e[g];j=e[g+1];q.left=Math.min(q.left,l);q.bottom=Math.min(q.bottom,j);q.right=Math.max(q.right,l);q.top=Math.max(q.top,j);m.push(l,",",j);}d.setAttributeNS(null,"points",m.join(" "));var a=q.getWidth();var o=q.getHeight();var r=[q.left-a,q.bottom-o,a*3,o*3];h.setAttributeNS(null,"viewBox",r.join(" "));this.symbolMetrics[b]=[Math.max(a,o),q.getCenterLonLat().lon,q.getCenterLonLat().lat];this.defs.appendChild(h);return h.id;},getFeatureIdFromEvent:function(a){var d=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(this.supportUse===false&&!d){var b=a.target;d=b.parentNode&&b!=this.rendererRoot&&b.parentNode._featureId;}return d;},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,format:"image/png",serverResolutions:null,initialize:function(d,b,e,a){this.layername=e;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[d,b,{},a]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=(this.extension=="jpg")?"jpeg":this.extension;},clone:function(a){if(a==null){a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions());}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a;},getURL:function(b){var g=this.map.getResolution();var h=this.maxExtent;var o=this.tileSize;var a=Math.round((b.left-h.left)/(g*o.w));var m=Math.round((b.bottom-h.bottom)/(g*o.h));var j=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,g):this.map.getZoom();function f(t,s){t=String(t);var q=[];for(var r=0;r<s;++r){q.push("0");}return q.join("").substring(0,s-t.length)+t;}var e=[this.layername,f(j,2),f(parseInt(a/1000000),3),f((parseInt(a/1000)%1000),3),f((parseInt(a)%1000),3),f(parseInt(m/1000000),3),f((parseInt(m/1000)%1000),3),f((parseInt(m)%1000),3)+"."+this.extension];var l=e.join("/");var d=this.url;if(d instanceof Array){d=this.selectUrl(l,d);}d=(d.charAt(d.length-1)=="/")?d:d+"/";return d+l;},addTile:function(d,a){var b=this.getURL(d);return new OpenLayers.Tile.Image(this,a,d,b,this.tileSize);},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:false,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var a=this.topInUnits.length;this.div.appendChild(this.eTop);if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden";}else{this.eTop.style.visibility="visible";}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden";}else{this.eBottom.style.visibility="visible";}}this.map.events.register("moveend",this,this.update);this.update();return this.div;},getBarLen:function(b){var e=parseInt(Math.log(b)/Math.log(10));var a=Math.pow(10,e);var d=parseInt(b/a);var f;if(d>5){f=5;}else{if(d>2){f=2;}else{f=1;}}return f*a;},update:function(){var m=this.map.getResolution();if(!m){return;}var t=this.map.getUnits();var f=OpenLayers.INCHES_PER_UNIT;var q=this.maxWidth*m*f[t];var s=1;if(this.geodesic===true){var b=(this.map.getGeodesicPixelSize().w||0.000001)*this.maxWidth;var g=q/f.km;s=b/g;q*=s;}var a;var e;if(q>100000){a=this.topOutUnits;e=this.bottomOutUnits;}else{a=this.topInUnits;e=this.bottomInUnits;}var j=q/f[a];var o=q/f[e];var l=this.getBarLen(j);var h=this.getBarLen(o);j=l/f[t]*f[a];o=h/f[t]*f[e];var d=j/m/s;var r=o/m/s;if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(r)+"px";this.eBottom.innerHTML=h+" "+e;}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(d)+"px";this.eTop.innerHTML=l+" "+a;}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a]);
},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(b,a){var d={};this.readChildNodes(b,d);a.outer=d.components[0];},innerBoundaryIs:function(b,a){var d={};this.readChildNodes(b,d);a.inner.push(d.components[0]);},Box:function(e,b){var f={};this.readChildNodes(e,f);if(!b.components){b.components=[];}var d=f.points[0];var a=f.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,a.x,a.y));}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(d){var b;if(d instanceof Array){b="wfs:FeatureCollection";}else{b="gml:featureMember";}var a=this.writeNode(b,d);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a]);},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[b],a);return a;},coordinates:function(e){var d=e.length;var f=new Array(d);var a;for(var b=0;b<d;++b){a=e[b];if(this.xy){f[b]=a.x+","+a.y;}else{f[b]=a.y+","+a.x;}if(a.z!=undefined){f[b]+=","+a.z;}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:(d==1)?f[0]:f.join(" ")});},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",b.components,a);return a;},Polygon:function(d){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",d.components[0],b);for(var a=1;a<d.components.length;++a){this.writeNode("innerBoundaryIs",d.components[a],b);}return b;},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",a,b);return b;},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",a,b);return b;},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",a.components,b);return b;},Box:function(b){var a=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:b.left,y:b.bottom},{x:b.right,y:b.top}],a);if(this.srsName){a.setAttribute("srsName",this.srsName);}return a;}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a]);},read:function(json,filter){try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var object=eval("("+json+")");if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i]);}}}return filter(k,v);}object=walk("",object);}if(this.keepData){this.data=object;}return object;}}catch(e){}return null;},write:function(f,d){this.pretty=!!d;var a=null;var b=typeof f;if(this.serialize[b]){try{a=this.serialize[b].apply(this,[f]);}catch(e){OpenLayers.Console.error("Trouble serializing: "+e);}}return a;},writeIndent:function(){var b=[];if(this.pretty){for(var a=0;a<this.level;++a){b.push(this.indent);}}return b.join("");},writeNewline:function(){return(this.pretty)?this.newline:"";},writeSpace:function(){return(this.pretty)?this.space:"";},serialize:{object:function(d){if(d==null){return"null";}if(d.constructor==Date){return this.serialize.date.apply(this,[d]);}if(d.constructor==Array){return this.serialize.array.apply(this,[d]);}var g=["{"];this.level+=1;var e,b,f;var a=false;for(e in d){if(d.hasOwnProperty(e)){b=OpenLayers.Format.JSON.prototype.write.apply(this,[e,this.pretty]);f=OpenLayers.Format.JSON.prototype.write.apply(this,[d[e],this.pretty]);if(b!=null&&f!=null){if(a){g.push(",");}g.push(this.writeNewline(),this.writeIndent(),b,":",this.writeSpace(),f);a=true;}}}this.level-=1;g.push(this.writeNewline(),this.writeIndent(),"}");return g.join("");},array:function(f){var d;var e=["["];this.level+=1;for(var b=0,a=f.length;b<a;++b){d=OpenLayers.Format.JSON.prototype.write.apply(this,[f[b],this.pretty]);if(d!=null){if(b>0){e.push(",");}e.push(this.writeNewline(),this.writeIndent(),d);}}this.level-=1;e.push(this.writeNewline(),this.writeIndent(),"]");return e.join("");},string:function(b){var a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(b)){return'"'+b.replace(/([\x00-\x1f\\"])/g,function(e,d){var f=a[d];if(f){return f;}f=d.charCodeAt();return"\\u00"+Math.floor(f/16).toString(16)+(f%16).toString(16);})+'"';}return'"'+b+'"';},number:function(a){return isFinite(a)?String(a):"null";},"boolean":function(a){return String(a);},date:function(a){function b(d){return(d<10)?"0"+d:d;}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"';}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(a){var b={};this.readers.ogc.Filter.apply(this,[a,b]);return b.filter;},readers:{ogc:{Filter:function(b,a){var d={fids:[],filters:[]};this.readChildNodes(b,d);if(d.fids.length>0){a.filter=new OpenLayers.Filter.FeatureId({fids:d.fids});}else{if(d.filters.length>0){a.filter=d.filters[0];}}},FeatureId:function(a,b){var d=a.getAttribute("fid");if(d){b.fids.push(d);}},And:function(b,d){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(b,a);d.filters.push(a);},Or:function(b,d){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(b,a);d.filters.push(a);},Not:function(b,d){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(b,a);d.filters.push(a);},PropertyIsLessThan:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(b,a);d.filters.push(a);},PropertyIsGreaterThan:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(b,a);d.filters.push(a);},PropertyIsLessThanOrEqualTo:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(b,a);d.filters.push(a);},PropertyIsGreaterThanOrEqualTo:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(b,a);d.filters.push(a);},PropertyIsBetween:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(b,a);d.filters.push(a);},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a));},PropertyName:function(b,a){a.property=this.getChildValue(b);},LowerBoundary:function(b,a){a.lowerBoundary=OpenLayers.String.numericIf(this.readOgcExpression(b));},UpperBoundary:function(b,a){a.upperBoundary=OpenLayers.String.numericIf(this.readOgcExpression(b));},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS);},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN);},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS);},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN);},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a));b.distanceUnits=a.getAttribute("units");}}},readSpatial:function(d,e,b){var a=new OpenLayers.Filter.Spatial({type:b});
this.readChildNodes(d,a);a.value=a.components[0];delete a.components;e.filters.push(a);},readOgcExpression:function(a){var d={};this.readChildNodes(a,d);var b=d.value;if(b===undefined){b=this.getChildValue(a);}return b;},write:function(a){return this.writers.ogc.Filter.apply(this,[a]);},writers:{ogc:{Filter:function(d){var e=this.createElementNSPlus("ogc:Filter");var b=d.CLASS_NAME.split(".").pop();if(b=="FeatureId"){for(var a=0;a<d.fids.length;++a){this.writeNode("FeatureId",d.fids[a],e);}}else{this.writeNode(this.getFilterType(d),d,e);}return e;},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}});},And:function(d){var e=this.createElementNSPlus("ogc:And");var b;for(var a=0;a<d.filters.length;++a){b=d.filters[a];this.writeNode(this.getFilterType(b),b,e);}return e;},Or:function(d){var e=this.createElementNSPlus("ogc:Or");var b;for(var a=0;a<d.filters.length;++a){b=d.filters[a];this.writeNode(this.getFilterType(b),b,e);}return e;},Not:function(b){var d=this.createElementNSPlus("ogc:Not");var a=b.filters[0];this.writeNode(this.getFilterType(a),a,d);return d;},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",a,b);this.writeNode("LowerBoundary",a,b);this.writeNode("UpperBoundary",a,b);return b;},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property});},Literal:function(a){return this.createElementNSPlus("ogc:Literal",{value:a});},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");this.writeNode("Literal",a.lowerBoundary,b);return b;},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",a.upperBoundary,b);return b;},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects");},WITHIN:function(a){return this.writeSpatial(a,"Within");},CONTAINS:function(a){return this.writeSpatial(a,"Contains");},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");this.writeNode("Distance",a,b);return b;},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance});}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b){throw"Filter writing not supported for rule type: "+a.type;}return b;},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a]);},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(b,a);d.filters.push(a);},PropertyIsNotEqualTo:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(b,a);d.filters.push(a);},PropertyIsLike:function(e,f){var d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,d);var g=e.getAttribute("wildCard");var b=e.getAttribute("singleChar");var a=e.getAttribute("escape");d.value2regex(g,b,a);f.filters.push(d);}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b;},BBOX:function(a){var d=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",a,d);var b=this.writeNode("gml:Box",a.value,d);if(a.projection){b.setAttribute("srsName",a.projection);}return d;}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(b,a){var d=this.createElementNSPlus("ogc:"+a);this.writeNode("PropertyName",b,d);var e;if(b.value instanceof OpenLayers.Geometry){e=this.writeNode("feature:_geometry",b.value).firstChild;}else{e=this.writeNode("gml:Box",b.value);}if(b.projection){e.setAttribute("srsName",b.projection);}d.appendChild(e);return d;},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a]);},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(b,e){var d=b.getAttribute("matchCase");var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(d==="false"||d==="0")});this.readChildNodes(b,a);e.filters.push(a);},PropertyIsNotEqualTo:function(b,e){var d=b.getAttribute("matchCase");var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(d==="false"||d==="0")});this.readChildNodes(b,a);e.filters.push(a);},PropertyIsLike:function(e,f){var d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,d);var g=e.getAttribute("wildCard");var b=e.getAttribute("singleChar");var a=e.getAttribute("escapeChar");d.value2regex(g,b,a);f.filters.push(d);}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b;},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b;},BBOX:function(a){var d=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",a,d);var b=this.writeNode("gml:Envelope",a.value);if(a.projection){b.setAttribute("srsName",a.projection);}d.appendChild(b);
return d;}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(b,a){var d=this.createElementNSPlus("ogc:"+a);this.writeNode("PropertyName",b,d);var e;if(b.value instanceof OpenLayers.Geometry){e=this.writeNode("feature:_geometry",b.value).firstChild;}else{e=this.writeNode("gml:Envelope",b.value);}if(b.projection){e.setAttribute("srsName",b.projection);}d.appendChild(e);return d;},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",ows:"http://www.opengis.net/ows"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a]);}if(a&&a.nodeType==9){a=a.documentElement;}var b={};this.readNode(a,b);return b;},readers:{csw:{GetRecordsResponse:function(b,d){d.records=[];this.readChildNodes(b,d);var a=this.getAttributeNS(b,"","version");if(a!=""){d.version=a;}},RequestId:function(a,b){b.RequestId=this.getChildValue(a);},SearchStatus:function(a,d){d.SearchStatus={};var b=this.getAttributeNS(a,"","timestamp");if(b!=""){d.SearchStatus.timestamp=b;}},SearchResults:function(e,f){this.readChildNodes(e,f);var b=e.attributes;var g={};for(var d=0,a=b.length;d<a;++d){if((b[d].name=="numberOfRecordsMatched")||(b[d].name=="numberOfRecordsReturned")||(b[d].name=="nextRecord")){g[b[d].name]=parseInt(b[d].nodeValue);}else{g[b[d].name]=b[d].nodeValue;}}f.SearchResults=g;},SummaryRecord:function(b,d){var a={type:"SummaryRecord"};this.readChildNodes(b,a);d.records.push(a);},BriefRecord:function(b,d){var a={type:"BriefRecord"};this.readChildNodes(b,a);d.records.push(a);},DCMIRecord:function(b,d){var a={type:"DCMIRecord"};this.readChildNodes(b,a);d.records.push(a);},Record:function(b,d){var a={type:"Record"};this.readChildNodes(b,a);d.records.push(a);}},dc:{"*":function(g,h){var e=g.localName||g.nodeName.split(":").pop();if(!(h[e] instanceof Array)){h[e]=new Array();}var d={};var b=g.attributes;for(var f=0,a=b.length;f<a;++f){d[b[f].name]=b[f].nodeValue;}d.value=this.getChildValue(g);h[e].push(d);}},dct:{"*":function(b,d){var a=b.localName||b.nodeName.split(":").pop();if(!(d[a] instanceof Array)){d[a]=new Array();}d[a].push(this.getChildValue(b));}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(a,b){if(b.bounds){b.BoundingBox=[{crs:b.projection,value:[b.bounds.left,b.bounds.bottom,b.bounds.right,b.bounds.top]}];delete b.projection;delete b.bounds;}OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows["BoundingBox"].apply(this,arguments);}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(a){var b=this.writeNode("csw:GetRecords",a);return OpenLayers.Format.XML.prototype.write.apply(this,[b]);},writers:{csw:{GetRecords:function(b){if(!b){b={};}var f=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:b.requestId||this.requestId,resultType:b.resultType||this.resultType,outputFormat:b.outputFormat||this.outputFormat,outputSchema:b.outputSchema||this.outputSchema,startPosition:b.startPosition||this.startPosition,maxRecords:b.maxRecords||this.maxRecords}});if(b.DistributedSearch||this.DistributedSearch){this.writeNode("csw:DistributedSearch",b.DistributedSearch||this.DistributedSearch,f);}var e=b.ResponseHandler||this.ResponseHandler;if(e instanceof Array&&e.length>0){for(var d=0,a=e.length;d<a;d++){this.writeNode("csw:ResponseHandler",e[d],f);}}this.writeNode("Query",b.Query||this.Query,f);return f;},DistributedSearch:function(a){var b=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:a.hopCount}});return b;},ResponseHandler:function(a){var b=this.createElementNSPlus("csw:ResponseHandler",{value:a.value});return b;},Query:function(b){if(!b){b={};}var f=this.createElementNSPlus("csw:Query",{attributes:{typeNames:b.typeNames||"csw:Record"}});var e=b.ElementName;if(e instanceof Array&&e.length>0){for(var d=0,a=e.length;d<a;d++){this.writeNode("csw:ElementName",e[d],f);}}else{this.writeNode("csw:ElementSetName",b.ElementSetName||{value:"summary"},f);}if(b.Constraint){this.writeNode("csw:Constraint",b.Constraint,f);}return f;},ElementName:function(a){var b=this.createElementNSPlus("csw:ElementName",{value:a.value});return b;},ElementSetName:function(a){var b=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:a.typeNames},value:a.value});return b;},Constraint:function(a){var b=this.createElementNSPlus("csw:Constraint",{attributes:{version:a.version}});if(a.Filter){var d=new OpenLayers.Format.Filter({version:a.version});b.appendChild(d.write(a.Filter));}else{if(a.CqlText){var e=this.createElementNSPlus("CqlText",{value:a.CqlText.value});b.appendChild(e);}}return b;}}},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.1",version:null,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a;},read:function(f){if(typeof f=="string"){f=OpenLayers.Format.XML.prototype.read.apply(this,[f]);}var d=f.documentElement;var b=this.version||d.getAttribute("version")||this.defaultVersion;if(!this.parser||this.parser.version!==b){var e=OpenLayers.Format.WMSCapabilities["v"+b.replace(/\./g,"_")];if(!e){throw"Can't find a WMS capabilities parser for version "+b;}this.parser=new e(this.options);}var a=this.parser.read(f);a.version=b;return a;},CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b]);}if(b&&b.nodeType==9){b=b.documentElement;}var a={};this.readNode(b,a);this.postProcessLayers(a);return a;},postProcessLayers:function(b){if(b.capability){b.capability.layers=[];var f=b.capability.nestedLayers;for(var e=0,a=f.length;e<a;++e){var d=f[e];this.processLayer(b.capability,d);}}},processLayer:function(a,m,d){if(m.formats===undefined){m.formats=a.request.getmap.formats;}if(d){m.styles=m.styles.concat(d.styles);var g=["queryable","cascaded","fixedWidth","fixedHeight","opaque","noSubsets","llbbox","minScale","maxScale","attribution"];var r=["srs","bbox","dimensions","authorityURLs"];var q;for(var f=0;f<g.length;f++){q=g[f];if(q in d){if(m[q]==null){m[q]=d[q];}if(m[q]==null){var l=["cascaded","fixedWidth","fixedHeight"];var b=["queryable","opaque","noSubsets"];if(OpenLayers.Util.indexOf(l,q)!=-1){m[q]=0;}if(OpenLayers.Util.indexOf(b,q)!=-1){m[q]=false;}}}}for(var f=0;f<r.length;f++){q=r[f];m[q]=OpenLayers.Util.extend(m[q],d[q]);}}for(var h=0,o=m.nestedLayers.length;h<o;h++){var e=m.nestedLayers[h];this.processLayer(a,e,m);}if(m.name){a.layers.push(m);}},readers:{wms:{Service:function(a,b){b.service={};this.readChildNodes(a,b.service);},Name:function(a,b){b.name=this.getChildValue(a);},Title:function(a,b){b.title=this.getChildValue(a);},Abstract:function(a,b){b["abstract"]=this.getChildValue(a);},BoundingBox:function(b,d){var e={};
e.bbox=[parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy"))];var a={x:parseFloat(b.getAttribute("resx")),y:parseFloat(b.getAttribute("resy"))};if(!(isNaN(a.x)&&isNaN(a.y))){e.res=a;}return e;},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href");},ContactInformation:function(a,b){b.contactInformation={};this.readChildNodes(a,b.contactInformation);},ContactPersonPrimary:function(a,b){b.personPrimary={};this.readChildNodes(a,b.personPrimary);},ContactPerson:function(a,b){b.person=this.getChildValue(a);},ContactOrganization:function(a,b){b.organization=this.getChildValue(a);},ContactPosition:function(a,b){b.position=this.getChildValue(a);},ContactAddress:function(a,b){b.contactAddress={};this.readChildNodes(a,b.contactAddress);},AddressType:function(a,b){b.type=this.getChildValue(a);},Address:function(a,b){b.address=this.getChildValue(a);},City:function(a,b){b.city=this.getChildValue(a);},StateOrProvince:function(a,b){b.stateOrProvince=this.getChildValue(a);},PostCode:function(a,b){b.postcode=this.getChildValue(a);},Country:function(a,b){b.country=this.getChildValue(a);},ContactVoiceTelephone:function(a,b){b.phone=this.getChildValue(a);},ContactFacsimileTelephone:function(a,b){b.fax=this.getChildValue(a);},ContactElectronicMailAddress:function(a,b){b.email=this.getChildValue(a);},Fees:function(b,d){var a=this.getChildValue(b);if(a&&a.toLowerCase()!="none"){d.fees=a;}},AccessConstraints:function(a,b){var d=this.getChildValue(a);if(d&&d.toLowerCase()!="none"){b.accessConstraints=d;}},Capability:function(a,b){b.capability={nestedLayers:[]};this.readChildNodes(a,b.capability);},Request:function(a,b){b.request={};this.readChildNodes(a,b.request);},GetCapabilities:function(a,b){b.getcapabilities={formats:[]};this.readChildNodes(a,b.getcapabilities);},Format:function(a,b){if(b.formats instanceof Array){b.formats.push(this.getChildValue(a));}else{b.format=this.getChildValue(a);}},DCPType:function(a,b){this.readChildNodes(a,b);},HTTP:function(a,b){this.readChildNodes(a,b);},Get:function(a,b){this.readChildNodes(a,b);},Post:function(a,b){this.readChildNodes(a,b);},GetMap:function(a,b){b.getmap={formats:[]};this.readChildNodes(a,b.getmap);},GetFeatureInfo:function(a,b){b.getfeatureinfo={formats:[]};this.readChildNodes(a,b.getfeatureinfo);},Exception:function(a,b){b.exception={formats:[]};this.readChildNodes(a,b.exception);},Layer:function(b,f){var o=b.getAttributeNode("queryable");var d=(o&&o.specified)?b.getAttribute("queryable"):null;o=b.getAttributeNode("cascaded");var l=(o&&o.specified)?b.getAttribute("cascaded"):null;o=b.getAttributeNode("opaque");var g=(o&&o.specified)?b.getAttribute("opaque"):null;var m=b.getAttribute("noSubsets");var a=b.getAttribute("fixedWidth");var j=b.getAttribute("fixedHeight");var h={nestedLayers:[],styles:[],srs:{},metadataURLs:[],bbox:{},dimensions:{},authorityURLs:{},identifiers:{},keywords:[],queryable:(d&&d!=="")?(d==="1"||d==="true"):null,cascaded:(l!==null)?parseInt(l):null,opaque:g?(g==="1"||g==="true"):null,noSubsets:(m!==null)?(m==="1"||m==="true"):null,fixedWidth:(a!=null)?parseInt(a):null,fixedHeight:(j!=null)?parseInt(j):null};f.nestedLayers.push(h);this.readChildNodes(b,h);if(h.name){var e=h.name.split(":");if(e.length>0){h.prefix=e[0];}}},Attribution:function(a,b){b.attribution={};this.readChildNodes(a,b.attribution);},LogoURL:function(a,b){b.logo={width:a.getAttribute("width"),height:a.getAttribute("height")};this.readChildNodes(a,b.logo);},Style:function(b,d){var a={};d.styles.push(a);this.readChildNodes(b,a);},LegendURL:function(b,d){var a={width:b.getAttribute("width"),height:b.getAttribute("height")};d.legend=a;this.readChildNodes(b,a);},MetadataURL:function(a,b){var d={type:a.getAttribute("type")};b.metadataURLs.push(d);this.readChildNodes(a,d);},DataURL:function(a,b){b.dataURL={};this.readChildNodes(a,b.dataURL);},FeatureListURL:function(a,b){b.featureListURL={};this.readChildNodes(a,b.featureListURL);},AuthorityURL:function(b,e){var a=b.getAttribute("name");var d={};this.readChildNodes(b,d);e.authorityURLs[a]=d.href;},Identifier:function(a,d){var b=a.getAttribute("authority");d.identifiers[b]=this.getChildValue(a);},KeywordList:function(a,b){this.readChildNodes(a,b);},SRS:function(a,b){b.srs[this.getChildValue(a)]=true;}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(a,b){this.readChildNodes(a,b);},Keyword:function(a,b){if(b.keywords){b.keywords.push(this.getChildValue(a));}},DescribeLayer:function(a,b){b.describelayer={formats:[]};this.readChildNodes(a,b.describelayer);},GetLegendGraphic:function(a,b){b.getlegendgraphic={formats:[]};this.readChildNodes(a,b.getlegendgraphic);},GetStyles:function(a,b){b.getstyles={formats:[]};this.readChildNodes(a,b.getstyles);},PutStyles:function(a,b){b.putstyles={formats:[]};this.readChildNodes(a,b.putstyles);},UserDefinedSymbolization:function(a,b){var d={supportSLD:parseInt(a.getAttribute("SupportSLD"))==1,userLayer:parseInt(a.getAttribute("UserLayer"))==1,userStyle:parseInt(a.getAttribute("UserStyle"))==1,remoteWFS:parseInt(a.getAttribute("RemoteWFS"))==1};b.userSymbols=d;},LatLonBoundingBox:function(a,b){b.llbbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))];},BoundingBox:function(a,b){var d=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);d.srs=a.getAttribute("SRS");b.bbox[d.srs]=d;},ScaleHint:function(f,g){var e=f.getAttribute("min");var a=f.getAttribute("max");var d=Math.pow(2,0.5);var b=OpenLayers.INCHES_PER_UNIT.m;g.maxScale=parseFloat(((e/d)*b*OpenLayers.DOTS_PER_INCH).toPrecision(13));g.minScale=parseFloat(((a/d)*b*OpenLayers.DOTS_PER_INCH).toPrecision(13));},Dimension:function(b,e){var a=b.getAttribute("name").toLowerCase();var d={name:a,units:b.getAttribute("units"),unitsymbol:b.getAttribute("unitSymbol")};e.dimensions[d.name]=d;},Extent:function(e,f){var b=e.getAttribute("name").toLowerCase();if(b in f.dimensions){var d=f.dimensions[b];d.nearestVal=e.getAttribute("nearestValue")==="1";d.multipleVal=e.getAttribute("multipleValues")==="1";d.current=e.getAttribute("current")==="1";d["default"]=e.getAttribute("default")||"";var a=this.getChildValue(e);d.values=a.split(",");}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",initialize:function(a){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[a]);},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(f,g){var e=this.getChildValue(f);var b=e.split(/ +/);for(var d=0,a=b.length;d<a;d++){g.srs[b[d]]=true;}}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",initialize:function(a){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[a]);},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){b.srs[this.getChildValue(a)]=true;}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(a,b){this.readChildNodes(a,b);},LayerLimit:function(a,b){b.layerLimit=parseInt(this.getChildValue(a));},MaxWidth:function(a,b){b.maxWidth=parseInt(this.getChildValue(a));},MaxHeight:function(a,b){b.maxHeight=parseInt(this.getChildValue(a));},BoundingBox:function(a,b){var d=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);
d.srs=a.getAttribute("CRS");b.bbox[d.srs]=d;},CRS:function(a,b){this.readers.wms.SRS.apply(this,[a,b]);},EX_GeographicBoundingBox:function(a,b){b.llbbox=[];this.readChildNodes(a,b.llbbox);},westBoundLongitude:function(a,b){b[0]=this.getChildValue(a);},eastBoundLongitude:function(a,b){b[2]=this.getChildValue(a);},southBoundLatitude:function(a,b){b[1]=this.getChildValue(a);},northBoundLatitude:function(a,b){b[3]=this.getChildValue(a);},MinScaleDenominator:function(a,b){b.maxScale=parseFloat(this.getChildValue(a)).toPrecision(16);},MaxScaleDenominator:function(a,b){b.minScale=parseFloat(this.getChildValue(a)).toPrecision(16);},Dimension:function(b,e){var a=b.getAttribute("name").toLowerCase();var d={name:a,units:b.getAttribute("units"),unitsymbol:b.getAttribute("unitSymbol"),nearestVal:b.getAttribute("nearestValue")==="1",multipleVal:b.getAttribute("multipleValues")==="1","default":b.getAttribute("default")||"",current:b.getAttribute("current")==="1",values:this.getChildValue(b).split(",")};e.dimensions[d.name]=d;},Keyword:function(b,d){var a={value:this.getChildValue(b),vocabulary:b.getAttribute("vocabulary")};if(d.keywords){d.keywords.push(a);}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(a,b){this.readers.wms.UserDefinedSymbolization.apply(this,[a,b]);b.userSymbols.inlineFeature=parseInt(a.getAttribute("InlineFeature"))==1;b.userSymbols.remoteWCS=parseInt(a.getAttribute("RemoteWCS"))==1;},DescribeLayer:function(a,b){this.readers.wms.DescribeLayer.apply(this,[a,b]);},GetLegendGraphic:function(a,b){this.readers.wms.GetLegendGraphic.apply(this,[a,b]);}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:false,initialize:function(b,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.element=OpenLayers.Util.getElement(b);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.element=document.createElement("div");this.div.appendChild(this.element);}this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div;},updateScale:function(){var d;if(this.geodesic===true){var a=this.map.getUnits();if(!a){return;}var b=OpenLayers.INCHES_PER_UNIT;d=(this.map.getGeodesicPixelSize().w||0.000001)*b.km*OpenLayers.DOTS_PER_INCH;}else{d=this.map.getScale();}if(!d){return;}if(d>=9500&&d<=950000){d=Math.round(d/1000)+"K";}else{if(d>=950000){d=Math.round(d/1000000)+"M";}else{d=Math.round(d);}}this.element.innerHTML=OpenLayers.i18n("scale",{scaleDenom:d});},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],multi:false,featureAdded:function(){},handlerOptions:null,initialize:function(b,d,a){this.EVENT_TYPES=OpenLayers.Control.DrawFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(g,f){this.layer.events.triggerEvent("sketchmodified",{vertex:g,feature:f});},create:function(g,f){this.layer.events.triggerEvent("sketchstarted",{vertex:g,feature:f});}},this.callbacks);this.layer=b;this.handlerOptions=this.handlerOptions||{};if(!("multi" in this.handlerOptions)){this.handlerOptions.multi=this.multi;}var e=this.layer.styleMap&&this.layer.styleMap.styles.temporary;if(e){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":e})});}this.handler=new d(this,this.callbacks,this.handlerOptions);},drawFeature:function(d){var a=new OpenLayers.Feature.Vector(d);var b=this.layer.events.triggerEvent("sketchcomplete",{feature:a});if(b!==false){a.state=OpenLayers.State.INSERT;this.layer.addFeatures([a]);this.featureAdded(a);this.events.triggerEvent("featureadded",{feature:a});}},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={};OpenLayers.Util.extend(this,a);if(this.symbolizers){delete this.symbolizer;}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){for(var a in this.symbolizer){this.symbolizer[a]=null;}this.symbolizer=null;delete this.symbolizers;},evaluate:function(d){var b=this.getContext(d);var a=true;if(this.minScaleDenominator||this.maxScaleDenominator){var e=d.layer.map.getScale();}if(this.minScaleDenominator){a=e>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b);}if(a&&this.maxScaleDenominator){a=e<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b);}if(a&&this.filter){if(this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"){a=this.filter.evaluate(d);}else{a=this.filter.evaluate(b);}}return a;},getContext:function(b){var a=this.context;if(!a){a=b.attributes||b.data;}if(typeof this.context=="function"){a=this.context(b);}return a;},clone:function(){var b=OpenLayers.Util.extend({},this);if(this.symbolizers){var a=this.symbolizers.length;b.symbolizers=new Array(a);for(var e=0;e<a;++e){b.symbolizers[e]=this.symbolizers[e].clone();}}else{b.symbolizer={};var g,f;for(var d in this.symbolizer){g=this.symbolizer[d];f=typeof g;if(f==="object"){b.symbolizer[d]=OpenLayers.Util.extend({},g);}else{if(f==="string"){b.symbolizer[d]=g;}}}}b.filter=this.filter&&this.filter.clone();b.context=this.context&&OpenLayers.Util.extend({},this.context);return new OpenLayers.Rule(b);},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,initialize:function(d,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);},mousemove:function(a){if(this.passesTolerance(a.xy)){this.clearTimer();this.callback("move",[a]);this.px=a.xy;a=OpenLayers.Util.extend({},a);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay);}return !this.stopMove;},mouseout:function(a){if(OpenLayers.Util.mouseLeft(a,this.map.div)){this.clearTimer();this.callback("move",[a]);}return true;},passesTolerance:function(b){var d=true;if(this.pixelTolerance&&this.px){var a=Math.sqrt(Math.pow(this.px.x-b.x,2)+Math.pow(this.px.y-b.y,2));if(a<this.pixelTolerance){d=false;}}return d;},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null;}},delayedCall:function(a){this.callback("pause",[a]);},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();a=true;}return a;},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.MouseDefaults=OpenLayers.Class(OpenLayers.Control,{performedDrag:false,wheelObserver:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){if(this.handler){this.handler.destroy();}this.handler=null;this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver);OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver);this.wheelObserver=null;OpenLayers.Control.prototype.destroy.apply(this,arguments);},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});
this.registerWheelEvents();},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver);OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver);},defaultClick:function(b){if(!OpenLayers.Event.isLeftClick(b)){return;}var a=!this.performedDrag;this.performedDrag=false;return a;},defaultDblClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1);OpenLayers.Event.stop(b);return false;},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return;}this.mouseDragStart=a.xy.clone();this.performedDrag=false;if(a.shiftKey){this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);}document.onselectstart=OpenLayers.Function.False;OpenLayers.Event.stop(a);},defaultMouseMove:function(f){this.mousePosition=f.xy.clone();if(this.mouseDragStart!=null){if(this.zoomBox){var e=Math.abs(this.mouseDragStart.x-f.xy.x);var b=Math.abs(this.mouseDragStart.y-f.xy.y);this.zoomBox.style.width=Math.max(1,e)+"px";this.zoomBox.style.height=Math.max(1,b)+"px";if(f.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=f.xy.x+"px";}if(f.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=f.xy.y+"px";}}else{var e=this.mouseDragStart.x-f.xy.x;var b=this.mouseDragStart.y-f.xy.y;var g=this.map.getSize();var a=new OpenLayers.Pixel(g.w/2+e,g.h/2+b);var d=this.map.getLonLatFromViewPortPx(a);this.map.setCenter(d,null,true);this.mouseDragStart=f.xy.clone();this.map.div.style.cursor="move";}this.performedDrag=true;}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return;}if(this.zoomBox){this.zoomBoxEnd(a);}else{if(this.performedDrag){this.map.setCenter(this.map.center);}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor="";},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.div)){if(this.zoomBox){this.removeZoomBox();}this.mouseDragStart=null;}},defaultWheelUp:function(a){if(this.map.getZoom()<=this.map.getNumZoomLevels()){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()+1);}},defaultWheelDown:function(a){if(this.map.getZoom()>0){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()-1);}},zoomBoxEnd:function(b){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-b.xy.x)>5||Math.abs(this.mouseDragStart.y-b.xy.y)>5){var j=this.map.getLonLatFromViewPortPx(this.mouseDragStart);var a=this.map.getLonLatFromViewPortPx(b.xy);var h=Math.max(j.lat,a.lat);var d=Math.min(j.lat,a.lat);var g=Math.min(j.lon,a.lon);var e=Math.max(j.lon,a.lon);var f=new OpenLayers.Bounds(g,d,e,h);this.map.zoomToExtent(f);}else{var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(new OpenLayers.LonLat((a.lon),(a.lat)),this.map.getZoom()+1);}this.removeZoomBox();}},removeZoomBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;},onWheelEvent:function(d){var b=false;var a=OpenLayers.Event.element(d);while(a!=null){if(this.map&&a==this.map.div){b=true;break;}a=a.parentNode;}if(b){var f=0;if(!d){d=window.event;}if(d.wheelDelta){f=d.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){f=-f;}}else{if(d.detail){f=-d.detail/3;}}if(f){d.xy=this.mousePosition;if(f<0){this.defaultWheelDown(d);}else{this.defaultWheelUp(d);}}OpenLayers.Event.stop(d);}},CLASS_NAME:"OpenLayers.Control.MouseDefaults"});OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments);},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.map.events.register("mousemove",this,this.redraw);this.map.events.register("mouseout",this,this.reset);this.redraw();return true;}else{return false;}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("mousemove",this,this.redraw);this.map.events.unregister("mouseout",this,this.reset);this.element.innerHTML="";return true;}else{return false;}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.left="";this.div.top="";this.element=this.div;}return this.div;},redraw:function(a){var d;if(a==null){this.reset();return;}else{if(this.lastXy==null||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity){this.lastXy=a.xy;return;}d=this.map.getLonLatFromPixel(a.xy);if(!d){return;}if(this.displayProjection){d.transform(this.map.getProjectionObject(),this.displayProjection);}this.lastXy=a.xy;}var b=this.formatOutput(d);if(b!=this.element.innerHTML){this.element.innerHTML=b;}},reset:function(a){if(this.emptyString!=null){this.element.innerHTML=this.emptyString;}},formatOutput:function(b){var d=parseInt(this.numDigits);var a=this.prefix+b.lon.toFixed(d)+this.separator+b.lat.toFixed(d)+this.suffix;return a;},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:false,irregular:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(d,b,a){if(!(a&&a.layerOptions&&a.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{});}OpenLayers.Handler.prototype.initialize.apply(this,[d,b,a]);this.options=(a)?a:{};},setOptions:function(a){OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a);},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);a=true;}return a;},deactivate:function(){var a=false;if(OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel();}if(this.layer.map!=null){this.layer.destroy(false);if(this.feature){this.feature.destroy();}}this.layer=null;this.feature=null;a=true;}return a;},down:function(a){this.fixedRadius=!!(this.radius);var b=this.map.getLonLatFromPixel(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution();}if(this.persist){this.clear();}this.feature=new OpenLayers.Feature.Vector();this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:true});this.layer.drawFeature(this.feature,this.style);},move:function(d){var g=this.map.getLonLatFromPixel(d.xy);var a=new OpenLayers.Geometry.Point(g.lon,g.lat);if(this.irregular){var h=Math.sqrt(2)*Math.abs(a.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,h);}else{if(this.fixedRadius){this.origin=a;}else{this.calculateAngle(a,d);this.radius=Math.max(this.map.getResolution()/2,a.distanceTo(this.origin));}}this.modifyGeometry();if(this.irregular){var e=a.x-this.origin.x;var b=a.y-this.origin.y;var f;if(b==0){f=e/(this.radius*Math.sqrt(2));}else{f=e/b;}this.feature.geometry.resize(1,this.origin,f);this.feature.geometry.move(e/2,b/2);}this.layer.drawFeature(this.feature,this.style);},up:function(a){this.finalize();
if(this.start==this.last){this.callback("done",[a.xy]);}},out:function(a){this.finalize();},createGeometry:function(){this.angle=Math.PI*((1/this.sides)-(1/2));if(this.snapAngle){this.angle+=this.snapAngle*(Math.PI/180);}this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle);},modifyGeometry:function(){var e,a;var b=this.feature.geometry.components[0];if(b.components.length!=(this.sides+1)){this.createGeometry();b=this.feature.geometry.components[0];}for(var d=0;d<this.sides;++d){a=b.components[d];e=this.angle+(d*2*Math.PI/this.sides);a.x=this.origin.x+(this.radius*Math.cos(e));a.y=this.origin.y+(this.radius*Math.sin(e));a.clearBounds();}},calculateAngle:function(a,b){var e=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&(this.snapToggle&&!b[this.snapToggle])){var d=(Math.PI/180)*this.snapAngle;this.angle=Math.round(e/d)*d;}else{this.angle=e;}},cancel:function(){this.callback("cancel",null);this.finalize();},finalize:function(){this.origin=null;this.radius=this.options.radius;},clear:function(){if(this.layer){this.layer.renderer.clear();this.layer.destroyFeatures();}},callback:function(b,a){if(this.callbacks[b]){this.callbacks[b].apply(this.control,[this.feature.geometry.clone()]);}if(!this.persist&&(b=="done"||b=="cancel")){this.clear();}},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(b){if(!this.supported()){return;}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var f=document.createStyleSheet();var d=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];for(var e=0,a=d.length;e<a;e++){f.addRule("olv\\:"+d[e],"behavior: url(#default#VML); position: absolute; display: inline-block;");}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments);},supported:function(){return !!(document.namespaces);},setExtent:function(l,a){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var d=this.getResolution();var b=(l.left/d)|0;var g=(l.top/d-this.size.h)|0;if(a||!this.offset){this.offset={x:b,y:g};b=0;g=0;}else{b=b-this.offset.x;g=g-this.offset.y;}var o=b+" "+g;this.root.coordorigin=o;var j=[this.root,this.vectorRoot,this.textRoot];var h;for(var e=0,f=j.length;e<f;++e){h=j[e];var m=this.size.w+" "+this.size.h;h.coordsize=m;}this.root.style.flip="y";return true;},setSize:function(g){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);var e=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];var d=this.size.w+"px";var j=this.size.h+"px";var b;for(var f=0,a=e.length;f<a;++f){b=e[f];b.style.width=d;b.style.height=j;}},getNodeType:function(d,b){var a=null;switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="olv:rect";}else{if(this.isComplexSymbol(b.graphicName)){a="olv:shape";}else{a="olv:oval";}}break;case"OpenLayers.Geometry.Rectangle":a="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":a="olv:shape";break;default:break;}return a;},setStyle:function(f,b,v,o){b=b||f._style;v=v||f._options;var d=b.fillColor;if(f._geometryClass==="OpenLayers.Geometry.Point"){if(b.externalGraphic){if(b.graphicTitle){f.title=b.graphicTitle;}var e=b.graphicWidth||b.graphicHeight;var q=b.graphicHeight||b.graphicWidth;e=e?e:b.pointRadius*2;q=q?q:b.pointRadius*2;var h=this.getResolution();var l=(b.graphicXOffset!=undefined)?b.graphicXOffset:-(0.5*e);var g=(b.graphicYOffset!=undefined)?b.graphicYOffset:-(0.5*q);f.style.left=(((o.x/h-this.offset.x)+l)|0)+"px";f.style.top=(((o.y/h-this.offset.y)-(g+q))|0)+"px";f.style.width=e+"px";f.style.height=q+"px";f.style.flip="y";d="none";v.isStroked=false;}else{if(this.isComplexSymbol(b.graphicName)){var a=this.importSymbol(b.graphicName);f.path=a.path;f.coordorigin=a.left+","+a.bottom;var u=a.size;f.coordsize=u+","+u;this.drawCircle(f,o,b.pointRadius);f.style.flip="y";}else{this.drawCircle(f,o,b.pointRadius);}}}if(v.isFilled){f.fillcolor=d;}else{f.filled="false";}var m=f.getElementsByTagName("fill");var t=(m.length==0)?null:m[0];if(!v.isFilled){if(t){f.removeChild(t);}}else{if(!t){t=this.createNode("olv:fill",f.id+"_fill");}t.opacity=b.fillOpacity;if(f._geometryClass==="OpenLayers.Geometry.Point"&&b.externalGraphic){if(b.graphicOpacity){t.opacity=b.graphicOpacity;}t.src=b.externalGraphic;t.type="frame";if(!(b.graphicWidth&&b.graphicHeight)){t.aspect="atmost";}}if(t.parentNode!=f){f.appendChild(t);}}var s=b.rotation;if((s!==undefined||f._rotation!==undefined)){f._rotation=s;if(b.externalGraphic){this.graphicRotate(f,l,g,b);t.opacity=0;}else{if(f._geometryClass==="OpenLayers.Geometry.Point"){f.style.rotation=s||0;}}}var j=f.getElementsByTagName("stroke");var r=(j.length==0)?null:j[0];if(!v.isStroked){f.stroked=false;if(r){r.on=false;}}else{if(!r){r=this.createNode("olv:stroke",f.id+"_stroke");f.appendChild(r);}r.on=true;r.color=b.strokeColor;r.weight=b.strokeWidth+"px";r.opacity=b.strokeOpacity;r.endcap=b.strokeLinecap=="butt"?"flat":(b.strokeLinecap||"round");if(b.strokeDashstyle){r.dashstyle=this.dashStyle(b);}}if(b.cursor!="inherit"&&b.cursor!=null){f.style.cursor=b.cursor;}return f;},graphicRotate:function(s,w,f,v){var v=v||s._style;var t=v.rotation||0;var a,m;if(!(v.graphicWidth&&v.graphicHeight)){var z=new Image();z.onreadystatechange=OpenLayers.Function.bind(function(){if(z.readyState=="complete"||z.readyState=="interactive"){a=z.width/z.height;m=Math.max(v.pointRadius*2,v.graphicWidth||0,v.graphicHeight||0);w=w*a;v.graphicWidth=m*a;v.graphicHeight=m;this.graphicRotate(s,w,f,v);}},this);z.src=v.externalGraphic;return;}else{m=Math.max(v.graphicWidth,v.graphicHeight);a=v.graphicWidth/v.graphicHeight;}var r=Math.round(v.graphicWidth||m*a);var o=Math.round(v.graphicHeight||m);s.style.width=r+"px";s.style.height=o+"px";var q=document.getElementById(s.id+"_image");if(!q){q=this.createNode("olv:imagedata",s.id+"_image");s.appendChild(q);}q.style.width=r+"px";q.style.height=o+"px";q.src=v.externalGraphic;q.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var g=t*Math.PI/180;var j=Math.sin(g);var e=Math.cos(g);var h="progid:DXImageTransform.Microsoft.Matrix(M11="+e+",M12="+(-j)+",M21="+j+",M22="+e+",SizingMethod='auto expand')\n";var b=v.graphicOpacity||v.fillOpacity;if(b&&b!=1){h+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+b+")\n";}s.style.filter=h;var u=new OpenLayers.Geometry.Point(-w,-f);var d=new OpenLayers.Bounds(0,0,r,o).toGeometry();d.rotate(v.rotation,u);var l=d.getBounds();s.style.left=Math.round(parseInt(s.style.left)+l.left)+"px";s.style.top=Math.round(parseInt(s.style.top)-l.bottom)+"px";},postDraw:function(a){a.style.visibility="visible";var d=a._style.fillColor;var b=a._style.strokeColor;if(d=="none"&&a.fillcolor!=d){a.fillcolor=d;}if(b=="none"&&a.strokecolor!=b){a.strokecolor=b;}},setNodeDimension:function(b,f){var e=f.getBounds();if(e){var a=this.getResolution();var d=new OpenLayers.Bounds((e.left/a-this.offset.x)|0,(e.bottom/a-this.offset.y)|0,(e.right/a-this.offset.x)|0,(e.top/a-this.offset.y)|0);b.style.left=d.left+"px";b.style.top=d.top+"px";b.style.width=d.getWidth()+"px";b.style.height=d.getHeight()+"px";b.coordorigin=d.left+" "+d.top;b.coordsize=d.getWidth()+" "+d.getHeight();}},dashStyle:function(a){var d=a.strokeDashstyle;switch(d){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return d;default:var b=d.split(/[ ,]/);if(b.length==2){if(1*b[0]>=2*b[1]){return"longdash";}return(b[0]==1||b[1]==1)?"dot":"dash";}else{if(b.length==4){return(1*b[0]>=2*b[1])?"longdashdot":"dashdot";}}return"solid";}},createNode:function(a,d){var b=document.createElement(a);if(d){b.id=d;
}b.unselectable="on";b.onselectstart=OpenLayers.Function.False;return b;},nodeTypeCompare:function(d,b){var e=b;var a=e.indexOf(":");if(a!=-1){e=e.substr(a+1);}var f=d.nodeName;a=f.indexOf(":");if(a!=-1){f=f.substr(a+1);}return(e==f);},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div");},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group");},drawPoint:function(a,b){return this.drawCircle(a,b,1);},drawCircle:function(e,f,a){if(!isNaN(f.x)&&!isNaN(f.y)){var b=this.getResolution();e.style.left=(((f.x/b-this.offset.x)|0)-a)+"px";e.style.top=(((f.y/b-this.offset.y)|0)-a)+"px";var d=a*2;e.style.width=d+"px";e.style.height=d+"px";return e;}return false;},drawLineString:function(a,b){return this.drawLine(a,b,false);},drawLinearRing:function(a,b){return this.drawLine(a,b,true);},drawLine:function(b,m,h){this.setNodeDimension(b,m);var d=this.getResolution();var a=m.components.length;var f=new Array(a);var j,o,l;for(var g=0;g<a;g++){j=m.components[g];o=(j.x/d-this.offset.x)|0;l=(j.y/d-this.offset.y)|0;f[g]=" "+o+","+l+" l ";}var e=(h)?" x e":" e";b.path="m"+f.join("")+e;return b;},drawPolygon:function(b,o){this.setNodeDimension(b,o);var d=this.getResolution();var r=[];var g,f,e,l,a,h,q,m;for(e=0,l=o.components.length;e<l;e++){g=o.components[e];r.push("m");for(f=0,a=g.components.length;f<a;f++){h=g.components[f];q=(h.x/d-this.offset.x)|0;m=(h.y/d-this.offset.y)|0;r.push(" "+q+","+m);if(f==0){r.push(" l");}}r.push(" x ");}r.push("e");b.path=r.join("");return b;},drawRectangle:function(b,d){var a=this.getResolution();b.style.left=((d.x/a-this.offset.x)|0)+"px";b.style.top=((d.y/a-this.offset.y)|0)+"px";b.style.width=((d.width/a)|0)+"px";b.style.height=((d.height/a)|0)+"px";return b;},drawText:function(e,a,j){var h=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect");var g=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");var d=this.getResolution();h.style.left=((j.x/d-this.offset.x)|0)+"px";h.style.top=((j.y/d-this.offset.y)|0)+"px";h.style.flip="y";g.innerText=a.label;if(a.fontColor){g.style.color=a.fontColor;}if(a.fontOpacity){g.style.filter="alpha(opacity="+(a.fontOpacity*100)+")";}if(a.fontFamily){g.style.fontFamily=a.fontFamily;}if(a.fontSize){g.style.fontSize=a.fontSize;}if(a.fontWeight){g.style.fontWeight=a.fontWeight;}if(a.labelSelect===true){h._featureId=e;g._featureId=e;g._geometry=j;g._geometryClass=j.CLASS_NAME;}g.style.whiteSpace="nowrap";g.inset="1px,0px,0px,0px";if(!h.parentNode){h.appendChild(g);this.textRoot.appendChild(h);}var f=a.labelAlign||"cm";if(f.length==1){f+="m";}var l=g.clientWidth*(OpenLayers.Renderer.VML.LABEL_SHIFT[f.substr(0,1)]);var b=g.clientHeight*(OpenLayers.Renderer.VML.LABEL_SHIFT[f.substr(1,1)]);h.style.left=parseInt(h.style.left)-l-1+"px";h.style.top=parseInt(h.style.top)+b+"px";},drawSurface:function(a,h){this.setNodeDimension(a,h);var b=this.getResolution();var l=[];var e,j,g;for(var d=0,f=h.components.length;d<f;d++){e=h.components[d];j=(e.x/b-this.offset.x)|0;g=(e.y/b-this.offset.y)|0;if((d%3)==0&&(d/3)==0){l.push("m");}else{if((d%3)==1){l.push(" c");}}l.push(" "+j+","+g);}l.push(" x e");a.path=l.join("");return a;},moveRoot:function(b){var a=this.map.getLayer(b.container.id);if(a instanceof OpenLayers.Layer.Vector.RootContainer){a=this.map.getLayer(this.container.id);}a&&a.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);a&&a.redraw();},importSymbol:function(e){var b=this.container.id+"-"+e;var a=this.symbolCache[b];if(a){return a;}var d=OpenLayers.Renderer.symbol[e];if(!d){throw new Error(e+" is not a valid symbol name");}var m=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var f=["m"];for(var g=0;g<d.length;g=g+2){var j=d[g];var h=d[g+1];m.left=Math.min(m.left,j);m.bottom=Math.min(m.bottom,h);m.right=Math.max(m.right,j);m.top=Math.max(m.top,h);f.push(j);f.push(h);if(g==0){f.push("l");}}f.push("x e");var o=f.join(" ");var l=(m.getWidth()-m.getHeight())/2;if(l>0){m.bottom=m.bottom-l;m.top=m.top+l;}else{m.left=m.left+l;m.right=m.right-l;}a={path:o,size:m.getWidth(),left:m.left,bottom:m.bottom};this.symbolCache[b]=a;return a;},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);},setMap:function(f){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var d=0,a=this.map.controls.length;d<a;d++){var e=this.map.controls[d];if((e!=this)&&(e.CLASS_NAME=="OpenLayers.Control.ArgParser")){if(e.displayProjection!=this.displayProjection){this.displayProjection=e.displayProjection;}break;}}if(d==this.map.controls.length){var b=OpenLayers.Util.getParameters();if(b.layers){this.layers=b.layers;this.map.events.register("addlayer",this,this.configureLayers);this.configureLayers();}if(b.lat&&b.lon){this.center=new OpenLayers.LonLat(parseFloat(b.lon),parseFloat(b.lat));if(b.zoom){this.zoom=parseInt(b.zoom);}this.map.events.register("changebaselayer",this,this.setCenter);this.setCenter();}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject());}this.map.setCenter(this.center,this.zoom);}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var d=0,a=this.layers.length;d<a;d++){var b=this.map.layers[d];var e=this.layers.charAt(d);if(e=="B"){this.map.setBaseLayer(b);}else{if((e=="T")||(e=="F")){b.setVisibility(e=="T");}}}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.LoadingPanel=OpenLayers.Class(OpenLayers.Control,{counter:0,maximized:false,visible:true,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);},setVisible:function(a){this.visible=a;if(a){OpenLayers.Element.show(this.div);}else{OpenLayers.Element.hide(this.div);}},getVisible:function(){return this.visible;},hide:function(){this.setVisible(false);},show:function(){this.setVisible(true);},toggle:function(){this.setVisible(!this.getVisible());},addLayer:function(a){if(a.layer){a.layer.events.register("loadstart",this,this.increaseCounter);a.layer.events.register("loadend",this,this.decreaseCounter);}},setMap:function(d){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("preaddlayer",this,this.addLayer);for(var b=0;b<this.map.layers.length;b++){var a=this.map.layers[b];a.events.register("loadstart",this,this.increaseCounter);a.events.register("loadend",this,this.decreaseCounter);}},increaseCounter:function(){this.counter++;if(this.counter>0){if(!this.maximized&&this.visible){this.maximizeControl();}}},decreaseCounter:function(){if(this.counter>0){this.counter--;}if(this.counter==0){if(this.maximized&&this.visible){this.minimizeControl();}}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);return this.div;},minimizeControl:function(a){this.div.style.display="none";this.div.style.width="0px";this.div.style.height="0px";this.maximized=false;if(a!=null){OpenLayers.Event.stop(a);}},maximizeControl:function(a){var e=this.map.getSize();var b=e.w;var d=e.h;this.div.style.width=b+"px";this.div.style.height=d+"px";this.div.style.display="block";this.maximized=true;if(a!=null){OpenLayers.Event.stop(a);}},destroy:function(){if(this.map){this.map.events.unregister("preaddlayer",this,this.addLayer);if(this.map.layers){for(var b=0;b<this.map.layers.length;b++){var a=this.map.layers[b];a.events.unregister("loadstart",this,this.increaseCounter);a.events.unregister("loadend",this,this.decreaseCounter);}}}OpenLayers.Control.prototype.destroy.apply(this,arguments);},CLASS_NAME:"OpenLayers.Control.LoadingPanel"});OpenLayers.Control.ScaleBar=OpenLayers.Class(OpenLayers.Control,{element:null,scale:1,displaySystem:"metric",minWidth:100,maxWidth:200,divisions:2,subdivisions:2,showMinorMeasures:false,abbreviateLabel:false,singleLine:false,align:"left",div:null,scaleText:"scale 1:",thousandsSeparator:"",measurementProperties:{english:{units:["miles","feet","inches"],abbr:["mi","ft","in"],inches:[63360,12,1]},metric:{units:["kilometers","meters","centimeters"],abbr:["km","m","cm"],inches:[39370.07874,39.370079,0.393701]}},limitedStyle:false,customStyles:null,defaultStyles:{Bar:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},BarAlt:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMajor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMinor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},NumbersBox:{height:13,width:40,top:24},LabelBox:{height:15,top:-2},LabelBoxSingleLine:{height:15,width:35,top:5,left:10}},appliedStyles:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);
if(!document.styleSheets){this.limitedStyle=true;}if(this.limitedStyle){this.appliedStyles=OpenLayers.Util.extend({},this.defaultStyles);OpenLayers.Util.extend(this.appliedStyles,this.customStyles);}this.element=document.createElement("div");this.element.style.position="relative";this.element.className=this.displayClass+"Wrapper";this.labelContainer=document.createElement("div");this.labelContainer.className=this.displayClass+"Units";this.labelContainer.style.position="absolute";this.graphicsContainer=document.createElement("div");this.graphicsContainer.style.position="absolute";this.graphicsContainer.className=this.displayClass+"Graphics";this.numbersContainer=document.createElement("div");this.numbersContainer.style.position="absolute";this.numbersContainer.className=this.displayClass+"Numbers";this.element.appendChild(this.graphicsContainer);this.element.appendChild(this.labelContainer);this.element.appendChild(this.numbersContainer);},destroy:function(){this.map.events.unregister("moveend",this,this.onMoveend);this.div.innerHTML="";OpenLayers.Control.prototype.destroy.apply(this);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.dxMarkerMajor=(this.styleValue("MarkerMajor","borderLeftWidth")+this.styleValue("MarkerMajor","width")+this.styleValue("MarkerMajor","borderRightWidth"))/2;this.dxMarkerMinor=(this.styleValue("MarkerMinor","borderLeftWidth")+this.styleValue("MarkerMinor","width")+this.styleValue("MarkerMinor","borderRightWidth"))/2;this.dxBar=(this.styleValue("Bar","borderLeftWidth")+this.styleValue("Bar","borderRightWidth"))/2;this.dxBarAlt=(this.styleValue("BarAlt","borderLeftWidth")+this.styleValue("BarAlt","borderRightWidth"))/2;this.dxNumbersBox=this.styleValue("NumbersBox","width")/2;var e=["Bar","BarAlt","MarkerMajor","MarkerMinor"];if(this.singleLine){e.push("LabelBoxSingleLine");}else{e.push("NumbersBox","LabelBox");}var a=0;for(var d=0;d<e.length;++d){var b=e[d];a=Math.max(a,this.styleValue(b,"top")+this.styleValue(b,"height"));}this.element.style.height=a+"px";this.xOffsetSingleLine=this.styleValue("LabelBoxSingleLine","width")+this.styleValue("LabelBoxSingleLine","left");this.div.appendChild(this.element);this.map.events.register("moveend",this,this.onMoveend);this.update();return this.div;},onMoveend:function(){this.update();},update:function(f){if(this.map.baseLayer==null||!this.map.getScale()){return;}this.scale=(f!=undefined)?f:this.map.getScale();this.element.title=this.scaleText+OpenLayers.Number.format(this.scale);this.element.style.width=this.maxWidth+"px";var l=this.getComp();this.setSubProps(l);this.labelContainer.innerHTML="";this.graphicsContainer.innerHTML="";this.numbersContainer.innerHTML="";var e=this.divisions*this.subdivisions;var m={left:0+(this.singleLine?0:this.dxNumbersBox),center:(this.maxWidth/2)-(e*this.subProps.pixels/2)-(this.singleLine?this.xOffsetSingleLine/2:0),right:this.maxWidth-(e*this.subProps.pixels)-(this.singleLine?this.xOffsetSingleLine:this.dxNumbersBox)};var j,a,g,r,d;for(var o=0;o<this.divisions;++o){j=o*this.subdivisions*this.subProps.pixels+m[this.align];this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",j-this.dxMarkerMajor));if(!this.singleLine){a=(o==0)?0:OpenLayers.Number.format((o*this.subdivisions)*this.subProps.length,this.subProps.dec,this.thousandsSeparator);this.numbersContainer.appendChild(this.createElement("NumbersBox",a,j-this.dxNumbersBox));}for(var h=0;h<this.subdivisions;++h){if((h%2)==0){r="Bar";d=j-this.dxBar;}else{r="BarAlt";d=j-this.dxBarAlt;}this.graphicsContainer.appendChild(this.createElement(r," ",d,this.subProps.pixels));if(h<this.subdivisions-1){g=(o*this.subdivisions)+h+1;j=g*this.subProps.pixels+m[this.align];this.graphicsContainer.appendChild(this.createElement("MarkerMinor"," ",j-this.dxMarkerMinor));if(this.showMinorMeasures&&!this.singleLine){a=g*this.subProps.length;this.numbersContainer.appendChild(this.createElement("NumbersBox",a,j-this.dxNumbersBox));}}}}j=e*this.subProps.pixels;j+=m[this.align];this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",j-this.dxMarkerMajor));a=OpenLayers.Number.format(e*this.subProps.length,this.subProps.dec,this.thousandsSeparator);if(!this.singleLine){this.numbersContainer.appendChild(this.createElement("NumbersBox",a,j-this.dxNumbersBox));}var q=document.createElement("div");q.style.position="absolute";var b;if(this.singleLine){b=a;q.className=this.displayClass+"LabelBoxSingleLine";q.style.left=Math.round(j+this.styleValue("LabelBoxSingleLine","left"))+"px";}else{b="";q.className=this.displayClass+"LabelBox";q.style.textAlign="center";q.style.width=Math.round(e*this.subProps.pixels)+"px";q.style.left=Math.round(m[this.align])+"px";q.style.overflow="hidden";}if(this.abbreviateLabel){b+=" "+this.subProps.abbr;}else{b+=" "+this.subProps.units;}q.appendChild(document.createTextNode(b));this.labelContainer.appendChild(q);},createElement:function(a,f,e,d){var b=document.createElement("div");b.className=this.displayClass+a;OpenLayers.Util.extend(b.style,{position:"absolute",textAlign:"center",overflow:"hidden",left:Math.round(e)+"px"});b.appendChild(document.createTextNode(f));if(d){b.style.width=Math.round(d)+"px";}return b;},getComp:function(){var e=this.measurementProperties[this.displaySystem];var m=e.units.length;var s=new Array(m);var r=this.divisions*this.subdivisions;for(var q=0;q<m;++q){s[q]={};var f=OpenLayers.DOTS_PER_INCH*e.inches[q]/this.scale;var t=((this.minWidth-this.dxNumbersBox)/f)/r;var a=((this.maxWidth-this.dxNumbersBox)/f)/r;for(var u=0;u<r;++u){var g=t*(u+1);var d=a*(u+1);var j=this.getHandsomeNumber(g,d);var h={value:(j.value/(u+1)),score:0,tie:0,dec:0,displayed:0};for(var v=0;v<r;++v){var w=j.value*(v+1)/(u+1);var b=this.getHandsomeNumber(w,w);var o=((v+1)%this.subdivisions==0);var l=((v+1)==r);if((this.singleLine&&l)||(!this.singleLine&&(o||this.showMinorMeasures))){h.score+=b.score;h.tie+=b.tie;h.dec=Math.max(h.dec,b.dec);h.displayed+=1;}else{h.score+=b.score/this.subdivisions;h.tie+=b.tie/this.subdivisions;}}h.score*=(q+1)*h.tie/h.displayed;s[q][u]=h;}}return s;},setSubProps:function(b){var f=this.measurementProperties[this.displaySystem];var j=Number.POSITIVE_INFINITY;var g=Number.POSITIVE_INFINITY;for(var e=0;e<b.length;++e){var a=OpenLayers.DOTS_PER_INCH*f.inches[e]/this.scale;for(var h in b[e]){var d=b[e][h];if((d.score<j)||((d.score==j)&&(d.tie<g))){this.subProps={length:d.value,pixels:a*d.value,units:f.units[e],abbr:f.abbr[e],dec:d.dec};j=d.score;g=d.tie;}}}},styleValue:function(a,j){var h=0;if(this.limitedStyle){h=this.appliedStyles[a][j];}else{a="."+this.displayClass+a;rules:for(var e=document.styleSheets.length-1;e>=0;--e){var f=document.styleSheets[e];if(!f.disabled){var l;try{if(typeof(f.cssRules)=="undefined"){if(typeof(f.rules)=="undefined"){continue;}else{l=f.rules;}}else{l=f.cssRules;}}catch(b){continue;}for(var d=0;d<l.length;++d){var g=l[d];if(g.selectorText&&(g.selectorText.toLowerCase()==a.toLowerCase())){if(g.style[j]!=""){h=parseInt(g.style[j]);break rules;}}}}}}return h?h:0;},getHandsomeNumber:function(l,h,e){e=(e==null)?10:e;var m={value:l,score:Number.POSITIVE_INFINITY,tie:Number.POSITIVE_INFINITY,dec:3};var q,o,g,j,r,d,f;for(var b=0;b<3;++b){q=Math.pow(2,(-1*b));o=Math.floor(Math.log(h/q)/Math.LN10);for(var a=o;a>(o-e+1);--a){g=Math.max(b-a,0);j=q*Math.pow(10,a);if((j*Math.floor(h/j))>=l){if(l%j==0){r=l/j;}else{r=Math.floor(l/j)+1;}d=r+(2*b);f=(a<0)?(Math.abs(a)+1):a;if((d<m.score)||((d==m.score)&&(f<m.tie))){m.value=parseFloat((j*r).toFixed(g));m.score=d;m.tie=f;m.dec=g;}}}}return m;},CLASS_NAME:"OpenLayers.Control.ScaleBar"});OpenLayers.Format.CSWGetRecords.v2_0_2_GeoNetwork=OpenLayers.Class(OpenLayers.Format.CSWGetRecords.v2_0_2,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",ows:"http://www.opengis.net/ows",geonet:"http://www.fao.org/geonetwork"},initialize:function(a){OpenLayers.Format.CSWGetRecords.v2_0_2.prototype.initialize.apply(this,[a]);
},readers:{csw:{GetRecordsResponse:function(b,d){d.records=[];this.readChildNodes(b,d);var a=this.getAttributeNS(b,"","version");if(a!=""){d.version=a;}},RequestId:function(a,b){b.RequestId=this.getChildValue(a);},SearchStatus:function(a,d){d.SearchStatus={};var b=this.getAttributeNS(a,"","timestamp");if(b!=""){d.SearchStatus.timestamp=b;}},SearchResults:function(e,f){this.readChildNodes(e,f);var b=e.attributes;var g={};for(var d=0,a=b.length;d<a;++d){if((b[d].name=="numberOfRecordsMatched")||(b[d].name=="numberOfRecordsReturned")||(b[d].name=="nextRecord")){g[b[d].name]=parseInt(b[d].nodeValue);}else{g[b[d].name]=b[d].nodeValue;}}f.SearchResults=g;},SummaryRecord:function(b,d){var a={type:"SummaryRecord"};this.readChildNodes(b,a);d.records.push(a);},BriefRecord:function(b,d){var a={type:"BriefRecord"};this.readChildNodes(b,a);d.records.push(a);},DCMIRecord:function(b,d){var a={type:"DCMIRecord"};this.readChildNodes(b,a);d.records.push(a);},Record:function(b,d){var a={type:"Record"};this.readChildNodes(b,a);d.records.push(a);},"*":function(a,e){var d=a.localName;if(!(e.geonet_info[d] instanceof Array)){e.geonet_info[d]=new Array();}var b=this.getChildValue(a);e.geonet_info[d].push(b);}},dc:{"*":function(g,h){var e=g.localName||g.nodeName.split(":").pop();if(!(h[e] instanceof Array)){h[e]=new Array();}var d={};var b=g.attributes;for(var f=0,a=b.length;f<a;++f){d[b[f].name]=b[f].nodeValue;}d.value=this.getChildValue(g);h[e].push(d);}},dct:{"*":function(b,d){var a=b.localName||b.nodeName.split(":").pop();if(!(d[a] instanceof Array)){d[a]=new Array();}d[a].push(this.getChildValue(b));}},geonet:{info:function(a,b){if(!(b.geonet_info instanceof Array)){b.geonet_info=new Array();}this.readChildNodes(a,b);}},ows:{WGS84BoundingBox:function(h,j){if(!(j.BoundingBox instanceof Array)){j.BoundingBox=new Array();}var g=this.getChildValue(this.getElementsByTagNameNS(h,this.namespaces.ows,"LowerCorner")[0]).split(" ",2);var b=this.getChildValue(this.getElementsByTagNameNS(h,this.namespaces.ows,"UpperCorner")[0]).split(" ",2);var e={value:[parseFloat(g[0]),parseFloat(g[1]),parseFloat(b[0]),parseFloat(b[1])]};var d=h.attributes;for(var f=0,a=d.length;f<a;++f){e[d[f].name]=d[f].nodeValue;}j.BoundingBox.push(e);},BoundingBox:function(a,b){this.readers.ows["WGS84BoundingBox"].apply(this,[a,b]);}}},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2_GeoNetwork"});OpenLayers.Format.GeoNetworkRecords=OpenLayers.Class(OpenLayers.Format.XML,{defaultPrefix:"nons",namespaces:{nons:"",geonet:"http://www.fao.org/geonetwork"},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a]);}if(a&&a.nodeType==9){a=a.documentElement;}var b={};this.readNode(a,b);return b;},readers:{nons:{response:function(a,b){b.records=[];this.readChildNodes(a,b);var e=this.getAttributeNS(a,"","from");if(e!=""){b.from=e;}var d=this.getAttributeNS(a,"","to");if(d!=""){b.to=d;}},summary:function(e,f){f.summary={};var b=e.attributes;for(var d=0,a=b.length;d<a;++d){f.summary[b[d].name]=b[d].nodeValue;}this.readChildNodes(e,f.summary);},metadata:function(b,d){var a={type:"metadata"};this.readChildNodes(b,a);d.records.push(a);},geoBox:function(d,g){if(!(g.BoundingBox instanceof Array)){g.BoundingBox=new Array();}var m,l,h,b;if(d.firstChild.nodeValue&&d.firstChild.nodeValue.indexOf("|")){var j=d.firstChild.nodeValue.split("|");l=j[0];m=j[1];h=j[2];b=j[3];}else{for(var a=d.firstChild;a;a=a.nextSibling){switch(a.nodeName){case"southBL":m=this.getChildValue(a);break;case"westBL":l=this.getChildValue(a);break;case"eastBL":h=this.getChildValue(a);break;case"northBL":b=this.getChildValue(a);break;}}}var f={value:[parseFloat(l),parseFloat(m),parseFloat(h),parseFloat(b)]};g.BoundingBox.push(f);},"*":function(f,j){var d=f.localName||f.nodeName.split(":").pop();var h=f.parentNode.localName||f.parentNode.nodeName.split(":").pop();var g={};g.value=this.getChildValue(f);if(h=="info"){if(!(j.geonet_info[d] instanceof Array)){j.geonet_info[d]=new Array();}j.geonet_info[d].push(g);if(d=="harvestInfo"||d=="valid_details"){this.readChildNodes(f,j.geonet_info[d]);}}else{if(!(j[d] instanceof Array)){j[d]=new Array();}var b=f.attributes;for(var e=0,a=b.length;e<a;++e){g[b[e].name]=b[e].nodeValue;}j[d].push(g);this.readChildNodes(f,j[d]);}}},geonet:{info:function(a,b){if(!(b.geonet_info instanceof Array)){b.geonet_info=new Array();}this.readChildNodes(a,b);}}},CLASS_NAME:"OpenLayers.Format.GeoNetworkRecords"});(function(){var a=function(d,b){return function(e){if(b&&b[d]){b[d].call(b.scope||window,{responseText:e.responseText,responseXML:e.responseXML,argument:b.argument});}};};Ext.apply(Ext.lib.Ajax,{request:function(h,f,b,g,d){d=d||{};h=h||d.method;var e=d.headers;if(d.xmlData){if(!e||!e["Content-Type"]){e=e||{};e["Content-Type"]="text/xml";}h=h||"POST";g=d.xmlData;}else{if(d.jsonData){if(!e||!e["Content-Type"]){e=e||{};e["Content-Type"]="application/json";}h=h||"POST";g=typeof d.jsonData=="object"?Ext.encode(d.jsonData):d.jsonData;}}if((h&&h.toLowerCase()=="post")&&(d.form||d.params)&&(!e||!e["Content-Type"])){e=e||{};e["Content-Type"]="application/x-www-form-urlencoded";}return OpenLayers.Request.issue({success:a("success",b),failure:a("failure",b),method:h,headers:e,data:g,url:f});},isCallInProgress:function(b){return true;},abort:function(b){b.abort();}});})();Ext.namespace("GeoExt");GeoExt.singleFile=true;(function(){var l=(typeof GeoExt=="object"&&GeoExt.singleFile);var a=l?"GeoExt.js":"lib/GeoExt.js";var m=function(){var w="";var s=document.documentElement.getElementsByTagName("script");for(var u=0,h=s.length;u<h;u++){var z=s[u].getAttribute("src");if(z){var t=z.lastIndexOf(a);var v=z.lastIndexOf("?");if(v<0){v=z.length;}if((t>-1)&&(t+a.length==v)){w=z.slice(0,v-a.length);break;}}}return w;};if(!l){var o=new Array("GeoExt/data/AttributeReader.js","GeoExt/data/AttributeStore.js","GeoExt/data/FeatureRecord.js","GeoExt/data/FeatureReader.js","GeoExt/data/FeatureStore.js","GeoExt/data/LayerRecord.js","GeoExt/data/LayerReader.js","GeoExt/data/LayerStore.js","GeoExt/data/ScaleStore.js","GeoExt/data/WMSCapabilitiesReader.js","GeoExt/data/WMSCapabilitiesStore.js","GeoExt/data/WFSCapabilitiesReader.js","GeoExt/data/WFSCapabilitiesStore.js","GeoExt/data/WMSDescribeLayerReader.js","GeoExt/data/WMSDescribeLayerStore.js","GeoExt/data/WMCReader.js","GeoExt/widgets/Action.js","GeoExt/data/ProtocolProxy.js","GeoExt/widgets/FeatureRenderer.js","GeoExt/widgets/MapPanel.js","GeoExt/widgets/Popup.js","GeoExt/widgets/form.js","GeoExt/widgets/form/SearchAction.js","GeoExt/widgets/form/BasicForm.js","GeoExt/widgets/form/FormPanel.js","GeoExt/widgets/tips/SliderTip.js","GeoExt/widgets/tips/LayerOpacitySliderTip.js","GeoExt/widgets/tips/ZoomSliderTip.js","GeoExt/widgets/tree/LayerNode.js","GeoExt/widgets/tree/TreeNodeUIEventMixin.js","GeoExt/plugins/TreeNodeComponent.js","GeoExt/plugins/TreeNodeRadioButton.js","GeoExt/widgets/tree/LayerLoader.js","GeoExt/widgets/tree/LayerContainer.js","GeoExt/widgets/tree/BaseLayerContainer.js","GeoExt/widgets/tree/OverlayLayerContainer.js","GeoExt/widgets/tree/LayerParamNode.js","GeoExt/widgets/tree/LayerParamLoader.js","GeoExt/widgets/tree/WMSCapabilitiesLoader.js","GeoExt/widgets/LayerOpacitySlider.js","GeoExt/widgets/LayerLegend.js","GeoExt/widgets/LegendImage.js","GeoExt/widgets/UrlLegend.js","GeoExt/widgets/WMSLegend.js","GeoExt/widgets/VectorLegend.js","GeoExt/widgets/LegendPanel.js","GeoExt/widgets/ZoomSlider.js","GeoExt/widgets/grid/FeatureSelectionModel.js","GeoExt/data/PrintPage.js","GeoExt/data/PrintProvider.js","GeoExt/plugins/PrintPageField.js","GeoExt/plugins/PrintProviderField.js","GeoExt/plugins/PrintExtent.js","GeoExt/plugins/AttributeForm.js","GeoExt/widgets/PrintMapPanel.js","GeoExt/state/PermalinkProvider.js");var d=navigator.userAgent;var f=(d.match("MSIE")||d.match("Safari"));if(f){var b=new Array(o.length);}var q=m()+"lib/";for(var e=0,j=o.length;e<j;e++){if(f){b[e]="<script src='"+q+o[e]+"'><\/script>";
}else{var r=document.createElement("script");r.src=q+o[e];var g=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;g.appendChild(r);}}if(f){document.write(b.join(""));}}})();Ext.namespace("GeoExt.data");GeoExt.data.AttributeReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WFSDescribeFeatureType();}GeoExt.data.AttributeReader.superclass.constructor.call(this,a,b||a.fields);if(a.feature){this.recordType.prototype.fields.add(new Ext.data.Field("value"));}};Ext.extend(GeoExt.data.AttributeReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText;}return this.readRecords(b);},readRecords:function(l){var f;if(l instanceof Array){f=l;}else{f=this.meta.format.read(l).featureTypes[0].properties;}var v=this.meta.feature;var d=this.recordType;var o=d.prototype.fields;var g=o.length;var r,u,a,m,s,t,b=[];for(var h=0,q=f.length;h<q;++h){s=false;r=f[h];u={};for(var e=0;e<g;++e){a=o.items[e].name;t=r[a];if(this.ignoreAttribute(a,t)){s=true;break;}u[a]=t;}if(v){t=v.attributes[u.name];if(t!==undefined){if(this.ignoreAttribute("value",t)){s=true;}else{u.value=t;}}}if(!s){b[b.length]=new d(u);}}return{success:true,records:b,totalRecords:b.length};},ignoreAttribute:function(a,d){var e=false;if(this.meta.ignore&&this.meta.ignore[a]){var b=this.meta.ignore[a];if(typeof b=="string"){e=(b===d);}else{if(b instanceof Array){e=(b.indexOf(d)>-1);}else{if(b instanceof RegExp){e=(b.test(d));}}}}return e;}});Ext.namespace("GeoExt.data");GeoExt.data.AttributeStoreMixin=function(){return{constructor:function(a){a=a||{};arguments.callee.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.AttributeReader(a,a.fields||["name","type","restriction"])}));if(this.feature){this.bind();}},bind:function(){this.on({update:this.onUpdate,load:this.onLoad,add:this.onAdd,scope:this});var a=[];this.each(function(b){a.push(b);});this.updateFeature(a);},onUpdate:function(d,a,b){this.updateFeature([a]);},onLoad:function(b,a,d){if(!d||d.add!==true){this.updateFeature(a);}},onAdd:function(b,a,d){this.updateFeature(a);},updateFeature:function(e){var m=this.feature,h=m.layer;var f,j,g,d,l,a,b;for(f=0,j=e.length;f<j;f++){g=e[f];d=g.get("name");l=g.get("value");a=m.attributes[d];if(a!==l){b=true;}}if(b&&h&&h.events&&h.events.triggerEvent("beforefeaturemodified",{feature:m})!==false){for(f=0,j=e.length;f<j;f++){g=e[f];d=g.get("name");l=g.get("value");m.attributes[d]=l;}h.events.triggerEvent("featuremodified",{feature:m});h.drawFeature(m);}}};};GeoExt.data.AttributeStore=Ext.extend(Ext.data.Store,GeoExt.data.AttributeStoreMixin());Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.FeatureReader=function(a,b){a=a||{};if(!(b instanceof Function)){b=GeoExt.data.FeatureRecord.create(b||a.fields||{});}GeoExt.data.FeatureReader.superclass.constructor.call(this,a,b);};Ext.extend(GeoExt.data.FeatureReader,Ext.data.DataReader,{totalRecords:null,read:function(a){return this.readRecords(a.features);},readRecords:function(b){var d=[];if(b){var g=this.recordType,o=g.prototype.fields;var m,h,l,f,u,t,r,s;for(m=0,h=b.length;m<h;m++){u=b[m];t={};if(u.attributes){for(l=0,f=o.length;l<f;l++){r=o.items[l];if(/[\[\.]/.test(r.mapping)){try{s=new Function("obj","return obj."+r.mapping)(u.attributes);}catch(q){s=r.defaultValue;}}else{s=u.attributes[r.mapping||r.name]||r.defaultValue;}if(r.convert){s=r.convert(s);}t[r.name]=s;}}t.feature=u;t.state=u.state;t.fid=u.fid;var a=(u.state===OpenLayers.State.INSERT)?undefined:u.id;d[d.length]=new g(t,a);}}return{records:d,totalRecords:this.totalRecords!=null?this.totalRecords:d.length};}});Ext.namespace("GeoExt.data");GeoExt.data.FeatureStoreMixin=function(){return{layer:null,reader:null,featureFilter:null,constructor:function(b){b=b||{};b.reader=b.reader||new GeoExt.data.FeatureReader({},b.fields);var d=b.layer;delete b.layer;if(b.features){b.data=b.features;}delete b.features;var a={initDir:b.initDir};delete b.initDir;arguments.callee.superclass.constructor.call(this,b);if(d){this.bind(d,a);}},bind:function(e,b){if(this.layer){return;}this.layer=e;b=b||{};var g=b.initDir;if(b.initDir==undefined){g=GeoExt.data.FeatureStore.LAYER_TO_STORE|GeoExt.data.FeatureStore.STORE_TO_LAYER;}var f=e.features.slice(0);if(g&GeoExt.data.FeatureStore.STORE_TO_LAYER){var a=this.getRange();for(var d=a.length-1;d>=0;d--){this.layer.addFeatures([a[d].getFeature()]);}}if(g&GeoExt.data.FeatureStore.LAYER_TO_STORE){this.loadData(f,true);}e.events.on({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this});},unbind:function(){if(this.layer){this.layer.events.un({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});this.un("load",this.onLoad,this);this.un("clear",this.onClear,this);this.un("add",this.onAdd,this);this.un("remove",this.onRemove,this);this.un("update",this.onUpdate,this);this.layer=null;}},getRecordFromFeature:function(d){var a=null;if(d.state!==OpenLayers.State.INSERT){a=this.getById(d.id);}else{var b=this.findBy(function(e){return e.getFeature()===d;});if(b>-1){a=this.getAt(b);}}return a;},onFeaturesAdded:function(b){if(!this._adding){var g=b.features,f=g;if(this.featureFilter){f=[];var e,a,d;for(var e=0,a=g.length;e<a;e++){d=g[e];if(this.featureFilter.evaluate(d)!==false){f.push(d);}}}this._adding=true;this.loadData(f,true);delete this._adding;}},onFeaturesRemoved:function(b){if(!this._removing){var f=b.features,e,a,d;for(d=f.length-1;d>=0;d--){e=f[d];a=this.getRecordFromFeature(e);if(a!==undefined){this._removing=true;this.remove(a);delete this._removing;}}}},onFeatureModified:function(j){if(!this._updating){var l=j.feature;var d=this.getRecordFromFeature(l);if(d!==undefined){d.beginEdit();var a=l.attributes;if(a){var e=this.recordType.prototype.fields;for(var b=0,f=e.length;b<f;b++){var g=e.items[b];var h=g.mapping||g.name;if(h in a){d.set(g.name,g.convert(a[h]));}}}d.set("state",l.state);d.set("fid",l.fid);d.setFeature(l);this._updating=true;d.endEdit();delete this._updating;}}},addFeaturesToLayer:function(b){var d,a,e;e=new Array((a=b.length));for(d=0;d<a;d++){e[d]=b[d].getFeature();}if(e.length>0){this._adding=true;this.layer.addFeatures(e);delete this._adding;}},onLoad:function(b,a,d){if(!d||d.add!==true){this._removing=true;this.layer.removeFeatures(this.layer.features);delete this._removing;this.addFeaturesToLayer(a);}},onClear:function(a){this._removing=true;this.layer.removeFeatures(this.layer.features);delete this._removing;},onAdd:function(b,a,d){if(!this._adding){this.addFeaturesToLayer(a);}},onRemove:function(b,a,d){if(!this._removing){var e=a.getFeature();if(this.layer.getFeatureById(e.id)!=null){this._removing=true;this.layer.removeFeatures([a.getFeature()]);delete this._removing;}}},onUpdate:function(f,b,e){if(!this._updating){var h=new GeoExt.data.FeatureRecord().fields;var g=b.getFeature();if(b.fields){var a=this.layer.events.triggerEvent("beforefeaturemodified",{feature:g});if(a!==false){var d=g.attributes;b.fields.each(function(l){var j=l.mapping||l.name;if(!h.containsKey(j)){d[j]=b.get(l.name);}});this._updating=true;this.layer.events.triggerEvent("featuremodified",{feature:g});delete this._updating;if(this.layer.getFeatureById(g.id)!=null){this.layer.drawFeature(g);}}}}}};};GeoExt.data.FeatureStore=Ext.extend(Ext.data.Store,new GeoExt.data.FeatureStoreMixin);GeoExt.data.FeatureStore.LAYER_TO_STORE=1;GeoExt.data.FeatureStore.STORE_TO_LAYER=2;Ext.namespace("GeoExt.data");GeoExt.data.LayerRecord=Ext.data.Record.create([{name:"layer"},{name:"title",type:"string",mapping:"name"}]);GeoExt.data.LayerRecord.prototype.getLayer=function(){return this.get("layer");};GeoExt.data.LayerRecord.prototype.setLayer=function(a){if(a!==this.data.layer){this.dirty=true;
if(!this.modified){this.modified={};}if(this.modified.layer===undefined){this.modified.layer=this.data.layer;}this.data.layer=a;if(!this.editing){this.afterEdit();}}};GeoExt.data.LayerRecord.prototype.clone=function(b){var a=this.getLayer()&&this.getLayer().clone();return new this.constructor(Ext.applyIf({layer:a},this.data),b||a.id);};GeoExt.data.LayerRecord.create=function(g){var d=Ext.extend(GeoExt.data.LayerRecord,{});var e=d.prototype;e.fields=new Ext.util.MixedCollection(false,function(f){return f.name;});GeoExt.data.LayerRecord.prototype.fields.each(function(h){e.fields.add(h);});if(g){for(var b=0,a=g.length;b<a;b++){e.fields.add(new Ext.data.Field(g[b]));}}d.getField=function(f){return e.fields.get(f);};return d;};Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.LayerReader=function(a,b){a=a||{};if(!(b instanceof Function)){b=GeoExt.data.LayerRecord.create(b||a.fields||{});}GeoExt.data.LayerReader.superclass.constructor.call(this,a,b);};Ext.extend(GeoExt.data.LayerReader,Ext.data.DataReader,{totalRecords:null,readRecords:function(g){var a=[];if(g){var d=this.recordType,m=d.prototype.fields;var h,e,f,b,l,r,o,q;for(h=0,e=g.length;h<e;h++){l=g[h];r={};for(f=0,b=m.length;f<b;f++){o=m.items[f];q=l[o.mapping||o.name]||o.defaultValue;q=o.convert(q);r[o.name]=q;}r.layer=l;a[a.length]=new d(r,l.id);}}return{records:a,totalRecords:this.totalRecords!=null?this.totalRecords:a.length};}});Ext.namespace("GeoExt.data");GeoExt.data.LayerStoreMixin=function(){return{map:null,reader:null,constructor:function(b){b=b||{};b.reader=b.reader||new GeoExt.data.LayerReader({},b.fields);delete b.fields;var d=b.map instanceof GeoExt.MapPanel?b.map.map:b.map;delete b.map;if(b.layers){b.data=b.layers;}delete b.layers;var a={initDir:b.initDir};delete b.initDir;arguments.callee.superclass.constructor.call(this,b);if(d){this.bind(d,a);}},bind:function(e,a){if(this.map){return;}this.map=e;a=a||{};var b=a.initDir;if(a.initDir==undefined){b=GeoExt.data.LayerStore.MAP_TO_STORE|GeoExt.data.LayerStore.STORE_TO_MAP;}var d=e.layers.slice(0);if(b&GeoExt.data.LayerStore.STORE_TO_MAP){this.each(function(f){this.map.addLayer(f.getLayer());},this);}if(b&GeoExt.data.LayerStore.MAP_TO_STORE){this.loadData(d,true);}e.events.on({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this});this.data.on({replace:this.onReplace,scope:this});},unbind:function(){if(this.map){this.map.events.un({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});this.un("load",this.onLoad,this);this.un("clear",this.onClear,this);this.un("add",this.onAdd,this);this.un("remove",this.onRemove,this);this.data.un("replace",this.onReplace,this);this.map=null;}},onChangeLayer:function(b){var f=b.layer;var d=this.findBy(function(g,h){return g.getLayer()===f;});if(d>-1){var a=this.getAt(d);if(b.property==="order"){if(!this._adding&&!this._removing){var e=this.map.getLayerIndex(f);if(e!==d){this._removing=true;this.remove(a);delete this._removing;this._adding=true;this.insert(e,[a]);delete this._adding;}}}else{if(b.property==="name"){a.set("title",f.name);}else{this.fireEvent("update",this,a,Ext.data.Record.EDIT);}}}},onAddLayer:function(a){if(!this._adding){var b=a.layer;this._adding=true;this.loadData([b],true);delete this._adding;}},onRemoveLayer:function(a){if(this.map.unloadDestroy){if(!this._removing){var b=a.layer;this._removing=true;this.remove(this.getById(b.id));delete this._removing;}}else{this.unbind();}},onLoad:function(d,b,f){if(!Ext.isArray(b)){b=[b];}if(f&&!f.add){this._removing=true;for(var g=this.map.layers.length-1;g>=0;g--){this.map.removeLayer(this.map.layers[g]);}delete this._removing;var a=b.length;if(a>0){var h=new Array(a);for(var e=0;e<a;e++){h[e]=b[e].getLayer();}this._adding=true;this.map.addLayers(h);delete this._adding;}}},onClear:function(a){this._removing=true;for(var b=this.map.layers.length-1;b>=0;b--){this.map.removeLayer(this.map.layers[b]);}delete this._removing;},onAdd:function(b,a,d){if(!this._adding){this._adding=true;var f;for(var e=a.length-1;e>=0;--e){f=a[e].getLayer();this.map.addLayer(f);if(d!==this.map.layers.length-1){this.map.setLayerIndex(f,d);}}delete this._adding;}},onRemove:function(b,a,d){if(!this._removing){var e=a.getLayer();if(this.map.getLayer(e.id)!=null){this._removing=true;this.removeMapLayer(a);delete this._removing;}}},onUpdate:function(d,a,b){if(b===Ext.data.Record.EDIT){if(a.modified&&a.modified.title){var e=a.getLayer();var f=a.get("title");if(f!==e.name){e.setName(f);}}}},removeMapLayer:function(a){this.map.removeLayer(a.getLayer());},onReplace:function(d,a,b){this.removeMapLayer(a);},getByLayer:function(b){var a=this.findBy(function(d){return d.getLayer()===b;});if(a>-1){return this.getAt(a);}},destroy:function(){this.unbind();GeoExt.data.LayerStore.superclass.destroy.call(this);}};};GeoExt.data.LayerStore=Ext.extend(Ext.data.Store,new GeoExt.data.LayerStoreMixin);GeoExt.data.LayerStore.MAP_TO_STORE=1;GeoExt.data.LayerStore.STORE_TO_MAP=2;Ext.namespace("GeoExt.data");GeoExt.data.ScaleStore=Ext.extend(Ext.data.Store,{map:null,constructor:function(a){var b=(a.map instanceof GeoExt.MapPanel?a.map.map:a.map);delete a.map;a=Ext.applyIf(a,{reader:new Ext.data.JsonReader({},["level","resolution","scale"])});GeoExt.data.ScaleStore.superclass.constructor.call(this,a);if(b){this.bind(b);}},bind:function(b,a){this.map=(b instanceof GeoExt.MapPanel?b.map:b);this.map.events.register("changebaselayer",this,this.populateFromMap);if(this.map.baseLayer){this.populateFromMap();}else{this.map.events.register("addlayer",this,this.populateOnAdd);}},unbind:function(){if(this.map){this.map.events.unregister("addlayer",this,this.populateOnAdd);this.map.events.unregister("changebaselayer",this,this.populateFromMap);delete this.map;}},populateOnAdd:function(a){if(a.layer.isBaseLayer){this.populateFromMap();this.map.events.unregister("addlayer",this,this.populateOnAdd);}},populateFromMap:function(){var d=[];var a=this.map.baseLayer.resolutions;var b=this.map.baseLayer.units;for(var f=a.length-1;f>=0;f--){var e=a[f];d.push({level:f,resolution:e,scale:OpenLayers.Util.getScaleFromResolution(e,b)});}this.loadData(d);},destroy:function(){this.unbind();GeoExt.data.ScaleStore.superclass.destroy.apply(this,arguments);}});Ext.namespace("GeoExt.data");GeoExt.data.PrintProvider=Ext.extend(Ext.util.Observable,{url:null,capabilities:null,method:"POST",customParams:null,scales:null,dpis:null,layouts:null,dpi:null,layout:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);if(!this.customParams){this.customParams={};}this.addEvents("loadcapabilities","layoutchange","dpichange","beforeprint","print","printexception","beforeencodelayer","encodelayer");GeoExt.data.PrintProvider.superclass.constructor.apply(this,arguments);this.scales=new Ext.data.JsonStore({root:"scales",sortInfo:{field:"value",direction:"DESC"},fields:["name",{name:"value",type:"float"}]});this.dpis=new Ext.data.JsonStore({root:"dpis",fields:["name",{name:"value",type:"float"}]});this.layouts=new Ext.data.JsonStore({root:"layouts",fields:["name",{name:"size",mapping:"map"},{name:"rotation",type:"boolean"}]});if(a.capabilities){this.loadStores();}else{if(this.url.split("/").pop()){this.url+="/";}this.initialConfig.autoLoad&&this.loadCapabilities();}},setLayout:function(a){this.layout=a;this.fireEvent("layoutchange",this,a);},setDpi:function(a){this.dpi=a;this.fireEvent("dpichange",this,a);},print:function(d,e,q){if(d instanceof GeoExt.MapPanel){d=d.map;}e=e instanceof Array?e:[e];q=q||{};if(this.fireEvent("beforeprint",this,d,e,q)===false){return;}var h=Ext.apply({units:d.getUnits(),srs:d.baseLayer.projection.getCode(),layout:this.layout.get("name"),dpi:this.dpi.get("value")},this.customParams);var o=e[0].feature.layer;var m=[];Ext.each(d.layers,function(s){if(s!==o&&s.getVisibility()===true){var r=this.encodeLayer(s);r&&m.push(r);
}},this);h.layers=m;var g=[];Ext.each(e,function(r){g.push(Ext.apply({center:[r.center.lon,r.center.lat],scale:r.scale.get("value"),rotation:r.rotation},r.customParams));},this);h.pages=g;if(q.overview){var l=[];Ext.each(q.overview.layers,function(s){var r=this.encodeLayer(s);r&&l.push(r);},this);h.overviewLayers=l;}if(q.legend){var j=q.legend;var f=j.rendered;if(!f){j=j.cloneConfig({renderTo:document.body,hidden:true});}var b=[];j.items.each(function(r){if(!r.hidden){var s=this.encoders.legends[r.getXType()];b=b.concat(s.call(this,r));}},this);if(!f){j.destroy();}h.legends=b;}if(this.method==="GET"){var a=Ext.urlAppend(this.capabilities.printURL,"spec="+encodeURIComponent(Ext.encode(h)));window.open(a);this.fireEvent("print",this,a);}else{Ext.Ajax.request({url:this.capabilities.createURL,jsonData:h,success:function(r){var s=Ext.decode(r.responseText).getURL+(Ext.isIE?"?inline=true":"");if(Ext.isOpera||Ext.isIE){window.open(s);}else{window.location.href=s;}this.fireEvent("print",this,s);},failure:function(r){this.fireEvent("printexception",this,r);},params:this.initialConfig.baseParams,scope:this});}},loadCapabilities:function(){if(!this.url){return;}var a=this.url+"info.json";Ext.Ajax.request({url:a,method:"GET",disableCaching:false,success:function(b){this.capabilities=Ext.decode(b.responseText);this.loadStores();},params:this.initialConfig.baseParams,scope:this});},loadStores:function(){this.scales.loadData(this.capabilities);this.dpis.loadData(this.capabilities);this.layouts.loadData(this.capabilities);this.setLayout(this.layouts.getAt(0));this.setDpi(this.dpis.getAt(0));this.fireEvent("loadcapabilities",this,this.capabilities);},encodeLayer:function(a){var b;for(var d in this.encoders.layers){if(OpenLayers.Layer[d]&&a instanceof OpenLayers.Layer[d]){if(this.fireEvent("beforeencodelayer",this,a)===false){return;}b=this.encoders.layers[d].call(this,a);this.fireEvent("encodelayer",this,a,b);break;}}return(b&&b.type)?b:null;},getAbsoluteUrl:function(d){var b;if(Ext.isIE){b=document.createElement("<a href='"+d+"'/>");b.style.display="none";document.body.appendChild(b);b.href=b.href;document.body.removeChild(b);}else{b=document.createElement("a");b.href=d;}return b.href;},encoders:{layers:{WMS:function(b){var a=this.encoders.layers.HTTPRequest.call(this,b);Ext.apply(a,{type:"WMS",layers:[b.params.LAYERS].join(",").split(","),format:b.params.FORMAT,styles:[b.params.STYLES].join(",").split(",")});var e;for(var d in b.params){e=d.toLowerCase();if(!b.DEFAULT_PARAMS[e]&&"layers,styles,width,height,srs".indexOf(e)==-1){if(!a.customParams){a.customParams={};}a.customParams[d]=b.params[d];}}return a;},OSM:function(b){var a=this.encoders.layers.TileCache.call(this,b);return Ext.apply(a,{type:"OSM",baseURL:a.baseURL.substr(0,a.baseURL.indexOf("$")),extension:"png"});},TMS:function(b){var a=this.encoders.layers.TileCache.call(this,b);return Ext.apply(a,{type:"TMS",format:b.type});},TileCache:function(b){var a=this.encoders.layers.HTTPRequest.call(this,b);return Ext.apply(a,{type:"TileCache",layer:b.layername,maxExtent:b.maxExtent.toArray(),tileSize:[b.tileSize.w,b.tileSize.h],extension:b.extension,resolutions:b.serverResolutions||b.resolutions});},KaMapCache:function(b){var a=this.encoders.layers.KaMap.call(this,b);return Ext.apply(a,{type:"KaMapCache",group:b.params.g,metaTileWidth:b.params.metaTileSize["w"],metaTileHeight:b.params.metaTileSize["h"]});},KaMap:function(b){var a=this.encoders.layers.HTTPRequest.call(this,b);return Ext.apply(a,{type:"KaMap",map:b.params.map,extension:b.params.i,group:b.params.g||"",maxExtent:b.maxExtent.toArray(),tileSize:[b.tileSize.w,b.tileSize.h],resolutions:b.serverResolutions||b.resolutions});},HTTPRequest:function(a){return{baseURL:this.getAbsoluteUrl(a.url instanceof Array?a.url[0]:a.url),opacity:(a.opacity!=null)?a.opacity:1,singleTile:a.singleTile};},Image:function(a){return{type:"Image",baseURL:this.getAbsoluteUrl(a.getURL(a.extent)),opacity:(a.opacity!=null)?a.opacity:1,extent:a.extent.toArray(),pixelSize:[a.size.w,a.size.h],name:a.name};},Vector:function(q){if(!q.features.length){return;}var o=[];var s={};var d=q.features;var t=new OpenLayers.Format.GeoJSON();var e=new OpenLayers.Format.JSON();var b=1;var l={};var u,a,j,m,f;for(var h=0,r=d.length;h<r;++h){u=d[h];a=u.style||q.style||q.styleMap.createSymbolizer(u,u.renderIntent);j=e.write(a);m=l[j];if(m){f=m;}else{l[j]=f=b++;if(a.externalGraphic){s[f]=Ext.applyIf({externalGraphic:this.getAbsoluteUrl(a.externalGraphic)},a);}else{s[f]=a;}}var g=t.extract.feature.call(t,u);g.properties=OpenLayers.Util.extend({_gx_style:f},g.properties);o.push(g);}return{type:"Vector",styles:s,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:o},name:q.name,opacity:(q.opacity!=null)?q.opacity:1};}},legends:{gx_wmslegend:function(f){var b=this.encoders.legends.base.call(this,f);var e=[];for(var d=1,a=f.items.getCount();d<a;++d){e.push(this.getAbsoluteUrl(f.items.get(d).url));}b[0].classes[0]={name:"",icons:e};return b;},gx_urllegend:function(b){var a=this.encoders.legends.base.call(this,b);a[0].classes.push({name:"",icon:this.getAbsoluteUrl(b.items.get(1).url)});return a;},base:function(a){return[{name:a.items.get(0).text,classes:[]}];}}}});Ext.namespace("GeoExt.data");GeoExt.data.PrintPage=Ext.extend(Ext.util.Observable,{printProvider:null,feature:null,center:null,scale:null,rotation:0,customParams:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);if(!this.customParams){this.customParams={};}this.addEvents("change");GeoExt.data.PrintPage.superclass.constructor.apply(this,arguments);this.feature=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POLYGON((-1 -1,1 -1,1 1,-1 1,-1 -1))"));if(this.printProvider.capabilities){this.setScale(this.printProvider.scales.getAt(0));}else{this.printProvider.on({loadcapabilities:function(){this.setScale(this.printProvider.scales.getAt(0));},scope:this,single:true});}this.printProvider.on({layoutchange:this.onLayoutChange,scope:this});},getPrintExtent:function(a){a=a instanceof GeoExt.MapPanel?a.map:a;return this.calculatePageBounds(this.scale,a.getUnits());},setScale:function(f,a){var e=this.calculatePageBounds(f,a);var d=e.toGeometry();var b=this.rotation;if(b!=0){d.rotate(-b,d.getCentroid());}this.updateFeature(d,{scale:f});},setCenter:function(a){var e=this.feature.geometry;var f=e.getBounds().getCenterLonLat();var d=a.lon-f.lon;var b=a.lat-f.lat;e.move(d,b);this.updateFeature(e,{center:a});},setRotation:function(b,d){if(d||this.printProvider.layout.get("rotation")===true){var a=this.feature.geometry;a.rotate(this.rotation-b,a.getCentroid());this.updateFeature(a,{rotation:b});}},fit:function(j,m){m=m||{};var b=j,l;if(j instanceof GeoExt.MapPanel){b=j.map;}else{if(j instanceof OpenLayers.Feature.Vector){b=j.layer.map;l=j.geometry.getBounds();}}if(!l){l=b.getExtent();if(!l){return;}}this._updating=true;var a=l.getCenterLonLat();this.setCenter(a);var h=b.getUnits();var e=this.printProvider.scales.getAt(0);var d=Number.POSITIVE_INFINITY;var f=l.getWidth();var g=l.getHeight();this.printProvider.scales.each(function(s){var q=this.calculatePageBounds(s,h);if(m.mode=="closest"){var r=Math.abs(q.getWidth()-f)+Math.abs(q.getHeight()-g);if(r<d){d=r;e=s;}}else{var o=m.mode=="screen"?!l.containsBounds(q):q.containsBounds(l);if(o||(m.mode=="screen"&&!o)){e=s;}return o;}},this);this.setScale(e,h);delete this._updating;this.updateFeature(this.feature.geometry,{center:a,scale:e});},updateFeature:function(g,b){var e=this.feature;var a=e.geometry!==g;g.id=e.geometry.id;e.geometry=g;if(!this._updating){for(var d in b){if(b[d]===this[d]){delete b[d];}else{this[d]=b[d];a=true;}}Ext.apply(this,b);e.layer&&e.layer.drawFeature(e);a&&this.fireEvent("change",this,b);}},calculatePageBounds:function(b,j){var o=b.get("value");var g=this.feature;var l=this.feature.geometry;var a=l.getBounds().getCenterLonLat();var q=this.printProvider.layout.get("size");var j=j||(g.layer&&g.layer.map&&g.layer.map.getUnits())||"dd";var e=OpenLayers.INCHES_PER_UNIT[j];
var m=q.width/72/e*o/2;var d=q.height/72/e*o/2;return new OpenLayers.Bounds(a.lon-m,a.lat-d,a.lon+m,a.lat+d);},onLayoutChange:function(){if(this.printProvider.layout.get("rotation")===false){this.setRotation(0,true);}this.scale&&this.setScale(this.scale);},destroy:function(){this.printProvider.un("layoutchange",this.onLayoutChange,this);}});Ext.namespace("GeoExt.data");GeoExt.data.WMSCapabilitiesReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WMSCapabilities();}if(typeof b!=="function"){b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"queryable",type:"boolean"},{name:"opaque",type:"boolean"},{name:"noSubsets",type:"boolean"},{name:"cascaded",type:"int"},{name:"fixedWidth",type:"int"},{name:"fixedHeight",type:"int"},{name:"minScale",type:"float"},{name:"maxScale",type:"float"},{name:"prefix",type:"string"},{name:"formats"},{name:"styles"},{name:"srs"},{name:"dimensions"},{name:"bbox"},{name:"llbbox"},{name:"attribution"},{name:"keywords"},{name:"identifiers"},{name:"authorityURLs"},{name:"metadataURLs"}]);}GeoExt.data.WMSCapabilitiesReader.superclass.constructor.call(this,a,b);};Ext.extend(GeoExt.data.WMSCapabilitiesReader,Ext.data.DataReader,{attributionCls:"gx-attribution",read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText;}return this.readRecords(b);},serviceExceptionFormat:function(a){if(OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_inimage")>-1){return"application/vnd.ogc.se_inimage";}if(OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_xml")>-1){return"application/vnd.ogc.se_xml";}return a[0];},imageFormat:function(b){var a=b.formats;if(b.opaque&&OpenLayers.Util.indexOf(a,"image/jpeg")>-1){return"image/jpeg";}if(OpenLayers.Util.indexOf(a,"image/png")>-1){return"image/png";}if(OpenLayers.Util.indexOf(a,"image/png; mode=24bit")>-1){return"image/png; mode=24bit";}if(OpenLayers.Util.indexOf(a,"image/gif")>-1){return"image/gif";}return a[0];},imageTransparent:function(a){return a.opaque==undefined||!a.opaque;},readRecords:function(C){if(typeof C==="string"||C.nodeType){C=this.meta.format.read(C);}var f=C.version;var d=C.capability||{};var g=d.request&&d.request.getmap&&d.request.getmap.href;var l=d.layers;var h=d.exception?d.exception.formats:[];var t=this.serviceExceptionFormat(h);var s=[];if(g&&l){var o=this.recordType.prototype.fields;var B,b,e,z,a,m;for(var r=0,w=l.length;r<w;r++){B=l[r];if(B.name){b={};for(var q=0,u=o.length;q<u;q++){a=o.items[q];m=B[a.mapping||a.name]||a.defaultValue;m=a.convert(m);b[a.name]=m;}e={attribution:B.attribution?this.attributionMarkup(B.attribution):undefined,minScale:B.minScale,maxScale:B.maxScale};if(this.meta.layerOptions){Ext.apply(e,this.meta.layerOptions);}z={layers:B.name,exceptions:t,format:this.imageFormat(B),transparent:this.imageTransparent(B),version:f};if(this.meta.layerParams){Ext.apply(z,this.meta.layerParams);}b.layer=new OpenLayers.Layer.WMS(B.title||B.name,g,z,e);s.push(new this.recordType(b,b.layer.id));}}}return{totalRecords:s.length,success:true,records:s};},attributionMarkup:function(a){var b=[];if(a.logo){b.push("<img class='"+this.attributionCls+"-image' src='"+a.logo.href+"' />");}if(a.title){b.push("<span class='"+this.attributionCls+"-title'>"+a.title+"</span>");}if(a.href){for(var d=0;d<b.length;d++){b[d]="<a class='"+this.attributionCls+"-link' href="+a.href+">"+b[d]+"</a>";}}return b.join(" ");}});Ext.namespace("GeoExt.data");GeoExt.data.WMSCapabilitiesStore=function(a){a=a||{};GeoExt.data.WMSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSCapabilitiesReader(a,a.fields)}));};Ext.extend(GeoExt.data.WMSCapabilitiesStore,Ext.data.Store);Ext.namespace("GeoExt.data");GeoExt.data.WMSDescribeLayerReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WMSDescribeLayer();}if(!(typeof b==="function")){b=Ext.data.Record.create(b||a.fields||[{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}]);}GeoExt.data.WMSDescribeLayerReader.superclass.constructor.call(this,a,b);};Ext.extend(GeoExt.data.WMSDescribeLayerReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText;}return this.readRecords(b);},readRecords:function(f){if(typeof f==="string"||f.nodeType){f=this.meta.format.read(f);}var b=[],e;for(var d=0,a=f.length;d<a;d++){e=f[d];if(e){b.push(new this.recordType(e));}}return{totalRecords:b.length,success:true,records:b};}});Ext.namespace("GeoExt.data");GeoExt.data.WMSDescribeLayerStore=function(a){a=a||{};GeoExt.data.WMSDescribeLayerStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSDescribeLayerReader(a,a.fields)}));};Ext.extend(GeoExt.data.WMSDescribeLayerStore,Ext.data.Store);Ext.namespace("GeoExt");GeoExt.Action=Ext.extend(Ext.Action,{control:null,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(a){this.uScope=a.scope;this.uHandler=a.handler;this.uToggleHandler=a.toggleHandler;this.uCheckHandler=a.checkHandler;a.scope=this;a.handler=this.pHandler;a.toggleHandler=this.pToggleHandler;a.checkHandler=this.pCheckHandler;var b=this.control=a.control;delete a.control;if(b){if(a.map){a.map.addControl(b);delete a.map;}if((a.pressed||a.checked)&&b.map){b.activate();}b.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this});}arguments.callee.superclass.constructor.call(this,a);},pHandler:function(a){var b=this.control;if(b&&b.type==OpenLayers.Control.TYPE_BUTTON){b.trigger();}if(this.uHandler){this.uHandler.apply(this.uScope,arguments);}},pToggleHandler:function(a,b){this.changeControlState(b);if(this.uToggleHandler){this.uToggleHandler.apply(this.uScope,arguments);}},pCheckHandler:function(a,b){this.changeControlState(b);if(this.uCheckHandler){this.uCheckHandler.apply(this.uScope,arguments);}},changeControlState:function(a){if(a){if(!this._activating){this._activating=true;this.control.activate();this._activating=false;}}else{if(!this._deactivating){this._deactivating=true;this.control.deactivate();this._deactivating=false;}}},onCtrlActivate:function(){var a=this.control;if(a.type==OpenLayers.Control.TYPE_BUTTON){this.enable();}else{this.safeCallEach("toggle",[true]);this.safeCallEach("setChecked",[true]);}},onCtrlDeactivate:function(){var a=this.control;if(a.type==OpenLayers.Control.TYPE_BUTTON){this.disable();}else{this.safeCallEach("toggle",[false]);this.safeCallEach("setChecked",[false]);}},safeCallEach:function(f,b){var e=this.items;for(var d=0,a=e.length;d<a;d++){if(e[d][f]){e[d].rendered?e[d][f].apply(e[d],b):e[d].on({render:e[d][f].createDelegate(e[d],b),single:true});}}}});Ext.namespace("GeoExt");GeoExt.MapPanel=Ext.extend(Ext.Panel,{map:null,layers:null,center:null,zoom:null,prettyStateKeys:false,extent:null,stateEvents:["aftermapmove","afterlayervisibilitychange","afterlayeropacitychange"],initComponent:function(){if(!(this.map instanceof OpenLayers.Map)){this.map=new OpenLayers.Map(Ext.applyIf(this.map||{},{allOverlays:true}));}var a=this.layers;if(!a||a instanceof Array){this.layers=new GeoExt.data.LayerStore({layers:a,map:this.map.layers.length>0?this.map:null});}if(typeof this.center=="string"){this.center=OpenLayers.LonLat.fromString(this.center);}else{if(this.center instanceof Array){this.center=new OpenLayers.LonLat(this.center[0],this.center[1]);}}if(typeof this.extent=="string"){this.extent=OpenLayers.Bounds.fromString(this.extent);}else{if(this.extent instanceof Array){this.extent=OpenLayers.Bounds.fromArray(this.extent);}}GeoExt.MapPanel.superclass.initComponent.call(this);this.addEvents("aftermapmove","afterlayervisibilitychange","afterlayeropacitychange");this.map.events.on({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this});
},onMoveend:function(){this.fireEvent("aftermapmove");},onLayerchange:function(a){if(a.property){if(a.property==="visibility"){this.fireEvent("afterlayervisibilitychange");}else{if(a.property==="opacity"){this.fireEvent("afterlayeropacitychange");}}}},applyState:function(h){this.center=new OpenLayers.LonLat(h.x,h.y);this.zoom=h.zoom;var g,d,f,b,a,e;var j=this.map.layers;for(g=0,d=j.length;g<d;g++){f=j[g];b=this.prettyStateKeys?f.name:f.id;a=h["visibility_"+b];if(a!==undefined){a=(/^true$/i).test(a);if(f.isBaseLayer){if(a){this.map.setBaseLayer(f);}}else{f.setVisibility(a);}}e=h["opacity_"+b];if(e!==undefined){f.setOpacity(e);}}},getState:function(){var g;if(!this.map){return;}var a=this.map.getCenter();g={x:a.lon,y:a.lat,zoom:this.map.getZoom()};var f,d,e,b,h=this.map.layers;for(f=0,d=h.length;f<d;f++){e=h[f];b=this.prettyStateKeys?e.name:e.id;g["visibility_"+b]=e.getVisibility();g["opacity_"+b]=e.opacity==null?1:e.opacity;}return g;},updateMapSize:function(){if(this.map){this.map.updateSize();}},renderMap:function(){var a=this.map;a.render(this.body.dom);this.layers.bind(a);if(a.layers.length>0){if(this.center||this.zoom!=null){a.setCenter(this.center,this.zoom);}else{if(this.extent){a.zoomToExtent(this.extent);}else{a.zoomToMaxExtent();}}}},afterRender:function(){GeoExt.MapPanel.superclass.afterRender.apply(this,arguments);if(!this.ownerCt){this.renderMap();}else{this.ownerCt.on("move",this.updateMapSize,this);this.ownerCt.on({afterlayout:{fn:this.renderMap,scope:this,single:true}});}},onResize:function(){GeoExt.MapPanel.superclass.onResize.apply(this,arguments);this.updateMapSize();},onBeforeAdd:function(a){if(typeof a.addToMapPanel==="function"){a.addToMapPanel(this);}GeoExt.MapPanel.superclass.onBeforeAdd.apply(this,arguments);},remove:function(b,a){if(typeof b.removeFromMapPanel==="function"){b.removeFromMapPanel(this);}GeoExt.MapPanel.superclass.remove.apply(this,arguments);},beforeDestroy:function(){if(this.ownerCt){this.ownerCt.un("move",this.updateMapSize,this);}if(this.map&&this.map.events){this.map.events.un({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this});}if(!this.initialConfig.map||!(this.initialConfig.map instanceof OpenLayers.Map)){if(this.map&&this.map.destroy){this.map.destroy();}}delete this.map;GeoExt.MapPanel.superclass.beforeDestroy.apply(this,arguments);}});GeoExt.MapPanel.guess=function(){return Ext.ComponentMgr.all.find(function(a){return a instanceof GeoExt.MapPanel;});};Ext.reg("gx_mappanel",GeoExt.MapPanel);Ext.namespace("GeoExt");GeoExt.LegendImage=Ext.extend(Ext.BoxComponent,{url:null,defaultImgSrc:null,imgCls:null,initComponent:function(){GeoExt.LegendImage.superclass.initComponent.call(this);if(this.defaultImgSrc===null){this.defaultImgSrc=Ext.BLANK_IMAGE_URL;}this.autoEl={tag:"img","class":(this.imgCls?this.imgCls:""),src:this.defaultImgSrc};},setUrl:function(a){this.url=a;var b=this.getEl();if(b){b.un("error",this.onImageLoadError,this);b.on("error",this.onImageLoadError,this,{single:true});b.dom.src=a;}},onRender:function(b,a){GeoExt.LegendImage.superclass.onRender.call(this,b,a);if(this.url){this.setUrl(this.url);}},onDestroy:function(){var a=this.getEl();if(a){a.un("error",this.onImageLoadError,this);}GeoExt.LegendImage.superclass.onDestroy.apply(this,arguments);},onImageLoadError:function(){this.getEl().dom.src=this.defaultImgSrc;}});Ext.reg("gx_legendimage",GeoExt.LegendImage);Ext.namespace("GeoExt");GeoExt.LegendPanel=Ext.extend(Ext.Panel,{dynamic:true,layerStore:null,preferredTypes:null,filter:function(a){return true;},initComponent:function(){GeoExt.LegendPanel.superclass.initComponent.call(this);},onRender:function(){GeoExt.LegendPanel.superclass.onRender.apply(this,arguments);if(!this.layerStore){this.layerStore=GeoExt.MapPanel.guess().layers;}this.layerStore.each(function(a){this.addLegend(a);},this);if(this.dynamic){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,clear:this.onStoreClear,scope:this});}},recordIndexToPanelIndex:function(j){var l=this.layerStore;var h=l.getCount();var d=-1;var a=this.items?this.items.length:0;var e,f;for(var b=h-1;b>=0;--b){e=l.getAt(b);f=e.getLayer();var g=GeoExt.LayerLegend.getTypes(e);if(f.displayInLayerSwitcher&&g.length>0&&(l.getAt(b).get("hideInLegend")!==true)){++d;if(j===b||d>a-1){break;}}}return d;},getIdForLayer:function(a){return this.id+"-"+a.id;},onStoreAdd:function(d,b,e){var g=this.recordIndexToPanelIndex(e+b.length-1);for(var f=0,a=b.length;f<a;f++){this.addLegend(b[f],g);}this.doLayout();},onStoreRemove:function(b,a,d){this.removeLegend(a);},removeLegend:function(a){if(this.items){var b=this.getComponent(this.getIdForLayer(a.getLayer()));if(b){this.remove(b,true);this.doLayout();}}},onStoreClear:function(a){this.removeAllLegends();},removeAllLegends:function(){this.removeAll(true);this.doLayout();},addLegend:function(a,b){if(this.filter(a)===true){var e=a.getLayer();b=b||0;var f;var d=GeoExt.LayerLegend.getTypes(a,this.preferredTypes);if(e.displayInLayerSwitcher&&!a.get("hideInLegend")&&d.length>0){this.insert(b,{xtype:d[0],id:this.getIdForLayer(e),layerRecord:a,hidden:!((!e.map&&e.visibility)||(e.getVisibility()&&e.calculateInRange()))});}}},onDestroy:function(){if(this.layerStore){this.layerStore.un("add",this.onStoreAdd,this);this.layerStore.un("remove",this.onStoreRemove,this);this.layerStore.un("clear",this.onStoreClear,this);}GeoExt.LegendPanel.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gx_legendpanel",GeoExt.LegendPanel);Ext.namespace("GeoExt");GeoExt.LayerLegend=Ext.extend(Ext.Container,{layerRecord:null,showTitle:true,legendTitle:null,labelCls:null,layerStore:null,initComponent:function(){GeoExt.LayerLegend.superclass.initComponent.call(this);this.autoEl={};this.add({xtype:"label",text:this.getLayerTitle(this.layerRecord),cls:"x-form-item x-form-item-label"+(this.labelCls?" "+this.labelCls:"")});if(this.layerRecord&&this.layerRecord.store){this.layerStore=this.layerRecord.store;this.layerStore.on("update",this.onStoreUpdate,this);}},onStoreUpdate:function(d,a,b){if(a===this.layerRecord&&this.items.getCount()>0){var e=a.getLayer();this.setVisible(e.getVisibility()&&e.calculateInRange()&&e.displayInLayerSwitcher&&!a.get("hideInLegend"));this.update();}},update:function(){var a=this.getLayerTitle(this.layerRecord);if(this.items.get(0).text!==a){this.items.get(0).setText(a);}},getLayerTitle:function(a){var b=this.legendTitle||"";if(this.showTitle&&!b){if(a&&!a.get("hideTitle")){b=a.get("title")||a.get("name")||a.getLayer().name||"";}}return b;},beforeDestroy:function(){this.layerStore&&this.layerStore.un("update",this.onStoreUpdate,this);GeoExt.LayerLegend.superclass.beforeDestroy.apply(this,arguments);}});GeoExt.LayerLegend.getTypes=function(b,a){var e=(a||[]).concat();var d=[];for(var f in GeoExt.LayerLegend.types){if(GeoExt.LayerLegend.types[f].supports(b)){e.indexOf(f)==-1&&d.push(f);}else{e.remove(f);}}return e.concat(d);};GeoExt.LayerLegend.supports=function(a){};GeoExt.LayerLegend.types={};Ext.namespace("GeoExt");GeoExt.WMSLegend=Ext.extend(GeoExt.LayerLegend,{defaultStyleIsFirst:true,useScaleParameter:true,baseParams:null,initComponent:function(){GeoExt.WMSLegend.superclass.initComponent.call(this);var a=this.layerRecord.getLayer();this._noMap=!a.map;a.events.register("moveend",this,this.onLayerMoveend);this.update();},onLayerMoveend:function(a){if((a.zoomChanged===true&&this.useScaleParameter===true)||this._noMap){delete this._noMap;this.update();}},getLegendUrl:function(h,j){var f=this.layerRecord;var a;var o=f&&f.get("styles");var g=f.getLayer();j=j||[g.params.LAYERS].join(",").split(",");var m=g.params.STYLES&&[g.params.STYLES].join(",").split(",");var l=j.indexOf(h);var b=m&&m[l];if(o&&o.length>0){if(b){Ext.each(o,function(q){a=(q.name==b&&q.legend)&&q.legend.href;return !a;});}else{if(this.defaultStyleIsFirst===true&&!m&&!g.params.SLD&&!g.params.SLD_BODY){a=o[0].legend&&o[0].legend.href;}}}if(!a){a=g.getFullRequestString({REQUEST:"GetLegendGraphic",WIDTH:null,HEIGHT:null,EXCEPTIONS:"application/vnd.ogc.se_xml",LAYER:h,LAYERS:null,STYLE:(b!=="")?b:null,STYLES:null,SRS:null,FORMAT:null});
}if(this.useScaleParameter===true&&a.toLowerCase().indexOf("request=getlegendgraphic")!=-1){var d=g.map.getScale();a=Ext.urlAppend(a,"SCALE="+d);}var e=this.baseParams||{};Ext.applyIf(e,{FORMAT:"image/gif"});if(a.indexOf("?")>0){a=Ext.urlEncode(e,a);}return a;},update:function(){var e=this.layerRecord.getLayer();if(!(e&&e.map)){return;}GeoExt.WMSLegend.superclass.update.apply(this,arguments);var j,b,d,a;j=[e.params.LAYERS].join(",").split(",");var f=[];var h=this.items.get(0);this.items.each(function(l){d=j.indexOf(l.itemId);if(d<0&&l!=h){f.push(l);}else{if(l!==h){b=j[d];var m=this.getLegendUrl(b,j);if(!OpenLayers.Util.isEquivalentUrl(m,l.url)){l.setUrl(m);}}}},this);for(d=0,a=f.length;d<a;d++){var g=f[d];this.remove(g);g.destroy();}for(d=0,a=j.length;d<a;d++){b=j[d];if(!this.items||!this.getComponent(b)){this.add({xtype:"gx_legendimage",url:this.getLegendUrl(b,j),itemId:b});}}this.doLayout();},beforeDestroy:function(){if(this.useScaleParameter===true){var a=this.layerRecord.getLayer();a&&a.events&&a.events.unregister("moveend",this,this.onLayerMoveend);}GeoExt.WMSLegend.superclass.beforeDestroy.apply(this,arguments);}});GeoExt.WMSLegend.supports=function(a){return a.getLayer() instanceof OpenLayers.Layer.WMS;};GeoExt.LayerLegend.types.gx_wmslegend=GeoExt.WMSLegend;Ext.reg("gx_wmslegend",GeoExt.WMSLegend);Ext.namespace("GeoExt.tree");GeoExt.tree.LayerContainer=Ext.extend(Ext.tree.AsyncTreeNode,{constructor:function(a){a=Ext.applyIf(a||{},{text:"Layers"});this.loader=a.loader instanceof GeoExt.tree.LayerLoader?a.loader:new GeoExt.tree.LayerLoader(Ext.applyIf(a.loader||{},{store:a.layerStore}));GeoExt.tree.LayerContainer.superclass.constructor.call(this,a);},recordIndexToNodeIndex:function(d){var b=this.loader.store;var f=b.getCount();var a=this.childNodes.length;var g=-1;for(var e=f-1;e>=0;--e){if(this.loader.filter(b.getAt(e))===true){++g;if(d===e||g>a-1){break;}}}return g;},destroy:function(){delete this.layerStore;GeoExt.tree.LayerContainer.superclass.destroy.apply(this,arguments);}});Ext.tree.TreePanel.nodeTypes.gx_layercontainer=GeoExt.tree.LayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.BaseLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(a){a=Ext.applyIf(a||{},{text:"Base Layer",loader:{}});a.loader=Ext.applyIf(a.loader,{baseAttrs:Ext.applyIf(a.loader.baseAttrs||{},{iconCls:"gx-tree-baselayer-icon",checkedGroup:"baselayer"}),filter:function(b){var d=b.getLayer();return d.displayInLayerSwitcher===true&&d.isBaseLayer===true;}});GeoExt.tree.BaseLayerContainer.superclass.constructor.call(this,a);}});Ext.tree.TreePanel.nodeTypes.gx_baselayercontainer=GeoExt.tree.BaseLayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.LayerLoader=function(a){Ext.apply(this,a);this.addEvents("beforeload","load");GeoExt.tree.LayerLoader.superclass.constructor.call(this);};Ext.extend(GeoExt.tree.LayerLoader,Ext.util.Observable,{store:null,filter:function(a){return a.getLayer().displayInLayerSwitcher==true;},baseAttrs:null,uiProviders:null,load:function(a,b){if(this.fireEvent("beforeload",this,a)){this.removeStoreHandlers();while(a.firstChild){a.removeChild(a.firstChild);}if(!this.uiProviders){this.uiProviders=a.getOwnerTree().getLoader().uiProviders;}if(!this.store){this.store=GeoExt.MapPanel.guess().layers;}this.store.each(function(d){this.addLayerNode(a,d);},this);this.addStoreHandlers(a);if(typeof b=="function"){b();}this.fireEvent("load",this,a);}},onStoreAdd:function(b,a,d,f){if(!this._reordering){var g=f.recordIndexToNodeIndex(d+a.length-1);for(var e=0;e<a.length;++e){this.addLayerNode(f,a[e],g);}}},onStoreRemove:function(b,a,d,e){if(!this._reordering){this.removeLayerNode(e,a);}},addLayerNode:function(e,a,b){b=b||0;if(this.filter(a)===true){var f=this.createNode({nodeType:"gx_layer",layer:a.getLayer(),layerStore:this.store});var d=e.item(b);if(d){e.insertBefore(f,d);}else{e.appendChild(f);}f.on("move",this.onChildMove,this);}},removeLayerNode:function(b,a){if(this.filter(a)===true){var d=b.findChildBy(function(e){return e.layer==a.getLayer();});if(d){d.un("move",this.onChildMove,this);d.remove();b.reload();}}},onChildMove:function(m,b,j,l,g){this._reordering=true;var f=this.store.getByLayer(b.layer);if(l instanceof GeoExt.tree.LayerContainer&&this.store===l.loader.store){l.loader._reordering=true;this.store.remove(f);var a;if(l.childNodes.length>1){var h=(g===0)?g+1:g-1;a=this.store.findBy(function(o){return l.childNodes[h].layer===o.getLayer();});g===0&&a++;}else{if(j.parentNode===l.parentNode){var d=l;do{d=d.previousSibling;}while(d&&!(d instanceof GeoExt.tree.LayerContainer&&d.lastChild));if(d){a=this.store.findBy(function(o){return d.lastChild.layer===o.getLayer();});}else{var e=l;do{e=e.nextSibling;}while(e&&!(e instanceof GeoExt.tree.LayerContainer&&e.firstChild));if(e){a=this.store.findBy(function(o){return e.firstChild.layer===o.getLayer();});}a++;}}}if(a!==undefined){this.store.insert(a,[f]);window.setTimeout(function(){l.reload();j.reload();});}else{this.store.insert(oldRecordIndex,[f]);}delete l.loader._reordering;}delete this._reordering;},addStoreHandlers:function(b){if(!this._storeHandlers){this._storeHandlers={add:this.onStoreAdd.createDelegate(this,[b],true),remove:this.onStoreRemove.createDelegate(this,[b],true)};for(var a in this._storeHandlers){this.store.on(a,this._storeHandlers[a],this);}}},removeStoreHandlers:function(){if(this._storeHandlers){for(var a in this._storeHandlers){this.store.un(a,this._storeHandlers[a],this);}delete this._storeHandlers;}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs);}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider);}attr.nodeType=attr.nodeType||"gx_layer";return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr);},destroy:function(){this.removeStoreHandlers();}});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{constructor:function(a){GeoExt.tree.LayerNodeUI.superclass.constructor.apply(this,arguments);},render:function(e){var d=this.node.attributes;if(d.checked===undefined){d.checked=this.node.layer.getVisibility();}GeoExt.tree.LayerNodeUI.superclass.render.apply(this,arguments);var b=this.checkbox;if(d.checkedGroup){var f=Ext.DomHelper.insertAfter(b,['<input type="radio" name="',d.checkedGroup,'_checkbox" class="',b.className,b.checked?'" checked="checked"':"",'"></input>'].join(""));f.defaultChecked=b.defaultChecked;Ext.get(b).remove();this.checkbox=f;}this.enforceOneVisible();},onClick:function(a){if(a.getTarget(".x-tree-node-cb",1)){this.toggleCheck(this.isChecked());}else{GeoExt.tree.LayerNodeUI.superclass.onClick.apply(this,arguments);}},toggleCheck:function(a){a=(a===undefined?!this.isChecked():a);GeoExt.tree.LayerNodeUI.superclass.toggleCheck.call(this,a);this.enforceOneVisible();},enforceOneVisible:function(){var b=this.node.attributes;var f=b.checkedGroup;if(f&&f!=="gx_baselayer"){var e=this.node.layer;var a=this.node.getOwnerTree().getChecked();var d=0;Ext.each(a,function(h){var g=h.layer;if(!h.hidden&&h.attributes.checkedGroup===f){d++;if(g!=e&&b.checked){g.setVisibility(false);}}});if(d===0&&b.checked==false){e.setVisibility(true);}}},appendDDGhost:function(d){var b=this.elNode.cloneNode(true);var a=Ext.DomQuery.select("input[type='radio']",b);Ext.each(a,function(e){e.name=e.name+"_clone";});d.appendChild(b);}});GeoExt.tree.LayerNode=Ext.extend(Ext.tree.AsyncTreeNode,{layer:null,layerStore:null,constructor:function(a){a.leaf=a.leaf||!(a.children||a.loader);if(!a.iconCls&&!a.children){a.iconCls="gx-tree-layer-icon";}if(a.loader&&!(a.loader instanceof Ext.tree.TreeLoader)){a.loader=new GeoExt.tree.LayerParamLoader(a.loader);}this.defaultUI=this.defaultUI||GeoExt.tree.LayerNodeUI;Ext.apply(this,{layer:a.layer,layerStore:a.layerStore});if(a.text){this.fixedText=true;}GeoExt.tree.LayerNode.superclass.constructor.apply(this,arguments);},render:function(a){var d=this.layer instanceof OpenLayers.Layer&&this.layer;if(!d){if(!this.layerStore||this.layerStore=="auto"){this.layerStore=GeoExt.MapPanel.guess().layers;
}var b=this.layerStore.findBy(function(f){return f.get("title")==this.layer;},this);if(b!=-1){d=this.layerStore.getAt(b).getLayer();}}if(!this.rendered||!d){var e=this.getUI();if(d){this.layer=d;if(d.isBaseLayer){this.draggable=false;Ext.applyIf(this.attributes,{checkedGroup:"gx_baselayer"});}if(!this.text){this.text=d.name;}e.show();this.addVisibilityEventHandlers();}else{e.hide();}if(this.layerStore instanceof GeoExt.data.LayerStore){this.addStoreEventHandlers(d);}}GeoExt.tree.LayerNode.superclass.render.apply(this,arguments);},addVisibilityEventHandlers:function(){this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});this.on({checkchange:this.onCheckChange,scope:this});},onLayerVisibilityChanged:function(){if(!this._visibilityChanging){this.getUI().toggleCheck(this.layer.getVisibility());}},onCheckChange:function(d,b){if(b!=this.layer.getVisibility()){this._visibilityChanging=true;var a=this.layer;if(b&&a.isBaseLayer&&a.map){a.map.setBaseLayer(a);}else{a.setVisibility(b);}delete this._visibilityChanging;}},addStoreEventHandlers:function(){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,update:this.onStoreUpdate,scope:this});},onStoreAdd:function(d,b,e){var a;for(var f=0;f<b.length;++f){a=b[f].getLayer();if(this.layer==a){this.getUI().show();break;}else{if(this.layer==a.name){this.render();break;}}}},onStoreRemove:function(b,a,d){if(this.layer==a.getLayer()){this.getUI().hide();}},onStoreUpdate:function(d,a,b){var e=a.getLayer();if(!this.fixedText&&(this.layer==e&&this.text!==e.name)){this.setText(e.name);}},destroy:function(){var b=this.layer;if(b instanceof OpenLayers.Layer){b.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this});}delete this.layer;var a=this.layerStore;if(a){a.un("add",this.onStoreAdd,this);a.un("remove",this.onStoreRemove,this);a.un("update",this.onStoreUpdate,this);}delete this.layerStore;this.un("checkchange",this.onCheckChange,this);GeoExt.tree.LayerNode.superclass.destroy.apply(this,arguments);}});Ext.tree.TreePanel.nodeTypes.gx_layer=GeoExt.tree.LayerNode;Ext.namespace("GeoExt.tree");GeoExt.tree.LayerParamLoader=function(a){Ext.apply(this,a);this.addEvents("beforeload","load");GeoExt.tree.LayerParamLoader.superclass.constructor.call(this);};Ext.extend(GeoExt.tree.LayerParamLoader,Ext.util.Observable,{param:null,delimiter:",",load:function(b,e){if(this.fireEvent("beforeload",this,b)){while(b.firstChild){b.removeChild(b.firstChild);}var d=(b.layer instanceof OpenLayers.Layer.HTTPRequest)&&b.layer.params[this.param];if(d){var a=(d instanceof Array)?d.slice():d.split(this.delimiter);Ext.each(a,function(h,f,g){this.addParamNode(h,g,b);},this);}if(typeof e=="function"){e();}this.fireEvent("load",this,b);}},addParamNode:function(a,b,e){var f=this.createNode({layer:e.layer,param:this.param,item:a,allItems:b,delimiter:this.delimiter});var d=e.item(0);if(d){e.insertBefore(f,d);}else{e.appendChild(f);}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs);}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider);}attr.nodeType=attr.nodeType||"gx_layerparam";return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr);}});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerParamNode=Ext.extend(Ext.tree.TreeNode,{layer:null,param:null,item:null,delimiter:null,allItems:null,constructor:function(a){var b=a||{};b.iconCls=b.iconCls||"gx-tree-layerparam-icon";b.text=b.text||b.item;this.param=b.param;this.item=b.item;this.delimiter=b.delimiter||",";this.allItems=b.allItems;GeoExt.tree.LayerParamNode.superclass.constructor.apply(this,arguments);this.getLayer();if(this.layer){if(!this.allItems){this.allItems=this.getItemsFromLayer();}if(this.attributes.checked==null){this.attributes.checked=this.layer.getVisibility()&&this.getItemsFromLayer().indexOf(this.item)>=0;}else{this.onCheckChange(this,this.attributes.checked);}this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});this.on({checkchange:this.onCheckChange,scope:this});}},getLayer:function(){if(!this.layer){var d=this.attributes.layer;if(typeof d=="string"){var a=this.attributes.layerStore||GeoExt.MapPanel.guess().layers;var b=a.findBy(function(e){return e.get("title")==d;});d=b!=-1?a.getAt(b).getLayer():null;}this.layer=d;}return this.layer;},getItemsFromLayer:function(){var a=this.layer.params[this.param];return a instanceof Array?a:(a?a.split(this.delimiter):[]);},createParams:function(a){var b={};b[this.param]=this.layer.params[this.param] instanceof Array?a:a.join(this.delimiter);return b;},onLayerVisibilityChanged:function(){if(this.getItemsFromLayer().length===0){this.layer.mergeNewParams(this.createParams(this.allItems));}var a=this.layer.getVisibility();if(a&&this.getItemsFromLayer().indexOf(this.item)!==-1){this.getUI().toggleCheck(true);}if(!a){this.layer.mergeNewParams(this.createParams([]));this.getUI().toggleCheck(false);}},onCheckChange:function(f,e){var d=this.layer;var b=[];var a=this.getItemsFromLayer();if(e===true&&d.getVisibility()===false&&a.length===this.allItems.length){a=[];}Ext.each(this.allItems,function(h){if((h!==this.item&&a.indexOf(h)!==-1)||(e===true&&h===this.item)){b.push(h);}},this);var g=(b.length>0);g&&d.mergeNewParams(this.createParams(b));if(g!==d.getVisibility()){d.setVisibility(g);}(!g)&&d.mergeNewParams(this.createParams([]));},destroy:function(){var a=this.layer;if(a instanceof OpenLayers.Layer){a.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this});}delete this.layer;this.un("checkchange",this.onCheckChange,this);GeoExt.tree.LayerParamNode.superclass.destroy.apply(this,arguments);}});Ext.tree.TreePanel.nodeTypes.gx_layerparam=GeoExt.tree.LayerParamNode;Ext.namespace("GeoExt.tree");GeoExt.tree.OverlayLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(a){a=Ext.applyIf(a||{},{text:"Overlays"});a.loader=Ext.applyIf(a.loader||{},{filter:function(b){var d=b.getLayer();return d.displayInLayerSwitcher===true&&d.isBaseLayer===false;}});GeoExt.tree.OverlayLayerContainer.superclass.constructor.call(this,a);}});Ext.tree.TreePanel.nodeTypes.gx_overlaylayercontainer=GeoExt.tree.OverlayLayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.TreeNodeUIEventMixin=function(){return{constructor:function(a){a.addEvents("rendernode","rawclicknode");this.superclass=arguments.callee.superclass;this.superclass.constructor.apply(this,arguments);},render:function(a){if(!this.rendered){this.superclass.render.apply(this,arguments);this.fireEvent("rendernode",this.node);}},onClick:function(a){if(this.fireEvent("rawclicknode",this.node,a)!==false){this.superclass.onClick.apply(this,arguments);}}};};Ext.namespace("GeoExt.plugins");GeoExt.plugins.TreeNodeRadioButton=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a));Ext.apply(this,a);this.addEvents("radiochange");GeoExt.plugins.TreeNodeRadioButton.superclass.constructor.apply(this,arguments);},init:function(a){a.on({rendernode:this.onRenderNode,rawclicknode:this.onRawClickNode,beforedestroy:this.onBeforeDestroy,scope:this});},onRenderNode:function(d){var b=d.attributes;if(b.radioGroup&&!b.radio){b.radio=Ext.DomHelper.insertBefore(d.ui.anchor,['<input type="radio" class="gx-tree-radio" name="',b.radioGroup,'_radio"></input>'].join(""));}},onRawClickNode:function(b,d){var a=d.getTarget(".gx-tree-radio",1);if(a){a.defaultChecked=a.checked;this.fireEvent("radiochange",b);return false;}},onBeforeDestroy:function(a){a.un("rendernode",this.onRenderNode,this);a.un("rawclicknode",this.onRenderNode,this);a.un("beforedestroy",this.onBeforeDestroy,this);}});Ext.preg("gx_treenoderadiobutton",GeoExt.plugins.TreeNodeRadioButton);Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintProviderField=Ext.extend(Ext.util.Observable,{target:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);GeoExt.plugins.PrintProviderField.superclass.constructor.apply(this,arguments);},init:function(b){this.target=b;
var a={scope:this,render:this.onRender,beforedestroy:this.onBeforeDestroy};a[b instanceof Ext.form.ComboBox?"select":"valid"]=this.onFieldChange;b.on(a);},onRender:function(a){var b=this.printProvider||a.ownerCt.printProvider;if(a.store===b.layouts){a.setValue(b.layout.get(a.displayField));b.on({layoutchange:this.onProviderChange,scope:this});}else{if(a.store===b.dpis){a.setValue(b.dpi.get(a.displayField));b.on({dpichange:this.onProviderChange,scope:this});}else{if(a.initialConfig.value===undefined){a.setValue(b.customParams[a.name]);}}}},onFieldChange:function(d,a){var e=this.printProvider||d.ownerCt.printProvider;var b=d.getValue();this._updating=true;if(a){switch(d.store){case e.layouts:e.setLayout(a);break;case e.dpis:e.setDpi(a);}}else{e.customParams[d.name]=b;}delete this._updating;},onProviderChange:function(b,a){if(!this._updating){this.target.setValue(a.get(this.target.displayField));}},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);this.target.un("render",this.onRender,this);this.target.un("select",this.onFieldChange,this);this.target.un("valid",this.onFieldChange,this);this.printProvider.un("layoutchange",this.onProviderChange,this);this.printProvider.un("dpichange",this.onProviderChange,this);}});Ext.preg("gx_printproviderfield",GeoExt.plugins.PrintProviderField);Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintPageField=Ext.extend(Ext.util.Observable,{printPage:null,target:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);GeoExt.plugins.PrintPageField.superclass.constructor.apply(this,arguments);},init:function(d){this.target=d;var b={beforedestroy:this.onBeforeDestroy,scope:this};var a=d instanceof Ext.form.ComboBox?"select":d instanceof Ext.form.Checkbox?"check":"valid";b[a]=this.onFieldChange;d.on(b);this.printPage.on({change:this.onPageChange,scope:this});this.printPage.printProvider.on({layoutchange:this.onLayoutChange,scope:this});this.setValue(this.printPage);},onFieldChange:function(d,a){var e=this.printPage.printProvider;var b=d.getValue();this._updating=true;if(d.store===e.scales||d.name==="scale"){this.printPage.setScale(a);}else{if(d.name=="rotation"){!isNaN(b)&&this.printPage.setRotation(b);}else{this.printPage.customParams[d.name]=b;}}delete this._updating;},onPageChange:function(a){if(!this._updating){this.setValue(a);}},onLayoutChange:function(d,b){var a=this.target;a.name=="rotation"&&a.setDisabled(!b.get("rotation"));},setValue:function(a){var b=this.target;b.suspendEvents();if(b.store===a.printProvider.scales||b.name==="scale"){if(a.scale){b.setValue(a.scale.get(b.displayField));}}else{if(b.name=="rotation"){b.setValue(a.rotation);}}b.resumeEvents();},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);this.target.un("select",this.onFieldChange,this);this.target.un("valid",this.onFieldChange,this);this.printPage.un("change",this.onPageChange,this);this.printPage.printProvider.un("layoutchange",this.onLayoutChange,this);}});Ext.preg("gx_printpagefield",GeoExt.plugins.PrintPageField);Ext.namespace("GeoExt");GeoExt.SliderTip=Ext.extend(Ext.slider.Tip,{hover:true,minWidth:10,offsets:[0,-10],dragging:false,init:function(a){GeoExt.SliderTip.superclass.init.apply(this,arguments);if(this.hover){a.on("render",this.registerThumbListeners,this);}this.slider=a;},registerThumbListeners:function(){var a,e;for(var b=0,d=this.slider.thumbs.length;b<d;++b){a=this.slider.thumbs[b];e=a.tracker.el;(function(f,g){g.on({mouseover:function(h){this.onSlide(this.slider,h,f);this.dragging=false;},mouseout:function(){if(!this.dragging){this.hide.apply(this,arguments);}},scope:this});}).apply(this,[a,e]);}},onSlide:function(b,d,a){this.dragging=true;return GeoExt.SliderTip.superclass.onSlide.apply(this,arguments);}});Ext.namespace("GeoExt");GeoExt.LayerOpacitySliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>{opacity}%</div>",compiledTemplate:null,init:function(a){this.compiledTemplate=new Ext.Template(this.template);GeoExt.LayerOpacitySliderTip.superclass.init.call(this,a);},getText:function(a){var b={opacity:a.value};return this.compiledTemplate.apply(b);}});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerOpacitySliderPlugin=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a));Ext.apply(this,a);this.addEvents("opacityslide");GeoExt.tree.LayerOpacitySliderPlugin.superclass.constructor.apply(this,arguments);},init:function(a){a.on({rendernode:this.onRenderNode,scope:this});},onRenderNode:function(h){var b=h.attributes;var e=h.layer;if(b.slider){this.indentMarkup=h.parentNode?h.parentNode.ui.getChildIndent():"";var d=h.id+"-tree-slider-";d=Ext.id(null,d);buf=["<br/>","<table><tr>","<td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>","<a id=",d,"></a>","</td>","</tr></table>"];Ext.DomHelper.insertAfter(h.ui.anchor,buf.join(""));var f=100;var g=new Ext.Slider({minValue:0,maxValue:100,value:f,width:100,aggressive:true,layer:e,plugins:new GeoExt.LayerOpacitySliderTip()});Ext.override(Ext.Slider,{getRatio:function(){var a=this.innerEl.getComputedWidth();var j=this.maxValue-this.minValue;return j==0?a:(a/j);}});g.on("change",function(j,l,a){this.layer.setOpacity(l/100);});g.render(d);}}});Ext.preg&&Ext.preg("gx_layeropacitysliderplugin",GeoExt.tree.LayerOpacitySliderPlugin);Ext.namespace("GeoNetwork");GeoNetwork.singleFile=true;Ext.namespace("GeoNetwork","GeoNetwork.Lang");GeoNetwork.Lang.de={featureInfoTooltipTitle:"Feature info",featureInfoTooltipText:"Click in the map to get feature info from all visible layers.",zoomToMaxExtentTooltipTitle:"Full extent",zoomToMaxExtentTooltipText:"Use this button to go to the full extent of the map.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Draw a box in the map to zoom in. You can also click in the map and map will zoom in by a factor of 2.",zoomoutTooltipTitle:"Zoom out",zoomoutTooltipText:"Click in the map or draw a box to zoom out.",dragTooltipTitle:"Pan map",dragTooltipText:"Press the left mouse button to drag the map.",previousTooltipTitle:"Previous map extent",previosTooltipText:"Click this button to go back to the previous map extent",nextTooltipTitle:"Next map extent",nextTooltipText:"Click this button to go to the next map extent",featureInfoTitle:"Feature info",layerManagerTabTitle:"Layer management",legendTabTitle:"Legend",scaleTitle:"Scale",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"There is no queryable map layer",WMSBrowserTab1:"Select",WMSBrowserTab3:"External",WMSBrowserPreviewTitle:"Preview layer",WMSBrowserAddButton:"Add",WMSBrowserDuplicateMsg:"Layer is already in the map",WMSBrowserPreviewWaitMsg:"Retrieving preview image",WMSBrowserConnectButton:"Connect",WMSBrowserConnectError:"There was an error connecting to the Web Map Service, please check the URL.",infoTitle:"Information","mf.print.mapTitle":"Title","mf.print.comment":"Comment","mf.print.dpi":"Resolution","mf.print.scale":"Scale","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Print","mf.print.generatingPDF":"Generating PDF","mf.print.unableToPrint":"It was not posible to print, try later","mf.error":"Error",selectExtentTooltipTitle:"Select extent",selectExtentTooltipText:"Select extent for catalog searches",printTooltipTitle:"Print",printTooltipText:"Print the current map",savewmcTooltipTitle:"Save web map context",savewmcTooltipText:"Saves web map context for current map","saveWMCFile.windowTitle":"Save Web Map Context","saveWMCFile.errorSaveWMC":"Could not save Web Map Context",loadwmcTooltipTitle:"Load web map context",loadwmcTooltipText:"Loads web map context in current map","selectWMCFile.windowTitle":"Load Web Map Context",selectWMCFile:"Select Web Map Context file","selectWMCFile.waitLoadingWMC":"Loading Web Map Context","selectWMCFile.loadButtonText":"Load","selectWMCFile.mergeButtonText":"Merge","selectWMCFile.errorLoadingWMC":"Could not load Web Map Context",opacityButtonText:"Opacity",opacityWindowTitle:"Opacity",metadataButtonText:"Metadata",removeButtonText:"Remove",addWMSButtonText:"Add WMS",addWMSWindowTitle:"Add WMS","layerInfoPanel.windowTitle":"Layer metadata","layerInfoPanel.titleField":"Title","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Queryable",layerList:"Layer list",baseLayerList:"Base layers","metadataResults.buttonText":"Metadata results","metadataResults.tooltipTitle":"Metadata results","metadataResults.tooltipText":"Go to metadata results page","metadataResults.alertTitle":"Metadata results","metadataResults.alertText":"No metadata results to show","mf.information":"Print","mf.print.pdfReady":"PDF ready","loadLayer.loadingMessage":"Loading layer","loadLayer.error.title":"Load layer","loadLayer.error.message":"The layer could not be loaded","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Loading...","disclaimer.buttonClose":"Close",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Straat",gazetteerAddressField3Label:"Plaats",gazetteerAddressField4Label:"Gemeente",gazetteerAddressField5Label:"Huisnummer",searchOptionButton:"Zoek",GazetteerWindowTitle:"Zoek adres",searchResults:"Zoekresultaten",errorTitle:"Fout",SearchOptionLoadFailureMsg:"Het is niet gelukt resultaten op te halen.\nMogelijk is de service tijdelijk niet beschikbaar. \n",gazetteerTooltipTitle:"Zoek op basis van een adres",gazetteerTooltipText:"Zoek een locatie op basis van een postcode, straatnaam, gemeente en/of plaats.",SearchOptionNoResults:"No results found",zoomlayerTooltipTitle:"Zoom auf Layer",zoomlayerTooltipText:"Verwenden Sie diese Taste, um das ganze Ausma� der ausgew�hlten Layer.","zoomlayer.selectLayerTitle":"Zoom auf Layer","zoomlayer.selectLayerText":"No layer selected",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Time position",WMSTimeMovieTitle:"Animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions"};
OpenLayers.Util.extend(OpenLayers.Lang.de,GeoNetwork.Lang.de);Ext.namespace("GeoNetwork","GeoNetwork.lang");GeoNetwork.lang.en={previousPage:"Move to previous page",nextPage:"Move to next page",upInPage:"Scroll up in the results",downInPage:"Scroll down in the results",example:"Example:",helper:"Suggestion:",toggleLayerManager:"Display map layer manager",tagName:"Element name:",enableTooltip:"Enable tooltips to get more information about each descriptors.",connectIssue:"Catalogue connection issue",connectIssueMsg:"Error 404. Can't connect to catalogue at url ",featureInfoTooltipTitle:"Feature info",featureInfoTooltipText:"Click in the map to get feature info from all visible layers.",zoomToMaxExtentTooltipTitle:"Full extent",zoomToMaxExtentTooltipText:"Use this button to go to the full extent of the map.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Draw a box in the map to zoom in. You can also click in the map and map will zoom in by a factor of 2.",zoomoutTooltipTitle:"Zoom out",zoomoutTooltipText:"Click in the map or draw a box to zoom out.",dragTooltipTitle:"Pan map",dragTooltipText:"Press the left mouse button to drag the map.",previousTooltipTitle:"Previous map extent",previosTooltipText:"Click this button to go back to the previous map extent",nextTooltipTitle:"Next map extent",nextTooltipText:"Click this button to go to the next map extent",featureInfoTitle:"Feature info",layerManagerTabTitle:"Layer management",legendTabTitle:"Legend",scaleTitle:"Scale",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"There is no queryable map layer",WMSBrowserTab1:"Select",WMSBrowserTab3:"External",WMSBrowserPreviewTitle:"Preview layer",WMSBrowserAddButton:"Add",WMSBrowserDuplicateMsg:"Layer is already in the map",WMSBrowserPreviewWaitMsg:"Retrieving preview image",WMSBrowserConnectButton:"Connect",WMSBrowserConnectError:"There was an error connecting to the Web Map Service, please check the URL.",infoTitle:"Information","mf.print.mapTitle":"Title","mf.print.comment":"Comment","mf.print.dpi":"Resolution","mf.print.scale":"Scale","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Print","mf.print.generatingPDF":"Generating PDF","mf.print.unableToPrint":"It was not possible to print, try later","mf.error":"Error",selectExtentTooltipTitle:"Select extent",selectExtentTooltipText:"Select extent for catalog searches",clearExtentTooltipTitle:"Remove extent",clearExtentTooltipText:"Remove extent (ie. no spatial criteria)",printTooltipTitle:"Print",printTooltipText:"Print the current map",savewmcTooltipTitle:"Save web map context",savewmcTooltipText:"Saves web map context for current map","saveWMCFile.windowTitle":"Save Web Map Context","saveWMCFile.errorSaveWMC":"Could not save Web Map Context",loadwmcTooltipTitle:"Load web map context",loadwmcTooltipText:"Loads web map context in current map","selectWMCFile.windowTitle":"Load Web Map Context",selectWMCFile:"Select Web Map Context file","selectWMCFile.waitLoadingWMC":"Loading Web Map Context","selectWMCFile.loadButtonText":"Load","selectWMCFile.mergeButtonText":"Merge","selectWMCFile.errorLoadingWMC":"Could not load Web Map Context",opacityButtonText:"Opacity",opacityWindowTitle:"Opacity",metadataButtonText:"Metadata",removeButtonText:"Remove",addWMSButtonText:"Add WMS",addWMSWindowTitle:"Add layer from a WMS service","layerInfoPanel.windowTitle":"Layer metadata","layerInfoPanel.titleField":"Title","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Queryable",layerList:"Layer list",baseLayerList:"Base layers","metadataResults.buttonText":"Metadata results","metadataResults.tooltipTitle":"Metadata results","metadataResults.tooltipText":"Go to metadata results page","metadataResults.alertTitle":"Metadata results","metadataResults.alertText":"No metadata results to show","featureInfoWindow.windowTitle":"Feature info","mf.information":"Print","mf.print.pdfReady":"PDF ready","loadLayer.loadingMessage":"Loading layer","loadLayer.error.title":"Load layer","loadLayer.error.message":"The layer could not be loaded","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Loading...","disclaimer.buttonClose":"Close",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Street",gazetteerAddressField3Label:"Place",gazetteerAddressField4Label:"'Gemeente'",gazetteerAddressField5Label:"House number",searchOptionButton:"Search",resetSearchForm:"Reset search form values.",GazetteerWindowTitle:"Search for address",searchResults:"Search results",errorTitle:"Error",SearchOptionLoadFailureMsg:"No results available. \n The service may be unavailable. \n",gazetteerTooltipTitle:"Search based on an address",gazetteerTooltipText:"Search for a location, based on postcode, street name, 'gemeente' or place.",SearchOptionNoResults:"No results found",zoomlayerTooltipTitle:"Zoom to layer",zoomlayerTooltipText:"Use this button to go to the full extent of the selected layer.","zoomlayer.selectLayerTitle":"Zoom to layer","zoomlayer.selectLayerText":"No layer selected",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Pick a time position",WMSTimeMovieTitle:"Play animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions",fullTextSearch:"Full text search",keyword:"Keyword",org:"Organisation",mapTypes:"Map types",rsIdentifier:"Resource identifier",inspireSearchOptions:"INSPIRE criteria",inspireannex:"INSPIRE annex",inspirerelated:"Related to INSPIRE",inspirerelatedtt:"INSPIRE dataset with report on the conformity regarding the data specification",inspiretheme:"INSPIRE theme",similarity:"Search accuracy",wkt:"WKT geometry",simpleViewMode:"Simple view",spatialSearch:"Spatial criteria",mdChangeDate:"Metadata change date",tempExtent:"Temporal extent",hitsPerPage:"Hits per page",sortBy:"Sort by",relevance:"Relevance",title:"Title",changeDate:"Change date",rating:"Rating",popularity:"Popularity",scaleDesc:"Scale (desc)",scaleAsc:"Scale (asc)","abstract":"Abstract",catalogue:"Catalogue",group:"Group",chooseGroup:"Select a group",md:"Metadata",tpl:"Template",category:"Category",advTextSearch:"Advanced text search options",eitherWords:"Either of the words",exactPhrase:"Exact phrase",allWords:"All of the words",withoutWords:"Without the words",precise:"Precise",imprecise:"Imprecise",relationType:"Relation type",within:"within",touches:"touches",crosses:"crosses",fullyOutsideOf:"fullyOutsideOf",encloses:"encloses",overlaps:"overlaps",intersection:"intersection",nearYou:"Near you",from:"From",to:"To",scaleNominator:"1:",scale:"Scale",digital:"Digital",hardCopy:"Hard copy",download:"Download",downloadable:"Download",interactive:"Interactive",resourceType:"Resource type",dataset:"Dataset",series:"Series",service:"Service",spatialRepType:"Spatial representation",video:"Video",vector:"Vector",textTable:"Text, table",tin:"Tin",stereoModel:"Stereo model",grid:"Grid",kind:"Kind",enterGetCapURL:"Enter a GetCapabilities URL to register a new service.",edit:"Edit",duplicate:"Duplicate","delete":"Delete",createChild:"Create child",privileges:"Privileges",categories:"Categories",otherActions:"Other actions",view:"View",zoomTo:"Zoom to",saveXml:"Save as XML",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",printSel:"Export (PDF)",printTT:"Print. Open a new page for printing.",newOwner:"New owner",updateCategories:"Update categories",updatePrivileges:"Update privileges",noneSelected:"None selected",none:"none",all:"all",allInPage:"all in page",select:"Select ",username:"User name",password:"password",login:"Login",logout:"Logout",administration:"Administration",validationReport:"Validation report",status:"Status",items:"items",item:"item",thumbnails:"Thumbnails",noimages:"No images to display",add:"Add",small:"Small",large:"Large",selectImage:"Select an image",selectFile:"Select a file",image:"Image",uploading:"Uploading ...",upload:"Upload",success:"Success",failure:"Failure",error:"Error",save:"Save",reset:"Reset",fileProcessedMsg:"Processed file ${res} on the server",suggestion:"Suggestion",logoSelect:"Select a logo",relatedResources:"Related resources",createLink:"Create links ...",featureCat:"Feature catalogue",serviceMd:"Service metadata",datasetMd:"Dataset metadata",parentMd:"Parent metadata",updateChildren:"Update children",records:"records",record:"record",help:"Help",publishError:"Publication failed.",outOfMemoryError:"Out of memory error.",publishErrorCode:"Error code:",saveAndCheck:"Save and check",saveAndClose:"Save and close",cancel:"Cancel",layout:"Layout",collapseAll:"Collapse all sections",editAttributes:"Manage attributes",chooseAType:"Choose a type",chooseAView:"Choose a view",viewMode:"View mode",errorAndStatusMsg:"Error. Status: ${status}, text: ${text}. Try again.",mdEditor:"Metadata editor",minorEditTT:"Do not update timestamp on save",editing:"Editing ${title} (${uuid})",GetCapabilitiesDocumentError:"Error loading service GetCapabilities document from URL: ",maxResults:"Number of results",mdTitle:"Metadata title",keywords:"Keywords",createRelation:"Create relation",createIfNotExistButton:"Create a new metadata record",getCapabilitiesLayer:"GetCapabilities layer",layerName:"Layer name",searching:"Searching ...",perThesaurus:" per thesaurus",anyThesaurus:"Any thesaurus",selectedKeywords:"Selected keywords",foundKeywords:"Available keywords",clear:"Clear",publish:"Publish",publishTooltip:"Publish current dataset to remote node. If dataset is already publish in that node, it will be updated.",publishSuccess:"Successful publication.",publishLayerAdded:" Layer added to map preview.",unpublish:"Unpublish",unpublishTooltip:"Remove current dataset from remote node.",unpublishSuccess:"Successful unpublication.",unpublishError:"Unpublication failed. ",check:"Check",errorDatasetNotFound:"Dataset not found.",datasetFound:"Dataset found and added to the map preview.",checkFailure:"Failed to check dataset in remote node.",addOnlineSourceTitle:"Link service to metadata",addOnlineSource:"Add links",addOnlineSourceTT:"Add an onlinesource section to the current metadata record pointing to the WMS/WFS/WCS services. If the service is a WMS, the layer could be displayed in the map viewer.",statusInformation:"Status information.",publishing:"Publishing ...",mapPreview:"Map preview",selectANode:"Select a node ...",geoPublisherWindowTitle:"Geo-publication: ",keywordSelectionWindowTitle:"Keywords selection",crsSelectionWindowTitle:"Coordinate reference system selection",linkedMetadataSelectionWindowTitle:"Related metadata selection",NotOwnerError:"You don't have privileges to update this related record.",ServiceUpdateError:"Error during service metadata update",associateService:"Link service metadata",associateDataset:"Link dataset metadata",logoSelectionWindow:"Choose a logo",fileUploadWindow:"Upload data or document",selectedCRS:"Selected coordinate systems",foundCRS:"Available coordinate systems",search:"Search",restrictSearchToMap:"Restrict search to map extent",selected:"selected",selectRegion:"Select a region ...",drawRectangle:"Draw rectangle",drawPolygon:"Draw polygon",drawPolygonTT:"Click the button and draw a polygon by clicking on the map for each points. Double click to create polygon last points.",drawCircle:"Draw circle",discovery:"Discovery",visualization:"Visualization",when:"When ?",anyTime:"Anytime",onSelection:"On selection",adminAction:"Other",newMetadata:"New metadata",chooseTemplate:"Select a template",process:"Process",suggestions:"Suggestions",applySelected:"Apply selected task",processParametersWindow:"Task parameters",noSuggestion:"No suggestion.",thumbnailUploadWindow:"Upload thumbnail",addThumbnail:"Add",createSmall:"Create small thumbnail",scalingFactor:"Scaling factor",smallScalingFactor:"Small scaling factor",type:"Record type",clickToClose:"Click to close",removeSelected:"Remove selected",ownerName:"Metadata record owner",setPrivileges:"Set privileges",setCategories:"Set categories",massiveOp:"Batch operation ",prepareDownload:"Download files",mdMenu:"Actions",deleteRecord:"Delete metadata record ?",deleteConfirm:"Are you sure to delete this metadata record?",deleteRecordSuccess:"Metadata deleted.",deleteRecordFailure:"Error when deleting metadata record.",advancedSearchOptions:"Advanced criteria",relatedservices:"Related service",relatedchildren:"Children",relatedfcats:"Related feature catalogue",relatedhasfeaturecat:"Datasets",relatedsources:"Source datasets",getMEF:"Export (ZIP)",metadataCategories:"Metadata categories",validityInfo:"Validation status: ",lastUpdate:"Last update: ",importMetadata:"Import metadata",validationStatus:"Validation status",valid:"Valid",notValid:"Not valid",notDetermined:"Not determined",addToMap:"Add to map: ",downloadLink:"Download: ",webLink:"Web link: ",viewKml:"Open in GoogleEarth: ",layerTree:"Layer manager",mdResultsLayer:"Search results",printLayer:"Print page",relatedservices:"Related services",relatedparent:"Parent",relateddatasets:"Related datasets",relatedchildren:"Children",relatedrelated:"Feature catalogue/dataset link",delete19110Relation:"Remove feature catalogue relation",newWindow:"New window",addAsXLink:"Add as linked element",contactSelectionWindowTitle:"Contact selection",selectedContacts:"Selected contacts",foundContacts:"Available",contactRole:"Contact role",mapNearYou:"Center map on your location",errorChangeProtocol:"Remove uploaded file before changing protocol of an online resource.",resultBy:" result(s) / ",subTemplateImport:"Directory entry import",xmlData:"XML",minorEdit:"Minor edit",minorEditTT:"",runASearch:"Run a search.",focusOnAny:"Move focus to the full text search field.",hideSearchForm:"Hide or display search form.",switchMode:"Switch visualization mode.",resetSearchForm:"Reset search form.",focusOnLogin:"Focus on the login form to access catalogue administration or logout if already logged in.",openAdmin:"Go to administration",displayInfoPanel:"Display the information panel.",displayHelpPanel:"Display this help.",SelectionWindowTitle:"Select from directory",found:"Records found",selected:"Selected","add-extent-from-geokeywordsreplace":"Replace existing extent","add-info-from-wmssetExtent":"Set extent","add-info-from-wmssetAndReplaceExtent":"Replace existing extent","add-info-from-wmssetCRS":"Set coordinate reference system","add-info-from-wmssetDynamicGraphicOverview":"Set graphic overview (using GetMap request URL)","add-info-from-wmswmsServiceUrl":"Service URL","linked-data-checkerlinkUrl":"URL to remove","related-metadata-checkeruuidToRemove":"Identifier to remove","add-service-info-from-wxssetAndReplaceOperations":"Replace existing operations","add-service-info-from-wxswxsServiceUrl":"Service URL",manageDirectories:"Manage directories",directory:"Directory",thesaurusManager:"Thesaurus manager",Theme:"Theme",thesaurusFilePath:"Thesaurus file (.rdf)",ThesaurusName:"Thesaurus name",createThesaurusFromURL:"from URL",createThesaurusFromRepository:"from thesaurus repository",creationMode:"Create",thesaurusFromRepository:"Thesaurus",externalThesaurusURL:"URL",thesaurusCreation:"Add a thesaurus",Type:"Type",Activated:"Activated",emptyThesaurus:"New empty thesaurus",thesaurusFromFile:"From local file",thesaurusFromURL:"From remote file (URL)",id:"Identifier",label:"Label",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Label",newDefinition:"Definition",selDirectoryTT:"Select a type of directory. A directory group all elements having the same root element name (eg. gmd:CI_ResponsibleParty is a contact directory)",privTplElTT:"Manage privileges for the current selection.",addTplElTT:"Add an element from an XML fragment to a directory. The destination directory is based on the root element name (eg. gmd:CI_ResponsibleParty).",copyTplElTT:"Create a new entry in the directory from the current selection.",delTplElTT:"Remove selected entry from the directory."};
OpenLayers.Util.extend(OpenLayers.Lang.en,GeoNetwork.lang.en);Ext.namespace("GeoNetwork","GeoNetwork.Lang");GeoNetwork.Lang.fr={previousPage:"Page précédente",nextPage:"Page suivante",upInPage:"Se déplacer vers le haut des résultats",downInPage:"Se déplacer vers le bas des résultats",example:"Exemple :",helper:"Suggestion :",toggleLayerManager:"Afficher le gestionnaire de couches",tagName:"Nom de l'élément :",enableTooltip:"Activer les info-bulles pour obtenir une description complète de chaque champs.",connectIssue:"Échec de connexion au catalogue",connectIssueMsg:"Erreur 404. Impossible de se connecter à l'URL ",featureInfoTooltipTitle:"caractéristique",featureInfoTooltipText:"Cliquer sur la carte pour obtenir des informations sur les données affichees.",zoomToMaxExtentTooltipTitle:"Zoom optimal",zoomToMaxExtentTooltipText:"Utiliser ce bouton pour tout afficher.",zoominTooltipTitle:"Zoomer",zoominTooltipText:"Dessiner un rectangle sur la carte pour zoomer. En cliquant sur la carte, le facteur de zoom est 2.",zoomoutTooltipTitle:"Dézoomer",zoomoutTooltipText:"Cliquer sur la carte ou dessiner un rectangle pour dézoomer.",dragTooltipTitle:"Main",dragTooltipText:"Appuyer sur le bouton gauche de la souris pour déplacer la carte.",previousTooltipTitle:"Revenir au zoom précédant",previosTooltipText:"Cliquer ici pour revenir au zoom précédant",nextTooltipTitle:"Zoom suivant",nextTooltipText:"Cliquer ici pour avancer au zoom suivant",featureInfoTitle:"Caractéristique",layerManagerTabTitle:"Gérer les couches",legendTabTitle:"Légende",scaleTitle:"Echelle",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"Il n'existe pas de carte correspondant à la requête",WMSBrowserTab1:"Sélectionner",WMSBrowserTab3:"Externe",WMSBrowserPreviewTitle:"Aperçu de la couche",WMSBrowserAddButton:"Ajouter",WMSBrowserDuplicateMsg:"La couche est déjà affichée",WMSBrowserPreviewWaitMsg:"Récupérer l'image precedente",WMSBrowserConnectButton:"Connexion",WMSBrowserConnectError:"Erreur de connexion au service Web, merci de vérifier l'URL.",infoTitle:"Information","mf.print.mapTitle":"Titre","mf.print.comment":"Commentaire","mf.print.dpi":"Résolution","mf.print.scale":"Échelle","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Imprimer","mf.print.generatingPDF":"Générer PDF","mf.print.unableToPrint":"Impression impossible, essayer plus tard","mf.error":"Erreur",selectExtentTooltipTitle:"Définir une emprise",selectExtentTooltipText:"Dessiner une emprise à utiliser comme critère géographique",clearExtentTooltipTitle:"Supprimer l'emprise",clearExtentTooltipText:"Supprimer l'emprise (ie. aucun critère géographique)",printTooltipTitle:"Imprimer",printTooltipText:"Imprimer la carte actuelle",savewmcTooltipTitle:"Sauvegarder environnement (vue, paramètres,etc.)",savewmcTooltipText:"Sauvegarder environnement pour la carte actuelle","saveWMCFile.windowTitle":"Sauvegarder l'environnement","saveWMCFile.errorSaveWMC":"Sauvegarde de l'environnement impossible",loadwmcTooltipTitle:"Restaurer l'environnement",loadwmcTooltipText:"Restaurer l'environnement dans la carte actuelle","selectWMCFile.windowTitle":"Restaurer l'environnement",selectWMCFile:"Ouvrir un environnement","selectWMCFile.waitLoadingWMC":"Restauration de l'environnement en cours...","selectWMCFile.loadButtonText":"Charger","selectWMCFile.mergeButtonText":"Fusionner","selectWMCFile.errorLoadingWMC":"Chargement de l'environnement impossible",opacityButtonText:"Transparence",opacityWindowTitle:"Transparence",metadataButtonText:"Metadata",removeButtonText:"Supprimer",addWMSButtonText:"Ajouter WMS",addWMSWindowTitle:"Ajouter WMS","layerInfoPanel.windowTitle":"Couche metadata","layerInfoPanel.titleField":"Titre","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Requête",layerList:"Liste des couches","metadataResults.buttonText":"Résultats Metadata","metadataResults.tooltipTitle":"résultats Metadata","metadataResults.tooltipText":"Aller a la page des résultats Metadata","metadataResults.alertTitle":"Résultats Metadata","metadataResults.alertText":"Pas de résultats Metadata","mf.information":"Imprimer","mf.print.pdfReady":"PDF prêt","loadLayer.loadingMessage":"Chargement de la couche","loadLayer.error.title":"Charger la couche","loadLayer.error.message":"La couche ne peut être chargée","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Chargement...","disclaimer.buttonClose":"Fermer",gazetteerAddressField1Label:"Code postal",gazetteerAddressField2Label:"Street",gazetteerAddressField3Label:"Place",gazetteerAddressField4Label:"Municipalité",gazetteerAddressField5Label:"Numéro",searchOptionButton:"Recherche",GazetteerWindowTitle:"Résultat pour l'adresse",searchResults:"Recherche les résultats",resetSearchForm:"Réinitialiser le formulaire de recherche.",errorTitle:"Erreur",SearchOptionLoadFailureMsg:"Pas de résultats trouvés. \n Le serveur peut être indisponible. \n",gazetteerTooltipTitle:"Recherche basée sur l'adresse",gazetteerTooltipText:"Recherche du lieu, basé sur le code postal, la rue, la municipalité ou place.",SearchOptionNoResults:"Pas de résultats trouvés.",zoomlayerTooltipTitle:"Zoom sur une couche",zoomlayerTooltipText:"Utilisez ce bouton pour accéder à la pleine mesure de le calque sélectionné.","zoomlayer.selectLayerTitle":"Zoom sur une couche","zoomlayer.selectLayerText":"No de calque sélectionné",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Time position",WMSTimeMovieTitle:"Animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions",fullTextSearch:"Rechercher ...",keyword:"Mots-clés",org:"Organisation",mapTypes:"Type de données",rsIdentifier:"Identifiant de la ressource",inspireSearchOptions:"INSPIRE",inspireannex:"Annexe",inspirerelated:"Données soumises à INSPIRE",inspirerelatedtt:"Données décrivant un rapport sur la conformité vis-à-vis des spécifications sur les données INSPIRE.",inspiretheme:"Thème",similarity:"Précision",wkt:"Geométrie WKT",spatialSearch:"Critères géographiques",mdChangeDate:"Date de mise à jour des métadonnées",tempExtent:"Étendue temporelle",hitsPerPage:"Nombre par page",sortBy:"Trier par",relevance:"Pertinence",title:"Titre",changeDate:"Date de mise à jour",rating:"Note",popularity:"Popularité",scaleDesc:"Échelle (desc)",scaleAsc:"Échelle (asc)","abstract":"Résumé",catalogue:"Catalogue",group:"Groupe",md:"Métadonnée",tpl:"Modèle",category:"Catégorie",advTextSearch:"Options avancées",eitherWords:"Tous - au moins un des mots suivants",exactPhrase:"Cette expression exacte",allWords:"Tous les mots suivants",withoutWords:"Aucun des mots suivants",precise:"Précis",imprecise:"Flou",relationType:"Type de relation",within:"À l'intérieur",touches:"Touche",crosses:"Travers",fullyOutsideOf:"En dehors",encloses:"Contient",overlaps:"Chevauche",intersection:"Intersecte",nearYou:"À proximité",from:"du",to:"au",scaleNominator:"1/",scale:"Échelle",digital:"Numérique",hardCopy:"Copie papier",download:"Télécharger",downloadable:"Téléchargeable",interactive:"Interactive",resourceType:"Type de ressource",dataset:"Série de données",series:"Ensemble de séries de données",service:"Service",spatialRepType:"Représentation spatiale",video:"Vidéo",vector:"Vecteur",textTable:"Tableau, Texte",tin:"Tin",stereoModel:"Vue 3D",grid:"Raster",kind:"Type",enterGetCapURL:"Saisir l'URL d'un GetCapabilities pour enregistrer un nouveau service",edit:"Éditer",duplicate:"Dupliquer","delete":"Supprimer",createChild:"Créer un enfant",privileges:"Privilèges",categories:"Catégories",otherActions:"Autres actions",view:"Consulter",zoomTo:"Zoomer vers",saveXml:"Export (XML)",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",printSel:"Export (PDF)",printTT:"Imprimer. Ouvre une nouvelle page adaptée à l'impression.",newOwner:"Associer un autre auteur",updateCategories:"Mettre à jour les catégories",updatePrivileges:"Mettre à jour les privilèges",noneSelected:"Sélection vide",none:"aucun",all:"tous",allInPage:"tous dans la page",select:"Selectionner ",username:"Identifiant",password:"Mot de passe",login:"Connexion",logout:"Déconnexion",administration:"Administration",validationReport:"Rapport de validation",status:"Status",items:"éléments",item:"élément",thumbnails:"Aperçus",noimages:"Aucun aperçu disponible",add:"Ajouter",small:"Petit",large:"Grand",selectImage:"Sélectionner une image",selectFile:"Sélectionner un fichier",image:"Image",uploading:"Transfert en cours ...",upload:"Transférer",success:"Succès",failure:"Échec",error:"Erreur",save:"Sauver",reset:"Réinitialiser",fileProcessedMsg:"Traitement du fichier ${res} réalisé sur le serveur",suggestion:"Suggestion",logoSelect:"Sélectionner un logo",relatedResources:"Ressources associées",createLink:"Associer ...",featureCat:"Catalogue d'attributs",serviceMd:"Métadonnées de service",datasetMd:"Métadonnées de données",parentMd:"Parent",updateChildren:"Mettre à jour les enfants",records:"enregistrements",record:"enregistrement",help:"Aide",publishError:"Échec lors de la publication.",outOfMemoryError:"Érreur de dépassement de mémoire.",publishErrorCode:"Code érreur :",saveAndCheck:"Sauver et valider",saveAndClose:"Sauver et fermer",cancel:"Annuler",layout:"Mise en page",Resolution:"Résolution",collapseAll:"Réduire les sections",editAttributes:"Gérer les attributs",chooseAType:"Choisir un type",chooseAView:"Choisir une vue",viewMode:"Affichage",errorAndStatusMsg:"Érreur. Status : ${status}, description : ${text}. Essayer à nouveau.",mdEditor:"Editeur de métadonnée",editing:"${title} (${uuid}) en cours d'édition",GetCapabilitiesDocumentError:"Erreur lors de la tentative de récupération des informations du service (ie. GetCapabilities) avec l'adresse: ",maxResults:"Nombre de résultats",mdTitle:"Titre de la métadonnée",keywords:"Mots-clés",createRelation:"Créer la relation",createIfNotExistButton:"Créer une nouvelle métadonnée",getCapabilitiesLayer:"Couches du GetCapabilities",layerName:"Nom de la couche",searching:"Recherche en cours ...",perThesaurus:" par thesaurus",anyThesaurus:"Tous les thésaurus",selectedKeywords:"Mots clés selectionnés",foundKeywords:"Mots clés trouvés",clear:"Effacer",publish:"Publier",publishTooltip:"Publier le jeu de données en cours dans le nœud distant. Si le jeu de données est présent, il est mis à jour.",publishSuccess:"Publication effectuée.",publishLayerAdded:" Couche ajoutée à la carte.",unpublish:"Dépublier",unpublishTooltip:"Supprimer le jeu de données en cours dans le nœud distant.",unpublishSuccess:"Dépublication effectuée.",unpublishError:"Echec de la dépublication. ",check:"Vérifier",errorDatasetNotFound:"Jeu de données non trouvé.",datasetFound:"Jeu de données trouvé et ajouté à la carte.",checkFailure:"Echec de la vérification de la présence du jeu de données dans le nœud distant.",addOnlineSourceTitle:"Lier le service à la fiche",addOnlineSource:"Ajouter les liens",addOnlineSourceTT:"Ajouter les informations pour faire la liaison avec la couche dans le service WMS/WFS/WCS.",statusInformation:"Status.",publishing:"Publication en cours ...",mapPreview:"Carte",selectANode:"Choisir un nœud ...",geoPublisherWindowTitle:"Géo-publication : ",keywordSelectionWindowTitle:"Sélection de mots clés",crsSelectionWindowTitle:"Sélection des systèmes de coordonnées",linkedMetadataSelectionWindowTitle:"Sélection des métadonnées associées",NotOwnerError:"Vous n'avez pas les privilèges pour mettre à jour la métadonnée associée.",ServiceUpdateError:"Erreur lors de la mise à jour de la métadonnée.",associateService:"Associer une métadonnée de service",associateDataset:"Associer une métadonnée de données",logoSelectionWindow:"Sélectionner un logo",fileUploadWindow:"Ajouter des données ou des documents",selectedCRS:"Systèmes sélectionnés",foundCRS:"Systèmes disponibles",search:"Rechercher",restrictSearchToMap:"Restreindre la recherche à la carte",selected:"sélectionné(s)",selectRegion:"Choisir une région ...",drawRectangle:"Créer un rectangle",drawPolygon:"Créer un polygone",drawCircle:"Créer un cercle",discovery:"Découverte",visualization:"Visualisation",when:"Critères temporels",anyTime:"N'importe quand",onSelection:"Sur la sélection",adminAction:"Autres",newMetadata:"Nouvelle métadonnée",chooseGroup:"Selectionner un groupe",chooseTemplate:"Sélectionner un modèle",process:"Traiter",suggestions:"Suggestions",applySelected:"Appliquer le traitement sélectionné",processParametersWindow:"Paramètres du traitement",noSuggestion:"Aucune suggestion.",thumbnailUploadWindow:"Ajouter un aperçu",addThumbnail:"Ajouter",createSmall:"Créer un petit aperçu",scalingFactor:"Facteur d'échelle",smallScalingFactor:"Facteur d'échelle",type:"Type de fiche",clickToClose:"Cliquer pour fermer",removeSelected:"Supprimer la sélection","metadata.update.new":"Chargement en cours ...","metadata.update.forget.new":"Ré-initialisation en cours ...",ownerName:"Rédacteur de la métadonnée",setPrivileges:"Définir les privilèges",setCategories:"Choisir les catégories",massiveOp:"Opération sur la sélection",prepareDownload:"Télécharger les fichiers",mdMenu:"Actions",simpleViewMode:"Vue simplifiée",deleteRecord:"Supprimer la métadonnée ?",deleteConfirm:"Confirmez-vous la suppression de la métadonnée ?",deleteRecordSuccess:"Metadonnée supprimée",deleteRecordFailure:"Échec lors de la suppression de la métadonnée",advancedSearchOptions:"Critères avancés",getMEF:"Export (ZIP)",metadataCategories:"Catégories",validityInfo:"Information sur la validation",lastUpdate:"Dernière mise à jour : ",importMetadata:"Import de métadonnées",validationStatus:"Validation ",valid:"Valide",notValid:"Non valide",notDetermined:"Non déterminé",addToMap:"Ajouter à la carte : ",downloadLink:"Télécharger : ",webLink:"Site web : ",viewKml:"Visualiser avec GoogleEarth : ",layerTree:"Gestion des couches",mdResultsLayer:"Résultats de la recherche",printLayer:"Page de l'impression",relatedservices:"Services associés",relatedparent:"Métadonnée parent",relateddatasets:"Métadonnées associées",relatedchildren:"Enfants",relatedrelated:"Relation catalogue d'attributs/données",relatedfcats:"Relation catalogue d'attributs/données",relatedhasfeaturecat:"Donnée",relatedsources:"Données sources",delete19110Relation:"Supprimer le lien cat. d'attributs",newWindow:"Nouvelle fenêtre",addAsXLink:"Ajout d'un élément lié",contactSelectionWindowTitle:"Sélection des contacts",selectedContacts:"Contacts sélectionnés",foundContacts:"Contacts disponibles",contactRole:"Rôle du contact",mapNearYou:"Centrer la carte sur votre position",create:"Créer",errorChangeProtocol:"Impossible de changer le protocol lorsqu'un fichier est attaché. Supprimer le fichier.",resultBy:" resultat(s) / ",subTemplateImport:"Importer un élément dans un annuaire",xmlData:"XML",minorEdit:"Modif. mineure",minorEditTT:"Lorsque cette option est activée, la date de mise à jour des métadonnées n'est pas changée. Lors de l'utilisation des suggestions, ou de la mise à jour d'une imagette, cette option est sans effet, la date est mise à jour.",runSearch:"Lancer la recherche.",focusOnAny:"Déplacer le curseur sur le critère plein texte.",hideSearchForm:"Afficher ou cacher le formulaire de recherche.",switchMode:"Changer de mode de visualisation.",resetSearchForm:"Réinitialiser le formulaire de recherche.",focusOnLogin:"Déplacer le curseur sur le formulaire de connexion ou déconnexion si vous êtes connecté.",openAdmin:"Administrer le catalogue",displayInfoPanel:"Afficher la page d'information.",displayHelpPanel:"Afficher cette page d'aide.",SelectionWindowTitle:"Rechercher dans l'annuaire",found:"Enregistrements trouvés","add-extent-from-geokeywordsreplace":"Remplacer les étendues géographiques existantes","add-info-from-wmssetExtent":"Définir l'étendue","add-info-from-wmssetAndReplaceExtent":"Remplacer les étendues existantes","add-info-from-wmssetCRS":"Ajouter les systèmes de coordonnées","add-info-from-wmssetDynamicGraphicOverview":"Définir l'aperçu (en ajoutant une URL vers une requête GetMap)","add-info-from-wmswmsServiceUrl":"URL du service","linked-data-checkerlinkUrl":"Lien à supprimer","related-metadata-checkeruuidToRemove":"Identifiant à supprimer","add-service-info-from-wxssetAndReplaceOperations":"Remplacer les opérations existantes","add-service-info-from-wxswxsServiceUrl":"URL du service",manageDirectories:"Gestion des annuaires",directory:"Annuaire",thesaurusManager:"Gestion des thésaurus",Theme:"Thème",thesaurusFilePath:"Fichier (.rdf)",ThesaurusName:"Nom du thésaurus",createThesaurusFromURL:"A partir d'une URL",createThesaurusFromRepository:"A partir du dépôt partagé",creationMode:"Créer",thesaurusFromRepository:"Thésaurus",externalThesaurusURL:"URL",thesaurusCreation:"Ajout d'un thésaurus",Type:"Type",Activated:"Activé",emptyThesaurus:"Nouveau thésaurus vide",thesaurusFromFile:"A partir d'un fichier local",thesaurusFromURL:"A partir d'un fichier distant (URL)",id:"Identifiant",label:"Libellé",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Libellé",newDefinition:"Définition",selDirectoryTT:"Choisir un type d'annuaire. Un annuaire est constitué d'éléments ayant la même balise racine (eg. les éléments gmd:CI_ResponsibleParty font partie de l'annuaire de contact)",privTplElTT:"Gérer les privilèges sur la sélection.",addTplElTT:"Ajouter un élément à partir d'un fragment d'XML. L'annuaire cible est basé sur le nom de la balise racine (eg. gmd:CI_ResponsibleParty).",copyTplElTT:"Créer un nouvel élément dans l'annuaire à partir de l'élément sélectionné.",delTplElTT:"Supprimer la sélection."};
OpenLayers.Util.extend(OpenLayers.Lang.fr,GeoNetwork.Lang.fr);Ext.namespace("GeoNetwork","GeoNetwork.Lang");GeoNetwork.Lang.nl={featureInfoTooltipTitle:"Attribuut-informatie",featureInfoTooltipText:"Klik in de kaart om attribuut-informatie op te vragen van alle zichtbare lagen.",zoomToMaxExtentTooltipTitle:"Volledig kaartbeeld",zoomToMaxExtentTooltipText:"Klik op deze button om naar het volledig kaartbeeld te zoomen.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Trek een kader in kaart om in te zoomen. Ook kan er geklikt worden in de kaart waarna er met een factor 2 ingezoomd wordt.",zoomoutTooltipTitle:"Zoom uit",zoomoutTooltipText:"Klik in de kaart om gecentreerd op dit punt met een factor 2 uit te zoomen. Ook kan er een kader in de kaart getrokken worden, hoe kleiner dit kader hoe verder er uitgezoomd zal worden.",dragTooltipTitle:"Verschuif kaart",dragTooltipText:"Houd de linker muisknop ingedrukt en versleep de kaart.",previousTooltipTitle:"Vorige kaart extent",previosTooltipText:"Klik op deze button om terug te gaan naar de vorige kaart extent",nextTooltipTitle:"Volgende kaart extent",nextTooltipText:"Klik op deze button om verder te gaan naar de volgende kaart extent",featureInfoTitle:"Attribuut-informatie",layerManagerTabTitle:"Kaartlagenbeheer",legendTabTitle:"Legenda",scaleTitle:"Schaal",xTitle:"X",yTitle:"Y",projectionTitle:"Projectie",FeatureInfoNotQueryable:"Er is geen bevraagbare kaartlaag",WMSBrowserTab1:"Selecteren",WMSBrowserTab3:"Extern",WMSBrowserPreviewTitle:"Preview kaartlaag",WMSBrowserAddButton:"Voeg toe",WMSBrowserDuplicateMsg:"Kaartlaag is reeds aanwezig.",WMSBrowserPreviewWaitMsg:"Preview image ophalen",WMSBrowserConnectButton:"Maak verbinding",WMSBrowserConnectError:"Er is een fout opgetreden bij het maken van de verbinding, controleer de URL.",infoTitle:"Informatie","mf.print.mapTitle":"Titel","mf.print.comment":"Opmerkingen","mf.print.dpi":"Resolutie","mf.print.scale":"Schaal","mf.print.rotation":"Rotatie","mf.print.resetPos":"Terug naar begininstellingen","mf.print.print":"Print","mf.print.generatingPDF":"Aanmaken PDF","mf.print.unableToPrint":"Het was helaas niet mogelijk om te printen, probeert u het svp later nogmaals","mf.error":"Fout",selectExtentTooltipTitle:"Begrens zoekgebied",selectExtentTooltipText:"Begrens het zoekgebied door in de kaart een kader te trekken.",printTooltipTitle:"Print",printTooltipText:"Print de huidige kaart",savewmcTooltipTitle:"Opslaan WMC",savewmcTooltipText:"Sla een Web Map Context document op.","saveWMCFile.windowTitle":"Opslaan Web Map Context","saveWMCFile.errorSaveWMC":"Kon het WMC bestand niet opslaan",loadwmcTooltipTitle:"Open WMC",loadwmcTooltipText:"Opent een bestaand Web Map Context document in de kaart viewer","selectWMCFile.windowTitle":"Openen Web Map Context",selectWMCFile:"Select WMC bestand","selectWMCFile.waitLoadingWMC":"Laden Web Map Context","selectWMCFile.loadButtonText":"Openen","selectWMCFile.mergeButtonText":"Samenvoegen","selectWMCFile.errorLoadingWMC":"Kon het Web Map Context bestand niet openen",opacityButtonText:"Opaciteit",opacityWindowTitle:"Opaciteit",metadataButtonText:"Metadata",removeButtonText:"Verwijderen",addWMSButtonText:"Voeg WMS toe",addWMSWindowTitle:"Voeg WMS toe","layerInfoPanel.windowTitle":"Metadata van de kaartlaag","layerInfoPanel.titleField":"Titel","layerInfoPanel.descriptionField":"Samenvatting","layerInfoPanel.queryableField":"Bevraagbaar",layerList:"Kaartlagen",baseLayerList:"Ondergrond","metadataResults.buttonText":"Metadata resultaten","metadataResults.tooltipTitle":"Metadata resultaten","metadataResults.tooltipText":"Ga naar de metadata resultaatpagina","metadataResults.alertTitle":"Metadata resultaten","metadataResults.alertText":"Geen metadata resultaten om te tonen","featureInfoWindow.windowTitle":"Attribuut-informatie","mf.information":"Print","mf.print.pdfReady":"PDF gereed","loadLayer.loadingMessage":"Ophalen kaartlaag","loadLayer.error.title":"Ophalen kaartlaag","loadLayer.error.message":"De kaartlaag kon niet worden geladen","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Laden...","disclaimer.buttonClose":"Sluiten",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Straat",gazetteerAddressField3Label:"Plaats",gazetteerAddressField4Label:"Gemeente",gazetteerAddressField5Label:"Huisnummer",searchOptionButton:"Zoek",GazetteerWindowTitle:"Zoek adres",searchResults:"Zoekresultaten",errorTitle:"Fout",SearchOptionLoadFailureMsg:"Het is niet gelukt resultaten op te halen.\nMogelijk is de service tijdelijk niet beschikbaar. \n",gazetteerTooltipTitle:"Zoek op basis van een adres",gazetteerTooltipText:"Zoek een locatie op basis van een postcode, straatnaam, gemeente en/of plaats.",SearchOptionNoResults:"Geen resultaten gevonden",zoomlayerTooltipTitle:"Zoom naar laag",zoomlayerTooltipText:"Gebruik deze knop om naar de volledige omvang van de geselecteerde laag.","zoomlayer.selectLayerTitle":"Zoom naar laag","zoomlayer.selectLayerText":"Geen laag geselecteerd",layerStylesWindowTitle:"Kaartlaag stijlen",layerStylesPreviewTitle:"Maak een voorvertoning van de legenda",selectStyleButton:"Selecteer kaartstijl",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Kies een tijdstip",WMSTimeMovieTitle:"Speel een animatie af",wmsTimeUpdateButtonText:"Doorvoeren",WMSTimeAnimationCheckbox:"Speel laatste ${steps} tijdstippen af"};OpenLayers.Util.extend(OpenLayers.Lang.nl,GeoNetwork.Lang.nl);Ext.namespace("GeoNetwork");GeoNetwork.Lang={};GeoNetwork.Util={defaultLocale:"en",locales:[["ar","عربي","ara"],["ca","Català","cat"],["cn","中文","chi"],["de","Deutsch","ger"],["en","English","eng"],["es","Español","spa"],["fr","Français","fre"],["nl","Nederlands","dut"],["no","Norsk","nor"],["pt","Рortuguês","por"],["ru","Русский","rus"]],setLang:function(d,b){d=d||GeoNetwork.Util.defaultLocale;OpenLayers.Lang.setCode(d);var a=document.createElement("script");a.type="text/javascript";a.src=b+"/js/ext/src/locale/ext-lang-"+d+".js";document.getElementsByTagName("head")[0].appendChild(a);},getCatalogueLang:function(b){var a;for(a=0;a<GeoNetwork.Util.locales.length;a++){if(GeoNetwork.Util.locales[a][0]===b){return GeoNetwork.Util.locales[a][0];}}return GeoNetwork.Util.defaultLocale;},getISO3LangCode:function(b){var a;for(a=0;a<GeoNetwork.Util.locales.length;a++){if(GeoNetwork.Util.locales[a][0]===b){return GeoNetwork.Util.locales[a][2];}}return"eng";},getParameters:function(b){var o=OpenLayers.Util.getParameters(b);if(OpenLayers.String.contains(b,"#")){var d=b.indexOf("#")+1;var f=b.length;var a=b.substring(d,f);var e=a.split(/[\/]/);for(var h=0,j=e.length;h<j;++h){var g=e[h].split("=");var m=g[0];var l=g[1]||"";o[m]=l;}}return o;},getBaseUrl:function(a){return a.substring(0,a.indexOf("?")||a.indexOf("#")||a.length);}};Ext.namespace("GeoNetwork");GeoNetwork.Catalogue=Ext.extend(Ext.util.Observable,{SERVERURL:null,URL:null,LANG:"en",DEFAULT_LANG:"en",EDITOR_MODE:{IN_OTHER_WINDOW:1,IN_EDITOR_POPUP:2},editMode:1,hostUrl:null,servlet:null,extentMap:null,services:{},windowOption:"menubar=no,location=no,toolbar=no,directories=no",windowName:"",startRecord:1,mdStore:null,summaryStore:null,statusBarId:null,mdDisplayPanelId:undefined,resultsView:undefined,mdOverlayedCmpId:undefined,identifiedUser:undefined,adminUser:false,metadataEditFn:undefined,adminAppUrl:"",selectedRecords:0,constructor:function(a){a=a||{};Ext.apply(this,a);if(this.hostUrl){if(this.hostUrl.indexOf("http")===-1){this.hostUrl=window.location.href.match(/http.*\//,"")+this.hostUrl;}this.SERVERURL=this.hostUrl;}else{this.SERVERURL="http://"+window.location.host+"/";}if(this.hostUrl){this.URL=this.SERVERURL;}else{if(this.servlet){this.URL=this.SERVERURL+this.servlet;}else{this.URL=this.SERVERURL+"geonetwork";}}this.LANG=(this.lang?this.lang:this.DEFAULT_LANG);var b=this.URL+"/srv/"+this.LANG+"/";this.services={rootUrl:b,csw:b+"csw",xmlSearch:b+"xml.search",mdSelect:b+"metadata.select",mdView:b+"view",mdXMLInsert:b+"xml.metadata.insert",mdShow:b+"metadata.show.embedded",mdMEF:b+"mef.export",mdXMLGet:b+"xml.metadata.get",mdXMLGet19139:b+"xml_iso19139",mdXMLGetDC:b+"xml_dublin-core",mdXMLGetFGDC:b+"xml_fgdc-std",mdXMLGet19115:b+"xml_iso19115to19139",mdDuplicate:b+"metadata.duplicate.form",mdDelete:b+"metadata.delete",mdPrint:b+"pdf",mdEdit:b+"edit",mdCreate:b+"metadata.create.new",mdUpdate:b+"metadata.update.new",mdProcessingXml:b+"xml.metadata.processing",mdProcessing:b+"metadata.processing.new",mdMassiveChildrenForm:b+"metadata.batch.children.form",mdAdmin:b+"metadata.admin.form",mdValidate:b+"xml.metadata.validate",mdSuggestion:b+"metadata.suggestion",mdCategory:b+"metadata.category.form",mdRelationInsert:b+"xml.relation.insert",mdRelationDelete:b+"xml.relation.delete",mdRelation:b+"xml.relation",mdGetThumbnail:b+"metadata.thumbnail",mdSetThumbnail:b+"metadata.thumbnail.set.new",mdUnsetThumbnail:b+"metadata.thumbnail.unset.new",mdImport:b+"metadata.xmlinsert.form",subTemplateType:b+"subtemplate.types",subTemplate:b+"subtemplate",upload:b+"resources.upload.new",prepareDownload:b+"prepare.file.download",fileDisclaimer:b+"file.disclaimer",fileDownload:b+"file.download",geopublisher:b+"geoserver.publisher",login:b+"xml.user.login",logout:b+"xml.user.logout",mef:b+"mef.export?format=full&version=2",csv:b+"csv.search",pdf:b+"pdf.selection.search",harvestingStart:b+"xml.harvesting.start",harvestingStop:b+"xml.harvesting.stop",harvestingRun:b+"xml.harvesting.run",harvestingAdd:b+"xml.harvesting.add",harvestingUpdate:b+"xml.harvesting.update",harvestingRemove:b+"xml.harvesting.remove",thesaurusAdd:b+"thesaurus.add",thesaurusActivate:b+"thesaurus.activate",thesaurusDelete:b+"thesaurus.delete",thesaurusUpload:b+"xml.thesaurus.upload",thesaurusDownload:b+"thesaurus.download",thesaurusConceptAdd:b+"thesaurus.addelement",thesaurusConceptUpdate:b+"thesaurus.updateelement",thesaurusConceptDelete:b+"thesaurus.deleteelement",getIcons:b+"xml.harvesting.info?type=icons",opensearchSuggest:b+"main.search.suggest",massiveOp:{NewOwner:b+"metadata.batch.newowner.form",Categories:b+"metadata.batch.category.form",Delete:b+"metadata.batch.delete",Privileges:b+"metadata.batch.admin.form"},metadataMassiveUpdatePrivilege:b+"metadata.batch.update.privileges",metadataMassiveUpdateCategories:b+"metadata.batch.update.categories",getGroups:b+"xml.info?type=groups",getRegions:b+"xml.info?type=regions",getSources:b+"xml.info?type=sources",getUsers:b+"xml.info?type=users",getSiteInfo:b+"xml.info?type=site",schemaInfo:b+"xml.schema.info",getZ3950repositories:b+"xml.info?type=z3950repositories",getCategories:b+"xml.info?type=categories",getHarvesters:b+"xml.harvesting.get",rate:b+"xml.metadata.rate",xmlConfig:b+"xml.config.get",admin:b+"admin",xmlError:b+"xml.main.error",searchKeyword:b+"xml.search.keywords",getThesaurus:b+"xml.thesaurus.getList",getKeyword:b+"xml.keyword.get",searchCRS:b+"crs.search",getCRSTypes:b+"crs.types",logoAdd:b+"logo.add",logoUrl:this.URL+"/images/logos/",imgUrl:this.URL+"/images/",harvesterLogoUrl:this.URL+"/images/harvesting/"};
this.extentMap=new GeoNetwork.map.ExtentMap();this.addEvents("selectionchange","afterLogin","afterLogout","afterBadLogin","afterBadLogout","afterDelete");GeoNetwork.Catalogue.superclass.constructor.call(this,a);},setServiceUrl:function(b,a){this.services[b]=this.services.rootUrl+a;},isIdentified:function(){return !this.identifiedUser?false:true;},isAdmin:function(){return this.adminUser;},onAfterLogin:function(){this.fireEvent("afterLogin",this,this.isIdentified());},onAfterBadLogin:function(){this.fireEvent("afterBadLogin",this,this.isIdentified());},onAfterLogout:function(){this.fireEvent("afterLogout",this,this.isIdentified());},onAfterBadLogout:function(){this.fireEvent("afterBadLogout",this,this.isIdentified());},onAfterDelete:function(){this.fireEvent("afterDelete",this);},onAfterRating:function(){this.fireEvent("afterRating",this);},setSelectedRecords:function(a){this.selectedRecords=parseInt(a,10);this.onSelectionChange();},getSelectedRecords:function(){return this.selectedRecords;},onSelectionChange:function(){this.fireEvent("selectionchange",this,this.getSelectedRecords());},getInfo:function(){var e={};var b=["name","organization","siteId"];var d=OpenLayers.Request.GET({url:this.services.getSiteInfo,async:false});if(d.responseXML){var a=d.responseXML.documentElement;Ext.each(b,function(g,f){e[g]=a.getElementsByTagName(g)[0].childNodes[0].nodeValue;});}return e;},updateStatus:function(b){if(this.statusBarId){var a=Ext.getCmp(this.statusBarId);if(a){a.update(b);return;}a=Ext.getDom(this.statusBarId);if(a){a.innerHTML=b;return;}}},search:function(f,g,a,j,h,e,b,d){var l=this.metadataStore===e;if(l){this.updateStatus(OpenLayers.i18n("searching"));}if(h!==false){h=true;}if(!j){j=this.startRecord;}if(!g){g=Ext.emptyFn;}if(!a){a=Ext.emptyFn;}if(e===undefined){e=this.metadataStore;}if(b===undefined){b=this.summaryStore;}if(h){e.removeAll();}if(typeof f==="object"){GeoNetwork.util.SearchTools.doQueryFromParams(f,this,j,g,a,h,e,b,d);}else{GeoNetwork.util.SearchTools.doQueryFromForm(f,this,j,g,a,h,e,b,d);}},kvpSearch:function(h,j,e,b,g,a,f,d){if(g!==false){g=true;}if(!b){b=this.startRecord;}if(!j){j=Ext.emptyFn;}if(!e){e=Ext.emptyFn;}if(!a){a=this.metadataStore;}if(!f){f=this.summaryStore;}if(g){a.removeAll();}GeoNetwork.util.SearchTools.doQuery(h,this,b,j,e,g,a,f,d);},cswSearch:function(e,d,b,a){this.metadataCSWStore.removeAll();if(d){d=Ext.emptyFn;}if(b){b=Ext.emptyFn;}if(a){a=this.startRecord;}GeoNetwork.util.CSWSearchTools.doCSWQueryFromForm(e,this,a,d,null,b);},metadataSelect:function(d,b){this.setSelectedRecords(0);var e=this;var a=0;for(a=0;a<b.length;a++){OpenLayers.Request.GET({url:this.services.mdSelect,params:{id:b[a],selected:d},success:function(g){var f=g.responseXML.documentElement.getElementsByTagName("Selected")[0].childNodes[0].nodeValue;if(f){e.setSelectedRecords(f);}},failure:function(f){Ext.Msg.alert("Selection failed",f.responseText);}});}},metadataRate:function(b,a,d){OpenLayers.Request.GET({url:this.services.rate,params:{uuid:b,rating:a},success:function(f){var e=f.responseXML.documentElement.childNodes[0].nodeValue;if(d){d(e);}catalogue.onAfterRating();return e;},failure:function(e){Ext.Msg.alert("Rating failed",e.responseText);}});},metadataSelectAll:function(a){this.metadataSelection("add-all",a);},metadataSelectNone:function(a){this.metadataSelection("remove-all",a);},metadataSelection:function(a,d){var b=this;OpenLayers.Request.GET({url:this.services.mdSelect,params:{selected:a},success:function(f){var e=f.responseXML.documentElement.getElementsByTagName("Selected")[0].childNodes[0].nodeValue;if(e){b.setSelectedRecords(e);}if(d){d();}},failure:function(e){}});},csvExport:function(){window.open(this.services.csv,this.windowName,this.windowOption);},mefExport:function(){location.replace(this.services.mef);},pdfExport:function(){location.replace(this.services.pdf);},metadataShow:function(a,e,d,l){var b=this.services.mdView+"?uuid="+escape(a);var h=Ext.getBody();if(this.resultsView){var f=this.metadataStore.getAt(this.metadataStore.find("uuid",a));if(!f){var j=GeoNetwork.data.MetadataResultsFastStore();this.kvpSearch("fast=index&_uuid="+a,null,null,null,true,j,null,false);f=j.getAt(j.find("uuid",a));}var g=new GeoNetwork.view.ViewWindow({serviceUrl:b,lang:this.lang,currTab:GeoNetwork.defaultViewMode||"simple",printDefaultForTabs:GeoNetwork.printDefaultForTabs||false,catalogue:this,maximized:e||false,metadataUuid:a,record:f,resultsView:this.resultsView});g.show(this.resultsView);g.alignTo(h,"tr-tr");}else{window.open(this.services.mdShow+"?uuid="+a,this.windowName,this.windowOption);}},metadataShowById:function(j,d,g,a){var f=this.services.mdView+"?id="+j,b;if(this.resultsView){if(!b){var e=GeoNetwork.data.MetadataResultsFastStore();this.kvpSearch("fast=index&_id="+j,null,null,null,true,e,null,false);b=e.getAt(e.find("id",j));}var h=new GeoNetwork.view.ViewWindow({serviceUrl:f,currTab:GeoNetwork.defaultViewMode||"simple",catalogue:this,maximized:d||false,record:b,metadataUuid:b.get("uuid"),resultsView:this.resultsView});h.show(this.resultsView);h.alignTo(Ext.getBody(),"r-r");}},metadataXMLShow:function(d,e){var a=this.services.mdXMLGet;if(e==="iso19139"){a=this.services.mdXMLGet19139;}else{if(e==="dublin-core"){a=this.services.mdXMLGetDC;}else{if(e==="fgdc"){a=this.services.mdXMLGetFGDC;}else{if(e==="iso19115"){a=this.services.mdXMLGet19115;}}}}var b=a+"?uuid="+d;window.open(b,this.windowName,this.windowOption);},metadataPrint:function(b){var a=this.services.mdPrint+"?uuid="+b;location.replace(a);},metadataMEF:function(b){var a=this.services.mdMEF+"?version=2&uuid="+b;location.replace(a);},metadataEdit:function(f,b,d,e,a){switch(this.editMode){case this.EDITOR_MODE.IN_EDITOR_POPUP:if(this.metadataEditFn){this.metadataEditFn(f,b,d,e,a);}break;default:window.open(this.services.mdEdit+"?id="+f,this.windowName,this.windowOption);}},metadataDuplicate:function(a){window.open(this.services.mdDuplicate+"?uuid="+a,this.windowName,this.windowOption);},metadataCreateChild:function(a){window.open(this.services.mdDuplicate+"?child=y&uuid="+a,this.windowName,this.windowOption);},metadataDuplicateWithSchema:function(a,b){window.open(this.services.mdDuplicate+"?uuid="+a+"&schema="+b,this.windowName,this.windowOption);},metadataDelete:function(a){Ext.Msg.confirm(OpenLayers.i18n("deleteRecord"),OpenLayers.i18n("deleteConfirm"),this.metadataDeleteDo,a);},metadataDeleteDo:function(a){if(a==="yes"){var b={uuid:this};catalogue.doAction(catalogue.services.mdDelete,b,OpenLayers.i18n("deleteRecordSuccess"),OpenLayers.i18n("deleteRecordFailure"),catalogue.onAfterDelete.bind(catalogue));}},doAction:function(a,f,g,d,e,b){if(a.indexOf("http")===-1){a=this.services.rootUrl+a;}OpenLayers.Request.GET({url:a,params:f,success:function(h){if(g){Ext.Msg.alert(g,h.responseText);}if(e){e(h);}},failure:function(h){if(d){Ext.Msg.alert(d,h.responseText);}if(b){b(h);}}});},isLoggedIn:function(){var a=OpenLayers.Request.GET({url:this.services.admin,async:false}),d;d=a.responseText.indexOf("Exception")!==-1;if(a.status===200&&!d){this.identifiedUser={firstName:"",surName:"",role:""};this.onAfterLogin();return true;}else{if(a.status===404){this.showError(OpenLayers.i18n("connectIssue"),OpenLayers.i18n("connectIssueMsg")+this.services.rootUrl+".");}else{if(d){this.checkError();return false;}else{var b=Ext.state.Manager.getProvider();if(b){b.set("user",undefined);}return false;}}}},login:function(e,b){var d=this,a;OpenLayers.Request.GET({url:this.services.login,params:{username:e,password:b,info:"true"},success:function(f){a=f.responseXML.getElementsByTagName("record")[0];d.identifiedUser={username:a?a.getElementsByTagName("username")[0].firstChild.nodeValue:"-",name:a?a.getElementsByTagName("name")[0].firstChild.nodeValue:"-",surname:a?a.getElementsByTagName("surname")[0].firstChild.nodeValue:"-",role:a?a.getElementsByTagName("profile")[0].firstChild.nodeValue:"guest"};d.onAfterLogin();},failure:function(f){d.identifiedUser=undefined;d.onAfterBadLogin();}});},logout:function(){var a=this;
OpenLayers.Request.GET({url:this.services.logout,success:function(b){a.identifiedUser=undefined;a.onAfterLogout();},failure:function(b){a.identifiedUser=undefined;a.onAfterBadLogout();}});},checkError:function(b){var e=this,a,d;OpenLayers.Request.GET({url:this.services.xmlError,success:function(f){a=e.parseError(f.responseXML);d=a.info+" "+a.exc+"<br/>"+a.stack;e.showError("Catalogue error",d);if(b){b(e,f);}},failure:function(f){e.showError("Catalogue error",f.status);}});},showError:function(b,a){Ext.MessageBox.show({title:b,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});},parseError:function(b){var a=b.getElementsByTagName("error")[0];return{stack:a.getElementsByTagName("Stack")[0].firstChild.nodeValue,exc:a.getElementsByTagName("Exception")[0].firstChild.nodeValue,resource:a.getElementsByTagName("Resource")[0].firstChild.nodeValue,msg:a.getElementsByTagName("Message")[0].firstChild.nodeValue,provider:a.getElementsByTagName("Provider")[0].firstChild.nodeValue,info:a.getElementsByTagName("Error")[0].firstChild.nodeValue};},admin:function(){location.replace(this.adminAppUrl);},metadataImport:function(){location.replace(this.services.mdImport);},massiveOp:function(d,a){var b=this.services.massiveOp[d];this.modalAction(OpenLayers.i18n("massiveOp")+" - "+d,b,a);},modalAction:function(e,b,a){if(b){var d=new Ext.Window({id:"modalWindow",layout:"fit",width:700,height:400,closeAction:"destroy",plain:true,modal:true,draggable:false,title:e,items:new Ext.Panel({autoLoad:{url:b,callback:a,scope:d},border:false,frame:false})});d.show(this);d.alignTo(Ext.getBody(),"t-t");}},metadataAdmin:function(b){var a=this.services.mdAdmin+"?id="+b;this.modalAction(OpenLayers.i18n("setPrivileges"),a);},metadataCategory:function(b){var a=this.services.mdCategory+"?id="+b;this.modalAction(OpenLayers.i18n("setCategories"),a);},metadataPrepareDownload:function(b){var a=this.services.prepareDownload+"?id="+b;this.modalAction(OpenLayers.i18n("prepareDownload"),a);}});Ext.reg("gn_catalogue",GeoNetwork.Catalogue);Ext.namespace("GeoNetwork.util");GeoNetwork.util.HelpTools={fields:[{name:"name",mapping:"@name"},{name:"id",mapping:"@id"},{name:"label"},{name:"description"},{name:"help",convert:function(b,a){var f=[],e,d;var h=a.getElementsByTagName("help");for(e=0;e<h.length;e++){var g=h[e].getElementsByTagName("p");if(g.length!==0){for(d=0;d<h.length;d++){f.push(g[d].firstChild.nodeValue);}}else{if(h[e].firstChild){f.push(h[e].firstChild.nodeValue);}}}return f;}},{name:"example"},{name:"helper",convert:function(d,a){var f=[],g,e;var b=a.getElementsByTagName("helper");if(b.length===1){var h=b[0].getElementsByTagName("option");for(e=0;e<h.length;e++){f.push({title:h[e].getAttribute("title"),label:h[e].firstChild.nodeValue,value:h[e].getAttribute("value")});}}return f;}}],Templates:{SIMPLE:['<div class="help">{description}',"<tpl if=\"values.example != ''\">","<div><span>"+OpenLayers.i18n("example")+"</span> {example}</div>","</tpl></div>"],COMPLETE:['<div class="help"><span class="title">{label}</span>',"<div>{description}</div>",'<tpl for="help">',"<div>{.}</div>","</tpl>","<tpl if=\"values.example != ''\">","<div><span>"+OpenLayers.i18n("example")+"</span> {example}</div>","</tpl>","<tpl if=\"values.helper != ''\">","<div><span>"+OpenLayers.i18n("helper")+"</span><ul>",'<tpl for="helper">','<li title="{values.title}">{values.label}</li>',"</tpl>","</ul></div>","</tpl>","<div>"+OpenLayers.i18n("tagName")+" {name}</div>","</div>"]},get:function(g,d,b,a){var f=g.split("|"),e='<request><element schema="'+d+'" name="'+f[1]+'" context="'+f[2]+'" fullContext="'+f[3]+'" isoType="'+f[4]+'" /></request>';d=d||f[0].split(".")[1]||"iso19139";OpenLayers.Request.POST({url:b,data:e,success:function(h){var j=h.responseXML.getElementsByTagName("element");if(j[0]&&j[0].getAttribute("error")==="not-found"){return;}var m=new Ext.data.XmlReader({record:"element",fields:GeoNetwork.util.HelpTools.fields});var l=m.readRecords(h.responseXML);if(a){a(l);}}});}};Ext.namespace("GeoNetwork.util");GeoNetwork.util.SearchTools={fast:"false",output:"full",sortBy:"relevance",hitsPerPage:"50",doQuery:function(g,l,j,f,a,h,e,b,d){OpenLayers.Request.GET({url:l.services.rootUrl+e.service+"?"+g,async:d===false?false:true,success:function(m){if(h){var u=new OpenLayers.Format.GeoNetworkRecords();var o=u.read(m.responseText);var q=o.records;var s=l.metadataStore===e,t=l.summaryStore===b;if(q.length>0){e.loadData(o);}if(t){var r=o.summary;if(r&&r.count>0&&b){b.loadData(r);}}if(l&&s){l.updateStatus(o.from+"-"+o.to+OpenLayers.i18n("resultBy")+r.count);}}if(f){f(m,g);}},failure:function(m){if(a){a(m);}}});},doQueryFromForm:function(m,l,j,f,a,h,e,b,d){var g=GeoNetwork.util.SearchTools.buildQueryFromForm(Ext.getCmp(m),j,GeoNetwork.util.SearchTools.sortBy,e.fast);GeoNetwork.util.SearchTools.doQuery(g,l,j,f,a,h,e,b,d);},doQueryFromParams:function(f,o,m,h,b,l,g,d,e){var a=[],j;GeoNetwork.util.SearchTools.addFiltersFromPropertyMap(f,a,m);j=GeoNetwork.util.SearchTools.buildQueryGET(a,m,GeoNetwork.util.SearchTools.sortBy,g.fast);GeoNetwork.util.SearchTools.doQuery(j,o,m,h,b,l,g,d,e);},buildQueryFromForm:function(f,d,g,b){var a=GeoNetwork.util.SearchTools.getFormValues(f);var e=[];GeoNetwork.util.SearchTools.addFiltersFromPropertyMap(a,e,d);return GeoNetwork.util.SearchTools.buildQueryGET(e,d,g,b);},populateFormFromParams:function(a,b){a.cascade(function(e){if(e.getName){var d=e.getName();if(d.indexOf("_")!==-1){d=d.substring(2);if(b[d]){e.setValue(b[d]);}}else{if(b[d]){e.setValue(b[d]);}}}});},addFiltersFromPropertyMap:function(l,a,f){var e=".8",j,b=l.E_similarity,d=l.E_hitsperpage;if(b!==undefined){e=l.E_similarity;GeoNetwork.util.SearchTools.addFilter(a,"E_similarity",e);}if(!d){d=GeoNetwork.util.SearchTools.hitsPerPage;}var h=parseInt(f,10)+parseInt(d,10)-1;GeoNetwork.util.SearchTools.addFilter(a,"E_from",f);GeoNetwork.util.SearchTools.addFilter(a,"E_to",h);for(j in l){if(l.hasOwnProperty(j)){var g=l[j];if(g!==""&&j!=="E_similarity"){GeoNetwork.util.SearchTools.addFilter(a,j,g);}}}},addFilter:function(d,b,f){var h=b.match("^(\\[?)([^_]+)_(.*)$"),a,g=[];if(h){var e=h[3].split("|");for(a=0;a<e.length;++a){GeoNetwork.util.SearchTools.addFilterImpl(d,h[2],e[a],f);}}},addFilterImpl:function(d,b,a,e){if(b.charAt(0)==="E"){d.push(a+"="+encodeURIComponent(e)+"");}else{if(b==="B"){d.push(a+"="+(e?"on":"off")+"");}else{if(b==="O"){if(e){d.push(a+"=on");}}else{alert("Cannot parse "+b);}}}},sortByMappings:{relevance:{name:"relevance",order:""},rating:{name:"changeDate",order:""},popularity:{name:"popularity",order:""},date:{name:"date",order:""},title:{name:"title",order:"reverse"}},buildQueryGET:function(d,b,f,a){var e="fast="+(a?a:GeoNetwork.util.SearchTools.fast)+"&";if(d){e+=d.join("&");}return e;},getFormValues:function(b){var a=b.getForm().getValues()||{};b.cascade(function(e){if(e.disabled!==true&&e.rendered){if(e.isXType("boxselect")){if(e.getValue&&e.getValue()){a[e.getName()]=e.getValue();}}else{if(e.isXType("combo")){if(e.getValue&&e.getValue()){a[e.getName()]=e.getValue();}}else{if(e.isXType("fieldset")){if(e.checkbox){a[e.checkboxName]=!e.collapsed;}}else{if(e.isXType("radiogroup")){var d=e.items.get(0);a[d.getName()]=d.getGroupValue();}else{if(e.isXType("checkbox")){a[e.getName()]=e.getValue();}else{if(e.isXType("datefield")){if(e.getValue()!==""){a[e.getName()]=e.getValue().format("Y-m-d")+(e.postfix?e.postfix:"");}}else{if(e.getName){if(e.getValue&&e.getValue()!==""){a[e.getName()]=e.getValue();}}}}}}}}}return true;});return a;}};var translations={};function translate(a){return translations[a]||a;}function checkAllInputsIn(e,b){var d=Ext.getDom(e).getElementsByTagName("input"),a;for(a=0;a<d.length;a++){d[a].checked=b;}}function setAll(a){checkAllInputsIn(a,true);}function clearAll(a){checkAllInputsIn(a,false);}function checkBoxModalUpdate(g,a,f,e){var d=Ext.DomQuery.select('input[type="checkbox"]');var b="?";if(a==="metadata.admin"||a==="metadata.category"){b+="id="+Ext.getDom("metadataid").value;}Ext.each(d,function(h){if(h.checked&&h.name!=""){b+="&"+h.name+"=on";
}});catalogue.doAction(a+b,null,null,e,function(h){Ext.getDom(g).innerHTML=h.responseText;if(a==="metadata.admin"||a==="metadata.category"){Ext.getCmp("modalWindow").close();}},null);}function addGroups(b){var f=b.getElementsByTagName("group"),e;Ext.getDom("group").options.length=0;for(e=0;e<f.length;e++){var g=f[e].getElementsByTagName("id")[0].firstChild.nodeValue;var a=f[e].getElementsByTagName("name")[0].firstChild.nodeValue;var d=document.createElement("option");d.text=a;d.value=g;if(f.length===1){d.selected=true;}Ext.getDom("group").options.add(d);}}function doGroups(a){catalogue.doAction("xml.usergroups.list?id="+a,null,null,"Error retrieving groups",function(d){if(d.nodeName==="error"){Ext.getDom("group").options.length=0;Ext.getDom("group").value="";var b=Ext.getDom("user");for(i=0;i<b.options.length;i++){b.options[i].selected=false;}}else{addGroups(d.responseXML);}});}function checkMassiveNewOwner(b,e){var a=Ext.getDom("user").value;var d=Ext.getDom("group").value;if(a===""){Ext.Msg.alert(e,"selectNewOwner");return false;}if(d.value===""){Ext.Msg.alert(e,"selectOwnerGroup");return false;}catalogue.doAction(b+"?user="+a+"&group="+d,null,null,null,function(f){Ext.getDom("massivenewowner").parentNode.innerHTML=f.responseText;});}function doDownload(h,f){var g=Ext.getDom("downloadlist").getElementsByTagName("INPUT"),d="&id="+h+"&access=private",e=false;for(var b=0;b<g.length;b++){if(g[b].checked||f!==null){e=true;var a=g[b].getAttribute("name");d+="&fname="+a;}}if(!e){Ext.Msg.alert("Alert",OpenLayers.i18n("selectOneFile"));return;}catalogue.doAction(catalogue.services.fileDisclaimer+"?"+d,null,null,null,function(j){Ext.getDom("downloadlist").parentNode.innerHTML=j.responseText;});}function feedbackSubmit(){var a=Ext.getDom("feedbackf");catalogue.doAction(catalogue.services.fileDownload+"?"+Ext.Ajax.serializeForm(a),null,null,null,function(b){Ext.getDom("feedbackf").parentNode.innerHTML=b.responseText;});}function goSubmit(a){document.forms[a].submit();}Ext.namespace("GeoNetwork.util");GeoNetwork.util.INSPIRESearchFormTools={getAnnexField:function(d){var b=[["i","I"],["ii","II"],["iii","III"]],a={id:"inspireannex",name:"E_inspireannex",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("inspireannex"),store:new Ext.data.ArrayStore({id:0,fields:["id","label"],data:b}),valueField:"id",displayField:"label"};if(d){Ext.apply(a,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(a);}else{return new Ext.form.ComboBox(a);}},getRelatedField:function(){var a=new Ext.form.Checkbox({hideLabel:true,boxLabel:OpenLayers.i18n("inspirerelated"),tabTip:OpenLayers.i18n("inspirerelatedtt"),name:"O_inspirerelated"});return a;},getThemesFieldWithSuggestion:function(a){var b=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:a.opensearchSuggest,field:"inspiretheme",name:"E_inspiretheme",fieldLabel:OpenLayers.i18n("inspiretheme")});return b;},getThemesField:function(e,g){var a,d,f;a=Ext.data.Record.create([{name:"id"},{name:"value"},{name:"definition"},{name:"uri"}]);d=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:e.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pKeyword:"*",pThesauri:"external.theme.inspire-theme",pMode:"searchBox",maxResults:"35"},reader:new Ext.data.XmlReader({record:"keyword",id:"id"},a),fields:["id","value","definition","uri"],sortInfo:{field:"value"}});d.load();var b={id:"inspiretheme",name:"E_inspiretheme",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("inspiretheme"),store:d,valueField:"value",displayField:"value"};if(g){Ext.apply(b,{valueDelimiter:" or ",stackItems:true});return new Ext.ux.form.SuperBoxSelect(b);}else{return new Ext.form.ComboBox(b);}},getINSPIREFields:function(a,b){return[this.getAnnexField(b),this.getThemesField(a,b),this.getRelatedField()];}};Ext.namespace("GeoNetwork.util");GeoNetwork.util.SearchFormTools={getSimpleFormFields:function(j,d,a,h,e,g,l,b){var f=[];if(j){f.push(new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:true,width:285,minChars:2,loadingText:"...",hideTrigger:true,url:j.opensearchSuggest,listeners:{}}));}else{f.push(GeoNetwork.util.SearchFormTools.getFullTextField());}if(h){f.push(GeoNetwork.util.SearchFormTools.getTypesField(g,true));}if(d){f.push(GeoNetwork.util.SearchFormTools.getSimpleMap(d,a,e,l,b));}f.push(GeoNetwork.util.SearchFormTools.getOptions());return f;},getAdvancedFormFields:function(d,m,H){var B=[],C,j,v;if(d){C=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:true,width:285,minChars:2,loadingText:"...",hideTrigger:true,url:d.opensearchSuggest});v=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:d.opensearchSuggest,field:"orgName",name:"E_orgName",fieldLabel:OpenLayers.i18n("org")});j=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:d.opensearchSuggest,field:"keyword",name:"E_themekey",fieldLabel:OpenLayers.i18n("keyword")});}else{C=GeoNetwork.util.SearchFormTools.getFullTextField();j=GeoNetwork.util.SearchFormTools.getKeywordsField();v=GeoNetwork.util.SearchFormTools.getOrgNameField();}var r=GeoNetwork.util.SearchFormTools.getAdvancedTextFields();var e=GeoNetwork.util.SearchFormTools.getTitleField();var t=GeoNetwork.util.SearchFormTools.getAbstractField();var s=GeoNetwork.util.SearchFormTools.getTypesField();var z={xtype:"fieldset",title:OpenLayers.i18n("mapTypes"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:true,defaultType:"checkbox",defaults:{width:160},items:GeoNetwork.util.SearchFormTools.getMapTypesField()};var h={xtype:"fieldset",title:OpenLayers.i18n("similarity"),autoHeight:true,autoWidth:true,layout:"column",collapsible:true,collapsed:true,items:[GeoNetwork.util.SearchFormTools.getSimilarityField()]};var b=new Ext.form.TextField({name:"E_geometry",id:"geometry",fieldLabel:OpenLayers.i18n("wkt"),hideLabel:false});var o=[],D;for(D=0;D<m.length;D++){o.push(m[D].clone());}var q={xtype:"gn_geometrymapfield",geometryFieldId:"geometry",id:"geometryMap",layers:o,mapOptions:H};var I=GeoNetwork.util.SearchFormTools.getNearYouButton("geometry");var E=GeoNetwork.util.SearchFormTools.getRelationField();var a=GeoNetwork.util.SearchFormTools.getScaleDenominatorField(true);var F=new Ext.form.FieldSet({title:OpenLayers.i18n("spatialSearch"),autoWidth:true,collapsible:true,collapsed:true,items:[b,I,q,E]});var l=new Ext.form.FieldSet({title:OpenLayers.i18n("when"),autoWidth:true,defaultType:"datefield",collapsible:true,collapsed:true,items:GeoNetwork.util.SearchFormTools.getWhen()});var w=GeoNetwork.util.SearchFormTools.getCatalogueField(d.getSources,d.logoUrl);var G=GeoNetwork.util.SearchFormTools.getGroupField(d.getGroups);var g=GeoNetwork.util.SearchFormTools.getMetadataTypeField();var u=GeoNetwork.util.SearchFormTools.getCategoryField(d.getCategories,null,true);var f=GeoNetwork.util.SearchFormTools.getOptions();B.push(C,r,e,t,j,v,F,s,z,a,l,w,G,g,u,f,h);return B;},getSimpleMap:function(f,d,h,m,e){var j=[],a=[],g;var l=new Ext.form.TextField({name:"E_geometry",id:"geometry",inputType:"hidden"});for(g=0;g<f.length;g++){a.push(f[g].clone());}var b={xtype:"gn_geometrymapfield",geometryFieldId:"geometry",id:"geometryMap",layers:a,mapOptions:d,activated:h};if(m){Ext.applyIf(b,m);}j.push(l,b);if(e){j.push(GeoNetwork.util.SearchFormTools.getRelationField());}return j;},getOptions:function(f){var a=f||[["10"],["20"],["50"],["100"]];var e=GeoNetwork.util.SearchFormTools.getSortByCombo();var d=new Ext.form.ComboBox({id:"E_hitsperpage",name:"E_hitsperpage",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("hitsPerPage"),value:a[1],store:new Ext.data.ArrayStore({id:0,fields:["id"],data:a}),valueField:"id",displayField:"id"});var b=new Ext.form.FieldSet({title:"Options",autoWidth:true,collapsible:true,collapsed:true,defaults:{width:160},items:[e,d]});return b;},getSortByCombo:function(){var b=new Ext.form.TextField({name:"E_sortBy",id:"E_sortBy",inputType:"hidden"});
var a=new Ext.form.TextField({name:"E_sortOrder",id:"sortOrder",inputType:"hidden"});var d=new Ext.form.ComboBox({mode:"local",fieldLabel:OpenLayers.i18n("sortBy"),triggerAction:"all",value:"relevance",store:GeoNetwork.util.SearchFormTools.getSortByStore(),valueField:"id",displayField:"name",listeners:{change:function(e,h,f){var g=h.split("#");b.setValue(g[0]);a.setValue(g[1]);}}});return[b,a,d];},getSortByStore:function(){return new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["relevance#",OpenLayers.i18n("relevance")],["title#reverse",OpenLayers.i18n("title")],["changeDate#",OpenLayers.i18n("changeDate")],["rating#",OpenLayers.i18n("rating")],["popularity#",OpenLayers.i18n("popularity")],["denominator#",OpenLayers.i18n("scaleDesc")],["denominator#revers",OpenLayers.i18n("scaleAsc")]]});},getFullTextField:function(){return new Ext.form.TextField({name:"E_any",id:"E_any",fieldLabel:OpenLayers.i18n("fullTextSearch"),hideLabel:false});},getTitleField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_title",OpenLayers.i18n("title"));},getAbstractField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_abstract",OpenLayers.i18n("abstract"));},getKeywordsField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_themekey",OpenLayers.i18n("keyword"));},getOrgNameField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_orgName",OpenLayers.i18n("org"));},getTextField:function(b,a){return new Ext.form.TextField({name:b,fieldLabel:a,hideLabel:false});},getCatalogueField:function(e,g,f){var a=GeoNetwork.data.CatalogueSourceStore(e),d='<tpl for="."><div class="x-combo-list-item logo"><img src="'+g+'{id}.gif"/>{name}</div></tpl>';a.load();var b={name:"E_siteId",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("catalogue"),store:a,valueField:"id",displayField:"name",tpl:d};if(f){Ext.apply(b,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:'<img style="max-width:16px;" src="'+g+'{id}.gif"/>{name}'});return new Ext.ux.form.SuperBoxSelect(b);}else{return new Ext.form.ComboBox(b);}},getGroupField:function(d,f){var e=GeoNetwork.data.GroupStore(d),b='<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>";e.load();var a={name:"E_group",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:e,valueField:"id",displayField:"name",tpl:b};if(f){Ext.apply(a,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:"{[values.label."+OpenLayers.Lang.getCode()+"]}"});return new Ext.ux.form.SuperBoxSelect(a);}else{return new Ext.form.ComboBox(a);}},getMetadataTypeField:function(b){var a={name:"E_template",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("kind"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["n",OpenLayers.i18n("md")],["y",OpenLayers.i18n("tpl")]]}),valueField:"id",displayField:"name"};if(b){Ext.apply(a,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(a);}else{return new Ext.form.ComboBox(a);}},getCategoryField:function(f,h,g){var a=GeoNetwork.data.CategoryStore(f);a.load();var e=(h?'<tpl for="."><div class="x-combo-list-item"><img src="'+h+'{name}.png"/>{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>":'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>");var d={name:"E_category",mode:"local",fieldLabel:OpenLayers.i18n("category"),triggerAction:"all",store:a,valueField:"name",displayField:"name",tpl:e};if(g){var b=(h?'<img src="'+h+'{name}.png"/>{[values.label.'+OpenLayers.Lang.getCode()+"]}":"{[values.label."+OpenLayers.Lang.getCode()+"]}");Ext.apply(d,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:b});return new Ext.ux.form.SuperBoxSelect(d);}else{return new Ext.form.ComboBox(d);}},getAdvancedTextFields:function(){return{xtype:"fieldset",title:OpenLayers.i18n("advTextSearch"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:true,defaultType:"textfield",items:[{name:"E_or",fieldLabel:OpenLayers.i18n("eitherWords"),hideLabel:false},{name:"E_phrase",fieldLabel:OpenLayers.i18n("exactPhrase"),hideLabel:false},{name:"E_all",fieldLabel:OpenLayers.i18n("allWords"),hideLabel:false},{name:"E_without",fieldLabel:OpenLayers.i18n("withoutWords"),hideLabel:false}]};},getSimilarityField:function(){return{xtype:"radiogroup",items:[{xtype:"label",text:OpenLayers.i18n("precise")},{name:"E_similarity",inputValue:1},{name:"E_similarity",inputValue:0.8,checked:true},{name:"E_similarity",inputValue:0.6},{name:"E_similarity",inputValue:0.4},{name:"E_similarity",inputValue:0.2},{xtype:"label",text:OpenLayers.i18n("imprecise")}]};},getRelationField:function(){return new Ext.form.ComboBox({name:"E_relation",mode:"local",width:150,triggerAction:"all",fieldLabel:OpenLayers.i18n("relationType"),store:new Ext.data.ArrayStore({id:0,fields:["relation","label"],data:[["",""],["intersection",OpenLayers.i18n("intersection")],["overlaps",OpenLayers.i18n("overlaps")],["encloses",OpenLayers.i18n("encloses")],["fullyOutsideOf",OpenLayers.i18n("fullyOutsideOf")],["crosses",OpenLayers.i18n("crosses")],["touches",OpenLayers.i18n("touches")],["within",OpenLayers.i18n("within")]]}),valueField:"relation",displayField:"label"});},getNearYouButton:function(a){return new Ext.Button({text:OpenLayers.i18n("nearYou"),iconCls:"md-mn mn-user-location",iconAlign:"right",listeners:{click:function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(b){Ext.getCmp(a).setValue("POINT("+b.coords.latitude+" "+b.coords.longitude+")");});}}}});},registerDateVtype:function(){if(Ext.form.VTypes.daterange){return;}Ext.apply(Ext.form.VTypes,{daterange:function(e,d){var b=d.parseDate(e);if(!b){return false;}if(d.startDateField&&(!this.dateRangeMax||(b.getTime()!==this.dateRangeMax.getTime()))){var f=Ext.getCmp(d.startDateField);f.setMaxValue(b);f.validate();this.dateRangeMax=b;}else{if(d.endDateField&&(!this.dateRangeMin||(b.getTime()!==this.dateRangeMin.getTime()))){var a=Ext.getCmp(d.endDateField);a.setMinValue(b);a.validate();this.dateRangeMin=b;}}return true;}});},getWhen:function(){var b=new Ext.form.Checkbox({name:"timeType",checked:true,fieldLabel:OpenLayers.i18n("anyTime"),handler:function(d,e){d.ownerCt.items.each(function(h,f,g){if(e&&h.getXType()==="datefield"){h.setValue("");}});}});var a=[b,{xtype:"label",text:OpenLayers.i18n("mdChangeDate")}];a.push(GeoNetwork.util.SearchFormTools.getMetadataDateField(b));a.push({xtype:"label",text:OpenLayers.i18n("tempExtent")});a.push(GeoNetwork.util.SearchFormTools.getTemporalExtentField(b));return a;},getMetadataDateField:function(a){GeoNetwork.util.SearchFormTools.registerDateVtype();return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_dateFrom","from","dateFrom","E_dateTo","to","dateTo",a);},getTemporalExtentField:function(a){GeoNetwork.util.SearchFormTools.registerDateVtype();return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_extFrom","from","extFrom","E_extTo","to","extTo",a);},getDateRangeFields:function(d,f,j,h,g,b,e){GeoNetwork.util.SearchFormTools.registerDateVtype();var a=function(o,m,l){if(this&&m!==""){this.setValue(false);}};return[{fieldLabel:OpenLayers.i18n(f),name:d,id:j,width:120,vtype:"daterange",endDateField:b,format:"d/m/Y",listeners:{change:a,scope:e}},{fieldLabel:OpenLayers.i18n(g),name:h,id:b,width:120,vtype:"daterange",startDateField:j,format:"d/m/Y",listeners:{change:a,scope:e}}];},getScaleDenominatorField:function(e,f,h,l,d){f=f||1000;h=h||1000000;l=l||1000;d=d||230;var j=new Ext.slider.Tip({getText:function(o){return String.format("<b>"+OpenLayers.i18n("scaleNominator")+"{0}</b>",o.value);}});var g=new Ext.form.Field({name:"E_denominatorFrom",value:"",hidden:true});var m=new Ext.form.Field({name:"E_denominatorTo",value:"",hidden:true});var b=new Ext.slider.MultiSlider({disabled:e?true:false,width:d,minValue:f,maxValue:h,increment:l,values:[f,h],formFields:[g,m],plugins:j,listeners:{change:function(q,r,o){q.formFields[o.index].setValue(r);}}});
var a=new Ext.form.Checkbox({fieldLabel:OpenLayers.i18n("scale"),value:e?true:false,handler:function(o,q){b.setDisabled(!q);if(!q){g.setValue("");m.setValue("");}}});return[g,m,a,b];},getMapTypesField:function(){var a=GeoNetwork.util.SearchFormTools.getSpatialRepresentationTypeField(null,true);return[{hideLabel:true,boxLabel:OpenLayers.i18n("digital"),name:"B_digital"},{hideLabel:true,boxLabel:OpenLayers.i18n("hardCopy"),name:"B_paper"},{hideLabel:true,boxLabel:OpenLayers.i18n("downloadable"),name:"B_download"},{hideLabel:true,boxLabel:OpenLayers.i18n("interactive"),name:"B_dynamic"},a];},getValidField:function(b){var a={name:"E__valid",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("validationStatus"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["1",OpenLayers.i18n("valid")],["0",OpenLayers.i18n("notValid")],["-1",OpenLayers.i18n("notDetermined")]]}),valueField:"id",displayField:"name"};if(b){Ext.apply(a,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(a);}else{return new Ext.form.ComboBox(a);}},getTypesField:function(d,e){var b=[["dataset",OpenLayers.i18n("dataset")],["series",OpenLayers.i18n("series")],["service",OpenLayers.i18n("service")]],a={name:"E_type",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("resourceType"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:d||b}),valueField:"id",displayField:"name"};if(e){Ext.apply(a,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(a);}else{return new Ext.form.ComboBox(a);}},getSpatialRepresentationTypeField:function(d,e){var b=[["grid",OpenLayers.i18n("grid")],["stereoModel",OpenLayers.i18n("stereoModel")],["tin",OpenLayers.i18n("tin")],["textTabled",OpenLayers.i18n("textTable")],["vector",OpenLayers.i18n("vector")],["video",OpenLayers.i18n("video")]],a={name:"E_spatialRepresentationType",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("spatialRepType"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:d||b}),valueField:"id",displayField:"name"};if(e){Ext.apply(a,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(a);}else{return new Ext.form.ComboBox(a);}}};Ext.namespace("GeoNetwork.util");GeoNetwork.util.CSWSearchTools={cswMethod:"POST",resultsMode:"results_with_summary",sortBy:"",maxRecords:"50",doCSWQueryFromForm:function(j,h,e,f,b,l){var a=h.services.csw;var g=GeoNetwork.util.CSWSearchTools.buildCSWQueryFromForm(GeoNetwork.util.CSWSearchTools.cswMethod,Ext.getCmp(j),e,GeoNetwork.util.CSWSearchTools.sortBy,l);if(GeoNetwork.util.CSWSearchTools.cswMethod==="POST"){var d=GeoNetwork.util.CSWSearchTools.buildCSWQueryFromForm("GET",Ext.getCmp(j),e,GeoNetwork.util.CSWSearchTools.sortBy,l);OpenLayers.Request.POST({url:a,data:g,success:function(m){var q=new OpenLayers.Format.CSWGetRecords.v2_0_2();h.currentRecords=q.read(m.responseText);var o=h.currentRecords.records;if(o.length>0){h.metadataCSWStore.loadData(h.currentRecords);}if(f){f(m,d);}},failure:b});}else{OpenLayers.Request.GET({url:a,params:g,success:function(m){f(m,g);},failure:b});}},buildCSWQueryFromForm:function(j,f,b,h,g){var a=GeoNetwork.util.CSWSearchTools.getFormValues(f);var e=[];GeoNetwork.util.CSWSearchTools.addFiltersFromPropertyMap(a,e);g(a,e);if(e.length===0){e.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:"anyText",value:".*"}));}var d=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:e});if(j==="POST"){return GeoNetwork.util.CSWSearchTools.buildCSWQueryPOST(d,b,h);}else{return GeoNetwork.util.CSWSearchTools.buildCSWQueryGET(d,b,h);}},addFiltersFromPropertyMap:function(b,f){var a=".8",d=b.E_similarity,e;if(d!==null&&d!==undefined){a=b.E_similarity;GeoNetwork.util.CSWSearchTools.addFilter(f,"E_similarity",a,a);}for(e in b){if(b.hasOwnProperty(e)){var g=b[e];if(g!==""&&e!=="E_similarity"){GeoNetwork.util.CSWSearchTools.addFilter(f,e,g,a);}}}},addFilter:function(f,e,g,a){var j=e.match("^(\\[?)([^_]+)_(.*)$"),h=[],d;if(j){if(j[1]==="["){var b=g.split(",");for(d=0;d<b.length;++d){GeoNetwork.util.CSWSearchTools.addFilterImpl(b.length>1?h:f,j[2],j[3],b[d],a);}if(b.length>1){f.push(new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:h}));}}else{GeoNetwork.util.CSWSearchTools.addFilterImpl(f,j[2],j[3],g,a);}}},addFilterImpl:function(f,e,b,g,a){var d;if(e==="S"){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:b,value:g+".*"}));}else{if(e==="C"){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:b,value:".*"+g+".*"}));}else{if(e.charAt(0)==="E"){if(e.length>1){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:e.substring(1)}));}f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:g}));if(e.length>1){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:a}));}}else{if(e===">="){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,property:b,value:g}));}else{if(e==="<="){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:b,value:g}));}else{if(e==="T"){var j=g.split(" ");for(d=0;d<j.length;++d){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:j[d]}));}}else{if(e==="B"){f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:g?1:0}));}else{if(e==="V"){var h=g.match("^([^/]+)/(.*)$");f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:"1.0"}));f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:h[1],value:h[2]}));f.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:a}));}else{alert("Cannot parse "+e);}}}}}}}}},sortByMappings:{relevance:{name:"relevance",order:"D"},rating:{name:"rating",order:"D"},popularity:{name:"popularity",order:"D"},date:{name:"date",order:"D"},title:{name:"title",order:"A"}},buildCSWQueryPOST:function(e,b,g){var a='<?xml version="1.0" encoding="UTF-8"?>\n<csw:GetRecords xmlns:csw="http://www.opengis.net/cat/csw/2.0.2" service="CSW" version="2.0.2" resultType="'+this.resultsMode+'" startPosition="'+b+'" maxRecords="'+this.maxRecords+'">\n  <csw:Query typeNames="csw:Record">\n    <csw:ElementSetName>full</csw:ElementSetName>\n';if(g){var f=GeoNetwork.util.CSWSearchTools.sortByMappings[g];a+='    <ogc:SortBy xmlns:ogc="http://www.opengis.net/ogc">\n      <ogc:SortProperty>\n        <ogc:PropertyName>'+f.name+"</ogc:PropertyName>\n        <ogc:SortOrder>"+f.order+"</ogc:SortOrder>\n      </ogc:SortProperty>\n    </ogc:SortBy>\n";}if(e){var d=new OpenLayers.Format.XML().write(new OpenLayers.Format.Filter().write(e));d=d.replace(/^<\?xml[^?]*\?>/,"");a+='    <csw:Constraint version="1.0.0">\n';a+=d;a+="    </csw:Constraint>\n";}a+="  </csw:Query>\n</csw:GetRecords>";return a;},buildCSWQueryGET:function(e,b,g){var a={request:"GetRecords",service:"CSW",version:"2.0.2",resultType:this.resultsMode,namespace:"csw:http://www.opengis.net/cat/csw/2.0.2",typeNames:"csw:Record",constraintLanguage:"FILTER",constraint_language_version:"1.1.0",elementSetName:"full",startPosition:b,maxRecords:this.maxRecords};if(g){var f=GeoNetwork.util.CSWSearchTools.sortByMappings[g];a.sortBy=f.name+":"+f.order;}if(e){var d=new OpenLayers.Format.XML().write(new OpenLayers.Format.Filter().write(e));d=d.replace(/^<\?xml[^?]*\?>/,"");a.constraint=d;}return a;},getFormValues:function(b){var a=b.getForm().getValues()||{};b.cascade(function(e){if(e.disabled!==true){if(e.isXType("boxselect")){if(e.getValue&&e.getValue()){a[e.getName()]=e.getValue();}}else{if(e.isXType("combo")){if(e.getValue&&e.getValue()){a[e.getName()]=e.getValue();
}}else{if(e.isXType("fieldset")){if(e.checkbox){a[e.checkboxName]=!e.collapsed;}}else{if(e.isXType("radiogroup")){var d=e.items.get(0);a[d.getName()]=d.getGroupValue();}else{if(e.isXType("checkbox")){a[e.getName()]=e.getValue();}else{if(e.isXType("datefield")){if(e.getValue()!==""){a[e.getName()]=e.getValue().format("Y-m-d")+(e.postfix?e.postfix:"");}}else{if(e.getName){if(e.getValue&&e.getValue()!==""){a[e.getName()]=e.getValue();}}}}}}}}}return true;});return a;}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.CatalogueSourceStore=function(a){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"source",idPath:"id",fields:[{name:"id",mapping:"uuid"},{name:"name"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.CategoryStore=function(a){function b(e,d){var l={};var f=d.getElementsByTagName("label");var h;if(f.length===1){var g=f[0].childNodes;var j;for(h=0,len=g.length;h<len;++h){j=g[h];if(j.nodeType===1){l[j.nodeName]=j.firstChild.nodeValue;}}}return l;}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"category",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"name"},{name:"label",convert:b}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.CodeListStore=function(d){var e=d.schema||"iso19139";var f='<request><codelist schema="'+e+'" name="'+d.codeListName+'" /></request>';var b=[{name:"code"},{name:"label"},{name:"description"}];var g=Ext.data.Record.create(b);var a=new Ext.data.Store({fields:b});OpenLayers.Request.POST({url:d.url,data:f,success:function(j){var l=j.responseXML.getElementsByTagName("entry");for(var m=0;m<l.length;m++){var h=new g({code:l[m].getElementsByTagName("code")[0].firstChild.nodeValue,label:l[m].getElementsByTagName("label")[0].firstChild.nodeValue,description:l[m].getElementsByTagName("description")[0].firstChild.nodeValue});a.add(h);}}});return a;};Ext.namespace("GeoNetwork.data");GeoNetwork.data.GroupStore=function(a){function b(e,d){var l={};var h;var f=d.getElementsByTagName("label");if(f.length===1){var g=f[0].childNodes;var j;for(h=0,len=g.length;h<len;++h){j=g[h];if(j.nodeType===1){l[j.nodeName]=j.firstChild.nodeValue;}}}return l;}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"group",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"name"},{name:"description"},{name:"email"},{name:"referrer"},{name:"label",convert:b}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.HarvesterStore=function(a){function b(h,f){var g=[],m,l=f.getElementsByTagName("categories");if(l.length===1){var j=l[0].getElementsByTagName("category");for(m=0;m<j.length;m++){g.push(j[m].getAttribute("id"));}}return g;}function e(h,f){var g=[],j,l=f.getElementsByTagName("operation");for(j=0;j<l.length;j++){var m=l[j];g.push(m.getAttribute("name"));}return g;}function d(h,f){var g=Ext.data.Record.create([{name:"group_id",mapping:"@id"},{name:"operation",convert:e}]);var l=new Ext.data.XmlReader({record:"group"},g);var j=l.readRecords(f);return j;}return new Ext.data.XmlStore({autoDestroy:true,url:a,record:"node",idPath:"@id",fields:[{name:"id",mapping:"@id"},{name:"type",mapping:"@type"},{name:"site_name",mapping:"site/name"},{name:"site_uuid",mapping:"site/uuid"},{name:"site_host",mapping:"site/host"},{name:"site_servlet",mapping:"site/servlet"},{name:"site_port",mapping:"site/port"},{name:"site_url",mapping:"site/url"},{name:"site_icon",mapping:"site/icon"},{name:"site_ogctype",mapping:"site/ogctype"},{name:"options_lang",mapping:"options/lang"},{name:"options_topic",mapping:"options/topic"},{name:"options_createthumbnails",mapping:"options/createthumbnails"},{name:"options_uselayer",mapping:"options/uselayer"},{name:"options_uselayermd",mapping:"options/uselayermd"},{name:"options_datasetcategory",mapping:"options/datasetcategory"},{name:"privileges",convert:d},{name:"categories",convert:b},{name:"site_account_use",mapping:"site/account/use"},{name:"site_account_username",mapping:"site/account/username"},{name:"site_account_password",mapping:"site/account/password"},{name:"options_every",mapping:"options/every"},{name:"options_onerunonly",mapping:"options/onerunonly"},{name:"options_status",mapping:"options/status"},{name:"info_lastrun",mapping:"info/lastRun"},{name:"info_running",mapping:"info/running"},{name:"info_result_total",mapping:"info/result/total"},{name:"info_result_added",mapping:"info/result/added"},{name:"info_result_layer",mapping:"info/result/layer"},{name:"info_result_layerUuidExist",mapping:"info/result/layerUuidExist"},{name:"info_result_layerUsingMdUrl",mapping:"info/result/layerUsingMdUrl"},{name:"info_result_unknownSchema",mapping:"info/result/unknownSchema"},{name:"info_result_removed",mapping:"info/result/removed"},{name:"info_result_unretrievable",mapping:"info/result/unretrievable"},{name:"info_result_badFormat",mapping:"info/result/badFormat"},{name:"info_result_doesNotValidate",mapping:"info/result/doesNotValidate"},{name:"info_result_thumbnails",mapping:"info/result/thumbnails"},{name:"info_result_thumbnailsFailed",mapping:"info/result/thumbnailsFailed"},{name:"error_message",mapping:"error/message"},{name:"error_class",mapping:"error/class"},{name:"error_stack"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataCSWResultsStore=function(){function h(o,m){var q,r;if(m.URI){for(q=0;q<m.URI.length;q++){r=m.URI[q];if(r.name==="thumbnail"){if(r.value.indexOf("http")===-1){return GeoNetwork.Catalogue.URL+"/srv/en/"+r.value;}else{return r.value;}}}}return"";}function b(o,m){var q,r;if(m.URI){for(q=0;q<m.URI.length;q++){r=m.URI[q];if(r.protocol&&r.protocol.indexOf("http-get-capabilities")!==-1){return r.value;}}}return"";}function e(o,m){if(m.geonet_info){return m.geonet_info.source[0];}else{return"";}}function l(o,m){if(m.geonet_info){return m.geonet_info.popularity[0];}else{return"";}}function j(o,m){if(m.geonet_info){return m.geonet_info.rating[0];}else{return"";}}function a(o,m){if(m.geonet_info){return m.geonet_info.download[0];}else{return"";}}function d(o,m){if(m.geonet_info){return m.geonet_info.ownername[0];}else{return"";}}function f(o,m){if(m.geonet_info&&m.geonet_info.is_harvested){return m.geonet_info.is_harvested[0];}else{return"";}}function g(o,m){if(m.geonet_info&&m.geonet_info.edit){return m.geonet_info.edit;}else{return"false";}}return new Ext.data.JsonStore({totalProperty:"SearchResults.numberOfRecordsMatched",root:"records",fields:[{name:"title",mapping:"title[0].value",defaultValue:""},{name:"abstract",mapping:"abstract",defaultValue:""},{name:"subject",mapping:"subject"},{name:"uuid",mapping:"identifier[0].value",defaultValue:""},{name:"thumbnail",convert:h},{name:"uri",mapping:"uri",defaultValue:""},{name:"getCapabilitiesUrl",convert:b},{name:"isharvested",convert:f},{name:"source",convert:e},{name:"rating",convert:j},{name:"popularity",convert:l},{name:"download",convert:a},{name:"ownername",convert:d},{name:"edit",convert:g},{name:"bbox",mapping:"BoundingBox",defaultValue:""}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataRelationStore=function(d,f,e){var b=[{name:"id"},{name:"uuid"},{name:"title"},{name:"abstract"},{name:"keyword"},{name:"type",mapping:"@type"}];if(e){var a=new Ext.data.XmlReader({record:"relation",idProperty:"uuid"},b);return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:d,params:f,disableCaching:false}),reader:a,groupField:"type",sortInfo:{field:"type",direction:"ASC"}});}else{return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:d,disableCaching:false}),record:"relation",idPath:"uuid",fields:b});}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataResultsStore=function(){function l(D,C){if(C.title&&C.title){return C.title[0].value;}else{return"";}}function o(E,D){var F,C=[],G;if(D.geonet_info&&D.geonet_info.valid_details){G=D.geonet_info.valid_details;
for(F=0;F<G.length;F++){C.push({valid:G.status[F].value,type:G.type[F].value,ratio:G.ratio[F].value});}}return C;}function f(E,D){var F;var G="";var C;if(D.image){for(F=0;F<D.image.length;F++){C=D.image[F].value;if(C.indexOf("http")!==-1||F===0){G=C;}}}return G;}function B(E,D){var G,C=[],H,F;if(D.responsibleParty){for(G=0;G<D.responsibleParty.length;G++){H=D.responsibleParty[G];F=(D.responsibleParty.organisationName&&D.responsibleParty.organisationName[G]?D.responsibleParty.organisationName[G].value:"");C.push({applies:H.appliesTo,logo:H.logo,role:H.role,name:F});}}return C;}function q(D,C){if(C.link){return C.link;}return[];}function r(D,C){if(C.geonet_info&&C.geonet_info.source){return C.geonet_info.source[0].value;}else{return"";}}function w(D,C){if(C.geonet_info&&C.geonet_info.popularity){return C.geonet_info.popularity[0].value;}else{return"";}}function j(D,C){if(C.geonet_info&&C.geonet_info.rating){return C.geonet_info.rating[0].value;}else{return"";}}function a(D,C){if(C.geonet_info&&C.geonet_info.download){return C.geonet_info.download[0].value;}else{return"";}}function h(D,C){if(C.geonet_info&&C.geonet_info.ownername){return C.geonet_info.ownername[0].value;}else{return"";}}function z(D,C){if(C.geonet_info&&C.geonet_info.isHarvested){return C.geonet_info.isHarvested[0].value;}else{return"";}}function v(D,C){if(C.geonet_info&&C.geonet_info.harvestInfo&&C.geonet_info.harvestInfo.type){return C.geonet_info.harvestInfo.type[0].value;}else{return"";}}function e(D,C){if(C.geonet_info&&C.geonet_info.category){return C.geonet_info.category;}else{return"";}}function d(D,C){if(C.geonet_info&&C.geonet_info.changeDate){return C.geonet_info.changeDate[0].value;}else{return"";}}function m(D,C){if(C.geonet_info&&C.geonet_info.createDate){return C.geonet_info.createDate[0].value;}else{return"";}}function s(D,C){if(C.geonet_info&&C.geonet_info.selected){return C.geonet_info.selected[0].value;}else{return"";}}function t(D,C){if(C["abstract"]){return C["abstract"][0].value;}else{return"";}}function u(D,C){if(C.type){return C.type[0].value;}else{return"";}}function b(D,C){if(C.geonet_info&&C.geonet_info.edit){return C.geonet_info.edit[0].value;}else{return"false";}}function g(D,C){if(C.geonet_info&&C.geonet_info.displayOrder){return C.geonet_info.displayOrder[0].value;}else{return 0;}}return new Ext.data.JsonStore({totalProperty:"summary.count",root:"records",fast:"false",service:"xml.search",fields:[{name:"title",convert:l},{name:"abstract",convert:t},{name:"type",convert:u},{name:"subject",mapping:"keyword",defaultValue:""},{name:"uuid",mapping:"geonet_info.uuid[0].value",defaultValue:""},{name:"id",mapping:"geonet_info.id[0].value",defaultValue:""},{name:"schema",mapping:"geonet_info.schema[0].value",defaultValue:""},{name:"contact",convert:B},{name:"thumbnail",convert:f},{name:"links",convert:q},{name:"uri",mapping:"uri",defaultValue:""},{name:"isharvested",convert:z},{name:"harvestertype",convert:v},{name:"createdate",convert:m},{name:"changedate",convert:d},{name:"selected",convert:s},{name:"source",convert:r},{name:"category",convert:e},{name:"rating",convert:j},{name:"popularity",convert:w},{name:"download",convert:a},{name:"ownername",convert:h},{name:"edit",convert:b},{name:"bbox",mapping:"BoundingBox",defaultValue:""},{name:"displayOrder",convert:g,sortType:"asInt"},{name:"valid",mapping:"geonet_info.valid[0].value",defaultValue:"-1"},{name:"valid_details",convert:o}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataResultsFastStore=function(){var e="|";function m(F,E){if(E.title&&E.title){return E.title[0].value;}else{return"";}}function q(F,E){if(E.valid){return E.valid[0].value;}else{return"-1";}}function C(G,F){var I,E=[],K;for(var H in F){if(F.hasOwnProperty(H)&&H.indexOf("valid_")!==-1){var J=F[H];E.push({valid:J[0].value,type:H.split("_")[1],ratio:""});}}return E;}function g(G,F){var H;var I="";var E;if(F.image){for(H=0;H<F.image.length;H++){var J=F.image[H].value.split(e);E=J[1];if(E.indexOf("http")!==-1||H===0){I=E;}}}return I;}function D(G,F){var I,E=[],J,H;if(F.responsibleParty){for(I=0;I<F.responsibleParty.length;I++){var K=F.responsibleParty[I].value.split(e);E.push({applies:K[1],logo:K[3],role:K[0],name:K[2]});}}return E;}function r(G,E){var F=[];if(E.link){for(i=0;i<E.link.length;i++){var H=E.link[i].value.split(e);F.push({name:H[0],title:H[1],href:H[2],protocol:H[3],type:H[4]});}}return F;}function s(F,E){if(E.geonet_info&&E.geonet_info.source){return E.geonet_info.source[0].value;}else{return"";}}function z(F,E){if(E.popularity){return E.popularity[0].value;}else{return"";}}function l(F,E){if(E.rating){return E.rating[0].value;}else{return"";}}function a(F,E){if(E.download){return E.download[0].value;}else{return"";}}function j(F,E){if(E.userinfo&&E.userinfo[0].value){var G=E.userinfo[0].value.split(e);try{return G[2]+" "+G[1];}catch(H){return"";}}else{return"";}}function B(F,E){if(E.isHarvested){return E.isHarvested[0].value;}else{return"";}}function w(F,E){if(E.geonet_info&&E.geonet_info.harvestInfo&&E.geonet_info.harvestInfo.type){return E.geonet_info.harvestInfo.type[0].value;}else{return"";}}function f(F,E){if(E.category){return E.category;}else{return"";}}function d(F,E){if(E.geonet_info&&E.geonet_info.changeDate){return E.geonet_info.changeDate[0].value;}else{return"";}}function o(F,E){if(E.geonet_info&&E.geonet_info.createDate){return E.geonet_info.createDate[0].value;}else{return"";}}function t(F,E){if(E.geonet_info&&E.geonet_info.selected){return E.geonet_info.selected[0].value;}else{return"";}}function u(F,E){if(E["abstract"]){return E["abstract"][0].value;}else{return"";}}function v(F,E){if(E.type){return E.type[0].value;}else{return"";}}function b(F,E){if(E.geonet_info&&E.geonet_info.edit){return E.geonet_info.edit[0].value;}else{return"false";}}function h(F,E){if(E.geonet_info&&E.geonet_info.displayOrder){return E.geonet_info.displayOrder[0].value;}else{return 0;}}return new Ext.data.JsonStore({totalProperty:"summary.count",root:"records",fast:"index",service:"q",fields:[{name:"title",convert:m},{name:"abstract",convert:u},{name:"type",convert:v},{name:"subject",mapping:"keyword",defaultValue:""},{name:"uuid",mapping:"geonet_info.uuid[0].value",defaultValue:""},{name:"id",mapping:"geonet_info.id[0].value",defaultValue:""},{name:"schema",mapping:"geonet_info.schema[0].value",defaultValue:""},{name:"contact",convert:D},{name:"thumbnail",convert:g},{name:"links",convert:r},{name:"uri",mapping:"uri",defaultValue:""},{name:"isharvested",convert:B},{name:"harvestertype",convert:w},{name:"createdate",convert:o},{name:"changedate",convert:d},{name:"selected",convert:t},{name:"source",convert:s},{name:"category",convert:f},{name:"rating",convert:l},{name:"popularity",convert:z},{name:"download",convert:a},{name:"ownername",convert:j},{name:"edit",convert:b},{name:"bbox",mapping:"BoundingBox",defaultValue:""},{name:"displayOrder",convert:h,sortType:"asInt"},{name:"valid",convert:q},{name:"valid_details",convert:C}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataSummaryStore=function(){return new Ext.data.JsonStore({totalProperty:"count",root:"keywords.keyword",listeners:{load:function(b,a,e){var d="count";var h="class";var g="type";var j={};var f=6;b.each(function(l){l.set(g,b.root);var m=l.get(g);if(typeof j.type!=="object"){j.type={maxValue:0,minValue:1};}j.type.maxValue=Math.max(l.get(d),j.type.maxValue);j.type.minValue=Math.min(l.get(d),j.type.minValue);});b.each(function(l){var m=l.get(g);var o=0;if(j.type.maxValue!==j.type.minValue){o=(l.get(d)-j.type.minValue)/(j.type.maxValue-j.type.minValue)*f;}l.set(h,Math.round(o));});}},sortInfo:{field:"value",direction:"ASC"},fields:[{name:"type",defaultValue:null},{name:"value",mapping:"name",defaultValue:""},{name:"count",mapping:"count",defaultValue:""},{name:"class",defaultValue:"0"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataThumbnailStore=function(b,d){var a=[{name:"href"},{name:"desc"},{name:"type"},{name:"mimetype"}];return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:b,params:d,disableCaching:false}),record:"thumbnail",idPath:"href",fields:a});
};Ext.namespace("GeoNetwork.data");GeoNetwork.data.OpenSearchSuggestionReader=function(a,b){a=a||{};GeoNetwork.data.OpenSearchSuggestionReader.superclass.constructor.call(this,a,b||a.fields);};Ext.extend(GeoNetwork.data.OpenSearchSuggestionReader,Ext.data.JsonReader,{rootId:undefined,readRecords:function(t){this.arrayData=t;var C,B;var m=this.meta,e=m?Ext.num(m.idIndex,m.id):null,b=this.recordType,r=b.prototype.fields,D=[],g=true,h;this.rootId=1;var w=(!this.rootId?this.getRoot(t):t[this.rootId]);for(C=0,len=w.length;C<len;C++){var u=w[C],a={},q=((e||e===0)&&u[e]!==undefined&&u[e]!==""?u[e]:null);for(B=0,jlen=r.length;B<jlen;B++){var E=r.items[B],z=E.mapping!==undefined&&E.mapping!==null?E.mapping:B;h=u[z]!==undefined?u[z]:E.defaultValue;h=E.convert(h,u);a[E.name]=u;}var d=new b(a,q);d.json=u;D[D.length]=d;}var l=D.length;if(m.totalProperty){h=parseInt(this.getTotal(t),10);if(!isNaN(h)){l=h;}}if(m.successProperty){h=this.getSuccess(t);if(h===false||h==="false"){g=false;}}return{success:true,records:D,totalRecords:D.length};}});Ext.namespace("GeoNetwork.data");Ext.namespace("GeoNetwork.data");GeoNetwork.data.OpenSearchSuggestionStore=function(a){a=a||{};GeoNetwork.data.OpenSearchSuggestionStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoNetwork.data.OpenSearchSuggestionReader(a,a.fields||["value"])}));};Ext.extend(GeoNetwork.data.OpenSearchSuggestionStore,Ext.data.Store);Ext.namespace("GeoNetwork.data");GeoNetwork.data.RegionStore=function(a){function b(e,d){var l={};var h;var f=d.getElementsByTagName("label");if(f.length===1){var g=f[0].childNodes;var j;for(h=0,len=g.length;h<len;++h){j=g[h];if(j.nodeType===1){l[j.nodeName]=j.firstChild.nodeValue;}}}return l;}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"region",idPath:"@id",fields:[{name:"id",mapping:"@id"},{name:"north"},{name:"south"},{name:"east"},{name:"west"},{name:"label",convert:b}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.SubTemplateTypeStore=function(a){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"record",idPath:"type",fields:[{name:"type"},{name:"schema"},{name:"label"},{name:"description"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.SuggestionStore=function(d,g,e){function f(l,j){var h=j.getAttribute("type");return'<span class="'+h+'">&#160;</span>';}var b=[{name:"id",mapping:"@id"},{name:"name",mapping:"@process"},{name:"target",mapping:"@target"},{name:"category",mapping:"@category"},{name:"desc",mapping:"name"},{name:"params",mapping:"params"},{name:"operational",mapping:"operational"}];if(e){var a=new Ext.data.XmlReader({record:"suggestion",idProperty:"@id"},b);return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:d,params:g,disableCaching:false}),reader:a,groupField:"category",sortInfo:{field:"target",direction:"ASC"}});}else{return new Ext.data.XmlStore({autoDestroy:true,baseParams:g,proxy:new Ext.data.HttpProxy({method:"GET",url:d,disableCaching:false}),record:"suggestion",idPath:"@id",fields:b});}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.ThesaurusFeedStore=function(d){var a="http://geonetwork.svn.sourceforge.net/svnroot/geonetwork/utilities/repository/thesaurus.xml";var b=new Ext.data.XmlStore({autoDestroy:true,autoLoad:true,proxy:new Ext.data.HttpProxy({method:"GET",url:d||a,disableCaching:false}),record:"entry",idPath:"id",fields:[{name:"id"},{name:"title"},{name:"link",mapping:"link/@href"},{name:"updated"},{name:"summary"},{name:"category"}]});return b;};Ext.namespace("GeoNetwork.data");GeoNetwork.data.ThesaurusStore=function(d){var e=Ext.data.Record.create([{name:"filename"},{name:"title"},{name:"theme",mapping:"dname"},{name:"id",mapping:"key"},{name:"type"},{name:"activated"}]);var b=new Ext.data.Store({url:d.url,reader:new Ext.data.XmlReader({record:"thesaurus"},e),sortInfo:{field:"id",direction:"ASC"},fields:["filename","theme","id","title","type","activated"]});if(d.allOption){var a=new e({filename:OpenLayers.i18n("anyThesaurus"),activated:"y"});a.set("id","");b.add(a);}if(d.activatedOnly){b.on("load",function(){var f=this.query("activated","n");f.each(function(h,g){this.removeAt(this.indexOf(h));},b);},b);}b.load({add:true});return b;};Ext.namespace("GeoNetwork.data");GeoNetwork.data.UserStore=function(a){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"user",idPath:"id",fields:[{name:"id"},{name:"username"},{name:"surname"},{name:"name"},{name:"profile"},{name:"address"},{name:"email"},{name:"city"},{name:"state"},{name:"zip"},{name:"country"},{name:"organisation"},{name:"kind"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.ValidationRuleStore=function(d,g,e){function f(l,j){var h=j.getAttribute("type");return'<span class="'+h+'">&#160;</span>';}var b=[{name:"id",mapping:"@id"},{name:"group",mapping:"@group"},{name:"status",mapping:"@type"},{name:"statusIcon",convert:f},{name:"title"},{name:"details"},{name:"msg"}];if(e){var a=new Ext.data.XmlReader({record:"rule",idProperty:"id"},b);return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:d,params:g,disableCaching:false}),reader:a,groupField:"group",sortInfo:{field:"status",direction:"ASC"}});}else{return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:d,params:g,disableCaching:false}),record:"rule",idPath:"@id",fields:b});}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.Z3950RepositoryStore=function(a){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:a,disableCaching:false}),record:"repository",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"code",mapping:"id/@code"},{name:"name",mapping:"label"}]});};Ext.namespace("GeoNetwork.form");GeoNetwork.form.GeometryMapField=Ext.extend(GeoExt.MapPanel,{layer_style:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),geometryFieldId:undefined,geometryField:undefined,mapOptions:undefined,extentBox:undefined,vectorLayer:undefined,nearYou:undefined,initStyle:function(){this.layer_style.fillOpacity=0;this.layer_style.strokeOpacity=0.8;this.layer_style.strokeDashstyle="dash";this.layer_style.strokeWidth=4;},createExtentControl:function(){var b;if(this.restrictToMapExtent){b=new Ext.form.Checkbox({boxLabel:OpenLayers.i18n("restrictSearchToMap"),checked:this.activated?true:false,listeners:{check:function(d,e){this.geometryField.setValue("");this.nearYou.toggle(false);if(e){this.on("aftermapmove",this.setField,this);this.fireEvent("aftermapmove");}else{this.un("aftermapmove",this.setField,this);}},scope:panel}});this.getTopToolbar().add(b);if(this.activated){this.on("aftermapmove",this.setField,this);}}else{this.initStyle();this.extentBox=new GeoNetwork.Control.ExtentBox({wktelement:this.geometryField,vectorLayerStyle:this.layer_style});b=new GeoExt.Action({control:this.extentBox,toggleGroup:this.map.id+"move",allowDepress:false,pressed:this.activated?true:false,map:this.map,tooltip:{title:OpenLayers.i18n("selectExtentTooltipTitle"),text:OpenLayers.i18n("selectExtentTooltipText")},iconCls:"selextent"});this.vectorLayer=this.extentBox.getOrCreateLayer();var a={iconCls:"clearPolygon",tooltip:{title:OpenLayers.i18n("clearExtentTooltipTitle"),text:OpenLayers.i18n("clearExtentTooltipText")},handler:function(){this.vectorLayer.destroyFeatures();this.geometryField.setValue("");},scope:this};this.getTopToolbar().add(b,a);}if(this.nearYouControl){this.getTopToolbar().add(this.nearYou);}return b;},createNavBar:function(){var e=[];var b=this;this.nearYou=new Ext.Button({iconCls:"md-mn mn-user-location",iconAlign:"right",tooltip:OpenLayers.i18n("mapNearYou"),enableToggle:true,toggleGroup:this.map.id+"move",listeners:{toggle:function(h,j){var l=this;
if(j){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(m){l.map.panTo(new OpenLayers.LonLat(m.coords.longitude,m.coords.latitude));l.geometryField.setValue("POINT("+m.coords.latitude+" "+m.coords.longitude+")");});}}else{l.geometryField.setValue("");}},scope:b}});var f=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent(),map:this.map,iconCls:"zoomfull",tooltip:{title:OpenLayers.i18n("zoomToMaxExtentTooltipTitle"),text:OpenLayers.i18n("zoomToMaxExtentTooltipText")}});var a=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox(),map:this.map,toggleGroup:this.map.id+"move",allowDepress:false,iconCls:"zoomin",tooltip:{title:OpenLayers.i18n("zoominTooltipTitle"),text:OpenLayers.i18n("zoominTooltipText")}});var d=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({displayClass:"ZoomOut",out:true}),map:this.map,toggleGroup:this.map.id+"move",allowDepress:false,tooltip:{title:OpenLayers.i18n("zoomoutTooltipTitle"),text:OpenLayers.i18n("zoomoutTooltipText")},iconCls:"zoomout"});var g=new GeoExt.Action({control:new OpenLayers.Control.DragPan({isDefault:true}),toggleGroup:this.map.id+"move",allowDepress:false,pressed:this.activated?false:true,map:this.map,iconCls:"pan",tooltip:{title:OpenLayers.i18n("dragTooltipTitle"),text:OpenLayers.i18n("dragTooltipText")}});e.push(f,a,d,g,"->");return e;},defaultConfig:{id:"geometryMap",width:290,height:180,border:false,activated:false,restrictToMapExtent:false,nearYouControl:true},initComponent:function(){Ext.applyIf(this,this.defaultConfig);var a=this.mapOptions||{projection:"EPSG:4326",units:"degrees",maxExtent:new OpenLayers.Bounds(-180,-90,180,90),restrictedExtent:new OpenLayers.Bounds(-180,-90,180,90),controls:[]};if(!a.controls){a.controls=[];}this.map=new OpenLayers.Map("search_map",a);this.map.addControl(new GeoNetwork.Control.ZoomWheel());this.map.addControl(new OpenLayers.Control.LoadingPanel());this.map.addControl(new OpenLayers.Control.MousePosition());this.tbar=this.createNavBar();this.geometryField=Ext.getCmp(this.geometryFieldId);GeoNetwork.form.GeometryMapField.superclass.initComponent.call(this);this.createExtentControl();},setExtent:function(a){if(a){this.extentBox.updateFields(a);}else{this.extentBox.updateFields(this.map.getMaxExtent());}},setField:function(){if(this.geometryField!==undefined){var b=this.map.getExtent().toArray();var a="POLYGON(("+b[0]+" "+b[1]+","+b[0]+" "+b[3]+","+b[2]+" "+b[3]+","+b[2]+" "+b[1]+","+b[0]+" "+b[1]+"))";this.geometryField.setValue(a);}}});Ext.reg("gn_geometrymapfield",GeoNetwork.form.GeometryMapField);Ext.namespace("GeoNetwork.form");GeoNetwork.form.OpenSearchSuggestionTextField=Ext.extend(Ext.form.ComboBox,{defaultConfig:{hideLabel:true,width:400,minChars:2,loadingText:"...",hideTrigger:true,forceLowerCase:true},url:undefined,field:"any",fieldLabel:undefined,name:"E_any",displayField:"value",tpl:undefined,mode:"remote",store:undefined,queryParam:"q",autoSelect:false,itemSelector:"div.search-item",initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.id="E_"+this.field;GeoNetwork.form.OpenSearchSuggestionTextField.superclass.initComponent.call(this);if(!this.tpl){var a='<tpl for="."><div class="search-item"><h3>{[values.value.replace(Ext.getDom(\''+this.id+"').value, '<span>' + Ext.getDom('"+this.id+"').value + '</span>')]}</h3></div></tpl>";this.tpl=new Ext.XTemplate(a);}if(this.forceLowerCase){this.on("beforequery",function(b){b.query=b.query.toLowerCase();});}this.store=new GeoNetwork.data.OpenSearchSuggestionStore({url:this.url,rootId:1,baseParams:{field:this.field}});}});Ext.reg("gn_opensearchsuggestiontextfield",GeoNetwork.form.OpenSearchSuggestionTextField);Ext.namespace("GeoNetwork.form");GeoNetwork.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){if(!this.store.baseParams){this.store.baseParams={};}GeoNetwork.form.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){if(b.getKey()===b.ENTER){this.onTrigger2Click();}},this);},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,hasSearch:false,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.store.baseParams[this.paramName]="";this.store.removeAll();this.el.dom.value="";this.triggers[0].hide();this.hasSearch=false;this.focus();}},onTrigger2Click:function(){var a=this.getRawValue();if(a.length<1){this.store.baseParams[this.paramName]="*";}else{this.store.baseParams[this.paramName]=a;}if(this.triggerAction){this.triggerAction(this.scope,a);}else{this.store.reload();}this.hasSearch=true;this.triggers[0].show();this.focus();}});Ext.reg("gn_searchfield",GeoNetwork.form.SearchField);Ext.namespace("GeoNetwork");GeoNetwork.LoginForm=Ext.extend(Ext.FormPanel,{url:"",catalogue:undefined,defaultConfig:{border:false,layout:"form",id:"loginForm",hideLoginLabels:true,width:340},defaultType:"textfield",userInfo:undefined,username:undefined,password:undefined,toggledFields:[],toggledFieldsOff:[],keys:[{key:[Ext.EventObject.ENTER],handler:function(){Ext.getCmp("btnLoginForm").fireEvent("click");}}],initComponent:function(){Ext.applyIf(this,this.defaultConfig);var f=this;var g=new Ext.Button({width:50,text:OpenLayers.i18n("login"),iconCls:"md-mn mn-login",id:"btnLoginForm",listeners:{click:function(){this.catalogue.login(this.username.getValue(),this.password.getValue());},scope:f}}),d=new Ext.Button({width:80,text:OpenLayers.i18n("administration"),listeners:{click:function(){catalogue.admin();},scope:this}}),e=new Ext.Button({width:80,text:OpenLayers.i18n("logout"),iconCls:"md-mn mn-logout",listeners:{click:function(){catalogue.logout();},scope:this}});this.username=new Ext.form.TextField({id:"username",name:"username",width:70,hideLabel:false,allowBlank:false,fieldLabel:OpenLayers.i18n("username"),emptyText:OpenLayers.i18n("username")});this.password=new Ext.form.TextField({name:"password",width:70,hideLabel:false,allowBlank:false,fieldLabel:OpenLayers.i18n("password"),emptyText:OpenLayers.i18n("password"),inputType:"password"});this.userInfo=new Ext.form.Label({width:170,text:"",cls:"loginInfo"});if(this.hideLoginLabels){this.toggledFields.push(this.username,this.password,g);}else{var h=new Ext.form.Label({html:OpenLayers.i18n("username")}),b=new Ext.form.Label({html:OpenLayers.i18n("password")});this.toggledFields.push(h,this.username,b,this.password,g);}this.toggledFieldsOff.push(this.userInfo,e);if(this.catalogue.adminAppUrl!==""){this.toggledFieldsOff.push(d);}this.items=[this.toggledFields,this.toggledFieldsOff];GeoNetwork.LoginForm.superclass.initComponent.call(this);var a=this.catalogue.isLoggedIn();this.login(this.catalogue,a);this.catalogue.on("afterLogin",this.login,this);this.catalogue.on("afterLogout",this.login,this);},login:function(a,d){var b=d?true:false;Ext.each(this.toggledFields,function(e){e.setVisible(!b);});Ext.each(this.toggledFieldsOff,function(e){e.setVisible(b);});if(a.identifiedUser&&a.identifiedUser.username){this.userInfo.setText(a.identifiedUser.name+" "+a.identifiedUser.surname+" <br/>("+a.identifiedUser.role+")",false);}else{this.userInfo.setText("");}this.doLayout(false,true);}});Ext.reg("gn_loginform",GeoNetwork.LoginForm);Ext.namespace("GeoNetwork");GeoNetwork.MetadataMenu=Ext.extend(Ext.menu.Menu,{record:undefined,setRecord:function(a){this.record=a;this.updateMenu();},resultsView:undefined,catalogue:undefined,editAction:undefined,deleteAction:undefined,zoomToAction:undefined,otherActions:undefined,adminMenuSeparator:undefined,duplicateAction:undefined,createChildAction:undefined,adminAction:undefined,categoryAction:undefined,viewAction:undefined,printAction:undefined,viewXMLAction:undefined,getMEFAction:undefined,ratingWidget:undefined,defaultConfig:{},create:function(){this.editAction=new Ext.Action({text:OpenLayers.i18n("edit"),iconCls:"md-mn-edit",handler:function(){var a=this.record.get("id");this.catalogue.metadataEdit(a);},scope:this});this.add(this.editAction);
this.deleteAction=new Ext.Action({text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){var a=this.record.get("uuid");this.catalogue.metadataDelete(a);},scope:this});this.add(this.deleteAction);this.duplicateAction=new Ext.Action({text:OpenLayers.i18n("duplicate"),iconCls:"md-mn-copy",handler:function(){var a=this.record.get("id");GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,a,OpenLayers.i18n("duplicate"),false);},scope:this});this.createChildAction=new Ext.Action({text:OpenLayers.i18n("createChild"),iconCls:"md-mn-copy",handler:function(){var a=this.record.get("id");GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,a,OpenLayers.i18n("createChild"),true);},scope:this});this.adminAction=new Ext.Action({text:OpenLayers.i18n("privileges"),iconCls:"privIcon",handler:function(){var a=this.record.get("id");this.catalogue.metadataAdmin(a);},scope:this});this.categoryAction=new Ext.Action({text:OpenLayers.i18n("categories"),handler:function(){var a=this.record.get("id");this.catalogue.metadataCategory(a);},scope:this});this.otherActions=new Ext.menu.Item({text:OpenLayers.i18n("otherActions"),menu:{items:[this.duplicateAction,this.createChildAction,this.adminAction,this.categoryAction]}});this.add(this.otherActions);this.adminMenuSeparator=new Ext.menu.Separator();this.add(this.adminMenuSeparator);this.viewAction=new Ext.Action({text:OpenLayers.i18n("view"),iconCls:"md-mn-view",handler:function(){var a=this.record.get("uuid");this.catalogue.metadataShow(a);},scope:this});this.add(this.viewAction);this.zoomToAction=new Ext.Action({text:OpenLayers.i18n("zoomTo"),iconCls:"zoomlayer",handler:function(){var a=this.record.get("uuid");this.resultsView.zoomTo(a);},scope:this});this.add(this.zoomToAction);this.viewXMLAction=new Ext.Action({text:OpenLayers.i18n("saveXml"),iconCls:"xmlIcon",handler:function(){var b=this.record.get("uuid");var a=this.record.get("schema");this.catalogue.metadataXMLShow(b,a);},scope:this});this.add(this.viewXMLAction);this.printAction=new Ext.Action({text:OpenLayers.i18n("printSel"),iconCls:"md-mn-pdf",handler:function(){this.catalogue.metadataPrint(this.record.get("uuid"));},scope:this});this.add(this.printAction);this.getMEFAction=new Ext.Action({text:OpenLayers.i18n("getMEF"),iconCls:"md-mn-zip",handler:function(){this.catalogue.metadataMEF(this.record.get("uuid"));},scope:this});this.add(this.getMEFAction);if(Ext.ux.RatingItem){this.ratingWidget=new Ext.ux.RatingItem(null,{canReset:false,name:"rating",disabled:true,nbStars:5,cls:"ux-menu-rating-item",listeners:{change:function(f,d,b){if(d){var a=this.record.get("uuid");this.catalogue.metadataRate(a,d,this.hide());this.ratingWidget.reset();}},scope:this}});this.add(this.ratingWidget);}this.updateMenu();},updateMenu:function(){if(!this.record){return;}var d=this.record.get("edit")==="true"?(this.record.get("isharvested")==="y"?GeoNetwork.Settings.editor.editHarvested||false:true):false,a=this.record.get("isharvested")==="y"?true:false,b=this.record.get("harvestertype"),e=this.catalogue.isIdentified();if(!e){this.editAction.hide();this.deleteAction.hide();}else{this.editAction.show();this.deleteAction.show();}this.otherActions.setVisible(e);this.adminMenuSeparator.setVisible(e);this.editAction.setDisabled(!d);this.adminAction.setDisabled(!d&&!a);this.categoryAction.setDisabled(!d&&!a);this.deleteAction.setDisabled(!d&&!a);if(this.ratingWidget){this.ratingWidget.reset();if(a&&b!=="geonetwork"){this.ratingWidget.disable();}else{this.ratingWidget.enable();}}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);GeoNetwork.MetadataMenu.superclass.initComponent.call(this);this.create();}});Ext.reg("gn_metadatamenu",GeoNetwork.MetadataMenu);Ext.namespace("GeoNetwork");GeoNetwork.MetadataResultsView=Ext.extend(Ext.DataView,{catalogue:undefined,templates:null,overClass:"md-over",itemSelector:"li.md",emptyText:"",autoWidth:true,maps:[],mapsProjection:"EPSG:4326",projectionFrom:undefined,projectionTo:undefined,mdSelectionUuids:[],layer_style:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),layer_style_hover:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),layer_style_selected:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),features:[],hover_feature:[],displayContextualMenu:true,contextMenu:undefined,contextMenuNodeId:undefined,acMenu:undefined,displaySerieMembers:false,maxOfMembers:50,relatedTpl:undefined,newMetadataWindow:undefined,plugins:[],listeners:{dblclick:{fn:function(d,a,g,h){if(this.maps.length!==0){var b=this.getStore().getAt(a);var f=b.get("uuid");this.zoomTo(f);}}},mouseenter:{fn:function(b,q,d,o){var h,g;if(this.maps.length!==0){var m=this.getStore().getAt(q);var a=m.get("uuid");for(g=0;g<this.maps.length;g++){var f=this.maps[g].layer;if(f.features){for(h=0;h<f.features.length;h++){if(a===f.features[h].attributes.id){if(!this.hover_feature[g]){f.drawFeature(f.features[h],this.layer_style_hover);this.hover_feature[g]=f.features[h];}continue;}}}}}this.actionMenuInit(q,d);}},mouseleave:{fn:function(f,a,g,h){var d;if(this.acMenu){this.acMenu.hide();}this.acMenu=undefined;for(d=0;d<this.maps.length;d++){if(this.hover_feature[d]){var b=this.maps[d].layer;b.drawFeature(this.hover_feature[d],this.layer_style);this.hover_feature[d]=null;continue;}}}},contextmenu:{fn:function(b,a,d,f){if(this.displayContextualMenu){this.contextMenuNodeId=a;this.createMenu(a,b);this.contextMenu.showAt(f.getXY());f.stopEvent();}}}},actionMenuInit:function(a,b){this.acMenu=Ext.get(Ext.DomQuery.selectNode("span.md-action-menu",b));this.acMenu.on("click",function(){this.createMenu(a,this);this.contextMenu.showAt([this.acMenu.getX(),this.acMenu.getY()+this.acMenu.getHeight()]);}.bind(this));this.acMenu.show();},createMenu:function(d,b){var a=this.getStore().getAt(d);if(!this.contextMenu){this.contextMenu=new GeoNetwork.MetadataMenu({floating:true,catalogue:catalogue,record:a,resultsView:b});}else{this.contextMenu.setRecord(a);}},zoomTo:function(e){var d,b;for(b=0;b<this.maps.length;b++){var a=this.maps[b].layer;if(a.features){for(d=0;d<a.features.length;d++){if(e===a.features[d].attributes.id){var f=a.features[d].geometry.getBounds();if(f){this.maps[b].map.zoomToExtent(f);}break;}}}}},initComponent:function(){var b;this.templates=this.templates||{SIMPLE:GeoNetwork.Templates.SIMPLE,THUMBNAIL:GeoNetwork.Templates.THUMBNAIL,FULL:GeoNetwork.Templates.FULL};GeoNetwork.MetadataResultsView.superclass.initComponent.call(this);this.setStore(this.catalogue.metadataStore);this.initStyle();this.relatedTpl=new Ext.XTemplate(this.relatedTpl||GeoNetwork.Templates.Relation.SHORT);if(this.maps){if(this.maps instanceof OpenLayers.Map){var d=this.maps;this.maps=[];this.addMap(d);}else{for(b=0;b<this.maps.length;b++){var a=this.maps[b];this.initMap(a);}}}else{this.maps=[];}this.on("selectionchange",this.selectionChange);},setStore:function(a){this.store=a;this.getStore().on({load:this.resultsLoaded,clear:this.destroyMetadataBbox,scope:this});},addMap:function(e,f){var d=false,b;for(b=0;b<this.maps.length;b++){if(this.maps[b].map.id===e.id){d=true;break;}}if(!d){var a={map:e,zoomToExtentOnSearch:f||false};this.mapsProjection=e.projection;this.projectionFrom=new OpenLayers.Projection("EPSG:4326");this.projectionTo=new OpenLayers.Projection(this.mapsProjection);this.maps.push(a);this.initMap(a);}},initMap:function(b){var a=new OpenLayers.Layer.Vector(OpenLayers.i18n("mdResultsLayer"),{style:this.layer_style});this.addCurrentFeatures(a);b.layer=a;b.map.addLayer(a);},removeMap:function(a){this.maps.splice(a,1);},getTemplates:function(){return this.templates;},removeTemplate:function(a){delete this.templates[a];},addTemplate:function(a,b){this.templates[a]=b;},applyTemplate:function(a){this.tpl=this.templates[a];this.refresh();},initStyle:function(){this.layer_style.fillOpacity=0;this.layer_style.graphicOpacity=1;this.layer_style_selected.fillOpacity=0.1;this.layer_style_hover.fillOpacity=0.3;this.layer_style_hover.strokeWidth=3;},destroyMetadataBbox:function(){var b;
for(b=0;b<this.maps.length;b++){var a=this.maps[b].layer;if(a.features){if(a.features.length>0){this.features=[];a.destroyFeatures();}}}},resultsLoaded:function(a,b,d){this.drawMetadataBbox(a,b,d);this.contextMenu=undefined;this.initRatingWidget();this.dislayLinks(b);},dislayLinks:function(b){var d="children",a=this;if(this.displaySerieMembers){Ext.each(b,function(f){var g=f.get("type")==="series",h=f.get("id");if(g){var e=new GeoNetwork.data.MetadataRelationStore(this.catalogue.services.mdRelation+"?type="+d+"&fast=false&uuid="+escape(f.get("uuid")),null,true);e.load();e.on("load",function(l,j){Ext.each(j,function(q){var r=Ext.query("#md-relation-"+h,a.el.dom.body),o=Ext.get(r[0]),m=o.parent();if(m&&m.isScrollable()){m.addClass("more");}if(o){o.insertHtml("beforeEnd",a.relatedTpl.apply(q.data));m.setVisible(true);}},this);});}},this);}},drawMetadataBbox:function(b,d,f){var g,e;if(this.maps.length===0){return;}this.features=[];Ext.each(d,function(j){var o=j.get("bbox");if(o){var t=[];for(e=0;e<o.length;e++){var w=o[e].value;var z=new OpenLayers.Geometry.Point(w[2],w[1]);var v=new OpenLayers.Geometry.Point(w[2],w[3]);var u=new OpenLayers.Geometry.Point(w[0],w[3]);var s=new OpenLayers.Geometry.Point(w[0],w[1]);if(this.mapsProjection!=="EPSG:4326"){z.transform(this.projectionFrom,this.projectionTo);v.transform(this.projectionFrom,this.projectionTo);u.transform(this.projectionFrom,this.projectionTo);s.transform(this.projectionFrom,this.projectionTo);}var h=[z,v,u,s,z];var l=new OpenLayers.Geometry.LinearRing(h);var q=new OpenLayers.Geometry.Polygon([l]);t.push(q.clone());}var m=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(t),{id:j.get("uuid")});this.features.push(m.clone());}},this);for(g=0;g<this.maps.length;g++){this.addCurrentFeatures(this.maps[g].layer);}if(this.features.length>0){for(g=0;g<this.maps.length;g++){var a=this.maps[g];if(a.zoomToExtentOnSearch){a.map.zoomToExtent(a.layer.getDataExtent());}}}},initRatingWidget:function(){var d=Ext.DomQuery.select("div.rating"),a;for(a=0;a<d.length;++a){if(Ext.ux.RatingItem){var b=new Ext.ux.RatingItem(d[a],{disabled:true,name:"rating"+a});}else{d[a].style.display="none";}}},selectAll:function(){var b=Ext.DomQuery.select("input.selector"),a;for(a=0;a<b.length;++a){b[a].checked=true;}},selectAllInPage:function(){var b=Ext.DomQuery.select("input.selector"),a;for(a=0;a<b.length;++a){b[a].checked=true;Ext.each(this.getRecords(this.getNodes()),function(e){var d=e.get("uuid");this.catalogue.metadataSelect("add",[d]);},this);}},selectNone:function(){var b=Ext.DomQuery.select("input.selector"),a;for(a=0;a<b.length;++a){b[a].checked=false;}},selectionChange:function(f,b){if(this.catalogue){var a=this.getRecords(b);var j={};var e=[];var h=[];var d;var g;for(d=0;d<a.length;d++){g=a[d].get("uuid");j[g]=true;}for(d=0;d<this.mdSelectionUuids.length;d++){g=this.mdSelectionUuids[d];if(j[g]){e.push(g);}else{h.push(g);}}for(g in j){if(j.hasOwnProperty(g)&&!this.mdSelectionUuids[g]){e.push(g);}}this.catalogue.metadataSelect("add",e);this.catalogue.metadataSelect("remove",h);this.mdSelectionUuids=e;}},addCurrentFeatures:function(d){var a=this.features.length,b;if(a>0){var e=[];e=[];var g,f;for(b=0;b<a;b++){g=this.features[b];f=g.clone();e[b]=f;}d.addFeatures(e);}},onDestroy:function(){GeoNetwork.MetadataResultsView.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gn_metadataresultsview",GeoNetwork.MetadataResultsView);Ext.namespace("GeoNetwork");GeoNetwork.MetadataResultsToolbar=Ext.extend(Ext.Toolbar,{catalogue:undefined,metadataResultsView:undefined,mdSelectionInfoCmp:undefined,searchBtCmp:undefined,sortByCmp:undefined,sortByCombo:undefined,mdSelectionInfo:"md-selection-info",selectionActions:[],deleteAction:undefined,otherItem:undefined,ownerAction:undefined,updateCategoriesAction:undefined,updatePrivilegesAction:undefined,createMetadataAction:undefined,newMetadataWindow:undefined,mdImportAction:undefined,adminAction:undefined,actionMenu:undefined,item:null,actionOnSelectionMenu:undefined,admin:false,initComponent:function(){var a=[];a.push(this.createSelectionToolBar());a.push(["->"]);var b=this.getSortByCombo();a.push(OpenLayers.i18n("sortBy"),b,"|");a.push(this.createTemplateMenu());a.push(this.createOtherActionMenu());GeoNetwork.MetadataResultsToolbar.superclass.initComponent.call(this);this.add(a);this.catalogue.on("selectionchange",this.updateSelectionInfo,this);this.catalogue.on("afterLogin",this.updatePrivileges,this);this.catalogue.on("afterLogout",this.updatePrivileges,this);this.updateSelectionInfo(this.catalogue,0);},getSortByCombo:function(){var a=this;this.sortByCombo=new Ext.form.ComboBox({mode:"local",id:"sortByToolBar",triggerAction:"all",value:"relevance",width:130,store:GeoNetwork.util.SearchFormTools.getSortByStore(),valueField:"id",displayField:"name",listeners:{select:function(d,e,b){if(this.sortByCmp){this.sortByCmp.setValue(d.getValue());var f=d.getValue().split("#");Ext.getCmp("E_sortBy").setValue(f[0]);Ext.getCmp("sortOrder").setValue(f[1]);}if(this.searchBtCmp){this.searchBtCmp.fireEvent("click");}},scope:a}});return this.sortByCombo;},clickTemplateMenu:function(a,b){if(b){this.applyTemplate(a.getId());}this.initRatingWidget();},createMassiveActionMenu:function(a){this.deleteAction=new Ext.menu.Item({text:OpenLayers.i18n("delete"),iconCls:"cancel",id:"deleteAction",handler:function(){this.catalogue.massiveOp("Delete",function(){this.catalogue.metadataSelectNone();});},scope:this,hidden:a});this.ownerAction=new Ext.menu.Item({text:OpenLayers.i18n("newOwner"),id:"ownerAction",handler:function(){this.catalogue.massiveOp("NewOwner");},scope:this,hidden:a});this.updateCategoriesAction=new Ext.menu.Item({text:OpenLayers.i18n("updateCategories"),id:"updateCategoriesAction",handler:function(){this.catalogue.massiveOp("Categories");},scope:this,hidden:a});this.updatePrivilegesAction=new Ext.menu.Item({text:OpenLayers.i18n("updatePrivileges"),id:"updatePrivilegesAction",iconCls:"privIcon",handler:function(){this.catalogue.massiveOp("Privileges");},scope:this,hidden:a});this.selectionActions.push(this.deleteAction,this.ownerAction,this.updateCategoriesAction,this.updatePrivilegesAction);this.actionMenu.addItem(this.deleteAction);this.actionMenu.addItem(this.ownerAction);this.actionMenu.addItem(this.updateCategoriesAction);this.actionMenu.addItem(this.updatePrivilegesAction);},createAdminMenu:function(a){this.actionMenu.addItem("-");this.otherItem=new Ext.menu.TextItem({html:'<b class="menu-title">'+OpenLayers.i18n("adminAction")+"</b>",hidden:true});this.actionMenu.addItem(this.otherItem);this.createMetadataAction=new Ext.menu.Item({text:OpenLayers.i18n("newMetadata"),iconCls:"addIcon",handler:function(){if(this.newMetadataWindow){this.newMetadataWindow.close();this.newMetadataWindow=undefined;}if(!this.newMetadataWindow){var b=new GeoNetwork.editor.NewMetadataPanel({getGroupUrl:this.catalogue.services.getGroups,catalogue:this.catalogue});this.newMetadataWindow=new Ext.Window({title:OpenLayers.i18n("newMetadata"),width:600,height:420,layout:"fit",modal:true,items:b,closeAction:"hide",constrain:true,iconCls:"addIcon"});}this.newMetadataWindow.show();},scope:this,hidden:a});this.actionMenu.addItem(this.createMetadataAction);this.mdImportAction=new Ext.menu.Item({text:OpenLayers.i18n("importMetadata"),handler:function(){this.catalogue.metadataImport();},scope:this,hidden:a});this.actionMenu.addItem(this.mdImportAction);this.adminAction=new Ext.menu.Item({text:OpenLayers.i18n("administration"),handler:function(){this.catalogue.admin();},scope:this,hidden:a});this.actionMenu.addItem(this.adminAction);},createTemplateMenu:function(){var e=this.metadataResultsView.getTemplates();var d=[];var a;for(a in e){if(e.hasOwnProperty(a)){var b=new Ext.Button({text:"",enableToggle:true,toggleGroup:"tpl",id:a,iconCls:"mn-view-"+a.toLowerCase(),toggleHandler:this.clickTemplateMenu,scope:this.metadataResultsView,pressed:(a==="FULL"?true:false)});d.push(b);}}return[d,"|"];},createOtherActionMenu:function(){this.actionMenu=new Ext.menu.Menu();
var d=new Ext.Action({text:OpenLayers.i18n("exportCsv"),handler:function(){this.catalogue.csvExport();},scope:this});var b=new Ext.Action({text:OpenLayers.i18n("exportZip"),iconCls:"md-mn-zip",handler:function(){this.catalogue.mefExport();},scope:this});var a=new Ext.Action({text:OpenLayers.i18n("printSel"),iconCls:"md-mn-pdf",handler:function(){this.catalogue.pdfExport();},scope:this});this.selectionActions.push(b,d,a);this.actionMenu.add('<b class="menu-title">'+OpenLayers.i18n("onSelection")+"</b>",b,d,a);this.createMassiveActionMenu(!this.catalogue.isIdentified());this.createAdminMenu(!this.catalogue.isIdentified());this.actionOnSelectionMenu=new Ext.Button({text:OpenLayers.i18n("otherActions"),menu:this.actionMenu});return this.actionOnSelectionMenu;},createSelectionToolBar:function(){var b=new Ext.Action({text:OpenLayers.i18n("allInPage"),handler:function(){this.metadataResultsView.selectAllInPage();},scope:this});var a=new Ext.Action({text:OpenLayers.i18n("all"),handler:function(){this.catalogue.metadataSelectAll();this.metadataResultsView.selectAll();},scope:this});var d=new Ext.Action({text:OpenLayers.i18n("none"),handler:function(){this.catalogue.metadataSelectNone();this.metadataResultsView.selectNone();},scope:this});var e={id:"md-selection-info",xtype:"tbtext",text:OpenLayers.i18n("noneSelected")};this.catalogue.on("selectionchange",this.updateSelectionInfo,this);return[e,"|",{xtype:"tbtext",text:OpenLayers.i18n("select")},b,{xtype:"tbtext",text:", "},a,{xtype:"tbtext",text:", "},d];},updateSelectionInfo:function(b,a){if(!this.mdSelectionInfoCmp){this.mdSelectionInfoCmp=Ext.getCmp(this.mdSelectionInfo);}Ext.each(this.selectionActions,function(d){if(a===0){d.disable();}else{d.enable();}});this.mdSelectionInfoCmp.setText(a+" "+OpenLayers.i18n("selected"));},updatePrivileges:function(d,a){var b=[this.deleteAction,this.ownerAction,this.updateCategoriesAction,this.updatePrivilegesAction,this.createMetadataAction,this.mdImportAction,this.mdImportAction,this.adminAction,this.otherItem];Ext.each(b,function(){this.setVisible(a);});},onDestroy:function(){GeoNetwork.MetadataResultsToolbar.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gn_metadataresultstoolbar",GeoNetwork.MetadataResultsToolbar);Ext.namespace("GeoNetwork");GeoNetwork.TagCloudView=Ext.extend(Ext.DataView,{catalogue:undefined,multiSelect:true,root:"keywords.keyword",qurey:undefined,searchField:"themekey",onSuccess:null,onFailure:null,overClass:"tag-cloud-hover",itemSelector:"li.tag-cloud",emptyText:"",autoWidth:true,initComponent:function(){GeoNetwork.TagCloudView.superclass.initComponent.call(this);this.tpl=this.tpl||new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="tag-cloud tag-cloud-{class}">','<a href="#" onclick="javascript:catalogue.kvpSearch(\'fast='+this.catalogue.metadataStore.fast+"&summaryOnly=0&from=1&to=20&hitsPerPage=20&"+this.searchField+"={value}', "+this.onSuccess+","+this.onFailure+', null);" alt="{value}" title="{count} records">{value}</a>',"</li>","</tpl>","</ul>");this.store=this.catalogue.summaryStore;if(this.query){this.catalogue.kvpSearch(this.query,null,null,null,true);}}});Ext.reg("gn_tagcloudview",GeoNetwork.TagCloudView);Ext.namespace("GeoNetwork");GeoNetwork.Templates=Ext.extend(Ext.XTemplate,{compiled:false,disableFormats:false,catalogue:null,sortOrder:0,abstractMaxSize:50,xmlTplMarkup:['<?xml version="1.0" encoding="UTF-8"?>','<node id="{id}" type="{type}">',"<site>","<name>{site_name}</name>",'<tpl if="values.site_ogctype">',"<ogctype>{site_ogctype}</ogctype>","</tpl>",'<tpl if="values.site_url">',"<url>{site_url}</url>","</tpl>",'<tpl if="values.site_icon">',"<icon>{site_icon}</icon>","</tpl>",'<tpl if="values.site_account_use">',"<account>","<use>{site_account_use}</use>","<username>{site_account_username}</username>","<password>{site_account_password}</password>","</account>","</tpl>","</site>","<options>",'<tpl if="values.options_every">',"<every>{options_every}</every>","</tpl>",'<tpl if="values.options_onerunonly">',"<oneRunOnly>{options_onerunonly}</oneRunOnly>","</tpl>",'<tpl if="values.options_lang">',"<lang>{options_lang}</lang>","</tpl>",'<tpl if="values.options_topic">',"<topic>{options_topic}</topic>","</tpl>",'<tpl if="values.options_createthumbnails">',"<createThumbnails>{options_createthumbnails}</createThumbnails>","</tpl>",'<tpl if="values.options_uselayer">',"<useLayer>{options_uselayer}</useLayer>","</tpl>",'<tpl if="values.options_uselayermd">',"<useLayerMd>{options_uselayermd}</useLayerMd>","</tpl>",'<tpl if="values.options_datasetcategory">',"<datasetcategory>{options_datasetcategory}</datasetcategory>","</tpl>","</options>","<content>","</content>","<privileges>","</privileges>",'<group id="1">','<operation name="view" />','<operation name="dynamic" />',"</group>","<categories>","</categories>",'<tpl if="values.info_result_total">',"</tpl>","</node>"],initComponent:function(){GeoNetwork.Templates.superclass.initComponent.call(this);},getHarvesterTemplate:function(){return new Ext.XTemplate(this.xmlTplMarkup);}});GeoNetwork.Templates.TITLE='<h1><input type="checkbox" <tpl if="selected==\'true\'">checked="true"</tpl> class="selector" onclick="javascript:catalogue.metadataSelect((this.checked?\'add\':\'remove\'), [\'{uuid}\']);"/><a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');return false;">{title}</a><span class="md-action-menu"> - <a rel="mdMenu">'+OpenLayers.i18n("mdMenu")+"</a></span></h1>";GeoNetwork.Templates.RATING_TPL='<tpl if="isharvested==\'n\' || harvestertype==\'geonetwork\'"><div class="rating"><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'1\'">checked="true"</tpl> value="1"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'2\'">checked="true"</tpl> value="2"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'3\'">checked="true"</tpl> value="3"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'4\'">checked="true"</tpl> value="4"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'5\'">checked="true"</tpl> value="5"/></div></tpl>';GeoNetwork.Templates.LOGO='<div class="md-logo"><img src="{[catalogue.URL]}/images/logos/{source}.gif"/></div>';GeoNetwork.Templates.SIMPLE=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-simple" title="{abstract}">','<table><tr><td style="width:30px;">',GeoNetwork.Templates.LOGO,'</td><td id="{uuid}">',GeoNetwork.Templates.TITLE,'<tpl if="subject">','<span class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></span>","</tpl>","</td></tr></table>","</li>","</tpl>","</ul>");GeoNetwork.Templates.THUMBNAIL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-thumbnail">','<div class="md-wrap" id="{uuid}" title="{abstract}">',GeoNetwork.Templates.TITLE,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="{thumbnail}"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>",'<tpl for="links">',"<tpl if=\"values.type == 'application/vnd.ogc.wms_xml'\">","<a href=\"#\" class=\"md-mn addLayer\" title=\"{title}\" alt=\"{title}\" onclick=\"app.switchMode('1', true);app.getIMap().addWMSLayer([['{title}', '{href}', '{name}', '{id}']]);\">&nbsp;</a>","</tpl>","</tpl>","</div>","</li>","</tpl>","</ul>");GeoNetwork.Templates.FULL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-full">',"<table><tr>",'<td class="left">',GeoNetwork.Templates.LOGO,"</td>",'<td id="{uuid}">',GeoNetwork.Templates.TITLE,'<p class="abstract">{[values.abstract.substring(0, 350)]} ...</p>','<tpl if="subject">','<p class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></p>","</tpl>",'<div class="md-links">','<tpl for="links">',"<tpl if=\"values.type == 'application/vnd.ogc.wms_xml' || values.type == 'OGC:WMS'\">",'<a href="#" class="md-mn addLayer" title="'+OpenLayers.i18n("addToMap")+" {title}\" alt=\"Add layer to map\" onclick=\"app.switchMode('1', true);app.getIMap().addWMSLayer([['{[escape(values.title)]}', '{href}', '{name}', '{id}']]);\">&nbsp;</a>","</tpl>","<tpl if=\"values.type == 'application/vnd.google-earth.kml+xml'\">",'<a href="{href}" class="md-mn md-mn-kml" title="'+OpenLayers.i18n("viewKml")+' {title}" alt="Open kml">&nbsp;</a>',"</tpl>","<tpl if=\"values.type == 'application/zip' || values.type == 'application/x-compressed'\">",'<a href="{href}" class="md-mn md-mn-zip" title="'+OpenLayers.i18n("downloadLink")+' {title}" alt="Download">&nbsp;</a>',"</tpl>","<tpl if=\"values.type == 'text/html'\">",'<a href="{href}" class="md-mn md-mn-www" title="'+OpenLayers.i18n("webLink")+' {title}" alt="Web link" target="_blank">&nbsp;</a>',"</tpl>","</tpl>",'<tpl if="this.hasDownloadLinks(values.links)">','<a href="#" onclick="catalogue.metadataPrepareDownload({id});" class="md-mn downloadAllIcon" title="'+OpenLayers.i18n("prepareDownload")+'" alt="download">&nbsp;</a>',"</tpl>","</div>",'</td><td class="thumb">',GeoNetwork.Templates.RATING_TPL,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="{thumbnail}"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>",'</td><td class="icon">','<div class="md-mn valid-{valid}" title="'+OpenLayers.i18n("validityInfo"),'<tpl for="valid_details">',"{values.type}: ","<tpl if=\"values.valid == '1'\">"+OpenLayers.i18n("valid")+"</tpl>","<tpl if=\"values.valid == '0'\">"+OpenLayers.i18n("notValid")+"</tpl>","<tpl if=\"values.valid == '-1'\">"+OpenLayers.i18n("notDetermined")+"</tpl>","<tpl if=\"values.ratio != ''\"> ({values.ratio}) </tpl> - ","</tpl>",'">&nbsp;</div>','</td><td class="icon" title="'+OpenLayers.i18n("metadataCategories")+'">','<tpl for="category">','<div class="md-mn cat-{value}" title="{value}">&nbsp;</div>',"</tpl>","</td></tr></table>",'<div class="relation" title="'+OpenLayers.i18n("relateddatasets")+'"><span></span><ul id="md-relation-{id}"></ul></div>','<div class="md-contact">','<tpl for="contact">',"<tpl if=\"applies=='resource'\">",'<span title="{role} - {applies}"><tpl if="values.logo !== undefined && values.logo !== \'\'">','<img src="{logo}" class="orgLogo"/>',"</tpl>","{name}&nbsp;&nbsp;</span>","</tpl>","</tpl>","<tpl if=\"edit=='true' && isharvested!='y'\">",'<br/><span class="md-mn md-mn-user" title="'+OpenLayers.i18n("ownerName")+'">{ownername} - '+OpenLayers.i18n("lastUpdate")+"{[values.changedate.split('T')[0]]}</span>","</tpl>","</div>","</li>","</tpl>","</ul>",{hasDownloadLinks:function(a){var b;
for(b=0;b<a.length;b++){if(a[b].type==="application/x-compressed"){return true;}}return false;}});GeoNetwork.Templates.Relation={SHORT:['<li class="{type}">','<a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');return false;" title="{abstract}">{title}</a>',"</li>"]};Ext.namespace("GeoNetwork.view");GeoNetwork.view.ViewWindow=Ext.extend(Ext.Window,{defaultConfig:{layout:"fit",width:700,height:740,border:false,lang:"en",autoScroll:true,closeAction:"destroy",currTab:"simple",displayTooltip:true,printDefaultForTabs:false,printMode:undefined,relationTypes:"service|children|related|parent|dataset|fcat",maximizable:true,maximized:false,collapsible:true,collapsed:false},serviceUrl:undefined,catalogue:undefined,metadataUuid:undefined,record:undefined,resultsView:undefined,actionMenu:undefined,tipTpl:undefined,metadataSchema:undefined,cache:{},tooltips:[],relatedTpl:undefined,getLinkedData:function(){var b=new GeoNetwork.data.MetadataRelationStore(this.catalogue.services.mdRelation+"?type="+this.relationTypes+"&fast=false&uuid="+escape(this.metadataUuid),null,true),a=this;b.load();b.on("load",function(){this.each(a.displayLinkedData,a);});},displayLinkedData:function(a){var g=Ext.query("table.related",this.body.dom),e=a.get("type");var d=Ext.get(g[0]);var b=d.child("tr td[class*="+e+"]");var f=this.relatedTpl.apply(a.data);if(b!==null){b.next().child("li").insertHtml("afterEnd",f);}else{d.child("tr").insertHtml("beforeBegin",'<tr><td class="main '+e+'"><span class="cat-'+e+' icon">'+OpenLayers.i18n("related"+e)+"</span></td><td><ul>"+f+"</ul></td></tr>");}},createActionMenu:function(){if(!this.actionMenu){this.actionMenu=new GeoNetwork.MetadataMenu({catalogue:this.catalogue,record:this.record,resultsView:this.resultsView});}var a={text:OpenLayers.i18n("mdMenu"),menu:this.actionMenu};return a;},createViewMenu:function(d){var a=['<b class="menu-title">'+OpenLayers.i18n("chooseAView")+"</b>"];this.viewMenu=new Ext.menu.Menu({items:a});var b={text:OpenLayers.i18n("viewMode"),iconCls:"viewModeIcon",menu:this.viewMenu};return b;},updateViewMenu:function(){var f=Ext.query("span.mode",this.body.dom),d=[],h,g,q,m=this.getId(),a=true;d.push([OpenLayers.i18n("simpleViewMode"),"view-simple",a]);Ext.ux.Lightbox.register("a[rel^=lightbox-viewset]",true);this.printMode=this.currTab;for(h=0;h<f.length;h++){if(f[h].firstChild){var b=f[h].getAttribute("id");var s=f[h].innerHTML;var l=Ext.get(f[h]).next();var r=l.query("LI");var o=l.query("LI[id="+this.currTab+"]");var t=o.length===1;if(!t){Ext.get(f[h]).parent().remove();}else{if(l&&r.length===1){l.remove();}else{for(g=0;g<r.length;g++){q=Ext.get(r[g]);if(this.printDefaultForTabs){this.printMode="default";}q.on("click",function(){Ext.getCmp(m).switchToTab(this);},q.getAttribute("id"));}}}d.push([s,b,t]);if(t===true){a=false;}}}d[0][2]=a;this.updateToolbar(d);},updateToolbar:function(d){var b,a;this.viewMenu.removeAll();for(b=0;b<d.length;b++){a=d[b];this.viewMenu.add({text:a[0],checked:false,disabled:a[2],group:"mode",value:a[1],listeners:{checkchange:this.onViewCheck,scope:this}});}this.viewMenu.doLayout();},switchToTab:function(a){this.currTab=a;this.onViewCheck({value:this.currTab},true);},onViewCheck:function(b,a){if(a){this.currTab=b.value;this.load({url:this.serviceUrl+"&currTab="+this.currTab,callback:this.afterMetadataLoad,scope:this});}},afterMetadataLoad:function(){this.cache={};this.tooltips=[];this.updateViewMenu();this.catalogue.extentMap.initMapDiv();if(this.currTab==="view-simple"||this.currTab==="inspire"||this.currTab==="simple"){this.getLinkedData();}this.registerTooltip();},createPrintMenu:function(){return new Ext.Button({iconCls:"print",tooltip:OpenLayers.i18n("printTT"),listeners:{click:function(b,a){window.open("print.html?uuid="+this.metadataUuid+"&currTab="+this.printMode+"&hl="+this.lang);},scope:this}});},createTooltipMenu:function(){return new Ext.Button({enableToggle:true,pressed:this.displayTooltip,iconCls:"book",tooltip:OpenLayers.i18n("enableTooltip"),listeners:{toggle:function(b,a){this.displayTooltip=a;this.enableTooltip();},scope:this}});},enableTooltip:function(){Ext.each(this.tooltips,function(b,a){if(this.displayTooltip){b.enable();}else{b.disable();}},this);},registerTooltip:function(){var a=Ext.query("th[id]",this.body.dom);a=a.concat(Ext.query("legend[id]",this.body.dom));Ext.each(a,function(g,b,d){var l=Ext.get(g);var m=l.getAttribute("id");if(l.is("TH")){var j=l.up("FIELDSET");var h=function(){if(this.displayTooltip){this.loadHelp(m,j);}};l.parent().on("mouseover",h,this);}else{var h=function(){if(this.displayTooltip){this.loadHelp(m);}};l.on("mouseover",h,this);}},this);},loadHelp:function(d,b){if(!this.cache[d]){var a=this;GeoNetwork.util.HelpTools.get(d,this.metadataSchema,this.catalogue.services.schemaInfo,function(f){a.cache[d]=a.tipTpl.apply(f.records[0].data);var e=new Ext.ToolTip({target:d,title:f.records[0].get("label"),anchor:b?"top":"bottom",anchorOffset:35,html:a.cache[d]});a.tooltips.push(e);});}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.tipTpl=new Ext.XTemplate(GeoNetwork.util.HelpTools.Templates.SIMPLE);this.relatedTpl=new Ext.XTemplate(this.relatedTpl||GeoNetwork.Templates.Relation.SHORT);this.tools=[{id:"newwindow",qtip:OpenLayers.i18n("newWindow"),handler:function(f,d,b,a){window.open(GeoNetwork.Util.getBaseUrl(location.href)+"#uuid="+this.metadataUuid);this.hide();},scope:this}];this.tbar=[this.createViewMenu(),this.createActionMenu(),"->",this.createPrintMenu(),this.createTooltipMenu()];GeoNetwork.view.ViewWindow.superclass.initComponent.call(this);this.metadataSchema=this.record?this.record.get("schema"):"";this.setTitle(this.record?this.record.get("title"):"");this.add(new Ext.Panel({autoLoad:{url:this.serviceUrl+"&currTab="+this.currTab,callback:this.afterMetadataLoad,scope:this},border:false,frame:false,autoScroll:true}));this.on("beforeshow",function(a){a.setSize(a.getWidth()>Ext.getBody().getWidth()?Ext.getBody().getWidth():a.getWidth(),a.getHeight()>Ext.getBody().getHeight()?Ext.getBody().getHeight():a.getHeight());});}});Ext.reg("gn_view_viewwindow",GeoNetwork.view.ViewWindow);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.SubTemplateSelectionPanel=Ext.extend(Ext.FormPanel,{border:false,catalogue:undefined,namespaces:{xlink:"http://www.w3.org/1999/xlink",gmd:"http://www.isotc211.org/2005/gmd",gmx:"http://www.isotc211.org/2005/gmx",gco:"http://www.isotc211.org/2005/gco",gts:"http://www.isotc211.org/2005/gts",gml:"http://www.opengis.net/gml"},id:"subTemplateSearchForm",contact:Ext.data.Record.create([{name:"xlink"},{name:"name"}]),subTemplateStore:undefined,codeListStore:undefined,subTplTypeField:undefined,addAsXLink:false,itemSelector:null,loadingMask:null,subTemplateCount:null,ref:null,name:null,elementName:null,codeListConfig:{"gmd:CI_ResponsibleParty":{xpath:"gmd:role/gmd:CI_RoleCode/@codeListValue",url:"",label:OpenLayers.i18n("contactRole"),code:"gmd:CI_RoleCode"}},codeListCombo:null,role:"",defaultRole:"pointOfContact",SubTemplateSelected:[],initComponent:function(){this.subTemplateStore=GeoNetwork.data.MetadataResultsStore();this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getSearchField()],items:[this.getSubTemplateItemSelector()]}];this.subTemplateStore.on({loadexception:function(){},beforeload:function(a,b){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();},load:function(){this.loadingMask.hide();},scope:this});this.addEvents("subTemplateSelected");this.bbar=["->",{id:"addAsXLinkCheckBox",xtype:"checkbox",checked:false,boxLabel:OpenLayers.i18n("addAsXLink"),listeners:{check:function(b,a){this.addAsXLink=a;},scope:this}},this.getCodeListCombo()," ",{id:"SubTemplateSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildSubTemplateXmlList();},scope:this}];GeoNetwork.editor.SubTemplateSelectionPanel.superclass.initComponent.call(this);
},getSearchField:function(){this.subTplTypeField=new Ext.form.TextField({name:"E__root",hidden:true,value:""});return[new GeoNetwork.form.SearchField({name:"E_any",store:this.catalogue.metadataStore,triggerAction:function(a){a.doSearch();},scope:this}),this.subTplTypeField,{xtype:"textfield",name:"E__isTemplate",hidden:true,value:"s"}];},setRef:function(a){this.ref=a;},setName:function(a){this.name=a;},setElementName:function(a){this.elementName=a;this.subTplTypeField.setValue(a);if(this.codeListConfig[a]){this.codeListCombo.setVisible(true);}else{this.codeListCombo.setVisible(false);}},setAddAsXLink:function(a){this.addAsXLink=a||false;Ext.getCmp("addAsXLinkCheckBox").setValue(this.addAsXLink);},getCodeListCombo:function(){this.codeListStore=GeoNetwork.data.CodeListStore({url:this.catalogue.services.schemaInfo,codeListName:"gmd:CI_RoleCode"});this.codeListCombo=new Ext.form.ComboBox({id:"codeList",store:this.codeListStore,triggerAction:"all",mode:"local",fieldLabel:"",displayField:"label",valueField:"code"});this.codeListStore.on({load:function(){Ext.getCmp("codeList").setValue(this.defaultRole);},scope:this});return this.codeListCombo;},getSubTemplateItemSelector:function(){var a='<tpl for="."><div class="ux-mselect-item';if(Ext.isIE||Ext.isIE7){a+='" unselectable=on';}else{a+=' x-unselectable"';}a+=">{title}</div></tpl>";this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["uuid","title"],toData:[],msWidth:320,msHeight:230,valueField:"uuid",fromTpl:a,toTpl:a,toLegend:OpenLayers.i18n("selected"),fromLegend:OpenLayers.i18n("found"),fromStore:this.subTemplateStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var b=this.getForm().findField("itemselector");b.reset.call(b);},scope:this}]});this.itemSelector.on({change:function(b){Ext.getCmp("SubTemplateSearchValidateButton").setDisabled(b.toStore.getCount()<1);}});return this.itemSelector;},buildSubTemplateXmlList:function(){if(!this.elementName){alert("Error: sub template root element name is not defined!");return;}var e="";var d="~";var b=this.itemSelector.toMultiselect.store;this.SubTemplateSelected=[];this.codeListValue="";this.subTemplateCount=0;if(this.codeListConfig[this.elementName]&&this.codeListConfig[this.elementName].xpath){e="&process="+this.codeListConfig[this.elementName].xpath+d+Ext.getCmp("codeList").getValue();}var a=this;xlinkCollection=b.collect("uuid");Ext.each(xlinkCollection,function(l,h,j){var f=a.catalogue.services.subTemplate+"?uuid="+l+e;++a.subTemplateCount;if(a.addAsXLink){var g="<"+a.name+a.generateNamespaceDeclaration()+" xlink:href='"+f+"'/>";a.SubTemplateSelected.push(g);}else{a.retrieveSubTemplate(f);}});if(this.addAsXLink){this.fireEvent("subTemplateSelected",this,this.SubTemplateSelected);this.ownerCt.hide();}b.clearFilter();},retrieveSubTemplate:function(a){Ext.getCmp("SubTemplateSearchValidateButton").disable();Ext.Ajax.request({url:a,method:"GET",scope:this,success:function(b){var d=b.responseText;if(d.indexOf(this.elementName)!==-1){this.SubTemplateSelected.push("<"+this.name+this.generateNamespaceDeclaration()+">"+b.responseText+"</"+this.name+">");}Ext.getCmp("SubTemplateSearchValidateButton").enable();this.subTemplateCount-=1;if(this.subTemplateCount===0){this.fireEvent("subTemplateSelected",this,this.SubTemplateSelected);this.ownerCt.hide();}}});},generateNamespaceDeclaration:function(a){var b="";for(var d in this.namespaces){if((a&&a[d])||!a){b+=" xmlns:"+d+'="'+this.namespaces[d]+'"';}}return b;},doSearch:function(){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();GeoNetwork.util.SearchTools.doQueryFromForm(this.id,this.catalogue,1,this.showResults.bind(this),null,false,this.subTemplateStore);},showResults:function(b){var e=new OpenLayers.Format.GeoNetworkRecords();var d=e.read(b.responseText);var a=d.records;if(a.length>0){this.subTemplateStore.loadData(d);}}});Ext.reg("gn_editor_subtemplateselectionpanel",GeoNetwork.editor.SubTemplateSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.CRSSelectionPanel=Ext.extend(Ext.FormPanel,{CRS:Ext.data.Record.create([{name:"authority"},{name:"code"},{name:"version"},{name:"codeSpace"},{name:"description"}]),crsStore:undefined,catalogue:undefined,border:false,first:null,itemSelector:null,loadingMask:null,crsCount:null,ref:null,crsSelected:"",initComponent:function(){this.crsStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchCRS,method:"GET"}),baseParams:{name:"",type:"",maxResults:50},reader:new Ext.data.XmlReader({record:"crs",id:"code"},this.CRS),fields:["code","codeSpace","authority","description","version"],sortInfo:{field:"description"}});this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getCRSTypeCombo()," ",this.getCRS(),"->",OpenLayers.i18n("maxResults"),this.getLimitInput()],items:[this.getCRSItemSelector()]}];this.crsStore.on({loadexception:function(){},beforeload:function(a,b){if(Ext.getCmp("maxResults")){a.baseParams.maxResults=Ext.getCmp("maxResults").getValue();}if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();},load:function(){this.loadingMask.hide();},scope:this});this.addEvents("crsSelected");this.bbar=["->",{id:"crsSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildCRSXmlList();},scope:this}];GeoNetwork.editor.CRSSelectionPanel.superclass.initComponent.call(this);},getCRS:function(){return new GeoNetwork.form.SearchField({id:"crsSearchField",width:240,store:this.crsStore,paramName:"name"});},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:50,width:40};},getCRSTypeCombo:function(){var d=Ext.data.Record.create([{name:"id"}]);var b=new Ext.data.Store({url:this.catalogue.services.getCRSTypes,reader:new Ext.data.XmlReader({record:"type"},d),fields:["id"]});var a=new d({filename:OpenLayers.i18n("any")});a.set("id","");b.add(a);b.load({add:true});return{xtype:"combo",width:150,id:"search-crs",value:0,store:b,triggerAction:"all",mode:"local",displayField:"id",valueField:"id",listWidth:250,listeners:{select:function(h,e,f){this.crsStore.removeAll();this.crsStore.baseParams.type=h.getValue();var g=Ext.getCmp("crsSearchField").getValue();if(g.length<1){this.crsStore.baseParams.name="";}else{this.crsStore.baseParams.name=g;}this.crsStore.reload();},clear:function(e){this.crsStore.load();},scope:this}};},getCRSItemSelector:function(){var a='<tpl for="."><div class="ux-mselect-item';if(Ext.isIE||Ext.isIE7){a+='" unselectable=on';}else{a+=' x-unselectable"';}a+=">{description}</div></tpl>";this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["code","codeSpace","authority","description","version"],toData:[],msWidth:320,msHeight:230,valueField:"code",fromTpl:a,toTpl:a,toLegend:OpenLayers.i18n("selectedCRS"),fromLegend:OpenLayers.i18n("foundCRS"),fromStore:this.crsStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var b=this.getForm().findField("itemselector");b.reset.call(b);},scope:this}]});this.itemSelector.on({change:function(b){Ext.getCmp("crsSearchValidateButton").setDisabled(b.toStore.getCount()<1);}});return this.itemSelector;},setRef:function(a){this.ref=a;},buildCRSXmlList:function(){this.crsSelected="";var a=this.itemSelector.toMultiselect.store;this.first=true;a.each(function(b){var d="<gmd:referenceSystemInfo xmlns:gmd='http://www.isotc211.org/2005/gmd'  xmlns:gco='http://www.isotc211.org/2005/gco'><gmd:MD_ReferenceSystem><gmd:referenceSystemIdentifier><gmd:RS_Identifier><gmd:code><gco:CharacterString>"+b.data.description+"</gco:CharacterString></gmd:code><gmd:codeSpace><gco:CharacterString>"+b.data.codeSpace+"</gco:CharacterString></gmd:codeSpace><gmd:version><gco:CharacterString>"+b.data.version+"</gco:CharacterString></gmd:version></gmd:RS_Identifier></gmd:referenceSystemIdentifier></gmd:MD_ReferenceSystem></gmd:referenceSystemInfo>";
this.crsSelected+=(this.first?"":"&amp;&amp;&amp;")+d;this.first=false;},this);if(this.crsSelected!==""){this.fireEvent("crsSelected",this.crsSelected);this.ownerCt.hide();}}});Ext.reg("gn_editor_crsselectionpanel",GeoNetwork.editor.CRSSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.EditorPanel=Ext.extend(Ext.Panel,{border:false,editUrl:undefined,updateUrl:undefined,frame:false,editorToolBar:undefined,tbarConfig:undefined,id:"editorPanel",defaultConfig:{defaultViewMode:"simple",layout:"border",height:800,xlinkOptions:{},utilityPanelCollapsed:false,utilityPanelConfig:{thumbnailPanel:{collapsed:false},relationPanel:{collapsed:true},validationPanel:{collapsed:true},suggestionPanel:{collapsed:true},helpPanel:{collapsed:false}}},catalogue:undefined,toolbar:undefined,validationPanel:undefined,relationPanel:undefined,helpPanel:undefined,suggestionPanel:undefined,thumbnailPanel:undefined,editorMainPanel:undefined,metadataId:undefined,versionId:undefined,metadataMode:undefined,metadataSchema:undefined,metadataType:undefined,position:undefined,relatedMetadataStore:undefined,keywordSelectionWindow:undefined,contactSelectionWindow:undefined,subTemplateSelectionWindow:undefined,crsSelectionWindow:undefined,logoSelectionWindow:undefined,linkedMetadataSelectionWindow:undefined,geoPublisherWindow:undefined,lang:undefined,fileUploadWindow:undefined,mask:undefined,managerInitialized:false,container:undefined,setContainer:function(a){if(!this.container){this.container=a;}},showLogoSelectionPanel:function(a){if(!this.logoSelectionWindow){var b=new GeoNetwork.editor.LogoSelectionPanel({ref:a,serviceUrl:this.catalogue.services.getIcons,logoAddUrl:this.catalogue.services.logoAdd,logoUrl:this.catalogue.services.harvesterLogoUrl,listeners:{logoselected:function(f,d){var e=f.store.getAt(d);Ext.getDom(f.ref).value=f.logoUrl+e.get("name");}}});this.logoSelectionWindow=new Ext.Window({title:OpenLayers.i18n("logoSelectionWindow"),width:300,height:300,layout:"fit",modal:true,items:b,closeAction:"hide",constrain:true,iconCls:"attached"});}this.logoSelectionWindow.items.get(0).setRef(a);this.logoSelectionWindow.show();},showFileUploadPanel:function(e,d){var a=this;if(this.fileUploadWindow){this.fileUploadWindow.close();this.fileUploadWindow=undefined;}if(!this.fileUploadWindow){var b=new Ext.form.FormPanel({fileUpload:true,defaultType:"textfield",items:[{name:"id",allowBlank:false,hidden:true,value:this.metadataId},{name:"access",allowBlank:false,hidden:true,value:"private"},{name:"ref",allowBlank:false,hidden:true,value:d},{name:"proto",hidden:true,value:""},{name:"overwrite",fieldLabel:"Overwrite",checked:true,xtype:"checkbox"},{xtype:"fileuploadfield",emptyText:OpenLayers.i18n("selectFile"),fieldLabel:"File",allowBlank:false,name:"f_"+d,buttonText:"",buttonCfg:{iconCls:"uploadIconAdd"}}],buttons:[{text:OpenLayers.i18n("upload"),iconCls:"attachedAdd",handler:function(){if(b.getForm().isValid()){b.getForm().submit({url:a.catalogue.services.upload,waitMsg:OpenLayers.i18n("uploading"),success:function(f,h){var j=h.result.fname;var g=Ext.getDom("_"+d);if(g){g.value=j;}a.save();a.fileUploadWindow.hide();}});}}},{text:OpenLayers.i18n("reset"),handler:function(){b.getForm().reset();}}]});this.fileUploadWindow=new Ext.Window({title:OpenLayers.i18n("fileUploadWindow"),width:300,height:300,layout:"fit",modal:true,items:b,closeAction:"hide",constrain:true,iconCls:"attached"});}this.fileUploadWindow.show();},showGeoPublisherPanel:function(d,a,l,b,g,j,f,m){var e=this;if(this.geoPublisherWindow){this.geoPublisherWindow.close();this.geoPublisherWindow=undefined;}if(!this.geoPublisherWindow){var h=new GeoNetwork.editor.GeoPublisherPanel({width:650,height:300,layers:GeoNetwork.map.BACKGROUND_LAYERS,extent:m,serviceUrl:this.catalogue.services.geopublisher,listeners:{addOnLineSource:function(o,u,t){var v;var r="";var q=(u.get("id").indexOf("mapserver")===-1?u.get("namespacePrefix")+":":"")+this.layerName;var w="_X"+f+"_"+j.replace(":","COLON");var s="<gmd:onLine xmlns:gmd=&quot;http://www.isotc211.org/2005/gmd&quot; xmlns:gco=&quot;http://www.isotc211.org/2005/gco&quot;><gmd:CI_OnlineResource><gmd:linkage><gmd:URL>${ogcurl}</gmd:URL></gmd:linkage><gmd:protocol><gco:CharacterString>${protocol}</gco:CharacterString></gmd:protocol><gmd:name><gco:CharacterString>${layerName}</gco:CharacterString></gmd:name><gmd:description><gco:CharacterString>${metadataTitle}</gco:CharacterString></gmd:description></gmd:CI_OnlineResource></gmd:onLine>";for(v in t){if(t.hasOwnProperty(v)&&t[v].checked===true){r+=OpenLayers.String.format(s,{ogcurl:u.get(v+"Url"),protocol:t[v].label,layerName:q,metadataTitle:this.metadataTitle+"("+t[v].label+")"})+"&&&";}}GeoNetwork.editor.EditorTools.addHiddenFormField(w,r);e.save();e.geoPublisherWindow.hide();}}});this.geoPublisherWindow=new Ext.Window({title:OpenLayers.i18n("geoPublisherWindowTitle"),layout:"fit",modal:true,items:h,closeAction:"hide",constrain:true,iconCls:"repository"});}this.geoPublisherWindow.items.get(0).setRef(d,a,l,b,g);this.geoPublisherWindow.setTitle(OpenLayers.i18n("geoPublisherWindowTitle")+" "+b);this.geoPublisherWindow.show();},showSubTemplateSelectionPanel:function(e,b,a){var d=this;if(this.subTemplateSelectionWindow){this.subTemplateSelectionWindow.close();this.subTemplateSelectionWindow=undefined;}if(!this.subTemplateSelectionWindow){var f=new GeoNetwork.editor.SubTemplateSelectionPanel({width:620,height:300,catalogue:this.catalogue,listeners:{subTemplateSelected:function(h,g){GeoNetwork.editor.EditorTools.addHiddenFormFieldForFragment(h,g,d);}}});this.subTemplateSelectionWindow=new Ext.Window({title:OpenLayers.i18n("SelectionWindowTitle"),layout:"fit",items:f,closeAction:"hide",constrain:true,iconCls:"searchIcon"});}this.subTemplateSelectionWindow.items.get(0).setRef(e);this.subTemplateSelectionWindow.items.get(0).setName(b);this.subTemplateSelectionWindow.items.get(0).setElementName(a);this.subTemplateSelectionWindow.items.get(0).setAddAsXLink(this.xlinkOptions.CONTACT);this.subTemplateSelectionWindow.show();},showKeywordSelectionPanel:function(b){var a=this;if(this.keywordSelectionWindow){this.keywordSelectionWindow.close();this.keywordSelectionWindow=undefined;}if(!this.keywordSelectionWindow){this.keywordSelectionPanel=new GeoNetwork.editor.KeywordSelectionPanel({catalogue:this.catalogue,listeners:{keywordselected:function(d,e){GeoNetwork.editor.EditorTools.addHiddenFormFieldForFragment(d,e,a);}}});this.keywordSelectionWindow=new Ext.Window({title:OpenLayers.i18n("keywordSelectionWindowTitle"),width:620,height:300,layout:"fit",modal:true,items:this.keywordSelectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"});}this.keywordSelectionWindow.items.get(0).setRef(b);this.keywordSelectionWindow.items.get(0).setAddAsXLink(this.xlinkOptions.KEYWORD);this.keywordSelectionWindow.show();},showCRSSelectionPanel:function(d,a){var b=this;if(!this.crsSelectionWindow){this.crsSelectionPanel=new GeoNetwork.editor.CRSSelectionPanel({catalogue:this.catalogue,listeners:{crsSelected:function(e){var f="_X"+d+"_"+a.replace(":","COLON");GeoNetwork.editor.EditorTools.addHiddenFormField(f,e);b.save();}}});this.crsSelectionWindow=new Ext.Window({title:OpenLayers.i18n("crsSelectionWindowTitle"),layout:"fit",width:620,height:300,modal:true,items:this.crsSelectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"});}this.crsSelectionWindow.items.get(0).setRef(d);this.crsSelectionWindow.show();},showLinkedMetadataSelectionPanel:function(d,a,e){var e=e||a;var f=((e==="uuidref"||e==="iso19110"||e==="")?true:false);var b=this;this.linkedMetadataSelectionPanel=new GeoNetwork.editor.LinkedMetadataSelectionPanel({ref:d,catalogue:this.catalogue,singleSelect:f,mode:e,listeners:{linkedmetadataselected:function(h,l){if(f){if(this.ref!==null){Ext.get("_"+this.ref+(a!==""?"_"+a:"")).dom.value=l[0].data.uuid;}else{if(this.mode==="iso19110"){var j=h.catalogue.services.mdRelationInsert+"?parentId="+document.mainForm.id.value+"&childUuid="+l[0].data.uuid;
var m=Ext.Ajax.request({url:j,method:"GET",success:function(r,t){var s=h.catalogue.services.mdProcessing+"?uuidref="+l[0].data.uuid+"&id="+document.mainForm.id.value+"&process=update-attachFeatureCatalogue";b.process(s);},failure:function(r,s){Ext.MessageBox.alert(OpenLayers.String.format(OpenLayers.i18n("errorAndStatusMsg"),{status:r.status,text:r.statusText}));setBunload(true);}});}}}else{var g=[];var q=l.length>1?true:false;Ext.each(l,function(s,r){if(q){a=a+"_"+r;}g.push({tag:"input",type:"hidden",id:a,name:a,value:s.data.uuid});});var o=Ext.DomHelper;o.append(Ext.get("hiddenFormElements"),g);}}}});this.linkedMetadataSelectionWindow=new Ext.Window({title:OpenLayers.i18n("linkedMetadataSelectionWindowTitle"),width:620,height:300,layout:"fit",items:this.linkedMetadataSelectionPanel,closeAction:"hide",constrain:true,iconCls:"linkIcon",modal:true});this.linkedMetadataSelectionWindow.show();},showLinkedServiceMetadataSelectionPanel:function(b,f,e){var d=this;f=Ext.getDom("serviceUrl")&&Ext.getDom("serviceUrl").value;var a=new GeoNetwork.editor.LinkedMetadataSelectionPanel({mode:b,autoWidth:true,ref:null,serviceUrl:f,catalogue:this.catalogue,region:"north",uuid:e,singleSelect:true,listeners:{linkedmetadataselected:function(j,m){var l=Ext.getCmp("getCapabilitiesLayerName").getValue();if(b==="attachService"){var h=d.catalogue.services.mdProcessingXml+"?uuid="+m[0].data.uuid+"&process=update-srv-attachDataset&uuidref="+document.mainForm.uuid.value+"&scopedName="+l;Ext.Ajax.request({url:h,method:"GET",success:function(q,s){var r=q.responseText;if(r.indexOf("Not owner")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("NotOwnerError"));}else{if(r.indexOf("error")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("error")+r);}}var o=d.catalogue.services.mdProcessing+"?id="+d.metadataId+"&process=update-onlineSrc&desc="+l+"&url="+escape(m[0].data.uri)+"&scopedName="+l;Ext.Ajax.request({url:o,method:"GET",success:function(t,u){d.updateEditor(t);},failure:function(t,u){Ext.MessageBox.alert(OpenLayers.i18n("datasetUpdateError"));setBunload(true);}});},failure:function(o,q){Ext.MessageBox.alert(OpenLayers.i18n("ServiceUpdateError"));setBunload(true);}});}else{var g=d.catalogue.services.mdProcessingXml+"?uuid="+m[0].data.uuid+"&process=update-onlineSrc&desc="+l+"&url="+f+"&scopedName="+l;Ext.Ajax.request({url:g,method:"GET",success:function(o,r){var q=o.responseText;if(q.indexOf("Not owner")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("NotOwnerError"));}else{if(q.indexOf("error")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("error")+q);}}d.process(d.catalogue.services.mdProcessing+"?uuid="+document.mainForm.uuid.value+"&process=update-srv-attachDataset&uuidref="+m[0].data.uuid+"&scopedName="+l);},failure:function(o,q){Ext.MessageBox.alert(OpenLayers.i18n("ServiceUpdateError"));setBunload(true);}});}},scope:this}});this.linkedMetadataSelectionWindow=new Ext.Window({title:(b==="attachService"?OpenLayers.i18n("associateService"):OpenLayers.i18n("associateDataset")),layout:"fit",width:620,height:400,items:a,closeAction:"hide",constrain:true,iconCls:"linkIcon",modal:true});this.linkedMetadataSelectionWindow.show();},switchToTab:function(a){Ext.getDom("currTab").value=a;this.save();},finish:function(){this.loadUrl("metadata.update.finish",undefined,this.closeCallback);},save:function(){this.loadUrl("metadata.update.new",undefined,this.loadCallback);},callAction:function(a){this.loadUrl(a,undefined,this.loadCallback);},validate:function(){this.loadUrl("metadata.update.new","validate",this.loadCallback);this.validationPanel.expand(true);},reset:function(){this.loadUrl("metadata.update.forget.new",undefined,this.loadCallback);},cancel:function(){this.loadUrl("metadata.update.forgetandfinish",undefined,this.closeCallback);},process:function(a){this.loadUrl(a,undefined,this.loadCallback,true);},init:function(g,d,e,f,b){var a;this.metadataId=g;if(d){a=this.createUrl+"?id="+this.metadataId+"&group="+e;if(f){a+="&child=y";}if(b){a+="&isTemplate="+b;}}else{a=this.editUrl+"?id="+this.metadataId;}a+="&currTab="+(document.mainForm?document.mainForm.currTab.value:this.defaultViewMode);this.loadUrl(a,undefined,this.loadCallback);if(this.disabled){this.setDisabled(false);}this.container.show();this.ownerCt.show();},loadUrl:function(e,f,a,b){if(document.mainForm){if(typeof f!=="undefined"){document.mainForm.showvalidationerrors.value="true";}else{document.mainForm.showvalidationerrors.value="false";}}var d=this.editorMainPanel.getUpdater();d.update({url:(e.indexOf("/")!==-1?e:this.catalogue.services.rootUrl+e),params:!b&&document.mainForm&&Ext.fly("editForm")!==null?Ext.Ajax.serializeForm("editForm"):undefined,callback:a,scope:this,loadScripts:true,text:OpenLayers.i18n(e)+" ("+e+")"});},closeCallback:function(){this.onEditorClosed();this.ownerCt.hide();},loadCallback:function(d,e,a,b){if(!this.managerInitialized){this.initManager();}if(e){this.metadataLoaded();}else{this.getError(a);}},getError:function(d){if(d&&d.responseText){var h=d.responseText,a,b,e,g,f;b=h.match(/<h2 class=\"error\"\>(.*)<\/h2\>/);a=b||h.match(/<div id=\"error\"\>\n[ ]*<h2>(.*)<\/h2\>/);e=h.match(/<\/h2\>\n[ ]*<p\><\/p\>(.*)/);if(!e){g=h.match(/<p id=\"error\">(.*)<\/p\>/);f=h.match(/<p id=\"stacktrace\">(.*)<\/p\>/);e=g[1]+f[1];}else{e=e[1];}if(a){Ext.Msg.alert(a[1],(e?e:""),function(){this.ownerCt.hide();},this);}}},updateEditor:function(a){this.editorMainPanel.update(a,false,this.metadataLoaded.bind(this));},metadataLoaded:function(){this.metadataSchema=document.mainForm.schema.value;this.metadataType=Ext.getDom("template");this.metadataId=document.mainForm.id.value;this.versionId=document.mainForm.version.value;this.toolbar.setIsMinor(document.mainForm.minor.value);this.toolbar.setIsTemplate(this.metadataType.value);if(this.disabled){this.setDisabled(false);}this.onMetadataUpdated();this.initCalendar();this.validateMetadataFields();this.catalogue.extentMap.initMapDiv();var a=Ext.query("th[id]",this.body.dom);a=a.concat(Ext.query("legend[id]",this.body.dom));Ext.each(a,function(f,b,d){var h=Ext.get(f);var j=h.getAttribute("id");if(h.is("TH")){var g=h.up("FIELDSET");h.parent().on("mouseover",function(){this.helpPanel.updateHelp(j,g);},this);}else{h.on("mouseover",function(){this.helpPanel.updateHelp(j);},this);}},this);this.updateViewMenu();},validateMetadataField:function(a){var b=a.getAttribute("onchange");var d=a.getAttribute("onkeyup");if(typeof b==="function"){b=b.toString();}if(typeof d==="function"){d=d.toString();}if(!a||(b!==null&&b.indexOf("validate")===-1)||(d!==null&&d.indexOf("validate")===-1)){return;}if(a.onkeyup){a.onkeyup();}if(a.onchange){a.onchange();}},validateMetadataFields:function(){var a=Ext.DomQuery.select("select.lang_selector");Ext.each(a,function(b){for(i=0;i<b.options.length;i+=1){if(b.options[i].getAttribute("code").toLowerCase()===this.lang){b.options[i].selected=true;}}});a=Ext.DomQuery.select("input,textarea,select");Ext.each(a,function(b){this.validateMetadataField(b);},this);},initCalendar:function(){var j=Ext.DomQuery.select("div.cal"),g;for(g=0;g<j.length;g++){var b=j[g];var d=b.id;b.id=d+"Id";if(b.firstChild===null||b.childNodes.length===1){var l="Y-m-d";var h=Ext.getDom(d+"_format",this.editorMainPanel.dom);if(h){l=h.value;}var f=Ext.getDom(d+"_cal",this.editorMainPanel.dom);var m=(f?f.value:"");var o=l.indexOf("T")===-1?false:true;if(o){var e=new Ext.ux.form.DateTime({renderTo:b.id,name:d,id:d,value:m,dateFormat:"Y-m-d",timeFormat:"H:i",hiddenFormat:"Y-m-d\\TH:i:s",dtSeparator:"T"});}else{var a=new Ext.form.DateField({renderTo:b,name:d,id:d,width:160,value:m,format:"Y-m-d"});}}}},updateViewMenu:function(){var d=Ext.query("span.mode",this.body.dom),b=[],g,f,m;for(g=0;g<d.length;g++){if(d[g].firstChild){var a=d[g].getAttribute("id");var h=Ext.get(d[g]).next();var q=d[g].innerHTML;var o=h.query("LI");var l=h.query("LI[id="+document.mainForm.currTab.value+"]");var r=l.length===1;if(!r){Ext.get(d[g]).parent().remove();}else{if(h&&o.length===1){h.remove();}else{for(f=0;f<o.length;f++){m=Ext.get(o[f]);
m.on("click",function(){Ext.getCmp("editorPanel").switchToTab(this);},m.getAttribute("id"));}}}b.push([q,a,r]);}}this.toolbar.updateViewMenu(b);},onMetadataUpdated:function(){this.fireEvent("metadataUpdated",this,this.metadataId,this.metadataSchema,this.versionId);},onEditorClosed:function(){this.fireEvent("editorClosed",this);},initManager:function(){var a=this.editorMainPanel.getUpdater();a.on("beforeupdate",function(d,b,e){this.position=this.editorMainPanel.getEl().parent().dom.scrollTop;},this);a.on("update",function(d,b){this.editorMainPanel.getEl().parent().dom.scrollTop=this.position;},this);this.managerInitialized=true;},initPanelLayout:function(){if(this.container){if(this.container.setIconClass){this.container.setIconClass("editing");}if(this.container.setTitle){if(this.metadataId){this.container.setTitle(OpenLayers.String.format(OpenLayers.i18n("editing"),{title:"",uuid:this.metadataId}));}else{}}}},initComponent:function(){var b;Ext.applyIf(this,this.defaultConfig);this.disabled=(this.metadataId?false:true);this.lang=(this.lang?this.lang:"en");this.editUrl=this.catalogue.services.mdEdit;this.createUrl=this.catalogue.services.mdCreate;this.updateUrl=this.catalogue.services.mdUpdate;GeoNetwork.editor.EditorPanel.superclass.initComponent.call(this);panel=this;this.editorMainPanel=new Ext.Panel({border:false,frame:false,id:"editorMainPanel"});var d={editor:panel};Ext.apply(d,this.tbarConfig);this.toolbar=new GeoNetwork.editor.EditorToolbar(d);var a={region:"center",split:true,autoScroll:true,tbar:this.toolbar,minHeigth:400,items:[this.editorMainPanel]};this.add(a);this.validationPanel=new GeoNetwork.editor.ValidationPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,serviceUrl:this.catalogue.services.mdValidate},this.utilityPanelConfig.validationPanel));this.helpPanel=new GeoNetwork.editor.HelpPanel(Ext.applyIf({editor:this,html:""},this.utilityPanelConfig.helpPanel));this.relationPanel=new GeoNetwork.editor.LinkedMetadataPanel(Ext.applyIf({editor:this,metadataId:this.metadataId,metadataSchema:this.metadataSchema,serviceUrl:this.catalogue.services.mdRelation},this.utilityPanelConfig.relationPanel));this.thumbnailPanel=new GeoNetwork.editor.ThumbnailPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,getThumbnail:this.catalogue.services.mdGetThumbnail,setThumbnail:this.catalogue.services.mdSetThumbnail,unsetThumbnail:this.catalogue.services.mdUnsetThumbnail},this.utilityPanelConfig.thumbnailPanel));this.suggestionPanel=new GeoNetwork.editor.SuggestionsPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,catalogue:this.catalogue},this.utilityPanelConfig.suggestionPanel));b={region:"east",split:true,collapsible:true,collapsed:this.utilityPanelCollapsed,hideCollapseTool:true,collapseMode:"mini",autoScroll:true,minWidth:280,width:280,items:[this.thumbnailPanel,this.relationPanel,this.suggestionPanel,this.validationPanel,this.helpPanel]};this.add(b);this.addEvents("metadataUpdated","editorClosed");this.on("added",function(g,e,f){if(e){this.setContainer(e);}this.initPanelLayout();},this);}});Ext.reg("gn_editor_editorpanel",GeoNetwork.editor.EditorPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.EditorToolbar=Ext.extend(Ext.Toolbar,{catalogue:undefined,editor:undefined,defaultConfig:{isTemplate:false,hideTypeMenu:false,editAttributes:false},mapOptions:undefined,layers:undefined,typeMenu:undefined,configMenu:undefined,viewMenu:undefined,saveAction:undefined,saveAndCloseAction:undefined,checkAction:undefined,resetAction:undefined,cancelAction:undefined,minorCheckbox:undefined,minorEdit:false,initComponent:function(){Ext.applyIf(this,this.defaultConfig);var a=[];if(!this.hideTypeMenu){a.push(this.createTypeMenu());a.push(["-"]);}this.saveAction=new Ext.Action({text:OpenLayers.i18n("save"),iconCls:"saveMetadata",handler:function(){this.save();},scope:this.editor});this.checkAction=new Ext.Action({text:OpenLayers.i18n("saveAndCheck"),iconCls:"validateMetadata",handler:function(){this.validationPanel.validate();},scope:this.editor});this.saveAndCloseAction=new Ext.Action({text:OpenLayers.i18n("saveAndClose"),iconCls:"quitMetadata",handler:function(){this.finish();},scope:this.editor});this.minorCheckbox=new Ext.Button({enableToggle:true,text:OpenLayers.i18n("minorEdit"),tooltip:OpenLayers.i18n("minorEditTT"),listeners:{toggle:function(d,b){document.mainForm.minor.value=this.minorEdit=b;},scope:this}});this.resetAction=new Ext.Action({text:OpenLayers.i18n("reset"),iconCls:"refreshMetadata",handler:function(){this.reset();},scope:this.editor});this.cancelAction=new Ext.Action({text:OpenLayers.i18n("cancel"),iconCls:"cancel",handler:function(){this.cancel();},scope:this.editor});a.push(this.createViewMenu(),["-"],this.saveAction,this.checkAction,this.saveAndCloseAction,this.minorCheckbox,["->"],this.resetAction,this.cancelAction,this.configMenu());GeoNetwork.editor.EditorToolbar.superclass.initComponent.call(this);this.add(a);},setIsTemplate:function(b){if(!this.hideTypeMenu){var a=b==="y";Ext.getCmp("type_y").setChecked(a);Ext.getCmp("type_n").setChecked(!a);}},setIsMinor:function(a){var b=true;if(a===""||a==="false"){b=false;}this.minorCheckbox.toggle(b);},createTypeMenu:function(){this.typeMenu={text:OpenLayers.i18n("type"),menu:{items:['<b class="menu-title">'+OpenLayers.i18n("chooseAType")+"</b>",{text:OpenLayers.i18n("md"),checked:true,value:"n",id:"type_n",group:"type",checkHandler:this.onTypeCheck},{text:OpenLayers.i18n("tpl"),checked:true,id:"type_y",group:"type",value:"y",checkHandler:this.onTypeCheck}]}};return this.typeMenu;},configMenu:function(){this.configMenu={iconCls:"configIcon",menu:{items:[{text:OpenLayers.i18n("collapseAll"),checked:false,checkHandler:function(){Ext.each(Ext.DomQuery.select("div.toggle"),function(a){if(a.onclick){a.onclick();}});}},{text:OpenLayers.i18n("editAttributes"),checked:this.editAttributes,checkHandler:function(b,a){this.editAttributes=a;this.editAttributesVisibility();},scope:this}]}};this.editor.on("metadataUpdated",function(){this.editAttributesVisibility();},this);return this.configMenu;},editAttributesVisibility:function(){Ext.each(Ext.select("div.toggle-attr"),function(a){a.setVisibilityMode(Ext.Element.DISPLAY);a.setVisible(this.editAttributes);},this);},createViewMenu:function(d){var a=['<b class="menu-title">'+OpenLayers.i18n("chooseAView")+"</b>"];this.viewMenu=new Ext.menu.Menu({items:a});var b={text:OpenLayers.i18n("viewMode"),iconCls:"viewModeIcon",menu:this.viewMenu};return b;},updateViewMenu:function(d){var b,a;this.viewMenu.removeAll();for(b=0;b<d.length;b++){a=d[b];this.viewMenu.add({text:a[0],checked:false,disabled:a[2],group:"mode",value:a[1],listeners:{checkchange:this.onViewCheck,scope:this}});}this.viewMenu.doLayout();},onViewCheck:function(b,a){if(a){this.editor.editorMainPanel.getEl().parent().scrollTo("top",0);document.mainForm.currTab.value=b.value;this.saveAction.execute();}},onTypeCheck:function(b,a){if(a){Ext.get("template").dom.value=b.value;}},onDestroy:function(){GeoNetwork.EditorToolbar.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gn_editor_editortoolbar",GeoNetwork.editor.EditorToolbar);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.EditorTools={addHiddenFormFieldForFragment:function(a,g,d){var f="_X"+a.ref+"_"+a.name.replace(":","COLON");var b;var e=true;Ext.each(g,function(j,h){g[h]=j.replace('<?xml version="1.0" encoding="UTF-8"?>',"").replace(/\&/g,"&amp;amp;").replace(/\"/g,"&quot;").replace(/\r\n/g,"");if(e){b=g[h];e=false;}else{b+="&amp;&amp;&amp;"+g[h];}});GeoNetwork.editor.EditorTools.addHiddenFormField(f,b);if(d){d.save();}},addHiddenFormField:function(b,e){var a={tag:"input",type:"hidden",id:b,name:b,value:e};var d=Ext.DomHelper;d.append(Ext.get("hiddenFormElements"),a);},showNewMetadataWindow:function(d,g,f,a,b){if(d.newMetadataWindow){d.newMetadataWindow.close();d.newMetadataWindow=undefined;}if(!d.newMetadataWindow){var e=new GeoNetwork.editor.NewMetadataPanel({selectedTpl:g,isChild:a,filter:b,getGroupUrl:d.catalogue.services.getGroups,catalogue:d.catalogue});
d.newMetadataWindow=new Ext.Window({title:f===undefined?OpenLayers.i18n("newMetadata"):f,width:300,height:100,layout:"fit",modal:true,items:e,closeAction:"destroy",constrain:true,iconCls:"addIcon"});}d.newMetadataWindow.show();}};lastclick=0;Checks={message:translate("loseYourChange"),_setMessage:function(a){this.message=a;},_onbeforeunload:function(a){}};function unloadMess(){mess=translate("loseYourChange");return mess;}function doEditorAlert(a,b){$(a).style.display="block";}function setBunload(a){if(a){Checks._setMessage(unloadMess());}else{Checks._setMessage(null);}}function noDoubleClick(){var a=(new Date()).valueOf();if((a-lastclick)>500){setBunload(false);lastclick=a;return true;}else{return false;}}function doNewElementAction(f,e,b,j,g,a){var h=null;var d=false;doNewElementAjax(f,e,b,h,j,g,a,d);}function doNewORElementAction(f,e,b,j,h,g,a){var d=true;doNewElementAjax(f,e,b,j,h,g,a,d);}function doNewAttributeAction(f,e,b,j,g){var h="geonet:attribute";var a=null;var d=false;doNewElementAjax(f,e,b,h,j,g,a,d);}function doNewElementAjax(h,g,a,e,b,o,m,l){var j=document.mainForm.id.value;var f="&id="+j+"&ref="+g+"&name="+a;if(e!=null){f+="&child="+e;}var d=Ext.get(b);Ext.Ajax.request({url:catalogue.services.rootUrl+h,method:"GET",params:f,success:function(q,t){var r=q.responseText;if(e=="geonet:attribute"){Ext.getCmp("editorPanel").save();return;}if(o=="replace"){Ext.DomHelper.insertHtml("afterEnd",d.dom,r);d.remove();}else{if(o=="add"||o=="after"){var s=d.insertHtml("afterEnd",r,true);setAddControls(s,l);}else{if(o=="before"){var s=d.insertHtml("beforeBegin",r,true);setAddControls(s,l);}else{Ext.MessageBox.alert("doNewElementAjax: invalid what: "+o+" should be one of replace, after or before.");}}}Ext.getCmp("editorPanel").metadataLoaded();setBunload(true);},onFailure:function(q){Ext.MessageBox.alert(translate("errorAddElement")+a+translate("errorFromDoc")+" / status "+q.status+" text: "+q.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doRemoveElementAction(f,e,b,a,g){var h=document.mainForm.id.value;var d=Ext.get(a);var j=d.next();var l=d.prev();Ext.Ajax.request({url:catalogue.services.rootUrl+f,method:"GET",params:{id:h,ref:e,parent:b},success:function(m,q){var o=m.responseText;if(o==""){if(bottomElement(d)&&document.mainForm.currTab.value!="simple"){swapControls(d,l);d.remove();d=l;}else{d.remove();d=j;}if(topElement(d)){topControls(d,g);}}else{if(orElement(d)){d.remove();}else{Ext.DomHelper.insertHtml("afterEnd",d.dom,o);d.remove();}}setBunload(true);},failure:function(m,o){Ext.MessageBox.alert(translate("errorDeleteElement")+name+" "+translate("errorFromDoc")+" / status "+m.status+" text: "+m.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doRemoveAttributeAction(d,b,e){var f=document.mainForm.id.value;var a=Ext.get(b+"_block");Ext.Ajax.request({url:catalogue.services.rootUrl+d,method:"GET",params:{id:f,ref:b},success:function(g,l){var h=g.responseText;var j=Ext.getCmp("editorPanel");j.save();setBunload(true);},failure:function(g,h){Ext.MessageBox.alert(translate("errorDeleteAttribute")+name+" "+translate("errorFromDoc")+" / status "+g.status+" text: "+g.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function updateEditorContent(a,d){var b=Ext.getCmp("editorPanel");b.updateEditor(a.responseText);setBunload(true);}function doProcessing(b,a){b.id=document.mainForm.id.value;b.remote="true";Ext.Ajax.request({url:catalogue.services.rootUrl+"metadata.processing",method:"POST",params:b,success:function(d,e){updateEditorContent(d,e);if(a){a();}},failure:function(d){Ext.MessageBox.alert(translate("errorSaveFailed")+"/ status "+d.status+" text: "+d.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doMoveElementAction(e,d,f){var b=Ext.get(f);var a={id:document.mainForm.id.value,ref:d};Ext.Ajax.request({url:catalogue.services.rootUrl+e,method:"POST",params:a,success:function(j){if(e.indexOf("elem.up")!=-1){var g=b.prev();b.insertSibling(g,"after");swapControls(b,g);}else{var h=b.next();b.insertSibling(h,"before");swapControls(b,h);}setBunload(true);},failure:function(g){Ext.MessageBox.alert(translate("errorMoveElement")+d+" / status "+g.status+" text: "+g.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doFileRemoveAction(d,b,a,e){setBunload(false);document.mainForm.access.value=a;document.mainForm.ref.value=b;document.mainForm.action=d;Ext.getCmp("editorPanel").callAction(d);}function checkForFileUpload(g,o,f){var e=Ext.getDom("_"+g);var j=Ext.getDom("s_"+o);var h=Ext.getDom("_"+o);var l=f.startsWith("WWW:DOWNLOAD");var m=j.value;var b=(m.startsWith("WWW:DOWNLOAD")&&m.indexOf("http")>0);if(l){if(!b){alert(OpenLayers.i18n("errorChangeProtocol"));j.value=h.value;}else{h.value=j.value;}return;}var a=Ext.get("di_"+g);var d=Ext.get("db_"+g);h.value=j.value;if(b){if(a!==null){a.hide();}if(d!==null){d.show();}Ext.getCmp("editorPanel").callAction("metadata.update.new");}else{if(a!==null){a.show();}if(d!==null){d.hide();}}}function handleCheckboxAsBoolean(a,b){if(a.checked){Ext.getDom(b).value="true";}else{Ext.getDom(b).value="false";}}function swapControls(f,e){var b=getControlsFromElement(f);var a=getControlsFromElement(e);for(var d=0;d<b.length;++d){var h=b[d].isVisible();var g=a[d]?a[d].isVisible():false;if(a[d]){if(h){a[d].show();}else{a[d].hide();}}if(g){b[d].show();}else{b[d].hide();}}}function getControlsFromElement(d){if(d===null){return[];}var e=d.getAttribute("id");var a=Ext.get("buttons_"+e).query("a");for(var b=0;b<a.length;b++){a[b]=Ext.get(a[b]).setVisibilityMode(Ext.Element.DISPLAY);}return a;}function topElement(a){if(a.prev()==undefined){return true;}else{return(!isSameElement(a.prev(),a));}}function bottomElement(a){if(a.next()==undefined){return true;}else{return(!isSameElement(a.next(),a));}}function getIdSplit(a){var b=a.getAttribute("id");if(b==null){return null;}return b.split("_");}function orElement(b){if(b.next()==undefined){return false;}else{var a=getIdSplit(b.next());var d=getIdSplit(b);if(a==null||d==null){return false;}if(a[0]=="child"&&a[1]==d[0]){return true;}else{return false;}}}function isSameElement(b,a){var e=getIdSplit(b);var d=getIdSplit(a);if(e==null||d==null){return false;}if(e[0]==d[0]){return true;}else{return false;}}function topControls(d,b){var e=getControlsFromElement(d);var a=0;if(e.length==5){a=1;}if(bottomElement(d)&&!orElement(d)){e[0].show();}else{e[0].hide();}if(a==1){if(bottomElement(d)&&!orElement(d)){e[a].show();}else{e[a].hide();}}if(bottomElement(d)){if(b==0){e[1+a].show();}else{e[1+a].hide();}}else{e[1+a].show();}e[2+a].hide();if(bottomElement(d)){e[3+a].hide();}else{e[3+a].show();}}function setAddControls(f,e){elDescs=getControlsFromElement(f);var a=0;if(elDescs.length==5){a=1;}if(e){elDescs[0].hide();}else{elDescs[0].show();}if(a==1){if(e){elDescs[a].hide();}else{elDescs[a].show();}}elDescs[1+a].show();elDescs[2+a].show();if(elDescs[3+a]){elDescs[3+a].hide();}if(topElement(f)){elDescs[2+a].hide();}else{var d=f.prev();var g=getControlsFromElement(d);var b=0;if(g.length==5){b=1;}g[0].hide();if(b==1){g[b].hide();}g[1+b].show();if(topElement(d)){g[2+b].hide();}else{g[2+b].show();}var f=g[3+b];if(f){f.show();}}}function validateNumber(d,f,b){var g=d.value;var a="0123456789";if(!f){if(!validateNonEmpty(d)){return false;}}if(b){a+=".";}var e=true;var h;for(i=0;i<g.length&&e;i++){h=g.charAt(i);if(h=="-"||h=="+"){if(i<0){e=false;}}else{if(a.indexOf(h)==-1){e=false;}}}if(!e){Ext.get(d).addClass("error");return false;}else{Ext.get(d).removeClass("error");return true;}}function validateNonEmpty(a){if(a.value.length<1){Ext.get(a).addClass("error");return false;}else{Ext.get(a).removeClass("error");return true;}}function validateEmail(a){if(!Ext.form.VTypes.email(a.value)){Ext.get(a).addClass("error");return false;}else{Ext.get(a).removeClass("error");return true;}}function toggleFieldset(d,e){var a=Ext.get(d);if(a.hasClass("tgDown")){a.removeClass("tgDown");e.style.display="none";a.addClass("tgRight");}else{a.removeClass("tgRight");
e.style.display="block";a.addClass("tgDown");}}function enableLocalInput(g,b){var f=g.value;var e=g.parentNode.parentNode;var d=e.getElementsByTagName("input");var a=e.getElementsByTagName("textarea");showLocalInput(d,f,b);showLocalInput(a,f,b);}function showLocalInput(d,e,a){for(index in d){var b=d[index];if(b.style!=null&&b.style.display!="none"){b.style.display="none";}}for(index in d){var b=d[index];if(b.name==e){b.style.display="block";if(a){b.focus();}}}}function clearSuggestion(a){if($(a)!=null){$(a).innerHTML="";}}function googleTranslate(d,a,g,h,f){var e={GE:"de",SP:"es",CH:"zh"};if(e[h]){h=e[h];}if(e[f]){f=e[f];}if($(d).value==""){Ext.Msg.alert(translate("translateWithGoogle.emptyInput"));return;}if($(d).value.length>5000){Ext.Msg.alert(translate("translateWithGoogle.maxSize"));return;}if($(a)!=null){$(a).innerHTML="";}try{google.language.translate($(d).value,h,f,function(j){if(!j.error){var l=j.translation.replace(/&#39;/g,"'").replace(/&quot;/g,'"');if($(g)!=null){$(g).value=l;}if($(a)!=null){$(a).innerHTML=l;$(a).style.display="block";}}else{Ext.Msg.alert(j.error.message+" ("+j.error.code+")");}validateMetadataField($(g));});}catch(b){Ext.Msg.alert("Translation service error","Check google translation API is loaded: "+b);}}function updateChildren(g,a,f){var d="&id="+document.mainForm.id.value+"&parentUuid="+Ext.getDom("parentUuid").value+"&schema="+Ext.getDom("schema").value+"&childrenIds="+Ext.getDom("childrenIds").value;var b=Ext.get(g).select('input[type="checkbox"]');b.each(function(h){var j=Ext.getDom(h);if(j.checked){d+="&"+j.name+"=true";}});var e=Ext.get(g).select('input[type="radio"]');e.each(function(h){var j=Ext.getDom(h);if(h.checked){d+="&"+j.name+"="+j.value;}});Ext.Ajax.request({url:catalogue.services.rootUrl+a,method:"GET",params:d,success:function(h,m){var l=h.responseXML;if(l.childNodes.length!==0&&l.childNodes[0].localName=="response"){var j=l.childNodes[0].childNodes[0].nodeValue;Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),j);Ext.get(g).hide();}else{Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),f);}},failure:function(h,j){Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),f);}});}Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.HelpPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,iconCls:"book",title:undefined,collapsible:true,collapsed:false},editor:undefined,tipTpl:undefined,cache:{},loadHelp:function(f,e,d,a){if(!this.cache[f]){var b=this;GeoNetwork.util.HelpTools.get(f,this.editor.metadataSchema,this.editor.catalogue.services.schemaInfo,function(g){b.cache[f]=b.tipTpl.apply(g.records[0].data);b.update(b.cache[f]);});}},updateHelp:function(g,e){if(this.collapsed){return;}var b=g;var f="";var d;var a=this;if(e){d=e.first().getAttribute("id");}if(this.cache[g]&&this.cache[d]){this.update(this.cache[g]+this.cache[d]);}else{if(d){this.loadHelp(d,null,false,a.loadHelp(g,d,true));}else{this.loadHelp(g,null,true);}}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.tipTpl=new Ext.XTemplate(GeoNetwork.util.HelpTools.Templates.COMPLETE);this.title=OpenLayers.i18n("help");GeoNetwork.editor.HelpPanel.superclass.initComponent.call(this);panel=this;}});Ext.reg("gn_editor_helppanel",GeoNetwork.editor.HelpPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.keyword={};GeoNetwork.editor.KeywordSelectionPanel=Ext.extend(Ext.FormPanel,{catalogue:undefined,Keyword:Ext.data.Record.create([{name:"value"},{name:"thesaurus"},{name:"uri"}]),keywordStore:undefined,border:false,addAsXLink:false,itemSelector:null,loadingMask:null,ThesaurusCount:null,ref:null,name:"gmd:descriptiveKeywords",keywordsSelected:[],initComponent:function(){this.keywordStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pThesauri:"",pMode:"searchBox"},reader:new Ext.data.XmlReader({record:"keyword",id:"uri"},this.Keyword),fields:["value","thesaurus","uri"],sortInfo:{field:"thesaurus"}});this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getThesaurusCombo()," ",this.getKeyword(),"->",OpenLayers.i18n("maxResults")+" "+OpenLayers.i18n("perThesaurus"),this.getLimitInput()],items:[this.getKeywordsItemSelector()]}];this.keywordStore.on({loadexception:function(){},beforeload:function(a,b){if(Ext.getCmp("maxResults")){a.baseParams.maxResults=Ext.getCmp("maxResults").getValue();}if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();},load:function(){this.loadingMask.hide();},scope:this});this.addEvents("keywordselected");this.bbar=["->",{id:"addAsXLinkCheckBox",xtype:"checkbox",checked:false,boxLabel:OpenLayers.i18n("addAsXLink"),listeners:{check:function(b,a){this.addAsXLink=a;},scope:this}},{id:"keywordSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildKeywordXmlList();},scope:this}];GeoNetwork.editor.KeywordSelectionPanel.superclass.initComponent.call(this);},getKeyword:function(){return new GeoNetwork.form.SearchField({id:"keywordSearchField",width:240,store:this.keywordStore,paramName:"pKeyword"});},setRef:function(a){this.ref=a;},setAddAsXLink:function(a){this.addAsXLink=a||false;Ext.getCmp("addAsXLinkCheckBox").setValue(this.addAsXLink);},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:50,width:40};},getThesaurusCombo:function(){GeoNetwork.editor.keyword.thesaurusStore=new GeoNetwork.data.ThesaurusStore({url:this.catalogue.services.getThesaurus,allOption:true,activatedOnly:true});return{xtype:"combo",width:150,id:"search-thesauri",value:0,store:GeoNetwork.editor.keyword.thesaurusStore,triggerAction:"all",mode:"local",displayField:"filename",valueField:"id",listWidth:250,listeners:{select:function(e,a,b){this.keywordStore.removeAll();this.keywordStore.baseParams.pThesauri=e.getValue();var d=Ext.getCmp("keywordSearchField").getValue();if(d.length<1){this.keywordStore.baseParams.pKeyword="*";}else{this.keywordStore.baseParams.pKeyword=d;}this.keywordStore.reload();},clear:function(a){this.keywordStore.load();},scope:this}};},getKeywordsItemSelector:function(){var a='<tpl for="."><div class="ux-mselect-item';if(Ext.isIE||Ext.isIE7){a+='" unselectable=on';}else{a+=' x-unselectable"';}a+='>{id} {value} <span class="ux-mselect-item-thesaurus">({thesaurus})</span></div></tpl>';this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["value","thesaurus"],toData:[],msWidth:320,msHeight:230,valueField:"value",toSortField:undefined,fromTpl:a,toTpl:a,toLegend:OpenLayers.i18n("selectedKeywords"),fromLegend:OpenLayers.i18n("foundKeywords"),fromStore:this.keywordStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var b=this.getForm().findField("itemselector");b.reset.call(b);},scope:this}]});this.itemSelector.on({change:function(b){Ext.getCmp("keywordSearchValidateButton").setDisabled(b.toStore.getCount()<1);}});return this.itemSelector;},buildKeywordXmlList:function(){this.keywordsSelected=[];var d=this;this.ThesaurusCount=0;var a=[];var b=this.itemSelector.toMultiselect.store;a=b.collect("thesaurus");Ext.each(a,function(l,j,m){b.filter("thesaurus",l);var g=b.collect("uri");Ext.each(g,function(r,q){g[q]=r.replace("#","%23");});var o=d.catalogue.services.getKeyword;var f=g.length>1?true:false;var e=o+"?thesaurus="+l+"&id="+g.join(",")+"&multiple="+f;++d.ThesaurusCount;if(d.addAsXLink){var h="<gmd:descriptiveKeywords xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:gmd='http://www.isotc211.org/2005/gmd'  xmlns:gco='http://www.isotc211.org/2005/gco' xlink:href='"+e+"'/>";d.keywordsSelected.push(h);}else{d.retrieveKeywordData(e);}});if(this.addAsXLink){this.fireEvent("keywordselected",this,this.keywordsSelected);
this.ownerCt.hide();}b.clearFilter();},retrieveKeywordData:function(a){Ext.getCmp("keywordSearchValidateButton").disable();Ext.Ajax.request({url:a,method:"GET",scope:this,success:function(d){var b=d.responseText;if(b.indexOf("<gmd:MD_Keywords")!==-1){this.keywordsSelected.push("<gmd:descriptiveKeywords xmlns:gmd='http://www.isotc211.org/2005/gmd'>"+d.responseText+"</gmd:descriptiveKeywords>");}Ext.getCmp("keywordSearchValidateButton").enable();this.ThesaurusCount-=1;if(this.ThesaurusCount===0){this.fireEvent("keywordselected",this,this.keywordsSelected);this.ownerCt.hide();}}});}});Ext.reg("gn_editor_keywordselectionpanel",GeoNetwork.editor.KeywordSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.LinkedMetadataPanel=Ext.extend(Ext.Panel,{title:undefined,editor:undefined,metadataId:undefined,selectedUuid:undefined,selectedType:undefined,metadataSchema:undefined,serviceUrl:undefined,store:undefined,parentAction:undefined,datasetAction:undefined,serviceAction:undefined,featureCatAction:undefined,delFeatureCatAction:undefined,updateChildrenAction:undefined,colModel:undefined,expander:undefined,defaultConfig:{border:false,frame:false,iconCls:"linkIcon",collapsible:true,collapsed:false},createColumnDef:function(){this.expander=new Ext.grid.RowExpander({tpl:new Ext.XTemplate('<div title=""><a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');">{title}</a></div>{msg}')});return[this.expander,{id:"type",header:OpenLayers.i18n("type"),width:60,sortable:true,hidden:true,dataIndex:"type"},{header:OpenLayers.i18n("title"),hidden:false,dataIndex:"title"}];},createColumnModel:function(){this.colModel=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:this.createColumnDef()});return this.colModel;},updatePanel:function(){this.reload();},clear:function(){this.store.removeAll();},reload:function(f,g,d){this.metadataId=g||this.metadataId;this.metadataSchema=d||this.metadataSchema;if(this.collapsed){return;}this.colModel.setConfig(this.createColumnDef());var a=this.metadataSchema.indexOf("iso19139")!==-1;var b=this.metadataSchema==="iso19110";this.parentAction.setDisabled(!a);this.serviceAction.setDisabled(!a);this.datasetAction.setDisabled(!a);this.featureCatAction.setDisabled(b);this.store.reload({params:{id:this.metadataId,fast:"false"}});},updateStatus:function(b,a,d){var e=b.find("type","children");this.updateChildrenAction.setDisabled(e===-1);var f=b.find("type","related");this.delFeatureCatAction.setDisabled(f===-1);},selectionChangeEvent:function(d,a,f){var b=d.getStore().getAt(a);this.selectedUuid=b.get("uuid");this.selectedType=b.get("type");this.delFeatureCatAction.setDisabled(this.selectedType!=="related");},getChildrenIds:function(){var a=[];this.store.each(function(b){if(b.get("type")==="children"){this.push(b.get("id"));}},a);return a;},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("relatedResources");this.tools=[{id:"refresh",handler:function(h,g,f,d){f.reload(f,f.metadataId);}}];this.parentAction=new Ext.Action({text:OpenLayers.i18n("parentMd"),handler:function(){this.switchToTab("metadata");},scope:this.editor});this.datasetAction=new Ext.Action({text:OpenLayers.i18n("datasetMd"),iconCls:"cat-dataset",handler:function(){this.showLinkedServiceMetadataSelectionPanel("coupledResource","","");},scope:this.editor});this.serviceAction=new Ext.Action({text:OpenLayers.i18n("serviceMd"),iconCls:"cat-service",handler:function(){this.showLinkedServiceMetadataSelectionPanel("attachService","","");},scope:this.editor});this.featureCatAction=new Ext.Action({text:OpenLayers.i18n("featureCat"),iconCls:"cat-featureCatalogue",handler:function(){this.showLinkedMetadataSelectionPanel(null,"iso19110");},scope:this.editor});this.delFeatureCatAction=new Ext.Action({text:OpenLayers.i18n("delete19110Relation"),handler:function(){this.editor.catalogue.doAction(this.editor.catalogue.services.mdRelationDelete,{childUuid:this.selectedUuid,parentId:this.metadataId},null,null,this.reload.bind(this),null);var d=this.editor.catalogue.services.mdProcessing+"?uuidref="+this.selectedUuid+"&id="+this.metadataId+"&process=update-detachFeatureCatalogue";this.editor.process(d);},scope:this,disabled:true});this.updateChildrenAction=new Ext.Action({text:OpenLayers.i18n("updateChildren"),handler:function(){this.editor.catalogue.modalAction(OpenLayers.i18n("updateChildren"),this.editor.catalogue.services.mdMassiveChildrenForm+"?parentUuid="+document.mainForm.uuid.value+"&schema="+document.mainForm.schema.value+"&childrenIds="+this.getChildrenIds().join(","));},scope:this,disabled:true});this.bbar=new Ext.Toolbar({items:[{text:OpenLayers.i18n("createLink"),iconCls:"relatedAddIcon",menu:new Ext.menu.Menu({items:[this.parentAction,this.datasetAction,this.serviceAction,this.featureCatAction]})},{text:OpenLayers.i18n("otherActions"),menu:new Ext.menu.Menu({items:[this.updateChildrenAction,this.delFeatureCatAction]})}]});GeoNetwork.editor.LinkedMetadataPanel.superclass.initComponent.call(this);this.store=new GeoNetwork.data.MetadataRelationStore(this.serviceUrl,{fast:false,id:this.metadataId},true);var a=this;var b=new Ext.grid.GridPanel({store:this.store,colModel:this.createColumnModel(),loadMask:true,plugins:this.expander,view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+OpenLayers.i18n("records")+'" : "'+OpenLayers.i18n("record")+'"]})'}),frame:false,height:150,autoWidth:true,listeners:{rowclick:this.selectionChangeEvent,scope:a}});this.add(b);if(this.metadataId){this.reload();}this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);this.store.on("load",this.updateStatus,this);}});Ext.reg("gn_editor_linkedmetadatapanel",GeoNetwork.editor.LinkedMetadataPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.Filter={SERVICE:[{name:"E_type",value:"service"}],DATASET:[{name:"E_type",value:"dataset"}],FEATURE_CATALOGUE:[{name:"E__schema",value:"iso19110"}]};GeoNetwork.editor.linkedMetadata={};GeoNetwork.editor.LinkedMetadataSelectionPanel=Ext.extend(Ext.FormPanel,{catalogue:undefined,border:false,layout:"fit",createIfNotExistURL:null,hiddenParameters:undefined,singleSelect:true,loadingMask:null,mdStore:null,ref:null,proxy:null,mode:null,serviceUrl:null,capabilitiesStore:null,linkedMetadataStore:undefined,initComponent:function(){this.addEvents("linkedmetadataselected");this.mdStore=GeoNetwork.data.MetadataResultsStore();this.linkedMetadataStore=GeoNetwork.data.MetadataCSWResultsStore();if(this.mode==="attachService"||this.mode==="coupledResource"){this.capabilitiesStore=new GeoExt.data.WMSCapabilitiesStore({url:this.serviceUrl,id:"capabilitiesStore",listeners:{exception:function(j,l,m,g,h,f){Ext.MessageBox.alert(OpenLayers.i18n("error"));},beforeload:function(){if(this.mode==="attachService"){var f=Ext.getCmp("linkedMetadataGrid").getSelectionModel().getSelections();if(f===undefined||f[0].data.uri===""){Ext.MessageBox.alert(OpenLayers.i18n("noServiceURLError"));}this.capabilitiesStore.baseParams.url=f[0].data.uri+"?&SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.1";}else{if(this.mode==="coupledResource"){this.capabilitiesStore.baseParams.url=this.serviceUrl;}}},loadexception:function(){Ext.MessageBox.alert(OpenLayers.i18n("GetCapabilitiesDocumentError")+this.capabilitiesStore.baseParams.url);},scope:this}});}if(this.mode==="attachService"){this.hiddenParameters=GeoNetwork.editor.Filter.SERVICE;}else{if(this.mode==="iso19110"){this.hiddenParameters=GeoNetwork.editor.Filter.FEATURE_CATALOGUE;}}var d=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:"",listeners:{selectionchange:function(){Ext.getCmp("linkedMetadataValidateButton").setDisabled(this.getSelections().length<1);}}});var e=[this.getSearchInput(),"->",OpenLayers.i18n("maxResults"),this.getLimitInput()];this.addHiddenFormInput(e);var b=new Ext.grid.GridPanel({id:"linkedMetadataGrid",xtype:"grid",layout:"fit",height:280,bodyStyle:"padding: 0px;",border:true,loadMask:true,tbar:e,store:this.linkedMetadataStore,columns:[d,{id:"title",header:OpenLayers.i18n("mdTitle"),dataIndex:"title"},{id:"subject",header:OpenLayers.i18n("keywords"),dataIndex:"subject",hidden:true},{id:"uri",header:OpenLayers.i18n("uri"),dataIndex:"getCapabilitiesUrl"}],sm:d,autoExpandColumn:"title",listeners:{rowclick:function(f,h,g){if(this.capabilitiesStore!==null&&this.mode!=="coupledResource"){this.serviceUrl=f.getStore().getAt(h).data.uri;
if(this.serviceUrl===""){this.capabilitiesStore.removeAll();}else{this.capabilitiesStore.baseParams.url=this.serviceUrl;this.capabilitiesStore.reload();}}},scope:this}});if(this.mode==="attachService"||this.mode==="coupledResource"){this.items=this.getScopedNamePanel(b);}else{this.items=b;}var a=this;this.bbar=["->",{id:"linkedMetadataValidateButton",iconCls:"relatedAddIcon",text:OpenLayers.i18n("createRelation"),disabled:true,handler:function(){var f=b.getSelectionModel().getSelections();this.fireEvent("linkedmetadataselected",this,f);this.ownerCt.close();},scope:a}];this.linkedMetadataStore.on({load:function(){if(this.loadingMask!==null){this.loadingMask.hide();}},scope:this});GeoNetwork.editor.LinkedMetadataSelectionPanel.superclass.initComponent.call(this);},getCreateIfNotExistButton:function(){if(!this.createIfNotExistURL){return"";}return{id:"createIfNotExistButton",iconCls:"addIcon",text:OpenLayers.i18n("createIfNotExistButton"),handler:function(){window.location.replace(this.createIfNotExistURL);},scope:this};},setRef:function(a){this.ref=a;},addHiddenFormInput:function(a){var b;if(this.hiddenParameters){for(b=0;b<this.hiddenParameters.length;b++){a.push({xtype:"textfield",fieldLabel:this.hiddenParameters[b].name,name:this.hiddenParameters[b].name,value:this.hiddenParameters[b].value,hidden:true});}}return a;},getSearchInput:function(){return new GeoNetwork.form.SearchField({name:"E.8_AnyText",width:240,store:this.linkedMetadataStore,triggerAction:function(a){a.doSearch();},scope:this});},getLimitInput:function(){return{xtype:"textfield",name:"nbResultPerPage",id:"nbResultPerPage",value:20,width:40};},getScopedNamePanel:function(d){var e={xtype:"combo",id:"getCapabilitiesLayerNameCombo",fieldLabel:OpenLayers.i18n("getCapabilitiesLayer"),store:this.capabilitiesStore,valueField:"name",displayField:"title",triggerAction:"all",listeners:{select:function(h,f,g){Ext.getCmp("getCapabilitiesLayerName").setValue(h.getValue());}}};var b={xtype:"textfield",id:"getCapabilitiesLayerName",fieldLabel:OpenLayers.i18n("layerName"),valueField:"name",displayField:"title"};var a={xtype:"panel",layout:"form",bodyStyle:"padding: 2px;",border:true,items:[d,e,b]};return a;},doSearch:function(){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();GeoNetwork.editor.nbResultPerPage=20;if(Ext.getCmp("nbResultPerPage")){GeoNetwork.editor.nbResultPerPage=Ext.getCmp("nbResultPerPage").getValue();}GeoNetwork.util.CSWSearchTools.doCSWQueryFromForm(this.id,this.catalogue,1,this.showResults.bind(this),null,Ext.emptyFn);},showResults:function(b){var e=new OpenLayers.Format.CSWGetRecords.v2_0_2();var d=e.read(b.responseText);var a=d.records;if(a.length>0){this.linkedMetadataStore.loadData(d);}}});Ext.reg("gn_editor_linkedmetadataselectionpanel",GeoNetwork.editor.LinkedMetadataSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.LogoSelectionPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoScroll:true,autoWidth:true,layout:"border"},store:undefined,view:undefined,uploadForm:undefined,serviceUrl:undefined,logoAddUrl:undefined,ref:undefined,setRef:function(a){this.ref=a;},getUploadForm:function(){this.uploadForm=new Ext.form.FormPanel({fileUpload:true,region:"south",height:80,split:true,items:{xtype:"fileuploadfield",allowBlank:false,emptyText:OpenLayers.i18n("logoSelect"),hideLabel:true,name:"fname",buttonCfg:{iconCls:"thumbnailAddIcon"}},buttons:[{text:OpenLayers.i18n("upload"),scope:this,iconCls:"thumbnailGoIcon",handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:this.logoAddUrl,scope:this,success:function(a,b){this.store.reload();},failure:function(a){Ext.Msg.alert(OpenLayers.i18n("failure"),a.responseText);}});}}}]});return this.uploadForm;},initComponent:function(){Ext.applyIf(this,this.defaultConfig);var a=new Ext.XTemplate('<tpl for="."><div class="logo-wrap"><div id="{name}" class="logo">','<img src="'+this.logoUrl+'{name}" title="{name}"/><span>{name}</span></div></div>',"</tpl>");var b=Ext.data.Record.create([{name:"name",mapping:""}]);this.store=new Ext.data.Store({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:this.serviceUrl,disableCaching:false}),reader:new Ext.data.XmlReader({record:"icon",id:"icon"},b),fields:["name"]});this.view=new Ext.DataView({store:this.store,tpl:a,singleSelect:true,selectedClass:"logo-selected",overClass:"logo-over",itemSelector:"div.logo-wrap",autoScroll:true,listeners:{selectionchange:function(e,f){var d=this.view.getSelectedIndexes();if(f){this.fireEvent("logoselected",this,d);this.ownerCt.hide();}},scope:this}});this.items=[new Ext.Panel({region:"center",split:true,border:true,autoScroll:true,items:[this.view]}),this.getUploadForm()];GeoNetwork.editor.LogoSelectionPanel.superclass.initComponent.call(this);this.addEvents("logoselected");this.store.load();}});Ext.reg("gn_editor_logoselectionpanel",GeoNetwork.editor.LogoSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.NewMetadataPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,isTemplate:"n"},editor:undefined,getGroupUrl:undefined,groupStore:undefined,catalogue:undefined,tplStore:undefined,selectedGroup:undefined,selectedTpl:undefined,isChild:undefined,filter:undefined,createBt:undefined,validate:function(){if(this.selectedGroup!==undefined&&this.selectedTpl!==undefined){this.createBt.setDisabled(false);}else{this.createBt.setDisabled(true);}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);var b,a;this.createBt=new Ext.Button({text:OpenLayers.i18n("create"),iconCls:"addIcon",disabled:true,handler:function(){this.catalogue.metadataEdit(this.selectedTpl,true,this.selectedGroup,this.isChild,this.isTemplate);this.ownerCt.hide();},scope:this});this.buttons=[this.createBt,{text:OpenLayers.i18n("cancel"),iconCls:"cancel",handler:function(){this.ownerCt.hide();},scope:this}];GeoNetwork.editor.NewMetadataPanel.superclass.initComponent.call(this);this.groupStore=GeoNetwork.data.GroupStore(this.getGroupUrl);this.groupStore.load();if(!this.selectedTpl){this.tplStore=GeoNetwork.Settings.mdStore?GeoNetwork.Settings.mdStore():GeoNetwork.data.MetadataResultsStore();this.tplStore.setDefaultSort("displayOrder");b=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:""});a=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[b,{header:"Schema",dataIndex:"schema"},{id:"title",header:"Title",dataIndex:"title"},{header:"Order",hidden:true,dataIndex:"displayOrder"}]});this.add(new Ext.grid.GridPanel({layout:"fit",title:OpenLayers.i18n("chooseTemplate"),border:false,autoScroll:true,height:330,store:this.tplStore,colModel:a,sm:b,autoExpandColumn:"title",listeners:{rowclick:function(d,h,g){var f=d.getStore().getAt(h).data;if(d.getSelectionModel().getCount()!==0){this.selectedTpl=f.id;}else{this.selectedTpl=undefined;}this.validate();},scope:this}}));this.catalogue.search({E_template:"y"},null,null,1,true,this.tplStore,null);}this.add(new Ext.form.ComboBox({name:"E_group",mode:"local",emptyText:OpenLayers.i18n("chooseGroup"),triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:this.groupStore,allowBlank:false,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>",listeners:{select:function(f,e,d){this.selectedGroup=e.get("id");this.validate();},scope:this}}));this.add({xtype:"textfield",name:"isTemplate",hidden:true,value:this.isTemplate});}});Ext.reg("gn_editor_newmetadatapanel",GeoNetwork.editor.NewMetadataPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.GeoPublisherPanel=Ext.extend(Ext.form.FormPanel,{border:false,serviceUrl:undefined,itemSelector:null,geoserverStore:undefined,loadingMask:null,metadataId:null,metadataUuid:null,metadataTitle:null,fileName:null,layerName:null,accessStatus:null,nodeId:null,geoPublicationMap:null,geoPublicationMapPanel:null,geoPublicationTb:null,layers:null,extent:null,stylerBt:null,publishBt:null,unpublishBt:null,checkBt:null,protocols:{wms:{checked:true,label:"OGC:WMS"},wfs:{checked:false,label:"OGC:WFS"},wcs:{checked:false,label:"OGC:WCS"}},addOnLineSourceBt:null,addOnLineSourceMenu:null,enableStyler:false,statusBar:null,layerPreviewName:"DatasetPreview",initComponent:function(){var d=this;
var b=Ext.data.Record.create([{name:"id"},{name:"name"},{name:"adminUrl"},{name:"wmsUrl"},{name:"wfsUrl"},{name:"wcsUrl"},{name:"stylerUrl"},{name:"namespacePrefix"}]);this.geoserverStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:d.serviceUrl+"?action=LIST",method:"GET"}),baseParams:{action:"LIST"},reader:new Ext.data.XmlReader({record:"node",id:"id"},b),sortInfo:{field:"name"}});this.publishBt=new Ext.Button({text:OpenLayers.i18n("publish"),tooltip:OpenLayers.i18n("publishTooltip"),iconCls:"addVector",handler:function(){this.statusBar.setText("");this.loadingMask.show();Ext.Ajax.request({url:d.serviceUrl,params:{metadataId:this.metadataId,metadataUuid:this.metadataUuid,metadataTitle:this.metadataTitle,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"CREATE"},method:"GET",success:function(g,j){if(g.responseText.indexOf("OutOfMemoryError")!==-1){this.statusBar.setText(OpenLayers.i18n("publishError")+OpenLayers.i18n("outOfMemoryError"));this.loadingMask.hide();return;}var h=g.responseXML.getElementsByTagName("Exception").item(0);if(h!==null){this.statusBar.setText(OpenLayers.i18n("publishError")+OpenLayers.i18n("publishErrorCode")+h.getAttribute("status"));this.loadingMask.hide();return;}this.statusBar.setText(OpenLayers.i18n("publishSuccess"));this.updatePrivileges(1);this.addLayer(this.layerPreviewName,this.layerName);this.statusBar.setText(this.statusBar.text+OpenLayers.i18n("publishLayerAdded"));this.loadingMask.hide();},failure:function(g,h){this.statusBar.setText(OpenLayers.i18n("publishError"));this.loadingMask.hide();},scope:this});},scope:this});this.unpublishBt=new Ext.Button({text:OpenLayers.i18n("unpublish"),tooltip:OpenLayers.i18n("unpublishTooltip"),iconCls:"delVector",handler:function(){this.statusBar.setText("");this.cleanLayerPreview();Ext.Ajax.request({url:d.serviceUrl,params:{metadataId:this.metadataId,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"DELETE"},method:"GET",success:function(g,h){this.statusBar.setText(OpenLayers.i18n("unpublishSuccess"));this.updatePrivileges(0);},failure:function(g,h){this.statusBar.setText(OpenLayers.i18n("unpublishError"));},scope:this});},scope:this});this.checkBt=new Ext.Button({text:OpenLayers.i18n("check"),iconCls:"connect",listeners:{click:function(){this.statusBar.setText("");Ext.Ajax.request({url:d.serviceUrl,params:{metadataId:this.metadataId,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"GET"},method:"GET",success:function(g,l){var j=g.responseXML.getElementsByTagName("Exception").item(0);if(j!==null){var h=j.getAttribute("status");this.statusBar.setText(OpenLayers.i18n("errorDatasetNotFound")+h);if(h.indexOf("No vector layer")!==-1||h.indexOf("404")!==-1){this.updatePrivileges(0);}else{this.updatePrivileges();}return;}this.statusBar.setText(OpenLayers.i18n("datasetFound"));this.updatePrivileges(1);this.addLayer(this.layerPreviewName,this.layerName);},failure:function(g,h){this.statusBar.setText(OpenLayers.i18n("checkFailure"));this.updatePrivileges();},scope:this});},scope:this}});this.addOnLineSourceBt={text:OpenLayers.i18n("addOnlineSource"),tooltip:"",iconCls:"processMetadata",handler:function(){var g=this.geoserverStore.getById(this.nodeId);this.fireEvent("addOnLineSource",this,g,this.protocols);},scope:this};var e=[];for(p in this.protocols){if(this.protocols.hasOwnProperty(p)){var f=this.protocols[p];e.push({text:f.label,canActivate:false,hideOnClick:false,checked:f.checked,checkHandler:this.protocolChecked,scope:f});}}e.push("-",this.addOnLineSourceBt);this.addOnLineSourceMenu=new Ext.Button({iconCls:"processMetadata",text:OpenLayers.i18n("addOnlineSourceTitle"),tooltip:OpenLayers.i18n("addOnlineSourceTT"),menu:new Ext.menu.Menu({items:e})});this.stylerBt=new Ext.Button({text:OpenLayers.i18n("Style"),iconCls:"styler",id:"stylerBt",tooltip:"",handler:function(){var h=this.geoserverStore.getById(this.nodeId);var g=h.get("stylerUrl")+"?namespace="+h.get("namespacePrefix")+"&layer="+h.get("namespacePrefix")+":"+this.layerName;window.open(g,"","toolbar=no,menubar=no,width=600,height=500");},scope:this});this.geoPublicationTb=new Ext.Toolbar({items:[this.getGeoserverCombo(),this.checkBt,this.publishBt,this.unpublishBt,this.addOnLineSourceMenu,this.stylerBt]});this.statusBar=new Ext.form.Label({id:"statusBar",html:OpenLayers.i18n("statusInformation")});var a=new Ext.Toolbar({items:[this.statusBar]});this.geoserverStore.load({add:false});this.tbar=this.geoPublicationTb;this.bbar=a;this.items=this.getGeoPublicationMapPanel();this.addEvents("addOnLineSource");GeoNetwork.editor.GeoPublisherPanel.superclass.initComponent.call(this);this.on("resize",function(l,g,j){l.geoPublicationMapPanel.setSize(g,j);});if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(Ext.getBody(),{msg:OpenLayers.i18n("publishing")});}},getGeoPublicationMapPanel:function(){var a={projection:GeoNetwork.map.PROJECTION,theme:null,maxExtent:GeoNetwork.map.EXTENT};var d=new OpenLayers.Map(a),b;this.geoPublicationMapPanel=new GeoExt.MapPanel({id:"mapPanel",layers:GeoNetwork.map.BACKGROUND_LAYERS||[],map:d,width:this.width,height:this.height});return this.geoPublicationMapPanel;},addLayer:function(f,a){var e=Ext.getCmp("mapPanel").map;var d=new OpenLayers.Bounds.fromArray(this.extent);if(GeoNetwork.map.PROJECTION!=="EPSG:4326"){d.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection(GeoNetwork.map.PROJECTION));}e.zoomToExtent(d||GeoNetwork.map.EXTENT);this.cleanLayerPreview();var b=new OpenLayers.Layer.WMS(f,this.geoserverStore.getById(this.nodeId).get("wmsUrl"),{transparent:"true",layers:a},{singleTile:true});e.addLayer(b);},cleanLayerPreview:function(){var b=Ext.getCmp("mapPanel").map;var a=b.getLayersByName(this.layerPreviewName);if(a.length>0){a[0].destroy();}},getGeoserverCombo:function(){return{xtype:"combo",tpl:'<tpl for="."><div ext:qtip="{name}. {adminUrl}" class="x-combo-list-item">{name}</div></tpl>',store:this.geoserverStore,displayField:"name",autoSelect:true,forceSelection:true,mode:"local",triggerAction:"all",emptyText:OpenLayers.i18n("selectANode"),id:"geoserverNode",listeners:{select:function(d,a,b){this.nodeId=a.get("id");this.cleanLayerPreview();this.enableStyler=(a.get("stylerUrl")===""?false:true);this.checkBt.fireEvent("click");},scope:this}};},setRef:function(h,a,d,g,b){this.metadataId=h;this.metadataUuid=a;this.metadataTitle=d;this.fileName=g;this.accessStatus=b;if(this.fileName.indexOf("jdbc")!==-1){this.layerName=this.fileName.substr(this.fileName.indexOf("#")+1,this.fileName.length);}else{if(this.accessStatus==="fileOrUrl"){var f=this.fileName.lastIndexOf("/")+1;var e=this.fileName.lastIndexOf(".");this.layerName=this.fileName.substr(f,e-f);}else{this.layerName=this.fileName.substr(0,this.fileName.indexOf("."));}}this.cleanLayerPreview();this.updatePrivileges();if(this.nodeId!==null){this.checkBt.fireEvent("click");}},protocolChecked:function(b,a){this.checked=a;},updatePrivileges:function(a){if(this.nodeId===null){this.checkBt.disable();}else{this.checkBt.enable();}this.publishBt.disable();this.unpublishBt.disable();this.addOnLineSourceMenu.disable();this.stylerBt.disable();switch(a){case 0:this.publishBt.enable();break;case 1:this.publishBt.enable();this.unpublishBt.enable();this.addOnLineSourceMenu.enable();if(this.fileName.indexOf("tif")!==-1||!this.enableStyler){this.stylerBt.disable();}else{this.stylerBt.enable();}break;}}});Ext.reg("gn_editor_geopublisherpanel",GeoNetwork.editor.GeoPublisherPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.SuggestionsPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,iconCls:"suggestionIcon",title:undefined,collapsible:true,collapsed:true},metadataId:undefined,processName:undefined,processParams:undefined,processParametersWindow:undefined,catalogue:undefined,editor:undefined,store:undefined,clear:function(){this.store.removeAll();},reload:function(a,b){this.metadataId=b||this.metadataId;if(this.collapsed){return;}this.store.reload({params:{id:this.metadataId}});
},runSuggestedProcess:function(){if(this.processName){if(this.processParams){this.generateForm();}else{var a=this.catalogue.services.mdProcessing+"?id="+this.metadataId+"&process="+this.processName;this.run(a);}}},run:function(a){this.editor.process(a);if(this.processParametersWindow){this.processParametersWindow.hide();this.processParametersWindow.destroy();this.processParametersWindow=undefined;}},selectionChangeEvent:function(b,d){var a=b.getRecords(d);if(a[0]){this.getBottomToolbar().setDisabled(false);this.processName=a[0].get("name");this.processParams=a[0].get("params");}else{this.getBottomToolbar().setDisabled(true);this.processName=undefined;this.processParams=undefined;}},generateForm:function(){this.processParametersWindow=undefined;if(!this.processParametersWindow){var e=new Ext.form.FormPanel({defaultType:"textfield",items:[{name:"id",allowBlank:false,hidden:true,value:this.metadataId},{name:"process",allowBlank:false,hidden:true,value:this.processName}],buttons:[{text:OpenLayers.i18n("process"),iconCls:"suggestionRunIcon",handler:function(){if(e.getForm().isValid()){var h=this.catalogue.services.mdProcessing+"?"+e.getForm().getValues(true);this.run(h);}},scope:this},{text:OpenLayers.i18n("reset"),iconCls:"cancel",handler:function(){e.getForm().reset();}}]});var b=Ext.util.JSON.decode(this.processParams),g,a="",d=false,f;for(f in b){if(b.hasOwnProperty(f)){if(b[f].type==="boolean"){g="checkbox";}else{g="textfield";}if(f==="gurl"&&this.catalogue.URL){a=this.catalogue.URL;d=true;}else{if(f==="lang"&&this.catalogue.LANG){a=this.catalogue.LANG;d=true;}else{d=false;a=b[f].defaultValue;}}e.add({xtype:g,name:f,fieldLabel:OpenLayers.i18n(this.processName+f),hidden:d,value:a});}}this.processParametersWindow=new Ext.Window({title:OpenLayers.i18n("processParametersWindow"),width:300,height:300,layout:"fit",modal:true,items:e,closeAction:"destroy",constrain:true,iconCls:"suggestionIcon"});}this.processParametersWindow.show();},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("suggestions");this.tools=[{id:"refresh",handler:function(h,g,f,d){f.reload(f,f.metadataId);}}];this.bbar=new Ext.Toolbar({disabled:true,items:[{text:OpenLayers.i18n("applySelected"),iconCls:"suggestionRunIcon",handler:this.runSuggestedProcess,scope:this}]});var a=new Ext.XTemplate('<ul><tpl for=".">','<li class="suggestion" title="{name}">{desc}','<span class="suggestion-{operational}"></span></li>',"</tpl></ul>");this.store=new GeoNetwork.data.SuggestionStore(this.catalogue.services.mdSuggestion,{action:"analyze",id:this.metadataId},false);var b=new Ext.DataView({store:this.store,tpl:a,singleSelect:true,autoHeight:true,loadingText:"...",selectedClass:"suggestion-selected",overClass:"suggestion-over",itemSelector:"li.suggestion",emptyText:OpenLayers.i18n("noSuggestion"),listeners:{selectionchange:this.selectionChangeEvent,scope:this}});GeoNetwork.editor.SuggestionsPanel.superclass.initComponent.call(this);this.add(b);this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);}});Ext.reg("gn_editor_suggestionspanel",GeoNetwork.editor.SuggestionsPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.ThumbnailPanel=Ext.extend(Ext.Panel,{title:undefined,metadataId:undefined,versionId:undefined,setThumbnail:undefined,unsetThumbnail:undefined,getThumbnail:undefined,uploadForm:undefined,idField:undefined,versionField:undefined,thumbnail:undefined,editor:undefined,dataView:undefined,store:undefined,thumbnailUploadWindow:undefined,addButton:undefined,delButton:undefined,defaultConfig:{border:false,frame:false,iconCls:"thumbnailIcon",collapsible:true,collapsed:false,autoScroll:true},clear:function(){this.store.removeAll();},reload:function(d,f,b,a){this.metadataId=f||this.metadataId;this.versionId=a||this.metadataId;if(this.collapsed){return;}this.idField.setValue(this.metadataId);this.versionField.setValue(this.versionId);this.store.reload({params:{id:this.metadataId}});},uploadThumbnail:function(){if(!this.thumbnailUploadWindow){this.thumbnailUploadWindow=new Ext.Window({title:OpenLayers.i18n("thumbnailUploadWindow"),width:300,height:300,layout:"fit",modal:true,items:this.uploadForm,closeAction:"hide",constrain:true,iconCls:"thumbnailAddIcon"});}this.thumbnailUploadWindow.show();},removeThumbnail:function(){var a=this,b=this.unsetThumbnail+"?id="+this.metadataId+"&version="+this.versionId+"&type="+(this.thumbnail==="thumbnail"?"small":"large");OpenLayers.Request.GET({url:b,success:function(d){a.editor.init(a.metadataId);},failure:function(d){}});},selectionChangeEvent:function(b,d){var a=d?b.getRecords(d):[],e=this.dataView.getStore().query("desc",/thumbnail|large_thumbnail/).length==2;if(a[0]){this.thumbnail=a[0].get("desc");if(this.thumbnail==="thumbnail"||this.thumbnail==="large_thumbnail"){this.delButton.setDisabled(false);}else{this.delButton.setDisabled(true);}}else{this.delButton.setDisabled(true);this.thumbnail=undefined;}this.addButton.setDisabled(e);},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("thumbnails");this.tools=[{id:"refresh",handler:function(h,g,f,d){f.reload(f,f.metadataId);}}];var a=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="thumbnail">','<img class="thumb-small" src="{href}" title="{desc}"><br/>','<a rel="lightbox-set" class="md-mn lightBox" href="{href}"></a>',"<span>{desc}</span>","</li>","</tpl>","</ul>");this.addButton=new Ext.Button({text:OpenLayers.i18n("addThumbnail"),iconCls:"thumbnailAddIcon",handler:this.uploadThumbnail,scope:this});this.delButton=new Ext.Button({text:OpenLayers.i18n("removeSelected"),iconCls:"thumbnailDelIcon",disabled:true,handler:this.removeThumbnail,scope:this});this.bbar=new Ext.Toolbar({items:[this.addButton,this.delButton]});this.store=new GeoNetwork.data.MetadataThumbnailStore(this.getThumbnail,{id:this.metadataId});this.store.on("load",function(){this.dataView.fireEvent("selectionchange",this);Ext.ux.Lightbox.register("a[rel^=lightbox-set]",true);},this);this.idField=new Ext.form.TextField({xtype:"textfield",name:"id",value:this.metadataId,hidden:true});this.versionField=new Ext.form.TextField({name:"version",value:this.versionId,hidden:true});var b=new Ext.slider.Tip({getText:function(d){return String.format("<b>{0} px</b>",d.value);}});this.uploadForm=new Ext.form.FormPanel({fileUpload:true,items:[this.idField,this.versionField,{xtype:"textfield",name:"scalingDir",value:"width",hidden:true},{xtype:"textfield",name:"smallScalingDir",value:"width",hidden:true},{xtype:"fileuploadfield",emptyText:OpenLayers.i18n("selectImage"),fieldLabel:OpenLayers.i18n("image"),name:"fname",allowBlank:false,buttonText:"",buttonCfg:{iconCls:"thumbnailAddIcon"}},{xtype:"radio",checked:true,fieldLabel:"Type",boxLabel:OpenLayers.i18n("large"),name:"type",value:"large"},{xtype:"radio",fieldLabel:"",boxLabel:OpenLayers.i18n("small"),name:"type",value:"small"},{xtype:"sliderfield",fieldLabel:OpenLayers.i18n("scalingFactor"),name:"scalingFactor",value:1000,minValue:400,maxValue:1800,increment:200},{xtype:"checkbox",checked:true,hideLabel:true,fieldLabel:"",labelSeparator:"",boxLabel:OpenLayers.i18n("createSmall"),name:"createSmall",value:"true"},{xtype:"sliderfield",fieldLabel:OpenLayers.i18n("smallScalingFactor"),name:"smallScalingFactor",value:180,minValue:100,maxValue:220,increment:20}],buttons:[{text:OpenLayers.i18n("upload"),formBind:true,iconCls:"thumbnailGoIcon",scope:this,handler:function(){if(this.uploadForm.getForm().isValid()){var d=this;this.uploadForm.getForm().submit({url:this.setThumbnail,waitMsg:OpenLayers.i18n("uploading"),success:function(e,f){d.editor.init(d.metadataId);d.thumbnailUploadWindow.hide();}});}}},{text:OpenLayers.i18n("reset"),iconCls:"cancel",scope:this,handler:function(){this.uploadForm.getForm().reset();}}]});GeoNetwork.editor.ThumbnailPanel.superclass.initComponent.call(this);this.dataView=new Ext.DataView({autoHeight:true,autoWidth:true,store:this.store,tpl:a,singleSelect:true,selectedClass:"thumbnail-selected",overClass:"thumbnail-over",itemSelector:"li.thumbnail",emptyText:OpenLayers.i18n("noimages"),listeners:{selectionchange:this.selectionChangeEvent,scope:this}});
this.add(this.dataView);if(this.metadataId){this.reload(this,this.metadataId);}this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);}});Ext.reg("gn_editor_thumbnailpanel",GeoNetwork.editor.ThumbnailPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.ValidationPanel=Ext.extend(Ext.Panel,{title:undefined,editor:undefined,metadataId:undefined,serviceUrl:undefined,store:undefined,defaultConfig:{border:false,frame:false,collapsible:true,collapsed:true,iconCls:"validateMetadata"},validate:function(){this.editor.validate(function(){this.updateValidationReport();}.bind(this));},updateValidationReport:function(){if(this.collapsed){this.toggleCollapse();}this.reload(this);},clear:function(){this.store.removeAll();},reload:function(a,b){this.metadataId=b||this.metadataId;if(this.collapsed){return;}this.store.reload({params:{id:this.metadataId}});},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("validationReport");this.tools=[{id:"refresh",handler:function(j,h,g,f){g.reload(g,g.metadataId);}}];GeoNetwork.editor.ValidationPanel.superclass.initComponent.call(this);this.store=new GeoNetwork.data.ValidationRuleStore(this.serviceUrl,{id:this.metadataId},true);var d=Ext.grid;var e=new d.RowExpander({tpl:new Ext.XTemplate('<div title="{details}"><b>{title}</b></div>{msg}')});var a=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:[e,{id:"group",header:OpenLayers.i18n("group"),width:60,sortable:true,hidden:true,dataIndex:"group"},{header:OpenLayers.i18n("status"),width:10,resizable:false,sortable:true,dataIndex:"statusIcon"},{header:OpenLayers.i18n("title"),hidden:false,dataIndex:"title"}]});var b=new d.GridPanel({store:this.store,colModel:a,loadMask:true,plugins:e,view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+OpenLayers.i18n("items")+'" : "'+OpenLayers.i18n("item")+'"]})'}),frame:false,height:300,autoWidth:true});this.add(b);this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);}});Ext.reg("gn_editor_validationpanel",GeoNetwork.editor.ValidationPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.AdminTools={showImportMetadataWindow:function(d,e){var a=new GeoNetwork.admin.MetadataInsertPanel({metadataType:d});var b=new Ext.Window({title:e||OpenLayers.i18n("importMetadata"),width:450,height:450,layout:"fit",modal:true,items:a,closeAction:"destroy",constrain:true,iconCls:"addIcon"});b.show();}};Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.HarvesterPanel=Ext.extend(Ext.Panel,{border:false,frame:false,layout:"border",height:800,catalogue:undefined,harvesterStore:undefined,harvesterTplMarkup:["Information: {site_name}<br/>","Last run: {info_lastrun}<br/>",'<tpl if="info_result_total">',"Total: {info_result_total}<br/>","Added: {info_result_added}<br/>","Removed: {info_result_removed}<br/>","Schema unknwon: {info_result_unknowSchema}<br/>","</tpl>"],harvesterTpl:undefined,xmlTpl:undefined,harvesterGrid:undefined,currentHarvester:undefined,initComponent:function(){GeoNetwork.admin.HarvesterPanel.superclass.initComponent.call(this);panel=this;this.createGrid();this.harvesterTpl=new Ext.XTemplate(this.harvesterTplMarkup);this.xmlTpl=new GeoNetwork.Templates().getHarvesterTemplate();this.harvesterGrid.getSelectionModel().on("rowselect",function(g,f,e){var d=Ext.getCmp("harvesterDetailPanel");this.harvesterTpl.overwrite(d.body,e.data);},this);var b={id:"harvesterDetailPanel",region:"east",split:true,minWidth:200,width:200,collapsible:true,hideCollapseTool:true,collapseMode:"mini",bodyStyle:{background:"#ffffff",padding:"7px"},html:"Please select a harvester to see additional details."};this.add(b);var a={id:"harvesterEditorPanel",region:"south",title:"Harvester configuration",split:true,autoScroll:true,minHeigth:400,items:[new Ext.FormPanel({border:false,frame:false,maxHeight:600,id:"harvesterEditorForm",items:[this.getHarvesterTypeField(),this.getSiteFields("geonetwork"),this.getOptionsFields("geonetwork")],buttons:[{text:"Save",listeners:{click:function(){var e=Ext.getCmp("harvesterEditorForm").getForm();if(e.isValid()){e.updateRecord(this.currentHarvester);var d=this.xmlTpl.apply(this.currentHarvester.data);this.addHarvester(this.catalogue.services.harvestingAdd,d);}},scope:panel}}]})]};this.add(a);},harvesterType:[["geonetwork","GeoNetwork"],["geonetwork20","GeoNetwork 2.0"],["webdav","webdav"],["csw","csw"],["ogcwxs","OGC WxS"],["thredds","thredds"],["z3950","z3950"],["oaipmh","oaipmh"],["metadatafragments","metadatafragments"],["arcsde","arcsde"],["filesystem","filesystem"]],switchMode:function(a){this.switchElement("site_servlet",false);this.switchElement("site_port",false);this.switchElement("site_host",false);this.switchElement("site_url",false);if(a=="geonetwork"||a=="geonetwork20"){this.switchElement("site_servlet",true);this.switchElement("site_port",true);this.switchElement("site_host",true);}else{this.switchElement("site_url",true);}if(a=="ogcwxs"){}},switchElement:function(b,a){var h=Ext.getCmp(b);var d=Ext.getCmp("harvesterEditorForm");var g=d.getForm().findField(b);if(a){g.container.up("div.x-form-item").show();h.enable();}else{g.container.up("div.x-form-item").hide();h.disable();}d.doLayout(false,true);},getHarvesterTypeField:function(){return new Ext.form.ComboBox({id:"type",name:"type",mode:"local",triggerAction:"all",fieldLabel:"Harvester type",store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:this.harvesterType}),valueField:"id",displayField:"name",listeners:{change:function(d,b,a){this.switchMode(b);},scope:this}});},ogcwxsType:[["WMS1.0.0","WMS 1.0.0"],["WMS1.1.1","WMS 1.1.1"],["WFS1.0.0","WFS 1.0.0"],["WFS1.1.0","WFS 1.1.0"],["WCS1.0.0","WCS 1.0.0"],["WPS0.4.0","WPS 0.4.0"],["WPS1.0.0","WPS 1.0.0"]],getSiteFields:function(l){var j=[];var e=new Ext.form.TextField({id:"id",name:"id",mode:"local",hidden:true});var b=new Ext.form.TextField({name:"site_name",mode:"local",fieldLabel:"Name"});j.push(e,b);var d=new Ext.form.TextField({id:"site_url",name:"site_url",mode:"local",fieldLabel:"URL"});var o=new Ext.form.ComboBox({id:"site_ogctype",name:"site_ogctype",mode:"local",fieldLabel:"Type of service",store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:this.ogcwxsType}),valueField:"id",displayField:"name"});j.push(d,o);var m=new Ext.form.TextField({id:"site_servlet",name:"site_servlet",mode:"local",fieldLabel:"Servlet"});var q=new Ext.form.TextField({id:"site_host",name:"site_host",mode:"local",fieldLabel:"Host"});var f=new Ext.form.TextField({id:"site_port",name:"site_port",mode:"local",fieldLabel:"Port"});j.push(q,f,m);var g=new Ext.form.Checkbox({id:"site_account_use",name:"site_account_use",mode:"local",fieldLabel:"Use account"});var h=new Ext.form.TextField({id:"site_account_username",name:"site_account_username",mode:"local",fieldLabel:"Username"});var a=new Ext.form.TextField({id:"site_account_password",name:"site_account_password",mode:"local",fieldLabel:"Password"});j.push(g,h,a);return{xtype:"fieldset",title:"Harvester main information",collapsible:true,items:j};},getOptionsFields:function(){var b=[];var h=new Ext.form.Checkbox({id:"options_createthumbnails",name:"options_createthumbnails",mode:"local",fieldLabel:"Create thumbnail for WMS layers"});var g=new Ext.form.Checkbox({id:"options_uselayer",name:"options_uselayer",mode:"local",fieldLabel:"Create metadata for layer elements using GetCapabilities information"});var d=new Ext.form.Checkbox({id:"options_uselayermd",name:"options_uselayermd",mode:"local",fieldLabel:"Create metadata for layer elements using MetadataURL attributes (if existing, if not use GetCapabilities)"});var f=new Ext.form.TextField({id:"options_lang",name:"options_lang",mode:"local",defaultValue:"eng",fieldLabel:"Language"});var e=new Ext.form.TextField({id:"options_topic",name:"options_topic",mode:"local",defaultValue:"",fieldLabel:"Topic category"});
b.push(h,g,d,f,e);var a=new Ext.form.Checkbox({id:"options_onerunonly",name:"options_onerunonly",mode:"local",fieldLabel:"One run only"});var j=new Ext.form.TextField({id:"options_every",name:"options_every",mode:"local",defaultValue:"90",fieldLabel:"Every"});b.push(a,j);return{xtype:"fieldset",title:"Harvester options",collapsible:true,items:b};},getPrivilegesFields:function(){return;},getCategoriesFields:function(){return;},createEditor:function(){var a=Ext.data.Record.create([{name:"id",mapping:"node/@id"},{name:"occupation"}]);},createGrid:function(){var a=new Ext.grid.CheckboxSelectionModel({singleSelect:true,header:"",listeners:{selectionchange:function(){Ext.getCmp("harvestEditBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestRemoveBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestActivateBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestDesactivateBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestRunBt").setDisabled(this.getSelections().length<1);}}});this.harvesterGrid=new Ext.grid.GridPanel({store:this.harvesterStore,split:true,id:"harvesterGrid",region:"center",sm:a,columns:[a,{id:"id",header:"id",width:60,sortable:true,dataIndex:"id",hidden:true},{header:"Name",width:125,sortable:true,dataIndex:"site_name"},{header:"Type",width:75,sortable:true,dataIndex:"type"},{header:"Status",width:80,sortable:true,dataIndex:"site_status"},{header:"Running",width:80,sortable:true,dataIndex:"info_running"},{header:"Every",width:80,sortable:true,dataIndex:"options_every"},{header:"Last run",width:160,sortable:true,dataIndex:"info_lastrun"}],stripeRows:true,maxHeight:250,height:250,stateful:true,stateId:"grid",listeners:{rowclick:function(b,j,g){var d=this.harvesterGrid.getStore().getAt(j);this.currentHarvester=d;console.log(d);var f=Ext.getCmp("harvesterEditorForm").getForm();f.loadRecord(d);},scope:this},buttons:[{text:"Add",listeners:{click:function(){}}},{text:"Activate",id:"harvestActivateBt",disabled:true,listeners:{click:function(){var b=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();var d={id:b.data.id};this.doAction(this.catalogue.services.harvestingStart,d,this.refreshHarvester,null,null,"Failed to activate the harvester");},scope:this}},{text:"Desactivate",id:"harvestDesactivateBt",disabled:true,listeners:{click:function(){var b=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();var d={id:b.data.id};this.doAction(this.catalogue.services.harvestingStop,d,this.refreshHarvester,null,null,"Failed to desactivate the harvester");},scope:this}},{id:"harvestEditBt",text:"Edit",disabled:true,listeners:{click:function(){},scope:this}},{text:"Run",id:"harvestRunBt",disabled:true,listeners:{click:function(){var b=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();var d={id:b.data.id};this.doAction(this.catalogue.services.harvestingRun,d,this.refreshHarvester,null,null,"Failed to start the harvester");},scope:this}},{id:"harvestRemoveBt",text:"Remove",icon:"../images/default/cross.png",disabled:true,listeners:{click:function(){var b=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();Ext.Msg.confirm("Delete ?","Are you sure to delete selected harvester and all its records?",this.removeHarvester,b.data.id);},scope:this}},{text:"Refresh",id:"harvestRefreshBt",listeners:{click:function(){this.harvesterGrid.getStore().reload();},scope:this}}]});this.add(this.harvesterGrid);},addHarvester:function(b,a){var d={url:b,data:a};OpenLayers.Util.applyDefaults(d,{success:function(e){Ext.Msg.alert("ok",e.responseText);},failure:function(e){Ext.Msg.alert("Failed",e.responseText);}});OpenLayers.Request.POST(d);},doAction:function(a,f,e,b,g,d){OpenLayers.Request.GET({url:a,params:f,success:function(h){if(g){Ext.Msg.alert(g,h.responseText);}if(e){e(h);}},failure:function(h){if(d){Ext.Msg.alert(d,h.responseText);}if(e){e(h);}}});},removeHarvester:function(a){if(a=="yes"){var b={id:this};this.doAction(this.catalogue.services.harvestingRemove,b,this.refreshHarvester,null,null,"Failed to delete the harvester");}},refreshHarvester:function(){Ext.getCmp("harvestRefreshBt").fireEvent("click");}});Ext.reg("gn_admin_harvesterpanel",GeoNetwork.admin.HarvesterPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.MetadataInsertPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoScroll:true,autoWidth:true,layout:"border"},store:undefined,view:undefined,uploadForm:undefined,serviceUrl:undefined,ref:undefined,setRef:function(a){this.ref=a;},getForm:function(){var a=GeoNetwork.data.GroupStore(catalogue.services.getGroups);a.load();this.uploadForm=new Ext.form.FormPanel({region:"center",split:true,errorReader:new Ext.data.XmlReader({record:"response"},["id"]),items:[{xtype:"textfield",hidden:true,name:"insert_mode",value:"0"},{xtype:"textfield",hidden:true,name:"template",value:"s"},{xtype:"textarea",name:"data",fieldLabel:OpenLayers.i18n("xmlData"),allowBlank:false,width:300,height:200},new Ext.form.ComboBox({name:"group",hiddenName:"group",mode:"local",emptyText:OpenLayers.i18n("chooseGroup"),triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:a,allowBlank:false,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>"})],buttons:[{text:OpenLayers.i18n("add"),scope:this,iconCls:"thumbnailGoIcon",handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:catalogue.services.mdXMLInsert,scope:this,success:function(b,d){if(this.ownerCt){this.ownerCt.close();}},failure:function(b){Ext.Msg.alert(OpenLayers.i18n("failure"),b.responseText);}});}}}]});return this.uploadForm;},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.items=[this.getForm()];GeoNetwork.admin.MetadataInsertPanel.superclass.initComponent.call(this);}});Ext.reg("gn_admin_metadatainsertpanel",GeoNetwork.admin.MetadataInsertPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.SubTemplateManagerPanel=Ext.extend(Ext.Panel,{border:false,frame:false,record:undefined,layout:"border",catalogue:undefined,toolbar:undefined,searchPanel:undefined,searchForm:undefined,searchField:undefined,newMetadataWindow:undefined,searchResultGrid:undefined,subTemplateEditor:undefined,subTemplateToolbar:undefined,subTemplateType:undefined,subTemplateTypeStore:undefined,defaultConfig:{defaultViewMode:"simple",height:800,autoWidth:true,layout:"border",iconCls:"subtemplateIcon"},getSubTemplateTypeField:function(){return{xtype:"combo",name:"E__root",mode:"local",title:OpenLayers.i18n("selDirectoryTT"),triggerAction:"all",store:this.subTemplateTypeStore,valueField:"type",tpl:'<tpl for="."><div class="x-combo-list-item" title="{description}">{label} ({type})</div></tpl>',displayField:"label"};},initComponent:function(a){Ext.apply(this,a);Ext.applyIf(this,this.defaultConfig);this.subTemplateTypeStore=new GeoNetwork.data.SubTemplateTypeStore(this.catalogue.services.subTemplateType);this.catalogue.metadataStore=GeoNetwork.data.MetadataResultsStore();this.catalogue.editMode=2;this.catalogue.metadataEditFn=function(h,e,f,g){this.editorPanel.init(h,e,f,g,"s");}.bind(this);GeoNetwork.admin.SubTemplateManagerPanel.superclass.initComponent.call(this);this.initSearch();this.initEditor();var d={region:"west",split:true,collapsible:true,collapsed:false,hideCollapseTool:true,collapseMode:"mini",autoScroll:true,minWidth:240,width:280,items:[this.searchForm,this.searchResultGrid]};var b={region:"center",split:true,autoScroll:true,minHeigth:400,items:[this.editorPanel]};this.add(d);this.add(b);this.searchField.focus(true);},search:function(){this.editorPanel.cancel();this.catalogue.search("searchForm",null,null);},initSearch:function(){var a=this;this.searchField=new GeoNetwork.form.SearchField({name:"E_any",store:this.catalogue.metadataStore,triggerAction:function(d){d.record=undefined;d.disableToolbar(true);d.search();},scope:a});this.searchForm=new Ext.FormPanel({id:"searchForm",border:false,defaults:{width:240,hideLabel:true},items:[this.getSubTemplateTypeField(),{xtype:"textfield",name:"E__isTemplate",hidden:true,value:"s"},this.searchField]});
var b=["afterDelete"];Ext.each(b,function(d){this.catalogue.on(d,function(){this.search();},this);},this);this.searchResultGrid=new Ext.grid.GridPanel({layout:"fit",autoHeight:true,height:500,border:false,store:this.catalogue.metadataStore,columns:[{id:"title",header:OpenLayers.i18n("title"),dataIndex:"title"},{id:"uuid",header:"Uuid",dataIndex:"uuid",hidden:true}],autoExpandColumn:"title",listeners:{rowclick:function(d,g,f){this.record=d.getStore().getAt(g).data;this.editorPanel.init(this.record.id,false);this.disableToolbar(false);},scope:a},bbar:{items:[{xtype:"button",text:OpenLayers.i18n("add"),tooltip:OpenLayers.i18n("addTplElTT"),iconCls:"addIcon",handler:function(){var d="s";GeoNetwork.admin.AdminTools.showImportMetadataWindow(d,OpenLayers.i18n("subTemplateImport"));},scope:this},{text:OpenLayers.i18n("duplicate"),tooltip:OpenLayers.i18n("copyTplElTT"),iconCls:"md-mn-copy",disabled:true,handler:function(){var d=this.record.id;GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,d,OpenLayers.i18n("duplicate"),false);},scope:this},{text:OpenLayers.i18n("delete"),tooltip:OpenLayers.i18n("delTplElTT"),iconCls:"md-mn-del",disabled:true,handler:function(){var d=this.record.uuid;this.catalogue.metadataDelete(d);},scope:this},{text:OpenLayers.i18n("privileges"),tooltip:OpenLayers.i18n("privTplElTT"),iconCls:"privIcon",disabled:true,handler:function(){var d=this.record.id;this.catalogue.metadataAdmin(d);},scope:this}]}});},disableToolbar:function(a){var b=this.searchResultGrid.getBottomToolbar();Ext.each(b.items,function(e,d){if(d!==0){b.get(d).setDisabled(a);}},b);},initEditor:function(){var a={collapsed:true,hidden:true};this.editorPanel=new GeoNetwork.editor.EditorPanel({defaultViewMode:this.defaultViewMode,tbarConfig:{hideTypeMenu:true},utilityPanelConfig:{thumbnailPanel:a,relationPanel:a,validationPanel:{collapsed:true},suggestionPanel:a,helpPanel:{collapsed:false}},catalogue:this.catalogue,utilityPanelCollapsed:true});},refresh:function(){this.subTemplateTypeStore.load();}});Ext.reg("gn_admin_subtemplatemanagerpanel",GeoNetwork.admin.SubTemplateManagerPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.ThesaurusManagerPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoWidth:true,layout:"border",maxResults:50,defaultThesaurusType:"theme"},border:false,frame:false,selectedThesaurus:undefined,layout:"border",catalogue:undefined,toolbar:undefined,thesaurusGrid:undefined,thesaurusStore:undefined,keywordGrid:undefined,createEmptyThesaurusWindow:undefined,createThesaurusFromLocalFileWindow:undefined,createThesaurusFromRemoteFileWindow:undefined,createEmptyThesaurusForm:undefined,createThesaurusFromLocalFileForm:undefined,createThesaurusFromRemoteFileForm:undefined,initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.thesaurusStore=new GeoNetwork.data.ThesaurusStore({url:this.catalogue.services.getThesaurus});var b=Ext.data.Record.create([{name:"id"},{name:"value"},{name:"thesaurus"},{name:"definition"},{name:"uri"},{name:"east"},{name:"west"},{name:"south"},{name:"north"}]);this.keywordStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pThesauri:"",pMode:"searchBox",maxResults:this.maxResults},reader:new Ext.data.XmlReader({record:"keyword",id:"id"},b),fields:["id","value","definition","thesaurus","uri","east","west","south","north"],sortInfo:{field:"value"}});GeoNetwork.admin.ThesaurusManagerPanel.superclass.initComponent.call(this);this.initThesaurusView();this.initKeywordView();var d={region:"west",split:true,autoScroll:true,minWidth:280,width:400,items:[this.thesaurusGrid]};var a={region:"center",split:true,autoScroll:true,minHeigth:400,items:[this.keywordGrid]};this.add(d);this.add(a);},initThesaurusView:function(){var b=this;var a=[["y"],["n"]];var d=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"title",header:OpenLayers.i18n("ThesaurusName"),dataIndex:"title",editable:false},{id:"filename",header:OpenLayers.i18n("id"),dataIndex:"filename",editable:false},{id:"theme",header:OpenLayers.i18n("Theme"),dataIndex:"theme",editable:false},{id:"type",header:OpenLayers.i18n("Type"),dataIndex:"type",editable:false},{id:"activated",header:OpenLayers.i18n("Activated"),dataIndex:"activated",width:50,editor:new Ext.form.ComboBox({mode:"local",editable:false,typeAhead:true,triggerAction:"all",lazyRender:true,allowBlank:false,listClass:"x-combo-list-small",store:new Ext.data.ArrayStore({id:0,fields:["id"],data:a}),valueField:"id",displayField:"id"})}]});this.thesaurusGrid=new Ext.grid.EditorGridPanel({layout:"fit",autoHeight:true,border:false,store:this.thesaurusStore,cm:d,autoExpandColumn:"title",clicksToEdit:1,listeners:{scope:this,afteredit:function(f){Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusActivate+"?ref="+f.record.data.id+"&activated="+f.record.data.activated,failure:function(){Ext.Msg.alert("Fail");}});},dblclick:function(f){this.keywordStore.setBaseParam("pKeyword","*");this.keywordStore.reload();}},sm:new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{scope:this,selectionchange:function(e){this.updateKeywordGridAndToolbar();this.updateThesaurusToolbar();this.updateKeywordToolbar();}}}),tbar:{disabled:false,items:[{text:OpenLayers.i18n("add"),iconCls:"addIcon",menu:{xtype:"menu",plain:true,items:[{text:OpenLayers.i18n("emptyThesaurus"),scope:this,handler:function(){if(!this.createEmptyThesaurusWindow){this.createEmptyThesaurusWindow=this.getCreateEmptyThesaurusWindow();}this.createEmptyThesaurusWindow.show(this);}},{text:OpenLayers.i18n("thesaurusFromFile"),scope:this,handler:function(){if(!this.createThesaurusFromLocalFileWindow){this.createThesaurusFromLocalFileWindow=this.getCreateThesaurusFromLocalFileWindow();}this.createThesaurusFromLocalFileWindow.show(this);}},{text:OpenLayers.i18n("thesaurusFromURL"),scope:this,handler:function(){if(!this.createThesaurusFromRemoteFileWindow){this.createThesaurusFromRemoteFileWindow=this.getCreateThesaurusFromRemoteFileWindow();}this.createThesaurusFromRemoteFileWindow.show(this);}}]}},{id:"delete_thesaurus_button",disabled:true,text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){OpenLayers.Request.GET({scope:this,url:this.catalogue.services.thesaurusDelete+"?ref="+this.keywordStore.baseParams.pThesauri,success:function(e){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(e){}});},scope:this},{id:"download_thesaurus_button",disabled:true,text:OpenLayers.i18n("download"),iconCls:"xmlIcon",handler:function(){location.replace(this.catalogue.services.thesaurusDownload+"?ref="+this.keywordStore.baseParams.pThesauri);},scope:this}]}});},initKeywordView:function(){var a=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"id",header:OpenLayers.i18n("id"),dataIndex:"uri",editor:new Ext.form.TextField({allowBlank:false})},{id:"hidden_id",header:OpenLayers.i18n("uri"),dataIndex:"id",hidden:true,editor:new Ext.form.TextField({allowBlank:false})},{id:"value",header:OpenLayers.i18n("label"),dataIndex:"value",editor:new Ext.form.TextField({allowBlank:false})},{id:"definition",header:OpenLayers.i18n("definition"),dataIndex:"definition",editor:new Ext.form.TextField({allowBlank:false})},{id:"west",header:OpenLayers.i18n("xmin"),dataIndex:"west",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"east",header:OpenLayers.i18n("xmax"),dataIndex:"east",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"south",header:OpenLayers.i18n("ymin"),dataIndex:"south",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"north",header:OpenLayers.i18n("ymax"),dataIndex:"north",hidden:true,editor:new Ext.form.TextField({allowBlank:true})}]});this.keywordGrid=new Ext.grid.EditorGridPanel({layout:"fit",autoHeight:true,height:500,border:false,store:this.keywordStore,cm:a,autoExpandColumn:"value",sm:new Ext.grid.CellSelectionModel({listeners:{scope:this,selectionchange:function(b){this.updateKeywordToolbar();
}}}),listeners:{scope:this,afteredit:function(q){var g=this.keywordStore.baseParams.pThesauri;var v=g.split(".")[1];var s=q.record.data.uri.split("#");var j=s[0];var h=s[1];var b=h;var d=this.catalogue.lang;var t=q.record.data.value;var f=q.record.data.definition;var m;if(q.field==="uri"){b=q.originalValue.split("#")[1];}if(v==="place"){var o=q.record.data.south;var l=q.record.data.north;var u=q.record.data.west;var r=q.record.data.east;m="<request><oldid>"+b+"</oldid><newid>"+h+"</newid><lang>"+d+"</lang><ref>"+g+"</ref><definition>"+f+"</definition><namespace>"+j+"#</namespace><north>"+l+"</north><south>"+o+"</south><east>"+r+"</east><prefLab>"+t+"</prefLab><west>"+u+"</west><refType>"+v+"</refType></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptUpdate,failure:function(){Ext.Msg.alert("Fail");},xmlData:m});}else{m="<request><newid>"+h+"</newid><refType>"+v+"</refType><definition>"+f+"</definition><namespace>"+j+"#</namespace><ref>"+g+"</ref><oldid>"+b+"</oldid><lang>"+d+"</lang><prefLab>"+t+"</prefLab></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptUpdate,failure:function(){Ext.Msg.alert("Fail");},xmlData:m});}q.record.commit();}},tbar:{disabled:true,items:[{id:"add_keyword_button",text:OpenLayers.i18n("add"),iconCls:"addIcon",handler:function(){var s=this.keywordGrid.store.recordType;var d="#"+new Date().getTime();var e=this.keywordStore.baseParams.pThesauri;var t=e.split(".")[1];var g=d.split("#")[1];var b=this.catalogue.lang;var q=OpenLayers.i18n("newLabel");var f=OpenLayers.i18n("newDefinition");var l;if(t==="place"){var m=-90;var j=90;var r=-180;var o=180;l="<request><oldid/><newid>"+g+"</newid><lang>"+b+"</lang><ref>"+e+"</ref><definition>"+f+"</definition><namespace>#</namespace><north>"+j+"</north><south>"+m+"</south><east>"+o+"</east><prefLab>"+q+"</prefLab><west>"+r+"</west><refType>"+t+"</refType></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptAdd,failure:function(){Ext.Msg.alert("Fail");},xmlData:l});}else{l="<request><newid>"+g+"</newid><refType>"+t+"</refType><definition>"+f+"</definition><namespace>#</namespace><ref>"+e+"</ref><oldid/><lang>"+b+"</lang><prefLab>"+q+"</prefLab></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptAdd,failure:function(){Ext.Msg.alert("Fail");},xmlData:l});}var h=new s({uri:d,value:q,definition:f,west:-180,east:180,south:-90,north:90});this.keywordGrid.stopEditing();this.keywordGrid.store.insert(0,h);this.keywordGrid.startEditing(0,0);},scope:this},{id:"delete_keyword_button",text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){var b=this.keywordGrid.getSelectionModel().getSelectedCell();var g=this.keywordGrid.store.getAt(b[0]);var d=this.keywordStore.baseParams.pThesauri;var f=g.data.uri.split("#");var e=f[0];var h=f[1];Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptDelete+"?pThesaurus="+d+"&namespace="+e+"%23&id="+h,failure:function(){Ext.Msg.alert("Fail");}});this.keywordGrid.store.removeAt(b[0]);},scope:this},"->",this.getKeyword(),OpenLayers.i18n("maxResults")+" "+OpenLayers.i18n("perThesaurus"),this.getLimitInput()]}});},updateThesaurusToolbar:function(){var a=this.thesaurusGrid.getSelectionModel().getSelected();Ext.getCmp("delete_thesaurus_button").setDisabled(!a);Ext.getCmp("download_thesaurus_button").setDisabled(!a);},updateKeywordToolbar:function(){var b=this.thesaurusGrid.getSelectionModel().getSelected();if(b){var e=b.data.type;var d=e==="local";if(d){var a=this.keywordGrid.getSelectionModel().getSelectedCell();Ext.getCmp("delete_keyword_button").setDisabled(!a);}}},updateKeywordGridAndToolbar:function(){var a=this.thesaurusGrid.getSelectionModel().getSelected();if(a){this.keywordGrid.getTopToolbar().enable();var d=a.data.theme;var h=a.data.type;var e=h==="local";var g=a.data.id;this.keywordStore.removeAll();this.keywordStore.baseParams.pThesauri=g;var f=(d!=="place");this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("east"),f);this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("west"),f);this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("south"),f);this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("north"),f);for(var b=0;b<this.keywordGrid.getColumnModel().getColumnCount();b++){this.keywordGrid.getColumnModel().setEditable(b,e);}Ext.getCmp("delete_keyword_button").setDisabled(!e);Ext.getCmp("add_keyword_button").setDisabled(!e);}else{this.keywordGrid.getTopToolbar().disable();}},getCreateEmptyThesaurusWindow:function(){var a=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateEmptyThesaurusForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){if(this.createEmptyThesaurusForm.getForm().isValid()){this.createEmptyThesaurusForm.getForm().getEl().dom.enctype="application/x-www-form-urlencoded";this.createEmptyThesaurusForm.bodyCfg.enctype="application/x-www-form-urlencoded";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusAdd,success:function(){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(){Ext.Msg.alert("Fail");},xmlData:"<request><fname>"+Ext.getCmp("empty_thesaurusName").getValue()+"</fname><dname>"+Ext.getCmp("empty_themeCmb").getValue()+"</dname><type>"+Ext.getCmp("empty_thesaurusType").getValue()+"</type></request>"});a.hide();}}}]});return a;},getCreateThesaurusFromLocalFileWindow:function(){var a=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateThesaurusFromLocalFileForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){console.log(this.createThesaurusFromLocalFileForm);if(this.createThesaurusFromLocalFileForm.getForm().isValid()){this.createThesaurusFromLocalFileForm.getForm().getEl().dom.enctype="multipart/form-data";this.createThesaurusFromLocalFileForm.bodyCfg.enctype="multipart/form-data";this.createThesaurusFromLocalFileForm.getForm().submit({url:this.catalogue.services.thesaurusUpload,scope:this,success:function(b,d){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(b){Ext.Msg.alert(OpenLayers.i18n("failure"),b.responseText);}});a.hide();}}}]});return a;},getCreateThesaurusFromRemoteFileWindow:function(){var a=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateThesaurusFromRemoteFileForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){if(this.createThesaurusFromRemoteFileForm.getForm().isValid()){this.createThesaurusFromRemoteFileForm.getForm().getEl().dom.enctype="application/x-www-form-urlencoded";this.createThesaurusFromRemoteFileForm.bodyCfg.enctype="application/x-www-form-urlencoded";this.createThesaurusFromRemoteFileForm.getForm().submit({url:this.catalogue.services.thesaurusUpload,scope:this,success:function(b){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(b){Ext.Msg.alert(OpenLayers.i18n("failure"),b.responseText);}});a.hide();}}}]});return a;},getCreateEmptyThesaurusForm:function(){this.createEmptyThesaurusForm=new Ext.form.FormPanel({fileUpload:false,region:"center",autoHeight:true,baseCls:"x-plain",labelWidth:170,split:true,items:[{xtype:"textfield",fieldLabel:OpenLayers.i18n("ThesaurusName"),id:"empty_thesaurusName",name:"fname",anchor:"-15"},this.createTypeCombo("empty_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"empty_thesaurusType",name:"type",value:"local",hidden:true,anchor:"-15"}]});
return this.createEmptyThesaurusForm;},getCreateThesaurusFromLocalFileForm:function(){this.createThesaurusFromLocalFileForm=new Ext.form.FormPanel({fileUpload:true,region:"center",autoHeight:true,baseCls:"x-plain",errorReader:new Ext.data.XmlReader({record:"record"},["Thesaurus"]),labelWidth:170,split:true,items:[{xtype:"fileuploadfield",allowBlank:true,fieldLabel:OpenLayers.i18n("thesaurusFilePath"),id:"local_fname",name:"fname",buttonCfg:{text:OpenLayers.i18n("selectFile")}},this.createTypeCombo("local_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"local_thesaurusType",name:"type",value:"external",hidden:true,anchor:"-15"},{xtype:"textfield",hidden:true,name:"mode",value:"file"}]});return this.createThesaurusFromLocalFileForm;},getCreateThesaurusFromRemoteFileForm:function(){this.createThesaurusFromRemoteFileForm=new Ext.form.FormPanel({fileUpload:false,region:"center",autoHeight:true,baseCls:"x-plain",labelWidth:170,split:true,errorReader:new Ext.data.XmlReader({record:"record"},["Thesaurus"]),listeners:{scope:this,afterrender:function(a){Ext.getCmp("remote_thesaurusURL").setVisible(true);Ext.getCmp("remote_thesaurusCmb").setVisible(false);Ext.getCmp("remote_themeCmb").setVisible(true);}},items:[{xtype:"radiogroup",id:"creationModeRadioGroup",columns:1,submitValue:false,fieldLabel:OpenLayers.i18n("creationMode"),items:[{boxLabel:OpenLayers.i18n("createThesaurusFromURL"),name:"rb-auto",inputValue:1,checked:true},{boxLabel:OpenLayers.i18n("createThesaurusFromRepository"),name:"rb-auto",inputValue:2}],listeners:{scope:this,change:function(b,a){Ext.getCmp("remote_thesaurusURL").setVisible(a.inputValue===1);Ext.getCmp("remote_thesaurusCmb").setVisible(a.inputValue===2);Ext.getCmp("remote_themeCmb").setVisible(a.inputValue!==2);}}},{xtype:"textfield",fieldLabel:OpenLayers.i18n("externalThesaurusURL"),id:"remote_thesaurusURL",name:"url",anchor:"-15"},{fieldLabel:OpenLayers.i18n("thesaurusFromRepository"),id:"remote_thesaurusCmb",anchor:"-15",xtype:"combo",mode:"local",triggerAction:"all",forceSelection:true,editable:false,displayField:"title",valueField:"link",submitValue:false,store:new GeoNetwork.data.ThesaurusFeedStore(),listeners:{scope:this,select:function(d,a,b){Ext.getCmp("remote_thesaurusURL").setValue(a.data.link);Ext.getCmp("remote_themeCmb").setValue(a.data.category);}}},this.createTypeCombo("remote_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"remote_thesaurusType",name:"type",value:"external",hidden:true,anchor:"-15"}]});return this.createThesaurusFromRemoteFileForm;},createTypeCombo:function(a){return new Ext.form.ComboBox({fieldLabel:OpenLayers.i18n("Theme"),id:a,name:"themeCmb",anchor:"-15",mode:"local",value:this.defaultThesaurusType,triggerAction:"all",forceSelection:true,editable:false,displayField:"name",valueField:"value",hiddenName:"dir",store:new Ext.data.JsonStore({fields:["name","value"],data:[{name:"Discipline",value:"discipline"},{name:"Place",value:"place"},{name:"Stratum",value:"stratum"},{name:"Temporal",value:"temporal"},{name:"Theme",value:"theme"}]})});},getKeyword:function(){return new GeoNetwork.form.SearchField({id:"keywordSearchField",width:240,store:this.keywordStore,paramName:"pKeyword"});},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:this.maxResults,width:40,listeners:{scope:this,change:function(d,b,a){this.keywordStore.baseParams.maxResults=b;}}};}});Ext.reg("gn_admin_thesaurusmanagerpanel",GeoNetwork.admin.ThesaurusManagerPanel);Ext.namespace("GeoNetwork");GeoNetwork.OGCServiceQuickRegister=Ext.extend(Ext.menu.Menu,{catalogue:undefined,harvesterStore:undefined,textInfo:undefined,textExample:"eg. http://services.sandre.eaufrance.fr/geo/ouvrage?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities",textValidButton:"Check & Add",urlFieldWidth:250,urlField:undefined,initComponent:function(){this.textInfo=OpenLayers.i18n("enterGetCapURL");var a=[];a.push({text:this.textInfo,canActivate:false});this.urlField={xtype:"textfield",width:this.urlFieldWidth,margins:"0 0 0 30",id:"OGCServiceQuickRegisterUrl",value:"",iconCls:"no-icon"};a.push(this.urlField);a.push({text:this.textExample,canActivate:false});a.push({xtype:"buttongroup",autoWidth:true,border:false,frame:false,columns:2,iconCls:"no-icon",defaults:{xtype:"button",iconAlign:"right"},items:[{text:this.textValidButton,iconCls:"md-mn md-mn-badd",handler:this.getCapabilities}]});Ext.apply(this,{defaultType:"menuitem",items:a});GeoNetwork.OGCServiceQuickRegister.superclass.initComponent.call(this);},getCapabilities:function(){var a=Ext.getCmp("OGCServiceQuickRegisterUrl").getValue();var b=this.ownerCt.ownerCt;OpenLayers.Request.GET({url:a,success:function(d){if(d.responseText.indexOf("Some unexpected")!==-1){Ext.Msg.alert("Failed to check service url.",d.responseText);return;}var e=d.responseXML;if(!e){Ext.Msg.alert("GetCapabilities failed","Null response returned - check proxy or service configuration.");return;}var g=new OpenLayers.Format.WMSCapabilities();var f=g.read(e);b.addHarvester(f.service.title,a,f.version);},failure:function(d){Ext.Msg.alert("Failed to check service url.",d.responseText);}});},addHarvester:function(g,e,a){var f=new Ext.data.Record({id:"",type:"ogcwxs",site_name:g,site_url:e.replace(/&/g,"&amp;"),site_ogctype:"WMS"+a,site_icon:"default.gif",site_account_use:"false",options_every:"90",options_topic:"",options_onerunonly:"true",options_lang:"en",options_createthumbnails:"true",options_uselayer:"true",options_uselayermd:"false"});var b=new GeoNetwork.Templates().getHarvesterTemplate();var d=b.apply(f.data);this.saveHarvester(d);},saveHarvester:function(a){var d=this;var b={url:this.catalogue.services.harvestingAdd,data:a};OpenLayers.Util.applyDefaults(b,{success:function(e){var f=e.responseXML;var g=f.firstChild.getAttribute("id");d.runHarvester(this.catalogue.services.harvestingRun,g);},failure:function(e){Ext.Msg.alert("Failed",e.responseText);}});OpenLayers.Request.POST(b);},runHarvester:function(a,d){var b=this;OpenLayers.Request.GET({url:a+"?id="+d,success:function(e){if(e.responseText.indexOf("nexpected")!==-1){Ext.Msg.alert("Activation or start failed.",e.responseText);return;}Ext.Msg.alert("Successfull registration","Wait a few minutes before having all layers and services registered in the catalogue.");if(b.harvesterStore){b.harvesterStore.reload();}},failure:function(e){Ext.Msg.alert("Registration failed",e.responseText);}});}});Ext.reg("gn_ogcservicequickregister",GeoNetwork.OGCServiceQuickRegister);Ext.namespace("GeoNetwork.map");GeoNetwork.map.ExtentMap=function(){var r=[];var g=[];var j=OpenLayers.Feature.Vector.style["default"];var C=null;var B=null;var m=null;var s=null;var D=null;var l=5;var t=OpenLayers.Class(OpenLayers.Geometry,{id:null,initialize:function(I){this.id=I;},CLASS_NAME:"GeoNetwork.map.ExtentMap.MultiPolygonReference"});var w=GeoNetwork.map.PROJECTION||"EPSG:4326";var a="EPSG:4326";var F=new OpenLayers.Projection(a);var H=null;var v="m";var h=null;function E(I,J){var M=new OpenLayers.Projection(J);var K=(M===F?new OpenLayers.Format.GML.v3():new OpenLayers.Format.GML.v3({externalProjection:F,internalProjection:M}));var L=K.writeNode("feature:_geometry",I.geometry);return OpenLayers.Format.XML.prototype.write.call(K,L.firstChild);}function u(){var K,I={units:v,projection:w,theme:null},M=new OpenLayers.Map(I);if(!s){var L=M.getControlsByClass("OpenLayers.Control.Navigation")[0];L.disableZoomWheel();M.removeControl(M.getControlsByClass("OpenLayers.Control.PanZoom")[0]);}M.addControl(new OpenLayers.Control.MousePosition());for(K=0;K<GeoNetwork.map.BACKGROUND_LAYERS.length;K++){M.addLayer(GeoNetwork.map.BACKGROUND_LAYERS[K].clone());}var J=new OpenLayers.Layer.Vector("VectorLayer",{});M.addLayer(J);J.events.on({sketchstarted:function(){this.destroyFeatures();},scope:J});r[D]=M;g[D]=J;return M;}function z(L,K,M,N){var I=K.split(","),J;for(J=0;J<I.length;++J){Ext.get(I[J]).on("change",function(){e(N,K,M,false);});Ext.get("_"+I[J]).on("change",function(){e(N,K,M,true);
});}}function e(K,O,Q,N){var M=K.getLayersByName("VectorLayer")[0];var J,S,U;var I=O.split(",");S=[];if(N){S[0]=Ext.get("_"+I[0]).getValue();S[1]=Ext.get("_"+I[1]).getValue();S[2]=Ext.get("_"+I[2]).getValue();S[3]=Ext.get("_"+I[3]).getValue();J=OpenLayers.Bounds.fromArray(S);U=J.clone();if(w!==F){U.transform(new OpenLayers.Projection(a),new OpenLayers.Projection(w));}}else{S[0]=Ext.get(I[0]).getValue();S[1]=Ext.get(I[1]).getValue();S[2]=Ext.get(I[2]).getValue();S[3]=Ext.get(I[3]).getValue();J=OpenLayers.Bounds.fromArray(S);U=J.clone();var P=null;var L=document.getElementsByName("proj_"+Q);for(i=0;i<L.length;i++){if(L[i].checked===true){P=L[i].value;}}if(P!==w){U.transform(new OpenLayers.Projection(P),new OpenLayers.Projection(w));}if(P!==a){J.transform(new OpenLayers.Projection(P),new OpenLayers.Projection(a));}Ext.get("_"+I[0]).dom.value=J.left;Ext.get("_"+I[1]).dom.value=J.bottom;Ext.get("_"+I[2]).dom.value=J.right;Ext.get("_"+I[3]).dom.value=J.top;}Ext.get(I[0]).dom.onkeyup();Ext.get(I[1]).dom.onkeyup();Ext.get(I[2]).dom.onkeyup();Ext.get(I[3]).dom.onkeyup();var T=new OpenLayers.Feature.Vector(U.toGeometry());M.destroyFeatures();M.addFeatures(T);G(r[Q],g[Q]);o(O,Q);}function o(L,M){function O(S,Z,U){var T=S.split(",");var ab=Ext.get("_"+T[0]).getValue();var ad=Ext.get("_"+T[1]).getValue();var Y=Ext.get("_"+T[2]).getValue();var V=Ext.get("_"+T[3]).getValue();var W=ab!==""?ab:"0";var aa=ad!==""?ad:"0";var Q=Y!==""?Y:"0";var ac=V!==""?V:"0";var P=OpenLayers.Bounds.fromString(W+","+aa+","+Q+","+ac);if(!Z.equals(F)){P.transform(F,Z);}if(ab!==""){ab=P.left.toFixed(U)+"";}Ext.get(T[0]).dom.value=ab;if(ad!==""){ad=P.bottom.toFixed(U)+"";}Ext.get(T[1]).dom.value=ad;if(Y!==""){Y=P.right.toFixed(U)+"";}Ext.get(T[2]).dom.value=Y;if(V!==""){V=P.top.toFixed(U)+"";}Ext.get(T[3]).dom.value=V;}var J=Ext.DomQuery.select("input.proj"),I;for(I=0;I<J.length;++I){var K=J[I];if(K.id.indexOf(M)!==-1){if(K.checked){O(L,new OpenLayers.Projection(K.value),l);}var N=Ext.get(K.id);N.on("click",function(){O(L,new OpenLayers.Projection(this.value),l);},N.dom);}}}function d(I){var L="WKT";var N,M;if(I!==null){L=I.format||"WKT";N=I.from;M=I.to;}var K=new OpenLayers.Format[L]();if(N!==null&&M!==null){K.internalProjection=N;K.externalProjection=M;}if(!this.vectorLayer.features.length){return null;}var J=this.vectorLayer.features[this.vectorLayer.features.length-1];return K.write(J);}function q(K,Q,J,I){if(K===""){return false;}var O="WKT";var M,N;if(Q!==null){O=Q.format||"WKT";M=Q.from;N=Q.to;}var L=new OpenLayers.Format[O]();if(M!==null&&N!==null){L.externalProjection=M;L.internalProjection=N;}K=K.replace(/\n/g,"");var P=L.read(K);if(!P){return false;}if(P.length){P=P[0];}J.addFeatures(P);if(Q.zoomToFeatures){G(I,J);}return true;}function f(P,J,N){var M=P.getLayersByName("VectorLayer")[0];var O;var I=J.split(",");var K=[];K[0]=Ext.get("_"+I[0]).getValue();K[1]=Ext.get("_"+I[1]).getValue();K[2]=Ext.get("_"+I[2]).getValue();K[3]=Ext.get("_"+I[3]).getValue();O=OpenLayers.Bounds.fromArray(K);O.transform(F,H);Ext.get(I[0]).dom.onkeyup();Ext.get(I[1]).dom.onkeyup();Ext.get(I[2]).dom.onkeyup();Ext.get(I[3]).dom.onkeyup();var L=new OpenLayers.Feature.Vector(O.toGeometry());M.destroyFeatures();M.addFeatures(L);G(P,M);o(J,N);}function b(I){var J=GeoNetwork.data.RegionStore(catalogue.services.getRegions);var K=new Ext.form.ComboBox({store:J,tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label[\''+OpenLayers.Lang.getCode()+"']]}</div></tpl>",typeAhead:true,mode:"local",triggerAction:"all",emptyText:OpenLayers.i18n("selectRegion"),selectOnFocus:true,width:135,listeners:{focus:{fn:function(L){L.getStore().load();}},select:{fn:I}},iconCls:"no-icon"});return K;}function G(M,J){var L=J.getDataExtent();if(L&&!isNaN(L.left)){var K=L.getWidth()/2;var I=L.getHeight()/2;L.left-=K;L.right+=K;L.bottom-=I;L.top+=I;M.zoomToExtent(L);}else{M.zoomToMaxExtent();}}return{init:function(){},initMapDiv:function(){var U,K,V,T,O;H=new OpenLayers.Projection(w);h=H;U=Ext.DomQuery.select(".extentViewer");K=Ext.id;for(V=0;V<U.length;++V){var Q=U[V];C=Q.getAttribute("target_polygon");B=Q.getAttribute("watched_bbox");s=Q.getAttribute("edit")==="true";D=Q.getAttribute("elt_ref");T=Q.getAttribute("desc_ref");m=Q.getAttribute("mode");var L=Q.childNodes;var P=[];for(O=0;O<L.length;O++){if(L[O].nodeType===1){P.push(L[O]);}}L=P;if(L.length>1){continue;}var J;J=Ext.id(Q);var I=u();if(s){var N,S=[];if(m==="bbox"){N=new OpenLayers.Control.DrawFeature(g[D],OpenLayers.Handler.RegularPolygon,{handlerOptions:{irregular:true,sides:4},featureAdded:function(Y){var aa=Y.geometry.getBounds(),Z;if(H!==F){Z=aa.clone().transform(H,F);}else{Z=aa;}var W=this.watchedBbox.split(",");Ext.get("_"+W[0]).dom.value=Z.left;Ext.get("_"+W[1]).dom.value=Z.bottom;Ext.get("_"+W[2]).dom.value=Z.right;Ext.get("_"+W[3]).dom.value=Z.top;o(this.watchedBbox,this.eltRef);}.bind({watchedBbox:B,eltRef:D})});S.push(new GeoExt.Action({map:r[D],control:N,text:OpenLayers.i18n("drawRectangle"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawRectangle"}));S.push(b(function(aa,Z,Y){var W=this.watchedBbox.split(",");Ext.get("_"+W[0]).dom.value=Z.data.west;Ext.get("_"+W[1]).dom.value=Z.data.south;Ext.get("_"+W[2]).dom.value=Z.data.east;Ext.get("_"+W[3]).dom.value=Z.data.north;f(r[D],B,D,true);if(Ext.get("_"+this.descRef)!==null){Ext.get("_"+this.descRef).dom.value=Z.data.label[OpenLayers.Lang.getCode()];}}.bind({extentMap:this,map:r[D],watchedBbox:B,eltRef:D,descRef:T})));}else{if(m==="polygon"){N=new OpenLayers.Control.DrawFeature(g[D],OpenLayers.Handler.Polygon,{featureAdded:function(W){document.getElementById("_X"+this).value=E(W,w);}.bind(C)});S.push(new GeoExt.Action({map:r[D],control:N,text:OpenLayers.i18n("drawPolygon"),tooltip:OpenLayers.i18n("drawPolygonTT"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawPolygon"}));N=new OpenLayers.Control.DrawFeature(g[D],OpenLayers.Handler.RegularPolygon,{handlerOptions:{irregular:true,sides:60},featureAdded:function(W){document.getElementById("_X"+this).value=E(W,w);}.bind(C)});S.push(new GeoExt.Action({map:r[D],control:N,text:OpenLayers.i18n("drawCircle"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawCircle"}));}}S.push({text:OpenLayers.i18n("clear"),iconCls:"clearPolygon",handler:function(){this.vectorLayer.destroyFeatures();var Y=document.getElementById("_X"+this.targetPolygon);if(Y!==null){Y.value="";}if(this.targetBbox!==""){var W=this.targetBbox.split(",");Ext.get(W[0]).dom.value="";Ext.get(W[1]).dom.value="";Ext.get(W[2]).dom.value="";Ext.get(W[3]).dom.value="";Ext.get("_"+W[0]).dom.value="";Ext.get("_"+W[1]).dom.value="";Ext.get("_"+W[2]).dom.value="";Ext.get("_"+W[3]).dom.value="";$(W[0]).onkeyup();$(W[1]).onkeyup();$(W[2]).onkeyup();$(W[3]).onkeyup();}},scope:{vectorLayer:g[D],targetPolygon:C,targetBbox:B,eltRef:D}});}var M=new GeoExt.MapPanel({renderTo:J,height:300,width:400,map:r[D],tbar:(s?S:null)});if(L.length>0){q(L[0].innerHTML,{format:"WKT",zoomToFeatures:true,from:F,to:H},g[D],r[D]);}if(B!==""){o(B,D);z(g[D],B,D,r[D]);}}}};};GeoNetwork.map.ExtentMap.prev_geometry=OpenLayers.Format.GML.Base.prototype.writers.feature._geometry;OpenLayers.Format.GML.Base.prototype.writers.feature._geometry=function(d){if(d.CLASS_NAME==="GeoNetwork.map.ExtentMap.MultiPolygonReference"){var b=this.createElementNS(this.namespaces.gml,"gml:MultiPolygon");var a=this.createElementNS(this.namespaces.gml,"gml:MultiPolygon");a.setAttribute("gml:id",d.id);b.appendChild(a);return b;}else{return GeoNetwork.map.ExtentMap.prev_geometry.apply(this,arguments);}};if(!window.GeoNetwork){window.GeoNetwork={};}if(!GeoNetwork.Control){GeoNetwork.Control={};}GeoNetwork.Control.ZoomWheel=OpenLayers.Class(OpenLayers.Control,{wheelChange:OpenLayers.Control.Navigation.prototype.wheelChange,draw:function(){this.handler=new OpenLayers.Handler.MouseWheel(this,{up:OpenLayers.Control.Navigation.prototype.wheelUp,down:OpenLayers.Control.Navigation.prototype.wheelDown});this.activate();},CLASS_NAME:"GeoNetwork.Control.ZoomWheel"});
if(!window.GeoNetwork){window.GeoNetwork={};}if(!GeoNetwork.Control){GeoNetwork.Control={};}GeoNetwork.Control.ExtentBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,wktelement:null,minxelement:null,minyelement:null,maxxelement:null,maxyelement:null,EVENT_TYPES:["finishBox"],initialize:function(a){this.EVENT_TYPES=GeoNetwork.Control.ExtentBox.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.RegularPolygon(this,{create:this.startBox,done:this.endBox},{irregular:true});},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);},startBox:function(){this.getOrCreateLayer();this.vectorLayer.destroyFeatures();},endBox:function(){var a=this.handler.feature.geometry.getBounds();this.updateFields(a);this.events.triggerEvent("finishBox",null);},updateFields:function(a){var f=new OpenLayers.Feature.Vector(a.toGeometry(),null,this.vectorLayerStyle);this.vectorLayer.addFeatures([f]);this.vectorLayer.refresh();var j=this.map.getProjectionObject();var d=new OpenLayers.Projection("WGS84");var b=new OpenLayers.LonLat(a.left,a.bottom).transform(j,d);var e=new OpenLayers.LonLat(a.right,a.top).transform(j,d);var m=b.lon.toFixed(4),l=b.lat.toFixed(4),h=e.lon.toFixed(4),g=e.lat.toFixed(4);if(this.wktelement){this.wktelement.setValue("POLYGON(("+m+" "+l+","+m+" "+g+","+h+" "+g+","+h+" "+l+","+m+" "+l+"))");}else{if(this.minxelement){this.minxelement.dom.value=m;}if(this.maxxelement){this.maxxelement.dom.value=h;}if(this.minyelement){this.minyelement.dom.value=l;}if(this.maxyelement){this.maxyelement.dom.value=g;}}},updateMap:function(){if((!this.minxelement)||(!this.maxxelement)||(!this.minyelement)||(!this.maxyelement)){return;}this.getOrCreateLayer();var l=this.map.getProjectionObject();var d=new OpenLayers.Projection("WGS84");var j=new OpenLayers.LonLat(this.map.getExtent().left,this.map.getExtent().bottom).transform(l,d);var f=new OpenLayers.LonLat(this.map.getExtent().right,this.map.getExtent().top).transform(l,d);var e=parseFloat(this.minxelement.dom.value);if(isNaN(e)){this.minxelement.dom.value=j.lon;}e=parseFloat(this.maxxelement.dom.value);if(isNaN(e)){this.maxxelement.dom.value=f.lon;}e=parseFloat(this.minyelement.dom.value);if(isNaN(e)){this.minyelement.dom.value=j.lat;}e=parseFloat(this.maxyelement.dom.value);if(isNaN(e)){this.maxyelement.dom.value=f.lat;}this.minxelement.dom.value=parseFloat(this.minxelement.dom.value).toFixed(4);this.maxxelement.dom.value=parseFloat(this.maxxelement.dom.value).toFixed(4);this.minyelement.dom.value=parseFloat(this.minyelement.dom.value).toFixed(4);this.maxyelement.dom.value=parseFloat(this.maxyelement.dom.value).toFixed(4);this.vectorLayer.destroyFeatures();var a=new OpenLayers.LonLat(this.minxelement.dom.value,this.minyelement.dom.value).transform(d,l);var g=new OpenLayers.LonLat(this.maxxelement.dom.value,this.maxyelement.dom.value).transform(d,l);var b=new OpenLayers.Bounds();b.extend(a);b.extend(g);var h=new OpenLayers.Feature.Vector(b.toGeometry(),null,this.vectorLayerStyle);this.vectorLayer.addFeatures([h]);this.vectorLayer.refresh();},getOrCreateLayer:function(){if(!this.vectorLayer){this.vectorLayer=this.vectorLayer||new OpenLayers.Layer.Vector("ExtentBox",{style:this.vectorLayerStyle});this.map.addLayer(this.vectorLayer);}this.map.setLayerIndex(this.vectorLayer,this.map.getNumLayers());return this.vectorLayer;},clear:function(){if(this.vectorLayer){this.vectorLayer.destroyFeatures();}},zoomTo:function(){var f=this.map.getProjectionObject();var b=new OpenLayers.Projection("WGS84");var e=new OpenLayers.LonLat(this.minxelement.dom.value,this.minyelement.dom.value).transform(b,f);var a=new OpenLayers.LonLat(this.maxxelement.dom.value,this.maxyelement.dom.value).transform(b,f);var d=new OpenLayers.Bounds();d.extend(e);d.extend(a);this.map.zoomToExtent(d);},CLASS_NAME:"GeoNetwork.Control.ExtentBox"});