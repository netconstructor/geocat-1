Ext.namespace("Ext.ux.form");Ext.ux.form.TwinTriggerComboBox=function(b){Ext.ux.form.TwinTriggerComboBox.superclass.constructor.apply(this,arguments);};Ext.extend(Ext.ux.form.TwinTriggerComboBox,Ext.form.ComboBox,{trigger1Class:"x-form-clear-trigger",trigger2Class:"",trigger3Class:"x-form-trigger3-trigger",hideTrigger1:true,tooltipType:"qtip",initComponent:function(){Ext.ux.form.TwinTriggerComboBox.superclass.initComponent.call(this);this.addEvents({clear:true,trigger3:true});this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger2Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger3Class}]};},getTrigger:function(b){return this.triggers[b];},initTrigger:function(){var m=this.trigger.select(".x-form-trigger",true);var j=this;m.each(function(d,a,e){d.hide=function(){var f=j.wrap.getWidth();this.dom.style.display="none";j.el.setWidth(f-j.trigger.getWidth());};d.show=function(){var f=j.wrap.getWidth();this.dom.style.display="";j.el.setWidth(f-j.trigger.getWidth());};var b="Trigger"+(e+1);if(this["hide"+b]){d.dom.style.display="none";}d.on("click",this["on"+b+"Click"],this,{preventDefault:true});d.addClassOnOver("x-form-trigger-over");d.addClassOnClick("x-form-trigger-click");},this);this.triggers=m.elements;if(this.trigger3TipConfig){var h={target:this.getTrigger(2)};for(var g in this.helpTipConfig){h[g]=this.helpTipConfig[g];}var l=new Ext.ToolTip(h);}if(this.trigger3TipConfig){if(typeof this.trigger3TipConfig=="object"){Ext.QuickTips.register(Ext.apply({target:this.getTrigger(2)},this.trigger3TipConfig));}else{this.getTrigger(2).dom[this.tooltipType]=this.trigger3TipConfig;}}},onTrigger1Click:function(){this.clearValue();this.triggerBlur.defer(50,this);},onTrigger2Click:function(){this.onTriggerClick();},onTrigger3Click:function(){this.fireEvent("trigger3Click",this);},onSelect:function(e,d){Ext.ux.form.TwinTriggerComboBox.superclass.onSelect.apply(this,[e,d]);this.triggers[0].show();},clearValue:function(){Ext.ux.form.TwinTriggerComboBox.superclass.clearValue.call(this);this.triggers[0].hide();this.fireEvent("clear",this);},insert:function(f,e){this.reset();var g=new this.store.recordType(e);g.id=g.data.id;this.store.insert(f,g);this.setValue(g.data.id);this.fireEvent("select",this,g,f);}});Ext.reg("twintriggercombo",Ext.ux.form.TwinTriggerComboBox);
/*!
 * Ext Core Library $version&#xD;&#xA;http://extjs.com/&#xD;&#xA;Copyright(c) 2006-2009, $author.&#xD;&#xA;&#xD;&#xA;The MIT License&#xD;&#xA;&#xD;&#xA;Permission is hereby granted, free of charge, to any person obtaining a copy&#xD;&#xA;of this software and associated documentation files (the &quot;Software&quot;), to deal&#xD;&#xA;in the Software without restriction, including without limitation the rights&#xD;&#xA;to use, copy, modify, merge, publish, distribute, sublicense, and/or sell&#xD;&#xA;copies of the Software, and to permit persons to whom the Software is&#xD;&#xA;furnished to do so, subject to the following conditions:&#xD;&#xA;&#xD;&#xA;The above copyright notice and this permission notice shall be included in&#xD;&#xA;all copies or substantial portions of the Software.&#xD;&#xA;&#xD;&#xA;THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&#xD;&#xA;IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&#xD;&#xA;FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&#xD;&#xA;AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER&#xD;&#xA;LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,&#xD;&#xA;OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN&#xD;&#xA;THE SOFTWARE.&#xD;&#xA;
 */
Ext.ns("Ext.ux");Ext.ux.RatingItem=Ext.extend(Ext.Component,{starWidth:16,resetValue:"",defaultConfig:{defaultSelected:-1,nbStars:5,split:1,selected:-1,showTitles:true,cls:"",disabled:false},constructor:function(g,f){Ext.apply(this,f);Ext.applyIf(this,this.defaultConfig);Ext.ux.RatingItem.superclass.constructor.call(this);this.addEvents("change","reset");if(g==undefined){g=document.createElement("div");g.className=this.itemCls;this.text="";for(var e=0;e<(this.nbStars*this.split);e++){this.text+='<input type="radio" name="rating'+this.id+'" value="'+(e+1)/this.split+'" '+((e+1)/this.split==this.defaultSelected?' checked="true"':"")+'"/>';}g.innerHTML=this.text;}this.el=Ext.get(g);this.init();},onRender:function(){Ext.ux.RatingItem.superclass.onRender.apply(this,arguments);},init:function(){var b=this.disabled;this.values=[];this.titles=[];this.stars=[];this.container=this.el.createChild({cls:"ux-rating-container ux-rating-clearfix"+this.cls});if(this.canReset){this.resetEl=this.container.createChild({cls:"ux-rating-reset",cn:[{tag:"a",title:this.showTitles?(this.resetTitle||"Reset your vote"):"",html:"Reset"}]});this.resetEl.visibilityMode=Ext.Element.DISPLAY;this.resetEl.hover(function(){Ext.fly(this).addClass("ux-rating-reset-hover");},function(){Ext.fly(this).removeClass("ux-rating-reset-hover");});this.resetEl.on("click",this.reset,this);}this.radioBoxes=this.el.select("input[type=radio]");this.radioBoxes.each(this.initStar,this);this.input=this.container.createChild({tag:"input",type:"hidden",name:this.name,value:this.values[this.defaultSelected]||this.resetValue});this.radioBoxes.remove();this.select(this.defaultSelected===undefined?false:this.defaultSelected);if(b){this.disable();}else{this.enable();}},initStar:function(r,s,j){var l=Math.floor(this.starWidth/this.split);if(j==0){this.name=r.dom.name;this.disabled=r.dom.disabled;}this.values[j]=r.dom.value;this.titles[j]=r.dom.title;if(r.dom.checked){this.defaultSelected=j;}var m=this.container.createChild({cls:"ux-rating-star"});var o=m.createChild({tag:"a",html:this.values[j],title:this.showTitles?this.titles[j]:""});if(this.split){var q=(j%this.split);m.setWidth(l);o.setStyle("margin-left","-"+(q*l)+"px");}this.stars.push(m.dom);},onStarClick:function(d,e){if(!this.disabled){this.select(this.stars.indexOf(e));}},onStarOver:function(d,e){if(!this.disabled){this.fillTo(this.stars.indexOf(e),true);}},onStarOut:function(d,e){if(!this.disabled){this.fillTo(this.selected,false);}},reset:function(d,e){this.select(-1);},select:function(b){if(b===false||b===-1){this.value=this.resetValue;this.title="";this.input.dom.value="";if(this.canReset){this.resetEl.setOpacity(0.5);}this.fillNone();if(this.selected!==-1){this.fireEvent("change",this,this.values[b],this.stars[b]);}this.selected=-1;}else{if(b!==this.selected){this.selected=b;this.value=this.values[b];this.title=this.titles[b];this.input.dom.value=this.value;if(this.canReset){this.resetEl.setOpacity(0.99);}this.fillTo(b,false);this.fireEvent("change",this,this.values[b],this.stars[b]);}}},fillTo:function(g,f){if(g!=-1){var j=f?"ux-rating-star-hover":"ux-rating-star-on";var h=f?"ux-rating-star-on":"ux-rating-star-hover";Ext.each(this.stars.slice(0,g+1),function(){Ext.fly(this).removeClass(h).addClass(j);});Ext.each(this.stars.slice(g+1),function(){Ext.fly(this).removeClass([h,j]);});}else{this.fillNone();}},fillNone:function(){this.container.select(".ux-rating-star").removeClass(["ux-rating-star-hover","ux-rating-star-on"]);},enable:function(){if(this.canReset){this.resetEl.show();}this.input.dom.disabled=null;this.disabled=false;this.container.removeClass("ux-rating-disabled");this.container.on({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"});},disable:function(){if(this.canReset){this.resetEl.hide();}this.input.dom.disabled=true;this.disabled=true;this.container.addClass("ux-rating-disabled");this.container.un({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"});},getValue:function(){return this.values[this.selected]||this.resetValue;},destroy:function(){this.disable();
this.container.remove();this.radioBoxes.appendTo(this.el);if(this.selected!==-1){this.radioBoxes.elements[this.selected].checked=true;}}});Ext.reg("ratingitem",Ext.ux.RatingItem);Ext.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected");},onRender:function(g,f){Ext.form.FileUploadField.superclass.onRender.call(this,g,f);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1});var e=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(e,{renderTo:this.wrap,cls:"x-form-file-btn"+(e.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth());}this.fileInput.on("change",function(){var a=this.fileInput.dom.value;this.setValue(a);this.fireEvent("fileselected",this,a);},this);},getFileInputId:function(){return this.id+"-file";},onResize:function(e,d){Ext.form.FileUploadField.superclass.onResize.call(this,e,d);this.wrap.setWidth(e);if(!this.buttonOnly){var e=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(e);}},preFocus:Ext.emptyFn,getResizeEl:function(){return this.wrap;},getPositionEl:function(){return this.wrap;},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0]);}});Ext.reg("fileuploadfield",Ext.form.FileUploadField);Ext.ns("Ext.ux.form");Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"input",type:"hidden"},timeWidth:100,dtSeparator:" ",hiddenFormat:"Y-m-d H:i:s",otherToNow:true,timePosition:"right",dateFormat:"m/d/y",timeFormat:"g:i A",initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);var d=Ext.apply({},{id:this.id+"-date",format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(d);this.df.ownerCt=this;delete (this.dateFormat);var e=Ext.apply({},{id:this.id+"-time",format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(e);this.tf.ownerCt=this;delete (this.timeFormat);this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);this.relayEvents(this.tf,["focus","specialkey","invalid","valid"]);},onRender:function(j,g){if(this.isRendered){return;}Ext.ux.form.DateTime.superclass.onRender.call(this,j,g);var f;if("below"===this.timePosition||"bellow"===this.timePosition){f=Ext.DomHelper.append(j,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",cls:"ux-datetime-time"}]}]},true);}else{f=Ext.DomHelper.append(j,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:4px",cls:"ux-datetime-date"},{tag:"td",cls:"ux-datetime-time"}]}]},true);}this.tableEl=f;this.wrap=f.wrap({cls:"x-form-field-wrap"});this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(f.child("td.ux-datetime-date"));this.tf.render(f.child("td.ux-datetime-time"));if(Ext.isIE&&Ext.isStrict){f.select("input").applyStyles({top:0});}this.on("specialkey",this.onSpecialKey,this);this.df.el.swallowEvent(["keydown","keypress"]);this.tf.el.swallowEvent(["keydown","keypress"]);if("side"===this.msgTarget){var h=this.el.findParent(".x-form-element",10,true);this.errorIcon=h.createChild({cls:"x-form-invalid-icon"});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon;}this.el.dom.name=this.hiddenName||this.name||this.id;this.df.el.dom.removeAttribute("name");this.tf.el.dom.removeAttribute("name");this.isRendered=true;this.updateHidden();},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0]);},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0);},clearInvalid:function(){this.df.clearInvalid();this.tf.clearInvalid();},markInvalid:function(b){this.df.markInvalid(b);this.tf.markInvalid(b);},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.df.destroy();this.tf.destroy();}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable();}this.disabled=true;this.df.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this;},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable();}this.disabled=false;this.df.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this;},focus:function(){this.df.focus();},getPositionEl:function(){return this.wrap;},getResizeEl:function(){return this.wrap;},getValue:function(){return this.dateValue?new Date(this.dateValue):"";},isValid:function(){return this.df.isValid()&&this.tf.isValid();},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible();},onBlur:function(b){if(this.wrapClick){b.focus();this.wrapClick=false;}if(b===this.df){this.updateDate();}else{this.updateTime();}this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var a=this.getValue();if(String(a)!==String(this.startValue)){this.fireEvent("change",this,a,this.startValue);}this.hasFocus=false;this.fireEvent("blur",this);}}).defer(100,this);},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this);}},onMouseDown:function(b){if(!this.disabled){this.wrapClick="td"===b.target.nodeName.toLowerCase();}},onSpecialKey:function(e,g){var f=g.getKey();if(f===g.TAB){if(e===this.df&&!g.shiftKey){g.stopEvent();this.tf.focus();}if(e===this.tf&&g.shiftKey){g.stopEvent();this.df.focus();}}if(f===g.ENTER){this.updateValue();}},setDate:function(b){this.df.setValue(b);},setTime:function(b){this.tf.setValue(b);},setSize:function(e,d){if(!e){return;}if("below"===this.timePosition){this.df.setSize(e,d);this.tf.setSize(e,d);if(Ext.isIE){this.df.el.up("td").setWidth(e);this.tf.el.up("td").setWidth(e);}}else{this.df.setSize(e-this.timeWidth-4,d);this.tf.setSize(this.timeWidth,d);if(Ext.isIE){this.df.el.up("td").setWidth(e-this.timeWidth-4);this.tf.el.up("td").setWidth(this.timeWidth);}}},setValue:function(g){if(!g&&true===this.emptyToNow){this.setValue(new Date());return;}else{if(!g){this.setDate("");this.setTime("");this.updateValue();return;}}if("number"===typeof g){g=new Date(g);}else{if("string"===typeof g&&this.hiddenFormat){g=Date.parseDate(g,this.hiddenFormat);}}g=g?g:new Date(1970,0,1,0,0,0);var f,e;if(g instanceof Date){this.setDate(g);this.setTime(g);this.dateValue=new Date(g);}else{f=g.split(this.dtSeparator);this.setDate(f[0]);if(f[1]){if(f[2]){f[1]+=f[2];}this.setTime(f[1]);}}this.updateValue();},setVisible:function(b){if(b){this.df.show();this.tf.show();}else{this.df.hide();this.tf.hide();}return this;},show:function(){return this.setVisible(true);},hide:function(){return this.setVisible(false);},updateDate:function(){var b=this.df.getValue();if(b){if(!(this.dateValue instanceof Date)){this.initDateValue();if(!this.tf.getValue()){this.setTime(this.dateValue);}}this.dateValue.setMonth(0);this.dateValue.setFullYear(b.getFullYear());this.dateValue.setMonth(b.getMonth(),b.getDate());}else{this.dateValue="";this.setTime("");}},updateTime:function(){var b=this.tf.getValue();if(b&&!(b instanceof Date)){b=Date.parseDate(b,this.tf.format);}if(b&&!this.df.getValue()){this.initDateValue();
this.setDate(this.dateValue);}if(this.dateValue instanceof Date){if(b){this.dateValue.setHours(b.getHours());this.dateValue.setMinutes(b.getMinutes());this.dateValue.setSeconds(b.getSeconds());}else{this.dateValue.setHours(0);this.dateValue.setMinutes(0);this.dateValue.setSeconds(0);}}},updateHidden:function(){if(this.isRendered){var b=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):"";this.el.dom.value=b;}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return;},validate:function(){return this.df.validate()&&this.tf.validate();},renderer:function(g){var e=g.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;e+=" "+(g.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);var f=function(a){var b=Ext.util.Format.date(a,e);return b;};return f;}});Ext.reg("xdatetime",Ext.ux.form.DateTime);
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(b){Ext.apply(this,b);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl);}this.tpl.compile();}this.state={};this.bodyContent={};},getRowClass:function(h,j,l,m){l.cols=l.cols-1;var g=this.bodyContent[h.id];if(!g&&!this.lazyRender){g=this.getBodyContent(h,j);}if(g){l.body=g;}return this.state[h.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed";},init:function(d){this.grid=d;var e=d.getView();e.getRowClass=this.getRowClass.createDelegate(this);e.enableRowBody=true;d.on("render",this.onRender,this);d.on("destroy",this.onDestroy,this);},onRender:function(){var e=this.grid;var d=e.getView().mainBody;d.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this});}if(this.expandOnDblClick){e.on("rowdblclick",this.onRowDblClick,this);}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav;}var b=this.grid.getView().mainBody;if(b){b.un("mousedown",this.onMouseDown,this);}},onRowDblClick:function(f,e,g){this.toggleRow(e);},onEnter:function(o){var q=this.grid;var m=q.getSelectionModel();var e=m.getSelections();for(var s=0,g=e.length;s<g;s++){var r=q.getStore().indexOf(e[s]);this.toggleRow(r);}},getBodyContent:function(f,e){if(!this.enableCaching){return this.tpl.apply(f.data);}var g=this.bodyContent[f.id];if(!g){g=this.tpl.apply(f.data);this.bodyContent[f.id]=g;}return g;},onMouseDown:function(e,f){e.stopEvent();var g=e.getTarget(".x-grid3-row");this.toggleRow(g);},renderer:function(e,g,f){g.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>';},beforeExpand:function(e,f,g){if(this.fireEvent("beforeexpand",this,e,f,g)!==false){if(this.tpl&&this.lazyRender){f.innerHTML=this.getBodyContent(e,g);}return true;}else{return false;}},toggleRow:function(b){if(typeof b=="number"){b=this.grid.view.getRow(b);}this[Ext.fly(b).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](b);},expandRow:function(g){if(typeof g=="number"){g=this.grid.view.getRow(g);}var e=this.grid.store.getAt(g.rowIndex);var f=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",g);if(this.beforeExpand(e,f,g.rowIndex)){this.state[e.id]=true;Ext.fly(g).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,e,f,g.rowIndex);}},collapseRow:function(g){if(typeof g=="number"){g=this.grid.view.getRow(g);}var e=this.grid.store.getAt(g.rowIndex);var f=Ext.fly(g).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,e,f,g.rowIndex)!==false){this.state[e.id]=false;Ext.fly(g).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,e,f,g.rowIndex);}}});Ext.preg("rowexpander",Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;Array.prototype.contains=function(b){return this.indexOf(b)!==-1;};Ext.namespace("Ext.ux");Ext.ux.DDView=function(d){if(!d.itemSelector){var e=d.tpl;if(this.classRe.test(e)){d.tpl=e.replace(this.classRe,"class=$1x-combo-list-item $2$1");}else{d.tpl=e.replace(this.tagRe,'$1 class="x-combo-list-item" $2');}d.itemSelector=".x-combo-list-item";}Ext.ux.DDView.superclass.constructor.call(this,Ext.apply(d,{border:false}));};Ext.extend(Ext.ux.DDView,Ext.DataView,{sortDir:"ASC",isFormField:true,classRe:/class=(['"])(.*)\1/,tagRe:/(<\w*)(.*?>)/,reset:Ext.emptyFn,clearInvalid:Ext.form.Field.prototype.clearInvalid,msgTarget:"qtip",afterRender:function(){Ext.ux.DDView.superclass.afterRender.call(this);if(this.dragGroup){this.setDraggable(this.dragGroup.split(","));}if(this.dropGroup){this.setDroppable(this.dropGroup.split(","));}if(this.deletable){this.setDeletable();}this.isDirtyFlag=false;this.addEvents("drop");},validate:function(){return true;},destroy:function(){this.purgeListeners();this.getEl().removeAllListeners();this.getEl().remove();if(this.dragZone){if(this.dragZone.destroy){this.dragZone.destroy();}}if(this.dropZone){if(this.dropZone.destroy){this.dropZone.destroy();}}},getName:function(){return this.name;},setValue:function(e){if(!this.store){throw"DDView.setValue(). DDView must be constructed with a valid Store";}var d={};d[this.store.reader.meta.root]=e?[].concat(e):[];this.store.proxy=new Ext.data.MemoryProxy(d);this.store.load();},getValue:function(){var b="(";this.store.each(function(a){b+=a.id+",";});return b.substr(0,b.length-1)+")";},getIds:function(){var d=0,e=new Array(this.store.getCount());this.store.each(function(a){e[d++]=a.id;});return e;},isDirty:function(){return this.isDirtyFlag;},getTargetFromEvent:function(d){var e=d.getTarget();while((e!==null)&&(e.parentNode!=this.el.dom)){e=e.parentNode;}if(!e){e=this.el.dom.lastChild||this.el.dom;}return e;},getDragData:function(l){var m=this.findItemFromChild(l.getTarget());if(m){if(!this.isSelected(m)){delete this.ignoreNextClick;this.onItemClick(m,this.indexOf(m),l);this.ignoreNextClick=true;}var e={sourceView:this,viewNodes:[],records:[],copy:this.copy||(this.allowCopy&&l.ctrlKey)};if(this.getSelectionCount()==1){var h=this.getSelectedIndexes()[0];var j=this.getNode(h);e.viewNodes.push(e.ddel=j);e.records.push(this.store.getAt(h));e.repairXY=Ext.fly(j).getXY();}else{e.ddel=document.createElement("div");e.ddel.className="multi-proxy";this.collectSelection(e);}return e;}return false;},getRepairXY:function(b){return this.dragData.repairXY;},collectSelection:function(d){d.repairXY=Ext.fly(this.getSelectedNodes()[0]).getXY();if(this.preserveSelectionOrder===true){Ext.each(this.getSelectedIndexes(),function(g){var a=this.getNode(g);var b=a.cloneNode(true);b.id=Ext.id();d.ddel.appendChild(b);d.records.push(this.store.getAt(g));d.viewNodes.push(a);},this);}else{var e=0;this.store.each(function(b){if(this.isSelected(e)){var a=this.getNode(e);var g=a.cloneNode(true);g.id=Ext.id();d.ddel.appendChild(g);d.records.push(this.store.getAt(e));d.viewNodes.push(a);}e++;},this);}},setDraggable:function(b){if(b instanceof Array){Ext.each(b,this.setDraggable,this);return;}if(this.dragZone){this.dragZone.addToGroup(b);}else{this.dragZone=new Ext.dd.DragZone(this.getEl(),{containerScroll:true,ddGroup:b});if(!this.multiSelect){this.singleSelect=true;}this.dragZone.getDragData=this.getDragData.createDelegate(this);this.dragZone.getRepairXY=this.getRepairXY;this.dragZone.onEndDrag=this.onEndDrag;}},setDroppable:function(b){if(b instanceof Array){Ext.each(b,this.setDroppable,this);return;}if(this.dropZone){this.dropZone.addToGroup(b);}else{this.dropZone=new Ext.dd.DropZone(this.getEl(),{owningView:this,containerScroll:true,ddGroup:b});this.dropZone.getTargetFromEvent=this.getTargetFromEvent.createDelegate(this);
this.dropZone.onNodeEnter=this.onNodeEnter.createDelegate(this);this.dropZone.onNodeOver=this.onNodeOver.createDelegate(this);this.dropZone.onNodeOut=this.onNodeOut.createDelegate(this);this.dropZone.onNodeDrop=this.onNodeDrop.createDelegate(this);}},getDropPoint:function(q,e,s){if(e==this.el.dom){return"above";}var r=Ext.lib.Dom.getY(e),b=r+e.offsetHeight;var m=r+(b-r)/2;var o=Ext.lib.Event.getPageY(q);if(o<=m){return"above";}else{return"below";}},isValidDropPoint:function(d,h,g){if(!g.viewNodes||(g.viewNodes.length!=1)){return true;}var j=g.viewNodes[0];if(j==h){return false;}if((d=="below")&&(h.nextSibling==j)){return false;}if((d=="above")&&(h.previousSibling==j)){return false;}return true;},onNodeEnter:function(h,g,j,e){if(this.highlightColor&&(e.sourceView!=this)){this.el.highlight(this.highlightColor);}return false;},onNodeOver:function(m,l,o,r){var e=this.dropNotAllowed;var q=this.getDropPoint(o,m,l);if(this.isValidDropPoint(q,m,r)){if(this.appendOnly||this.sortField){return"x-tree-drop-ok-below";}if(q){var s;if(q=="above"){e=m.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";s="x-view-drag-insert-above";}else{e=m.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";s="x-view-drag-insert-below";}if(this.lastInsertClass!=s){Ext.fly(m).replaceClass(this.lastInsertClass,s);this.lastInsertClass=s;}}}return e;},onNodeOut:function(h,g,j,e){this.removeDropIndicators(h);},onNodeDrop:function(w,q,s,u){if(this.fireEvent("drop",this,w,q,s,u)===false){return false;}var e=this.getDropPoint(s,w,q);var v=(this.appendOnly||(w==this.el.dom))?this.store.getCount():w.viewIndex;if(e=="below"){v++;}if(u.sourceView==this){if(e=="below"){if(u.viewNodes[0]==w){u.viewNodes.shift();}}else{if(u.viewNodes[u.viewNodes.length-1]==w){u.viewNodes.pop();}}if(!u.viewNodes.length){return false;}if(v>this.store.indexOf(u.records[0])){v--;}}if(u.node instanceof Ext.tree.TreeNode){var B=u.node.getOwnerTree().recordFromNode(u.node);if(B){u.records=[B];}}if(!u.records){alert("Programming problem. Drag data contained no Records");return false;}for(var t=0;t<u.records.length;t++){var B=u.records[t];var z=this.store.getById(B.id);if(z&&(q!=this.dragZone)){if(!this.allowDup&&!this.allowTrash){Ext.fly(this.getNode(this.store.indexOf(z))).frame("red",1);return true;}var r=new Ext.data.Record();B.id=r.id;delete r;}if(u.copy){this.store.insert(v++,B.copy());}else{if(u.sourceView){u.sourceView.isDirtyFlag=true;u.sourceView.store.remove(B);}if(!this.allowTrash){this.store.insert(v++,B);}}if(this.sortField){this.store.sort(this.sortField,this.sortDir);}this.isDirtyFlag=true;}this.dragZone.cachedTarget=null;return true;},onEndDrag:function(e,d){var g=Ext.get(this.dragData.ddel);if(g&&g.hasClass("multi-proxy")){g.remove();}},removeDropIndicators:function(b){if(b){Ext.fly(b).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass";}},setDeletable:function(e){if(!this.singleSelect&&!this.multiSelect){this.singleSelect=true;}var d=this.getContextMenu();this.contextMenu.on("itemclick",function(a){switch(a.id){case"delete":this.remove(this.getSelectedIndexes());break;}},this);this.contextMenu.add({icon:e||AU.resolveUrl("/images/delete.gif"),id:"delete",text:AU.getMessage("deleteItem")});},getContextMenu:function(){if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({id:this.id+"-contextmenu"});this.el.on("contextmenu",this.showContextMenu,this);}return this.contextMenu;},disableContextMenu:function(){if(this.contextMenu){this.el.un("contextmenu",this.showContextMenu,this);}},showContextMenu:function(d,e){e=this.findItemFromChild(d.getTarget());if(e){d.stopEvent();this.select(this.getNode(e),this.multiSelect&&d.ctrlKey,true);this.contextMenu.showAt(d.getXY());}},remove:function(e){e=[].concat(e);for(var f=0;f<e.length;f++){var g=this.store.getAt(e[f]);this.store.remove(g);}},onDblClick:function(j){var l=this.findItemFromChild(j.getTarget());if(l){if(this.fireEvent("dblclick",this,this.indexOf(l),l,j)===false){return false;}if(this.dragGroup){var h=Ext.dd.DragDropMgr.getRelated(this.dragZone,true);while(h.contains(this.dropZone)){h.remove(this.dropZone);}if((h.length==1)&&(h[0].owningView)){this.dragZone.cachedTarget=null;var e=Ext.get(h[0].getEl());var m=e.getBox(true);h[0].onNodeDrop(e.dom,{target:e.dom,xy:[m.x,m.y+m.height-1]},null,this.getDragData(j));}}}},onItemClick:function(e,f,g){if(this.ignoreNextClick){delete this.ignoreNextClick;return;}if(this.fireEvent("beforeclick",this,f,e,g)===false){return false;}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&g.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),f),false);}else{if(this.isSelected(e)&&g.ctrlKey){this.deselect(e);}else{this.deselect(e);this.select(e,this.multiSelect&&g.ctrlKey);this.lastSelection=e;}}g.preventDefault();}return true;}});Ext.ux.Multiselect=Ext.extend(Ext.form.Field,{store:null,dataFields:[],data:[],width:100,height:100,displayField:0,valueField:1,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",copy:false,allowDup:false,allowTrash:false,legend:null,focusClass:undefined,delimiter:",",view:null,dragGroup:null,dropGroup:null,tbar:null,appendOnly:false,sortField:null,sortDir:"ASC",defaultAutoCreate:{tag:"div"},tpl:null,initComponent:function(){Ext.ux.Multiselect.superclass.initComponent.call(this);this.addEvents({dblclick:true,click:true,change:true,drop:true});},onRender:function(m,h){var j,q,o;Ext.ux.Multiselect.superclass.onRender.call(this,m,h);q="ux-mselect";j=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:1px;",tbar:this.tbar});if(!this.legend){j.el.down("."+j.headerCls).remove();}j.body.addClass(q);if(!this.tpl){o='<tpl for="."><div class="'+q+"-item";if(Ext.isIE||Ext.isIE7){o+='" unselectable=on';}else{o+=' x-unselectable"';}o+=">{"+this.displayField+"}</div></tpl>";this.tpl=o;}if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data});}this.view=new Ext.ux.DDView({multiSelect:true,store:this.store,selectedClass:q+"-selected",tpl:this.tpl,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+q+"-item",isFormField:false,applyTo:j.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});j.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeClick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.view.on("drop",function(d,f,e,a,b){return this.fireEvent("drop",d,f,e,a,b);},this);this.hiddenName=this.name;var l={tag:"input",type:"hidden",value:"",name:this.name};if(this.isFormField){this.hiddenField=this.el.createChild(l);}else{this.hiddenField=Ext.get(document.body).createChild(l);}j.doLayout();},initValue:Ext.emptyFn,onViewClick:function(l,e,m,j){var h=this.preClickSelections.indexOf(e);if(h!=-1){this.preClickSelections.splice(h,1);this.view.clearSelections(true);this.view.select(this.preClickSelections);}this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,j);this.validate();},onViewBeforeClick:function(j,g,e,h){this.preClickSelections=this.view.getSelectedIndexes();if(this.disabled){return false;}},onViewDblClick:function(j,g,e,h){return this.fireEvent("dblclick",j,g,e,h);},getValue:function(g){var h=[];var j=this.view.getSelectedIndexes();if(j.length==0){return"";}for(var f=0;f<j.length;f++){h.push(this.store.getAt(j[f]).get(((g!=null)?g:this.valueField)));}return h.join(this.delimiter);},setValue:function(g){var f;var h=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!g||(g=="")){return;}if(!(g instanceof Array)){g=g.split(this.delimiter);}for(var j=0;
j<g.length;j++){f=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+g[j]+"$","i")).itemAt(0));h.push(f);}this.view.select(h);this.hiddenField.dom.value=this.getValue();this.validate();},selectAll:function(){var d=[];for(var e=0;e<this.view.store.getCount();e++){d.push(e);}this.view.select(d);this.hiddenField.dom.value=this.getValue();this.validate();},reset:function(){this.setValue("");},getRawValue:function(e){var d=this.getValue(e);if(d.length){d=d.split(this.delimiter);}else{d=[];}return d;},setRawValue:function(b){setValue(b);},validateValue:function(b){if(b.length<1){if(this.allowBlank){this.clearInvalid();return true;}else{this.markInvalid(this.blankText);return false;}}if(b.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false;}if(b.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false;}return true;}});Ext.reg("multiselect",Ext.ux.Multiselect);Ext.ux.ItemSelector=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,fromAllowDup:false,toAllowDup:false,fromAllowTrash:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},fromTpl:null,toTpl:null,initComponent:function(){Ext.ux.ItemSelector.superclass.initComponent.call(this);this.addEvents({rowdblclick:true,change:true});},onRender:function(r,l){Ext.ux.ItemSelector.superclass.onRender.call(this,r,l);this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.fromAllowDup,copy:this.fromAllowDup,allowTrash:this.fromAllowTrash,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir,tpl:this.fromTpl});this.fromMultiselect.on("dblclick",this.onRowDblClick,this);if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData});}this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.toAllowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.fromSortField,sortDir:this.fromSortDir,tpl:this.toTpl});this.toMultiselect.on("dblclick",this.onRowDblClick,this);var m=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});m.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);var s=new Ext.Panel({header:false});m.add(s);m.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);m.render(this.el);s.el.down("."+s.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/";}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var o=s.getEl();if(!this.toSortField){this.toTopIcon=o.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});o.createChild({tag:"br"});this.upIcon=o.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});o.createChild({tag:"br"});}this.addIcon=o.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});o.createChild({tag:"br"});this.removeIcon=o.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});o.createChild({tag:"br"});if(!this.toSortField){this.downIcon=o.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});o.createChild({tag:"br"});this.toBottomIcon=o.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}});}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this);}this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this);}if((!this.drawUpIcon||this.hideNavIcons)&&this.upIcon){this.upIcon.dom.style.display="none";}if((!this.drawDownIcon||this.hideNavIcons)&&this.downIcon){this.downIcon.dom.style.display="none";}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none";}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none";}if((!this.drawTopIcon||this.hideNavIcons)&&this.toTopIcon){this.toTopIcon.dom.style.display="none";}if((!this.drawBotIcon||this.hideNavIcons)&&this.toBottomIcon){this.toBottomIcon.dom.style.display="none";}var j=m.body.first();this.el.setWidth(m.body.first().getWidth());m.body.removeClass();this.hiddenName=this.name;var q={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(q);this.valueChanged(this.toStore);},initValue:Ext.emptyFn,toTop:function(){var g=this.toMultiselect.view.getSelectedIndexes();var f=[];if(g.length>0){g.sort();for(var e=0;e<g.length;e++){record=this.toMultiselect.view.store.getAt(g[e]);f.push(record);}g=[];for(var e=f.length-1;e>-1;e--){record=f[e];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);g.push(((f.length-1)-e));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(g);},toBottom:function(){var g=this.toMultiselect.view.getSelectedIndexes();var f=[];if(g.length>0){g.sort();for(var e=0;e<g.length;e++){record=this.toMultiselect.view.store.getAt(g[e]);f.push(record);}g=[];for(var e=0;e<f.length;e++){record=f[e];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);g.push((this.toMultiselect.view.store.getCount())-(f.length-e));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(g);},up:function(){var g=null;var j=this.toMultiselect.view.getSelectedIndexes();j.sort();var h=[];if(j.length>0){for(var f=0;f<j.length;f++){g=this.toMultiselect.view.store.getAt(j[f]);if((j[f]-1)>=0){this.toMultiselect.view.store.remove(g);this.toMultiselect.view.store.insert(j[f]-1,g);h.push(j[f]-1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(h);}},down:function(){var g=null;var j=this.toMultiselect.view.getSelectedIndexes();j.sort();j.reverse();var h=[];if(j.length>0){for(var f=0;f<j.length;f++){g=this.toMultiselect.view.store.getAt(j[f]);if((j[f]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(g);this.toMultiselect.view.store.insert(j[f]+1,g);h.push(j[f]+1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(h);}},fromTo:function(){var h=this.fromMultiselect.view.getSelectedIndexes();var f=[];if(h.length>0){for(var j=0;j<h.length;j++){record=this.fromMultiselect.view.store.getAt(h[j]);
f.push(record);}if(!this.toAllowDup){h=[];}for(var j=0;j<f.length;j++){record=f[j];if(this.toAllowDup){var g=new Ext.data.Record();record.id=g.id;delete g;this.toMultiselect.view.store.add(record);}else{if(this.fromAllowTrash){this.fromMultiselect.view.store.remove(record);}this.toMultiselect.view.store.add(record);h.push((this.toMultiselect.view.store.getCount()-1));}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir);}if(this.toAllowDup){this.fromMultiselect.view.select(h);}else{this.toMultiselect.view.select(h);}},toFrom:function(){var g=this.toMultiselect.view.getSelectedIndexes();var f=[];if(g.length>0){for(var e=0;e<g.length;e++){record=this.toMultiselect.view.store.getAt(g[e]);f.push(record);}g=[];for(var e=0;e<f.length;e++){record=f[e];this.toMultiselect.view.store.remove(record);if(!this.fromAllowDup){this.fromMultiselect.view.store.add(record);g.push((this.fromMultiselect.view.store.getCount()-1));}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir);}this.fromMultiselect.view.select(g);},valueChanged:function(j){var g=null;var f=[];for(var h=0;h<j.getCount();h++){g=j.getAt(h);f.push(g.get(this.valueField));}this.hiddenField.dom.value=f.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);},getValue:function(){return this.hiddenField.dom.value;},onRowDblClick:function(j,g,e,h){return this.fireEvent("rowdblclick",j,g,e,h);},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();if(!this.fromAllowDup){this.fromMultiselect.store.add(range);this.fromMultiselect.store.sort(this.displayField,"ASC");}this.valueChanged(this.toMultiselect.store);}});Ext.reg("itemselector",Ext.ux.ItemSelector);
/*!
 * Ext Core Library $version&#xD;&#xA;http://extjs.com/&#xD;&#xA;Copyright(c) 2006-2009, $author.&#xD;&#xA;&#xD;&#xA;The MIT License&#xD;&#xA;&#xD;&#xA;Permission is hereby granted, free of charge, to any person obtaining a copy&#xD;&#xA;of this software and associated documentation files (the &quot;Software&quot;), to deal&#xD;&#xA;in the Software without restriction, including without limitation the rights&#xD;&#xA;to use, copy, modify, merge, publish, distribute, sublicense, and/or sell&#xD;&#xA;copies of the Software, and to permit persons to whom the Software is&#xD;&#xA;furnished to do so, subject to the following conditions:&#xD;&#xA;&#xD;&#xA;The above copyright notice and this permission notice shall be included in&#xD;&#xA;all copies or substantial portions of the Software.&#xD;&#xA;&#xD;&#xA;THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&#xD;&#xA;IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&#xD;&#xA;FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&#xD;&#xA;AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER&#xD;&#xA;LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,&#xD;&#xA;OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN&#xD;&#xA;THE SOFTWARE.&#xD;&#xA;
 */
Ext.ns("Ext.ux");Ext.ux.Lightbox=(function(){var m={},h=[],l,j=false,g=[];return{overlayOpacity:0.85,animate:true,resizeSpeed:8,borderSize:10,labelImage:"Image",labelOf:"of",init:function(){this.resizeDuration=this.animate?((11-this.resizeSpeed)*0.15):0;this.overlayDuration=this.animate?0.2:0;if(!j){Ext.apply(this,Ext.util.Observable.prototype);Ext.util.Observable.constructor.call(this);this.addEvents("open","close");this.initMarkup();this.initEvents();j=true;}},initMarkup:function(){m.shim=Ext.DomHelper.append(document.body,{tag:"iframe",id:"ux-lightbox-shim"},true);m.overlay=Ext.DomHelper.append(document.body,{id:"ux-lightbox-overlay"},true);var b=new Ext.Template(this.getTemplate());m.lightbox=b.append(document.body,{},true);var a=["outerImageContainer","imageContainer","image","hoverNav","navPrev","navNext","loading","loadingLink","outerDataContainer","dataContainer","data","details","caption","imageNumber","bottomNav","navClose"];Ext.each(a,function(e){m[e]=Ext.get("ux-lightbox-"+e);});Ext.each([m.overlay,m.lightbox,m.shim],function(e){e.setVisibilityMode(Ext.Element.DISPLAY);e.hide();});var d=(this.animate?250:1)+"px";m.outerImageContainer.setStyle({width:d,height:d});},getTemplate:function(){return['<div id="ux-lightbox">','<div id="ux-lightbox-outerImageContainer">','<div id="ux-lightbox-imageContainer">','<img id="ux-lightbox-image">','<div id="ux-lightbox-hoverNav">','<a href="#" id="ux-lightbox-navPrev"></a>','<a href="#" id="ux-lightbox-navNext"></a>',"</div>",'<div id="ux-lightbox-loading">','<a id="ux-lightbox-loadingLink"></a>',"</div>","</div>","</div>",'<div id="ux-lightbox-outerDataContainer">','<div id="ux-lightbox-dataContainer">','<div id="ux-lightbox-data">','<div id="ux-lightbox-details">','<span id="ux-lightbox-caption"></span>','<span id="ux-lightbox-imageNumber"></span>',"</div>",'<div id="ux-lightbox-bottomNav">','<a href="#" id="ux-lightbox-navClose"></a>',"</div>","</div>","</div>","</div>","</div>"];},initEvents:function(){var a=function(b){b.preventDefault();this.close();};m.overlay.on("click",a,this);m.loadingLink.on("click",a,this);m.navClose.on("click",a,this);m.lightbox.on("click",function(b){if(b.getTarget().id=="ux-lightbox"){this.close();}},this);m.navPrev.on("click",function(b){b.preventDefault();this.setImage(l-1);},this);m.navNext.on("click",function(b){b.preventDefault();this.setImage(l+1);},this);},register:function(b,a){if(g.indexOf(b)===-1){g.push(b);Ext.fly(document).on("click",function(e){var d=e.getTarget(b);if(d){e.preventDefault();this.open(d,b,a);}},this);}},open:function(a,d,b){b=b||false;this.setViewSize();m.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,callback:function(){h=[];var f=0;if(!b){h.push([a.href,a.title]);}else{var e=Ext.query(d);Ext.each(e,function(o){if(o.href){h.push([o.href,o.title]);}});while(h[f][0]!=a.href){f++;}}var t=Ext.fly(document).getScroll();var s=t.top+(Ext.lib.Dom.getViewportHeight()/10);var u=t.left;m.lightbox.setStyle({top:s+"px",left:u+"px"}).show();this.setImage(f);this.fireEvent("open",h[f]);},scope:this});},setViewSize:function(){var a=this.getViewSize(),b=this.getDocumentSize();m.overlay.setStyle({width:b[0]+"px",height:b[1]+"px"});m.shim.setStyle({width:a[0]+"px",height:a[1]+"px"}).show();},setImage:function(a){l=a;this.disableKeyNav();if(this.animate){m.loading.show();}m.image.hide();m.hoverNav.hide();m.navPrev.hide();m.navNext.hide();m.dataContainer.setOpacity(0.0001);m.imageNumber.hide();var b=new Image();b.onload=(function(){m.image.dom.src=h[l][0];this.resizeImage(b.width,b.height);}).createDelegate(this);b.src=h[l][0];},resizeImage:function(a,u){var w=m.outerImageContainer.getWidth();var d=m.outerImageContainer.getHeight();var e=(a+this.borderSize*2);var f=(u+this.borderSize*2);var b=w-e;var v=d-f;var z=function(){m.hoverNav.setWidth(m.imageContainer.getWidth()+"px");m.navPrev.setHeight(u+"px");m.navNext.setHeight(u+"px");m.outerDataContainer.setWidth(e+"px");this.showImage();};if(v!=0||b!=0){m.outerImageContainer.shift({height:f,width:e,duration:this.resizeDuration,scope:this,callback:z,delay:50});}else{z.call(this);}},showImage:function(){m.loading.hide();m.image.fadeIn({duration:this.resizeDuration,scope:this,callback:function(){this.updateDetails();}});this.preloadImages();},updateDetails:function(){var a=m.data.getWidth(true)-m.navClose.getWidth()-10;m.details.setWidth((a>0?a:0)+"px");m.caption.update(h[l][1]);m.caption.show();if(h.length>1){m.imageNumber.update(this.labelImage+" "+(l+1)+" "+this.labelOf+"  "+h.length);m.imageNumber.show();}m.dataContainer.fadeIn({duration:this.resizeDuration/2,scope:this,callback:function(){var b=this.getDocumentSize();m.overlay.setHeight(b[1]+"px");this.updateNav();}});},updateNav:function(){this.enableKeyNav();
m.hoverNav.show();if(l>0){m.navPrev.show();}if(l<(h.length-1)){m.navNext.show();}},enableKeyNav:function(){Ext.fly(document).on("keydown",this.keyNavAction,this);},disableKeyNav:function(){Ext.fly(document).un("keydown",this.keyNavAction,this);},keyNavAction:function(b){var a=b.getKey();if(a==88||a==67||a==27){this.close();}else{if(a==80||a==37){if(l!=0){this.setImage(l-1);}}else{if(a==78||a==39){if(l!=(h.length-1)){this.setImage(l+1);}}}}},preloadImages:function(){var b,a;if(h.length>l+1){b=new Image();b.src=h[l+1][0];}if(l>0){a=new Image();a.src=h[l-1][0];}},close:function(){this.disableKeyNav();m.lightbox.hide();m.overlay.fadeOut({duration:this.overlayDuration});m.shim.hide();this.fireEvent("close",l);},getViewSize:function(){return[Ext.lib.Dom.getViewWidth(),Ext.lib.Dom.getViewHeight()];},getDocumentSize:function(){return[Ext.lib.Dom.getDocumentWidth(),Ext.lib.Dom.getDocumentHeight()];}};})();Ext.onReady(Ext.ux.Lightbox.init,Ext.ux.Lightbox);Ext.namespace("Ext.ux.form");Ext.ux.form.SuperBoxSelect=function(b){Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,b);this.addEvents("beforeadditem","additem","newitem","beforeremoveitem","removeitem","clear");};Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.form.ComboBox,{addNewDataOnBlur:false,allowAddNewData:false,allowQueryAll:true,backspaceDeletesLastItem:true,classField:null,clearBtnCls:"",clearLastQueryOnEscape:false,clearOnEscape:false,displayFieldTpl:null,extraItemCls:"",extraItemStyle:"",expandBtnCls:"",fixFocusOnTabSelect:true,forceFormValue:true,forceSameValueQuery:false,itemDelimiterKey:Ext.EventObject.ENTER,navigateItemsWithTab:true,pinList:true,preventDuplicates:true,queryFilterRe:"",queryValuesDelimiter:"|",queryValuesIndicator:"valuesqry",removeValuesFromStore:true,renderFieldBtns:true,stackItems:false,styleField:null,supressClearValueRemoveEvents:false,validationEvent:"blur",valueDelimiter:",",initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(false),usedRecords:new Ext.util.MixedCollection(false),addedRecords:[],remoteLookup:[],hideTrigger:true,grow:false,resizable:false,multiSelectMode:false,preRenderValue:null,filteredQueryData:""});if(this.queryFilterRe){if(Ext.isString(this.queryFilterRe)){this.queryFilterRe=new RegExp(this.queryFilterRe);}}if(this.transform){this.doTransform();}if(this.forceFormValue){this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this});}Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this);if(this.mode==="remote"&&this.store){this.store.on("load",this.onStoreLoad,this);}},onRender:function(f,g){var j=this.hiddenName;this.hiddenName=null;Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,f,g);this.hiddenName=j;this.manageNameAttribute();var h=(this.stackItems===true)?"x-superboxselect-stacked":"";if(this.renderFieldBtns){h+=" x-superboxselect-display-btns";}this.el.removeClass("x-form-text").addClass("x-superboxselect-input-field");this.wrapEl=this.el.wrap({tag:"ul"});this.outerWrapEl=this.wrapEl.wrap({tag:"div",cls:"x-form-text x-superboxselect "+h});this.inputEl=this.el.wrap({tag:"li",cls:"x-superboxselect-input"});if(this.renderFieldBtns){this.setupFieldButtons().manageClearBtn();}this.setupFormInterception();},doTransform:function(){var d=Ext.getDom(this.transform),w=[];if(!this.store){this.mode="local";var u=[],D=d.options;for(var z=0,v=D.length;z<v;z++){var B=D[z],o=Ext.get(B),t=o.getAttributeNS(null,"value")||"",s=o.getAttributeNS(null,"className")||"",C=o.getAttributeNS(null,"style")||"";if(B.selected){w.push(t);}u.push([t,B.text,s,typeof(C)==="string"?C:C.cssText]);}this.store=new Ext.data.SimpleStore({id:0,fields:["value","text","cls","style"],data:u});Ext.apply(this,{valueField:"value",displayField:"text",classField:"cls",styleField:"style"});}if(w.length){this.value=w.join(",");}},setupFieldButtons:function(){this.buttonWrap=this.outerWrapEl.createChild({cls:"x-superboxselect-btns"});this.buttonClear=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-clear "+this.clearBtnCls});if(this.allowQueryAll){this.buttonExpand=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-expand "+this.expandBtnCls});}this.initButtonEvents();return this;},initButtonEvents:function(){this.buttonClear.addClassOnOver("x-superboxselect-btn-over").on("click",function(b){b.stopEvent();if(this.disabled){return;}this.clearValue();this.el.focus();},this);if(this.allowQueryAll){this.buttonExpand.addClassOnOver("x-superboxselect-btn-over").on("click",function(b){b.stopEvent();if(this.disabled){return;}if(this.isExpanded()){this.multiSelectMode=false;}else{if(this.pinList){this.multiSelectMode=true;}}this.onTriggerClick();},this);}},removeButtonEvents:function(){this.buttonClear.removeAllListeners();if(this.allowQueryAll){this.buttonExpand.removeAllListeners();}return this;},clearCurrentFocus:function(){if(this.currentFocus){this.currentFocus.onLnkBlur();this.currentFocus=null;}return this;},initEvents:function(){var b=this.el;b.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this});this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this});this.wrapEl.on("click",this.onWrapClick,this);this.outerWrapEl.on("click",this.onWrapClick,this);this.inputEl.focus=function(){b.focus();};Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this);Ext.apply(this.keyNav,{tab:function(a){if(this.fixFocusOnTabSelect&&this.isExpanded()){a.stopEvent();b.blur();this.onViewClick(false);this.focus(false,10);return true;}this.onViewClick(false);if(b.dom.value!==""){this.setRawValue("");}return true;},down:function(a){if(!this.isExpanded()&&!this.currentFocus){if(this.allowQueryAll){this.onTriggerClick();}}else{this.inKeyMode=true;this.selectNext();}},enter:function(){}});},onClick:function(){this.clearCurrentFocus();this.collapse();this.autoSize();},beforeBlur:function(){if(this.allowAddNewData&&this.addNewDataOnBlur){var b=this.el.dom.value;if(b!==""){this.fireNewItemEvent(b);}}Ext.form.ComboBox.superclass.beforeBlur.call(this);},onFocus:function(){this.outerWrapEl.addClass(this.focusClass);Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this);},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass);this.clearCurrentFocus();if(this.el.dom.value!==""){this.applyEmptyText();this.autoSize();}Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this);},onCollapse:function(){this.view.clearSelections();this.multiSelectMode=false;},onWrapClick:function(b){b.stopEvent();this.collapse();this.el.focus();this.clearCurrentFocus();},markInvalid:function(g){var e,f;if(!this.rendered||this.preventMark){return;}this.outerWrapEl.addClass(this.invalidClass);g=g||this.invalidText;switch(this.msgTarget){case"qtip":Ext.apply(this.el.dom,{qtip:g,qclass:"x-form-invalid-tip"});Ext.apply(this.wrapEl.dom,{qtip:g,qclass:"x-form-invalid-tip"});if(Ext.QuickTips){Ext.QuickTips.enable();}break;case"title":this.el.dom.title=g;this.wrapEl.dom.title=g;this.outerWrapEl.dom.title=g;break;case"under":if(!this.errorEl){e=this.getErrorCt();if(!e){this.el.dom.title=g;break;}this.errorEl=e.createChild({cls:"x-form-invalid-msg"});this.errorEl.setWidth(e.getWidth(true)-20);}this.errorEl.update(g);Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);break;case"side":if(!this.errorIcon){e=this.getErrorCt();if(!e){this.el.dom.title=g;break;}this.errorIcon=e.createChild({cls:"x-form-invalid-icon"});}this.alignErrorIcon();Ext.apply(this.errorIcon.dom,{qtip:g,qclass:"x-form-invalid-tip"});this.errorIcon.show();this.on("resize",this.alignErrorIcon,this);break;default:f=Ext.getDom(this.msgTarget);f.innerHTML=g;f.style.display=this.msgDisplay;break;}this.fireEvent("invalid",this,g);},clearInvalid:function(){if(!this.rendered||this.preventMark){return;}this.outerWrapEl.removeClass(this.invalidClass);switch(this.msgTarget){case"qtip":this.el.dom.qtip="";this.wrapEl.dom.qtip="";break;
case"title":this.el.dom.title="";this.wrapEl.dom.title="";this.outerWrapEl.dom.title="";break;case"under":if(this.errorEl){Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this);}break;case"side":if(this.errorIcon){this.errorIcon.dom.qtip="";this.errorIcon.hide();this.un("resize",this.alignErrorIcon,this);}break;default:var b=Ext.getDom(this.msgTarget);b.innerHTML="";b.style.display="none";break;}this.fireEvent("valid",this);},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[Ext.isIE?5:2,3]);}},expand:function(){if(this.isExpanded()||!this.hasFocus){return;}if(this.bufferSize){this.doResize(this.bufferSize);delete this.bufferSize;}this.list.alignTo(this.outerWrapEl,this.listAlign).show();this.innerList.setOverflow("auto");this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent("expand",this);},restrictHeight:function(){var h=this.innerList.dom,u=h.scrollTop,r=this.list;h.style.height="";var q=r.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,t=Math.max(h.clientHeight,h.offsetHeight,h.scrollHeight),o=this.getPosition()[1]-Ext.getBody().getScroll().top,m=Ext.lib.Dom.getViewHeight()-o-this.getSize().height,s=Math.max(o,m,this.minHeight||0)-r.shadowOffset-q-5;t=Math.min(t,s,this.maxHeight);this.innerList.setHeight(t);r.beginUpdate();r.setHeight(t+q);r.alignTo(this.outerWrapEl,this.listAlign);r.endUpdate();if(this.multiSelectMode){h.scrollTop=u;}},validateValue:function(b){if(this.items.getCount()===0){if(this.allowBlank){this.clearInvalid();return true;}else{this.markInvalid(this.blankText);return false;}}this.clearInvalid();return true;},manageNameAttribute:function(){if(this.items.getCount()===0&&this.forceFormValue){this.el.dom.setAttribute("name",this.hiddenName||this.name);}else{this.el.dom.removeAttribute("name");}},setupFormInterception:function(){var e;this.findParentBy(function(a){if(a.getForm){e=a.getForm();}});if(e){var d=e.getValues;e.getValues=function(b){this.el.dom.disabled=true;var g=this.el.dom.value;this.setRawValue("");var a=d.call(e);this.el.dom.disabled=false;this.setRawValue(g);if(this.forceFormValue&&this.items.getCount()===0){a[this.name]="";}return b?Ext.urlEncode(a):a;}.createDelegate(this);}},onResize:function(h,m,j,g){var l=Ext.isIE6?4:Ext.isIE7?1:Ext.isIE8?1:0;if(this.wrapEl){this._width=h;this.outerWrapEl.setWidth(h-l);if(this.renderFieldBtns){l+=(this.buttonWrap.getWidth()+20);this.wrapEl.setWidth(h-l);}}Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,h,m,j,g);this.autoSize();},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this);this.items.each(function(b){b.enable();});if(this.renderFieldBtns){this.initButtonEvents();}},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this);this.items.each(function(b){b.disable();});if(this.renderFieldBtns){this.removeButtonEvents();}},clearValue:function(b){Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this);this.preventMultipleRemoveEvents=b||this.supressClearValueRemoveEvents||false;this.removeAllItems();this.preventMultipleRemoveEvents=false;this.fireEvent("clear",this);return this;},fireNewItemEvent:function(b){this.view.clearSelections();this.collapse();this.setRawValue("");if(this.queryFilterRe){b=b.replace(this.queryFilterRe,"");if(!b){return;}}this.fireEvent("newitem",this,b,this.filteredQueryData);},onKeyUp:function(b){if(this.editable!==false&&(!b.isSpecialKey()||b.getKey()===b.BACKSPACE)&&this.itemDelimiterKey.indexOf!==b.getKey()&&(!b.hasModifier()||b.shiftKey)){this.lastKey=b.getKey();this.dqTask.delay(this.queryDelay);}},onKeyDownHandler:function(r,u){var e,o,m;if(r.getKey()===r.ESC){if(!this.isExpanded()){if(this.el.dom.value!=""&&(this.clearOnEscape||this.clearLastQueryOnEscape)){if(this.clearOnEscape){this.el.dom.value="";}if(this.clearLastQueryOnEscape){this.lastQuery="";}r.stopEvent();}}}if((r.getKey()===r.DELETE||r.getKey()===r.SPACE)&&this.currentFocus){r.stopEvent();e=this.currentFocus;this.on("expand",function(){this.collapse();},this,{single:true});m=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(m<(this.items.getCount()-1)){o=this.items.itemAt(m+1);}e.preDestroy(true);if(o){(function(){o.onLnkFocus();this.currentFocus=o;}).defer(200,this);}return true;}var q=this.el.dom.value,t,s=r.ctrlKey;if(this.itemDelimiterKey===r.getKey()){r.stopEvent();if(q!==""){if(s||!this.isExpanded()){this.fireNewItemEvent(q);}else{this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this);}}}else{if(!this.isExpanded()){return;}this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this);}}return true;}if(q!==""){this.autoSize();return;}if(r.getKey()===r.HOME){r.stopEvent();if(this.items.getCount()>0){this.collapse();t=this.items.get(0);t.el.focus();}return true;}if(r.getKey()===r.BACKSPACE){r.stopEvent();if(this.currentFocus){e=this.currentFocus;this.on("expand",function(){this.collapse();},this,{single:true});m=this.items.indexOfKey(e.key);this.clearCurrentFocus();if(m<(this.items.getCount()-1)){o=this.items.itemAt(m+1);}e.preDestroy(true);if(o){(function(){o.onLnkFocus();this.currentFocus=o;}).defer(200,this);}return;}else{t=this.items.get(this.items.getCount()-1);if(t){if(this.backspaceDeletesLastItem){this.on("expand",function(){this.collapse();},this,{single:true});t.preDestroy(true);}else{if(this.navigateItemsWithTab){t.onElClick();}else{this.on("expand",function(){this.collapse();this.currentFocus=t;this.currentFocus.onLnkFocus.defer(20,this.currentFocus);},this,{single:true});}}}return true;}}if(!r.isNavKeyPress()){this.multiSelectMode=false;this.clearCurrentFocus();return;}if(r.getKey()===r.LEFT||(r.getKey()===r.UP&&!this.isExpanded())){r.stopEvent();this.collapse();t=this.items.get(this.items.getCount()-1);if(this.navigateItemsWithTab){if(t){t.focus();}}else{if(this.currentFocus){m=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(m!==0){this.currentFocus=this.items.itemAt(m-1);this.currentFocus.onLnkFocus();}}else{this.currentFocus=t;if(t){t.onLnkFocus();}}}return true;}if(r.getKey()===r.DOWN){if(this.currentFocus){this.collapse();r.stopEvent();m=this.items.indexOfKey(this.currentFocus.key);if(m==(this.items.getCount()-1)){this.clearCurrentFocus.defer(10,this);}else{this.clearCurrentFocus();this.currentFocus=this.items.itemAt(m+1);if(this.currentFocus){this.currentFocus.onLnkFocus();}}return true;}}if(r.getKey()===r.RIGHT){this.collapse();t=this.items.itemAt(0);if(this.navigateItemsWithTab){if(t){t.focus();}}else{if(this.currentFocus){m=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(m<(this.items.getCount()-1)){this.currentFocus=this.items.itemAt(m+1);if(this.currentFocus){this.currentFocus.onLnkFocus();}}}else{this.currentFocus=t;if(t){t.onLnkFocus();}}}}},onKeyUpBuffered:function(b){if(!b.isNavKeyPress()){this.autoSize();}},reset:function(){this.killItems();Ext.ux.form.SuperBoxSelect.superclass.reset.call(this);this.addedRecords=[];this.autoSize().setRawValue("");},applyEmptyText:function(){this.setRawValue("");if(this.items.getCount()>0){this.el.removeClass(this.emptyClass);this.setRawValue("");return this;}if(this.rendered&&this.emptyText&&this.getRawValue().length<1){this.setRawValue(this.emptyText);this.el.addClass(this.emptyClass);}return this;},removeAllItems:function(){this.items.each(function(b){b.preDestroy(true);},this);this.manageClearBtn();return this;},killItems:function(){this.items.each(function(b){b.kill();},this);this.resetStore();this.items.clear();this.manageClearBtn();return this;},resetStore:function(){this.store.clearFilter();if(!this.removeValuesFromStore){return this;}this.usedRecords.each(function(b){this.store.add(b);},this);this.usedRecords.clear();if(!this.store.remoteSort){this.store.sort(this.displayField,"ASC");}return this;},sortStore:function(){var b=this.store.getSortState();if(b&&b.field){this.store.sort(b.field,b.direction);
}return this;},getCaption:function(g){if(typeof this.displayFieldTpl==="string"){this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl);}var e,f=g instanceof Ext.data.Record?g.data:g;if(this.displayFieldTpl){e=this.displayFieldTpl.apply(f);}else{if(this.displayField){e=f[this.displayField];}}return e;},addRecord:function(h){var m=h.data[this.displayField],q=this.getCaption(h),l=h.data[this.valueField],j=this.classField?h.data[this.classField]:"",o=this.styleField?h.data[this.styleField]:"";if(this.removeValuesFromStore){this.usedRecords.add(l,h);this.store.remove(h);}this.addItemBox(l,m,q,j,o);this.fireEvent("additem",this,l,h);},createRecord:function(e){if(!this.recordConstructor){var d=[{name:this.valueField},{name:this.displayField}];if(this.classField){d.push({name:this.classField});}if(this.styleField){d.push({name:this.styleField});}this.recordConstructor=Ext.data.Record.create(d);}return new this.recordConstructor(e);},addItems:function(b){if(Ext.isArray(b)){Ext.each(b,function(a){this.addItem(a);},this);}else{this.addItem(b);}},addNewItem:function(b){this.addItem(b,true);},addItem:function(h,m){var j=h[this.valueField];if(this.disabled){return false;}if(this.preventDuplicates&&this.hasValue(j)){return;}var g=this.findRecord(this.valueField,j);if(g){this.addRecord(g);return;}else{if(!this.allowAddNewData){return;}}if(this.mode==="remote"){this.remoteLookup.push(h);this.doQuery(j,false,false,m);return;}var l=this.createRecord(h);this.store.add(l);this.addRecord(l);return true;},addItemBox:function(u,s,m,o,t){var r,q=function(d){var a="";switch(typeof d){case"function":a=d.call();break;case"object":for(var b in d){a+=b+":"+d[b]+";";}break;case"string":a=d+";";}return a;},w=Ext.id(null,"sbx-item"),v=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+" "+o,style:q(this.extraItemStyle)+" "+t,caption:m,display:s,value:u,key:w,listeners:{remove:function(a){if(this.fireEvent("beforeremoveitem",this,a.value)===false){return false;}this.items.removeKey(a.key);if(this.removeValuesFromStore){if(this.usedRecords.containsKey(a.value)){this.store.add(this.usedRecords.get(a.value));this.usedRecords.removeKey(a.value);this.sortStore();if(this.view){this.view.render();}}}if(!this.preventMultipleRemoveEvents){this.fireEvent.defer(250,this,["removeitem",this,a.value,this.findInStore(a.value)]);}},destroy:function(){this.collapse();this.autoSize().manageClearBtn().validateValue();},scope:this}});v.render();r={tag:"input",type:"hidden",value:u,name:(this.hiddenName||this.name)};if(this.disabled){Ext.apply(r,{disabled:"disabled"});}v.hidden=this.el.insertSibling(r,"before");this.items.add(w,v);this.applyEmptyText().autoSize().manageClearBtn().validateValue();},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered){return this;}var b="x-superboxselect-btn-hide";if(this.items.getCount()===0){this.buttonClear.addClass(b);}else{this.buttonClear.removeClass(b);}return this;},findInStore:function(d){var e=this.store.find(this.valueField,d);if(e>-1){return this.store.getAt(e);}return false;},getSelectedRecords:function(){var e=[];if(this.removeValuesFromStore){e=this.usedRecords.getRange();}else{var d=[];this.items.each(function(a){d.push(a.value);});Ext.each(d,function(a){e.push(this.findInStore(a));},this);}return e;},findSelectedItem:function(d){var e;this.items.each(function(a){if(a.el.dom===d){e=a;return false;}});return e;},findSelectedRecord:function(e){var f,g=this.findSelectedItem(e);if(g){f=this.findSelectedRecordByValue(g.value);}return f;},findSelectedRecordByValue:function(d){var e;if(this.removeValuesFromStore){this.usedRecords.each(function(a){if(a.get(this.valueField)==d){e=a;return false;}},this);}else{e=this.findInStore(d);}return e;},getValue:function(){var b=[];this.items.each(function(a){b.push(a.value);});return b.join(this.valueDelimiter);},getCount:function(){return this.items.getCount();},getValueEx:function(){var b=[];this.items.each(function(e){var a={};a[this.valueField]=e.value;a[this.displayField]=e.display;if(this.classField){a[this.classField]=e.cls||"";}if(this.styleField){a[this.styleField]=e.style||"";}b.push(a);},this);return b;},initValue:function(){if(Ext.isObject(this.value)||Ext.isArray(this.value)){this.setValueEx(this.value);this.originalValue=this.getValue();}else{Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this);}if(this.mode==="remote"){this.setOriginal=true;}},addValue:function(g){if(Ext.isEmpty(g)){return;}var f=g;if(!Ext.isArray(g)){g=""+g;f=g.split(this.valueDelimiter);}Ext.each(f,function(a){var b=this.findRecord(this.valueField,a);if(b){this.addRecord(b);}else{if(this.mode==="remote"){this.remoteLookup.push(a);}}},this);if(this.mode==="remote"){var e=this.remoteLookup.join(this.queryValuesDelimiter);this.doQuery(e,false,true);}},setValue:function(b){if(!this.rendered){this.value=b;return;}this.removeAllItems().resetStore();this.remoteLookup=[];this.addValue(b);},setValueEx:function(b){if(!this.rendered){this.value=b;return;}this.removeAllItems().resetStore();if(!Ext.isArray(b)){b=[b];}this.remoteLookup=[];if(this.allowAddNewData&&this.mode==="remote"){Ext.each(b,function(d){var a=this.findRecord(this.valueField,d[this.valueField])||this.createRecord(d);this.addRecord(a);},this);return;}Ext.each(b,function(a){this.addItem(a);},this);},hasValue:function(d){var e=false;this.items.each(function(a){if(a.value==d){e=true;return false;}},this);return e;},onSelect:function(f,e){if(this.fireEvent("beforeselect",this,f,e)!==false){var g=f.data[this.valueField];if(this.preventDuplicates&&this.hasValue(g)){return;}this.setRawValue("");this.lastSelectionText="";if(this.fireEvent("beforeadditem",this,g,f,this.filteredQueryData)!==false){this.addRecord(f);}if(this.store.getCount()===0||!this.multiSelectMode){this.collapse();}else{this.restrictHeight();}}},onDestroy:function(){this.items.purgeListeners();this.killItems();if(this.allowQueryAll){Ext.destroy(this.buttonExpand);}if(this.renderFieldBtns){Ext.destroy(this.buttonClear,this.buttonWrap);}Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl);Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this);},autoSize:function(){if(!this.rendered){return this;}if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el);}var j=this.el,d=j.dom.value,h=document.createElement("div");if(d===""&&this.emptyText&&this.items.getCount()<1){d=this.emptyText;}h.appendChild(document.createTextNode(d));d=h.innerHTML;h=null;d+="&#160;";var g=Math.max(this.metrics.getWidth(d)+24,24);if(typeof this._width!="undefined"){g=Math.min(this._width,g);}this.el.setWidth(g);if(Ext.isIE){this.el.dom.style.top="0";}this.fireEvent("autosize",this,g);return this;},shouldQuery:function(d){if(this.lastQuery){var e=d.match("^"+this.lastQuery);if(!e||this.store.getCount()){return true;}else{return(e[0]!==this.lastQuery);}}return true;},doQuery:function(l,m,h,o){l=Ext.isEmpty(l)?"":l;if(this.queryFilterRe){this.filteredQueryData="";var j=l.match(this.queryFilterRe);if(j&&j.length){this.filteredQueryData=j[0];}l=l.replace(this.queryFilterRe,"");if(!l&&j){return;}}var q={query:l,forceAll:m,combo:this,cancel:false};if(this.fireEvent("beforequery",q)===false||q.cancel){return false;}l=q.query;m=q.forceAll;if(m===true||(l.length>=this.minChars)||h&&!Ext.isEmpty(l)){if(o||this.forceSameValueQuery||this.shouldQuery(l)){this.lastQuery=l;if(this.mode=="local"){this.selectedIndex=-1;if(m){this.store.clearFilter();}else{this.store.filter(this.displayField,l);}this.onLoad();}else{this.store.baseParams[this.queryParam]=l;this.store.baseParams[this.queryValuesIndicator]=h;this.store.load({params:this.getParams(l)});if(!o){this.expand();}}}else{this.selectedIndex=-1;this.onLoad();}}},onStoreLoad:function(l,m,u){var r=u.params[this.queryParam]||l.baseParams[this.queryParam]||"",q=u.params[this.queryValuesIndicator]||l.baseParams[this.queryValuesIndicator];if(this.removeValuesFromStore){this.store.each(function(a){if(this.usedRecords.containsKey(a.get(this.valueField))){this.store.remove(a);
}},this);}if(q){var o=r.split(this.queryValuesDelimiter);Ext.each(o,function(b){this.remoteLookup.remove(b);var a=this.findRecord(this.valueField,b);if(a){this.addRecord(a);}},this);if(this.setOriginal){this.setOriginal=false;this.originalValue=this.getValue();}}if(r!==""&&this.allowAddNewData){Ext.each(this.remoteLookup,function(b){if(typeof b==="object"&&b[this.valueField]===r){this.remoteLookup.remove(b);if(m.length&&m[0].get(this.valueField)===r){this.addRecord(m[0]);return;}var a=this.createRecord(b);this.store.add(a);this.addRecord(a);this.addedRecords.push(a);(function(){if(this.isExpanded()){this.collapse();}}).defer(10,this);return;}},this);}var t=[];if(r===""){Ext.each(this.addedRecords,function(a){if(this.preventDuplicates&&this.usedRecords.containsKey(a.get(this.valueField))){return;}t.push(a);},this);}else{var s=new RegExp(Ext.escapeRe(r)+".*","i");Ext.each(this.addedRecords,function(a){if(this.preventDuplicates&&this.usedRecords.containsKey(a.get(this.valueField))){return;}if(s.test(a.get(this.displayField))){t.push(a);}},this);}this.store.add(t);this.sortStore();if(this.store.getCount()===0&&this.isExpanded()){this.collapse();}}});Ext.reg("superboxselect",Ext.ux.form.SuperBoxSelect);Ext.ux.form.SuperBoxSelectItem=function(b){Ext.apply(this,b);Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this);};Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this);},onElClick:function(e){var g=this.owner;g.clearCurrentFocus().collapse();if(g.navigateItemsWithTab){this.focus();}else{g.el.dom.focus();var f=this;(function(){this.onLnkFocus();g.currentFocus=this;}).defer(10,this);}},onLnkClick:function(b){if(b){b.stopEvent();}this.preDestroy();if(!this.owner.navigateItemsWithTab){this.owner.el.focus();}},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus");this.owner.outerWrapEl.addClass("x-form-focus");},onLnkBlur:function(){this.el.removeClass("x-superboxselect-item-focus");this.owner.outerWrapEl.removeClass("x-form-focus");},enableElListeners:function(){this.el.on("click",this.onElClick,this,{stopEvent:true});this.el.addClassOnOver("x-superboxselect-item x-superboxselect-item-hover");},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this});},enableAllListeners:function(){this.enableElListeners();this.enableLnkListeners();},disableAllListeners:function(){this.el.removeAllListeners();this.lnk.un("click",this.onLnkClick,this);this.lnk.un("focus",this.onLnkFocus,this);this.lnk.un("blur",this.onLnkBlur,this);},onRender:function(q,j){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,q,j);var m=this.el;if(m){m.remove();}this.el=m=q.createChild({tag:"li"},q.last());m.addClass("x-superboxselect-item");var o=this.owner.navigateItemsWithTab?(Ext.isSafari?"button":"a"):"span";var l=this.key;Ext.apply(m,{focus:function(){var a=this.down(o+".x-superboxselect-item-close");if(a){a.focus();}},preDestroy:function(){this.preDestroy();}.createDelegate(this)});this.enableElListeners();m.update(this.caption);var h={tag:o,"class":"x-superboxselect-item-close",tabIndex:this.owner.navigateItemsWithTab?"0":"-1"};if(o==="a"){h.href="#";}this.lnk=m.createChild(h);if(!this.disabled){this.enableLnkListeners();}else{this.disableAllListeners();}this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this});this.setupKeyMap();},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus("right");},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus("left");},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var b=this.owner.items.get(0).el.focus();if(b){b.el.focus();}},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus();},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]);this.keyMap.stopEvent=true;},moveFocus:function(e){var d=this.el[e=="left"?"prev":"next"]()||this.owner.el;d.focus.defer(100,d);},preDestroy:function(e){if(this.fireEvent("remove",this)===false){return;}var d=function(){if(this.owner.navigateItemsWithTab){this.moveFocus("right");}this.hidden.remove();this.hidden=null;this.destroy();};if(e){d.call(this);}else{this.el.hide({duration:0.2,callback:d,scope:this});}return this;},kill:function(){this.hidden.remove();this.hidden=null;this.purgeListeners();this.destroy();},onDisable:function(){if(this.hidden){this.hidden.dom.setAttribute("disabled","disabled");}this.keyMap.disable();Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this);},onEnable:function(){if(this.hidden){this.hidden.dom.removeAttribute("disabled");}this.keyMap.enable();Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this);},onDestroy:function(){Ext.destroy(this.lnk,this.el);Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this);}});Proj4js={defaultDatum:"WGS84",transform:function(h,f,g){if(!h.readyToUse||!f.readyToUse){this.reportError("Proj4js initialization for "+h.srsCode+" not yet complete");return g;}if((h.srsProjNumber=="900913"&&f.datumCode!="WGS84")||(f.srsProjNumber=="900913"&&h.datumCode!="WGS84")){var j=Proj4js.WGS84;this.transform(h,j,g);h=j;}if(h.projName=="longlat"){g.x*=Proj4js.common.D2R;g.y*=Proj4js.common.D2R;}else{if(h.to_meter){g.x*=h.to_meter;g.y*=h.to_meter;}h.inverse(g);}if(h.from_greenwich){g.x+=h.from_greenwich;}g=this.datum_transform(h.datum,f.datum,g);if(f.from_greenwich){g.x-=f.from_greenwich;}if(f.projName=="longlat"){g.x*=Proj4js.common.R2D;g.y*=Proj4js.common.R2D;}else{f.forward(g);if(f.to_meter){g.x/=f.to_meter;g.y/=f.to_meter;}}return g;},datum_transform:function(g,e,f){if(g.compare_datums(e)){return f;}if(g.datum_type==Proj4js.common.PJD_NODATUM||e.datum_type==Proj4js.common.PJD_NODATUM){return f;}if(g.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.");}if(e.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.");}if(g.es!=e.es||g.a!=e.a||g.datum_type==Proj4js.common.PJD_3PARAM||g.datum_type==Proj4js.common.PJD_7PARAM||e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM){g.geodetic_to_geocentric(f);if(g.datum_type==Proj4js.common.PJD_3PARAM||g.datum_type==Proj4js.common.PJD_7PARAM){g.geocentric_to_wgs84(f);}if(e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM){e.geocentric_from_wgs84(f);}e.geocentric_to_geodetic(f);}if(e.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.");}return f;},reportError:function(b){},extend:function(g,h){g=g||{};if(h){for(var j in h){var f=h[j];if(f!==undefined){g[j]=f;}}}return g;},Class:function(){var f=function(){this.initialize.apply(this,arguments);};var g={};var h;for(var j=0;j<arguments.length;++j){if(typeof arguments[j]=="function"){h=arguments[j].prototype;}else{h=arguments[j];}Proj4js.extend(g,h);}f.prototype=g;return f;},bind:function(g,e){var f=Array.prototype.slice.apply(arguments,[2]);return function(){var a=f.concat(Array.prototype.slice.apply(arguments,[0]));return g.apply(e,a);};},scriptName:"proj4js.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath){return this.libPath;}var m=this.scriptName;var o=m.length;var j=document.getElementsByTagName("script");for(var q=0;q<j.length;q++){var l=j[q].getAttribute("src");if(l){var h=l.lastIndexOf(m);if((h>-1)&&(h+o==l.length)){this.libPath=l.slice(0,-o);break;}}}return this.libPath||"";},loadScript:function(l,j,m,h){var g=document.createElement("script");g.defer=false;g.type="text/javascript";g.id=l;g.src=l;g.onload=j;g.onerror=m;g.loadCheck=h;if(/MSIE/.test(navigator.userAgent)){g.onreadystatechange=this.checkReadyState;
}document.getElementsByTagName("head")[0].appendChild(g);},checkReadyState:function(){if(this.readyState=="loaded"){if(!this.loadCheck()){this.onerror();}else{this.onload();}}}};Proj4js.Proj=Proj4js.Class({readyToUse:false,title:null,projName:null,units:null,datum:null,initialize:function(g){this.srsCodeInput=g;if(g.indexOf("urn:")==0){var f=g.split(":");if((f[1]=="ogc"||f[1]=="x-ogc")&&(f[2]=="def")&&(f[3]=="crs")&&f.length==7){g=f[4]+":"+f[6];}}else{if(g.indexOf("http://")==0){var e=g.split("#");if(e[0].match(/epsg.org/)){g="EPSG:"+e[1];}else{if(e[0].match(/RIG.xml/)){g="IGNF:"+e[1];}}}}this.srsCode=g.toUpperCase();if(this.srsCode.indexOf("EPSG")==0){this.srsCode=this.srsCode;this.srsAuth="epsg";this.srsProjNumber=this.srsCode.substring(5);}else{if(this.srsCode.indexOf("IGNF")==0){this.srsCode=this.srsCode;this.srsAuth="IGNF";this.srsProjNumber=this.srsCode.substring(5);}else{if(this.srsCode.indexOf("CRS")==0){this.srsCode=this.srsCode;this.srsAuth="CRS";this.srsProjNumber=this.srsCode.substring(4);}else{this.srsAuth="";this.srsProjNumber=this.srsCode;}}}this.loadProjDefinition();},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode]){this.defsLoaded();return;}var b=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(b,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this));},loadFromService:function(){var b=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js";Proj4js.loadScript(b,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this));},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName);},checkDefsLoaded:function(){if(Proj4js.defs[this.srsCode]){return true;}else{return false;}},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);Proj4js.extend(Proj4js.defs[this.srsCode],Proj4js.defs.WGS84);this.defsLoaded();},loadProjCode:function(d){if(Proj4js.Proj[d]){this.initTransforms();return;}var e=Proj4js.getScriptLocation()+"projCode/"+d+".js";Proj4js.loadScript(e,Proj4js.bind(this.loadProjCodeSuccess,this,d),Proj4js.bind(this.loadProjCodeFailure,this,d),Proj4js.bind(this.checkCodeLoaded,this,d));},loadProjCodeSuccess:function(b){if(Proj4js.Proj[b].dependsOn){this.loadProjCode(Proj4js.Proj[b].dependsOn);}else{this.initTransforms();}},loadProjCodeFailure:function(b){Proj4js.reportError("failed to find projection file for: "+b);},checkCodeLoaded:function(b){if(Proj4js.Proj[b]){return true;}else{return false;}},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=true;},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var l,g;var h=this.defData.split("+");for(var j=0;j<h.length;j++){var m=h[j].split("=");l=m[0].toLowerCase();g=m[1];switch(l.replace(/\s/gi,"")){case"":break;case"title":this.title=g;break;case"proj":this.projName=g.replace(/\s/gi,"");break;case"units":this.units=g.replace(/\s/gi,"");break;case"datum":this.datumCode=g.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=g.replace(/\s/gi,"");break;case"ellps":this.ellps=g.replace(/\s/gi,"");break;case"a":this.a=parseFloat(g);break;case"b":this.b=parseFloat(g);break;case"rf":this.rf=parseFloat(g);break;case"lat_0":this.lat0=g*Proj4js.common.D2R;break;case"lat_1":this.lat1=g*Proj4js.common.D2R;break;case"lat_2":this.lat2=g*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=g*Proj4js.common.D2R;break;case"lon_0":this.long0=g*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(g)*Proj4js.common.D2R;break;case"lonc":this.longc=g*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(g);break;case"y_0":this.y0=parseFloat(g);break;case"k_0":this.k0=parseFloat(g);break;case"k":this.k0=parseFloat(g);break;case"R_A":this.R=true;break;case"zone":this.zone=parseInt(g);break;case"south":this.utmSouth=true;break;case"towgs84":this.datum_params=g.split(",");break;case"to_meter":this.to_meter=parseFloat(g);break;case"from_greenwich":this.from_greenwich=g*Proj4js.common.D2R;break;case"pm":g=g.replace(/\s/gi,"");this.from_greenwich=Proj4js.PrimeMeridian[g]?Proj4js.PrimeMeridian[g]:parseFloat(g);this.from_greenwich*=Proj4js.common.D2R;break;case"no_defs":break;default:}}this.deriveConstants();},deriveConstants:function(){if(this.nagrids=="@null"){this.datumCode="none";}if(this.datumCode&&this.datumCode!="none"){var e=Proj4js.Datum[this.datumCode];if(e){this.datum_params=e.towgs84.split(",");this.ellps=e.ellipse;this.datumName=e.datumName?e.datumName:this.datumCode;}}if(!this.a){var d=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,d);}if(this.rf&&!this.b){this.b=(1-1/this.rf)*this.a;}if(Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=true;this.b=this.a;}this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);if(this.R_A){this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.RA4+this.es*Proj4js.RA6));this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=0;}this.ep2=(this.a2-this.b2)/this.b2;if(!this.k0){this.k0=1;}this.datum=new Proj4js.datum(this);}});Proj4js.Proj.longlat={init:function(){},forward:function(b){return b;},inverse:function(b){return b;}};Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:900913":"+title= Google Mercator EPSG:900913 +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:900913"];Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:0.7853981633974483,R2D:57.29577951308232,D2R:0.017453292519943295,SEC_TO_RAD:0.00000484813681109536,EPSLN:1e-10,MAX_ITER:20,COS_67P5:0.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:0.16666666666666666,RA4:0.04722222222222222,RA6:0.022156084656084655,RV4:0.06944444444444445,RV6:0.04243827160493827,msfnz:function(j,f,h){var g=j*f;return h/(Math.sqrt(1-g*g));},tsfnz:function(j,l,m){var h=j*m;var g=0.5*j;h=Math.pow(((1-h)/(1+h)),g);return(Math.tan(0.5*(this.HALF_PI-l))/h);},phi2z:function(l,m){var o=0.5*l;var j,h;var q=this.HALF_PI-2*Math.atan(m);for(i=0;i<=15;i++){j=l*Math.sin(q);h=this.HALF_PI-2*Math.atan(m*(Math.pow(((1-j)/(1+j)),o)))-q;q+=h;if(Math.abs(h)<=1e-10){return q;}}alert("phi2z has NoConvergence");return(-9999);},qsfnz:function(j,f,h){var g;if(j>1e-7){g=j*f;return((1-j*j)*(f/(1-g*g)-(0.5/j)*Math.log((1-g)/(1+g))));}else{return(2*f);}},asinz:function(b){if(Math.abs(b)>1){b=(b>1)?1:-1;}return Math.asin(b);},e0fn:function(b){return(1-0.25*b*(1+b/16*(3+1.25*b)));},e1fn:function(b){return(0.375*b*(1+0.25*b*(1+0.46875*b)));},e2fn:function(b){return(0.05859375*b*b*(1+0.75*b));},e3fn:function(b){return(b*b*b*(35/3072));},mlfn:function(j,l,m,g,h){return(j*h-l*Math.sin(2*h)+m*Math.sin(4*h)-g*Math.sin(6*h));},srat:function(e,d){return(Math.pow((1-e)/(1+e),d));},sign:function(b){if(b<0){return(-1);}else{return(1);}},adjust_lon:function(b){b=(Math.abs(b)<this.PI)?b:(b-(this.sign(b)*this.TWO_PI));return b;},adjust_lat:function(b){b=(Math.abs(b)<this.HALF_PI)?b:(b-(this.sign(b)*this.PI));return b;},latiso:function(h,j,f){if(Math.abs(j)>this.HALF_PI){return +Number.NaN;}if(j==this.HALF_PI){return Number.POSITIVE_INFINITY;}if(j==-1*this.HALF_PI){return -1*Number.POSITIVE_INFINITY;}var g=h*f;return Math.log(Math.tan((this.HALF_PI+j)/2))+h*Math.log((1-g)/(1+g))/2;},fL:function(d,e){return 2*Math.atan(d*Math.exp(e))-this.HALF_PI;},invlatiso:function(j,m){var g=this.fL(1,m);var l=0;var h=0;
do{l=g;h=j*Math.sin(l);g=this.fL(Math.exp(j*Math.log((1+h)/(1-h))/2),m);}while(Math.abs(g-l)>1e-12);return g;},sinh:function(e){var d=Math.exp(e);d=(d-1/d)/2;return d;},cosh:function(e){var d=Math.exp(e);d=(d+1/d)/2;return d;},tanh:function(e){var d=Math.exp(e);d=(d-1/d)/(d+1/d);return d;},asinh:function(e){var d=(e>=0?1:-1);return d*(Math.log(Math.abs(e)+Math.sqrt(e*e+1)));},acosh:function(b){return 2*Math.log(Math.sqrt((b+1)/2)+Math.sqrt((b-1)/2));},atanh:function(b){return Math.log((b-1)/(b+1))/2;},gN:function(a,e,h){var j=e*h;return a/Math.sqrt(1-j*j);}};Proj4js.datum=Proj4js.Class({initialize:function(d){this.datum_type=Proj4js.common.PJD_WGS84;if(d.datumCode&&d.datumCode=="none"){this.datum_type=Proj4js.common.PJD_NODATUM;}if(d&&d.datum_params){for(var e=0;e<d.datum_params.length;e++){d.datum_params[e]=parseFloat(d.datum_params[e]);}if(d.datum_params[0]!=0||d.datum_params[1]!=0||d.datum_params[2]!=0){this.datum_type=Proj4js.common.PJD_3PARAM;}if(d.datum_params.length>3){if(d.datum_params[3]!=0||d.datum_params[4]!=0||d.datum_params[5]!=0||d.datum_params[6]!=0){this.datum_type=Proj4js.common.PJD_7PARAM;d.datum_params[3]*=Proj4js.common.SEC_TO_RAD;d.datum_params[4]*=Proj4js.common.SEC_TO_RAD;d.datum_params[5]*=Proj4js.common.SEC_TO_RAD;d.datum_params[6]=(d.datum_params[6]/1000000)+1;}}}if(d){this.a=d.a;this.b=d.b;this.es=d.es;this.ep2=d.ep2;this.datum_params=d.datum_params;}},compare_datums:function(b){if(this.datum_type!=b.datum_type){return false;}else{if(this.a!=b.a||Math.abs(this.es-b.es)>5e-11){return false;}else{if(this.datum_type==Proj4js.common.PJD_3PARAM){return(this.datum_params[0]==b.datum_params[0]&&this.datum_params[1]==b.datum_params[1]&&this.datum_params[2]==b.datum_params[2]);}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){return(this.datum_params[0]==b.datum_params[0]&&this.datum_params[1]==b.datum_params[1]&&this.datum_params[2]==b.datum_params[2]&&this.datum_params[3]==b.datum_params[3]&&this.datum_params[4]==b.datum_params[4]&&this.datum_params[5]==b.datum_params[5]&&this.datum_params[6]==b.datum_params[6]);}else{if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT){return strcmp(pj_param(this.params,"snadgrids").s,pj_param(b.params,"snadgrids").s)==0;}else{return true;}}}}}},geodetic_to_geocentric:function(D){var r=D.x;var v=D.y;var C=D.z?D.z:0;var B;var E;var F;var t=0;var s;var u;var w;var z;if(v<-Proj4js.common.HALF_PI&&v>-1.001*Proj4js.common.HALF_PI){v=-Proj4js.common.HALF_PI;}else{if(v>Proj4js.common.HALF_PI&&v<1.001*Proj4js.common.HALF_PI){v=Proj4js.common.HALF_PI;}else{if((v<-Proj4js.common.HALF_PI)||(v>Proj4js.common.HALF_PI)){Proj4js.reportError("geocent:lat out of range:"+v);return null;}}}if(r>Proj4js.common.PI){r-=(2*Proj4js.common.PI);}u=Math.sin(v);z=Math.cos(v);w=u*u;s=this.a/(Math.sqrt(1-this.es*w));B=(s+C)*z*Math.cos(r);E=(s+C)*z*Math.sin(r);F=((s*(1-this.es))+C)*u;D.x=B;D.y=E;D.z=F;return t;},geocentric_to_geodetic:function(G){var J=1e-12;var S=(J*J);var aa=30;var T;var Y;var af;var N;var ae;var Q;var U;var M;var O;var V;var I;var K;var ab;var P;var Z=G.x;var ac=G.y;var ad=G.z?G.z:0;var W;var H;var L;ab=false;T=Math.sqrt(Z*Z+ac*ac);Y=Math.sqrt(Z*Z+ac*ac+ad*ad);if(T/this.a<J){ab=true;W=0;if(Y/this.a<J){H=Proj4js.common.HALF_PI;L=-this.b;return;}}else{W=Math.atan2(ac,Z);}af=ad/Y;N=T/Y;ae=1/Math.sqrt(1-this.es*(2-this.es)*N*N);M=N*(1-this.es)*ae;O=af*ae;P=0;do{P++;U=this.a/Math.sqrt(1-this.es*O*O);L=T*M+ad*O-U*(1-this.es*O*O);Q=this.es*U/(U+L);ae=1/Math.sqrt(1-Q*(2-Q)*N*N);V=N*(1-Q)*ae;I=af*ae;K=I*M-V*O;M=V;O=I;}while(K*K>S&&P<aa);H=Math.atan(I/Math.abs(V));G.x=W;G.y=H;G.z=L;return G;},geocentric_to_geodetic_noniter:function(E){var V=E.x;var W=E.y;var Z=E.z?E.z:0;var S;var F;var M;var U;var I;var G;var K;var O;var Q;var P;var J;var T;var L;var D;var H;var N;var Y;V=parseFloat(V);W=parseFloat(W);Z=parseFloat(Z);Y=false;if(V!=0){S=Math.atan2(W,V);}else{if(W>0){S=Proj4js.common.HALF_PI;}else{if(W<0){S=-Proj4js.common.HALF_PI;}else{Y=true;S=0;if(Z>0){F=Proj4js.common.HALF_PI;}else{if(Z<0){F=-Proj4js.common.HALF_PI;}else{F=Proj4js.common.HALF_PI;M=-this.b;return;}}}}}I=V*V+W*W;U=Math.sqrt(I);G=Z*Proj4js.common.AD_C;O=Math.sqrt(G*G+I);P=G/O;T=U/O;J=P*P*P;K=Z+this.b*this.ep2*J;N=U-this.a*this.es*T*T*T;Q=Math.sqrt(K*K+N*N);L=K/Q;D=N/Q;H=this.a/Math.sqrt(1-this.es*L*L);if(D>=Proj4js.common.COS_67P5){M=U/D-H;}else{if(D<=-Proj4js.common.COS_67P5){M=U/-D-H;}else{M=Z/L+H*(this.es-1);}}if(Y==false){F=Math.atan(L/D);}E.x=S;E.y=F;E.z=M;return E;},geocentric_to_wgs84:function(C){if(this.datum_type==Proj4js.common.PJD_3PARAM){C.x+=this.datum_params[0];C.y+=this.datum_params[1];C.z+=this.datum_params[2];}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var v=this.datum_params[0];var z=this.datum_params[1];var s=this.datum_params[2];var w=this.datum_params[3];var r=this.datum_params[4];var t=this.datum_params[5];var u=this.datum_params[6];var B=u*(C.x-t*C.y+r*C.z)+v;var D=u*(t*C.x+C.y-w*C.z)+z;var q=u*(-r*C.x+w*C.y+C.z)+s;C.x=B;C.y=D;C.z=q;}}},geocentric_from_wgs84:function(B){if(this.datum_type==Proj4js.common.PJD_3PARAM){B.x-=this.datum_params[0];B.y-=this.datum_params[1];B.z-=this.datum_params[2];}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var u=this.datum_params[0];var z=this.datum_params[1];var r=this.datum_params[2];var v=this.datum_params[3];var q=this.datum_params[4];var s=this.datum_params[5];var t=this.datum_params[6];var w=(B.x-u)/t;var C=(B.y-z)/t;var D=(B.z-r)/t;B.x=w+s*C-q*D;B.y=-s*w+C+v*D;B.z=q*w-v*C+D;}}}});Proj4js.Point=Proj4js.Class({initialize:function(g,h,j){if(typeof g=="object"){this.x=g[0];this.y=g[1];this.z=g[2]||0;}else{if(typeof g=="string"){var f=g.split(",");this.x=parseFloat(f[0]);this.y=parseFloat(f[1]);this.z=parseFloat(f[2])||0;}else{this.x=g;this.y=h;this.z=j||0;}}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z);},toString:function(){return("x="+this.x+",y="+this.y);},toShortString:function(){return(this.x+", "+this.y);}});Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};
Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};Proj4js.WGS84=new Proj4js.Proj("WGS84");Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("aeaInitEqualLatitudes");return;}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e3=Math.sqrt(this.es);this.sin_po=Math.sin(this.lat1);this.cos_po=Math.cos(this.lat1);this.t1=this.sin_po;this.con=this.sin_po;this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat2);this.cos_po=Math.cos(this.lat2);this.t2=this.sin_po;this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat0);this.cos_po=Math.cos(this.lat0);this.t3=this.sin_po;this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1);}else{this.ns0=this.con;}this.c=this.ms1*this.ms1+this.ns0*this.qs1;this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0;},forward:function(s){var r=s.x;var t=s.y;this.sin_phi=Math.sin(t);this.cos_phi=Math.cos(t);var l=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi);var o=this.a*Math.sqrt(this.c-this.ns0*l)/this.ns0;var u=this.ns0*Proj4js.common.adjust_lon(r-this.long0);var m=o*Math.sin(u)+this.x0;var q=this.rh-o*Math.cos(u)+this.y0;s.x=m;s.y=q;return s;},inverse:function(q){var m,l,j,s,o,r;q.x-=this.x0;q.y=this.rh-q.y+this.y0;if(this.ns0>=0){m=Math.sqrt(q.x*q.x+q.y*q.y);j=1;}else{m=-Math.sqrt(q.x*q.x+q.y*q.y);j=-1;}s=0;if(m!=0){s=Math.atan2(j*q.x,j*q.y);}j=m*this.ns0/this.a;l=(this.c-j*j)/this.ns0;if(this.e3>=1e-10){j=1-0.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3;if(Math.abs(Math.abs(j)-Math.abs(l))>1e-10){r=this.phi1z(this.e3,l);}else{if(l>=0){r=0.5*PI;}else{r=-0.5*PI;}}}else{r=this.phi1z(e3,l);}o=Proj4js.common.adjust_lon(s/this.ns0+this.long0);q.x=o;q.y=r;return q;},phi1z:function(o,m){var l,u,t;var q=Proj4js.common.asinz(0.5*m);if(o<Proj4js.common.EPSLN){return q;}var r=o*o;for(var s=1;s<=25;s++){sinphi=Math.sin(q);cosphi=Math.cos(q);l=o*sinphi;u=1-l*l;t=0.5*u*u/cosphi*(m/(1-r)-sinphi/u+0.5/o*Math.log((1-l)/(1+l)));q=q+t;if(Math.abs(t)<=1e-7){return q;}}Proj4js.reportError("aea:phi1z:Convergence error");return null;}};Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);if(!this.rc){Proj4js.reportError("sterea:init:E_ERROR_0");return;}this.sinc0=Math.sin(this.phic0);this.cosc0=Math.cos(this.phic0);this.R2=2*this.rc;if(!this.title){this.title="Oblique Stereographic Alternative";}},forward:function(b){b.x=Proj4js.common.adjust_lon(b.x-this.long0);Proj4js.Proj.gauss.forward.apply(this,[b]);sinc=Math.sin(b.y);cosc=Math.cos(b.y);cosl=Math.cos(b.x);k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl);b.x=k*cosc*Math.sin(b.x);b.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl);b.x=this.a*b.x+this.x0;b.y=this.a*b.y+this.y0;return b;},inverse:function(e){var g,f;e.x=(e.x-this.x0)/this.a;e.y=(e.y-this.y0)/this.a;e.x/=this.k0;e.y/=this.k0;if((rho=Math.sqrt(e.x*e.x+e.y*e.y))){c=2*Math.atan2(rho,this.R2);sinc=Math.sin(c);cosc=Math.cos(c);f=Math.asin(cosc*this.sinc0+e.y*sinc*this.cosc0/rho);g=Math.atan2(e.x*sinc,rho*this.cosc0*cosc-e.y*this.sinc0*sinc);}else{f=this.phic0;g=0;}e.x=g;e.y=f;Proj4js.Proj.gauss.inverse.apply(this,[e]);e.x=Proj4js.common.adjust_lon(e.x+this.long0);return e;}};Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);},forward:function(J){var L=J.x;var t=J.y;var G=Proj4js.common.adjust_lon(L-this.long0);var I;var M,O;var N=Math.sin(t);var C=Math.cos(t);if(this.sphere){var P=C*Math.sin(G);if((Math.abs(Math.abs(P)-1))<1e-10){Proj4js.reportError("tmerc:forward: Point projects into infinity");return(93);}else{M=0.5*this.a*this.k0*Math.log((1+P)/(1-P));I=Math.acos(C*Math.cos(G)/Math.sqrt(1-P*P));if(t<0){I=-I;}O=this.a*this.k0*(I-this.lat0);}}else{var D=C*G;var E=Math.pow(D,2);var B=this.ep2*Math.pow(C,2);var b=Math.tan(t);var K=Math.pow(b,2);I=1-this.es*Math.pow(N,2);var H=this.a/Math.sqrt(I);var F=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,t);M=this.k0*H*D*(1+E/6*(1-K+B+E/20*(5-18*K+Math.pow(K,2)+72*B-58*this.ep2)))+this.x0;O=this.k0*(F-this.ml0+H*b*(E*(0.5+E/24*(5-K+9*B+4*Math.pow(B,2)+E/30*(61-58*K+Math.pow(K,2)+600*B-330*this.ep2)))))+this.y0;}J.x=M;J.y=O;return J;},inverse:function(Y){var ad,af;var f;var U;var aa=6;var ab,ae;if(this.sphere){var O=Math.exp(Y.x/(this.a*this.k0));var P=0.5*(O-1/O);var r=this.lat0+Y.y/(this.a*this.k0);var S=Math.cos(r);ad=Math.sqrt((1-S*S)/(1+P*P));ab=Math.asinz(ad);if(r<0){ab=-ab;}if((P==0)&&(S==0)){ae=this.long0;}else{ae=Proj4js.common.adjust_lon(Math.atan2(P,S)+this.long0);}}else{var T=Y.x-this.x0;var W=Y.y-this.y0;ad=(this.ml0+W/this.k0)/this.a;af=ad;for(U=0;;U++){f=((ad+this.e1*Math.sin(2*af)-this.e2*Math.sin(4*af)+this.e3*Math.sin(6*af))/this.e0)-af;af+=f;if(Math.abs(f)<=Proj4js.common.EPSLN){break;}if(U>=aa){Proj4js.reportError("tmerc:inverse: Latitude failed to converge");return(95);}}if(Math.abs(af)<Proj4js.common.HALF_PI){var ag=Math.sin(af);var d=Math.cos(af);var Q=Math.tan(af);var h=this.ep2*Math.pow(d,2);var ac=Math.pow(h,2);var N=Math.pow(Q,2);var ah=Math.pow(N,2);ad=1-this.es*Math.pow(ag,2);var V=this.a/Math.sqrt(ad);var g=V*(1-this.es)/ad;var t=T/(V*this.k0);var Z=Math.pow(t,2);ab=af-(V*Q*Z/g)*(0.5-Z/24*(5+3*N+10*h-4*ac-9*this.ep2-Z/30*(61+90*N+298*h+45*ah-252*this.ep2-3*ac)));ae=Proj4js.common.adjust_lon(this.long0+(t*(1-Z/6*(1+2*N+h-Z/20*(5-2*h+28*N-3*ac+8*this.ep2+24*ah)))/d));}else{ab=Proj4js.common.HALF_PI*Proj4js.common.sign(W);ae=this.long0;}}Y.x=ae;Y.y=ab;return Y;}};Proj4js.Proj.equi={init:function(){if(!this.x0){this.x0=0;}if(!this.y0){this.y0=0;}if(!this.lat0){this.lat0=0;}if(!this.long0){this.long0=0;}},forward:function(o){var m=o.x;var q=o.y;var h=Proj4js.common.adjust_lon(m-this.long0);var j=this.x0+this.a*h*Math.cos(this.lat0);var l=this.y0+this.a*q;this.t1=j;this.t2=Math.cos(this.lat0);o.x=j;o.y=l;return o;},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var f=e.y/this.a;if(Math.abs(f)>Proj4js.common.HALF_PI){Proj4js.reportError("equi:Inv:DataError");}var g=Proj4js.common.adjust_lon(this.long0+e.x/(this.a*Math.cos(this.lat0)));e.x=g;e.y=f;}};Proj4js.Proj.merc={init:function(){if(this.lat_ts){if(this.sphere){this.k0=Math.cos(this.lat_ts);}else{this.k0=Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts));}}},forward:function(q){var o=q.x;var r=q.y;if(r*Proj4js.common.R2D>90&&r*Proj4js.common.R2D<-90&&o*Proj4js.common.R2D>180&&o*Proj4js.common.R2D<-180){Proj4js.reportError("merc:forward: llInputOutOfRange: "+o+" : "+r);return null;}var l,m;if(Math.abs(Math.abs(r)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("merc:forward: ll2mAtPoles");
return null;}else{if(this.sphere){l=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(o-this.long0);m=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+0.5*r));}else{var s=Math.sin(r);var j=Proj4js.common.tsfnz(this.e,r,s);l=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(o-this.long0);m=this.y0-this.a*this.k0*Math.log(j);}q.x=l;q.y=m;return q;}},inverse:function(o){var j=o.x-this.x0;var l=o.y-this.y0;var m,q;if(this.sphere){q=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-l/this.a*this.k0));}else{var h=Math.exp(-l/(this.a*this.k0));q=Proj4js.common.phi2z(this.e,h);if(q==-9999){Proj4js.reportError("merc:inverse: lat = -9999");return null;}}m=Proj4js.common.adjust_lon(this.long0+j/(this.a*this.k0));o.x=m;o.y=q;return o;}};Proj4js.Proj.sinu={init:function(){this.R=6370997;},forward:function(o){var j,l,h;var m=o.x;var q=o.y;h=Proj4js.common.adjust_lon(m-this.long0);j=this.R*h*Math.cos(q)+this.x0;l=this.R*q+this.y0;o.x=j;o.y=l;return o;},inverse:function(j){var f,g,h;j.x-=this.x0;j.y-=this.y0;f=j.y/this.R;if(Math.abs(f)>Proj4js.common.HALF_PI){Proj4js.reportError("sinu:Inv:DataError");}g=Math.abs(f)-Proj4js.common.HALF_PI;if(Math.abs(g)>Proj4js.common.EPSLN){g=this.long0+j.x/(this.R*Math.cos(f));h=Proj4js.common.adjust_lon(g);}else{h=this.long0;}j.x=h;j.y=f;return j;}};Proj4js.Proj.eqdc={init:function(){if(!this.mode){this.mode=0;}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.sinphi=Math.sin(this.lat1);this.cosphi=Math.cos(this.lat1);this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);if(this.mode!=0){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("eqdc:Init:EqualLatitudes");}this.sinphi=Math.sin(this.lat2);this.cosphi=Math.cos(this.lat2);this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);if(Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN){this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1);}else{this.ns=this.sinphi;}}else{this.ns=this.sinphi;}this.g=this.ml1+this.ms1/this.ns;this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);this.rh=this.a*(this.g-this.ml0);},forward:function(t){var s=t.x;var u=t.y;var o=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,u);var q=this.a*(this.g-o);var l=this.ns*Proj4js.common.adjust_lon(s-this.long0);var m=this.x0+q*Math.sin(l);var r=this.y0+this.rh-q*Math.cos(l);t.x=m;t.y=r;return t;},inverse:function(r){r.x-=this.x0;r.y=this.rh-r.y+this.y0;var l,m;if(this.ns>=0){var m=Math.sqrt(r.x*r.x+r.y*r.y);var l=1;}else{m=-Math.sqrt(r.x*r.x+r.y*r.y);l=-1;}var j=0;if(m!=0){j=Math.atan2(l*r.x,l*r.y);}var o=this.g-m/this.a;var s=this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3);var q=Proj4js.common.adjust_lon(this.long0+j/this.ns);r.x=q;r.y=s;return r;},phi3z:function(o,q,r,s,t){var u;var m;u=o;for(var l=0;l<15;l++){m=(o+r*Math.sin(2*u)-s*Math.sin(4*u)+t*Math.sin(6*u))/q-u;u+=m;if(Math.abs(m)<=1e-10){return u;}}Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null;}};function phi4z(T,N,O,P,Q,H,J,a,S){var M,b,E,D,G,I,K,L,U,F;S=H;for(F=1;F<=15;F++){M=Math.sin(S);tanphi=Math.tan(S);a=tanphi*Math.sqrt(1-T*M*M);b=Math.sin(2*S);D=N*S-O*b+P*Math.sin(4*S)-Q*Math.sin(6*S);G=N-2*O*Math.cos(2*S)+4*P*Math.cos(4*S)-6*Q*Math.cos(6*S);I=2*D+a*(D*D+J)-2*H*(a*D+1);K=T*b*(D*D+J-2*H*D)/(2*a);L=2*(H-D)*(a*G-2/b)-2*G;U=I/(K+L);S+=U;if(Math.abs(U)<=1e-10){return(S);}}Proj4js.reportError("phi4z: No convergence");return null;}function e4fn(f){var e,g;e=1+f;g=1-f;return(Math.sqrt((Math.pow(e,e))*(Math.pow(g,g))));}Proj4js.Proj.poly={init:function(){var b;if(this.lat0=0){this.lat0=90;}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);},forward:function(C){var F,z;var v;var t;var B,w;var D;var r,s;var E=C.x;var u=C.y;B=Proj4js.common.adjust_lon(E-this.long0);if(Math.abs(u)<=1e-7){r=this.x0+this.a*B;s=this.y0-this.a*this.ml0;}else{F=Math.sin(u);z=Math.cos(u);w=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,u);D=Proj4js.common.msfnz(this.e,F,z);B=F;r=this.x0+this.a*D*Math.sin(B)/F;s=this.y0+this.a*(w-this.ml0+D*(1-Math.cos(B))/F);}C.x=r;C.y=s;return C;},inverse:function(C){var r,v;var w;var b;var t;var B,z;var s;var D,u;C.x-=this.x0;C.y-=this.y0;w=this.ml0+C.y/this.a;s=0;if(Math.abs(w)<=1e-7){D=C.x/this.a+this.long0;u=0;}else{b=w*w+(C.x/this.a)*(C.x/this.a);s=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,b,t,u);if(s!=1){return(s);}D=Proj4js.common.adjust_lon((asinz(C.x*t/this.a)/Math.sin(u))+this.long0);}C.x=D;C.y=u;return C;}};Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE;Proj4js.Proj.gstmerc={init:function(){var g=this.b/this.a;this.e=Math.sqrt(1-g*g);this.lc=this.long0;this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var j=Math.sin(this.lat0);var f=Math.asin(j/this.rs);var h=Math.sin(f);this.cp=Proj4js.common.latiso(0,f,h)-this.rs*Proj4js.common.latiso(this.e,this.lat0,j);this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*j*j);this.xs=this.x0;this.ys=this.y0-this.n2*f;if(!this.title){this.title="Gauss Schreiber transverse mercator";}},forward:function(q){var m=q.x;var r=q.y;var l=this.rs*(m-this.lc);var j=this.cp+(this.rs*Proj4js.common.latiso(this.e,r,Math.sin(r)));var o=Math.asin(Math.sin(l)/Proj4js.common.cosh(j));var s=Proj4js.common.latiso(0,o,Math.sin(o));q.x=this.xs+(this.n2*s);q.y=this.ys+(this.n2*Math.atan(Proj4js.common.sinh(j)/Math.cos(l)));return q;},inverse:function(o){var h=o.x;var l=o.y;var j=Math.atan(Proj4js.common.sinh((h-this.xs)/this.n2)/Math.cos((l-this.ys)/this.n2));var m=Math.asin(Math.sin((l-this.ys)/this.n2)/Proj4js.common.cosh((h-this.xs)/this.n2));var q=Proj4js.common.latiso(0,m,Math.sin(m));o.x=this.lc+j/this.rs;o.y=Proj4js.common.invlatiso(this.e,(q-this.cp)/this.rs);return o;}};Proj4js.Proj.ortho={init:function(b){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);},forward:function(B){var D,z;var g;var r;var w;var v;var C=B.x;var u=B.y;g=Proj4js.common.adjust_lon(C-this.long0);D=Math.sin(u);z=Math.cos(u);r=Math.cos(g);v=this.sin_p14*D+this.cos_p14*z*r;w=1;if((v>0)||(Math.abs(v)<=Proj4js.common.EPSLN)){var s=this.a*w*z*Math.sin(g);var t=this.y0+this.a*w*(this.cos_p14*D-this.sin_p14*z*r);}else{Proj4js.reportError("orthoFwdPointError");}B.x=s;B.y=t;return B;},inverse:function(v){var q;var r;var t,m;var o;var u;var w,s;v.x-=this.x0;v.y-=this.y0;q=Math.sqrt(v.x*v.x+v.y*v.y);if(q>this.a+1e-7){Proj4js.reportError("orthoInvDataError");}r=Proj4js.common.asinz(q/this.a);t=Math.sin(r);cosi=Math.cos(r);w=this.long0;if(Math.abs(q)<=Proj4js.common.EPSLN){s=this.lat0;}s=Proj4js.common.asinz(m*this.sin_p14+(y*t*this.cos_p14)/q);u=Math.abs(lat0)-Proj4js.common.HALF_PI;if(Math.abs(u)<=Proj4js.common.EPSLN){if(this.lat0>=0){w=Proj4js.common.adjust_lon(this.long0+Math.atan2(v.x,-v.y));}else{w=Proj4js.common.adjust_lon(this.long0-Math.atan2(-v.x,v.y));}}u=m-this.sin_p14*Math.sin(s);if((Math.abs(u)>=Proj4js.common.EPSLN)||(Math.abs(x)>=Proj4js.common.EPSLN)){w=Proj4js.common.adjust_lon(this.long0+Math.atan2((v.x*t*this.cos_p14),(u*q)));}v.x=w;v.y=s;return v;}};Proj4js.Proj.somerc={init:function(){var e=this.lat0;this.lambda0=this.long0;var l=Math.sin(e);var r=this.a;var s=this.rf;var q=1/s;var m=2*q-Math.pow(q,2);var o=this.e=Math.sqrt(m);this.R=r*Math.sqrt(1-m)/(1-m*Math.pow(l,2));this.alpha=Math.sqrt(1+m/(1-m)*Math.pow(Math.cos(e),4));this.b0=Math.asin(l/this.alpha);
this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+e/2))+this.alpha*o/2*Math.log((1+o*l)/(1-o*l));},forward:function(r){var m=Math.log(Math.tan(Math.PI/4-r.y/2));var q=this.e/2*Math.log((1+this.e*Math.sin(r.y))/(1-this.e*Math.sin(r.y)));var t=-this.alpha*(m+q)+this.K;var b=2*(Math.atan(Math.exp(t))-Math.PI/4);var u=this.alpha*(r.x-this.lambda0);var o=Math.atan(Math.sin(u)/(Math.sin(this.b0)*Math.tan(b)+Math.cos(this.b0)*Math.cos(u)));var s=Math.asin(Math.cos(this.b0)*Math.sin(b)-Math.sin(this.b0)*Math.cos(b)*Math.cos(u));r.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0;r.x=this.R*o+this.x0;return r;},inverse:function(D){var E=D.x-this.x0;var C=D.y-this.y0;var s=E/this.R;var B=2*(Math.atan(Math.exp(C/this.R))-Math.PI/4);var u=Math.asin(Math.cos(this.b0)*Math.sin(B)+Math.sin(this.b0)*Math.cos(B)*Math.cos(s));var t=Math.atan(Math.sin(s)/(Math.cos(this.b0)*Math.cos(s)-Math.sin(this.b0)*Math.tan(B)));var v=this.lambda0+t/this.alpha;var w=0;var b=u;var F=-1000;var z=0;while(Math.abs(b-F)>1e-7){if(++z>20){Proj4js.reportError("omercFwdInfinity");return;}w=1/this.alpha*(Math.log(Math.tan(Math.PI/4+u/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(b))/2));F=b;b=2*Math.atan(Math.exp(w))-Math.PI/2;}D.x=v;D.y=b;return D;}};Proj4js.Proj.stere={ssfn_:function(f,g,e){g*=e;return(Math.tan(0.5*(Proj4js.common.HALF_PI+f))*Math.pow((1-g)/(1+g),0.5*e));},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var e=Math.abs(this.lat0);if((Math.abs(e)-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.mode=this.lat0<0?this.S_POLE:this.N_POLE;}else{this.mode=e>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT;}this.phits=Math.abs(this.phits);if(this.es){var d;switch(this.mode){case this.N_POLE:case this.S_POLE:if(Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e));}else{e=Math.sin(this.phits);this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,e);e*=this.e;this.akm1/=Math.sqrt(1-e*e);}break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:e=Math.sin(this.lat0);d=2*Math.atan(this.ssfn_(this.lat0,e,this.e))-Proj4js.common.HALF_PI;e*=this.e;this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-e*e);this.sinX1=Math.sin(d);this.cosX1=Math.cos(d);break;}}else{switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-0.5*this.phits):2*this.k0;break;}}},forward:function(u){var v=u.x;var r=u.y;var m,q;if(this.sphere){var w,t,o,s;w=Math.sin(r);t=Math.cos(r);o=Math.cos(v);s=Math.sin(v);switch(this.mode){case this.EQUIT:q=1+t*o;if(q<=Proj4js.common.EPSLN){F_ERROR;}q=this.akm1/q;m=q*t*s;q*=w;break;case this.OBLIQ:q=1+this.sinph0*w+this.cosph0*t*o;if(q<=Proj4js.common.EPSLN){F_ERROR;}q=this.akm1/q;m=q*t*s;q*=this.cosph0*w-this.sinph0*t*o;break;case this.N_POLE:o=-o;r=-r;case this.S_POLE:if(Math.abs(r-Proj4js.common.HALF_PI)<this.TOL){F_ERROR;}q=this.akm1*Math.tan(Proj4js.common.FORTPI+0.5*r);m=s*q;q*=o;break;}}else{o=Math.cos(v);s=Math.sin(v);w=Math.sin(r);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){X=2*Math.atan(this.ssfn_(r,w,this.e));sinX=Math.sin(X-Proj4js.common.HALF_PI);cosX=Math.cos(X);}switch(this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*o));q=A*(this.cosX1*sinX-this.sinX1*cosX*o);m=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*o);q=A*sinX;m=A*cosX;break;case this.S_POLE:r=-r;o=-o;w=-w;case this.N_POLE:m=this.akm1*Proj4js.common.tsfnz(this.e,r,w);q=-m*o;break;}m=m*s;}u.x=m*this.a+this.x0;u.y=q*this.a+this.y0;return u;},inverse:function(J){var O=(J.x-this.x0)/this.a;var z=(J.y-this.y0)/this.a;var K,B;var F,L,P=0,I=0,w,G=0,D=0;var E;if(this.sphere){var C,N,H,M;N=Math.sqrt(O*O+z*z);C=2*Math.atan(N/this.akm1);H=Math.sin(C);M=Math.cos(C);K=0;switch(this.mode){case this.EQUIT:if(Math.abs(N)<=Proj4js.common.EPSLN){B=0;}else{B=Math.asin(z*H/N);}if(M!=0||O!=0){K=Math.atan2(O*H,M*N);}break;case this.OBLIQ:if(Math.abs(N)<=Proj4js.common.EPSLN){B=this.phi0;}else{B=Math.asin(M*sinph0+z*H*cosph0/N);}C=M-sinph0*Math.sin(B);if(C!=0||O!=0){K=Math.atan2(O*H*cosph0,C*N);}break;case this.N_POLE:z=-z;case this.S_POLE:if(Math.abs(N)<=Proj4js.common.EPSLN){B=this.phi0;}else{B=Math.asin(this.mode==this.S_POLE?-M:M);}K=(O==0&&z==0)?0:Math.atan2(O,z);break;}}else{w=Math.sqrt(O*O+z*z);switch(this.mode){case this.OBLIQ:case this.EQUIT:P=2*Math.atan2(w*this.cosX1,this.akm1);F=Math.cos(P);L=Math.sin(P);if(w==0){I=Math.asin(F*this.sinX1);}else{I=Math.asin(F*this.sinX1+(z*L*this.cosX1/w));}P=Math.tan(0.5*(Proj4js.common.HALF_PI+I));O*=L;z=w*this.cosX1*F-z*this.sinX1*L;D=Proj4js.common.HALF_PI;G=0.5*this.e;break;case this.N_POLE:z=-z;case this.S_POLE:P=-w/this.akm1;I=Proj4js.common.HALF_PI-2*Math.atan(P);D=-Proj4js.common.HALF_PI;G=-0.5*this.e;break;}for(E=this.NITER;E--;I=B){L=this.e*Math.sin(I);B=2*Math.atan(P*Math.pow((1+L)/(1-L),G))-D;if(Math.abs(I-B)<this.CONV){if(this.mode==this.S_POLE){B=-B;}K=(O==0&&z==0)?0:Math.atan2(O,z);J.x=K;J.y=B;return J;}}}}};Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array();this.A[1]=+0.6399175073;this.A[2]=-0.1358797613;this.A[3]=+0.063294409;this.A[4]=-0.02526853;this.A[5]=+0.0117879;this.A[6]=-0.0055161;this.A[7]=+0.0026906;this.A[8]=-0.001333;this.A[9]=+0.00067;this.A[10]=-0.00034;this.B_re=new Array();this.B_im=new Array();this.B_re[1]=+0.7557853228;this.B_im[1]=0;this.B_re[2]=+0.249204646;this.B_im[2]=+0.003371507;this.B_re[3]=-0.001541739;this.B_im[3]=+0.04105856;this.B_re[4]=-0.10162907;this.B_im[4]=+0.01727609;this.B_re[5]=-0.26623489;this.B_im[5]=-0.36249218;this.B_re[6]=-0.6870983;this.B_im[6]=-1.1651967;this.C_re=new Array();this.C_im=new Array();this.C_re[1]=+1.3231270439;this.C_im[1]=0;this.C_re[2]=-0.577245789;this.C_im[2]=-0.007809598;this.C_re[3]=+0.508307513;this.C_im[3]=-0.112208952;this.C_re[4]=-0.15094762;this.C_im[4]=+0.18200602;this.C_re[5]=+1.01418179;this.C_im[5]=+1.64497696;this.C_re[6]=+1.9660549;this.C_im[6]=+2.5127645;this.D=new Array();this.D[1]=+1.5627014243;this.D[2]=+0.5185406398;this.D[3]=-0.03333098;this.D[4]=-0.1052906;this.D[5]=-0.0368594;this.D[6]=+0.007317;this.D[7]=+0.0122;this.D[8]=+0.00394;this.D[9]=-0.0013;},forward:function(J){var K=J.x;var P=J.y;var M=P-this.lat0;var D=K-this.long0;var I=M/Proj4js.common.SEC_TO_RAD*0.00001;var L=D;var B=1;var E=0;for(n=1;n<=10;n++){B=B*I;E=E+this.A[n]*B;}var C=E;var G=L;var z=1;var F=0;var N;var H;var O=0;var w=0;for(n=1;n<=6;n++){N=z*C-F*G;H=F*C+z*G;z=N;F=H;O=O+this.B_re[n]*z-this.B_im[n]*F;w=w+this.B_im[n]*z+this.B_re[n]*F;}x=(w*this.a)+this.x0;y=(O*this.a)+this.y0;J.x=x;J.y=y;return J;},inverse:function(O){var V=O.x;var W=O.y;var Y=V-this.x0;var Z=W-this.y0;var aa=Z/this.a;var aj=Y/this.a;var af=1;var L=0;var ai;var P;var ae=0;var an=0;for(n=1;n<=6;n++){ai=af*aa-L*aj;P=L*aa+af*aj;af=ai;L=P;ae=ae+this.C_re[n]*af-this.C_im[n]*L;an=an+this.C_im[n]*af+this.C_re[n]*L;}for(i=0;i<this.iterations;i++){var T=ae;var ag=an;var ac;var Q;var al=aa;var S=aj;for(n=2;n<=6;n++){ac=T*ae-ag*an;Q=ag*ae+T*an;T=ac;ag=Q;al=al+(n-1)*(this.B_re[n]*T-this.B_im[n]*ag);S=S+(n-1)*(this.B_im[n]*T+this.B_re[n]*ag);}T=1;ag=0;var am=this.B_re[1];var U=this.B_im[1];for(n=2;n<=6;n++){ac=T*ae-ag*an;Q=ag*ae+T*an;T=ac;ag=Q;am=am+n*(this.B_re[n]*T-this.B_im[n]*ag);U=U+n*(this.B_im[n]*T+this.B_re[n]*ag);}var ak=am*am+U*U;ae=(al*am+S*U)/ak;an=(S*am-al*U)/ak;}var K=ae;var ab=an;var N=1;var M=0;for(n=1;n<=9;n++){N=N*K;M=M+this.D[n]*N;}var ad=this.lat0+(M*Proj4js.common.SEC_TO_RAD*100000);var ah=this.long0+ab;O.x=ah;O.y=ad;return O;}};Proj4js.Proj.mill={init:function(){},forward:function(o){var m=o.x;var q=o.y;var h=Proj4js.common.adjust_lon(m-this.long0);var j=this.x0+this.a*h;
var l=this.y0+this.a*Math.log(Math.tan((Proj4js.common.PI/4)+(q/2.5)))*1.25;o.x=j;o.y=l;return o;},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var g=Proj4js.common.adjust_lon(this.long0+e.x/this.a);var f=2.5*(Math.atan(Math.exp(0.8*e.y/this.a))-Proj4js.common.PI/4);e.x=g;e.y=f;return e;}};Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(!this.zone){Proj4js.reportError("utm:init: zone must be specified for UTM");return;}this.lat0=0;this.long0=((6*Math.abs(this.zone))-183)*Proj4js.common.D2R;this.x0=500000;this.y0=this.utmSouth?10000000:0;this.k0=0.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse;}};var GEOCENT_LAT_ERROR=1;var COS_67P5=0.3826834323650898;var AD_C=1.0026;function cs_geodetic_to_geocentric(u,F){var s=F.x;var z=F.y;var E=F.z;var D;var G;var H;var v=0;var t;var w;var B;var C;if(z<-HALF_PI&&z>-1.001*HALF_PI){z=-HALF_PI;}else{if(z>HALF_PI&&z<1.001*HALF_PI){z=HALF_PI;}else{if((z<-HALF_PI)||(z>HALF_PI)){v|=GEOCENT_LAT_ERROR;}}}if(!v){if(s>PI){s-=(2*PI);}w=Math.sin(z);C=Math.cos(z);B=w*w;t=u.a/(Math.sqrt(1-u.es*B));D=(t+E)*C*Math.cos(s);G=(t+E)*C*Math.sin(s);H=((t*(1-u.es))+E)*w;}F.x=D;F.y=G;F.z=H;return v;}function cs_geocentric_to_geodetic(P,E){var Y=E.x;var Z=E.y;var ab=E.z;var U;var F;var M;var W;var I;var G;var J;var Q;var T;var S;var K;var V;var L;var O;var H;var N;var aa;Y=parseFloat(Y);Z=parseFloat(Z);ab=parseFloat(ab);aa=false;if(Y!=0){U=Math.atan2(Z,Y);}else{if(Z>0){U=HALF_PI;}else{if(Z<0){U=-HALF_PI;}else{aa=true;U=0;if(ab>0){F=HALF_PI;}else{if(ab<0){F=-HALF_PI;}else{F=HALF_PI;M=-P.b;return;}}}}}I=Y*Y+Z*Z;W=Math.sqrt(I);G=ab*AD_C;Q=Math.sqrt(G*G+I);S=G/Q;V=W/Q;K=S*S*S;J=ab+P.b*P.ep2*K;N=W-P.a*P.es*V*V*V;T=Math.sqrt(J*J+N*N);L=J/T;O=N/T;H=P.a/Math.sqrt(1-P.es*L*L);if(O>=COS_67P5){M=W/O-H;}else{if(O<=-COS_67P5){M=W/-O-H;}else{M=ab/L+H*(P.es-1);}}if(aa==false){F=Math.atan(L/O);}E.x=U;E.y=F;E.z=M;return 0;}function cs_geocentric_to_wgs84(v,E){if(v.datum_type==PJD_3PARAM){E.x+=v.datum_params[0];E.y+=v.datum_params[1];E.z+=v.datum_params[2];}else{var z=v.datum_params[0];var C=v.datum_params[1];var t=v.datum_params[2];var B=v.datum_params[3];var s=v.datum_params[4];var u=v.datum_params[5];var w=v.datum_params[6];var D=w*(E.x-u*E.y+s*E.z)+z;var F=w*(u*E.x+E.y-B*E.z)+C;var r=w*(-s*E.x+B*E.y+E.z)+t;E.x=D;E.y=F;E.z=r;}}function cs_geocentric_from_wgs84(u,D){if(u.datum_type==PJD_3PARAM){D.x-=u.datum_params[0];D.y-=u.datum_params[1];D.z-=u.datum_params[2];}else{var w=u.datum_params[0];var C=u.datum_params[1];var s=u.datum_params[2];var z=u.datum_params[3];var r=u.datum_params[4];var t=u.datum_params[5];var v=u.datum_params[6];var B=(D.x-w)/v;var E=(D.y-C)/v;var F=(D.z-s)/v;D.x=B+t*E-r*F;D.y=-t*B+E+z*F;D.z=r*B-z*E+F;}}Proj4js.Proj.vandg={init:function(){this.R=6370997;},forward:function(G){var I=G.x;var N=G.y;var J=Proj4js.common.adjust_lon(I-this.long0);var K,M;if(Math.abs(N)<=Proj4js.common.EPSLN){K=this.x0+this.R*J;M=this.y0;}var E=Proj4js.common.asinz(2*Math.abs(N/Proj4js.common.PI));if((Math.abs(J)<=Proj4js.common.EPSLN)||(Math.abs(Math.abs(N)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)){K=this.x0;if(N>=0){M=this.y0+Proj4js.common.PI*this.R*Math.tan(0.5*E);}else{M=this.y0+Proj4js.common.PI*this.R*-Math.tan(0.5*E);}}var m=0.5*Math.abs((Proj4js.common.PI/J)-(J/Proj4js.common.PI));var F=m*m;var g=Math.sin(E);var z=Math.cos(E);var B=z/(g+z-1);var C=B*B;var D=B*(2/g-1);var L=D*D;var H=Proj4js.common.PI*this.R*(m*(B-L)+Math.sqrt(F*(B-L)*(B-L)-(L+F)*(C-L)))/(L+F);if(J<0){H=-H;}K=this.x0+H;H=Math.abs(H/(Proj4js.common.PI*this.R));if(N>=0){M=this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-H*H-2*m*H);}else{M=this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-H*H-2*m*H);}G.x=K;G.y=M;return G;},inverse:function(F){var J;var I,v,K,B,C,D;var z,E;var G;var L;var H;var d;var w;F.x-=this.x0;F.y-=this.y0;H=Proj4js.common.PI*this.R;I=F.x/H;v=F.y/H;K=I*I+v*v;B=-Math.abs(v)*(1+K);C=B-2*v*v+I*I;D=-2*B+1+2*v*v+K*K;w=v*v/D+(2*C*C*C/D/D/D-9*B*C/D/D)/27;G=(B-C*C/3/D)/D;L=2*Math.sqrt(-G/3);H=((3*w)/G)/L;if(Math.abs(H)>1){if(H>=0){H=1;}else{H=-1;}}d=Math.acos(H)/3;if(F.y>=0){lat=(-L*Math.cos(d+Proj4js.common.PI/3)-C/3/D)*Proj4js.common.PI;}else{lat=-(-L*Math.cos(d+PI/3)-C/3/D)*Proj4js.common.PI;}if(Math.abs(I)<Proj4js.common.EPSLN){lon=this.long0;}lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(K-1+Math.sqrt(1+2*(I*I-v*v)+K*K))/2/I);F.x=lon;F.y=lat;return F;}};Proj4js.Proj.eqc={init:function(){if(!this.x0){this.x0=0;}if(!this.y0){this.y0=0;}if(!this.lat0){this.lat0=0;}if(!this.long0){this.long0=0;}if(!this.lat_ts){this.lat_ts=0;}if(!this.title){this.title="Equidistant Cylindrical (Plate Carre)";}this.rc=Math.cos(this.lat_ts);},forward:function(l){var j=l.x;var m=l.y;var g=Proj4js.common.adjust_lon(j-this.long0);var h=Proj4js.common.adjust_lat(m-this.lat0);l.x=this.x0+(this.a*g*this.rc);l.y=this.y0+(this.a*h);return l;},inverse:function(e){var f=e.x;var g=e.y;e.x=Proj4js.common.adjust_lon(this.long0+((f-this.x0)/(this.a*this.rc)));e.y=Proj4js.common.adjust_lat(this.lat0+((g-this.y0)/(this.a)));return e;}};Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0);cphi=Math.cos(this.lat0);cphi*=cphi;this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi);this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es));this.phic0=Math.asin(sphi/this.C);this.ratexp=0.5*this.C*this.e;this.K=Math.tan(0.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(0.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp));},forward:function(e){var g=e.x;var f=e.y;e.y=2*Math.atan(this.K*Math.pow(Math.tan(0.5*f+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(f),this.ratexp))-Proj4js.common.HALF_PI;e.x=this.C*g;return e;},inverse:function(l){var m=1e-14;var j=l.x/this.C;var g=l.y;num=Math.pow(Math.tan(0.5*g+Proj4js.common.FORTPI)/this.K,1/this.C);for(var h=Proj4js.common.MAX_ITER;h>0;--h){g=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(l.y),-0.5*this.e))-Proj4js.common.HALF_PI;if(Math.abs(g-l.y)<m){break;}l.y=g;}if(!h){Proj4js.reportError("gauss:inverse:convergence failed");return null;}l.x=j;l.y=g;return l;}};Proj4js.Proj.omerc={init:function(){if(!this.mode){this.mode=0;}if(!this.lon1){this.lon1=0;this.mode=1;}if(!this.lon2){this.lon2=0;}if(!this.lat2){this.lat2=0;}var f=this.b/this.a;var g=1-Math.pow(f,2);var e=Math.sqrt(g);this.sin_p20=Math.sin(this.lat0);this.cos_p20=Math.cos(this.lat0);this.con=1-this.es*this.sin_p20*this.sin_p20;this.com=Math.sqrt(1-g);this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-g));this.al=this.a*this.bl*this.k0*this.com/this.con;if(Math.abs(this.lat0)<Proj4js.common.EPSLN){this.ts=1;this.d=1;this.el=1;}else{this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20);this.con=Math.sqrt(this.con);this.d=this.bl*this.com/(this.cos_p20*this.con);if((this.d*this.d-1)>0){if(this.lat0>=0){this.f=this.d+Math.sqrt(this.d*this.d-1);}else{this.f=this.d-Math.sqrt(this.d*this.d-1);}}else{this.f=this.d;}this.el=this.f*Math.pow(this.ts,this.bl);}if(this.mode!=0){this.g=0.5*(this.f-1/this.f);this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d);this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl;this.con=Math.abs(this.lat0);if((this.con>Proj4js.common.EPSLN)&&(Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN)){this.singam=Math.sin(this.gama);this.cosgam=Math.cos(this.gama);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}}else{Proj4js.reportError("omerc:Init:DataError");}}else{this.sinphi=Math.sin(this.at1);this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi);this.sinphi=Math.sin(this.lat2);this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi);this.h=Math.pow(this.ts1,this.bl);this.l=Math.pow(this.ts2,this.bl);this.f=this.el/this.h;this.g=0.5*(this.f-1/this.f);this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h);
this.p=(this.l-this.h)/(this.l+this.h);this.dlon=this.lon1-this.lon2;if(this.dlon<-Proj4js.common.PI){this.lon2=this.lon2-2*Proj4js.common.PI;}if(this.dlon>Proj4js.common.PI){this.lon2=this.lon2+2*Proj4js.common.PI;}this.dlon=this.lon1-this.lon2;this.longc=0.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(0.5*this.bl*this.dlon)/this.p)/this.bl;this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc);this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g);this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama));if(Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError");}else{this.con=Math.abs(this.lat1);}if((this.con<=Proj4js.common.EPSLN)||(Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN)){Proj4js.reportError("omercInitDataError");}else{if(Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError");}}this.singam=Math.sin(this.gam);this.cosgam=Math.cos(this.gam);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz);}}},forward:function(S){var V;var ab,q;var s;var J,M,ac;var Z,Q,N;var b,U,L;var K,O;var t;var ad;var Y;var aa=S.x;var W=S.y;ab=Math.sin(W);ad=Proj4js.common.adjust_lon(aa-this.longc);L=Math.sin(this.bl*ad);if(Math.abs(Math.abs(W)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){Y=Proj4js.common.tsfnz(this.e,W,ab);b=this.el/(Math.pow(Y,this.bl));t=0.5*(b-1/b);M=0.5*(b+1/b);K=(t*this.singam-L*this.cosgam)/M;Z=Math.cos(this.bl*ad);if(Math.abs(Z)<1e-7){U=this.al*this.bl*ad;}else{U=this.al*Math.atan((t*this.cosgam+L*this.singam)/Z)/this.bl;if(Z<0){U=U+Proj4js.common.PI*this.al/this.bl;}}}else{if(W>=0){K=this.singam;}else{K=-this.singam;}U=this.al*W/this.bl;}if(Math.abs(Math.abs(K)-1)<=Proj4js.common.EPSLN){Proj4js.reportError("omercFwdInfinity");}O=0.5*this.al*Math.log((1-K)/(1+K))/this.bl;U=U-this.u;var P=this.x0+O*this.cosaz+U*this.sinaz;var T=this.y0+U*this.cosaz-O*this.sinaz;S.x=P;S.y=T;return S;},inverse:function(K){var q;var W;var aa;var ab,s;var J;var N,T,ac;var Z,t,P;var b,V,M,Q,Y;var O,U,L;var ad;var S;K.x-=this.x0;K.y-=this.y0;S=0;b=K.x*this.cosaz-K.y*this.sinaz;V=K.y*this.cosaz+K.x*this.sinaz;V=V+this.u;M=Math.exp(-this.bl*b/this.al);Q=0.5*(M-1/M);T=0.5*(M+1/M);O=Math.sin(this.bl*V/this.al);U=(O*this.cosgam+Q*this.singam)/T;if(Math.abs(Math.abs(U)-1)<=Proj4js.common.EPSLN){lon=this.longc;if(U>=0){lat=Proj4js.common.HALF_PI;}else{lat=-Proj4js.common.HALF_PI;}}else{Z=1/this.bl;Y=Math.pow((this.el/Math.sqrt((1+U)/(1-U))),Z);lat=Proj4js.common.phi2z(this.e,Y);W=this.longc-Math.atan2((Q*this.cosgam-O*this.singam),Z)/this.bl;lon=Proj4js.common.adjust_lon(W);}K.x=lon;K.y=lat;return K;}};Proj4js.Proj.lcc={init:function(){if(!this.lat2){this.lat2=this.lat0;}if(!this.k0){this.k0=1;}if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("lcc:init: Equal Latitudes");return;}var o=this.b/this.a;this.e=Math.sqrt(1-o*o);var s=Math.sin(this.lat1);var u=Math.cos(this.lat1);var q=Proj4js.common.msfnz(this.e,s,u);var z=Proj4js.common.tsfnz(this.e,this.lat1,s);var t=Math.sin(this.lat2);var v=Math.cos(this.lat2);var r=Proj4js.common.msfnz(this.e,t,v);var B=Proj4js.common.tsfnz(this.e,this.lat2,t);var w=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns=Math.log(q/r)/Math.log(z/B);}else{this.ns=s;}this.f0=q/(this.ns*Math.pow(z,this.ns));this.rh=this.a*this.f0*Math.pow(w,this.ns);if(!this.title){this.title="Lambert Conformal Conic";}},forward:function(m){var l=m.x;var o=m.y;if(o<=90&&o>=-90&&l<=180&&l>=-180){}else{Proj4js.reportError("lcc:forward: llInputOutOfRange: "+l+" : "+o);return null;}var j=Math.abs(Math.abs(o)-Proj4js.common.HALF_PI);var q;if(j>Proj4js.common.EPSLN){q=Proj4js.common.tsfnz(this.e,o,Math.sin(o));rh1=this.a*this.f0*Math.pow(q,this.ns);}else{j=o*this.ns;if(j<=0){Proj4js.reportError("lcc:forward: No Projection");return null;}rh1=0;}var h=this.ns*Proj4js.common.adjust_lon(l-this.long0);m.x=this.k0*(rh1*Math.sin(h))+this.x0;m.y=this.k0*(this.rh-rh1*Math.cos(h))+this.y0;return m;},inverse:function(q){var m,l,s;var r,o;x=(q.x-this.x0)/this.k0;y=(this.rh-(q.y-this.y0)/this.k0);if(this.ns>0){m=Math.sqrt(x*x+y*y);l=1;}else{m=-Math.sqrt(x*x+y*y);l=-1;}var j=0;if(m!=0){j=Math.atan2((l*x),(l*y));}if((m!=0)||(this.ns>0)){l=1/this.ns;s=Math.pow((m/(this.a*this.f0)),l);r=Proj4js.common.phi2z(this.e,s);if(r==-9999){return null;}}else{r=-Proj4js.common.HALF_PI;}o=Proj4js.common.adjust_lon(j/this.ns+this.long0);q.x=o;q.y=r;return q;}};Proj4js.Proj.laea={init:function(){this.sin_lat_o=Math.sin(this.lat0);this.cos_lat_o=Math.cos(this.lat0);},forward:function(E){var F=E.x;var v=E.y;var B=Proj4js.common.adjust_lon(F-this.long0);var g=Math.sin(v);var u=Math.cos(v);var D=Math.sin(B);var C=Math.cos(B);var w=this.sin_lat_o*g+this.cos_lat_o*u*C;if(w==-1){Proj4js.reportError("laea:fwd:Point projects to a circle of radius "+2*R);return null;}var z=this.a*Math.sqrt(2/(1+w));var s=z*u*D+this.x0;var t=z*(this.cos_lat_o*g-this.sin_lat_o*u*C)+this.y0;E.x=s;E.y=t;return E;},inverse:function(r){r.x-=this.x0;r.y-=this.y0;var t=Math.sqrt(r.x*r.x+r.y*r.y);var u=t/(2*this.a);if(u>1){Proj4js.reportError("laea:Inv:DataError");return null;}var o=2*Proj4js.common.asinz(u);var l=Math.sin(o);var m=Math.cos(o);var q=this.long0;if(Math.abs(t)>Proj4js.common.EPSLN){var s=Proj4js.common.asinz(this.sin_lat_o*m+this.cos_lat_o*l*r.y/t);var u=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(u)>Proj4js.common.EPSLN){u=m-this.sin_lat_o*Math.sin(s);if(u!=0){q=Proj4js.common.adjust_lon(this.long0+Math.atan2(r.x*l*this.cos_lat_o,u*t));}}else{if(this.lat0<0){q=Proj4js.common.adjust_lon(this.long0-Math.atan2(-r.x,r.y));}else{q=Proj4js.common.adjust_lon(this.long0+Math.atan2(r.x,-r.y));}}}else{s=this.lat0;}r.x=q;r.y=s;return r;}};Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);this.cos_p12=Math.cos(this.lat0);},forward:function(w){var z=w.x;var r=w.y;var u;var B=Math.sin(w.y);var v=Math.cos(w.y);var g=Proj4js.common.adjust_lon(z-this.long0);var q=Math.cos(g);var t=this.sin_p12*B+this.cos_p12*v*q;if(Math.abs(Math.abs(t)-1)<Proj4js.common.EPSLN){u=1;if(t<0){Proj4js.reportError("aeqd:Fwd:PointError");return;}}else{var s=Math.acos(t);u=s/Math.sin(s);}w.x=this.x0+this.a*u*v*Math.sin(g);w.y=this.y0+this.a*u*(this.cos_p12*B-this.sin_p12*v*q);return w;},inverse:function(v){v.x-=this.x0;v.y-=this.y0;var q=Math.sqrt(v.x*v.x+v.y*v.y);if(q>(2*Proj4js.common.HALF_PI*this.a)){Proj4js.reportError("aeqdInvDataError");return;}var s=q/this.a;var t=Math.sin(s);var m=Math.cos(s);var w=this.long0;var r;if(Math.abs(q)<=Proj4js.common.EPSLN){r=this.lat0;}else{r=Proj4js.common.asinz(m*this.sin_p12+(v.y*t*this.cos_p12)/q);var u=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(u)<=Proj4js.common.EPSLN){if(lat0>=0){w=Proj4js.common.adjust_lon(this.long0+Math.atan2(v.x,-v.y));}else{w=Proj4js.common.adjust_lon(this.long0-Math.atan2(-v.x,v.y));}}else{u=m-this.sin_p12*Math.sin(r);if((Math.abs(u)<Proj4js.common.EPSLN)&&(Math.abs(v.x)<Proj4js.common.EPSLN)){}else{var o=Math.atan2((v.x*t*this.cos_p12),(u*q));w=Proj4js.common.adjust_lon(this.long0+Math.atan2((v.x*t*this.cos_p12),(u*q)));}}}v.x=w;v.y=r;return v;}};Proj4js.Proj.moll={init:function(){},forward:function(w){var B=w.x;var r=w.y;var t=Proj4js.common.adjust_lon(B-this.long0);var u=r;var v=Proj4js.common.PI*Math.sin(r);for(var s=0;;s++){var z=-(u+Math.sin(u)-v)/(1+Math.cos(u));u+=z;if(Math.abs(z)<Proj4js.common.EPSLN){break;}if(s>=50){Proj4js.reportError("moll:Fwd:IterationError");}}u/=2;if(Proj4js.common.PI/2-Math.abs(r)<Proj4js.common.EPSLN){t=0;}var o=0.900316316158*this.a*t*Math.cos(u)+this.x0;var q=1.4142135623731*this.a*Math.sin(u)+this.y0;w.x=o;w.y=q;return w;},inverse:function(l){var g;var h;l.x-=this.x0;var h=l.y/(1.4142135623731*this.a);if(Math.abs(h)>0.999999999999){h=0.999999999999;
}var g=Math.asin(h);var j=Proj4js.common.adjust_lon(this.long0+(l.x/(0.900316316158*this.a*Math.cos(g))));if(j<(-Proj4js.common.PI)){j=-Proj4js.common.PI;}if(j>Proj4js.common.PI){j=Proj4js.common.PI;}h=(2*g+Math.sin(2*g))/Proj4js.common.PI;if(Math.abs(h)>1){h=1;}var m=Math.asin(h);l.x=j;l.y=m;return l;}};var OpenLayers={singleFile:true};(function(){var t=(typeof OpenLayers=="object"&&OpenLayers.singleFile);var D;window.OpenLayers={_scriptName:(!t)?"lib/OpenLayers.js":"OpenLayers.js",_getScriptLocation:function(){if(D!=undefined){return D;}D="";var a=new RegExp("(^|(.*?\\/))("+OpenLayers._scriptName+")(\\?|$)");var g=document.getElementsByTagName("script");for(var d=0,f=g.length;d<f;d++){var b=g[d].getAttribute("src");if(b){var e=b.match(a);if(e){D=e[1];break;}}}return D;}};if(!t){var s=new Array("OpenLayers/Util.js","OpenLayers/BaseTypes.js","OpenLayers/BaseTypes/Class.js","OpenLayers/BaseTypes/Bounds.js","OpenLayers/BaseTypes/Element.js","OpenLayers/BaseTypes/LonLat.js","OpenLayers/BaseTypes/Pixel.js","OpenLayers/BaseTypes/Size.js","OpenLayers/Console.js","OpenLayers/Tween.js","Rico/Corner.js","Rico/Color.js","OpenLayers/Ajax.js","OpenLayers/Events.js","OpenLayers/Request.js","OpenLayers/Request/XMLHttpRequest.js","OpenLayers/Projection.js","OpenLayers/Map.js","OpenLayers/Layer.js","OpenLayers/Icon.js","OpenLayers/Marker.js","OpenLayers/Marker/Box.js","OpenLayers/Popup.js","OpenLayers/Tile.js","OpenLayers/Tile/Image.js","OpenLayers/Tile/Image/IFrame.js","OpenLayers/Tile/WFS.js","OpenLayers/Layer/Image.js","OpenLayers/Layer/SphericalMercator.js","OpenLayers/Layer/EventPane.js","OpenLayers/Layer/FixedZoomLevels.js","OpenLayers/Layer/Google.js","OpenLayers/Layer/Google/v3.js","OpenLayers/Layer/VirtualEarth.js","OpenLayers/Layer/Yahoo.js","OpenLayers/Layer/HTTPRequest.js","OpenLayers/Layer/Grid.js","OpenLayers/Layer/MapGuide.js","OpenLayers/Layer/MapServer.js","OpenLayers/Layer/MapServer/Untiled.js","OpenLayers/Layer/KaMap.js","OpenLayers/Layer/KaMapCache.js","OpenLayers/Layer/MultiMap.js","OpenLayers/Layer/Markers.js","OpenLayers/Layer/Text.js","OpenLayers/Layer/WorldWind.js","OpenLayers/Layer/ArcGIS93Rest.js","OpenLayers/Layer/WMS.js","OpenLayers/Layer/WMS/Untiled.js","OpenLayers/Layer/WMS/Post.js","OpenLayers/Layer/WMTS.js","OpenLayers/Layer/ArcIMS.js","OpenLayers/Layer/GeoRSS.js","OpenLayers/Layer/Boxes.js","OpenLayers/Layer/XYZ.js","OpenLayers/Layer/TMS.js","OpenLayers/Layer/TileCache.js","OpenLayers/Layer/Zoomify.js","OpenLayers/Popup/Anchored.js","OpenLayers/Popup/AnchoredBubble.js","OpenLayers/Popup/Framed.js","OpenLayers/Popup/FramedCloud.js","OpenLayers/Feature.js","OpenLayers/Feature/Vector.js","OpenLayers/Feature/WFS.js","OpenLayers/Handler.js","OpenLayers/Handler/Click.js","OpenLayers/Handler/Hover.js","OpenLayers/Handler/Point.js","OpenLayers/Handler/Path.js","OpenLayers/Handler/Polygon.js","OpenLayers/Handler/Feature.js","OpenLayers/Handler/Drag.js","OpenLayers/Handler/RegularPolygon.js","OpenLayers/Handler/Box.js","OpenLayers/Handler/MouseWheel.js","OpenLayers/Handler/Keyboard.js","OpenLayers/Control.js","OpenLayers/Control/Attribution.js","OpenLayers/Control/Button.js","OpenLayers/Control/ZoomBox.js","OpenLayers/Control/ZoomToMaxExtent.js","OpenLayers/Control/DragPan.js","OpenLayers/Control/Navigation.js","OpenLayers/Control/MouseDefaults.js","OpenLayers/Control/MousePosition.js","OpenLayers/Control/OverviewMap.js","OpenLayers/Control/KeyboardDefaults.js","OpenLayers/Control/PanZoom.js","OpenLayers/Control/PanZoomBar.js","OpenLayers/Control/ArgParser.js","OpenLayers/Control/Permalink.js","OpenLayers/Control/Scale.js","OpenLayers/Control/ScaleLine.js","OpenLayers/Control/Snapping.js","OpenLayers/Control/Split.js","OpenLayers/Control/LayerSwitcher.js","OpenLayers/Control/DrawFeature.js","OpenLayers/Control/DragFeature.js","OpenLayers/Control/ModifyFeature.js","OpenLayers/Control/Panel.js","OpenLayers/Control/SelectFeature.js","OpenLayers/Control/NavigationHistory.js","OpenLayers/Control/Measure.js","OpenLayers/Control/WMSGetFeatureInfo.js","OpenLayers/Control/WMTSGetFeatureInfo.js","OpenLayers/Control/Graticule.js","OpenLayers/Control/TransformFeature.js","OpenLayers/Control/SLDSelect.js","OpenLayers/Geometry.js","OpenLayers/Geometry/Rectangle.js","OpenLayers/Geometry/Collection.js","OpenLayers/Geometry/Point.js","OpenLayers/Geometry/MultiPoint.js","OpenLayers/Geometry/Curve.js","OpenLayers/Geometry/LineString.js","OpenLayers/Geometry/LinearRing.js","OpenLayers/Geometry/Polygon.js","OpenLayers/Geometry/MultiLineString.js","OpenLayers/Geometry/MultiPolygon.js","OpenLayers/Geometry/Surface.js","OpenLayers/Renderer.js","OpenLayers/Renderer/Elements.js","OpenLayers/Renderer/SVG.js","OpenLayers/Renderer/Canvas.js","OpenLayers/Renderer/VML.js","OpenLayers/Layer/Vector.js","OpenLayers/Layer/Vector/RootContainer.js","OpenLayers/Strategy.js","OpenLayers/Strategy/Filter.js","OpenLayers/Strategy/Fixed.js","OpenLayers/Strategy/Cluster.js","OpenLayers/Strategy/Paging.js","OpenLayers/Strategy/BBOX.js","OpenLayers/Strategy/Save.js","OpenLayers/Strategy/Refresh.js","OpenLayers/Filter.js","OpenLayers/Filter/FeatureId.js","OpenLayers/Filter/Logical.js","OpenLayers/Filter/Comparison.js","OpenLayers/Filter/Spatial.js","OpenLayers/Protocol.js","OpenLayers/Protocol/HTTP.js","OpenLayers/Protocol/SQL.js","OpenLayers/Protocol/SQL/Gears.js","OpenLayers/Protocol/WFS.js","OpenLayers/Protocol/WFS/v1.js","OpenLayers/Protocol/WFS/v1_0_0.js","OpenLayers/Protocol/WFS/v1_1_0.js","OpenLayers/Protocol/SOS.js","OpenLayers/Protocol/SOS/v1_0_0.js","OpenLayers/Layer/PointTrack.js","OpenLayers/Layer/GML.js","OpenLayers/Style.js","OpenLayers/Style2.js","OpenLayers/StyleMap.js","OpenLayers/Rule.js","OpenLayers/Format.js","OpenLayers/Format/XML.js","OpenLayers/Format/Context.js","OpenLayers/Format/ArcXML.js","OpenLayers/Format/ArcXML/Features.js","OpenLayers/Format/GML.js","OpenLayers/Format/GML/Base.js","OpenLayers/Format/GML/v2.js","OpenLayers/Format/GML/v3.js","OpenLayers/Format/Atom.js","OpenLayers/Format/KML.js","OpenLayers/Format/GeoRSS.js","OpenLayers/Format/WFS.js","OpenLayers/Format/WFSCapabilities.js","OpenLayers/Format/WFSCapabilities/v1.js","OpenLayers/Format/WFSCapabilities/v1_0_0.js","OpenLayers/Format/WFSCapabilities/v1_1_0.js","OpenLayers/Format/WFSDescribeFeatureType.js","OpenLayers/Format/WMSDescribeLayer.js","OpenLayers/Format/WMSDescribeLayer/v1_1.js","OpenLayers/Format/WKT.js","OpenLayers/Format/OSM.js","OpenLayers/Format/GPX.js","OpenLayers/Format/Filter.js","OpenLayers/Format/Filter/v1.js","OpenLayers/Format/Filter/v1_0_0.js","OpenLayers/Format/Filter/v1_1_0.js","OpenLayers/Format/SLD.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/SLD/v1_0_0.js","OpenLayers/Format/OWSCommon/v1.js","OpenLayers/Format/OWSCommon/v1_0_0.js","OpenLayers/Format/OWSCommon/v1_1_0.js","OpenLayers/Format/CSWGetDomain.js","OpenLayers/Format/CSWGetDomain/v2_0_2.js","OpenLayers/Format/CSWGetRecords.js","OpenLayers/Format/CSWGetRecords/v2_0_2.js","OpenLayers/Format/WFST.js","OpenLayers/Format/WFST/v1.js","OpenLayers/Format/WFST/v1_0_0.js","OpenLayers/Format/WFST/v1_1_0.js","OpenLayers/Format/Text.js","OpenLayers/Format/JSON.js","OpenLayers/Format/GeoJSON.js","OpenLayers/Format/WMC.js","OpenLayers/Format/WMC/v1.js","OpenLayers/Format/WMC/v1_0_0.js","OpenLayers/Format/WMC/v1_1_0.js","OpenLayers/Format/WMSCapabilities.js","OpenLayers/Format/WMSCapabilities/v1.js","OpenLayers/Format/WMSCapabilities/v1_1.js","OpenLayers/Format/WMSCapabilities/v1_1_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1.js","OpenLayers/Format/WMSCapabilities/v1_3.js","OpenLayers/Format/WMSCapabilities/v1_3_0.js","OpenLayers/Format/WMSGetFeatureInfo.js","OpenLayers/Format/SOSCapabilities.js","OpenLayers/Format/SOSCapabilities/v1_0_0.js","OpenLayers/Format/SOSGetObservation.js","OpenLayers/Format/SOSGetFeatureOfInterest.js","OpenLayers/Format/OWSContext.js","OpenLayers/Format/OWSContext/v0_3_1.js","OpenLayers/Format/WMTSCapabilities.js","OpenLayers/Format/WMTSCapabilities/v1_0_0.js","OpenLayers/Layer/WFS.js","OpenLayers/Control/GetFeature.js","OpenLayers/Control/MouseToolbar.js","OpenLayers/Control/NavToolbar.js","OpenLayers/Control/PanPanel.js","OpenLayers/Control/Pan.js","OpenLayers/Control/ZoomIn.js","OpenLayers/Control/ZoomOut.js","OpenLayers/Control/ZoomPanel.js","OpenLayers/Control/EditingToolbar.js","OpenLayers/Symbolizer.js","OpenLayers/Symbolizer/Point.js","OpenLayers/Symbolizer/Line.js","OpenLayers/Symbolizer/Polygon.js","OpenLayers/Symbolizer/Text.js","OpenLayers/Symbolizer/Raster.js","OpenLayers/Lang.js","OpenLayers/Lang/en.js","OpenLayers/Lang/fr.js");
var B=navigator.userAgent;var w=(B.match("MSIE")||B.match("Safari"));if(w){var C=new Array(s.length);}var r=OpenLayers._getScriptLocation()+"lib/";for(var z=0,u=s.length;z<u;z++){if(w){C[z]="<script src='"+r+s[z]+"'><\/script>";}else{var h=document.createElement("script");h.src=r+s[z];var v=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;v.appendChild(h);}}if(w){document.write(C.join(""));}}})();OpenLayers.VERSION_NUMBER="OpenLayers 2.10 -- $Revision: 10721 $";OpenLayers.Util={};OpenLayers.Util.getElement=function(){var h=[];for(var j=0,g=arguments.length;j<g;j++){var f=arguments[j];if(typeof f=="string"){f=document.getElementById(f);}if(arguments.length==1){return f;}h.push(f);}return h;};OpenLayers.Util.isElement=function(b){return !!(b&&b.nodeType===1);};if(typeof window.$==="undefined"){window.$=OpenLayers.Util.getElement;}OpenLayers.Util.extend=function(h,j){h=h||{};if(j){for(var l in j){var m=j[l];if(m!==undefined){h[l]=m;}}var g=typeof window.Event=="function"&&j instanceof window.Event;if(!g&&j.hasOwnProperty&&j.hasOwnProperty("toString")){h.toString=j.toString;}}return h;};OpenLayers.Util.removeItem=function(g,e){for(var f=g.length-1;f>=0;f--){if(g[f]==e){g.splice(f,1);}}return g;};OpenLayers.Util.clearArray=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"}));b.length=0;};OpenLayers.Util.indexOf=function(h,j){if(typeof h.indexOf=="function"){return h.indexOf(j);}else{for(var f=0,g=h.length;f<g;f++){if(h[f]==j){return f;}}return -1;}};OpenLayers.Util.modifyDOMElement=function(s,o,t,r,m,u,q,l){if(o){s.id=o;}if(t){s.style.left=t.x+"px";s.style.top=t.y+"px";}if(r){s.style.width=r.w+"px";s.style.height=r.h+"px";}if(m){s.style.position=m;}if(u){s.style.border=u;}if(q){s.style.overflow=q;}if(parseFloat(l)>=0&&parseFloat(l)<1){s.style.filter="alpha(opacity="+(l*100)+")";s.style.opacity=l;}else{if(parseFloat(l)==1){s.style.filter="";s.style.opacity="";}}};OpenLayers.Util.createDiv=function(w,m,o,r,s,u,v,q){var t=document.createElement("div");if(r){t.style.backgroundImage="url("+r+")";}if(!w){w=OpenLayers.Util.createUniqueID("OpenLayersDiv");}if(!s){s="absolute";}OpenLayers.Util.modifyDOMElement(t,w,m,o,s,u,v,q);return t;};OpenLayers.Util.createImage=function(w,o,q,s,t,u,r,m){var v=document.createElement("img");if(!w){w=OpenLayers.Util.createUniqueID("OpenLayersDiv");}if(!t){t="relative";}OpenLayers.Util.modifyDOMElement(v,w,o,q,t,u,null,r);if(m){v.style.display="none";OpenLayers.Event.observe(v,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,v));OpenLayers.Event.observe(v,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,v));}v.style.alt=w;v.galleryImg="no";if(s){v.src=s;}return v;};OpenLayers.Util.setOpacity=function(d,e){OpenLayers.Util.modifyDOMElement(d,null,null,null,null,null,null,e);};OpenLayers.Util.onImageLoad=function(){if(!this.viewRequestID||(this.map&&this.viewRequestID==this.map.viewRequestID)){this.style.display="";}OpenLayers.Element.removeClass(this,"olImageLoadError");};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var o=this.urls;if(o&&o instanceof Array&&o.length>1){var m=this.src.toString();var q,j;for(j=0;q=o[j];j++){if(m.indexOf(q)!=-1){break;}}var l=Math.floor(o.length*Math.random());var h=o[l];j=0;while(h==q&&j++<4){l=Math.floor(o.length*Math.random());h=o[l];}this.src=m.replace(q,h);}else{this.src=this.src;}}else{OpenLayers.Element.addClass(this,"olImageLoadError");}this.style.display="";};OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var h=navigator.appVersion.split("MSIE");var g=parseFloat(h[1]);var e=false;try{e=!!(document.body.filters);}catch(j){}OpenLayers.Util.alphaHackNeeded=(e&&(g>=5.5)&&(g<7));}return OpenLayers.Util.alphaHackNeeded;};OpenLayers.Util.modifyAlphaImageDiv=function(B,z,o,q,s,t,w,v,r){OpenLayers.Util.modifyDOMElement(B,z,o,q,t,null,null,r);var u=B.childNodes[0];if(s){u.src=s;}OpenLayers.Util.modifyDOMElement(u,B.id+"_innerImage",null,q,"relative",w);if(OpenLayers.Util.alphaHack()){if(B.style.display!="none"){B.style.display="inline-block";}if(v==null){v="scale";}B.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+u.src+"', sizingMethod='"+v+"')";if(parseFloat(B.style.opacity)>=0&&parseFloat(B.style.opacity)<1){B.style.filter+=" alpha(opacity="+B.style.opacity*100+")";}u.style.filter="alpha(opacity=0)";}};OpenLayers.Util.createAlphaImageDiv=function(C,r,s,u,v,B,z,t,q){var D=OpenLayers.Util.createDiv();var w=OpenLayers.Util.createImage(null,null,null,null,null,null,null,false);D.appendChild(w);if(q){w.style.display="none";OpenLayers.Event.observe(w,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,D));OpenLayers.Event.observe(w,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,D));}OpenLayers.Util.modifyAlphaImageDiv(D,C,r,s,u,v,B,z,t);return D;};OpenLayers.Util.upperCaseObject=function(e){var f={};for(var g in e){f[g.toUpperCase()]=e[g];}return f;};OpenLayers.Util.applyDefaults=function(h,j){h=h||{};var f=typeof window.Event=="function"&&j instanceof window.Event;for(var g in j){if(h[g]===undefined||(!f&&j.hasOwnProperty&&j.hasOwnProperty(g)&&!h.hasOwnProperty(g))){h[g]=j[g];}}if(!f&&j&&j.hasOwnProperty&&j.hasOwnProperty("toString")&&!h.hasOwnProperty("toString")){h.toString=j.toString;}return h;};OpenLayers.Util.getParameterString=function(u){var v=[];for(var o in u){var q=u[o];if((q!=null)&&(typeof q!="function")){var t;if(typeof q=="object"&&q.constructor==Array){var s=[];var m;for(var w=0,r=q.length;w<r;w++){m=q[w];s.push(encodeURIComponent((m===null||m===undefined)?"":m));}t=s.join(",");}else{t=encodeURIComponent(q);}v.push(encodeURIComponent(o)+"="+t);}}return v.join("&");};OpenLayers.Util.urlAppend=function(g,f){var h=g;if(f){var j=(g+" ").split(/[?&]/);h+=(j.pop()===" "?f:j.length?"&"+f:"?"+f);}return h;};OpenLayers.ImgPath="";OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||(OpenLayers._getScriptLocation()+"img/");};OpenLayers.Util.Try=function(){var l=null;for(var m=0,h=arguments.length;m<h;m++){var e=arguments[m];try{l=e();break;}catch(j){}}return l;};OpenLayers.Util.getNodes=function(g,e){var f=OpenLayers.Util.Try(function(){return OpenLayers.Util._getNodes(g.documentElement.childNodes,e);},function(){return OpenLayers.Util._getNodes(g.childNodes,e);});return f;};OpenLayers.Util._getNodes=function(m,j){var g=[];for(var l=0,h=m.length;l<h;l++){if(m[l].nodeName==j){g.push(m[l]);}}return g;};OpenLayers.Util.getTagText=function(j,h,f){var g=OpenLayers.Util.getNodes(j,h);if(g&&(g.length>0)){if(!f){f=0;}if(g[f].childNodes.length>1){return g.childNodes[1].nodeValue;}else{if(g[f].childNodes.length==1){return g[f].firstChild.nodeValue;}}}else{return"";}};OpenLayers.Util.getXmlNodeValue=function(e){var d=null;OpenLayers.Util.Try(function(){d=e.text;if(!d){d=e.textContent;}if(!d){d=e.firstChild.nodeValue;}},function(){d=e.textContent;});return d;};OpenLayers.Util.mouseLeft=function(f,g){var e=(f.relatedTarget)?f.relatedTarget:f.toElement;while(e!=g&&e!=null){e=e.parentNode;}return(e!=g);};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(d,e){if(e==null){e=OpenLayers.Util.DEFAULT_PRECISION;}var d;if(e==0){d=parseFloat(d);}else{d=parseFloat(parseFloat(d).toPrecision(e));}return d;};OpenLayers.Util.rad=function(b){return b*Math.PI/180;};OpenLayers.Util.deg=function(b){return b*180/Math.PI;};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(ar,at){var an=OpenLayers.Util.VincentyConstants;var b=an.a,d=an.b,C=an.f;var aj=OpenLayers.Util.rad(at.lon-ar.lon);var f=Math.atan((1-C)*Math.tan(OpenLayers.Util.rad(ar.lat)));var s=Math.atan((1-C)*Math.tan(OpenLayers.Util.rad(at.lat)));var al=Math.sin(f),ap=Math.cos(f);var am=Math.sin(s),aq=Math.cos(s);
var Z=aj,ah=2*Math.PI;var ad=20;while(Math.abs(Z-ah)>1e-12&&--ad>0){var aa=Math.sin(Z),au=Math.cos(Z);var a=Math.sqrt((aq*aa)*(aq*aa)+(ap*am-al*aq*au)*(ap*am-al*aq*au));if(a==0){return 0;}var W=al*am+ap*aq*au;var ab=Math.atan2(a,W);var ao=Math.asin(ap*aq*aa/a);var L=Math.cos(ao)*Math.cos(ao);var af=W-2*al*am/L;var ag=C/16*L*(4+C*(4-3*L));ah=Z;Z=aj+(1-ag)*C*Math.sin(ao)*(ab+ag*a*(af+ag*W*(-1+2*af*af)));}if(ad==0){return NaN;}var ai=L*(b*b-d*d)/(d*d);var ac=1+ai/16384*(4096+ai*(-768+ai*(320-175*ai)));var ae=ai/1024*(256+ai*(-128+ai*(74-47*ai)));var Y=ae*a*(af+ae/4*(W*(-1+2*af*af)-ae/6*af*(-3+4*a*a)*(-3+4*af*af)));var ak=d*ac*(ab-Y);var B=ak.toFixed(3)/1000;return B;};OpenLayers.Util.destinationVincenty=function(at,b,ae){var am=OpenLayers.Util;var aw=am.VincentyConstants;var a=aw.a,f=aw.b,C=aw.f;var s=at.lon;var ay=at.lat;var ag=ae;var af=am.rad(b);var ac=Math.sin(af);var ax=Math.cos(af);var ad=(1-C)*Math.tan(am.rad(ay));var aB=1/Math.sqrt((1+ad*ad)),av=ad*aB;var ak=Math.atan2(ad,ax);var ai=aB*ac;var L=1-ai*ai;var ap=L*(a*a-f*f)/(f*f);var aj=1+ap/16384*(4096+ap*(-768+ap*(320-175*ap)));var an=ap/1024*(256+ap*(-128+ap*(74-47*ap)));var al=ag/(f*aj),B=2*Math.PI;while(Math.abs(al-B)>1e-12){var ar=Math.cos(2*ak+al);var aC=Math.sin(al);var ab=Math.cos(al);var ah=an*aC*(ar+an/4*(ab*(-1+2*ar*ar)-an/6*ar*(-3+4*aC*aC)*(-3+4*ar*ar)));B=al;al=ag/(f*aj)+ah;}var u=av*aC-aB*ab*ax;var aA=Math.atan2(av*ab+aB*aC*ax,(1-C)*Math.sqrt(ai*ai+u*u));var ao=Math.atan2(aC*ac,aB*ab-av*aC*ax);var aq=C/16*L*(4+C*(4-3*L));var au=ao-(1-aq)*C*ai*(al+aq*aC*(ar+aq*ab*(-1+2*ar*ar)));var az=Math.atan2(ai,-u);return new OpenLayers.LonLat(s+am.deg(au),am.deg(aA));};OpenLayers.Util.getParameters=function(C){C=C||window.location.href;var D="";if(OpenLayers.String.contains(C,"?")){var B=C.indexOf("?")+1;var w=OpenLayers.String.contains(C,"#")?C.indexOf("#"):C.length;D=C.substring(B,w);}var q={};var z=D.split(/[&;]/);for(var u=0,t=z.length;u<t;++u){var v=z[u].split("=");if(v[0]){var r=decodeURIComponent(v[0]);var s=v[1]||"";s=decodeURIComponent(s.replace(/\+/g," ")).split(",");if(s.length==1){s=s[0];}q[r]=s;}}return q;};OpenLayers.Util.getArgs=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"}));return OpenLayers.Util.getParameters(b);};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(b){if(b==null){b="id_";}OpenLayers.Util.lastSeqID+=1;return b+OpenLayers.Util.lastSeqID;};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:OpenLayers.INCHES_PER_UNIT.Meter*100,km:OpenLayers.INCHES_PER_UNIT.Meter*1000,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(d){var e=(d>1)?(1/d):d;return e;};OpenLayers.Util.getResolutionFromScale=function(h,g){var f;if(h){if(g==null){g="degrees";}var j=OpenLayers.Util.normalizeScale(h);f=1/(j*OpenLayers.INCHES_PER_UNIT[g]*OpenLayers.DOTS_PER_INCH);}return f;};OpenLayers.Util.getScaleFromResolution=function(e,f){if(f==null){f="degrees";}var g=e*OpenLayers.INCHES_PER_UNIT[f]*OpenLayers.DOTS_PER_INCH;return g;};OpenLayers.Util.safeStopPropagation=function(b){OpenLayers.Event.stop(b,true);};OpenLayers.Util.pagePosition=function(m){var j=0,o=0;var e=m;var l=m;while(e){if(e==document.body){if(OpenLayers.Element.getStyle(l,"position")=="absolute"){break;}}j+=e.offsetTop||0;o+=e.offsetLeft||0;l=e;try{e=e.offsetParent;}catch(q){OpenLayers.Console.error(OpenLayers.i18n("pagePositionFailed",{elemId:e.id}));break;}}e=m;while(e){j-=e.scrollTop||0;o-=e.scrollLeft||0;e=e.parentNode;}return[o,j];};OpenLayers.Util.isEquivalentUrl=function(l,m,q){q=q||{};OpenLayers.Util.applyDefaults(q,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var h=OpenLayers.Util.createUrlObject(l,q);var j=OpenLayers.Util.createUrlObject(m,q);for(var o in h){if(o!=="args"){if(h[o]!=j[o]){return false;}}}for(var o in h.args){if(h.args[o]!=j.args[o]){return false;}delete j.args[o];}for(var o in j.args){return false;}return true;};OpenLayers.Util.createUrlObject=function(z,a){a=a||{};if(!(/^\w+:\/\//).test(z)){var t=window.location;var v=t.port?":"+t.port:"";var s=t.protocol+"//"+t.host.split(":").shift()+v;if(z.indexOf("/")===0){z=s+z;}else{var u=t.pathname.split("/");u.pop();z=s+u.join("/")+"/"+z;}}if(a.ignoreCase){z=z.toLowerCase();}var r=document.createElement("a");
r.href=z;var w={};w.host=r.host.split(":").shift();w.protocol=r.protocol;if(a.ignorePort80){w.port=(r.port=="80"||r.port=="0")?"":r.port;}else{w.port=(r.port==""||r.port=="0")?"80":r.port;}w.hash=(a.ignoreHash||r.hash==="#")?"":r.hash;var B=r.search;if(!B){var q=z.indexOf("?");B=(q!=-1)?z.substr(q):"";}w.args=OpenLayers.Util.getParameters(B);w.pathname=(r.pathname.charAt(0)=="/")?r.pathname:"/"+r.pathname;return w;};OpenLayers.Util.removeTail=function(f){var j=null;var g=f.indexOf("?");var h=f.indexOf("#");if(g==-1){j=(h!=-1)?f.substr(0,h):f;}else{j=(h!=-1)?f.substr(0,Math.min(g,h)):f.substr(0,g);}return j;};OpenLayers.Util.getBrowserName=function(){var d="";var e=navigator.userAgent.toLowerCase();if(e.indexOf("opera")!=-1){d="opera";}else{if(e.indexOf("msie")!=-1){d="msie";}else{if(e.indexOf("safari")!=-1){d="safari";}else{if(e.indexOf("mozilla")!=-1){if(e.indexOf("firefox")!=-1){d="firefox";}else{d="mozilla";}}}}}return d;};OpenLayers.Util.getRenderedDimensions=function(E,H,G){var u,B;var F=document.createElement("div");F.style.visibility="hidden";var h=(G&&G.containerElement)?G.containerElement:document.body;if(H){if(H.w){u=H.w;F.style.width=u+"px";}else{if(H.h){B=H.h;F.style.height=B+"px";}}}if(G&&G.displayClass){F.className=G.displayClass;}var z=document.createElement("div");z.innerHTML=E;z.style.overflow="visible";if(z.childNodes){for(var C=0,D=z.childNodes.length;C<D;C++){if(!z.childNodes[C].style){continue;}z.childNodes[C].style.overflow="visible";}}F.appendChild(z);h.appendChild(F);var l=false;var v=F.parentNode;while(v&&v.tagName.toLowerCase()!="body"){var w=OpenLayers.Element.getStyle(v,"position");if(w=="absolute"){l=true;break;}else{if(w&&w!="static"){break;}}v=v.parentNode;}if(!l){F.style.position="absolute";}if(!u){u=parseInt(z.scrollWidth);F.style.width=u+"px";}if(!B){B=parseInt(z.scrollHeight);}F.removeChild(z);h.removeChild(F);return new OpenLayers.Size(u,B);};OpenLayers.Util.getScrollbarWidth=function(){var m=OpenLayers.Util._scrollbarWidth;if(m==null){var j=null;var l=null;var h=0;var g=0;j=document.createElement("div");j.style.position="absolute";j.style.top="-1000px";j.style.left="-1000px";j.style.width="100px";j.style.height="50px";j.style.overflow="hidden";l=document.createElement("div");l.style.width="100%";l.style.height="200px";j.appendChild(l);document.body.appendChild(j);h=l.offsetWidth;j.style.overflow="scroll";g=l.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=(h-g);m=OpenLayers.Util._scrollbarWidth;}return m;};OpenLayers.Util.getFormattedLonLat=function(o,v,s){if(!s){s="dms";}var t=Math.abs(o);var m=Math.floor(t);var w=(t-m)/(1/60);var u=w;w=Math.floor(w);var q=(u-w)/(1/60);q=Math.round(q*10);q/=10;if(m<10){m="0"+m;}var r=m+"\u00B0";if(s.indexOf("dm")>=0){if(w<10){w="0"+w;}r+=w+"'";if(s.indexOf("dms")>=0){if(q<10){q="0"+q;}r+=q+'"';}}if(v=="lon"){r+=o<0?OpenLayers.i18n("W"):OpenLayers.i18n("E");}else{r+=o<0?OpenLayers.i18n("S"):OpenLayers.i18n("N");}return r;};OpenLayers.String={startsWith:function(d,e){return(d.indexOf(e)==0);},contains:function(d,e){return(d.indexOf(e)!=-1);},trim:function(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"");},camelize:function(l){var o=l.split("-");var h=o[0];for(var q=1,j=o.length;q<j;q++){var m=o[q];h+=m.charAt(0).toUpperCase()+m.substring(1);}return h;},format:function(h,j,g){if(!j){j=window;}var f=function(a,m){var b;var d=m.split(/\.+/);for(var e=0;e<d.length;e++){if(e==0){b=j;}b=b[d[e]];}if(typeof b=="function"){b=g?b.apply(null,g):b();}if(typeof b=="undefined"){return"undefined";}else{return b;}};return h.replace(OpenLayers.String.tokenRegEx,f);},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(b){return OpenLayers.String.numberRegEx.test(b);},numericIf:function(b){return OpenLayers.String.isNumeric(b)?parseFloat(b):b;}};if(!String.prototype.startsWith){String.prototype.startsWith=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"}));return OpenLayers.String.startsWith(this,b);};}if(!String.prototype.contains){String.prototype.contains=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"}));return OpenLayers.String.contains(this,b);};}if(!String.prototype.trim){String.prototype.trim=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"}));return OpenLayers.String.trim(this);};}if(!String.prototype.camelize){String.prototype.camelize=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"}));return OpenLayers.String.camelize(this);};}OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(f,g){var e=0;if(g>0){e=parseFloat(f.toPrecision(g));}return e;},format:function(u,w,q,m){w=(typeof w!="undefined")?w:0;q=(typeof q!="undefined")?q:OpenLayers.Number.thousandsSeparator;m=(typeof m!="undefined")?m:OpenLayers.Number.decimalSeparator;if(w!=null){u=parseFloat(u.toFixed(w));}var v=u.toString().split(".");if(v.length==1&&w==null){w=0;}var t=v[0];if(q){var s=/(-?[0-9]+)([0-9]{3})/;while(s.test(t)){t=t.replace(s,"$1"+q+"$2");}}var r;if(w==0){r=t;}else{var o=v.length>1?v[1]:"0";if(w!=null){o=o+new Array(w-o.length+1).join("0");}r=t+m+o;}return r;}};if(!Number.prototype.limitSigDigs){Number.prototype.limitSigDigs=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"}));return OpenLayers.Number.limitSigDigs(this,b);};}OpenLayers.Function={bind:function(g,e){var f=Array.prototype.slice.apply(arguments,[2]);return function(){var a=f.concat(Array.prototype.slice.apply(arguments,[0]));return g.apply(e,a);};},bindAsEventListener:function(d,e){return function(a){return d.call(e,a||window.event);};},False:function(){return false;},True:function(){return true;}};if(!Function.prototype.bind){Function.prototype.bind=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"}));Array.prototype.unshift.apply(arguments,[this]);return OpenLayers.Function.bind.apply(null,arguments);};}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"}));return OpenLayers.Function.bindAsEventListener(this,b);};}OpenLayers.Array={filter:function(m,o,j){var r=[];if(Array.prototype.filter){r=m.filter(o,j);}else{var l=m.length;if(typeof o!="function"){throw new TypeError();}for(var s=0;s<l;s++){if(s in m){var q=m[s];if(o.call(j,q,s,m)){r.push(q);}}}}return r;}};OpenLayers.Date={toISOString:(function(){if("toISOString" in Date.prototype){return function(a){return a.toISOString();};}else{function b(g,a){var f=g+"";while(f.length<a){f="0"+f;}return f;}return function(a){var e;if(isNaN(a.getTime())){e="Invalid Date";}else{e=a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1,2)+"-"+b(a.getUTCDate(),2)+"T"+b(a.getUTCHours(),2)+":"+b(a.getUTCMinutes(),2)+":"+b(a.getUTCSeconds(),2)+"."+b(a.getUTCMilliseconds(),3)+"Z";}return e;};}})(),parse:function(B){var J;var L=Date.parse(B);if(!isNaN(L)){J=new Date(L);}else{var D=B.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))?$/);var J;if(D&&(D[1]||D[7])){var z=parseInt(D[1],10)||0;var C=(parseInt(D[2],10)-1)||0;var v=parseInt(D[3],10)||1;J=new Date(Date.UTC(z,C,v));var w=D[7];if(w){var N=parseInt(D[4],10);var H=parseInt(D[5],10);var K=parseFloat(D[6]);var M=K|0;var I=Math.round(1000*(K-M));J.setUTCHours(N,H,M,I);if(w!=="Z"){var E=parseInt(w,10);var F=parseInt(D[8])||0;var G=-1000*(60*(E*60)+F*60);J=new Date(J.getTime()+G);}}}else{J=new Date("invalid");}}return J;}};OpenLayers.Class=function(){var q=function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments);}};
var s={};var m,j,r;for(var o=0,l=arguments.length;o<l;++o){r=arguments[o];if(typeof r=="function"){if(o==0&&l>1){j=r.prototype.initialize;r.prototype.initialize=function(){};s=new r();if(j===undefined){delete r.prototype.initialize;}else{r.prototype.initialize=j;}}m=r.prototype;}else{m=r;}OpenLayers.Util.extend(s,m);}q.prototype=s;return q;};OpenLayers.Class.isPrototype=function(){};OpenLayers.Class.create=function(){return function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments);}};};OpenLayers.Class.inherit=function(){var l=arguments[0];var j=new l(OpenLayers.Class.isPrototype);for(var m=1,h=arguments.length;m<h;m++){if(typeof arguments[m]=="function"){var g=arguments[m];arguments[m]=new g(OpenLayers.Class.isPrototype);}OpenLayers.Util.extend(j,arguments[m]);}return j;};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(h,g,f,j){if(h!=null){this.left=OpenLayers.Util.toFloat(h);}if(g!=null){this.bottom=OpenLayers.Util.toFloat(g);}if(f!=null){this.right=OpenLayers.Util.toFloat(f);}if(j!=null){this.top=OpenLayers.Util.toFloat(j);}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top);},equals:function(d){var e=false;if(d!=null){e=((this.left==d.left)&&(this.right==d.right)&&(this.top==d.top)&&(this.bottom==d.bottom));}return e;},toString:function(){return("left-bottom=("+this.left+","+this.bottom+") right-top=("+this.right+","+this.top+")");},toArray:function(b){if(b===true){return[this.bottom,this.left,this.top,this.right];}else{return[this.left,this.bottom,this.right,this.top];}},toBBOX:function(j,q){if(j==null){j=6;}var m=Math.pow(10,j);var o=Math.round(this.left*m)/m;var r=Math.round(this.bottom*m)/m;var s=Math.round(this.right*m)/m;var l=Math.round(this.top*m)/m;if(q===true){return r+","+o+","+l+","+s;}else{return o+","+r+","+s+","+l;}},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])]);},getWidth:function(){return(this.right-this.left);},getHeight:function(){return(this.top-this.bottom);},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight());},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2);},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2);}return this.centerLonLat;},scale:function(s,u){if(u==null){u=this.getCenterLonLat();}var m,o;if(u.CLASS_NAME=="OpenLayers.LonLat"){m=u.lon;o=u.lat;}else{m=u.x;o=u.y;}var q=(this.left-m)*s+m;var l=(this.bottom-o)*s+o;var t=(this.right-m)*s+m;var r=(this.top-o)*s+o;return new OpenLayers.Bounds(q,l,t,r);},add:function(f,g){if((f==null)||(g==null)){var e=OpenLayers.i18n("boundsAddError");OpenLayers.Console.error(e);return null;}return new OpenLayers.Bounds(this.left+f,this.bottom+g,this.right+f,this.top+g);},extend:function(e){var d=null;if(e){switch(e.CLASS_NAME){case"OpenLayers.LonLat":d=new OpenLayers.Bounds(e.lon,e.lat,e.lon,e.lat);break;case"OpenLayers.Geometry.Point":d=new OpenLayers.Bounds(e.x,e.y,e.x,e.y);break;case"OpenLayers.Bounds":d=e;break;}if(d){this.centerLonLat=null;if((this.left==null)||(d.left<this.left)){this.left=d.left;}if((this.bottom==null)||(d.bottom<this.bottom)){this.bottom=d.bottom;}if((this.right==null)||(d.right>this.right)){this.right=d.right;}if((this.top==null)||(d.top>this.top)){this.top=d.top;}}}},containsLonLat:function(d,e){return this.contains(d.lon,d.lat,e);},containsPixel:function(d,e){return this.contains(d.x,d.y,e);},contains:function(f,h,g){if(g==null){g=true;}if(f==null||h==null){return false;}f=OpenLayers.Util.toFloat(f);h=OpenLayers.Util.toFloat(h);var j=false;if(g){j=((f>=this.left)&&(f<=this.right)&&(h>=this.bottom)&&(h<=this.top));}else{j=((f>this.left)&&(f<this.right)&&(h>this.bottom)&&(h<this.top));}return j;},intersectsBounds:function(s,l){if(l==null){l=true;}var t=false;var o=(this.left==s.right||this.right==s.left||this.top==s.bottom||this.bottom==s.top);if(l||!o){var q=(((s.bottom>=this.bottom)&&(s.bottom<=this.top))||((this.bottom>=s.bottom)&&(this.bottom<=s.top)));var r=(((s.top>=this.bottom)&&(s.top<=this.top))||((this.top>s.bottom)&&(this.top<s.top)));var u=(((s.left>=this.left)&&(s.left<=this.right))||((this.left>=s.left)&&(this.left<=s.right)));var m=(((s.right>=this.left)&&(s.right<=this.right))||((this.right>=s.left)&&(this.right<=s.right)));t=((q||r)&&(u||m));}return t;},containsBounds:function(m,j,l){if(j==null){j=false;}if(l==null){l=true;}var s=this.contains(m.left,m.bottom,l);var r=this.contains(m.right,m.bottom,l);var o=this.contains(m.left,m.top,l);var q=this.contains(m.right,m.top,l);return(j)?(s||r||o||q):(s&&r&&o&&q);},determineQuadrant:function(g){var e="";var f=this.getCenterLonLat();e+=(g.lat<f.lat)?"b":"t";e+=(g.lon<f.lon)?"l":"r";return e;},transform:function(o,h){this.centerLonLat=null;var m=OpenLayers.Projection.transform({x:this.left,y:this.bottom},o,h);var j=OpenLayers.Projection.transform({x:this.right,y:this.bottom},o,h);var q=OpenLayers.Projection.transform({x:this.left,y:this.top},o,h);var l=OpenLayers.Projection.transform({x:this.right,y:this.top},o,h);this.left=Math.min(m.x,q.x);this.bottom=Math.min(m.y,j.y);this.right=Math.max(j.x,l.x);this.top=Math.max(q.y,l.y);return this;},wrapDateLine:function(h,m){m=m||{};var l=m.leftTolerance||0;var g=m.rightTolerance||0;var j=this.clone();if(h){while(j.left<h.left&&(j.right-g)<=h.left){j=j.add(h.getWidth(),0);}while((j.left+l)>=h.right&&j.right>h.right){j=j.add(-h.getWidth(),0);}}return j;},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(d){var e=d.split(",");return OpenLayers.Bounds.fromArray(e);};OpenLayers.Bounds.fromArray=function(b){return new OpenLayers.Bounds(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]));};OpenLayers.Bounds.fromSize=function(b){return new OpenLayers.Bounds(0,b.h,b.w,0);};OpenLayers.Bounds.oppositeQuadrant=function(e){var d="";d+=(e.charAt(0)=="t")?"b":"t";d+=(e.charAt(1)=="l")?"r":"l";return d;};OpenLayers.Rico=new Object();OpenLayers.Rico.Corner={round:function(h,e){h=OpenLayers.Util.getElement(h);this._setOptions(e);var g=this.options.color;if(this.options.color=="fromElement"){g=this._background(h);}var j=this.options.bgColor;if(this.options.bgColor=="fromParent"){j=this._background(h.offsetParent);}this._roundCornersImpl(h,g,j);},changeColor:function(j,f){j.style.backgroundColor=f;var g=j.parentNode.getElementsByTagName("span");for(var h=0;h<g.length;h++){g[h].style.backgroundColor=f;}},changeOpacity:function(q,l){var o=l;var j="alpha(opacity="+l*100+")";q.style.opacity=o;q.style.filter=j;var h=q.parentNode.getElementsByTagName("span");for(var m=0;m<h.length;m++){h[m].style.opacity=o;h[m].style.filter=j;}},reRound:function(h,j){var f=h.parentNode.childNodes[0];var g=h.parentNode.childNodes[2];h.parentNode.removeChild(f);h.parentNode.removeChild(g);this.round(h.parentNode,j);},_roundCornersImpl:function(g,f,e){if(this.options.border){this._renderBorder(g,e);}if(this._isTopRounded()){this._roundTopCorners(g,f,e);}if(this._isBottomRounded()){this._roundBottomCorners(g,f,e);}},_renderBorder:function(o,m){var h="1px solid "+this._borderColor(m);var j="border-left: "+h;var l="border-right: "+h;var q="style='"+j+";"+l+"'";o.innerHTML="<div "+q+">"+o.innerHTML+"</div>";},_roundTopCorners:function(m,h,j){var l=this._createCorner(j);for(var g=0;g<this.options.numSlices;g++){l.appendChild(this._createCornerSlice(h,j,g,"top"));}m.style.paddingTop=0;m.insertBefore(l,m.firstChild);},_roundBottomCorners:function(m,h,j){var l=this._createCorner(j);for(var g=(this.options.numSlices-1);g>=0;g--){l.appendChild(this._createCornerSlice(h,j,g,"bottom"));}m.style.paddingBottom=0;
m.appendChild(l);},_createCorner:function(d){var e=document.createElement("div");e.style.backgroundColor=(this._isTransparent()?"transparent":d);return e;},_createCornerSlice:function(s,r,m,l){var q=document.createElement("span");var j=q.style;j.backgroundColor=s;j.display="block";j.height="1px";j.overflow="hidden";j.fontSize="1px";var o=this._borderColor(s,r);if(this.options.border&&m==0){j.borderTopStyle="solid";j.borderTopWidth="1px";j.borderLeftWidth="0px";j.borderRightWidth="0px";j.borderBottomWidth="0px";j.height="0px";j.borderColor=o;}else{if(o){j.borderColor=o;j.borderStyle="solid";j.borderWidth="0px 1px";}}if(!this.options.compact&&(m==(this.options.numSlices-1))){j.height="2px";}this._setMargin(q,m,l);this._setBorder(q,m,l);return q;},_setOptions:function(b){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};OpenLayers.Util.extend(this.options,b||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent()){this.options.blend=false;}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return"";}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return"";}if(this.options.corners.indexOf("tl")>=0){return"left";}else{if(this.options.corners.indexOf("tr")>=0){return"right";}}return"";},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return"";}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return"";}if(this.options.corners.indexOf("bl")>=0){return"left";}else{if(this.options.corners.indexOf("br")>=0){return"right";}}return"";},_borderColor:function(e,d){if(e=="transparent"){return d;}else{if(this.options.border){return this.options.border;}else{if(this.options.blend){return this._blend(d,e);}else{return"";}}}},_setMargin:function(l,j,g){var m=this._marginSize(j);var h=g=="top"?this._whichSideTop():this._whichSideBottom();if(h=="left"){l.style.marginLeft=m+"px";l.style.marginRight="0px";}else{if(h=="right"){l.style.marginRight=m+"px";l.style.marginLeft="0px";}else{l.style.marginLeft=m+"px";l.style.marginRight=m+"px";}}},_setBorder:function(l,j,g){var m=this._borderSize(j);var h=g=="top"?this._whichSideTop():this._whichSideBottom();if(h=="left"){l.style.borderLeftWidth=m+"px";l.style.borderRightWidth="0px";}else{if(h=="right"){l.style.borderRightWidth=m+"px";l.style.borderLeftWidth="0px";}else{l.style.borderLeftWidth=m+"px";l.style.borderRightWidth=m+"px";}}if(this.options.border!=false){l.style.borderLeftWidth=m+"px";l.style.borderRightWidth=m+"px";}},_marginSize:function(j){if(this._isTransparent()){return 0;}var l=[5,3,2,1];var h=[3,2,1,0];var m=[2,1];var g=[1,0];if(this.options.compact&&this.options.blend){return g[j];}else{if(this.options.compact){return m[j];}else{if(this.options.blend){return h[j];}else{return l[j];}}}},_borderSize:function(j){var l=[5,3,2,1];var g=[2,1,1,1];var h=[1,0];var m=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1;}else{if(this.options.compact){return h[j];}else{if(this.options.blend){return g[j];}else{if(this.options.border){return m[j];}else{if(this._isTransparent()){return l[j];}}}}}return 0;},_hasString:function(d){for(var e=1;e<arguments.length;e++){if(d.indexOf(arguments[e])>=0){return true;}}return false;},_blend:function(g,f){var e=OpenLayers.Rico.Color.createFromHex(g);e.blend(OpenLayers.Rico.Color.createFromHex(f));return e;},_background:function(e){try{return OpenLayers.Rico.Color.createColorFromBackground(e).asHex();}catch(d){return"#ffffff";}},_isTransparent:function(){return this.options.color=="transparent";},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr");},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br");},_hasSingleTextChild:function(b){return b.childNodes.length==1&&b.childNodes[0].nodeType==3;}};OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(b){alert(b);},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){var e=document.getElementsByTagName("script");for(var g=0,f=e.length;g<f;++g){if(e[g].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);break;}}}})();OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(b){OpenLayers.Util.extend(this,b);this.options=b;},destroy:function(){},read:function(b){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"));},write:function(b){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"));},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.CSWGetRecords=function(d){d=OpenLayers.Util.applyDefaults(d,OpenLayers.Format.CSWGetRecords.DEFAULTS);var e=OpenLayers.Format.CSWGetRecords["v"+d.version.replace(/\./g,"_")];if(!e){throw"Unsupported CSWGetRecords version: "+d.version;}return new e(d);};OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};OpenLayers.Event={observers:false,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(b){return b.target||b.srcElement;},isLeftClick:function(b){return(((b.which)&&(b.which==1))||((b.button)&&(b.button==1)));},isRightClick:function(b){return(((b.which)&&(b.which==3))||((b.button)&&(b.button==2)));},stop:function(d,e){if(!e){if(d.preventDefault){d.preventDefault();}else{d.returnValue=false;}}if(d.stopPropagation){d.stopPropagation();}else{d.cancelBubble=true;}},findElement:function(g,e){var f=OpenLayers.Event.element(g);while(f.parentNode&&(!f.tagName||(f.tagName.toUpperCase()!=e.toUpperCase()))){f=f.parentNode;}return f;},observe:function(j,r,s,l){var q=OpenLayers.Util.getElement(j);l=l||false;if(r=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||q.attachEvent)){r="keydown";}if(!this.observers){this.observers={};}if(!q._eventCacheID){var o="eventCacheID_";if(q.id){o=q.id+"_"+o;}q._eventCacheID=OpenLayers.Util.createUniqueID(o);}var m=q._eventCacheID;if(!this.observers[m]){this.observers[m]=[];}this.observers[m].push({element:q,name:r,observer:s,useCapture:l});if(q.addEventListener){q.addEventListener(r,s,l);}else{if(q.attachEvent){q.attachEvent("on"+r,s);}}},stopObservingElement:function(f){var e=OpenLayers.Util.getElement(f);var g=e._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[g]);},_removeElementObservers:function(j){if(j){for(var g=j.length-1;g>=0;g--){var m=j[g];var h=new Array(m.element,m.name,m.observer,m.useCapture);var l=OpenLayers.Event.stopObserving.apply(this,h);}}},stopObserving:function(r,B,s,z){z=z||false;var t=OpenLayers.Util.getElement(r);var v=t._eventCacheID;if(B=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||t.detachEvent){B="keydown";}}var o=false;var w=OpenLayers.Event.observers[v];if(w){var u=0;while(!o&&u<w.length){var q=w[u];if((q.name==B)&&(q.observer==s)&&(q.useCapture==z)){w.splice(u,1);if(w.length==0){delete OpenLayers.Event.observers[v];}o=true;break;}u++;}}if(o){if(t.removeEventListener){t.removeEventListener(B,s,z);}else{if(t&&t.detachEvent){t.detachEvent("on"+B,s);}}}return o;},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers){var d=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[d]);}OpenLayers.Event.observers=false;}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);if(window.Event){OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event);}else{var Event=OpenLayers.Event;}OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:false,clearMouseListener:null,initialize:function(s,q,m,o,j){OpenLayers.Util.extend(this,j);
this.object=s;this.fallThrough=o;this.listeners={};this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this);this.eventTypes=[];if(m!=null){for(var r=0,l=m.length;r<l;r++){this.addEventType(m[r]);}}if(q!=null){this.attachToElement(q);}},destroy:function(){if(this.element){OpenLayers.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener);}}this.element=null;this.listeners=null;this.object=null;this.eventTypes=null;this.fallThrough=null;this.eventHandler=null;},addEventType:function(b){if(!this.listeners[b]){this.eventTypes.push(b);this.listeners[b]=[];}},attachToElement:function(h){if(this.element){OpenLayers.Event.stopObservingElement(this.element);}this.element=h;for(var j=0,g=this.BROWSER_EVENTS.length;j<g;j++){var f=this.BROWSER_EVENTS[j];this.addEventType(f);OpenLayers.Event.observe(h,f,this.eventHandler);}OpenLayers.Event.observe(h,"dragstart",OpenLayers.Event.stop);},on:function(e){for(var d in e){if(d!="scope"){this.register(d,e.scope,e[d]);}}},register:function(f,h,j){if((j!=null)&&(OpenLayers.Util.indexOf(this.eventTypes,f)!=-1)){if(h==null){h=this.object;}var g=this.listeners[f];g.push({obj:h,func:j});}},registerPriority:function(f,h,j){if(j!=null){if(h==null){h=this.object;}var g=this.listeners[f];if(g!=null){g.unshift({obj:h,func:j});}}},un:function(e){for(var d in e){if(d!="scope"){this.unregister(d,e.scope,e[d]);}}},unregister:function(o,l,m){if(l==null){l=this.object;}var q=this.listeners[o];if(q!=null){for(var h=0,j=q.length;h<j;h++){if(q[h].obj==l&&q[h].func==m){q.splice(h,1);break;}}}},remove:function(b){if(this.listeners[b]!=null){this.listeners[b]=[];}},triggerEvent:function(q,j){var r=this.listeners[q];if(!r||r.length==0){return;}if(j==null){j={};}j.object=this.object;j.element=this.element;if(!j.type){j.type=q;}var r=r.slice(),o;for(var s=0,l=r.length;s<l;s++){var m=r[s];o=m.func.apply(m.obj,[j]);if((o!=undefined)&&(o==false)){break;}}if(!this.fallThrough){OpenLayers.Event.stop(j,true);}return o;},handleBrowserEvent:function(b){if(this.includeXY){b.xy=this.getMousePosition(b);}this.triggerEvent(b.type,b);},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null;},getMousePosition:function(b){if(!this.includeXY){this.clearMouseCache();}else{if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true;}}if(!this.element.scrolls){this.element.scrolls=[(document.documentElement.scrollLeft||document.body.scrollLeft),(document.documentElement.scrollTop||document.body.scrollTop)];}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)];}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element);this.element.offsets[0]+=this.element.scrolls[0];this.element.offsets[1]+=this.element.scrolls[1];}return new OpenLayers.Pixel((b.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(b.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1]);},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(h,g,l,m){this.url=h;this.size=(g)?g:new OpenLayers.Size(20,20);this.offset=l?l:new OpenLayers.Pixel(-(this.size.w/2),-(this.size.h/2));this.calculateOffset=m;var j=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(j);},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null;},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset);},setSize:function(b){if(b!=null){this.size=b;}this.draw();},setUrl:function(b){if(b!=null){this.url=b;}this.draw();},draw:function(b){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(b);return this.imageDiv;},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){OpenLayers.Element.remove(this.imageDiv);}},setOpacity:function(b){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,b);},moveTo:function(e){if(e!=null){this.px=e;}if(this.imageDiv!=null){if(this.px==null){this.display(false);}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size);}var d=this.px.offset(this.offset);OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,d);}}},display:function(b){this.imageDiv.style.display=(b)?"":"none";},isDrawn:function(){var b=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));return b;},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(g,e){this.lonlat=g;var f=(e)?e:OpenLayers.Marker.defaultIcon();if(this.icon==null){this.icon=f;}else{this.icon.url=f.url;this.icon.size=f.size;this.icon.offset=f.offset;this.icon.calculateOffset=f.calculateOffset;}this.events=new OpenLayers.Events(this,this.icon.imageDiv,null);},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null;}},draw:function(b){return this.icon.draw(b);},erase:function(){if(this.icon!=null){this.icon.erase();}},moveTo:function(b){if((b!=null)&&(this.icon!=null)){this.icon.moveTo(b);}this.lonlat=this.map.getLonLatFromLayerPx(b);},isDrawn:function(){var b=(this.icon&&this.icon.isDrawn());return b;},onScreen:function(){var d=false;if(this.map){var e=this.map.getExtent();d=e.containsLonLat(this.lonlat);}return d;},inflate:function(d){if(this.icon){var e=new OpenLayers.Size(this.icon.size.w*d,this.icon.size.h*d);this.icon.setSize(e);}},setOpacity:function(b){this.icon.setOpacity(b);},setUrl:function(b){this.icon.setUrl(b);},display:function(b){this.icon.display(b);},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){var f=OpenLayers.Util.getImagesLocation()+"marker.png";var e=new OpenLayers.Size(21,25);var g=function(a){return new OpenLayers.Pixel(-(a.w/2),-a.h);};return new OpenLayers.Icon(f,e,null,g);};OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding);}},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,initialize:function(m,s,o,j,q,r){if(m==null){m=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");}this.id=m;this.lonlat=s;this.contentSize=(o!=null)?o:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);if(j!=null){this.contentHTML=j;}this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var l=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(l,null,null,null,"relative",null,"hidden");var m=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(m,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);if(q){this.addCloseBox(r);}this.registerEvents();},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide);
}this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv);}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;if(this.map!=null){this.map.removePopup(this);}this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null;},draw:function(b){if(b==null){if((this.lonlat!=null)&&(this.map!=null)){b=this.map.getLayerPxFromLonLat(this.lonlat);}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide);}if(!this.disableFirefoxOverflowHack&&OpenLayers.Util.getBrowserName()=="firefox"){this.map.events.register("movestart",this,function(){var a=document.defaultView.getComputedStyle(this.contentDiv,null);var e=a.getPropertyValue("overflow");if(e!="hidden"){this.contentDiv._oldOverflow=e;this.contentDiv.style.overflow="hidden";}});this.map.events.register("moveend",this,function(){var a=this.contentDiv._oldOverflow;if(a){this.contentDiv.style.overflow=a;this.contentDiv._oldOverflow=null;}});}this.moveTo(b);if(!this.autoSize&&!this.size){this.setSize(this.contentSize);}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView();}return this.div;},updatePosition:function(){if((this.lonlat)&&(this.map)){var b=this.map.getLayerPxFromLonLat(this.lonlat);if(b){this.moveTo(b);}}},moveTo:function(b){if((b!=null)&&(this.div!=null)){this.div.style.left=b.x+"px";this.div.style.top=b.y+"px";}},visible:function(){return OpenLayers.Element.visible(this.div);},toggle:function(){if(this.visible()){this.hide();}else{this.show();}},show:function(){OpenLayers.Element.show(this.div);if(this.panMapIfOutOfView){this.panIntoView();}},hide:function(){OpenLayers.Element.hide(this.div);},setSize:function(m){this.size=m.clone();var g=this.getContentDivPadding();var h=g.left+g.right;var j=g.top+g.bottom;this.fixPadding();h+=this.padding.left+this.padding.right;j+=this.padding.top+this.padding.bottom;if(this.closeDiv){var l=parseInt(this.closeDiv.style.width);h+=l+g.right;}this.size.w+=h;this.size.h+=j;if(OpenLayers.Util.getBrowserName()=="msie"){this.contentSize.w+=g.left+g.right;this.contentSize.h+=g.bottom+g.top;}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px";}if(this.contentDiv!=null){this.contentDiv.style.width=m.w+"px";this.contentDiv.style.height=m.h+"px";}},updateSize:function(){var s="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var o=(this.map)?this.map.layerContainerDiv:document.body;var m=OpenLayers.Util.getRenderedDimensions(s,null,{displayClass:this.displayClass,containerElement:o});var q=this.getSafeContentSize(m);var r=null;if(q.equals(m)){r=m;}else{var v=new OpenLayers.Size();v.w=(q.w<m.w)?q.w:null;v.h=(q.h<m.h)?q.h:null;if(v.w&&v.h){r=q;}else{var t=OpenLayers.Util.getRenderedDimensions(s,v,{displayClass:this.contentDisplayClass,containerElement:o});var u=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if((u!="hidden")&&(t.equals(q))){var w=OpenLayers.Util.getScrollbarWidth();if(v.w){t.h+=w;}else{t.w+=w;}}r=this.getSafeContentSize(t);}}this.setSize(r);},setBackgroundColor:function(b){if(b!=undefined){this.backgroundColor=b;}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor;}},setOpacity:function(b){if(b!=undefined){this.opacity=b;}if(this.div!=null){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+this.opacity*100+")";}},setBorder:function(b){if(b!=undefined){this.border=b;}if(this.div!=null){this.div.style.border=this.border;}},setContentHTML:function(b){if(b!=null){this.contentHTML=b;}if((this.contentDiv!=null)&&(this.contentHTML!=null)&&(this.contentHTML!=this.contentDiv.innerHTML)){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize();}}},registerImageListeners:function(){var l=function(){this.popup.updateSize();if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView();}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad);};var h=this.contentDiv.getElementsByTagName("img");for(var m=0,j=h.length;m<j;m++){var q=h[m];if(q.width==0||q.height==0){var o={popup:this,img:q};q._onImgLoad=OpenLayers.Function.bind(l,o);OpenLayers.Event.observe(q,"load",q._onImgLoad);}}},getSafeContentSize:function(q){var z=q.clone();var s=this.getContentDivPadding();var r=s.left+s.right;var u=s.top+s.bottom;this.fixPadding();r+=this.padding.left+this.padding.right;u+=this.padding.top+this.padding.bottom;if(this.closeDiv){var B=parseInt(this.closeDiv.style.width);r+=B+s.right;}if(this.minSize){z.w=Math.max(z.w,(this.minSize.w-r));z.h=Math.max(z.h,(this.minSize.h-u));}if(this.maxSize){z.w=Math.min(z.w,(this.maxSize.w-r));z.h=Math.min(z.h,(this.maxSize.h-u));}if(this.map&&this.map.size){var v=0,w=0;if(this.keepInMap&&!this.panMapIfOutOfView){var t=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":v=t.x;w=this.map.size.h-t.y;break;case"tl":v=this.map.size.w-t.x;w=this.map.size.h-t.y;break;case"bl":v=this.map.size.w-t.x;w=t.y;break;case"br":v=t.x;w=t.y;break;default:v=t.x;w=this.map.size.h-t.y;break;}}var D=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-u-w;var C=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-r-v;z.w=Math.min(z.w,C);z.h=Math.min(z.h,D);}return z;},getContentDivPadding:function(){var b=this._contentDivPadding;if(!b){if(this.div.parentNode==null){this.div.style.display="none";document.body.appendChild(this.div);}b=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=b;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display="";}}return b;},addCloseBox:function(g){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17));this.closeDiv.className="olPopupCloseBox";var e=this.getContentDivPadding();this.closeDiv.style.right=e.right+"px";this.closeDiv.style.top=e.top+"px";this.groupDiv.appendChild(this.closeDiv);var f=g||function(a){this.hide();OpenLayers.Event.stop(a);};OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(f,this));},panIntoView:function(){var j=this.map.getSize();var l=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));var m=l.clone();if(l.x<this.map.paddingForPopups.left){m.x=this.map.paddingForPopups.left;}else{if((l.x+this.size.w)>(j.w-this.map.paddingForPopups.right)){m.x=j.w-this.map.paddingForPopups.right-this.size.w;}}if(l.y<this.map.paddingForPopups.top){m.y=this.map.paddingForPopups.top;}else{if((l.y+this.size.h)>(j.h-this.map.paddingForPopups.bottom)){m.y=j.h-this.map.paddingForPopups.bottom-this.size.h;}}var g=l.x-m.x;var h=l.y-m.y;this.map.pan(g,h);},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,true);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,scope:this});},onmousedown:function(b){this.mousedown=true;OpenLayers.Event.stop(b,true);},onmousemove:function(b){if(this.mousedown){OpenLayers.Event.stop(b,true);}},onmouseup:function(b){if(this.mousedown){this.mousedown=false;OpenLayers.Event.stop(b,true);}},onclick:function(b){OpenLayers.Event.stop(b,true);},onmouseout:function(b){this.mousedown=false;},ondblclick:function(b){OpenLayers.Event.stop(b,true);},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:true,anchor:null,initialize:function(o,t,q,u,l,r,s){var m=[o,t,q,u,r,s];
OpenLayers.Popup.prototype.initialize.apply(this,m);this.anchor=(l!=null)?l:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)};},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments);},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments);},moveTo:function(j){var f=this.relativePosition;this.relativePosition=this.calculateRelativePosition(j);var h=this.calculateNewPx(j);var g=new Array(h);OpenLayers.Popup.prototype.moveTo.apply(this,g);if(this.relativePosition!=f){this.updateRelativePosition();}},setSize:function(d){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if((this.lonlat)&&(this.map)){var e=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(e);}},calculateRelativePosition:function(f){var h=this.map.getLonLatFromLayerPx(f);var j=this.map.getExtent();var g=j.determineQuadrant(h);return OpenLayers.Bounds.oppositeQuadrant(g);},updateRelativePosition:function(){},calculateNewPx:function(g){var j=g.offset(this.anchor.offset);var h=this.size||this.contentSize;var l=(this.relativePosition.charAt(0)=="t");j.y+=(l)?-(h.h+this.anchor.size.h):this.anchor.size.h;var m=(this.relativePosition.charAt(1)=="l");j.x+=(m)?-(h.w+this.anchor.size.w):this.anchor.size.w;return j;},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:false,initialize:function(m,s,o,j,l,q,r){this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);},draw:function(b){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);this.setContentHTML();this.setBackgroundColor();this.setOpacity();return this.div;},updateRelativePosition:function(){this.setRicoCorners();},setSize:function(b){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.setRicoCorners();},setBackgroundColor:function(b){if(b!=undefined){this.backgroundColor=b;}if(this.div!=null){if(this.contentDiv!=null){this.div.style.background="transparent";OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor);}}},setOpacity:function(b){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,b);if(this.div!=null){if(this.groupDiv!=null){OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity);}}},setBorder:function(b){this.border=0;},setRicoCorners:function(){var e=this.getCornersToRound(this.relativePosition);var d={corners:e,color:this.backgroundColor,bgColor:"transparent",blend:false};if(!this.rounded){OpenLayers.Rico.Corner.round(this.div,d);this.rounded=true;}else{OpenLayers.Rico.Corner.reRound(this.groupDiv,d);this.setBackgroundColor();this.setOpacity();}},getCornersToRound:function(){var e=["tl","tr","bl","br"];var d=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);OpenLayers.Util.removeItem(e,d);return e.join(" ");},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:OpenLayers.Popup.AnchoredBubble,popup:null,initialize:function(f,g,e){this.layer=f;this.lonlat=g;this.data=(e!=null)?e:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup);}}if(this.layer!=null&&this.marker!=null){this.layer.removeMarker(this.marker);}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null;}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null;}},onScreen:function(){var d=false;if((this.layer!=null)&&(this.layer.map!=null)){var e=this.layer.map.getExtent();d=e.containsLonLat(this.lonlat);}return d;},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon);}return this.marker;},destroyMarker:function(){this.marker.destroy();},createPopup:function(e){if(this.lonlat!=null){var g=this.id+"_popup";var f=(this.marker)?this.marker.icon:null;if(!this.popup){this.popup=new this.popupClass(g,this.lonlat,this.data.popupSize,this.data.popupContentHTML,f,e);}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow;}this.popup.feature=this;}return this.popup;},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null;}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",initialize:function(g,f,e){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,f]);this.lonlat=null;this.geometry=g?g:null;this.state=null;this.attributes={};if(f){this.attributes=OpenLayers.Util.extend(this.attributes,f);}this.style=e?e:null;},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null;}this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments);},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style);},onScreen:function(l){var m=false;if(this.layer&&this.layer.map){var h=this.layer.map.getExtent();if(l){var g=this.geometry.getBounds();m=h.intersectsBounds(g);}else{var j=h.toGeometry();m=j.intersects(this.geometry);}}return m;},getVisibility:function(){return !(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility());},createMarker:function(){return null;},destroyMarker:function(){},createPopup:function(){return null;},atPoint:function(f,h,j){var g=false;if(this.geometry){g=this.geometry.atPoint(f,h,j);}return g;},destroyPopup:function(){},move:function(g){if(!this.layer||!this.geometry.move){return;}var f;if(g.CLASS_NAME=="OpenLayers.LonLat"){f=this.layer.getViewPortPxFromLonLat(g);}else{f=g;}var h=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var j=this.layer.map.getResolution();this.geometry.move(j*(f.x-h.x),j*(h.y-f.y));this.layer.drawFeature(this);return h;},toState:function(b){if(b==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=b;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break;}}else{if(b==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=b;break;}}else{if(b==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=b;break;}}else{if(b==OpenLayers.State.UNKNOWN){this.state=b;}}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}};
OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM");}OpenLayers.Format.prototype.initialize.apply(this,[e]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var d in this.namespaces){this.namespaceAlias[this.namespaces[d]]=d;}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments);},setNamespace:function(e,d){this.namespaces[e]=d;this.namespaceAlias[d]=e;},read:function(g){var f=g.indexOf("<");if(f>0){g=g.substring(f);}var e=OpenLayers.Util.Try(OpenLayers.Function.bind((function(){var a;if(window.ActiveXObject&&!this.xmldom){a=new ActiveXObject("Microsoft.XMLDOM");}else{a=this.xmldom;}a.loadXML(g);return a;}),this),function(){return new DOMParser().parseFromString(g,"text/xml");},function(){var a=new XMLHttpRequest();a.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(g),false);if(a.overrideMimeType){a.overrideMimeType("text/xml");}a.send(null);return a.responseXML;});if(this.keepData){this.data=e;}return e;},write:function(f){var j;if(this.xmldom){j=f.xml;}else{var g=new XMLSerializer();if(f.nodeType==1){var h=document.implementation.createDocument("","",null);if(h.importNode){f=h.importNode(f,true);}h.appendChild(f);j=g.serializeToString(h);}else{j=g.serializeToString(f);}}return j;},createElementNS:function(g,f){var e;if(this.xmldom){if(typeof g=="string"){e=this.xmldom.createNode(1,f,g);}else{e=this.xmldom.createNode(1,f,"");}}else{e=document.createElementNS(g,f);}return e;},createTextNode:function(d){var e;if(typeof d!=="string"){d=String(d);}if(this.xmldom){e=this.xmldom.createTextNode(d);}else{e=document.createTextNode(d);}return e;},getElementsByTagNameNS:function(s,t,u){var w=[];if(s.getElementsByTagNameNS){w=s.getElementsByTagNameNS(t,u);}else{var v=s.getElementsByTagName("*");var m,r;for(var q=0,o=v.length;q<o;++q){m=v[q];r=(m.prefix)?(m.prefix+":"+u):u;if((u=="*")||(r==m.nodeName)){if((t=="*")||(t==m.namespaceURI)){w.push(m);}}}}return w;},getAttributeNodeNS:function(u,v,w){var m=null;if(u.getAttributeNodeNS){m=u.getAttributeNodeNS(v,w);}else{var s=u.attributes;var o,t;for(var r=0,q=s.length;r<q;++r){o=s[r];if(o.namespaceURI==v){t=(o.prefix)?(o.prefix+":"+w):w;if(t==o.nodeName){m=o;break;}}}}return m;},getAttributeNS:function(j,l,h){var g="";if(j.getAttributeNS){g=j.getAttributeNS(l,h)||"";}else{var m=this.getAttributeNodeNS(j,l,h);if(m){g=m.nodeValue;}}return g;},getChildValue:function(g,j){var f=j||"";if(g){for(var h=g.firstChild;h;h=h.nextSibling){switch(h.nodeType){case 3:case 4:f+=h.nodeValue;}}}return f;},concatChildValues:function(g,l){var m="";var j=g.firstChild;var h;while(j){h=j.nodeValue;if(h){m+=h;}j=j.nextSibling;}if(m==""&&l!=undefined){m=l;}return m;},isSimpleContent:function(f){var g=true;for(var e=f.firstChild;e;e=e.nextSibling){if(e.nodeType===1){g=false;break;}}return g;},contentType:function(m){var j=false,g=false;var h=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(var l=m.firstChild;l;l=l.nextSibling){switch(l.nodeType){case 1:g=true;break;case 8:break;default:j=true;}if(g&&j){break;}}if(g&&j){h=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;}else{if(g){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;}else{if(j){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE;}}}return h;},hasAttributeNS:function(j,f,g){var h=false;if(j.hasAttributeNS){h=j.hasAttributeNS(f,g);}else{h=!!this.getAttributeNodeNS(j,f,g);}return h;},setAttributeNS:function(l,m,h,j){if(l.setAttributeNS){l.setAttributeNS(m,h,j);}else{if(this.xmldom){if(m){var g=l.ownerDocument.createNode(2,h,m);g.nodeValue=j;l.setAttributeNode(g);}else{l.setAttribute(h,j);}}else{throw"setAttributeNS not implemented";}}},createElementNSPlus:function(h,j){j=j||{};var o=j.uri||this.namespaces[j.prefix];if(!o){var l=h.indexOf(":");o=this.namespaces[h.substring(0,l)];}if(!o){o=this.namespaces[this.defaultPrefix];}var q=this.createElementNS(o,h);if(j.attributes){this.setAttributes(q,j.attributes);}var m=j.value;if(m!=null){q.appendChild(this.createTextNode(m));}return q;},setAttributes:function(m,j){var l,g;for(var h in j){if(j[h]!=null&&j[h].toString){l=j[h].toString();g=this.namespaces[h.substring(0,h.indexOf(":"))]||null;this.setAttributeNS(m,g,h,l);}}},readNode:function(m,j){if(!j){j={};}var l=this.readers[m.namespaceURI?this.namespaceAlias[m.namespaceURI]:this.defaultPrefix];if(l){var g=m.localName||m.nodeName.split(":").pop();var h=l[g]||l["*"];if(h){h.apply(this,[m,j]);}}return j;},readChildNodes:function(o,m){if(!m){m={};}var q=o.childNodes;var l;for(var h=0,j=q.length;h<j;++h){l=q[h];if(l.nodeType==1){this.readNode(l,m);}}return m;},writeNode:function(l,o,r){var q,s;var j=l.indexOf(":");if(j>0){q=l.substring(0,j);s=l.substring(j+1);}else{if(r){q=this.namespaceAlias[r.namespaceURI];}else{q=this.defaultPrefix;}s=l;}var m=this.writers[q][s].apply(this,[o]);if(r){r.appendChild(m);}return m;},getChildEl:function(g,f,e){return g&&this.getThisOrNextEl(g.firstChild,f,e);},getNextEl:function(g,f,e){return g&&this.getThisOrNextEl(g.nextSibling,f,e);},getThisOrNextEl:function(h,g,j){outer:for(var f=h;f;f=f.nextSibling){switch(f.nodeType){case 1:if((!g||g===(f.localName||f.nodeName.split(":").pop()))&&(!j||j===f.namespaceURI)){break outer;}f=null;break outer;case 3:if(/^\s*$/.test(f.nodeValue)){break;}case 4:case 6:case 12:case 10:case 11:f=null;break outer;}}return f||null;},lookupNamespaceURI:function(m,l){var o=null;if(m){if(m.lookupNamespaceURI){o=m.lookupNamespaceURI(l);}else{outer:switch(m.nodeType){case 1:if(m.namespaceURI!==null&&m.prefix===l){o=m.namespaceURI;break outer;}var h=m.attributes.length;if(h){var j;for(var q=0;q<h;++q){j=m.attributes[q];if(j.prefix==="xmlns"&&j.name==="xmlns:"+l){o=j.value||null;break outer;}else{if(j.name==="xmlns"&&l===null){o=j.value||null;break outer;}}}}o=this.lookupNamespaceURI(m.parentNode,l);break outer;case 2:o=this.lookupNamespaceURI(m.ownerElement,l);break outer;case 9:o=this.lookupNamespaceURI(m.documentElement,l);break outer;case 6:case 12:case 10:case 11:break outer;default:o=this.lookupNamespaceURI(m.parentNode,l);break outer;}}}return o;},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);if(!OpenLayers.Format.OWSCommon){OpenLayers.Format.OWSCommon={};}OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},readers:{ows:{ServiceIdentification:function(e,d){d.serviceIdentification={};this.readChildNodes(e,d.serviceIdentification);},Title:function(e,d){d.title=this.getChildValue(e);},Abstract:function(e,d){d["abstract"]=this.getChildValue(e);},Keywords:function(e,d){d.keywords={};this.readChildNodes(e,d.keywords);},Keyword:function(d,e){e[this.getChildValue(d)]=true;},ServiceType:function(e,d){d.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)};},ServiceTypeVersion:function(e,d){d.serviceTypeVersion=this.getChildValue(e);},Fees:function(e,d){d.fees=this.getChildValue(e);},AccessConstraints:function(e,d){d.accessConstraints=this.getChildValue(e);},ServiceProvider:function(e,d){d.serviceProvider={};this.readChildNodes(e,d.serviceProvider);},ProviderName:function(e,d){d.providerName=this.getChildValue(e);},ProviderSite:function(e,d){d.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href");},ServiceContact:function(e,d){d.serviceContact={};this.readChildNodes(e,d.serviceContact);},IndividualName:function(d,e){e.individualName=this.getChildValue(d);},PositionName:function(d,e){e.positionName=this.getChildValue(d);},ContactInfo:function(d,e){e.contactInfo={};this.readChildNodes(d,e.contactInfo);},Phone:function(d,e){e.phone={};
this.readChildNodes(d,e.phone);},Voice:function(d,e){e.voice=this.getChildValue(d);},Address:function(d,e){e.address={};this.readChildNodes(d,e.address);},DeliveryPoint:function(d,e){e.deliveryPoint=this.getChildValue(d);},City:function(d,e){e.city=this.getChildValue(d);},AdministrativeArea:function(d,e){e.administrativeArea=this.getChildValue(d);},PostalCode:function(d,e){e.postalCode=this.getChildValue(d);},Country:function(d,e){e.country=this.getChildValue(d);},ElectronicMailAddress:function(d,e){e.electronicMailAddress=this.getChildValue(d);},Role:function(d,e){e.role=this.getChildValue(d);},OperationsMetadata:function(e,d){d.operationsMetadata={};this.readChildNodes(e,d.operationsMetadata);},Operation:function(g,e){var f=g.getAttribute("name");e[f]={};this.readChildNodes(g,e[f]);},DCP:function(d,e){e.dcp={};this.readChildNodes(d,e.dcp);},HTTP:function(d,e){e.http={};this.readChildNodes(d,e.http);},Get:function(d,e){e.get=this.getAttributeNS(d,this.namespaces.xlink,"href");},Post:function(d,e){e.post=this.getAttributeNS(d,this.namespaces.xlink,"href");},Parameter:function(g,f){if(!f.parameters){f.parameters={};}var e=g.getAttribute("name");f.parameters[e]={};this.readChildNodes(g,f.parameters[e]);},Value:function(e,d){d[this.getChildValue(e)]=true;},OutputFormat:function(e,d){d.formats.push({value:this.getChildValue(e)});this.readChildNodes(e,d);},WGS84BoundingBox:function(e,g){var f={};f.crs=e.getAttribute("crs");if(g.BoundingBox){g.BoundingBox.push(f);}else{g.projection=f.crs;f=g;}this.readChildNodes(e,f);},BoundingBox:function(e,d){this.readers.ows.WGS84BoundingBox.apply(this,[e,d]);},LowerCorner:function(f,j){var h=this.getChildValue(f).replace(this.regExes.trimSpace,"");h=h.replace(this.regExes.trimComma,",");var g=h.split(this.regExes.splitSpace);j.left=g[0];j.bottom=g[1];},UpperCorner:function(f,j){var h=this.getChildValue(f).replace(this.regExes.trimSpace,"");h=h.replace(this.regExes.trimComma,",");var g=h.split(this.regExes.splitSpace);j.right=g[0];j.top=g[1];j.bounds=new OpenLayers.Bounds(j.left,j.bottom,j.right,j.top);delete j.left;delete j.bottom;delete j.right;delete j.top;}}},writers:{ows:{BoundingBox:function(e){var d=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:e.projection}});this.writeNode("ows:LowerCorner",e,d);this.writeNode("ows:UpperCorner",e,d);return d;},LowerCorner:function(e){var d=this.createElementNSPlus("ows:LowerCorner",{value:e.bounds.left+" "+e.bounds.bottom});return d;},UpperCorner:function(e){var d=this.createElementNSPlus("ows:UpperCorner",{value:e.bounds.right+" "+e.bounds.top});return d;},Title:function(d){var e=this.createElementNSPlus("ows:Title",{value:d});return e;},OutputFormat:function(d){var e=this.createElementNSPlus("ows:OutputFormat",{value:d});return e;}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.0",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",getParser:function(f){var e=f||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=e){var g=OpenLayers.Format.WMC["v"+e.replace(/\./g,"_")];if(!g){throw"Can't find a WMC parser for version "+e;}this.parser=new g(this.options);}return this.parser;},layerToContext:function(f){var g=this.getParser();var e={queryable:f.queryable,visibility:f.visibility,name:f.params.LAYERS,title:f.name,metadataURL:f.metadataURL,version:f.params.VERSION,url:f.url,maxExtent:f.maxExtent,transparent:f.params.TRANSPARENT,numZoomLevels:f.numZoomLevels,units:f.units,isBaseLayer:f.isBaseLayer,opacity:f.opacity,displayInLayerSwitcher:f.displayInLayerSwitcher,singleTile:f.singleTile,tileSize:(f.singleTile||!f.tileSize)?undefined:{width:f.tileSize.w,height:f.tileSize.h},minScale:(f.options.resolutions||f.options.scales||f.options.maxResolution||f.options.minScale)?f.minScale:undefined,maxScale:(f.options.resolutions||f.options.scales||f.options.minResolution||f.options.maxScale)?f.maxScale:undefined,formats:[{value:f.params.FORMAT,current:true}],styles:[{href:f.params.SLD,body:f.params.SLD_BODY,name:f.params.STYLES||g.defaultStyleName,title:g.defaultStyleTitle,current:true}]};return e;},toContext:function(l){var o={};var m=l.layers;if(l.CLASS_NAME=="OpenLayers.Map"){o.bounds=l.getExtent();o.maxExtent=l.maxExtent;o.projection=l.projection;o.size=l.getSize();}else{OpenLayers.Util.applyDefaults(o,l);if(o.layers!=undefined){delete (o.layers);}}if(o.layersContext==undefined){o.layersContext=[];}if(m!=undefined&&m instanceof Array){for(var q=0,j=m.length;q<j;q++){var h=m[q];if(h instanceof OpenLayers.Layer.WMS){o.layersContext.push(this.layerToContext(h));}}}return o;},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(e){var d=null;if(e==null){d=this.namespaces[this.defaultPrefix];}else{for(d in this.namespaces){if(this.namespaces[d]==e){break;}}}return d;},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);},read:function(g){if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g]);}var f=g.documentElement;this.rootPrefix=f.prefix;var e={version:f.getAttribute("version")};this.runChildNodes(e,f);return e;},runChildNodes:function(s,t){var v=t.childNodes;var w,u,q,m;for(var r=0,o=v.length;r<o;++r){w=v[r];if(w.nodeType==1){q=this.getNamespacePrefix(w.namespaceURI);m=w.nodeName.split(":").pop();u=this["read_"+q+"_"+m];if(u){u.apply(this,[s,w]);}}}},read_wmc_General:function(e,d){this.runChildNodes(e,d);},read_wmc_BoundingBox:function(e,d){e.projection=d.getAttribute("SRS");e.bounds=new OpenLayers.Bounds(parseFloat(d.getAttribute("minx")),parseFloat(d.getAttribute("miny")),parseFloat(d.getAttribute("maxx")),parseFloat(d.getAttribute("maxy")));},read_wmc_LayerList:function(e,d){e.layersContext=[];this.runChildNodes(e,d);},read_wmc_Layer:function(f,e){var g={visibility:(e.getAttribute("hidden")!="1"),queryable:(e.getAttribute("queryable")=="1"),formats:[],styles:[]};this.runChildNodes(g,e);f.layersContext.push(g);},read_wmc_Extension:function(d,e){this.runChildNodes(d,e);},read_ol_units:function(d,e){d.units=this.getChildValue(e);},read_ol_maxExtent:function(g,e){var f=new OpenLayers.Bounds(e.getAttribute("minx"),e.getAttribute("miny"),e.getAttribute("maxx"),e.getAttribute("maxy"));g.maxExtent=f;},read_ol_transparent:function(d,e){d.transparent=this.getChildValue(e);},read_ol_numZoomLevels:function(d,e){d.numZoomLevels=parseInt(this.getChildValue(e));},read_ol_opacity:function(d,e){d.opacity=parseFloat(this.getChildValue(e));},read_ol_singleTile:function(d,e){d.singleTile=(this.getChildValue(e)=="true");},read_ol_tileSize:function(e,f){var g={width:f.getAttribute("width"),height:f.getAttribute("height")};e.tileSize=g;},read_ol_isBaseLayer:function(d,e){d.isBaseLayer=(this.getChildValue(e)=="true");},read_ol_displayInLayerSwitcher:function(d,e){d.displayInLayerSwitcher=(this.getChildValue(e)=="true");},read_wmc_Server:function(j,f){j.version=f.getAttribute("version");var h={};var g=f.getElementsByTagName("OnlineResource");if(g.length>0){this.read_wmc_OnlineResource(h,g[0]);}j.url=h.href;},read_wmc_FormatList:function(d,e){this.runChildNodes(d,e);},read_wmc_Format:function(e,f){var g={value:this.getChildValue(f)};if(f.getAttribute("current")=="1"){g.current=true;}e.formats.push(g);},read_wmc_StyleList:function(d,e){this.runChildNodes(d,e);},read_wmc_Style:function(g,e){var f={};
this.runChildNodes(f,e);if(e.getAttribute("current")=="1"){f.current=true;}g.styles.push(f);},read_wmc_SLD:function(e,d){this.runChildNodes(e,d);},read_sld_StyledLayerDescriptor:function(g,e){var f=OpenLayers.Format.XML.prototype.write.apply(this,[e]);g.body=f;},read_wmc_OnlineResource:function(d,e){d.href=this.getAttributeNS(e,this.namespaces.xlink,"href");},read_wmc_Name:function(g,e){var f=this.getChildValue(e);if(f){g.name=f;}},read_wmc_Title:function(e,f){var g=this.getChildValue(f);if(g){e.title=g;}},read_wmc_MetadataURL:function(j,f){var h={};var g=f.getElementsByTagName("OnlineResource");if(g.length>0){this.read_wmc_OnlineResource(h,g[0]);}j.metadataURL=h.href;},read_wmc_Abstract:function(g,e){var f=this.getChildValue(e);if(f){g["abstract"]=f;}},read_wmc_LegendURL:function(j,h){var f={width:h.getAttribute("width"),height:h.getAttribute("height")};var g=h.getElementsByTagName("OnlineResource");if(g.length>0){this.read_wmc_OnlineResource(f,g[0]);}j.legend=f;},write:function(g,e){var f=this.createElementDefaultNS("ViewContext");this.setAttributes(f,{version:this.VERSION,id:(e&&typeof e.id=="string")?e.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});this.setAttributeNS(f,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);f.appendChild(this.write_wmc_General(g));f.appendChild(this.write_wmc_LayerList(g));return OpenLayers.Format.XML.prototype.write.apply(this,[f]);},createElementDefaultNS:function(j,f,g){var h=this.createElementNS(this.namespaces[this.defaultPrefix],j);if(f){h.appendChild(this.createTextNode(f));}if(g){this.setAttributes(h,g);}return h;},setAttributes:function(f,h){var j;for(var g in h){j=h[g].toString();if(j.match(/[A-Z]/)){this.setAttributeNS(f,null,g,j);}else{f.setAttribute(g,j);}}},write_wmc_General:function(f){var g=this.createElementDefaultNS("General");if(f.size){g.appendChild(this.createElementDefaultNS("Window",null,{width:f.size.w,height:f.size.h}));}var e=f.bounds;g.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:e.left.toPrecision(18),miny:e.bottom.toPrecision(18),maxx:e.right.toPrecision(18),maxy:e.top.toPrecision(18),SRS:f.projection}));g.appendChild(this.createElementDefaultNS("Title",f.title));g.appendChild(this.write_ol_MapExtension(f));return g;},write_ol_MapExtension:function(f){var h=this.createElementDefaultNS("Extension");var j=f.maxExtent;if(j){var g=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(g,{minx:j.left.toPrecision(18),miny:j.bottom.toPrecision(18),maxx:j.right.toPrecision(18),maxy:j.top.toPrecision(18)});h.appendChild(g);}return h;},write_wmc_LayerList:function(j){var h=this.createElementDefaultNS("LayerList");for(var f=0,g=j.layersContext.length;f<g;++f){h.appendChild(this.write_wmc_Layer(j.layersContext[f]));}return h;},write_wmc_Layer:function(e){var d=this.createElementDefaultNS("Layer",null,{queryable:e.queryable?"1":"0",hidden:e.visibility?"0":"1"});d.appendChild(this.write_wmc_Server(e));d.appendChild(this.createElementDefaultNS("Name",e.name));d.appendChild(this.createElementDefaultNS("Title",e.title));if(e.metadataURL){d.appendChild(this.write_wmc_MetadataURL(e.metadataURL));}return d;},write_wmc_LayerExtension:function(v){var t=this.createElementDefaultNS("Extension");var w=v.maxExtent;var o=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(o,{minx:w.left.toPrecision(18),miny:w.bottom.toPrecision(18),maxx:w.right.toPrecision(18),maxy:w.top.toPrecision(18)});t.appendChild(o);if(v.tileSize&&!v.singleTile){var m=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(m,v.tileSize);t.appendChild(m);}var q=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"];var u;for(var s=0,r=q.length;s<r;++s){u=this.createOLPropertyNode(v,q[s]);if(u){t.appendChild(u);}}return t;},createOLPropertyNode:function(e,g){var f=null;if(e[g]!=null){f=this.createElementNS(this.namespaces.ol,"ol:"+g);f.appendChild(this.createTextNode(e[g].toString()));}return f;},write_wmc_Server:function(e){var d=this.createElementDefaultNS("Server");this.setAttributes(d,{service:"OGC:WMS",version:e.version});d.appendChild(this.write_wmc_OnlineResource(e.url));return d;},write_wmc_MetadataURL:function(d){var e=this.createElementDefaultNS("MetadataURL");e.appendChild(this.write_wmc_OnlineResource(d));return e;},write_wmc_FormatList:function(m){var l=this.createElementDefaultNS("FormatList");for(var g=0,h=m.formats.length;g<h;g++){var j=m.formats[g];l.appendChild(this.createElementDefaultNS("Format",j.value,(j.current&&j.current==true)?{current:"1"}:null));}return l;},write_wmc_StyleList:function(w){var B=this.createElementDefaultNS("StyleList");var r=w.styles;if(r&&r instanceof Array){var D;for(var z=0,v=r.length;z<v;z++){var q=r[z];var C=this.createElementDefaultNS("Style",null,(q.current&&q.current==true)?{current:"1"}:null);if(q.href){D=this.createElementDefaultNS("SLD");var u=this.write_wmc_OnlineResource(q.href);D.appendChild(u);D.appendChild(this.createElementDefaultNS("Name",q.name));if(q.title){D.appendChild(this.createElementDefaultNS("Title",q.title));}C.appendChild(D);}else{if(q.body){D=this.createElementDefaultNS("SLD");var t=OpenLayers.Format.XML.prototype.read.apply(this,[q.body]);var s=t.documentElement;if(D.ownerDocument&&D.ownerDocument.importNode){s=D.ownerDocument.importNode(s,true);}D.appendChild(s);D.appendChild(this.createElementDefaultNS("Name",q.name));if(q.title){D.appendChild(this.createElementDefaultNS("Title",q.title));}C.appendChild(D);}else{C.appendChild(this.createElementDefaultNS("Name",q.name));C.appendChild(this.createElementDefaultNS("Title",q.title));if(q["abstract"]){C.appendChild(this.createElementDefaultNS("Abstract",q["abstract"]));}}}B.appendChild(C);}}return B;},write_wmc_OnlineResource:function(e){var d=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(d,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(d,this.namespaces.xlink,"xlink:href",e);return d;},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(b){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[b]);},write_wmc_Layer:function(e){var d=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[e]);d.appendChild(this.write_wmc_FormatList(e));d.appendChild(this.write_wmc_StyleList(e));d.appendChild(this.write_wmc_LayerExtension(e));},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(b){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[b]);},read_sld_MinScaleDenominator:function(g,e){var f=parseFloat(this.getChildValue(e));if(f>0){g.maxScale=f;}},read_sld_MaxScaleDenominator:function(d,e){d.minScale=parseFloat(this.getChildValue(e));},write_wmc_Layer:function(f){var j=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[f]);if(f.maxScale){var h=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");h.appendChild(this.createTextNode(f.maxScale.toPrecision(16)));j.appendChild(h);}if(f.minScale){var g=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");g.appendChild(this.createTextNode(f.minScale.toPrecision(16)));j.appendChild(g);}j.appendChild(this.write_wmc_FormatList(f));j.appendChild(this.write_wmc_StyleList(f));j.appendChild(this.write_wmc_LayerExtension(f));return j;},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(b){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[b]);
},read:function(r){var s,t,o;var q=this.regExes.typeStr.exec(r);if(q){t=q[1].toLowerCase();o=q[2];if(this.parse[t]){s=this.parse[t].apply(this,[o]);}if(this.internalProjection&&this.externalProjection){if(s&&s.CLASS_NAME=="OpenLayers.Feature.Vector"){s.geometry.transform(this.externalProjection,this.internalProjection);}else{if(s&&t!="geometrycollection"&&typeof s=="object"){for(var u=0,m=s.length;u<m;u++){var l=s[u];l.geometry.transform(this.externalProjection,this.internalProjection);}}}}}return s;},write:function(w){var r,m,o,t,v;if(w.constructor==Array){r=w;v=true;}else{r=[w];v=false;}var u=[];if(v){u.push("GEOMETRYCOLLECTION(");}for(var s=0,q=r.length;s<q;++s){if(v&&s>0){u.push(",");}m=r[s].geometry;o=m.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[o]){return null;}if(this.internalProjection&&this.externalProjection){m=m.clone();m.transform(this.internalProjection,this.externalProjection);}t=this.extract[o].apply(this,[m]);u.push(o.toUpperCase()+"("+t+")");}if(v){u.push(")");}return u.join("");},extract:{point:function(b){return b.x+" "+b.y;},multipoint:function(j){var h=[];for(var f=0,g=j.components.length;f<g;++f){h.push("("+this.extract.point.apply(this,[j.components[f]])+")");}return h.join(",");},linestring:function(f){var h=[];for(var j=0,g=f.components.length;j<g;++j){h.push(this.extract.point.apply(this,[f.components[j]]));}return h.join(",");},multilinestring:function(j){var h=[];for(var f=0,g=j.components.length;f<g;++f){h.push("("+this.extract.linestring.apply(this,[j.components[f]])+")");}return h.join(",");},polygon:function(j){var h=[];for(var f=0,g=j.components.length;f<g;++f){h.push("("+this.extract.linestring.apply(this,[j.components[f]])+")");}return h.join(",");},multipolygon:function(h){var j=[];for(var f=0,g=h.components.length;f<g;++f){j.push("("+this.extract.polygon.apply(this,[h.components[f]])+")");}return j.join(",");}},parse:{point:function(d){var e=OpenLayers.String.trim(d).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e[0],e[1]));},multipoint:function(l){var h;var o=OpenLayers.String.trim(l).split(this.regExes.parenComma);var m=[];for(var q=0,j=o.length;q<j;++q){h=o[q].replace(this.regExes.trimParens,"$1");m.push(this.parse.point.apply(this,[h]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(m));},linestring:function(j){var m=OpenLayers.String.trim(j).split(",");var l=[];for(var g=0,h=m.length;g<h;++g){l.push(this.parse.point.apply(this,[m[g]]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(l));},multilinestring:function(l){var q;var h=OpenLayers.String.trim(l).split(this.regExes.parenComma);var m=[];for(var o=0,j=h.length;o<j;++o){q=h[o].replace(this.regExes.trimParens,"$1");m.push(this.parse.linestring.apply(this,[q]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(m));},polygon:function(o){var u,l,r;var q=OpenLayers.String.trim(o).split(this.regExes.parenComma);var s=[];for(var t=0,m=q.length;t<m;++t){u=q[t].replace(this.regExes.trimParens,"$1");l=this.parse.linestring.apply(this,[u]).geometry;r=new OpenLayers.Geometry.LinearRing(l.components);s.push(r);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(s));},multipolygon:function(l){var o;var h=OpenLayers.String.trim(l).split(this.regExes.doubleParenComma);var m=[];for(var q=0,j=h.length;q<j;++q){o=h[q].replace(this.regExes.trimParens,"$1");m.push(this.parse.polygon.apply(this,[o]).geometry);}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(m));},geometrycollection:function(j){j=j.replace(/,\s*([A-Za-z])/g,"|$1");var l=OpenLayers.String.trim(j).split("|");var m=[];for(var g=0,h=l.length;g<h;++g){m.push(OpenLayers.Format.WKT.prototype.read.apply(this,[l[g]]));}return m;}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},gmlFormat:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,arguments);OpenLayers.Util.extend(this,b);this.options=b;},read:function(j){var h;if(typeof j=="string"){j=OpenLayers.Format.XML.prototype.read.apply(this,[j]);}var g=j.documentElement;if(g){var m=this;var l=this["read_"+g.nodeName];if(l){h=l.call(this,g);}else{h=new OpenLayers.Format.GML((this.options?this.options:{})).read(j);}}else{h=j;}return h;},read_msGMLOutput:function(w){var C=[];var F=this.getSiblingNodesByTagCriteria(w,this.layerIdentifier);if(F){for(var v=0,j=F.length;v<j;++v){var E=F[v];var u=E.nodeName;if(E.prefix){u=u.split(":")[1];}var u=u.replace(this.layerIdentifier,"");var t=this.getSiblingNodesByTagCriteria(E,this.featureIdentifier);if(t){for(var z=0;z<t.length;z++){var G=t[z];var D=this.parseGeometry(G);var B=this.parseAttributes(G);var H=new OpenLayers.Feature.Vector(D.geometry,B,null);H.bounds=D.bounds;H.type=u;C.push(H);}}}}return C;},read_FeatureInfoResponse:function(v){var B=[];var t=this.getElementsByTagNameNS(v,"*","FIELDS");for(var u=0,s=t.length;u<s;u++){var D=t[u];var r=null;var w={};for(var z=0,j=D.attributes.length;z<j;z++){var C=D.attributes[z];w[C.nodeName]=C.nodeValue;}B.push(new OpenLayers.Feature.Vector(r,w,null));}return B;},getSiblingNodesByTagCriteria:function(r,m){var w=[];var u,s,t,q,v;if(r&&r.hasChildNodes()){u=r.childNodes;t=u.length;for(var o=0;o<t;o++){v=u[o];while(v&&v.nodeType!=1){v=v.nextSibling;o++;}s=(v?v.nodeName:"");if(s.length>0&&s.indexOf(m)>-1){w.push(v);}else{q=this.getSiblingNodesByTagCriteria(v,m);if(q.length>0){(w.length==0)?w=q:w.push(q);}}}}return w;},parseAttributes:function(u){var t={};if(u.nodeType==1){var w=u.childNodes;var v=w.length;for(var s=0;s<v;++s){var z=w[s];if(z.nodeType==1){var o=z.childNodes;if(o.length==1){var q=o[0];if(q.nodeType==3||q.nodeType==4){var B=(z.prefix)?z.nodeName.split(":")[1]:z.nodeName;var r=q.nodeValue.replace(this.regExes.trimSpace,"");t[B]=r;}}}}}return t;},parseGeometry:function(j){if(!this.gmlFormat){this.gmlFormat=new OpenLayers.Format.GML();}var g=this.gmlFormat.parseFeature(j);var h,f=null;if(g){h=g.geometry&&g.geometry.clone();f=g.bounds&&g.bounds.clone();g.destroy();}return{geometry:h,bounds:f};},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){this.id=null;this.bounds=null;},clone:function(){return new OpenLayers.Geometry();},setBounds:function(b){if(b){this.bounds=b.clone();}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds();}},extendBounds:function(d){var e=this.getBounds();if(!e){this.setBounds(d);}else{this.bounds.extend(d);}},getBounds:function(){if(this.bounds==null){this.calculateBounds();}return this.bounds;},calculateBounds:function(){},distanceTo:function(d,e){},getVertices:function(b){},atPoint:function(s,o,r){var u=false;var t=this.getBounds();if((t!=null)&&(s!=null)){var l=(o!=null)?o:0;var m=(r!=null)?r:0;var q=new OpenLayers.Bounds(this.bounds.left-l,this.bounds.bottom-m,this.bounds.right+l,this.bounds.top+m);u=q.containsLonLat(s);}return u;},getLength:function(){return 0;},getArea:function(){return 0;},getCentroid:function(){return null;},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this));},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(o){var m=arguments.callee.format;if(!m){m=new OpenLayers.Format.WKT();arguments.callee.format=m;}var r;var j=m.read(o);if(j instanceof OpenLayers.Feature.Vector){r=j.geometry;}else{if(j instanceof Array){var l=j.length;var q=new Array(l);for(var s=0;s<l;++s){q[s]=j[s].geometry;}r=new OpenLayers.Geometry.Collection(q);}}return r;};OpenLayers.Geometry.segmentsIntersect=function(an,d,am){var T=am&&am.point;var aa=am&&am.tolerance;
var aj=false;var V=an.x1-d.x1;var N=an.y1-d.y1;var Z=an.x2-an.x1;var ac=an.y2-an.y1;var Q=d.y2-d.y1;var af=d.x2-d.x1;var P=(Q*Z)-(af*ac);var ak=(af*N)-(Q*V);var al=(Z*N)-(ac*V);if(P==0){if(ak==0&&al==0){aj=true;}}else{var O=ak/P;var S=al/P;if(O>=0&&O<=1&&S>=0&&S<=1){if(!T){aj=true;}else{var ah=an.x1+(O*Z);var ai=an.y1+(O*ac);aj=new OpenLayers.Geometry.Point(ah,ai);}}}if(aa){var U;if(aj){if(T){var ab=[an,d];var Y,ah,ai;outer:for(var ae=0;ae<2;++ae){Y=ab[ae];for(var M=1;M<3;++M){ah=Y["x"+M];ai=Y["y"+M];U=Math.sqrt(Math.pow(ah-aj.x,2)+Math.pow(ai-aj.y,2));if(U<aa){aj.x=ah;aj.y=ai;break outer;}}}}}else{var ab=[an,d];var W,j,ah,ai,ad,ag;outer:for(var ae=0;ae<2;++ae){W=ab[ae];j=ab[(ae+1)%2];for(var M=1;M<3;++M){ad={x:W["x"+M],y:W["y"+M]};ag=OpenLayers.Geometry.distanceToSegment(ad,j);if(ag.distance<aa){if(T){aj=new OpenLayers.Geometry.Point(ad.x,ad.y);}else{aj=true;}break outer;}}}}}return aj;};OpenLayers.Geometry.distanceToSegment=function(u,E){var F=u.x;var v=u.y;var G=E.x1;var w=E.y1;var H=E.x2;var C=E.y2;var s=H-G;var t=C-w;var z=((s*(F-G))+(t*(v-w)))/(Math.pow(s,2)+Math.pow(t,2));var B,D;if(z<=0){B=G;D=w;}else{if(z>=1){B=H;D=C;}else{B=G+z*s;D=w+z*t;}}return{distance:Math.sqrt(Math.pow(B-F,2)+Math.pow(D-v,2)),x:B,y:D};};OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",autoActivate:false,active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(b){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,b);this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners);}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners);}this.events.destroy();this.events=null;}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null;}if(this.handlers){for(var b in this.handlers){if(this.handlers.hasOwnProperty(b)&&typeof this.handlers[b].destroy=="function"){this.handlers[b].destroy();}}this.handlers=null;}if(this.map){this.map.removeControl(this);this.map=null;}},setMap:function(b){this.map=b;if(this.handler){this.handler.setMap(b);}},draw:function(b){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=OpenLayers.Function.False;}if(this.title!=""){this.div.title=this.title;}}if(b!=null){this.position=b.clone();}this.moveTo(this.position);return this.div;},moveTo:function(b){if((b!=null)&&(this.div!=null)){this.div.style.left=b.x+"px";this.div.style.top=b.y+"px";}},activate:function(){if(this.active){return false;}if(this.handler){this.handler.activate();}this.active=true;if(this.map){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");}this.events.triggerEvent("activate");return true;},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate();}this.active=false;if(this.map){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");}this.events.triggerEvent("deactivate");return true;}return false;},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(b){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);this.removeButtons();this.buttons=null;this.position=null;},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments);e=this.position;this.buttons=[];var g=new OpenLayers.Size(18,18);var f=new OpenLayers.Pixel(e.x+g.w/2,e.y);this._addButton("panup","north-mini.png",f,g);e.y=f.y+g.h;this._addButton("panleft","west-mini.png",e,g);this._addButton("panright","east-mini.png",e.add(g.w,0),g);this._addButton("pandown","south-mini.png",f.add(0,g.h*2),g);this._addButton("zoomin","zoom-plus-mini.png",f.add(0,g.h*3+5),g);this._addButton("zoomworld","zoom-world-mini.png",f.add(0,g.h*4+5),g);this._addButton("zoomout","zoom-minus-mini.png",f.add(0,g.h*5+5),g);return this.div;},_addButton:function(w,t,m,q){var r=OpenLayers.Util.getImagesLocation()+t;var v=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+w,m,q,r,"absolute");this.div.appendChild(v);OpenLayers.Event.observe(v,"mousedown",OpenLayers.Function.bindAsEventListener(this.buttonDown,v));OpenLayers.Event.observe(v,"dblclick",OpenLayers.Function.bindAsEventListener(this.doubleClick,v));OpenLayers.Event.observe(v,"click",OpenLayers.Function.bindAsEventListener(this.doubleClick,v));v.action=w;v.map=this.map;if(!this.slideRatio){var u=this.slideFactor;var s=function(){return u;};}else{var o=this.slideRatio;var s=function(a){return this.map.getSize()[a]*o;};}v.getSlideFactor=s;this.buttons.push(v);return v;},_removeButton:function(b){OpenLayers.Event.stopObservingElement(b);b.map=null;b.getSlideFactor=null;this.div.removeChild(b);OpenLayers.Util.removeItem(this.buttons,b);},removeButtons:function(){for(var b=this.buttons.length-1;b>=0;--b){this._removeButton(this.buttons[b]);}},doubleClick:function(b){OpenLayers.Event.stop(b);return false;},buttonDown:function(b){if(!OpenLayers.Event.isLeftClick(b)){return;}switch(this.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent();break;}OpenLayers.Event.stop(b);},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,divEvents:null,zoomWorldIcon:false,forceFixedZoomLevel:false,mouseDragStart:null,zoomStart:null,initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments);},destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart;},setMap:function(b){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.register("changebaselayer",this,this.redraw);},redraw:function(){if(this.div!=null){this.removeButtons();this._removeZoomBar();}this.draw();},draw:function(f){OpenLayers.Control.prototype.draw.apply(this,arguments);f=this.position.clone();this.buttons=[];var h=new OpenLayers.Size(18,18);var g=new OpenLayers.Pixel(f.x+h.w/2,f.y);var j=h.w;if(this.zoomWorldIcon){g=new OpenLayers.Pixel(f.x+h.w,f.y);}this._addButton("panup","north-mini.png",g,h);f.y=g.y+h.h;this._addButton("panleft","west-mini.png",f,h);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",f.add(h.w,0),h);j*=2;}this._addButton("panright","east-mini.png",f.add(j,0),h);this._addButton("pandown","south-mini.png",g.add(0,h.h*2),h);this._addButton("zoomin","zoom-plus-mini.png",g.add(0,h.h*3+5),h);g=this._addZoomBar(g.add(0,h.h*4+5));this._addButton("zoomout","zoom-minus-mini.png",g,h);return this.div;},_addZoomBar:function(l){var q=OpenLayers.Util.getImagesLocation();var m=this.id+"_"+this.map.id;var j=this.map.getNumZoomLevels()-1-this.map.getZoom();var s=OpenLayers.Util.createAlphaImageDiv(m,l.add(-1,j*this.zoomStopHeight),new OpenLayers.Size(20,9),q+"slider.png","absolute");
this.slider=s;this.sliderEvents=new OpenLayers.Events(this,s,null,true,{includeXY:true});this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var r=new OpenLayers.Size();r.h=this.zoomStopHeight*this.map.getNumZoomLevels();r.w=this.zoomStopWidth;var o=null;if(OpenLayers.Util.alphaHack()){var m=this.id+"_"+this.map.id;o=OpenLayers.Util.createAlphaImageDiv(m,l,new OpenLayers.Size(r.w,this.zoomStopHeight),q+"zoombar.png","absolute",null,"crop");o.style.height=r.h+"px";}else{o=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,l,r,q+"zoombar.png");}this.zoombarDiv=o;this.divEvents=new OpenLayers.Events(this,o,null,true,{includeXY:true});this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(o);this.startTop=parseInt(o.style.top);this.div.appendChild(s);this.map.events.register("zoomend",this,this.moveZoomBar);l=l.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());return l;},_removeZoomBar:function(){this.sliderEvents.un({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});this.sliderEvents.destroy();this.divEvents.un({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.divEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar);},passEventToSlider:function(b){this.sliderEvents.handleBrowserEvent(b);},divClick:function(h){if(!OpenLayers.Event.isLeftClick(h)){return;}var j=h.xy.y;var l=OpenLayers.Util.pagePosition(h.object)[1];var m=(j-l)/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom){m=Math.floor(m);}var g=(this.map.getNumZoomLevels()-1)-m;g=Math.min(Math.max(g,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(g);OpenLayers.Event.stop(h);},zoomBarDown:function(b){if(!OpenLayers.Event.isLeftClick(b)){return;}this.map.events.on({mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=b.xy.clone();this.zoomStart=b.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(b);},zoomBarDrag:function(f){if(this.mouseDragStart!=null){var g=this.mouseDragStart.y-f.xy.y;var h=OpenLayers.Util.pagePosition(this.zoombarDiv);if((f.clientY-h[1])>0&&(f.clientY-h[1])<parseInt(this.zoombarDiv.style.height)-2){var j=parseInt(this.slider.style.top)-g;this.slider.style.top=j+"px";this.mouseDragStart=f.xy.clone();}OpenLayers.Event.stop(f);}},zoomBarUp:function(e){if(!OpenLayers.Event.isLeftClick(e)){return;}if(this.mouseDragStart){this.div.style.cursor="";this.map.events.un({mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var f=this.zoomStart.y-e.xy.y;var g=this.map.zoom;if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){g+=f/this.zoomStopHeight;g=Math.min(Math.max(g,0),this.map.getNumZoomLevels()-1);}else{g+=Math.round(f/this.zoomStopHeight);}this.map.zoomTo(g);this.mouseDragStart=null;this.zoomStart=null;OpenLayers.Event.stop(e);}},moveZoomBar:function(){var b=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=b+"px";},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:false,initialize:function(b){this.easing=(b)?b:OpenLayers.Easing.Expo.easeOut;},start:function(j,f,h,g){this.playing=true;this.begin=j;this.finish=f;this.duration=h;this.callbacks=g.callbacks;this.time=0;if(this.interval){window.clearInterval(this.interval);this.interval=null;}if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin);}this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL);},stop:function(){if(!this.playing){return;}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish);}window.clearInterval(this.interval);this.interval=null;this.playing=false;},play:function(){var j={};for(var m in this.begin){var b=this.begin[m];var l=this.finish[m];if(b==null||l==null||isNaN(b)||isNaN(l)){OpenLayers.Console.error("invalid value for Tween");}var f=l-b;j[m]=this.easing.apply(this,[this.time,b,f,this.duration]);}this.time++;if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,j);}if(this.time>this.duration){this.stop();}},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(j,b,d,h){return d*j/h+b;},easeOut:function(j,b,d,h){return d*j/h+b;},easeInOut:function(j,b,d,h){return d*j/h+b;},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(j,b,d,h){return(j==0)?b:d*Math.pow(2,10*(j/h-1))+b;},easeOut:function(j,b,d,h){return(j==h)?b+d:d*(-Math.pow(2,-10*j/h)+1)+b;},easeInOut:function(j,b,d,h){if(j==0){return b;}if(j==h){return b+d;}if((j/=h/2)<1){return d/2*Math.pow(2,10*(j-1))+b;}return d/2*(-Math.pow(2,-10*--j)+2)+b;},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(j,b,d,h){return d*(j/=h)*j+b;},easeOut:function(j,b,d,h){return -d*(j/=h)*(j-2)+b;},easeInOut:function(j,b,d,h){if((j/=h/2)<1){return d/2*j*j+b;}return -d/2*((--j)*(j-2)-1)+b;},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},EVENT_TYPES:["preaddlayer","addlayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,initialize:function(o,t){if(arguments.length===1&&typeof o==="object"){t=o;o=t&&t.div;}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,t);this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(o);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px";}OpenLayers.Element.addClass(this.div,"olMap");var q=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(q,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);q=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(q);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:true});this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners);}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize);
}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy);}if(this.theme){var r=true;var u=document.getElementsByTagName("link");for(var s=0,m=u.length;s<m;++s){if(OpenLayers.Util.isEquivalentUrl(u.item(s).href,this.theme)){r=false;break;}}if(r){var l=document.createElement("link");l.setAttribute("rel","stylesheet");l.setAttribute("type","text/css");l.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(l);}}if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()];}else{this.controls=[];}}for(var s=0,m=this.controls.length;s<m;s++){this.addControlToMap(this.controls[s]);}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(t&&t.layers){this.addLayers(t.layers);if(t.center){this.setCenter(t.center,t.zoom);}}},render:function(b){this.div=OpenLayers.Util.getElement(b);OpenLayers.Element.addClass(this.div,"olMap");this.events.attachToElement(this.div);this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize();},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false;}if(this.panTween){this.panTween.stop();this.panTween=null;}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy);}else{this.events.unregister("resize",this,this.updateSize);}this.paddingForPopups=null;if(this.controls!=null){for(var b=this.controls.length-1;b>=0;--b){this.controls[b].destroy();}this.controls=null;}if(this.layers!=null){for(var b=this.layers.length-1;b>=0;--b){this.layers[b].destroy(false);}this.layers=null;}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv);}this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null;}this.events.destroy();this.events=null;},setOptions:function(b){OpenLayers.Util.extend(this,b);},getTileSize:function(){return this.tileSize;},getBy:function(j,m,h){var l=(typeof h.test=="function");var g=OpenLayers.Array.filter(this[j],function(a){return a[m]==h||(l&&h.test(a[m]));});return g;},getLayersBy:function(d,e){return this.getBy("layers",d,e);},getLayersByName:function(b){return this.getLayersBy("name",b);},getLayersByClass:function(b){return this.getLayersBy("CLASS_NAME",b);},getControlsBy:function(d,e){return this.getBy("controls",d,e);},getControlsByClass:function(b){return this.getControlsBy("CLASS_NAME",b);},getLayer:function(j){var g=null;for(var l=0,h=this.layers.length;l<h;l++){var m=this.layers[l];if(m.id==j){g=m;break;}}return g;},setLayerZIndex:function(d,e){d.setZIndex(this.Z_INDEX_BASE[d.isBaseLayer?"BaseLayer":"Overlay"]+e*5);},resetLayersZIndex:function(){for(var g=0,f=this.layers.length;g<f;g++){var e=this.layers[g];this.setLayerZIndex(e,g);}},addLayer:function(j){for(var f=0,g=this.layers.length;f<g;f++){if(this.layers[f]==j){var h=OpenLayers.i18n("layerAlreadyAdded",{layerName:j.name});OpenLayers.Console.warn(h);return false;}}if(this.allOverlays){j.isBaseLayer=false;}if(this.events.triggerEvent("preaddlayer",{layer:j})===false){return;}j.div.className="olLayerDiv";j.div.style.overflow="";this.setLayerZIndex(j,this.layers.length);if(j.isFixed){this.viewPortDiv.appendChild(j.div);}else{this.layerContainerDiv.appendChild(j.div);}this.layers.push(j);j.setMap(this);if(j.isBaseLayer||(this.allOverlays&&!this.baseLayer)){if(this.baseLayer==null){this.setBaseLayer(j);}else{j.setVisibility(false);}}else{j.redraw();}this.events.triggerEvent("addlayer",{layer:j});j.afterAdd();},addLayers:function(g){for(var e=0,f=g.length;e<f;e++){this.addLayer(g[e]);}},removeLayer:function(m,j){if(j==null){j=true;}if(m.isFixed){this.viewPortDiv.removeChild(m.div);}else{this.layerContainerDiv.removeChild(m.div);}OpenLayers.Util.removeItem(this.layers,m);m.removeMap(this);m.map=null;if(this.baseLayer==m){this.baseLayer=null;if(j){for(var g=0,h=this.layers.length;g<h;g++){var l=this.layers[g];if(l.isBaseLayer||this.allOverlays){this.setBaseLayer(l);break;}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:m});},getNumLayers:function(){return this.layers.length;},getLayerIndex:function(b){return OpenLayers.Util.indexOf(this.layers,b);},setLayerIndex:function(l,g){var j=this.getLayerIndex(l);if(g<0){g=0;}else{if(g>this.layers.length){g=this.layers.length;}}if(j!=g){this.layers.splice(j,1);this.layers.splice(g,0,l);for(var m=0,h=this.layers.length;m<h;m++){this.setLayerZIndex(this.layers[m],m);}this.events.triggerEvent("changelayer",{layer:l,property:"order"});if(this.allOverlays){if(g===0){this.setBaseLayer(l);}else{if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0]);}}}}},raiseLayer:function(e,g){var f=this.getLayerIndex(e)+g;this.setLayerIndex(e,f);},setBaseLayer:function(j){if(j!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,j)!=-1){var g=this.getCenter();var h=OpenLayers.Util.getResolutionFromScale(this.getScale(),j.units);if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false);}this.baseLayer=j;this.viewRequestID++;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(true);}if(g!=null){var f=this.getZoomForResolution(h||this.resolution,true);this.setCenter(g,f,false,true);}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer});}}},addControl:function(d,e){this.controls.push(d);this.addControlToMap(d,e);},addControls:function(j,m){var q=(arguments.length===1)?[]:m;for(var r=0,l=j.length;r<l;r++){var o=j[r];var s=(q[r])?q[r]:null;this.addControl(o,s);}},addControlToMap:function(e,f){e.outsideViewport=(e.div!=null);if(this.displayProjection&&!e.displayProjection){e.displayProjection=this.displayProjection;}e.setMap(this);var g=e.draw(f);if(g){if(!e.outsideViewport){g.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(g);}}if(e.autoActivate){e.activate();}},getControl:function(j){var g=null;for(var m=0,h=this.controls.length;m<h;m++){var l=this.controls[m];if(l.id==j){g=l;break;}}return g;},removeControl:function(b){if((b)&&(b==this.getControl(b.id))){if(b.div&&(b.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(b.div);}OpenLayers.Util.removeItem(this.controls,b);}},addPopup:function(g,h){if(h){for(var f=this.popups.length-1;f>=0;--f){this.removePopup(this.popups[f]);}}g.map=this;this.popups.push(g);var j=g.draw();if(j){j.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(j);}},removePopup:function(e){OpenLayers.Util.removeItem(this.popups,e);if(e.div){try{this.layerContainerDiv.removeChild(e.div);}catch(d){}}e.map=null;},getSize:function(){var b=null;if(this.size!=null){b=this.size.clone();}return b;},updateSize:function(){var q=this.getCurrentSize();if(q&&!isNaN(q.h)&&!isNaN(q.w)){this.events.clearMouseCache();var l=this.getSize();if(l==null){this.size=l=q;}if(!q.equals(l)){this.size=q;for(var o=0,h=this.layers.length;o<h;o++){this.layers[o].onMapResize();}var j=this.getCenter();if(this.baseLayer!=null&&j!=null){var m=this.getZoom();this.zoom=null;this.setCenter(j,m);}}}},getCurrentSize:function(){var b=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(b.w==0&&b.h==0||isNaN(b.w)&&isNaN(b.h)){b.w=this.div.offsetWidth;b.h=this.div.offsetHeight;}if(b.w==0&&b.h==0||isNaN(b.w)&&isNaN(b.h)){b.w=parseInt(this.div.style.width);b.h=parseInt(this.div.style.height);}return b;},calculateBounds:function(j,h){var m=null;if(j==null){j=this.getCenter();}if(h==null){h=this.getResolution();}if((j!=null)&&(h!=null)){var o=this.getSize();var l=o.w*h;var q=o.h*h;m=new OpenLayers.Bounds(j.lon-l/2,j.lat-q/2,j.lon+l/2,j.lat+q/2);}return m;
},getCenter:function(){var b=null;if(this.center){b=this.center.clone();}return b;},getZoom:function(){return this.zoom;},pan:function(o,q,m){m=OpenLayers.Util.applyDefaults(m,{animate:true,dragging:false});var l=this.getViewPortPxFromLonLat(this.getCenter());var h=l.add(o,q);if(!m.dragging||!h.equals(l)){var j=this.getLonLatFromViewPortPx(h);if(m.animate){this.panTo(j);}else{this.setCenter(j,null,m.dragging);}}},panTo:function(f){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(f)){if(!this.panTween){this.panTween=new OpenLayers.Tween(this.panMethod);}var g=this.getCenter();if(f.lon==g.lon&&f.lat==g.lat){return;}var h={lon:g.lon,lat:g.lat};var j={lon:f.lon,lat:f.lat};this.panTween.start(h,j,this.panDuration,{callbacks:{start:OpenLayers.Function.bind(function(a){this.events.triggerEvent("movestart");},this),eachStep:OpenLayers.Function.bind(function(a){a=new OpenLayers.LonLat(a.lon,a.lat);this.moveTo(a,this.zoom,{dragging:true,noEvent:true});},this),done:OpenLayers.Function.bind(function(a){a=new OpenLayers.LonLat(a.lon,a.lat);this.moveTo(a,this.zoom,{noEvent:true});this.events.triggerEvent("moveend");},this)}});}else{this.setCenter(f);}},setCenter:function(j,g,f,h){this.moveTo(j,g,{dragging:f,forceZoomChange:h,caller:"setCenter"});},moveTo:function(E,v,L){if(!L){L={};}if(v!=null){v=parseFloat(v);if(!this.fractionalZoom){v=Math.round(v);}}var w=L.dragging;var I=L.forceZoomChange;var D=L.noEvent;if(this.panTween&&L.caller=="setCenter"){this.panTween.stop();}if(!this.center&&!this.isValidLonLat(E)){E=this.maxExtent.getCenterLonLat();}if(this.restrictedExtent!=null){if(E==null){E=this.getCenter();}if(v==null){v=this.getZoom();}var H=this.getResolutionForZoom(v);var N=this.calculateBounds(E,H);if(!this.restrictedExtent.containsBounds(N)){var M=this.restrictedExtent.getCenterLonLat();if(N.getWidth()>this.restrictedExtent.getWidth()){E=new OpenLayers.LonLat(M.lon,E.lat);}else{if(N.left<this.restrictedExtent.left){E=E.add(this.restrictedExtent.left-N.left,0);}else{if(N.right>this.restrictedExtent.right){E=E.add(this.restrictedExtent.right-N.right,0);}}}if(N.getHeight()>this.restrictedExtent.getHeight()){E=new OpenLayers.LonLat(E.lon,M.lat);}else{if(N.bottom<this.restrictedExtent.bottom){E=E.add(0,this.restrictedExtent.bottom-N.bottom);}else{if(N.top>this.restrictedExtent.top){E=E.add(0,this.restrictedExtent.top-N.top);}}}}}var J=I||((this.isValidZoomLevel(v))&&(v!=this.getZoom()));var G=(this.isValidLonLat(E))&&(!E.equals(this.center));if(J||G||!w){if(!this.dragging&&!D){this.events.triggerEvent("movestart");}if(G){if((!J)&&(this.center)){this.centerLayerContainer(E);}this.center=E.clone();}if((J)||(this.layerContainerOrigin==null)){this.layerContainerOrigin=this.center.clone();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px";}if(J){this.zoom=v;this.resolution=this.getResolutionForZoom(v);this.viewRequestID++;}var K=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(K,J,w);if(w){this.baseLayer.events.triggerEvent("move");}else{this.baseLayer.events.triggerEvent("moveend",{zoomChanged:J});}}K=this.baseLayer.getExtent();for(var F=0,B=this.layers.length;F<B;F++){var C=this.layers[F];if(C!==this.baseLayer&&!C.isBaseLayer){var z=C.calculateInRange();if(C.inRange!=z){C.inRange=z;if(!z){C.display(false);}this.events.triggerEvent("changelayer",{layer:C,property:"visibility"});}if(z&&C.visibility){C.moveTo(K,J,w);if(w){C.events.triggerEvent("move");}else{C.events.triggerEvent("moveend",{zoomChanged:J});}}}}if(J){for(var F=0,B=this.popups.length;F<B;F++){this.popups[F].updatePosition();}}this.events.triggerEvent("move");if(J){this.events.triggerEvent("zoomend");}}if(!w&&!D){this.events.triggerEvent("moveend");}this.dragging=!!w;},centerLayerContainer:function(e){var f=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var g=this.getViewPortPxFromLonLat(e);if((f!=null)&&(g!=null)){this.layerContainerDiv.style.left=Math.round(f.x-g.x)+"px";this.layerContainerDiv.style.top=Math.round(f.y-g.y)+"px";}},isValidZoomLevel:function(b){return((b!=null)&&(b>=0)&&(b<this.getNumZoomLevels()));},isValidLonLat:function(g){var e=false;if(g!=null){var f=this.getMaxExtent();e=f.containsLonLat(g);}return e;},getProjection:function(){var b=this.getProjectionObject();return b?b.getCode():null;},getProjectionObject:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.projection;}return b;},getMaxResolution:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.maxResolution;}return b;},getMaxExtent:function(d){var e=null;if(d&&d.restricted&&this.restrictedExtent){e=this.restrictedExtent;}else{if(this.baseLayer!=null){e=this.baseLayer.maxExtent;}}return e;},getNumZoomLevels:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.numZoomLevels;}return b;},getExtent:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getExtent();}return b;},getResolution:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getResolution();}else{if(this.allOverlays===true&&this.layers.length>0){b=this.layers[0].getResolution();}}return b;},getUnits:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.units;}return b;},getScale:function(){var g=null;if(this.baseLayer!=null){var e=this.getResolution();var f=this.baseLayer.units;g=OpenLayers.Util.getScaleFromResolution(e,f);}return g;},getZoomForExtent:function(g,e){var f=null;if(this.baseLayer!=null){f=this.baseLayer.getZoomForExtent(g,e);}return f;},getResolutionForZoom:function(d){var e=null;if(this.baseLayer){e=this.baseLayer.getResolutionForZoom(d);}return e;},getZoomForResolution:function(f,g){var e=null;if(this.baseLayer!=null){e=this.baseLayer.getZoomForResolution(f,g);}return e;},zoomTo:function(b){if(this.isValidZoomLevel(b)){this.setCenter(null,b);}},zoomIn:function(){this.zoomTo(this.getZoom()+1);},zoomOut:function(){this.zoomTo(this.getZoom()-1);},zoomToExtent:function(h,j){var f=h.getCenterLonLat();if(this.baseLayer.wrapDateLine){var g=this.getMaxExtent();h=h.clone();while(h.right<h.left){h.right+=g.getWidth();}f=h.getCenterLonLat().wrapDateLine(g);}this.setCenter(f,this.getZoomForExtent(h,j));},zoomToMaxExtent:function(g){var e=(g)?g.restricted:true;var f=this.getMaxExtent({restricted:e});this.zoomToExtent(f);},zoomToScale:function(o,q){var t=OpenLayers.Util.getResolutionFromScale(o,this.baseLayer.units);var u=this.getSize();var r=u.w*t;var l=u.h*t;var m=this.getCenter();var s=new OpenLayers.Bounds(m.lon-r/2,m.lat-l/2,m.lon+r/2,m.lat+l/2);this.zoomToExtent(s,q);},getLonLatFromViewPortPx:function(e){var d=null;if(this.baseLayer!=null){d=this.baseLayer.getLonLatFromViewPortPx(e);}return d;},getViewPortPxFromLonLat:function(d){var e=null;if(this.baseLayer!=null){e=this.baseLayer.getViewPortPxFromLonLat(d);}return e;},getLonLatFromPixel:function(b){return this.getLonLatFromViewPortPx(b);},getPixelFromLonLat:function(d){var e=this.getViewPortPxFromLonLat(d);e.x=Math.round(e.x);e.y=Math.round(e.y);return e;},getGeodesicPixelSize:function(q){var t=q?this.getLonLatFromPixel(q):(this.getCenter()||new OpenLayers.LonLat(0,0));var s=this.getResolution();var u=t.add(-s/2,0);var m=t.add(s/2,0);var v=t.add(0,-s/2);var r=t.add(0,s/2);var o=new OpenLayers.Projection("EPSG:4326");var w=this.getProjectionObject()||o;if(!w.equals(o)){u.transform(w,o);m.transform(w,o);v.transform(w,o);r.transform(w,o);}return new OpenLayers.Size(OpenLayers.Util.distVincenty(u,m),OpenLayers.Util.distVincenty(v,r));},getViewPortPxFromLayerPx:function(h){var j=null;if(h!=null){var f=parseInt(this.layerContainerDiv.style.left);var g=parseInt(this.layerContainerDiv.style.top);j=h.add(f,g);}return j;},getLayerPxFromViewPortPx:function(j){var h=null;if(j!=null){var f=-parseInt(this.layerContainerDiv.style.left);var g=-parseInt(this.layerContainerDiv.style.top);h=j.add(f,g);if(isNaN(h.x)||isNaN(h.y)){h=null;}}return h;},getLonLatFromLayerPx:function(b){b=this.getViewPortPxFromLayerPx(b);return this.getLonLatFromViewPortPx(b);},getLayerPxFromLonLat:function(d){var e=this.getPixelFromLonLat(d);
return this.getLayerPxFromViewPortPx(e);},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,initialize:function(d,e){OpenLayers.Util.extend(this,e);this.projCode=d;if(window.Proj4js){this.proj=new Proj4js.Proj(d);}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode;},getUnits:function(){return this.proj?this.proj.units:null;},toString:function(){return this.getCode();},equals:function(b){if(b&&b.getCode){return this.getCode()==b.getCode();}else{return false;}},destroy:function(){delete this.proj;delete this.projCode;},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.addTransform=function(g,e,f){if(!OpenLayers.Projection.transforms[g]){OpenLayers.Projection.transforms[g]={};}OpenLayers.Projection.transforms[g][e]=f;};OpenLayers.Projection.transform=function(f,g,e){if(g.proj&&e.proj){f=Proj4js.transform(g.proj,e.proj,f);}else{if(g&&e&&OpenLayers.Projection.transforms[g.getCode()]&&OpenLayers.Projection.transforms[g.getCode()][e.getCode()]){OpenLayers.Projection.transforms[g.getCode()][e.getCode()](f);}}return f;};OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend"],RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],metadata:{},initialize:function(d,e){this.addOptions(e);this.name=d;if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners);}}if(this.wrapDateLine){this.displayOutsideMaxExtent=true;}},destroy:function(b){if(b==null){b=true;}if(this.map!=null){this.map.removeLayer(this,b);}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners);}this.events.destroy();}this.eventListeners=null;this.events=null;},clone:function(b){if(b==null){b=new OpenLayers.Layer(this.name,this.getOptions());}OpenLayers.Util.applyDefaults(b,this);b.map=null;return b;},getOptions:function(){var e={};for(var d in this.options){e[d]=this[d];}return e;},setName:function(b){if(b!=this.name){this.name=b;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"});}}},addOptions:function(g){if(this.options==null){this.options={};}OpenLayers.Util.extend(this.options,g);OpenLayers.Util.extend(this,g);if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection);}if(this.projection&&this.projection.getUnits()){this.units=this.projection.getUnits();}if(this.map){var f=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var e in g){if(g.hasOwnProperty(e)&&OpenLayers.Util.indexOf(f,e)>=0){this.initResolutions();break;}}}},onMapResize:function(){},redraw:function(){var e=false;if(this.map){this.inRange=this.calculateInRange();var g=this.getExtent();if(g&&this.inRange&&this.visibility){var f=true;this.moveTo(g,f,false);this.events.triggerEvent("moveend",{zoomChanged:f});e=true;}}return e;},moveTo:function(f,g,j){var h=this.visibility;if(!this.isBaseLayer){h=h&&this.inRange;}this.display(h);},setMap:function(d){if(this.map==null){this.map=d;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection);}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var e=((this.visibility)&&(this.inRange));this.div.style.display=e?"":"none";}this.setTileSize();}},afterAdd:function(){},removeMap:function(b){},getImageSize:function(b){return(this.imageSize||this.tileSize);},setTileSize:function(e){var d=(e)?e:((this.tileSize)?this.tileSize:this.map.getTileSize());this.tileSize=d;if(this.gutter){this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter);this.imageSize=new OpenLayers.Size(d.w+(2*this.gutter),d.h+(2*this.gutter));}},getVisibility:function(){return this.visibility;},setVisibility:function(b){if(b!=this.visibility){this.visibility=b;this.display(b);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"});}this.events.triggerEvent("visibilitychanged");}},display:function(b){if(b!=(this.div.style.display!="none")){this.div.style.display=(b&&this.calculateInRange())?"block":"none";}},calculateInRange:function(){var d=false;if(this.alwaysInRange){d=true;}else{if(this.map){var e=this.map.getResolution();d=((e>=this.minResolution)&&(e<=this.maxResolution));}}return d;},setIsBaseLayer:function(b){if(b!=this.isBaseLayer){this.isBaseLayer=b;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this});}}},initResolutions:function(){var s,m;var r={},t=true;for(s=0,m=this.RESOLUTION_PROPERTIES.length;s<m;s++){var o=this.RESOLUTION_PROPERTIES[s];r[o]=this.options[o];if(t&&this.options[o]){t=false;}}if(this.alwaysInRange==null){this.alwaysInRange=t;}if(r.resolutions==null){r.resolutions=this.resolutionsFromScales(r.scales);}if(r.resolutions==null){r.resolutions=this.calculateResolutions(r);}if(r.resolutions==null){for(s=0,m=this.RESOLUTION_PROPERTIES.length;s<m;s++){var o=this.RESOLUTION_PROPERTIES[s];r[o]=this.options[o]!=null?this.options[o]:this.map[o];}if(r.resolutions==null){r.resolutions=this.resolutionsFromScales(r.scales);}if(r.resolutions==null){r.resolutions=this.calculateResolutions(r);}}var u;if(this.options.maxResolution&&this.options.maxResolution!=="auto"){u=this.options.maxResolution;}if(this.options.minScale){u=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units);}var l;if(this.options.minResolution&&this.options.minResolution!=="auto"){l=this.options.minResolution;}if(this.options.maxScale){l=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units);}if(r.resolutions){r.resolutions.sort(function(a,b){return(b-a);});if(!u){u=r.resolutions[0];}if(!l){var q=r.resolutions.length-1;l=r.resolutions[q];}}this.resolutions=r.resolutions;if(this.resolutions){m=this.resolutions.length;this.scales=new Array(m);for(s=0;s<m;s++){this.scales[s]=OpenLayers.Util.getScaleFromResolution(this.resolutions[s],this.units);}this.numZoomLevels=m;}this.minResolution=l;if(l){this.maxScale=OpenLayers.Util.getScaleFromResolution(l,this.units);}this.maxResolution=u;if(u){this.minScale=OpenLayers.Util.getScaleFromResolution(u,this.units);}},resolutionsFromScales:function(h){if(h==null){return;}var f,j,g;g=h.length;f=new Array(g);for(j=0;j<g;j++){f[j]=OpenLayers.Util.getResolutionFromScale(h[j],this.units);}return f;},calculateResolutions:function(t){var r=t.maxResolution;if(t.minScale!=null){r=OpenLayers.Util.getResolutionFromScale(t.minScale,this.units);}else{if(r=="auto"&&this.maxExtent!=null){var s=this.map.getSize();var u=this.maxExtent.getWidth()/s.w;var w=this.maxExtent.getHeight()/s.h;r=Math.max(u,w);}}var z=t.minResolution;if(t.maxScale!=null){z=OpenLayers.Util.getResolutionFromScale(t.maxScale,this.units);
}else{if(t.minResolution=="auto"&&this.minExtent!=null){var s=this.map.getSize();var u=this.minExtent.getWidth()/s.w;var w=this.minExtent.getHeight()/s.h;z=Math.max(u,w);}}var F=t.maxZoomLevel;var E=t.numZoomLevels;if(typeof z==="number"&&typeof r==="number"&&E===undefined){var v=r/z;E=Math.floor(Math.log(v)/Math.log(2))+1;}else{if(E===undefined&&F!=null){E=F+1;}}if(typeof E!=="number"||E<=0||(typeof r!=="number"&&typeof z!=="number")){return;}var C=new Array(E);var D=2;if(typeof z=="number"&&typeof r=="number"){D=Math.pow((r/z),(1/(E-1)));}var B;if(typeof r==="number"){for(B=0;B<E;B++){C[B]=r/Math.pow(D,B);}}else{for(B=0;B<E;B++){C[E-1-B]=z*Math.pow(D,B);}}return C;},getResolution:function(){var b=this.map.getZoom();return this.getResolutionForZoom(b);},getExtent:function(){return this.map.calculateBounds();},getZoomForExtent:function(f,j){var h=this.map.getSize();var g=Math.max(f.getWidth()/h.w,f.getHeight()/h.h);return this.getZoomForResolution(g,j);},getDataExtent:function(){},getResolutionForZoom:function(j){j=Math.max(0,Math.min(j,this.resolutions.length-1));var f;if(this.map.fractionalZoom){var g=Math.floor(j);var h=Math.ceil(j);f=this.resolutions[g]-((j-g)*(this.resolutions[g]-this.resolutions[h]));}else{f=this.resolutions[Math.round(j)];}return f;},getZoomForResolution:function(D,H){var s;if(this.map.fractionalZoom){var v=0;var F=this.resolutions.length-1;var E=this.resolutions[v];var G=this.resolutions[F];var w;for(var C=0,B=this.resolutions.length;C<B;++C){w=this.resolutions[C];if(w>=D){E=w;v=C;}if(w<=D){G=w;F=C;break;}}var z=E-G;if(z>0){s=v+((E-D)/z);}else{s=v;}}else{var u;var t=Number.POSITIVE_INFINITY;for(var C=0,B=this.resolutions.length;C<B;C++){if(H){u=Math.abs(this.resolutions[C]-D);if(u>t){break;}t=u;}else{if(this.resolutions[C]<D){break;}}}s=Math.max(0,C-1);}return s;},getLonLatFromViewPortPx:function(j){var q=null;if(j!=null){var r=this.map.getSize();var l=this.map.getCenter();if(l){var s=this.map.getResolution();var m=j.x-(r.w/2);var o=j.y-(r.h/2);q=new OpenLayers.LonLat(l.lon+m*s,l.lat-o*s);if(this.wrapDateLine){q=q.wrapDateLine(this.maxExtent);}}}return q;},getViewPortPxFromLonLat:function(h){var f=null;if(h!=null){var g=this.map.getResolution();var j=this.map.getExtent();f=new OpenLayers.Pixel((1/g*(h.lon-j.left)),(1/g*(j.top-h.lat)));}return f;},setOpacity:function(f){if(f!=this.opacity){this.opacity=f;for(var h=0,g=this.div.childNodes.length;h<g;++h){var j=this.div.childNodes[h].firstChild;OpenLayers.Util.modifyDOMElement(j,null,null,null,null,null,null,f);}if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"});}}},getZIndex:function(){return this.div.style.zIndex;},setZIndex:function(b){this.div.style.zIndex=b;},adjustBounds:function(e){if(this.gutter){var f=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-f,e.bottom-f,e.right+f,e.top+f);}if(this.wrapDateLine){var g={rightTolerance:this.getResolution()};e=e.wrapDateLine(this.maxExtent,g);}return e;},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(l,h,j,g,m){this.layer=l;this.position=h.clone();this.bounds=j.clone();this.url=g;this.size=m.clone();this.id=OpenLayers.Util.createUniqueID("Tile_");this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload");}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.events.destroy();this.events=null;},clone:function(b){if(b==null){b=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size);}OpenLayers.Util.applyDefaults(b,this);return b;},draw:function(){var e=this.layer.maxExtent;var d=(e&&this.bounds.intersectsBounds(e,false));this.shouldDraw=(d||this.layer.displayOutsideMaxExtent);this.clear();return this.shouldDraw;},moveTo:function(e,f,g){if(g==null){g=true;}this.bounds=e.clone();this.position=f.clone();if(g){this.draw();}},clear:function(){},getBoundsFromBaseLayer:function(j){var l=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(l);var o=this.layer.map.getLonLatFromLayerPx(j);var q=j.clone();q.x+=this.size.w;q.y+=this.size.h;var h=this.layer.map.getLonLatFromLayerPx(q);if(o.lon>h.lon){if(o.lon<0){o.lon=-180-(o.lon+180);}else{h.lon=180+h.lon+180;}}var m=new OpenLayers.Bounds(o.lon,h.lat,h.lon,o.lat);return m;},showTile:function(){if(this.shouldDraw){this.show();}},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:false,lastRatio:1,isFirstDraw:true,backBufferTile:null,initialize:function(l,h,j,g,m){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=g;this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute";this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();},destroy:function(){if(this.imgDiv!=null){if(this.layerAlphaHack){OpenLayers.Event.stopObservingElement(this.imgDiv.childNodes[0]);}OpenLayers.Event.stopObservingElement(this.imgDiv);if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null;}this.imgDiv.urls=null;this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif";}this.imgDiv=null;if((this.frame!=null)&&(this.frame.parentNode==this.layer.div)){this.layer.div.removeChild(this.frame);}this.frame=null;if(this.backBufferTile){this.backBufferTile.destroy();this.backBufferTile=null;}this.layer.events.unregister("loadend",this,this.resetBackBuffer);OpenLayers.Tile.prototype.destroy.apply(this,arguments);},clone:function(b){if(b==null){b=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size);}b=OpenLayers.Tile.prototype.clone.apply(this,[b]);b.imgDiv=null;return b;},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position);}var b=OpenLayers.Tile.prototype.draw.apply(this,arguments);if((OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1)||this.layer.singleTile){if(b){if(!this.backBufferTile){this.backBufferTile=this.clone();this.backBufferTile.hide();this.backBufferTile.isBackBuffer=true;this.events.register("loadend",this,this.resetBackBuffer);this.layer.events.register("loadend",this,this.resetBackBuffer);}this.startTransition();}else{if(this.backBufferTile){this.backBufferTile.clear();}}}else{if(b&&this.isFirstDraw){this.events.register("loadend",this,this.showTile);this.isFirstDraw=false;}}if(!b){return false;}if(this.isLoading){this.events.triggerEvent("reload");}else{this.isLoading=true;this.events.triggerEvent("loadstart");}return this.renderTile();},resetBackBuffer:function(){this.showTile();if(this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=false;var e=this.layer.maxExtent;var d=(e&&this.bounds.intersectsBounds(e,false));if(d){this.backBufferTile.position=this.position;this.backBufferTile.bounds=this.bounds;this.backBufferTile.size=this.size;this.backBufferTile.imageSize=this.layer.getImageSize(this.bounds)||this.size;this.backBufferTile.imageOffset=this.layer.imageOffset;this.backBufferTile.resolution=this.layer.getResolution();this.backBufferTile.renderTile();}this.backBufferTile.hide();}},renderTile:function(){if(this.imgDiv==null){this.initImgDiv();}this.imgDiv.viewRequestID=this.layer.map.viewRequestID;if(this.layer.async){this.layer.getURLasync(this.bounds,this,"url",this.positionImage);}else{if(this.layer.url instanceof Array){this.imgDiv.urls=this.layer.url.slice();}this.url=this.layer.getURL(this.bounds);this.positionImage();}return true;},positionImage:function(){if(this.layer===null){return;}OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);
var b=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,b,this.url);}else{OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,b);this.imgDiv.src=this.url;}},clear:function(){if(this.imgDiv){this.hide();if(OpenLayers.Tile.Image.useBlankTile){this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif";}}},initImgDiv:function(){var h=this.layer.imageOffset;var f=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,h,f,null,"relative",null,null,null,true);}else{this.imgDiv=OpenLayers.Util.createImage(null,h,f,null,"relative",null,null,true);}this.imgDiv.className="olTileImage";this.frame.style.zIndex=this.isBackBuffer?0:1;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity);}this.imgDiv.map=this.layer.map;var j=function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend");}};if(this.layerAlphaHack){OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(j,this));}else{OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(j,this));}var g=function(){if(this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS){j.call(this);}};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(g,this));},checkImgURL:function(){if(this.layer){var b=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;if(!OpenLayers.Util.isEquivalentUrl(b,this.url)){this.hide();}}},startTransition:function(){if(!this.backBufferTile||!this.backBufferTile.imgDiv){return;}var o=1;if(this.backBufferTile.resolution){o=this.backBufferTile.resolution/this.layer.getResolution();}if(o!=this.lastRatio){if(this.layer.transitionEffect=="resize"){var q=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top);var h=new OpenLayers.Size(this.backBufferTile.size.w*o,this.backBufferTile.size.h*o);var j=this.layer.map.getLayerPxFromLonLat(q);OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,j,h);var m=this.backBufferTile.imageSize;m=new OpenLayers.Size(m.w*o,m.h*o);var l=this.backBufferTile.imageOffset;if(l){l=new OpenLayers.Pixel(l.x*o,l.y*o);}OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,l,m);this.backBufferTile.show();}}else{if(this.layer.singleTile){this.backBufferTile.show();}else{this.backBufferTile.hide();}}this.lastRatio=o;},show:function(){this.frame.style.display="";if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.frame.scrollLeft=this.frame.scrollLeft;}}},hide:function(){this.frame.style.display="none";},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.useBlankTile=(OpenLayers.Util.getBrowserName()=="safari"||OpenLayers.Util.getBrowserName()=="opera");OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(m,g,j,l,h){this.url=g;this.extent=j;this.maxExtent=j;this.size=l;OpenLayers.Layer.prototype.initialize.apply(this,[m,h]);this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w);},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null;}OpenLayers.Layer.prototype.destroy.apply(this,arguments);},clone:function(b){if(b==null){b=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions());}b=OpenLayers.Layer.prototype.clone.apply(this,[b]);return b;},setMap:function(b){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w;}OpenLayers.Layer.prototype.setMap.apply(this,arguments);},moveTo:function(m,j,l){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var h=(this.tile==null);if(j||h){this.setTileSize();var o=new OpenLayers.LonLat(this.extent.left,this.extent.top);var q=this.map.getLayerPxFromLonLat(o);if(h){this.tile=new OpenLayers.Tile.Image(this,q,this.extent,null,this.tileSize);this.addTileMonitoringHooks(this.tile);}else{this.tile.size=this.tileSize.clone();this.tile.position=q.clone();}this.tile.draw();}},setTileSize:function(){var d=this.extent.getWidth()/this.map.getResolution();var e=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(d,e);},addTileMonitoringHooks:function(b){b.onLoadStart=function(){this.events.triggerEvent("loadstart");};b.events.register("loadstart",this,b.onLoadStart);b.onLoadEnd=function(){this.events.triggerEvent("loadend");};b.events.register("loadend",this,b.onLoadEnd);b.events.register("unload",this,b.onLoadEnd);},removeTileMonitoringHooks:function(b){b.unload();b.events.un({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,scope:this});},setUrl:function(b){this.url=b;this.tile.draw();},getURL:function(b){return this.url;},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(b!=null){this.addComponents(b);}},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments);},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");for(var i=0,len=this.components.length;i<len;i++){geometry.addComponent(this.components[i].clone());}OpenLayers.Util.applyDefaults(geometry,this);return geometry;},getComponentsString:function(){var e=[];for(var g=0,f=this.components.length;g<f;g++){e.push(this.components[g].toShortString());}return e.join(",");},calculateBounds:function(){this.bounds=null;if(this.components&&this.components.length>0){this.setBounds(this.components[0].getBounds());for(var d=1,e=this.components.length;d<e;d++){this.extendBounds(this.components[d].getBounds());}}},addComponents:function(g){if(!(g instanceof Array)){g=[g];}for(var e=0,f=g.length;e<f;e++){this.addComponent(g[e]);}},addComponent:function(g,h){var l=false;if(g){if(this.componentTypes==null||(OpenLayers.Util.indexOf(this.componentTypes,g.CLASS_NAME)>-1)){if(h!=null&&(h<this.components.length)){var j=this.components.slice(0,h);var m=this.components.slice(h,this.components.length);j.push(g);this.components=j.concat(m);}else{this.components.push(g);}g.parent=this;this.clearBounds();l=true;}}return l;},removeComponents:function(d){if(!(d instanceof Array)){d=[d];}for(var e=d.length-1;e>=0;--e){this.removeComponent(d[e]);}},removeComponent:function(b){OpenLayers.Util.removeItem(this.components,b);this.clearBounds();},getLength:function(){var g=0;for(var e=0,f=this.components.length;e<f;e++){g+=this.components[e].getLength();}return g;},getArea:function(){var g=0;for(var e=0,f=this.components.length;e<f;e++){g+=this.components[e].getArea();}return g;},getGeodesicArea:function(f){var h=0;for(var j=0,g=this.components.length;j<g;j++){h+=this.components[j].getGeodesicArea(f);}return h;},getCentroid:function(w){if(!w){return this.components.length&&this.components[0].getCentroid();}var s=this.components.length;if(!s){return false;}var E=[];var D=[];var C=0;var v=Number.MAX_VALUE;var r;for(var t=0;t<s;++t){r=this.components[t];var B=r.getArea();var z=r.getCentroid(true);if(isNaN(B)||isNaN(z.x)||isNaN(z.y)){continue;}E.push(B);C+=B;v=(B<v&&B>0)?B:v;D.push(z);}s=E.length;if(C===0){for(var t=0;t<s;++t){E[t]=1;}C=E.length;}else{for(var t=0;t<s;++t){E[t]/=v;}C/=v;}var u=0,F=0,z,B;for(var t=0;t<s;++t){z=D[t];B=E[t];u+=z.x*B;F+=z.y*B;}return new OpenLayers.Geometry.Point(u/C,F/C);},getGeodesicLength:function(f){var h=0;for(var j=0,g=this.components.length;j<g;j++){h+=this.components[j].getGeodesicLength(f);}return h;},move:function(f,h){for(var j=0,g=this.components.length;j<g;j++){this.components[j].move(f,h);
}},rotate:function(h,f){for(var j=0,g=this.components.length;j<g;++j){this.components[j].rotate(h,f);}},resize:function(h,g,j){for(var f=0;f<this.components.length;++f){this.components[f].resize(h,g,j);}return this;},distanceTo:function(r,q){var w=!(q&&q.edge===false);var B=w&&q&&q.details;var o,v,z;var u=Number.POSITIVE_INFINITY;for(var t=0,s=this.components.length;t<s;++t){o=this.components[t].distanceTo(r,q);z=B?o.distance:o;if(z<u){u=z;v=o;if(u==0){break;}}}return v;},equals:function(h){var f=true;if(!h||!h.CLASS_NAME||(this.CLASS_NAME!=h.CLASS_NAME)){f=false;}else{if(!(h.components instanceof Array)||(h.components.length!=this.components.length)){f=false;}else{for(var j=0,g=this.components.length;j<g;++j){if(!this.components[j].equals(h.components[j])){f=false;break;}}}}return f;},transform:function(j,m){if(j&&m){for(var l=0,h=this.components.length;l<h;l++){var g=this.components[l];g.transform(j,m);}this.bounds=null;}return this;},intersects:function(h){var f=false;for(var j=0,g=this.components.length;j<g;++j){f=h.intersects(this.components[j]);if(f){break;}}return f;},getVertices:function(f){var j=[];for(var h=0,g=this.components.length;h<g;++h){Array.prototype.push.apply(j,this.components[h].getVertices(f));}return j;},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,d){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(e);this.y=parseFloat(d);},clone:function(b){if(b==null){b=new OpenLayers.Geometry.Point(this.x,this.y);}OpenLayers.Util.applyDefaults(b,this);return b;},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y);},distanceTo:function(t,o){var v=!(o&&o.edge===false);var B=v&&o&&o.details;var z,u,r,w,s,q;if(t instanceof OpenLayers.Geometry.Point){u=this.x;r=this.y;w=t.x;s=t.y;z=Math.sqrt(Math.pow(u-w,2)+Math.pow(r-s,2));q=!B?z:{x0:u,y0:r,x1:w,y1:s,distance:z};}else{q=t.distanceTo(this,o);if(B){q={x0:q.x1,y0:q.y1,x1:q.x0,y1:q.y0,distance:q.distance};}}return q;},equals:function(e){var d=false;if(e!=null){d=((this.x==e.x&&this.y==e.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)));}return d;},toShortString:function(){return(this.x+", "+this.y);},move:function(e,d){this.x=this.x+e;this.y=this.y+d;this.clearBounds();},rotate:function(h,f){h*=Math.PI/180;var g=this.distanceTo(f);var j=h+Math.atan2(this.y-f.y,this.x-f.x);this.x=f.x+(g*Math.cos(j));this.y=f.y+(g*Math.sin(j));this.clearBounds();},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y);},resize:function(g,f,e){e=(e==undefined)?1:e;this.x=f.x+(g*e*(this.x-f.x));this.y=f.y+(g*(this.y-f.y));this.clearBounds();return this;},intersects:function(d){var e=false;if(d.CLASS_NAME=="OpenLayers.Geometry.Point"){e=this.equals(d);}else{e=d.intersects(this);}return e;},transform:function(d,e){if((d&&e)){OpenLayers.Projection.transform(this,d,e);this.bounds=null;}return this;},getVertices:function(b){return[this];},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(b){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},addPoint:function(e,d){this.addComponent(e,d);},removePoint:function(b){this.removeComponent(b);},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(b){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments);},getLength:function(){var g=0;if(this.components&&(this.components.length>1)){for(var e=1,f=this.components.length;e<f;e++){g+=this.components[e-1].distanceTo(this.components[e]);}}return g;},getGeodesicLength:function(l){var s=this;if(l){var u=new OpenLayers.Projection("EPSG:4326");if(!u.equals(l)){s=this.clone().transform(l,u);}}var r=0;if(s.components&&(s.components.length>1)){var o,q;for(var t=1,m=s.components.length;t<m;t++){o=s.components[t-1];q=s.components[t];r+=OpenLayers.Util.distVincenty({lon:o.x,lat:o.y},{lon:q.x,lat:q.y});}}return r*1000;},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(b){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments);},removeComponent:function(b){if(this.components&&(this.components.length>2)){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);}},intersects:function(z){var I=false;var B=z.CLASS_NAME;if(B=="OpenLayers.Geometry.LineString"||B=="OpenLayers.Geometry.LinearRing"||B=="OpenLayers.Geometry.Point"){var O=this.getSortedSegments();var j;if(B=="OpenLayers.Geometry.Point"){j=[{x1:z.x,y1:z.y,x2:z.x,y2:z.y}];}else{j=z.getSortedSegments();}var L,E,G,K,M,N,H,J;outer:for(var D=0,C=O.length;D<C;++D){L=O[D];E=L.x1;G=L.x2;K=L.y1;M=L.y2;inner:for(var F=0,P=j.length;F<P;++F){N=j[F];if(N.x1>G){break;}if(N.x2<E){continue;}H=N.y1;J=N.y2;if(Math.min(H,J)>Math.max(K,M)){continue;}if(Math.max(H,J)<Math.min(K,M)){continue;}if(OpenLayers.Geometry.segmentsIntersect(L,N)){I=true;break outer;}}}}else{I=z.intersects(this);}return I;},getSortedSegments:function(){var j=this.components.length-1;var h=new Array(j),m,o;for(var q=0;q<j;++q){m=this.components[q];o=this.components[q+1];if(m.x<o.x){h[q]={x1:m.x,y1:m.y,x2:o.x,y2:o.y};}else{h[q]={x1:o.x,y1:o.y,x2:m.x,y2:m.y};}}function l(a,b){return a.x1-b.x1;}return h.sort(l);},splitWithSegment:function(F,Y){var W=!(Y&&Y.edge===false);var I=Y&&Y.tolerance;var Z=[];var D=this.getVertices();var K=[];var J=[];var Q=false;var U,V,N;var P,G,M;var T={point:true,tolerance:I};var S=null;for(var L=0,O=D.length-2;L<=O;++L){U=D[L];K.push(U.clone());V=D[L+1];M={x1:U.x,y1:U.y,x2:V.x,y2:V.y};N=OpenLayers.Geometry.segmentsIntersect(F,M,T);if(N instanceof OpenLayers.Geometry.Point){if((N.x===F.x1&&N.y===F.y1)||(N.x===F.x2&&N.y===F.y2)||N.equals(U)||N.equals(V)){G=true;}else{G=false;}if(G||W){if(!N.equals(J[J.length-1])){J.push(N.clone());}if(L===0){if(N.equals(U)){continue;}}if(N.equals(V)){continue;}Q=true;if(!N.equals(U)){K.push(N);}Z.push(new OpenLayers.Geometry.LineString(K));K=[N.clone()];}}}if(Q){K.push(V.clone());Z.push(new OpenLayers.Geometry.LineString(K));}if(J.length>0){var H=F.x1<F.x2?1:-1;var E=F.y1<F.y2?1:-1;S={lines:Z,points:J.sort(function(a,b){return(H*a.x-H*b.x)||(E*a.y-E*b.y);})};}return S;},split:function(J,Y){var N=null;var V=Y&&Y.mutual;var P,U,O,W;if(J instanceof OpenLayers.Geometry.LineString){var L=this.getVertices();var S,T,M,Q,Z,I;var F=[];O=[];for(var E=0,K=L.length-2;E<=K;++E){S=L[E];T=L[E+1];M={x1:S.x,y1:S.y,x2:T.x,y2:T.y};W=W||[J];if(V){F.push(S.clone());}for(var G=0;G<W.length;++G){Q=W[G].splitWithSegment(M,Y);if(Q){Z=Q.lines;if(Z.length>0){Z.unshift(G,1);Array.prototype.splice.apply(W,Z);G+=Z.length-2;}if(V){for(var H=0,j=Q.points.length;H<j;++H){I=Q.points[H];if(!I.equals(S)){F.push(I);O.push(new OpenLayers.Geometry.LineString(F));if(I.equals(T)){F=[];}else{F=[I.clone()];}}}}}}}if(V&&O.length>0&&F.length>0){F.push(T.clone());O.push(new OpenLayers.Geometry.LineString(F));}}else{N=J.splitWith(this,Y);}if(W&&W.length>1){U=true;}else{W=[];}if(O&&O.length>1){P=true;}else{O=[];}if(U||P){if(V){N=[O,W];}else{N=W;}}return N;},splitWith:function(d,e){return d.split(this,e);},getVertices:function(e){var d;if(e===true){d=[this.components[0],this.components[this.components.length-1]];}else{if(e===false){d=this.components.slice(1,this.components.length-1);}else{d=this.components.slice();}}return d;},distanceTo:function(Y,Z){var W=!(Z&&Z.edge===false);var I=W&&Z&&Z.details;var L,ab={};var j=Number.POSITIVE_INFINITY;if(Y instanceof OpenLayers.Geometry.Point){var J=this.getSortedSegments();var N=Y.x;var O=Y.y;var M;for(var S=0,P=J.length;S<P;++S){M=J[S];L=OpenLayers.Geometry.distanceToSegment(Y,M);if(L.distance<j){j=L.distance;ab=L;if(j===0){break;}}else{if(M.x2>N&&((O>M.y1&&O<M.y2)||(O<M.y1&&O>M.y2))){break;
}}}if(I){ab={distance:ab.distance,x0:ab.x,y0:ab.y,x1:N,y1:O};}else{ab=ab.distance;}}else{if(Y instanceof OpenLayers.Geometry.LineString){var ac=this.getSortedSegments();var ad=Y.getSortedSegments();var ae,af,Q,K,aa;var U=ad.length;var V={point:true};outer:for(var S=0,P=ac.length;S<P;++S){ae=ac[S];K=ae.x1;aa=ae.y1;for(var T=0;T<U;++T){af=ad[T];Q=OpenLayers.Geometry.segmentsIntersect(ae,af,V);if(Q){j=0;ab={distance:0,x0:Q.x,y0:Q.y,x1:Q.x,y1:Q.y};break outer;}else{L=OpenLayers.Geometry.distanceToSegment({x:K,y:aa},af);if(L.distance<j){j=L.distance;ab={distance:j,x0:K,y0:aa,x1:L.x,y1:L.y};}}}}if(!I){ab=ab.distance;}if(j!==0){if(ae){L=Y.distanceTo(new OpenLayers.Geometry.Point(ae.x2,ae.y2),Z);var H=I?L.distance:L;if(H<j){if(I){ab={distance:j,x0:L.x1,y0:L.y1,x1:L.x0,y1:L.y0};}else{ab=H;}}}}}else{ab=Y.distanceTo(this,Z);if(I){ab={distance:ab.distance,x0:ab.x1,y0:ab.y1,x1:ab.x0,y1:ab.y0};}}}return ab;},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(b){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments);},addComponent:function(h,g){var m=false;var l=this.components.pop();if(g!=null||!h.equals(l)){m=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments);}var j=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[j]);return m;},removeComponent:function(e){if(this.components.length>4){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var d=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[d]);}},move:function(f,h){for(var j=0,g=this.components.length;j<g-1;j++){this.components[j].move(f,h);}},rotate:function(h,f){for(var j=0,g=this.components.length;j<g-1;++j){this.components[j].rotate(h,f);}},resize:function(j,g,l){for(var m=0,h=this.components.length;m<h-1;++m){this.components[m].resize(j,g,l);}return this;},transform:function(j,m){if(j&&m){for(var l=0,h=this.components.length;l<h-1;l++){var g=this.components[l];g.transform(j,m);}this.bounds=null;}return this;},getCentroid:function(){if(this.components&&(this.components.length>2)){var q=0;var r=0;for(var t=0;t<this.components.length-1;t++){var u=this.components[t];var m=this.components[t+1];q+=(u.x+m.x)*(u.x*m.y-m.x*u.y);r+=(u.y+m.y)*(u.x*m.y-m.x*u.y);}var s=-1*this.getArea();var b=q/(6*s);var o=r/(6*s);return new OpenLayers.Geometry.Point(b,o);}else{return null;}},getArea:function(){var l=0;if(this.components&&(this.components.length>2)){var m=0;for(var o=0,q=this.components.length;o<q-1;o++){var b=this.components[o];var j=this.components[o+1];m+=(b.x+j.x)*(j.y-b.y);}l=-m/2;}return l;},getGeodesicArea:function(l){var t=this;if(l){var u=new OpenLayers.Projection("EPSG:4326");if(!u.equals(l)){t=this.clone().transform(l,u);}}var r=0;var m=t.components&&t.components.length;if(m>2){var o,q;for(var s=0;s<m-1;s++){o=t.components[s];q=t.components[s+1];r+=OpenLayers.Util.rad(q.x-o.x)*(2+Math.sin(OpenLayers.Util.rad(o.y))+Math.sin(OpenLayers.Util.rad(q.y)));}r=r*6378137*6378137/2;}return r;},containsPoint:function(G){var z=OpenLayers.Number.limitSigDigs;var H=14;var I=z(G.x,H);var J=z(G.y,H);function B(a,f,b,e,d){return(((f-e)*a)+((e*b)-(f*d)))/(b-d);}var S=this.components.length-1;var L,M,C,O,E,Q,N,P;var K=0;for(var F=0;F<S;++F){L=this.components[F];C=z(L.x,H);O=z(L.y,H);M=this.components[F+1];E=z(M.x,H);Q=z(M.y,H);if(O==Q){if(J==O){if(C<=E&&(I>=C&&I<=E)||C>=E&&(I<=C&&I>=E)){K=-1;break;}}continue;}N=z(B(J,C,O,E,Q),H);if(N==I){if(O<Q&&(J>=O&&J<=Q)||O>Q&&(J<=O&&J>=Q)){K=-1;break;}}if(N<=I){continue;}if(C!=E&&(N<Math.min(C,E)||N>Math.max(C,E))){continue;}if(O<Q&&(J>=O&&J<Q)||O>Q&&(J<O&&J>=Q)){++K;}}var D=(K==-1)?1:!!(K&1);return D;},intersects:function(h){var f=false;if(h.CLASS_NAME=="OpenLayers.Geometry.Point"){f=this.containsPoint(h);}else{if(h.CLASS_NAME=="OpenLayers.Geometry.LineString"){f=h.intersects(this);}else{if(h.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){f=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[h]);}else{for(var j=0,g=h.components.length;j<g;++j){f=h.components[j].intersects(this);if(f){break;}}}}}return f;},getVertices:function(b){return(b===true)?[]:this.components.slice(0,this.components.length-1);},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(h,f,g){OpenLayers.Util.extend(this,g);this.control=h;this.callbacks=f;var j=this.map||h.map;if(j){this.setMap(j);}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},setMap:function(b){this.map=b;},checkModifiers:function(e){if(this.keyMask==null){return true;}var d=(e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0);return(d==this.keyMask);},activate:function(){if(this.active){return false;}var g=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var e=0,f=g.length;e<f;e++){if(this[g[e]]){this.register(g[e],this[g[e]]);}}this.active=true;return true;},deactivate:function(){if(!this.active){return false;}var g=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var e=0,f=g.length;e<f;e++){if(this[g[e]]){this.unregister(g[e],this[g[e]]);}}this.active=false;return true;},callback:function(d,e){if(d&&this.callbacks[d]){this.callbacks[d].apply(this.control,e);}},register:function(e,d){this.map.events.registerPriority(e,this,d);this.map.events.registerPriority(e,this,this.setEvent);},unregister:function(e,d){this.map.events.unregister(e,this,d);this.map.events.unregister(e,this,this.setEvent);},setEvent:function(b){this.evt=b;return true;},destroy:function(){this.deactivate();this.control=this.map=null;},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,drawing:false,mouseDown:false,lastDown:null,lastUp:null,persist:false,layerOptions:null,initialize:function(g,e,f){if(!(f&&f.layerOptions&&f.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{});}OpenLayers.Handler.prototype.initialize.apply(this,arguments);},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false;}var b=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);return true;},createFeature:function(e){var d=this.map.getLonLatFromPixel(e);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(d.lon,d.lat));this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true});},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false;}if(this.drawing){this.cancel();}this.destroyFeature();if(this.layer.map!=null){this.layer.destroy(false);}this.layer=null;return true;},destroyFeature:function(){if(this.layer){this.layer.destroyFeatures();}this.point=null;},finalize:function(d){var e=d?"cancel":"done";this.drawing=false;this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.callback(e,[this.geometryClone()]);if(d||!this.persist){this.destroyFeature();}},cancel:function(){this.finalize(true);},click:function(b){OpenLayers.Event.stop(b);return false;},dblclick:function(b){OpenLayers.Event.stop(b);return false;},modifyFeature:function(e){var d=this.map.getLonLatFromPixel(e);this.point.geometry.x=d.lon;this.point.geometry.y=d.lat;this.callback("modify",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.drawFeature();},drawFeature:function(){this.layer.drawFeature(this.point,this.style);},getGeometry:function(){var b=this.point&&this.point.geometry;
if(b&&this.multi){b=new OpenLayers.Geometry.MultiPoint([b]);}return b;},geometryClone:function(){var b=this.getGeometry();return b&&b.clone();},mousedown:function(b){if(!this.checkModifiers(b)){return true;}if(this.lastDown&&this.lastDown.equals(b.xy)){return true;}this.drawing=true;if(this.lastDown==null){if(this.persist){this.destroyFeature();}this.createFeature(b.xy);}else{this.modifyFeature(b.xy);}this.lastDown=b.xy;return false;},mousemove:function(b){if(this.drawing){this.modifyFeature(b.xy);}return true;},mouseup:function(b){if(this.drawing){this.finalize();return false;}else{return true;}},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,freehand:false,freehandToggle:"shiftKey",initialize:function(g,e,f){OpenLayers.Handler.Point.prototype.initialize.apply(this,arguments);},createFeature:function(e){var d=this.control.map.getLonLatFromPixel(e);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(d.lon,d.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:true});},destroyFeature:function(){OpenLayers.Handler.Point.prototype.destroyFeature.apply(this);this.line=null;},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point]);}},addPoint:function(e){this.layer.removeFeatures([this.point]);var d=this.control.map.getLonLatFromPixel(e);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(d.lon,d.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();},freehandMode:function(b){return(this.freehandToggle&&b[this.freehandToggle])?!this.freehand:this.freehand;},modifyFeature:function(e){var d=this.control.map.getLonLatFromPixel(e);this.point.geometry.x=d.lon;this.point.geometry.y=d.lat;this.callback("modify",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.drawFeature();},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style);},getSketch:function(){return this.line;},getGeometry:function(){var b=this.line&&this.line.geometry;if(b&&this.multi){b=new OpenLayers.Geometry.MultiLineString([b]);}return b;},mousedown:function(b){if(this.lastDown&&this.lastDown.equals(b.xy)){return false;}if(this.lastDown==null){if(this.persist){this.destroyFeature();}this.createFeature(b.xy);}else{if((this.lastUp==null)||!this.lastUp.equals(b.xy)){this.addPoint(b.xy);}}this.mouseDown=true;this.lastDown=b.xy;this.drawing=true;return false;},mousemove:function(b){if(this.drawing){if(this.mouseDown&&this.freehandMode(b)){this.addPoint(b.xy);}else{this.modifyFeature(b.xy);}}return true;},mouseup:function(b){this.mouseDown=false;if(this.drawing){if(this.freehandMode(b)){this.removePoint();this.finalize();}else{if(this.lastUp==null){this.addPoint(b.xy);}this.lastUp=b.xy;}return false;}return true;},dblclick:function(e){if(!this.freehandMode(e)){var d=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[d]);this.removePoint();this.finalize();}return false;},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(b){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},getArea:function(){var g=0;if(this.components&&(this.components.length>0)){g+=Math.abs(this.components[0].getArea());for(var e=1,f=this.components.length;e<f;e++){g-=Math.abs(this.components[e].getArea());}}return g;},getGeodesicArea:function(f){var h=0;if(this.components&&(this.components.length>0)){h+=Math.abs(this.components[0].getGeodesicArea(f));for(var j=1,g=this.components.length;j<g;j++){h-=Math.abs(this.components[j].getGeodesicArea(f));}}return h;},containsPoint:function(h){var j=this.components.length;var m=false;if(j>0){m=this.components[0].containsPoint(h);if(m!==1){if(m&&j>1){var l;for(var g=1;g<j;++g){l=this.components[g].containsPoint(h);if(l){if(l===1){m=1;}else{m=false;}break;}}}}}return m;},intersects:function(j){var g=false;var l,h;if(j.CLASS_NAME=="OpenLayers.Geometry.Point"){g=this.containsPoint(j);}else{if(j.CLASS_NAME=="OpenLayers.Geometry.LineString"||j.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(l=0,h=this.components.length;l<h;++l){g=j.intersects(this.components[l]);if(g){break;}}if(!g){for(l=0,h=j.components.length;l<h;++l){g=this.containsPoint(j.components[l]);if(g){break;}}}}else{for(l=0,h=j.components.length;l<h;++l){g=this.intersects(j.components[l]);if(g){break;}}}}if(!g&&j.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var m=this.components[0];for(l=0,h=m.components.length;l<h;++l){g=j.containsPoint(m.components[l]);if(g){break;}}}return g;},distanceTo:function(h,f){var j=!(f&&f.edge===false);var g;if(!j&&this.intersects(h)){g=0;}else{g=OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[h,f]);}return g;},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(s,v,C,q){var B=Math.PI*((1/C)-(1/2));if(q){B+=(q/180)*Math.PI;}var D,t,u;var r=[];for(var w=0;w<C;++w){D=B+(w*2*Math.PI/C);t=s.x+(v*Math.cos(D));u=s.y+(v*Math.sin(D));r.push(new OpenLayers.Geometry.Point(t,u));}var z=new OpenLayers.Geometry.LinearRing(r);return new OpenLayers.Geometry.Polygon([z]);};OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{polygon:null,initialize:function(g,e,f){OpenLayers.Handler.Path.prototype.initialize.apply(this,arguments);},createFeature:function(e){var d=this.control.map.getLonLatFromPixel(e);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(d.lon,d.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:true});},destroyFeature:function(){OpenLayers.Handler.Path.prototype.destroyFeature.apply(this);this.polygon=null;},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style);},getSketch:function(){return this.polygon;},getGeometry:function(){var b=this.polygon&&this.polygon.geometry;if(b&&this.multi){b=new OpenLayers.Geometry.MultiPolygon([b]);}return b;},dblclick:function(e){if(!this.freehandMode(e)){var d=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[d]);this.removePoint();this.finalize();}return false;},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],initialize:function(b){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},split:function(w,K){var D=null;var L=K&&K.mutual;var j,J,M,z,I;var F=[];var N=[w];for(var E=0,C=this.components.length;E<C;++E){J=this.components[E];z=false;for(var G=0;G<N.length;++G){j=J.split(N[G],K);if(j){if(L){M=j[0];for(var H=0,B=M.length;H<B;++H){if(H===0&&F.length){F[F.length-1].addComponent(M[H]);}else{F.push(new OpenLayers.Geometry.MultiLineString([M[H]]));}}z=true;j=j[1];}if(j.length){j.unshift(G,1);Array.prototype.splice.apply(N,j);break;}}}if(!z){if(F.length){F[F.length-1].addComponent(J.clone());}else{F=[new OpenLayers.Geometry.MultiLineString(J.clone())];}}}if(F&&F.length>1){z=true;}else{F=[];}if(N&&N.length>1){I=true;}else{N=[];}if(z||I){if(L){D=[F,N];}else{D=N;}}return D;},splitWith:function(w,K){var D=null;var L=K&&K.mutual;
var j,H,M,z,J,F,N;if(w instanceof OpenLayers.Geometry.LineString){N=[];F=[w];for(var E=0,C=this.components.length;E<C;++E){J=false;H=this.components[E];for(var G=0;G<F.length;++G){j=F[G].split(H,K);if(j){if(L){M=j[0];if(M.length){M.unshift(G,1);Array.prototype.splice.apply(F,M);G+=M.length-2;}j=j[1];if(j.length===0){j=[H.clone()];}}for(var I=0,B=j.length;I<B;++I){if(I===0&&N.length){N[N.length-1].addComponent(j[I]);}else{N.push(new OpenLayers.Geometry.MultiLineString([j[I]]));}}J=true;}}if(!J){if(N.length){N[N.length-1].addComponent(H.clone());}else{N=[new OpenLayers.Geometry.MultiLineString([H.clone()])];}}}}else{D=w.split(this);}if(F&&F.length>1){z=true;}else{F=[];}if(N&&N.length>1){J=true;}else{N=[];}if(z||J){if(L){D=[F,N];}else{D=N;}}return D;},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],initialize:function(b){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments);},CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:false,initialize:function(b){OpenLayers.Format.JSON.prototype.initialize.apply(this,[b]);},read:function(m,q,w){q=(q)?q:"FeatureCollection";var t=null;var u=null;if(typeof m=="string"){u=OpenLayers.Format.JSON.prototype.read.apply(this,[m,w]);}else{u=m;}if(!u){OpenLayers.Console.error("Bad JSON: "+m);}else{if(typeof(u.type)!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+m);}else{if(this.isValidType(u,q)){switch(q){case"Geometry":try{t=this.parseGeometry(u);}catch(v){OpenLayers.Console.error(v);}break;case"Feature":try{t=this.parseFeature(u);t.type="Feature";}catch(v){OpenLayers.Console.error(v);}break;case"FeatureCollection":t=[];switch(u.type){case"Feature":try{t.push(this.parseFeature(u));}catch(v){t=null;OpenLayers.Console.error(v);}break;case"FeatureCollection":for(var s=0,r=u.features.length;s<r;++s){try{t.push(this.parseFeature(u.features[s]));}catch(v){t=null;OpenLayers.Console.error(v);}}break;default:try{var o=this.parseGeometry(u);t.push(new OpenLayers.Feature.Vector(o));}catch(v){t=null;OpenLayers.Console.error(v);}}break;}}}}return t;},isValidType:function(g,f){var e=false;switch(f){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],g.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+g.type);}else{e=true;}break;case"FeatureCollection":e=true;break;default:if(g.type==f){e=true;}else{OpenLayers.Console.error("Cannot convert types from "+g.type+" to "+f);}}return e;},parseFeature:function(o){var h,l,j,m;j=(o.properties)?o.properties:{};m=(o.geometry&&o.geometry.bbox)||o.bbox;try{l=this.parseGeometry(o.geometry);}catch(q){throw q;}h=new OpenLayers.Feature.Vector(l,j);if(m){h.bounds=OpenLayers.Bounds.fromArray(m);}if(o.id){h.fid=o.id;}return h;},parseGeometry:function(q){if(q==null){return null;}var m,o=false;if(q.type=="GeometryCollection"){if(!(q.geometries instanceof Array)){throw"GeometryCollection must have geometries array: "+q;}var j=q.geometries.length;var r=new Array(j);for(var l=0;l<j;++l){r[l]=this.parseGeometry.apply(this,[q.geometries[l]]);}m=new OpenLayers.Geometry.Collection(r);o=true;}else{if(!(q.coordinates instanceof Array)){throw"Geometry must have coordinates array: "+q;}if(!this.parseCoords[q.type.toLowerCase()]){throw"Unsupported geometry type: "+q.type;}try{m=this.parseCoords[q.type.toLowerCase()].apply(this,[q.coordinates]);}catch(s){throw s;}}if(this.internalProjection&&this.externalProjection&&!o){m.transform(this.externalProjection,this.internalProjection);}return m;},parseCoords:{point:function(b){if(this.ignoreExtraDims==false&&b.length!=2){throw"Only 2D points are supported: "+b;}return new OpenLayers.Geometry.Point(b[0],b[1]);},multipoint:function(l){var q=[];var m=null;for(var h=0,j=l.length;h<j;++h){try{m=this.parseCoords.point.apply(this,[l[h]]);}catch(o){throw o;}q.push(m);}return new OpenLayers.Geometry.MultiPoint(q);},linestring:function(l){var q=[];var m=null;for(var h=0,j=l.length;h<j;++h){try{m=this.parseCoords.point.apply(this,[l[h]]);}catch(o){throw o;}q.push(m);}return new OpenLayers.Geometry.LineString(q);},multilinestring:function(l){var q=[];var h=null;for(var o=0,j=l.length;o<j;++o){try{h=this.parseCoords.linestring.apply(this,[l[o]]);}catch(m){throw m;}q.push(h);}return new OpenLayers.Geometry.MultiLineString(q);},polygon:function(m){var o=[];var q,j;for(var s=0,l=m.length;s<l;++s){try{j=this.parseCoords.linestring.apply(this,[m[s]]);}catch(r){throw r;}q=new OpenLayers.Geometry.LinearRing(j.components);o.push(q);}return new OpenLayers.Geometry.Polygon(o);},multipolygon:function(l){var h=[];var m=null;for(var q=0,j=l.length;q<j;++q){try{m=this.parseCoords.polygon.apply(this,[l[q]]);}catch(o){throw o;}h.push(m);}return new OpenLayers.Geometry.MultiPolygon(h);},box:function(b){if(b.length!=2){throw"GeoJSON box coordinates must have 2 elements";}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(b[0][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[0][1])])]);}},write:function(q,r){var l={type:null};if(q instanceof Array){l.type="FeatureCollection";var m=q.length;l.features=new Array(m);for(var s=0;s<m;++s){var j=q[s];if(!j instanceof OpenLayers.Feature.Vector){var o="FeatureCollection only supports collections of features: "+j;throw o;}l.features[s]=this.extract.feature.apply(this,[j]);}}else{if(q.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){l=this.extract.geometry.apply(this,[q]);}else{if(q instanceof OpenLayers.Feature.Vector){l=this.extract.feature.apply(this,[q]);if(q.layer&&q.layer.projection){l.crs=this.createCRSObject(q);}}}}return OpenLayers.Format.JSON.prototype.write.apply(this,[l,r]);},createCRSObject:function(f){var j=f.layer.projection.toString();var g={};if(j.match(/epsg:/i)){var h=parseInt(j.substring(j.indexOf(":")+1));if(h==4326){g={type:"OGC",properties:{urn:"urn:ogc:def:crs:OGC:1.3:CRS84"}};}else{g={type:"EPSG",properties:{code:h}};}}return g;},extract:{feature:function(d){var e=this.extract.geometry.apply(this,[d.geometry]);return{type:"Feature",id:d.fid==null?d.id:d.fid,properties:d.attributes,geometry:e};},geometry:function(h){if(h==null){return null;}if(this.internalProjection&&this.externalProjection){h=h.clone();h.transform(this.internalProjection,this.externalProjection);}var g=h.CLASS_NAME.split(".")[2];var j=this.extract[g.toLowerCase()].apply(this,[h]);var f;if(g=="Collection"){f={type:"GeometryCollection",geometries:j};}else{f={type:g,coordinates:j};}return f;},point:function(b){return[b.x,b.y];},multipoint:function(j){var h=[];for(var f=0,g=j.components.length;f<g;++f){h.push(this.extract.point.apply(this,[j.components[f]]));}return h;},linestring:function(f){var h=[];for(var j=0,g=f.components.length;j<g;++j){h.push(this.extract.point.apply(this,[f.components[j]]));}return h;},multilinestring:function(j){var h=[];for(var f=0,g=j.components.length;f<g;++f){h.push(this.extract.linestring.apply(this,[j.components[f]]));}return h;},polygon:function(j){var h=[];for(var f=0,g=j.components.length;f<g;++f){h.push(this.extract.linestring.apply(this,[j.components[f]]));}return h;},multipolygon:function(h){var j=[];for(var f=0,g=h.components.length;f<g;++f){j.push(this.extract.polygon.apply(this,[h.components[f]]));}return j;},collection:function(j){var g=j.components.length;var h=new Array(g);for(var f=0;f<g;++f){h[f]=this.extract.geometry.apply(this,[j.components[f]]);}return h;}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(b){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)};
OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);},read:function(l){if(typeof l=="string"){l=OpenLayers.Format.XML.prototype.read.apply(this,[l]);}var j=this.getElementsByTagNameNS(l.documentElement,this.gmlns,this.featureName);var m=[];for(var g=0;g<j.length;g++){var h=this.parseFeature(j[g]);if(h){m.push(h);}}return m;},parseFeature:function(I){var H=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"];var O,E,N,J;for(var B=0;B<H.length;++B){O=H[B];E=this.getElementsByTagNameNS(I,this.gmlns,O);if(E.length>0){J=this.parseGeometry[O.toLowerCase()];if(J){N=J.apply(this,[E[0]]);if(this.internalProjection&&this.externalProjection){N.transform(this.externalProjection,this.internalProjection);}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:O}));}break;}}var K;var C=this.getElementsByTagNameNS(I,this.gmlns,"Box");for(B=0;B<C.length;++B){var P=C[B];var w=this.parseGeometry.box.apply(this,[P]);var z=P.parentNode;var F=z.localName||z.nodeName.split(":").pop();if(F==="boundedBy"){K=w;}else{N=w.toGeometry();}}var D;if(this.extractAttributes){D=this.parseAttributes(I);}var M=new OpenLayers.Feature.Vector(N,D);M.bounds=K;M.gml={featureType:I.firstChild.nodeName.split(":")[1],featureNS:I.firstChild.namespaceURI,featureNSPrefix:I.firstChild.prefix};var L=I.firstChild;var G;while(L){if(L.nodeType==1){G=L.getAttribute("fid")||L.getAttribute("id");if(G){break;}}L=L.nextSibling;}M.fid=G;return M;},parseGeometry:{point:function(o){var h,j;var m=[];var h=this.getElementsByTagNameNS(o,this.gmlns,"pos");if(h.length>0){j=h[0].firstChild.nodeValue;j=j.replace(this.regExes.trimSpace,"");m=j.split(this.regExes.splitSpace);}if(m.length==0){h=this.getElementsByTagNameNS(o,this.gmlns,"coordinates");if(h.length>0){j=h[0].firstChild.nodeValue;j=j.replace(this.regExes.removeSpace,"");m=j.split(",");}}if(m.length==0){h=this.getElementsByTagNameNS(o,this.gmlns,"coord");if(h.length>0){var l=this.getElementsByTagNameNS(h[0],this.gmlns,"X");var q=this.getElementsByTagNameNS(h[0],this.gmlns,"Y");if(l.length>0&&q.length>0){m=[l[0].firstChild.nodeValue,q[0].firstChild.nodeValue];}}}if(m.length==2){m[2]=null;}if(this.xy){return new OpenLayers.Geometry.Point(m[0],m[1],m[2]);}else{return new OpenLayers.Geometry.Point(m[1],m[0],m[2]);}},multipoint:function(j){var g=this.getElementsByTagNameNS(j,this.gmlns,"Point");var l=[];if(g.length>0){var h;for(var m=0;m<g.length;++m){h=this.parseGeometry.point.apply(this,[g[m]]);if(h){l.push(h);}}}return new OpenLayers.Geometry.MultiPoint(l);},linestring:function(F,D){var E,G;var j=[];var J=[];E=this.getElementsByTagNameNS(F,this.gmlns,"posList");if(E.length>0){G=this.getChildValue(E[0]);G=G.replace(this.regExes.trimSpace,"");j=G.split(this.regExes.splitSpace);var z=parseInt(E[0].getAttribute("dimension"));var C,u,v,w;for(var B=0;B<j.length/z;++B){C=B*z;u=j[C];v=j[C+1];w=(z==2)?null:j[C+2];if(this.xy){J.push(new OpenLayers.Geometry.Point(u,v,w));}else{J.push(new OpenLayers.Geometry.Point(v,u,w));}}}if(j.length==0){E=this.getElementsByTagNameNS(F,this.gmlns,"coordinates");if(E.length>0){G=this.getChildValue(E[0]);G=G.replace(this.regExes.trimSpace,"");G=G.replace(this.regExes.trimComma,",");var H=G.split(this.regExes.splitSpace);for(var B=0;B<H.length;++B){j=H[B].split(",");if(j.length==2){j[2]=null;}if(this.xy){J.push(new OpenLayers.Geometry.Point(j[0],j[1],j[2]));}else{J.push(new OpenLayers.Geometry.Point(j[1],j[0],j[2]));}}}}var I=null;if(J.length!=0){if(D){I=new OpenLayers.Geometry.LinearRing(J);}else{I=new OpenLayers.Geometry.LineString(J);}}return I;},multilinestring:function(j){var g=this.getElementsByTagNameNS(j,this.gmlns,"LineString");var l=[];if(g.length>0){var h;for(var m=0;m<g.length;++m){h=this.parseGeometry.linestring.apply(this,[g[m]]);if(h){l.push(h);}}}return new OpenLayers.Geometry.MultiLineString(l);},polygon:function(j){var g=this.getElementsByTagNameNS(j,this.gmlns,"LinearRing");var l=[];if(g.length>0){var h;for(var m=0;m<g.length;++m){h=this.parseGeometry.linestring.apply(this,[g[m],true]);if(h){l.push(h);}}}return new OpenLayers.Geometry.Polygon(l);},multipolygon:function(j){var h=this.getElementsByTagNameNS(j,this.gmlns,"Polygon");var l=[];if(h.length>0){var m;for(var g=0;g<h.length;++g){m=this.parseGeometry.polygon.apply(this,[h[g]]);if(m){l.push(m);}}}return new OpenLayers.Geometry.MultiPolygon(l);},envelope:function(z){var u=[];var B;var t;var o=this.getElementsByTagNameNS(z,this.gmlns,"lowerCorner");if(o.length>0){var r=[];if(o.length>0){B=o[0].firstChild.nodeValue;B=B.replace(this.regExes.trimSpace,"");r=B.split(this.regExes.splitSpace);}if(r.length==2){r[2]=null;}if(this.xy){var v=new OpenLayers.Geometry.Point(r[0],r[1],r[2]);}else{var v=new OpenLayers.Geometry.Point(r[1],r[0],r[2]);}}var s=this.getElementsByTagNameNS(z,this.gmlns,"upperCorner");if(s.length>0){var r=[];if(s.length>0){B=s[0].firstChild.nodeValue;B=B.replace(this.regExes.trimSpace,"");r=B.split(this.regExes.splitSpace);}if(r.length==2){r[2]=null;}if(this.xy){var q=new OpenLayers.Geometry.Point(r[0],r[1],r[2]);}else{var q=new OpenLayers.Geometry.Point(r[1],r[0],r[2]);}}if(v&&q){u.push(new OpenLayers.Geometry.Point(v.x,v.y));u.push(new OpenLayers.Geometry.Point(q.x,v.y));u.push(new OpenLayers.Geometry.Point(q.x,q.y));u.push(new OpenLayers.Geometry.Point(v.x,q.y));u.push(new OpenLayers.Geometry.Point(v.x,v.y));var w=new OpenLayers.Geometry.LinearRing(u);t=new OpenLayers.Geometry.Polygon([w]);}return t;},box:function(m){var q=this.getElementsByTagNameNS(m,this.gmlns,"coordinates");var h;var l,j=null,o=null;if(q.length>0){h=q[0].firstChild.nodeValue;l=h.split(" ");if(l.length==2){j=l[0].split(",");o=l[1].split(",");}}if(j!==null&&o!==null){return new OpenLayers.Bounds(parseFloat(j[0]),parseFloat(j[1]),parseFloat(o[0]),parseFloat(o[1]));}}},parseAttributes:function(u){var t={};var B=u.firstChild;var v,s,w,o,q,z,r;while(B){if(B.nodeType==1){v=B.childNodes;for(s=0;s<v.length;++s){w=v[s];if(w.nodeType==1){o=w.childNodes;if(o.length==1){q=o[0];if(q.nodeType==3||q.nodeType==4){z=(w.prefix)?w.nodeName.split(":")[1]:w.nodeName;r=q.nodeValue.replace(this.regExes.trimSpace,"");t[z]=r;}}else{t[w.nodeName.split(":").pop()]=null;}}}break;}B=B.nextSibling;}return t;},write:function(g){if(!(g instanceof Array)){g=[g];}var e=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);for(var f=0;f<g.length;f++){e.appendChild(this.createFeatureXML(g[f]));}return OpenLayers.Format.XML.prototype.write.apply(this,[e]);},createFeatureXML:function(r){var t=r.geometry;var w=this.buildGeometryNode(t);var s=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);s.appendChild(w);var D=this.createElementNS(this.gmlns,"gml:"+this.featureName);var q=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);var B=r.fid||r.id;q.setAttribute("fid",B);q.appendChild(s);for(var u in r.attributes){var v=this.createTextNode(r.attributes[u]);var z=u.substring(u.lastIndexOf(":")+1);var C=this.createElementNS(this.featureNS,this.featurePrefix+":"+z);C.appendChild(v);q.appendChild(C);}D.appendChild(q);return D;},buildGeometryNode:function(h){if(this.externalProjection&&this.internalProjection){h=h.clone();h.transform(this.internalProjection,this.externalProjection);}var j=h.CLASS_NAME;var f=j.substring(j.lastIndexOf(".")+1);var g=this.buildGeometry[f.toLowerCase()];return g.apply(this,[h]);},buildGeometry:{point:function(d){var e=this.createElementNS(this.gmlns,"gml:Point");e.appendChild(this.buildCoordinatesNode(d));return e;},multipoint:function(l){var o=this.createElementNS(this.gmlns,"gml:MultiPoint");var q=l.components;var h,m;for(var j=0;j<q.length;j++){h=this.createElementNS(this.gmlns,"gml:pointMember");m=this.buildGeometry.point.apply(this,[q[j]]);h.appendChild(m);o.appendChild(h);}return o;},linestring:function(d){var e=this.createElementNS(this.gmlns,"gml:LineString");e.appendChild(this.buildCoordinatesNode(d));return e;},multilinestring:function(l){var o=this.createElementNS(this.gmlns,"gml:MultiLineString");
var j=l.components;var q,m;for(var h=0;h<j.length;++h){q=this.createElementNS(this.gmlns,"gml:lineStringMember");m=this.buildGeometry.linestring.apply(this,[j[h]]);q.appendChild(m);o.appendChild(q);}return o;},linearring:function(d){var e=this.createElementNS(this.gmlns,"gml:LinearRing");e.appendChild(this.buildCoordinatesNode(d));return e;},polygon:function(m){var r=this.createElementNS(this.gmlns,"gml:Polygon");var o=m.components;var s,q,j;for(var l=0;l<o.length;++l){j=(l==0)?"outerBoundaryIs":"innerBoundaryIs";s=this.createElementNS(this.gmlns,"gml:"+j);q=this.buildGeometry.linearring.apply(this,[o[l]]);s.appendChild(q);r.appendChild(s);}return r;},multipolygon:function(l){var o=this.createElementNS(this.gmlns,"gml:MultiPolygon");var j=l.components;var m,h;for(var q=0;q<j.length;++q){m=this.createElementNS(this.gmlns,"gml:polygonMember");h=this.buildGeometry.polygon.apply(this,[j[q]]);m.appendChild(h);o.appendChild(m);}return o;},bounds:function(d){var e=this.createElementNS(this.gmlns,"gml:Box");e.appendChild(this.buildCoordinatesNode(d));return e;}},buildCoordinatesNode:function(l){var j=this.createElementNS(this.gmlns,"gml:coordinates");j.setAttribute("decimal",".");j.setAttribute("cs",",");j.setAttribute("ts"," ");var m=[];if(l instanceof OpenLayers.Bounds){m.push(l.left+","+l.bottom);m.push(l.right+","+l.top);}else{var q=(l.components)?l.components:[l];for(var h=0;h<q.length;h++){m.push(q[h].x+","+q[h].y);}}var o=this.createTextNode(m.join(" "));j.appendChild(o);return j;},CLASS_NAME:"OpenLayers.Format.GML"});if(!OpenLayers.Format.GML){OpenLayers.Format.GML={};}OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.setGeometryTypes();if(b&&b.featureNS){this.setNamespace("feature",b.featureNS);}this.singleFeatureType=!b||(typeof b.featureType==="string");},read:function(j){if(typeof j=="string"){j=OpenLayers.Format.XML.prototype.read.apply(this,[j]);}if(j&&j.nodeType==9){j=j.documentElement;}var m=[];this.readNode(j,{features:m});if(m.length==0){var l=this.getElementsByTagNameNS(j,this.namespaces.gml,"featureMember");if(l.length){for(var g=0,h=l.length;g<h;++g){this.readNode(l[g],{features:m});}}else{var l=this.getElementsByTagNameNS(j,this.namespaces.gml,"featureMembers");if(l.length){this.readNode(l[0],{features:m});}}}return m;},readers:{gml:{featureMember:function(e,d){this.readChildNodes(e,d);},featureMembers:function(e,d){this.readChildNodes(e,d);},name:function(e,d){d.name=this.getChildValue(e);},boundedBy:function(e,g){var f={};this.readChildNodes(e,f);if(f.components&&f.components.length>0){g.bounds=f.components[0];}},Point:function(e,f){var g={points:[]};this.readChildNodes(e,g);if(!f.components){f.components=[];}f.components.push(g.points[0]);},coordinates:function(s,q){var o=this.getChildValue(s).replace(this.regExes.trimSpace,"");o=o.replace(this.regExes.trimComma,",");var m=o.split(this.regExes.splitSpace);var r;var t=m.length;var u=new Array(t);for(var l=0;l<t;++l){r=m[l].split(",");if(this.xy){u[l]=new OpenLayers.Geometry.Point(r[0],r[1],r[2]);}else{u[l]=new OpenLayers.Geometry.Point(r[1],r[0],r[2]);}}q.points=u;},coord:function(f,e){var g={};this.readChildNodes(f,g);if(!e.points){e.points=[];}e.points.push(new OpenLayers.Geometry.Point(g.x,g.y,g.z));},X:function(e,d){d.x=this.getChildValue(e);},Y:function(e,d){d.y=this.getChildValue(e);},Z:function(e,d){d.z=this.getChildValue(e);},MultiPoint:function(e,f){var g={components:[]};this.readChildNodes(e,g);f.components=[new OpenLayers.Geometry.MultiPoint(g.components)];},pointMember:function(e,d){this.readChildNodes(e,d);},LineString:function(e,f){var g={};this.readChildNodes(e,g);if(!f.components){f.components=[];}f.components.push(new OpenLayers.Geometry.LineString(g.points));},MultiLineString:function(e,f){var g={components:[]};this.readChildNodes(e,g);f.components=[new OpenLayers.Geometry.MultiLineString(g.components)];},lineStringMember:function(e,d){this.readChildNodes(e,d);},Polygon:function(e,f){var g={outer:null,inner:[]};this.readChildNodes(e,g);g.inner.unshift(g.outer);if(!f.components){f.components=[];}f.components.push(new OpenLayers.Geometry.Polygon(g.inner));},LinearRing:function(e,g){var f={};this.readChildNodes(e,f);g.components=[new OpenLayers.Geometry.LinearRing(f.points)];},MultiPolygon:function(e,f){var g={components:[]};this.readChildNodes(e,g);f.components=[new OpenLayers.Geometry.MultiPolygon(g.components)];},polygonMember:function(e,d){this.readChildNodes(e,d);},GeometryCollection:function(e,f){var g={components:[]};this.readChildNodes(e,g);f.components=[new OpenLayers.Geometry.Collection(g.components)];},geometryMember:function(e,d){this.readChildNodes(e,d);}},feature:{"*":function(j,h){var g;var f=j.localName||j.nodeName.split(":").pop();if(h.features){if(!this.singleFeatureType&&(OpenLayers.Util.indexOf(this.featureType,f)!==-1)){g="_typeName";}else{if(f===this.featureType){g="_typeName";}}}else{if(j.childNodes.length==0||(j.childNodes.length==1&&j.firstChild.nodeType==3)){if(this.extractAttributes){g="_attribute";}}else{g="_geometry";}}if(g){this.readers.feature[g].apply(this,[j,h]);}},_typeName:function(m,l){var h={components:[],attributes:{}};this.readChildNodes(m,h);if(h.name){h.attributes.name=h.name;}var g=new OpenLayers.Feature.Vector(h.components[0],h.attributes);if(!this.singleFeatureType){g.type=m.nodeName.split(":").pop();g.namespace=m.namespaceURI;}var j=m.getAttribute("fid")||this.getAttributeNS(m,this.namespaces.gml,"id");if(j){g.fid=j;}if(this.internalProjection&&this.externalProjection&&g.geometry){g.geometry.transform(this.externalProjection,this.internalProjection);}if(h.bounds){g.bounds=h.bounds;}l.features.push(g);},_geometry:function(e,d){this.readChildNodes(e,d);},_attribute:function(f,h){var g=f.localName||f.nodeName.split(":").pop();var j=this.getChildValue(f);h.attributes[g]=j;}},wfs:{FeatureCollection:function(e,d){this.readChildNodes(e,d);}}},write:function(g){var e;if(g instanceof Array){e="featureMembers";}else{e="featureMember";}var f=this.writeNode("gml:"+e,g);this.setAttributeNS(f,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[f]);},writers:{gml:{featureMember:function(e){var d=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",e,d);return d;},MultiPoint:function(g){var e=this.createElementNSPlus("gml:MultiPoint");for(var f=0;f<g.components.length;++f){this.writeNode("pointMember",g.components[f],e);}return e;},pointMember:function(d){var e=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",d,e);return e;},MultiLineString:function(g){var e=this.createElementNSPlus("gml:MultiLineString");for(var f=0;f<g.components.length;++f){this.writeNode("lineStringMember",g.components[f],e);}return e;},lineStringMember:function(d){var e=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",d,e);return e;},MultiPolygon:function(g){var e=this.createElementNSPlus("gml:MultiPolygon");for(var f=0;f<g.components.length;++f){this.writeNode("polygonMember",g.components[f],e);}return e;},polygonMember:function(d){var e=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",d,e);return e;},GeometryCollection:function(h){var j=this.createElementNSPlus("gml:GeometryCollection");for(var f=0,g=h.components.length;f<g;++f){this.writeNode("geometryMember",h.components[f],j);}return j;},geometryMember:function(e){var f=this.createElementNSPlus("gml:geometryMember");
var g=this.writeNode("feature:_geometry",e);f.appendChild(g.firstChild);return f;}},feature:{_typeName:function(f){var j=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:f.fid}});if(f.geometry){this.writeNode("feature:_geometry",f.geometry,j);}for(var g in f.attributes){var h=f.attributes[g];if(h!=null){this.writeNode("feature:_attribute",{name:g,value:h},j);}}return j;},_geometry:function(j){if(this.externalProjection&&this.internalProjection){j=j.clone().transform(this.internalProjection,this.externalProjection);}var f=this.createElementNSPlus("feature:"+this.geometryName);var g=this.geometryTypes[j.CLASS_NAME];var h=this.writeNode("gml:"+g,j,f);if(this.srsName){h.setAttribute("srsName",this.srsName);}return f;},_attribute:function(b){return this.createElementNSPlus("feature:"+b.name,{value:b.value});}},wfs:{FeatureCollection:function(j){var h=this.createElementNSPlus("wfs:FeatureCollection");for(var f=0,g=j.length;f<g;++f){this.writeNode("gml:featureMember",j[f],h);}return h;}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"};},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(b){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[b]);},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e,d){this.readChildNodes(e,d);},Curve:function(e,f){var g={points:[]};this.readChildNodes(e,g);if(!f.components){f.components=[];}f.components.push(new OpenLayers.Geometry.LineString(g.points));},segments:function(e,d){this.readChildNodes(e,d);},LineStringSegment:function(e,f){var g={};this.readChildNodes(e,g);if(g.points){Array.prototype.push.apply(f.points,g.points);}},pos:function(g,l){var j=this.getChildValue(g).replace(this.regExes.trimSpace,"");var m=j.split(this.regExes.splitSpace);var h;if(this.xy){h=new OpenLayers.Geometry.Point(m[0],m[1],m[2]);}else{h=new OpenLayers.Geometry.Point(m[1],m[0],m[2]);}l.points=[h];},posList:function(G,D){var w=this.getChildValue(G).replace(this.regExes.trimSpace,"");var t=w.split(this.regExes.splitSpace);var C=parseInt(G.getAttribute("dimension"))||2;var F,j,u,z;var v=t.length/C;var H=new Array(v);for(var E=0,B=t.length;E<B;E+=C){j=t[E];u=t[E+1];z=(C==2)?undefined:t[E+2];if(this.xy){H[E/C]=new OpenLayers.Geometry.Point(j,u,z);}else{H[E/C]=new OpenLayers.Geometry.Point(u,j,z);}}D.points=H;},Surface:function(e,d){this.readChildNodes(e,d);},patches:function(e,d){this.readChildNodes(e,d);},PolygonPatch:function(e,d){this.readers.gml.Polygon.apply(this,[e,d]);},exterior:function(e,f){var g={};this.readChildNodes(e,g);f.outer=g.components[0];},interior:function(e,f){var g={};this.readChildNodes(e,g);f.inner.push(g.components[0]);},MultiCurve:function(e,f){var g={components:[]};this.readChildNodes(e,g);if(g.components.length>0){f.components=[new OpenLayers.Geometry.MultiLineString(g.components)];}},curveMember:function(e,d){this.readChildNodes(e,d);},MultiSurface:function(e,f){var g={components:[]};this.readChildNodes(e,g);if(g.components.length>0){f.components=[new OpenLayers.Geometry.MultiPolygon(g.components)];}},surfaceMember:function(e,d){this.readChildNodes(e,d);},surfaceMembers:function(e,d){this.readChildNodes(e,d);},pointMembers:function(e,d){this.readChildNodes(e,d);},lineStringMembers:function(e,d){this.readChildNodes(e,d);},polygonMembers:function(e,d){this.readChildNodes(e,d);},geometryMembers:function(e,d){this.readChildNodes(e,d);},Envelope:function(l,g){var j={points:new Array(2)};this.readChildNodes(l,j);if(!g.components){g.components=[];}var m=j.points[0];var h=j.points[1];g.components.push(new OpenLayers.Bounds(m.x,m.y,h.x,h.y));},lowerCorner:function(e,f){var g={};this.readers.gml.pos.apply(this,[e,g]);f.points[0]=g.points[0];},upperCorner:function(e,f){var g={};this.readers.gml.pos.apply(this,[e,g]);f.points[1]=g.points[0];}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(g){var e;if(g instanceof Array){e="featureMembers";}else{e="featureMember";}var f=this.writeNode("gml:"+e,g);this.setAttributeNS(f,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[f]);},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(j){var h=this.createElementNSPlus("gml:featureMembers");for(var f=0,g=j.length;f<g;++f){this.writeNode("feature:_typeName",j[f],h);}return h;},Point:function(d){var e=this.createElementNSPlus("gml:Point");this.writeNode("pos",d,e);return e;},pos:function(e){var d=(this.xy)?(e.x+" "+e.y):(e.y+" "+e.x);return this.createElementNSPlus("gml:pos",{value:d});},LineString:function(d){var e=this.createElementNSPlus("gml:LineString");this.writeNode("posList",d.components,e);return e;},Curve:function(d){var e=this.createElementNSPlus("gml:Curve");this.writeNode("segments",d,e);return e;},segments:function(d){var e=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",d,e);return e;},LineStringSegment:function(d){var e=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",d.components,e);return e;},posList:function(l){var g=l.length;var j=new Array(g);var h;for(var m=0;m<g;++m){h=l[m];if(this.xy){j[m]=h.x+" "+h.y;}else{j[m]=h.y+" "+h.x;}}return this.createElementNSPlus("gml:posList",{value:j.join(" ")});},Surface:function(d){var e=this.createElementNSPlus("gml:Surface");this.writeNode("patches",d,e);return e;},patches:function(d){var e=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",d,e);return e;},PolygonPatch:function(h){var j=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",h.components[0],j);for(var f=1,g=h.components.length;f<g;++f){this.writeNode("interior",h.components[f],j);}return j;},Polygon:function(h){var j=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",h.components[0],j);for(var f=1,g=h.components.length;f<g;++f){this.writeNode("interior",h.components[f],j);}return j;},exterior:function(e){var d=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",e,d);return d;},interior:function(e){var d=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",e,d);return d;},LinearRing:function(e){var d=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",e.components,d);return d;},MultiCurve:function(h){var j=this.createElementNSPlus("gml:MultiCurve");for(var f=0,g=h.components.length;f<g;++f){this.writeNode("curveMember",h.components[f],j);}return j;},curveMember:function(d){var e=this.createElementNSPlus("gml:curveMember");if(this.curve){this.writeNode("Curve",d,e);}else{this.writeNode("LineString",d,e);}return e;},MultiSurface:function(h){var j=this.createElementNSPlus("gml:MultiSurface");for(var f=0,g=h.components.length;f<g;++f){this.writeNode("surfaceMember",h.components[f],j);}return j;},surfaceMember:function(e){var d=this.createElementNSPlus("gml:surfaceMember");if(this.surface){this.writeNode("Surface",e,d);}else{this.writeNode("Polygon",e,d);}return d;},Envelope:function(d){var e=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",d,e);this.writeNode("upperCorner",d,e);if(this.srsName){e.setAttribute("srsName",this.srsName);}return e;},lowerCorner:function(e){var d=(this.xy)?(e.left+" "+e.bottom):(e.bottom+" "+e.left);return this.createElementNSPlus("gml:lowerCorner",{value:d});
},upperCorner:function(e){var d=(this.xy)?(e.right+" "+e.top):(e.top+" "+e.right);return this.createElementNSPlus("gml:upperCorner",{value:d});}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":(this.curve===true)?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":(this.multiCurve===false)?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":(this.surface===true)?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":(this.multiSurface===false)?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"};},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Element={visible:function(b){return OpenLayers.Util.getElement(b).style.display!="none";},toggle:function(){for(var j=0,g=arguments.length;j<g;j++){var f=OpenLayers.Util.getElement(arguments[j]);var h=OpenLayers.Element.visible(f)?"hide":"show";OpenLayers.Element[h](f);}},hide:function(){for(var g=0,f=arguments.length;g<f;g++){var e=OpenLayers.Util.getElement(arguments[g]);if(e){e.style.display="none";}}},show:function(){for(var g=0,f=arguments.length;g<f;g++){var e=OpenLayers.Util.getElement(arguments[g]);if(e){e.style.display="";}}},remove:function(b){b=OpenLayers.Util.getElement(b);b.parentNode.removeChild(b);},getHeight:function(b){b=OpenLayers.Util.getElement(b);return b.offsetHeight;},getDimensions:function(s){s=OpenLayers.Util.getElement(s);if(OpenLayers.Element.getStyle(s,"display")!="none"){return{width:s.offsetWidth,height:s.offsetHeight};}var j=s.style;var o=j.visibility;var r=j.position;var l=j.display;j.visibility="hidden";j.position="absolute";j.display="";var m=s.clientWidth;var q=s.clientHeight;j.display=l;j.position=r;j.visibility=o;return{width:m,height:q};},hasClass:function(e,f){var g=e.className;return(!!g&&new RegExp("(^|\\s)"+f+"(\\s|$)").test(g));},addClass:function(d,e){if(!OpenLayers.Element.hasClass(d,e)){d.className+=(d.className?" ":"")+e;}return d;},removeClass:function(e,f){var g=e.className;if(g){e.className=OpenLayers.String.trim(g.replace(new RegExp("(^|\\s+)"+f+"(\\s+|$)")," "));}return e;},toggleClass:function(d,e){if(OpenLayers.Element.hasClass(d,e)){OpenLayers.Element.removeClass(d,e);}else{OpenLayers.Element.addClass(d,e);}return d;},getStyle:function(m,l){m=OpenLayers.Util.getElement(m);var j=null;if(m&&m.style){j=m.style[OpenLayers.String.camelize(l)];if(!j){if(document.defaultView&&document.defaultView.getComputedStyle){var g=document.defaultView.getComputedStyle(m,null);j=g?g.getPropertyValue(l):null;}else{if(m.currentStyle){j=m.currentStyle[OpenLayers.String.camelize(l)];}}}var h=["left","top","right","bottom"];if(window.opera&&(OpenLayers.Util.indexOf(h,l)!=-1)&&(OpenLayers.Element.getStyle(m,"position")=="static")){j="auto";}}return j=="auto"?null:j;}};OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:true,initialize:function(g,e,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null;},onWheelEvent:function(s){if(!this.map||!this.checkModifiers(s)){return;}var v=false;var e=false;var w=false;var C=OpenLayers.Event.element(s);while((C!=null)&&!w&&!v){if(!v){try{if(C.currentStyle){B=C.currentStyle.overflow;}else{var D=document.defaultView.getComputedStyle(C,null);var B=D.getPropertyValue("overflow");}v=(B&&(B=="auto")||(B=="scroll"));}catch(z){}}if(!e){for(var u=0,t=this.map.layers.length;u<t;u++){if(C==this.map.layers[u].div||C==this.map.layers[u].pane){e=true;break;}}}w=(C==this.map.div);C=C.parentNode;}if(!v&&w){if(e){var r=0;if(!s){s=window.event;}if(s.wheelDelta){r=s.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){r=-r;}}else{if(s.detail){r=-s.detail/3;}}this.delta=this.delta+r;if(this.interval){window.clearTimeout(this._timeoutId);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(s);},this),this.interval);}else{this.wheelZoom(s);}}OpenLayers.Event.stop(s);}},wheelZoom:function(e){var d=this.delta;this.delta=0;if(d){if(this.mousePosition){e.xy=this.mousePosition;}if(!e.xy){e.xy=this.map.getPixelFromLonLat(this.map.getCenter());}if(d<0){this.callback("down",[e,this.cumulative?d:-1]);}else{this.callback("up",[e,this.cumulative?d:1]);}}},mousemove:function(b){this.mousePosition=b.xy;},activate:function(e){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var d=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",d);OpenLayers.Event.observe(window,"mousewheel",d);OpenLayers.Event.observe(document,"mousewheel",d);return true;}else{return false;}},deactivate:function(e){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var d=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",d);OpenLayers.Event.stopObserving(window,"mousewheel",d);OpenLayers.Event.stopObserving(document,"mousewheel",d);return true;}else{return false;}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){if(this.map){this.map.zoomToMaxExtent();}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(d,e){OpenLayers.Util.extend(this,e);this.rules=[];if(e&&e.rules){this.addRules(e.rules);}this.setDefaultStyle(d||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){for(var d=0,e=this.rules.length;d<e;d++){this.rules[d].destroy();this.rules[d]=null;}this.rules=null;this.defaultStyle=null;},createSymbolizer:function(o){var B=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),o);var q=this.rules;var r,z;var w=[];var t=false;for(var v=0,u=q.length;v<u;v++){r=q[v];var s=r.evaluate(o);if(s){if(r instanceof OpenLayers.Rule&&r.elseFilter){w.push(r);}else{t=true;this.applySymbolizer(r,B,o);}}}if(t==false&&w.length>0){t=true;for(var v=0,u=w.length;v<u;v++){this.applySymbolizer(w[v],B,o);}}if(q.length>0&&t==false){B.display="none";}return B;},applySymbolizer:function(l,o,h){var j=h.geometry?this.getSymbolizerPrefix(h.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];var q=l.symbolizer[j]||l.symbolizer;if(this.defaultsPerSymbolizer===true){var m=this.defaultStyle;OpenLayers.Util.applyDefaults(q,{pointRadius:m.pointRadius});if(q.stroke===true||q.graphic===true){OpenLayers.Util.applyDefaults(q,{strokeWidth:m.strokeWidth,strokeColor:m.strokeColor,strokeOpacity:m.strokeOpacity,strokeDashstyle:m.strokeDashstyle,strokeLinecap:m.strokeLinecap});}if(q.fill===true||q.graphic===true){OpenLayers.Util.applyDefaults(q,{fillColor:m.fillColor,fillOpacity:m.fillOpacity});}if(q.graphic===true){OpenLayers.Util.applyDefaults(q,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset});}}return this.createLiterals(OpenLayers.Util.extend(o,q),h);},createLiterals:function(h,j){var f=OpenLayers.Util.extend({},j.attributes||j.data);OpenLayers.Util.extend(f,this.context);for(var g in this.propertyStyles){h[g]=OpenLayers.Style.createLiteral(h[g],f,j,g);}return h;},findPropertyStyles:function(){var t={};
var r=this.defaultStyle;this.addPropertyStyles(t,r);var o=this.rules;var s,q;for(var u=0,m=o.length;u<m;u++){s=o[u].symbolizer;for(var l in s){q=s[l];if(typeof q=="object"){this.addPropertyStyles(t,q);}else{this.addPropertyStyles(t,s);break;}}}return t;},addPropertyStyles:function(f,j){var h;for(var g in j){h=j[g];if(typeof h=="string"&&h.match(/\$\{\w+\}/)){f[g]=true;}}return f;},addRules:function(b){Array.prototype.push.apply(this.rules,b);this.propertyStyles=this.findPropertyStyles();},setDefaultStyle:function(b){this.defaultStyle=b;this.propertyStyles=this.findPropertyStyles();},getSymbolizerPrefix:function(h){var j=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var f=0,g=j.length;f<g;f++){if(h.CLASS_NAME.indexOf(j[f])!=-1){return j[f];}}},clone:function(){var f=OpenLayers.Util.extend({},this);if(this.rules){f.rules=[];for(var j=0,g=this.rules.length;j<g;++j){f.rules.push(this.rules[j].clone());}}f.context=this.context&&OpenLayers.Util.extend({},this.context);var h=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(h,f);},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(h,f,g,j){if(typeof h=="string"&&h.indexOf("${")!=-1){h=OpenLayers.String.format(h,f,[g,j]);h=(isNaN(h)||!h)?h:parseFloat(h);}return h;};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class({initialize:function(b){OpenLayers.Util.extend(this,b);},destroy:function(){},evaluate:function(b){return true;},clone:function(){return null;},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,initialize:function(b){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[b]);},evaluate:function(j){for(var f=0,g=this.fids.length;f<g;f++){var h=j.fid||j.id;if(h==this.fids[f]){return true;}}return false;},clone:function(){var b=new OpenLayers.Filter.FeatureId();OpenLayers.Util.extend(b,this);b.fids=this.fids.slice();return b;},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(b){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[b]);},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this);},evaluate:function(g){switch(this.type){case OpenLayers.Filter.Logical.AND:for(var e=0,f=this.filters.length;e<f;e++){if(this.filters[e].evaluate(g)==false){return false;}}return true;case OpenLayers.Filter.Logical.OR:for(var e=0,f=this.filters.length;e<f;e++){if(this.filters[e].evaluate(g)==true){return true;}}return false;case OpenLayers.Filter.Logical.NOT:return(!this.filters[0].evaluate(g));}},clone:function(){var g=[];for(var e=0,f=this.filters.length;e<f;++e){g.push(this.filters[e].clone());}return new OpenLayers.Filter.Logical({type:this.type,filters:g});},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(b){OpenLayers.Filter.prototype.initialize.apply(this,[b]);},evaluate:function(m){if(m instanceof OpenLayers.Feature.Vector){m=m.attributes;}var h=false;var g=m[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:var j=this.value;if(!this.matchCase&&typeof g=="string"&&typeof j=="string"){h=(g.toUpperCase()==j.toUpperCase());}else{h=(g==j);}break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:var j=this.value;if(!this.matchCase&&typeof g=="string"&&typeof j=="string"){h=(g.toUpperCase()!=j.toUpperCase());}else{h=(g!=j);}break;case OpenLayers.Filter.Comparison.LESS_THAN:h=g<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:h=g>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:h=g<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:h=g>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:h=(g>=this.lowerBoundary)&&(g<=this.upperBoundary);break;case OpenLayers.Filter.Comparison.LIKE:var l=new RegExp(this.value,"gi");h=l.test(g);break;}return h;},value2regex:function(h,f,g){if(h=="."){var j="'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison";OpenLayers.Console.error(j);return null;}h=h?h:"*";f=f?f:".";g=g?g:"!";this.value=this.value.replace(new RegExp("\\"+g+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+f,"g"),".");this.value=this.value.replace(new RegExp("\\"+h,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+h);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+f);return this.value;},regex2value:function(){var b=this.value;b=b.replace(/!/g,"!!");b=b.replace(/(\\)?\\\./g,function(e,a){return a?e:"!.";});b=b.replace(/(\\)?\\\*/g,function(e,a){return a?e:"!*";});b=b.replace(/\\\\/g,"\\");b=b.replace(/\.\*/g,"*");return b;},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison(),this);},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,parser:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);},write:function(j,f){var g=(f&&f.version)||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=g){var h=OpenLayers.Format.Filter["v"+g.replace(/\./g,"_")];if(!h){throw"Can't find a Filter parser for version "+g;}this.parser=new h(this.options);}return this.parser.write(j);},read:function(j){if(typeof j=="string"){j=OpenLayers.Format.XML.prototype.read.apply(this,[j]);}var g=this.version;if(!g){g=this.defaultVersion;}if(!this.parser||this.parser.VERSION!=g){var h=OpenLayers.Format.Filter["v"+g.replace(/\./g,"_")];if(!h){throw"Can't find a Filter parser for version "+g;}this.parser=new h(this.options);}var f=this.parser.read(j);return f;},CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,defaultFilter:null,initialize:function(b){b=b||{};OpenLayers.Util.extend(this,b);this.options=b;},mergeWithDefaultFilter:function(d){var e;if(d&&this.defaultFilter){e=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,d]});}else{e=d||this.defaultFilter||undefined;}return e;},destroy:function(){this.options=null;this.format=null;},read:function(b){b=b||{};b.filter=this.mergeWithDefaultFilter(b.filter);},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(b){},createCallback:function(g,f,e){return OpenLayers.Function.bind(function(){g.apply(this,[f,e]);},this);},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,reqFeatures:null,priv:null,initialize:function(b){OpenLayers.Util.extend(this,b);},success:function(){return this.code>0;},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,wildcarded:false,initialize:function(b){b=b||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this);},read:function(f){OpenLayers.Protocol.prototype.read.apply(this,arguments);f=OpenLayers.Util.applyDefaults(f,this.options);
f.params=OpenLayers.Util.applyDefaults(f.params,this.options.params);if(f.filter){f.params=this.filterToParams(f.filter,f.params);}var e=(f.readWithPOST!==undefined)?f.readWithPOST:this.readWithPOST;var g=new OpenLayers.Protocol.Response({requestType:"read"});if(e){g.priv=OpenLayers.Request.POST({url:f.url,callback:this.createCallback(this.handleRead,g,f),data:OpenLayers.Util.getParameterString(f.params),headers:{"Content-Type":"application/x-www-form-urlencoded"}});}else{g.priv=OpenLayers.Request.GET({url:f.url,callback:this.createCallback(this.handleRead,g,f),params:f.params,headers:f.headers});}return g;},handleRead:function(d,e){this.handleResponse(d,e);},filterToParams:function(t,q){q=q||{};var u=t.CLASS_NAME;var s=u.substring(u.lastIndexOf(".")+1);switch(s){case"Spatial":switch(t.type){case OpenLayers.Filter.Spatial.BBOX:q.bbox=t.value.toArray();break;case OpenLayers.Filter.Spatial.DWITHIN:q.tolerance=t.distance;case OpenLayers.Filter.Spatial.WITHIN:q.lon=t.value.x;q.lat=t.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+t.type);}break;case"Comparison":var o=OpenLayers.Protocol.HTTP.COMP_TYPE_TO_OP_STR[t.type];if(o!==undefined){var r=t.value;if(t.type==OpenLayers.Filter.Comparison.LIKE){r=this.regex2value(r);if(this.wildcarded){r="%"+r+"%";}}q[t.property+"__"+o]=r;q.queryable=q.queryable||[];q.queryable.push(t.property);}else{OpenLayers.Console.warn("Unknown comparison filter type "+t.type);}break;case"Logical":if(t.type===OpenLayers.Filter.Logical.AND){for(var l=0,m=t.filters.length;l<m;l++){q=this.filterToParams(t.filters[l],q);}}else{OpenLayers.Console.warn("Unsupported logical filter type "+t.type);}break;default:OpenLayers.Console.warn("Unknown filter type "+s);}return q;},regex2value:function(b){b=b.replace(/%/g,"\\%");b=b.replace(/\\\\\.(\*)?/g,function(e,a){return a?e:"\\\\_";});b=b.replace(/\\\\\.\*/g,"\\\\%");b=b.replace(/(\\)?\.(\*)?/g,function(g,a,f){return a||f?g:"_";});b=b.replace(/(\\)?\.\*/g,function(e,a){return a?e:"%";});b=b.replace(/\\\./g,".");b=b.replace(/(\\)?\\\*/g,function(e,a){return a?e:"*";});return b;},create:function(e,f){f=OpenLayers.Util.applyDefaults(f,this.options);var g=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});g.priv=OpenLayers.Request.POST({url:f.url,callback:this.createCallback(this.handleCreate,g,f),headers:f.headers,data:this.format.write(e)});return g;},handleCreate:function(d,e){this.handleResponse(d,e);},update:function(j,f){f=f||{};var g=f.url||j.url||this.options.url+"/"+j.fid;f=OpenLayers.Util.applyDefaults(f,this.options);var h=new OpenLayers.Protocol.Response({reqFeatures:j,requestType:"update"});h.priv=OpenLayers.Request.PUT({url:g,callback:this.createCallback(this.handleUpdate,h,f),headers:f.headers,data:this.format.write(j)});return h;},handleUpdate:function(d,e){this.handleResponse(d,e);},"delete":function(j,f){f=f||{};var g=f.url||j.url||this.options.url+"/"+j.fid;f=OpenLayers.Util.applyDefaults(f,this.options);var h=new OpenLayers.Protocol.Response({reqFeatures:j,requestType:"delete"});h.priv=OpenLayers.Request.DELETE({url:g,callback:this.createCallback(this.handleDelete,h,f),headers:f.headers});return h;},handleDelete:function(d,e){this.handleResponse(d,e);},handleResponse:function(g,f){var e=g.priv;if(f.callback){if(e.status>=200&&e.status<300){if(g.requestType!="delete"){g.features=this.parseFeatures(e);}g.code=OpenLayers.Protocol.Response.SUCCESS;}else{g.code=OpenLayers.Protocol.Response.FAILURE;}f.callback.call(f.scope,g);}},parseFeatures:function(e){var d=e.responseXML;if(!d||!d.documentElement){d=e.responseText;}if(!d||d.length<=0){return null;}return this.format.read(d);},commit:function(J,L){L=OpenLayers.Util.applyDefaults(L,this.options);var H=[],w=0;var B={};B[OpenLayers.State.INSERT]=[];B[OpenLayers.State.UPDATE]=[];B[OpenLayers.State.DELETE]=[];var M,z,I=[];for(var G=0,C=J.length;G<C;++G){M=J[G];z=B[M.state];if(z){z.push(M);I.push(M);}}var E=(B[OpenLayers.State.INSERT].length>0?1:0)+B[OpenLayers.State.UPDATE].length+B[OpenLayers.State.DELETE].length;var N=true;var K=new OpenLayers.Protocol.Response({reqFeatures:I});function D(a){var b=a.features?a.features.length:0;var e=new Array(b);for(var d=0;d<b;++d){e[d]=a.features[d].fid;}K.insertIds=e;v.apply(this,[a]);}function v(a){this.callUserCallback(a,L);N=N&&a.success();w++;if(w>=E){if(L.callback){K.code=N?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;L.callback.apply(L.scope,[K]);}}}var F=B[OpenLayers.State.INSERT];if(F.length>0){H.push(this.create(F,OpenLayers.Util.applyDefaults({callback:D,scope:this},L.create)));}F=B[OpenLayers.State.UPDATE];for(var G=F.length-1;G>=0;--G){H.push(this.update(F[G],OpenLayers.Util.applyDefaults({callback:v,scope:this},L.update)));}F=B[OpenLayers.State.DELETE];for(var G=F.length-1;G>=0;--G){H.push(this["delete"](F[G],OpenLayers.Util.applyDefaults({callback:v,scope:this},L["delete"])));}return H;},abort:function(b){if(b){b.priv.abort();}},callUserCallback:function(g,f){var e=f[g.requestType];if(e&&e.callback){e.callback.call(e.scope,g);}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});(function(){var b=OpenLayers.Protocol.HTTP.COMP_TYPE_TO_OP_STR={};b[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";b[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";b[OpenLayers.Filter.Comparison.LESS_THAN]="lt";b[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";b[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";b[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";b[OpenLayers.Filter.Comparison.LIKE]="ilike";})();OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,initialize:function(e,d){this.container=OpenLayers.Util.getElement(e);},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null;},supported:function(){return false;},setExtent:function(e,d){this.extent=e.clone();if(d){this.resolution=null;}},setSize:function(b){this.size=b.clone();this.resolution=null;},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution;},drawFeature:function(q,o){if(o==null){o=q.style;}if(q.geometry){var m=q.geometry.getBounds();if(m){if(!m.intersectsBounds(this.extent)){o={display:"none"};}var l=this.drawGeometry(q.geometry,o,q.id);if(o.display!="none"&&o.label&&l!==false){var j=q.geometry.getCentroid();if(o.labelXOffset||o.labelYOffset){xOffset=isNaN(o.labelXOffset)?0:o.labelXOffset;yOffset=isNaN(o.labelYOffset)?0:o.labelYOffset;var h=this.getResolution();j.move(xOffset*h,yOffset*h);}this.drawText(q.id,o,j);}else{this.removeText(q.id);}return l;}}},drawGeometry:function(g,f,e){},drawText:function(g,e,f){},removeText:function(b){},clear:function(){},getFeatureIdFromEvent:function(b){},eraseFeatures:function(h){if(!(h instanceof Array)){h=[h];}for(var j=0,g=h.length;j<g;++j){var f=h[j];this.eraseGeometry(f.geometry,f.id);this.removeText(f.id);}},eraseGeometry:function(d,e){},moveRoot:function(b){},getRenderLayerId:function(){return this.container.id;},applyDefaultSymbolizer:function(d){var e=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);if(d.stroke===false){delete e.strokeWidth;delete e.strokeColor;}if(d.fill===false){delete e.fillColor;}OpenLayers.Util.extend(e,d);return e;},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0};OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(b){this.compare=b?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.order=[];this.indices={};this.maxZIndex=0;},insert:function(q){if(this.exists(q)){this.remove(q);}var l=q.id;this.determineZIndex(q);var o=-1;var m=this.order.length;var j;while(m-o>1){j=parseInt((o+m)/2);var h=this.compare(this,q,OpenLayers.Util.getElement(this.order[j]));
if(h>0){o=j;}else{m=j;}}this.order.splice(m,0,l);this.indices[l]=this.getZIndex(q);return this.getNextElement(m);},remove:function(f){var h=f.id;var g=OpenLayers.Util.indexOf(this.order,h);if(g>=0){this.order.splice(g,1);delete this.indices[h];if(this.order.length>0){var j=this.order[this.order.length-1];this.maxZIndex=this.indices[j];}else{this.maxZIndex=0;}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0;},exists:function(b){return(this.indices[b.id]!=null);},getZIndex:function(b){return b._style.graphicZIndex;},determineZIndex:function(e){var d=e._style.graphicZIndex;if(d==null){d=this.maxZIndex;e._style.graphicZIndex=d;}else{if(d>this.maxZIndex){this.maxZIndex=d;}}},getNextElement:function(e){var f=e+1;if(f<this.order.length){var g=OpenLayers.Util.getElement(this.order[f]);if(g==undefined){g=this.getNextElement(f);}return g;}else{return null;}},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(m,o,h){var j=m.getZIndex(o);var l=0;if(h){var q=m.getZIndex(h);l=j-q;}return l;},Z_ORDER_DRAWING_ORDER:function(j,f,g){var h=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(j,f,g);if(g&&h==0){h=1;}return h;},Z_ORDER_Y_ORDER:function(l,m,g){var j=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(l,m,g);if(g&&j===0){var h=g._boundsBottom-m._boundsBottom;j=(h===0)?1:h;}return j;}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",initialize:function(e,d){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(d&&(d.zIndexing||d.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(d.yOrdering);}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments);},clear:function(){var d;var e=this.vectorRoot;if(e){while(d=e.firstChild){e.removeChild(d);}}e=this.textRoot;if(e){while(d=e.firstChild){e.removeChild(d);}}if(this.indexer){this.indexer.clear();}},getNodeType:function(d,e){},drawGeometry:function(q,t,r){var u=q.CLASS_NAME;var o=true;if((u=="OpenLayers.Geometry.Collection")||(u=="OpenLayers.Geometry.MultiPoint")||(u=="OpenLayers.Geometry.MultiLineString")||(u=="OpenLayers.Geometry.MultiPolygon")){for(var l=0,m=q.components.length;l<m;l++){o=this.drawGeometry(q.components[l],t,r)&&o;}return o;}o=false;if(t.display!="none"){if(t.backgroundGraphic){this.redrawBackgroundNode(q.id,q,t,r);}o=this.redrawNode(q.id,q,t,r);}if(o==false){var s=document.getElementById(q.id);if(s){if(s._style.backgroundGraphic){s.parentNode.removeChild(document.getElementById(q.id+this.BACKGROUND_ID_SUFFIX));}s.parentNode.removeChild(s);}}return o;},redrawNode:function(m,o,j,q){j=this.applyDefaultSymbolizer(j);var s=this.nodeFactory(m,this.getNodeType(o,j));s._featureId=q;s._boundsBottom=o.getBounds().bottom;s._geometryClass=o.CLASS_NAME;s._style=j;var l=this.drawGeometryNode(s,o,j);if(l===false){return false;}s=l.node;if(this.indexer){var r=this.indexer.insert(s);if(r){this.vectorRoot.insertBefore(s,r);}else{this.vectorRoot.appendChild(s);}}else{if(s.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(s);}}this.postDraw(s);return l.complete;},redrawBackgroundNode:function(j,l,g,m){var h=OpenLayers.Util.extend({},g);h.externalGraphic=h.backgroundGraphic;h.graphicXOffset=h.backgroundXOffset;h.graphicYOffset=h.backgroundYOffset;h.graphicZIndex=h.backgroundGraphicZIndex;h.graphicWidth=h.backgroundWidth||h.graphicWidth;h.graphicHeight=h.backgroundHeight||h.graphicHeight;h.backgroundGraphic=null;h.backgroundXOffset=null;h.backgroundYOffset=null;h.backgroundGraphicZIndex=null;return this.redrawNode(j+this.BACKGROUND_ID_SUFFIX,l,h,null);},drawGeometryNode:function(m,j,g){g=g||m._style;var h={isFilled:g.fill===undefined?true:g.fill,isStroked:g.stroke===undefined?!!g.strokeWidth:g.stroke};var l;switch(j.CLASS_NAME){case"OpenLayers.Geometry.Point":if(g.graphic===false){h.isFilled=false;h.isStroked=false;}l=this.drawPoint(m,j);break;case"OpenLayers.Geometry.LineString":h.isFilled=false;l=this.drawLineString(m,j);break;case"OpenLayers.Geometry.LinearRing":l=this.drawLinearRing(m,j);break;case"OpenLayers.Geometry.Polygon":l=this.drawPolygon(m,j);break;case"OpenLayers.Geometry.Surface":l=this.drawSurface(m,j);break;case"OpenLayers.Geometry.Rectangle":l=this.drawRectangle(m,j);break;default:break;}m._options=h;if(l!=false){return{node:this.setStyle(m,g,h,j),complete:l};}else{return false;}},postDraw:function(b){},drawPoint:function(e,d){},drawLineString:function(e,d){},drawLinearRing:function(e,d){},drawPolygon:function(e,d){},drawRectangle:function(e,d){},drawCircle:function(e,d){},drawSurface:function(e,d){},removeText:function(d){var e=document.getElementById(d+this.LABEL_ID_SUFFIX);if(e){this.textRoot.removeChild(e);}},getFeatureIdFromEvent:function(h){var l=h.target;var g=l&&l.correspondingUseElement;var m=g?g:(l||h.srcElement);var j=m._featureId;return j;},eraseGeometry:function(m,o){if((m.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")||(m.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(m.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")||(m.CLASS_NAME=="OpenLayers.Geometry.Collection")){for(var r=0,l=m.components.length;r<l;r++){this.eraseGeometry(m.components[r],o);}}else{var s=OpenLayers.Util.getElement(m.id);if(s&&s.parentNode){if(s.geometry){s.geometry.destroy();s.geometry=null;}s.parentNode.removeChild(s);if(this.indexer){this.indexer.remove(s);}if(s._style.backgroundGraphic){var j=m.id+this.BACKGROUND_ID_SUFFIX;var q=OpenLayers.Util.getElement(j);if(q&&q.parentNode){q.parentNode.removeChild(q);}}}}},nodeFactory:function(g,f){var e=OpenLayers.Util.getElement(g);if(e){if(!this.nodeTypeCompare(e,f)){e.parentNode.removeChild(e);e=this.nodeFactory(g,f);}}else{e=this.createNode(f,g);}return e;},nodeTypeCompare:function(d,e){},createNode:function(e,d){},moveRoot:function(d){var e=this.root;if(d.root.parentNode==this.rendererRoot){e=d.root;}e.parentNode.removeChild(e);d.rendererRoot.appendChild(e);},getRenderLayerId:function(){return this.root.parentNode.parentNode.id;},isComplexSymbol:function(b){return(b!="circle")&&!!b;},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(h,f,j,g){OpenLayers.Handler.prototype.initialize.apply(this,[h,j,g]);this.layer=f;},mousedown:function(b){this.down=b.xy;return this.handle(b)?!this.stopDown:true;},mouseup:function(b){this.up=b.xy;return this.handle(b)?!this.stopUp:true;},click:function(b){return this.handle(b)?!this.stopClick:true;},mousemove:function(b){if(!this.callbacks.over&&!this.callbacks.out){return true;}this.handle(b);return true;},dblclick:function(b){return !this.handle(b);},geometryTypeMatches:function(b){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,b.geometry.CLASS_NAME)>-1;},handle:function(j){if(this.feature&&!this.feature.layer){this.feature=null;}var q=j.type;var l=false;
var m=!!(this.feature);var o=(q=="click"||q=="dblclick");this.feature=this.layer.getFeatureFromEvent(j);if(this.feature&&!this.feature.layer){this.feature=null;}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null;}if(this.feature){var h=(this.feature!=this.lastFeature);if(this.geometryTypeMatches(this.feature)){if(m&&h){if(this.lastFeature){this.triggerCallback(q,"out",[this.lastFeature]);}this.triggerCallback(q,"in",[this.feature]);}else{if(!m||o){this.triggerCallback(q,"in",[this.feature]);}}this.lastFeature=this.feature;l=true;}else{if(this.lastFeature&&(m&&h||o)){this.triggerCallback(q,"out",[this.lastFeature]);}this.feature=null;}}else{if(this.lastFeature&&(m||o)){this.triggerCallback(q,"out",[this.lastFeature]);}}return l;},triggerCallback:function(l,j,g){var m=this.EVENTMAP[l][j];if(m){if(l=="click"&&this.up&&this.down){var h=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(h<=this.clickTolerance){this.callback(m,g);}}else{this.callback(m,g);}}},activate:function(){var b=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});b=true;}return b;},deactivate:function(){var b=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});b=true;}return b;},handleMapEvents:function(b){if(!b.property||b.property=="order"){this.moveLayerToTop();}},moveLayerToTop:function(){var b=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(b);},moveLayerBack:function(){var b=this.layer.getZIndex()-1;if(b>=this.map.Z_INDEX_BASE.Feature){this.layer.setZIndex(b);}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer));}},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(g,f){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(g instanceof OpenLayers.Style){this.styles["default"]=g;this.styles.select=g;this.styles.temporary=g;this.styles["delete"]=g;}else{if(typeof g=="object"){for(var e in g){if(g[e] instanceof OpenLayers.Style){this.styles[e]=g[e];}else{if(typeof g[e]=="object"){this.styles[e]=new OpenLayers.Style(g[e]);}else{this.styles["default"]=new OpenLayers.Style(g);this.styles.select=new OpenLayers.Style(g);this.styles.temporary=new OpenLayers.Style(g);this.styles["delete"]=new OpenLayers.Style(g);break;}}}}}OpenLayers.Util.extend(this,f);},destroy:function(){for(var b in this.styles){this.styles[b].destroy();}this.styles=null;},createSymbolizer:function(e,g){if(!e){e=new OpenLayers.Feature.Vector();}if(!this.styles[g]){g="default";}e.renderIntent=g;var f={};if(this.extendDefault&&g!="default"){f=this.styles["default"].createSymbolizer(e);}return OpenLayers.Util.extend(f,this.styles[g].createSymbolizer(e));},addUniqueValueRules:function(h,o,l,j){var m=[];for(var q in l){m.push(new OpenLayers.Rule({symbolizer:l[q],context:j,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:o,value:q})}));}this.styles[h].addRules(m);},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","beforefeaturesremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","sketchstarted","sketchmodified","sketchcomplete","refresh"],isBaseLayer:false,isFixed:false,isVector:true,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,initialize:function(j,f){this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES);OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer();}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError();}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap();}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var h=0,g=this.strategies.length;h<g;h++){this.strategies[h].setLayer(this);}}},destroy:function(){if(this.strategies){var g,e,f;for(e=0,f=this.strategies.length;e<f;e++){g=this.strategies[e];if(g.autoDestroy){g.destroy();}}this.strategies=null;}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy();}this.protocol=null;}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy();}this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments);},clone:function(j){if(j==null){j=new OpenLayers.Layer.Vector(this.name,this.getOptions());}j=OpenLayers.Layer.prototype.clone.apply(this,[j]);var m=this.features;var h=m.length;var l=new Array(h);for(var g=0;g<h;++g){l[g]=m[g].clone();}j.features=l;return j;},refresh:function(b){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",b);}},assignRenderer:function(){for(var j=0,g=this.renderers.length;j<g;j++){var f=this.renderers[j];var h=(typeof f=="function")?f:OpenLayers.Renderer[f];if(h&&h.prototype.supported()){this.renderer=new h(this.div,this.rendererOptions);break;}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}));}},setMap:function(b){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this);}else{this.renderer.map=this.map;this.renderer.setSize(this.map.getSize());}},afterAdd:function(){if(this.strategies){var g,e,f;for(e=0,f=this.strategies.length;e<f;e++){g=this.strategies[e];if(g.autoActivate){g.activate();}}}},removeMap:function(j){this.drawn=false;if(this.strategies){var h,f,g;for(f=0,g=this.strategies.length;f<g;f++){h=this.strategies[f];if(h.autoActivate){h.deactivate();}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);this.renderer.setSize(this.map.getSize());},moveTo:function(q,l,o){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var s=true;if(!o){this.renderer.root.style.visibility="hidden";this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var r=this.map.getExtent();s=this.renderer.setExtent(r,l);this.renderer.root.style.visibility="visible";if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.div.scrollLeft=this.div.scrollLeft;}if(!l&&s){for(var t in this.unrenderedFeatures){var u=this.unrenderedFeatures[t];this.drawFeature(u);}}}if(!this.drawn||l||!s){this.drawn=true;var u;for(var t=0,m=this.features.length;t<m;t++){this.renderer.locked=(t!==(m-1));u=this.features[t];this.drawFeature(u);}}},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments);var d=this.div.style.display;if(d!=this.renderer.root.style.display){this.renderer.root.style.display=d;}},addFeatures:function(z,o){if(!(z instanceof Array)){z=[z];}var r=!o||!o.silent;if(r){var B={features:z};var s=this.events.triggerEvent("beforefeaturesadded",B);if(s===false){return;}z=B.features;}var v=[];for(var w=0,t=z.length;
w<t;w++){if(w!=(z.length-1)){this.renderer.locked=true;}else{this.renderer.locked=false;}var q=z[w];if(this.geometryType&&!(q.geometry instanceof this.geometryType)){var u=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});throw u;}q.layer=this;if(!q.style&&this.style){q.style=OpenLayers.Util.extend({},this.style);}if(r){if(this.events.triggerEvent("beforefeatureadded",{feature:q})===false){continue;}this.preFeatureInsert(q);}v.push(q);this.features.push(q);this.drawFeature(q);if(r){this.events.triggerEvent("featureadded",{feature:q});this.onFeatureInsert(q);}}if(r){this.events.triggerEvent("featuresadded",{features:v});}},removeFeatures:function(j,h){if(!j||j.length===0){return;}if(j===this.features){return this.removeAllFeatures(h);}if(!(j instanceof Array)){j=[j];}if(j===this.selectedFeatures){j=j.slice();}var l=!h||!h.silent;if(l){this.events.triggerEvent("beforefeaturesremoved",{features:j});}for(var m=j.length-1;m>=0;m--){if(m!=0&&j[m-1].geometry){this.renderer.locked=true;}else{this.renderer.locked=false;}var g=j[m];delete this.unrenderedFeatures[g.id];if(l){this.events.triggerEvent("beforefeatureremoved",{feature:g});}this.features=OpenLayers.Util.removeItem(this.features,g);g.layer=null;if(g.geometry){this.renderer.eraseFeatures(g);}if(OpenLayers.Util.indexOf(this.selectedFeatures,g)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,g);}if(l){this.events.triggerEvent("featureremoved",{feature:g});}}if(l){this.events.triggerEvent("featuresremoved",{features:j});}},removeAllFeatures:function(h){var l=!h||!h.silent;var j=this.features;if(l){this.events.triggerEvent("beforefeaturesremoved",{features:j});}var m;for(var g=j.length-1;g>=0;g--){m=j[g];if(l){this.events.triggerEvent("beforefeatureremoved",{feature:m});}m.layer=null;if(l){this.events.triggerEvent("featureremoved",{feature:m});}}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];if(l){this.events.triggerEvent("featuresremoved",{features:j});}},destroyFeatures:function(h,g){var j=(h==undefined);if(j){h=this.features;}if(h){this.removeFeatures(h,g);for(var f=h.length-1;f>=0;f--){h[f].destroy();}}},drawFeature:function(f,e){if(!this.drawn){return;}if(typeof e!="object"){if(!e&&f.state===OpenLayers.State.DELETE){e="delete";}var g=e||f.renderIntent;e=f.style||this.style;if(!e){e=this.styleMap.createSymbolizer(f,g);}}if(!this.renderer.drawFeature(f,e)){this.unrenderedFeatures[f.id]=f;}else{delete this.unrenderedFeatures[f.id];}},eraseFeatures:function(b){this.renderer.eraseFeatures(b);},getFeatureFromEvent:function(e){if(!this.renderer){OpenLayers.Console.error(OpenLayers.i18n("getFeatureError"));return null;}var d=this.renderer.getFeatureIdFromEvent(e);return this.getFeatureById(d);},getFeatureBy:function(j,l){var m=null;for(var g=0,h=this.features.length;g<h;++g){if(this.features[g][j]==l){m=this.features[g];break;}}return m;},getFeatureById:function(b){return this.getFeatureBy("id",b);},getFeatureByFid:function(b){return this.getFeatureBy("fid",b);},onFeatureInsert:function(b){},preFeatureInsert:function(b){},getDataExtent:function(){var g=null;var l=this.features;if(l&&(l.length>0)){g=new OpenLayers.Bounds();var j=null;for(var m=0,h=l.length;m<h;m++){j=l[m].geometry;if(j){g.extend(j.getBounds());}}}return g;},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(d,e){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[];},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments);},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var g=0,f=this.markers.length;g<f;g++){this.markers[g].setOpacity(this.opacity);}}},moveTo:function(l,g,j){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(g||!this.drawn){for(var m=0,h=this.markers.length;m<h;m++){this.drawMarker(this.markers[m]);}this.drawn=true;}},addMarker:function(b){this.markers.push(b);if(this.opacity!=null){b.setOpacity(this.opacity);}if(this.map&&this.map.getExtent()){b.map=this.map;this.drawMarker(b);}},removeMarker:function(b){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,b);b.erase();}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0]);}}},drawMarker:function(f){var e=this.map.getLayerPxFromLonLat(f.lonlat);if(e==null){f.display(false);}else{if(!f.isDrawn()){var g=f.draw(e);this.div.appendChild(g);}else{if(f.icon){f.icon.moveTo(e);}}}},getDataExtent:function(){var f=null;if(this.markers&&(this.markers.length>0)){var f=new OpenLayers.Bounds();for(var h=0,g=this.markers.length;h<g;h++){var j=this.markers[h];f.extend(j.lonlat);}}return f;},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:false,layers:null,initialize:function(d,e){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments);},display:function(){},getFeatureFromEvent:function(g){var h=this.layers;var j;for(var f=0;f<h.length;f++){j=h[f].getFeatureFromEvent(g);if(j){return j;}}},setMap:function(b){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();b.events.register("changelayer",this,this.handleChangeLayer);},removeMap:function(b){b.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments);},collectRoots:function(){var d;for(var e=0;e<this.map.layers.length;++e){d=this.map.layers[e];if(OpenLayers.Util.indexOf(this.layers,d)!=-1){d.renderer.moveRoot(this.renderer);}}},resetRoots:function(){var d;for(var e=0;e<this.layers.length;++e){d=this.layers[e];if(this.renderer&&d.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(d.renderer);}}},handleChangeLayer:function(e){var d=e.layer;if(e.property=="order"&&OpenLayers.Util.indexOf(this.layers,d)!=-1){this.resetRoots();this.collectRoots();}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(g,f){this.EVENT_TYPES=OpenLayers.Control.SelectFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[f]);if(this.scope===null){this.scope=this;}this.initLayer(g);var e={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){e.over=this.overFeature;e.out=this.outFeature;}this.callbacks=OpenLayers.Util.extend(e,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"});}},initLayer:function(b){if(b instanceof Array){this.layers=b;this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:b});}else{this.layer=b;}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer);}OpenLayers.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy();}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer);}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate();}}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate();
}if(this.layers){this.map.removeLayer(this.layer);}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},unselectAll:function(h){var l=this.layers||[this.layer];var m,o;for(var j=0;j<l.length;++j){m=l[j];for(var q=m.selectedFeatures.length-1;q>=0;--q){o=m.selectedFeatures[q];if(!h||h.except!=o){this.unselect(o);}}}},clickFeature:function(e){if(!this.hover){var d=(OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)>-1);if(d){if(this.toggleSelect()){this.unselect(e);}else{if(!this.multipleSelect()){this.unselectAll({except:e});}}}else{if(!this.multipleSelect()){this.unselectAll({except:e});}this.select(e);}}},multipleSelect:function(){return this.multiple||(this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]);},toggleSelect:function(){return this.toggle||(this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]);},clickoutFeature:function(b){if(!this.hover&&this.clickout){this.unselectAll();}},overFeature:function(d){var e=d.layer;if(this.hover){if(this.highlightOnly){this.highlight(d);}else{if(OpenLayers.Util.indexOf(e.selectedFeatures,d)==-1){this.select(d);}}}},outFeature:function(e){if(this.hover){if(this.highlightOnly){if(e._lastHighlighter==this.id){if(e._prevHighlighter&&e._prevHighlighter!=this.id){delete e._lastHighlighter;var d=this.map.getControl(e._prevHighlighter);if(d){d.highlight(e);}}else{this.unhighlight(e);}}}else{this.unselect(e);}}},highlight:function(j){var f=j.layer;var g=this.events.triggerEvent("beforefeaturehighlighted",{feature:j});if(g!==false){j._prevHighlighter=j._lastHighlighter;j._lastHighlighter=this.id;var h=this.selectStyle||this.renderIntent;f.drawFeature(j,h);this.events.triggerEvent("featurehighlighted",{feature:j});}},unhighlight:function(d){var e=d.layer;d._lastHighlighter=d._prevHighlighter;delete d._prevHighlighter;e.drawFeature(d,d.style||d.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:d});},select:function(g){var f=this.onBeforeSelect.call(this.scope,g);var e=g.layer;if(f!==false){f=e.events.triggerEvent("beforefeatureselected",{feature:g});if(f!==false){e.selectedFeatures.push(g);this.highlight(g);if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=e.selectedFeatures[0];}e.events.triggerEvent("featureselected",{feature:g});this.onSelect.call(this.scope,g);}}},unselect:function(d){var e=d.layer;this.unhighlight(d);OpenLayers.Util.removeItem(e.selectedFeatures,d);e.events.triggerEvent("featureunselected",{feature:d});this.onUnselect.call(this.scope,d);},selectBox:function(w){if(w instanceof OpenLayers.Bounds){var t=this.map.getLonLatFromPixel(new OpenLayers.Pixel(w.left,w.bottom));var r=this.map.getLonLatFromPixel(new OpenLayers.Pixel(w.right,w.top));var D=new OpenLayers.Bounds(t.lon,t.lat,r.lon,r.lat);if(!this.multipleSelect()){this.unselectAll();}var s=this.multiple;this.multiple=true;var z=this.layers||[this.layer];var v;for(var C=0;C<z.length;++C){v=z[C];for(var B=0,u=v.features.length;B<u;++B){var l=v.features[B];if(!l.getVisibility()){continue;}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,l.geometry.CLASS_NAME)>-1){if(D.toGeometry().intersects(l.geometry)){if(OpenLayers.Util.indexOf(v.selectedFeatures,l)==-1){this.select(l);}}}}}this.multiple=s;}},setMap:function(b){this.handlers.feature.setMap(b);if(this.box){this.handlers.box.setMap(b);}OpenLayers.Control.prototype.setMap.apply(this,arguments);},setLayer:function(d){var e=this.active;this.unselectAll();this.deactivate();if(this.layers){this.layer.destroy();this.layers=null;}this.initLayer(d);this.handlers.feature.layer=this.layer;if(e){this.activate();}},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(f){OpenLayers.Control.prototype.initialize.apply(this,[f]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var e={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(e,this.previousOptions);this.previous=new OpenLayers.Control.Button(e);var g={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(g,this.nextOptions);this.next=new OpenLayers.Control.Button(g);this.clear();},onPreviousChange:function(d,e){if(d&&!this.previous.active){this.previous.activate();}else{if(!d&&this.previous.active){this.previous.deactivate();}}},onNextChange:function(d,e){if(d&&!this.next.active){this.next.activate();}else{if(!d&&this.next.active){this.next.deactivate();}}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var b in this){this[b]=null;}},setMap:function(b){this.map=b;this.next.setMap(b);this.previous.setMap(b);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw();},previousTrigger:function(){var d=this.previousStack.shift();var e=this.previousStack.shift();if(e!=undefined){this.nextStack.unshift(d);this.previousStack.unshift(e);this.restoring=true;this.restore(e);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);}else{this.previousStack.unshift(d);}return e;},nextTrigger:function(){var b=this.nextStack.shift();if(b!=undefined){this.previousStack.unshift(b);this.restoring=true;this.restore(b);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);}return b;},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate();},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units};},restore:function(m){var j,o;if(this.map.getProjectionObject()==m.projection){o=this.map.getZoomForResolution(m.resolution);j=m.center;}else{j=m.center.clone();j.transform(m.projection,this.map.getProjectionObject());var l=m.units;var h=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var q=l&&h?OpenLayers.INCHES_PER_UNIT[l]/OpenLayers.INCHES_PER_UNIT[h]:1;o=this.map.getZoomForResolution(q*m.resolution);}this.map.setCenter(j,o);},setListeners:function(){this.listeners={};for(var b in this.registry){this.listeners[b]=OpenLayers.Function.bind(function(){if(!this.restoring){var a=this.registry[b].apply(this,arguments);this.previousStack.unshift(a);if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);}if(this.previousStack.length>(this.limit+1)){this.previousStack.pop();}if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0);}}return true;},this);}},activate:function(){var e=false;if(this.map){if(OpenLayers.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners();}for(var d in this.listeners){this.map.events.register(d,this,this.listeners[d]);}e=true;if(this.previousStack.length==0){this.initStack();}}}return e;},initStack:function(){if(this.map.getCenter()){this.listeners.moveend();}},deactivate:function(){var d=false;if(this.map){if(OpenLayers.Control.prototype.deactivate.apply(this)){for(var e in this.listeners){this.map.events.unregister(e,this,this.listeners[e]);}if(this.clearOnDeactivate){this.clear();}d=true;}}return d;},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,arguments);
},destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div;},updateAttribution:function(){var h=[];if(this.map&&this.map.layers){for(var j=0,g=this.map.layers.length;j<g;j++){var f=this.map.layers[j];if(f.attribution&&f.getVisibility()){if(OpenLayers.Util.indexOf(h,f.attribution)===-1){h.push(f.attribution);}}}this.div.innerHTML=h.join(this.separator);}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,drillDown:false,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:false,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["beforegetfeatureinfo","nogetfeatureinfo","getfeatureinfo"],initialize:function(e){this.EVENT_TYPES=OpenLayers.Control.WMSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);e=e||{};e.handlerOptions=e.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[e]);if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions);}if(this.drillDown===true){this.hover=false;}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));}else{var d={};d[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,d,this.handlerOptions.click||{});}},activate:function(){if(!this.active){this.handler.activate();}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},getInfoForClick:function(b){this.events.triggerEvent("beforegetfeatureinfo",{xy:b.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(b.xy,{});},getInfoForHover:function(b){this.events.triggerEvent("beforegetfeatureinfo",{xy:b.xy});this.request(b.xy,{hover:true});},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null;}},findLayers:function(){var m=this.layers||this.map.layers;var l=[];var o,h;for(var q=0,j=m.length;q<j;++q){o=m[q];if(o instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||o.getVisibility())){h=o.url instanceof Array?o.url[0]:o.url;if(this.drillDown===false&&!this.url){this.url=h;}if(this.drillDown===true||this.urlMatches(h)){l.push(o);}}}return l;},urlMatches:function(f){var h=OpenLayers.Util.isEquivalentUrl(this.url,f);if(!h&&this.layerUrls){for(var j=0,g=this.layerUrls.length;j<g;++j){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[j],f)){h=true;break;}}}return h;},buildWMSOptions:function(w,t,v,o){var q=[],m=[];for(var s=0,r=t.length;s<r;s++){q=q.concat(t[s].params.LAYERS);m=m.concat(this.getStyleNames(t[s]));}var u=OpenLayers.Util.extend({service:"WMS",version:t[0].params.VERSION,request:"GetFeatureInfo",layers:q,query_layers:q,styles:m,bbox:this.map.getExtent().toBBOX(null,t[0].reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:o,info_format:this.infoFormat},(parseFloat(t[0].params.VERSION)>=1.3)?{crs:this.map.getProjection(),i:v.x,j:v.y}:{srs:this.map.getProjection(),x:v.x,y:v.y});OpenLayers.Util.applyDefaults(u,this.vendorParams);return{url:w,params:OpenLayers.Util.upperCaseObject(u),callback:function(a){this.handleResponse(v,a);},scope:this};},getStyleNames:function(d){var e;if(d.params.STYLES){e=d.params.STYLES;}else{if(d.params.LAYERS instanceof Array){e=new Array(d.params.LAYERS.length);}else{e=d.params.LAYERS.replace(/[^,]/g,"");}}return e;},request:function(E,r){var C=this.findLayers();if(C.length==0){this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");return;}r=r||{};if(this.drillDown===false){var t=this.buildWMSOptions(this.url,C,E,C[0].params.FORMAT);var D=OpenLayers.Request.GET(t);if(r.hover===true){this.hoverRequest=D;}}else{this._requestCount=0;this._numRequests=0;this.features=[];var u={},F;for(var B=0,v=C.length;B<v;B++){var z=C[B];var w,s=false;F=z.url instanceof Array?z.url[0]:z.url;if(F in u){u[F].push(z);}else{this._numRequests++;u[F]=[z];}}var C;for(var F in u){C=u[F];var t=this.buildWMSOptions(F,C,E,C[0].params.FORMAT);OpenLayers.Request.GET(t);}}},triggerGetFeatureInfo:function(e,g,f){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:f,request:e,xy:g});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");},handleResponse:function(h,f){var j=f.responseXML;if(!j||!j.documentElement){j=f.responseText;}var g=this.format.read(j);if(this.drillDown===false){this.triggerGetFeatureInfo(f,h,g);}else{this._requestCount++;this._features=(this._features||[]).concat(g);if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(f,h,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests;}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},events:new OpenLayers.Events(this,null,["complete","success","failure"]),issue:function(v){var s=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});v=OpenLayers.Util.applyDefaults(v,s);var t=new OpenLayers.Request.XMLHttpRequest();var w=v.url;if(v.params){var u=OpenLayers.Util.getParameterString(v.params);if(u.length>0){var q=(w.indexOf("?")>-1)?"&":"?";w+=q+u;}}if(v.proxy&&(w.indexOf("http")==0)){if(typeof v.proxy=="function"){w=v.proxy(w);}else{w=v.proxy+encodeURIComponent(w);}}t.open(v.method,w,v.async,v.user,v.password);for(var r in v.headers){t.setRequestHeader(r,v.headers[r]);}var m=this.events;var o=this;t.onreadystatechange=function(){if(t.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var a=m.triggerEvent("complete",{request:t,config:v,requestUrl:w});if(a!==false){o.runCallbacks({request:t,config:v,requestUrl:w});}}};if(v.async===false){t.send(v.data);}else{window.setTimeout(function(){if(t._aborted!==true){t.send(v.data);}},0);}return t;},runCallbacks:function(o){var m=o.request;var q=o.config;var j=(q.scope)?OpenLayers.Function.bind(q.callback,q.scope):q.callback;var l;if(q.success){l=(q.scope)?OpenLayers.Function.bind(q.success,q.scope):q.success;}var h;if(q.failure){h=(q.scope)?OpenLayers.Function.bind(q.failure,q.scope):q.failure;}j(m);if(!m.status||(m.status>=200&&m.status<300)){this.events.triggerEvent("success",o);if(l){l(m);}}if(m.status&&(m.status<200||m.status>=300)){this.events.triggerEvent("failure",o);if(h){h(m);}}},GET:function(b){b=OpenLayers.Util.extend(b,{method:"GET"});return OpenLayers.Request.issue(b);},POST:function(b){b=OpenLayers.Util.extend(b,{method:"POST"});b.headers=b.headers?b.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers))){b.headers["Content-Type"]="application/xml";}return OpenLayers.Request.issue(b);},PUT:function(b){b=OpenLayers.Util.extend(b,{method:"PUT"});b.headers=b.headers?b.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers))){b.headers["Content-Type"]="application/xml";}return OpenLayers.Request.issue(b);},DELETE:function(b){b=OpenLayers.Util.extend(b,{method:"DELETE"});return OpenLayers.Request.issue(b);},HEAD:function(b){b=OpenLayers.Util.extend(b,{method:"HEAD"});return OpenLayers.Request.issue(b);
},OPTIONS:function(b){b=OpenLayers.Util.extend(b,{method:"OPTIONS"});return OpenLayers.Request.issue(b);}};(function(){var s=window.XMLHttpRequest;var w=!!window.controllers,o=window.document.all&&!window.opera,m=o&&window.navigator.userAgent.match(/MSIE ([\.0-9]+)/)&&RegExp.$1==7;function u(){this._object=s&&!m?new s:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[];}if(w&&s.wrapped){u.wrapped=s.wrapped;}u.UNSENT=0;u.OPENED=1;u.HEADERS_RECEIVED=2;u.LOADING=3;u.DONE=4;u.prototype.readyState=u.UNSENT;u.prototype.responseText="";u.prototype.responseXML=null;u.prototype.status=0;u.prototype.statusText="";u.prototype.onreadystatechange=null;u.onreadystatechange=null;u.onopen=null;u.onsend=null;u.onabort=null;u.prototype.open=function(g,d,h,b,j){delete this._headers;if(arguments.length<3){h=true;}this._async=h;var e=this,f=this.readyState,a;if(o&&h){a=function(){if(f!=u.DONE){t(e);e.abort();}};window.attachEvent("onunload",a);}if(u.onopen){u.onopen.apply(this,arguments);}if(arguments.length>4){this._object.open(g,d,h,b,j);}else{if(arguments.length>3){this._object.open(g,d,h,b);}else{this._object.open(g,d,h);}}if(!w&&!o){this.readyState=u.OPENED;v(this);}this._object.onreadystatechange=function(){if(w&&!h){return;}e.readyState=e._object.readyState;r(e);if(e._aborted){e.readyState=u.UNSENT;return;}if(e.readyState==u.DONE){t(e);if(o&&h){window.detachEvent("onunload",a);}}if(f!=e.readyState){v(e);}f=e.readyState;};};u.prototype.send=function(a){if(u.onsend){u.onsend.apply(this,arguments);}if(a&&a.nodeType){a=window.XMLSerializer?new window.XMLSerializer().serializeToString(a):a.xml;if(!this._headers["Content-Type"]){this._object.setRequestHeader("Content-Type","application/xml");}}this._object.send(a);if(w&&!this._async){this.readyState=u.OPENED;r(this);while(this.readyState<u.DONE){this.readyState++;v(this);if(this._aborted){return;}}}};u.prototype.abort=function(){if(u.onabort){u.onabort.apply(this,arguments);}if(this.readyState>u.UNSENT){this._aborted=true;}this._object.abort();t(this);};u.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders();};u.prototype.getResponseHeader=function(a){return this._object.getResponseHeader(a);};u.prototype.setRequestHeader=function(a,b){if(!this._headers){this._headers={};}this._headers[a]=b;return this._object.setRequestHeader(a,b);};u.prototype.addEventListener=function(d,e,f){for(var a=0,b;b=this._listeners[a];a++){if(b[0]==d&&b[1]==e&&b[2]==f){return;}}this._listeners.push([d,e,f]);};u.prototype.removeEventListener=function(d,e,f){for(var a=0,b;b=this._listeners[a];a++){if(b[0]==d&&b[1]==e&&b[2]==f){break;}}if(b){this._listeners.splice(a,1);}};u.prototype.dispatchEvent=function(e){var d={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};if(d.type=="readystatechange"&&this.onreadystatechange){(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[d]);}for(var a=0,b;b=this._listeners[a];a++){if(b[0]==d.type&&!b[2]){(b[1].handleEvent||b[1]).apply(this,[d]);}}};u.prototype.toString=function(){return"[object XMLHttpRequest]";};u.toString=function(){return"[XMLHttpRequest]";};function v(a){if(u.onreadystatechange){u.onreadystatechange.apply(a);}a.dispatchEvent({type:"readystatechange",bubbles:false,cancelable:false,timeStamp:new Date+0});}function q(b){var d=b.responseXML,a=b.responseText;if(o&&a&&d&&!d.documentElement&&b.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){d=new window.ActiveXObject("Microsoft.XMLDOM");d.async=false;d.validateOnParse=false;d.loadXML(a);}if(d){if((o&&d.parseError!=0)||!d.documentElement||(d.documentElement&&d.documentElement.tagName=="parsererror")){return null;}}return d;}function r(a){try{a.responseText=a._object.responseText;}catch(b){}try{a.responseXML=q(a._object);}catch(b){}try{a.status=a._object.status;}catch(b){}try{a.statusText=a._object.statusText;}catch(b){}}function t(a){a._object.onreadystatechange=new window.Function;}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(a,b){if(!b){b=[];}a.__func=this;a.__func(b[0],b[1],b[2],b[3],b[4]);delete a.__func;};}OpenLayers.Request.XMLHttpRequest=u;})();OpenLayers.ProxyHost="";OpenLayers.nullHandler=function(b){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:b.statusText}));};OpenLayers.loadURL=function(r,m,j,q,s){if(typeof m=="string"){m=OpenLayers.Util.getParameters(m);}var o=(q)?q:OpenLayers.nullHandler;var l=(s)?s:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:r,params:m,success:o,failure:l,scope:j});};OpenLayers.parseXMLString=function(g){var f=g.indexOf("<");if(f>0){g=g.substring(f);}var e=OpenLayers.Util.Try(function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.loadXML(g);return a;},function(){return new DOMParser().parseFromString(g,"text/xml");},function(){var a=new XMLHttpRequest();a.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(g),false);if(a.overrideMimeType){a.overrideMimeType("text/xml");}a.send(null);return a.responseXML;});return e;};OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest();},function(){return new ActiveXObject("Msxml2.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");})||false;},activeRequestCount:0};OpenLayers.Ajax.Responders={responders:[],register:function(d){for(var e=0;e<this.responders.length;e++){if(d==this.responders[e]){return;}}this.responders.push(d);},unregister:function(b){OpenLayers.Util.removeItem(this.reponders,b);},dispatch:function(l,q,m){var j;for(var e=0;e<this.responders.length;e++){j=this.responders[e];if(j[l]&&typeof j[l]=="function"){try{j[l].apply(j,[q,m]);}catch(o){}}}}};OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++;},onComplete:function(){OpenLayers.Ajax.activeRequestCount--;}});OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(b){this.options={method:"post",asynchronous:true,contentType:"application/xml",parameters:""};OpenLayers.Util.extend(this.options,b||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters);}}});OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:false,initialize:function(d,e){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[e]);if(OpenLayers.ProxyHost&&OpenLayers.String.startsWith(d,"http")){d=OpenLayers.ProxyHost+encodeURIComponent(d);}this.transport=OpenLayers.Ajax.getTransport();this.request(d);},request:function(e){this.url=e;this.method=this.options.method;var h=OpenLayers.Util.extend({},this.options.parameters);if(this.method!="get"&&this.method!="post"){h._method=this.method;this.method="post";}this.parameters=h;if(h=OpenLayers.Util.getParameterString(h)){if(this.method=="get"){this.url+=((this.url.indexOf("?")>-1)?"&":"?")+h;}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){h+="&_=";}}}try{var g=new OpenLayers.Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(g);}OpenLayers.Ajax.Responders.dispatch("onCreate",this,g);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10);}this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||h):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange();}}catch(j){this.dispatchException(j);}},onStateChange:function(){var b=this.transport.readyState;if(b>1&&!((b==4)&&this._complete)){this.respondToReadyState(this.transport.readyState);}},setRequestHeaders:function(){var j={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:true};
if(this.method=="post"){j["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){j.Connection="close";}}if(typeof this.options.requestHeaders=="object"){var m=this.options.requestHeaders;if(typeof m.push=="function"){for(var g=0,l=m.length;g<l;g+=2){j[m[g]]=m[g+1];}}else{for(var g in m){j[g]=m[g];}}}for(var h in j){this.transport.setRequestHeader(h,j[h]);}},success:function(){var b=this.getStatus();return !b||(b>=200&&b<300);},getStatus:function(){try{return this.transport.status||0;}catch(b){return 0;}},respondToReadyState:function(h){var m=OpenLayers.Ajax.Request.Events[h];var e=new OpenLayers.Ajax.Response(this);if(m=="Complete"){try{this._complete=true;(this.options["on"+e.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(e);}catch(l){this.dispatchException(l);}var j=e.getHeader("Content-type");}try{(this.options["on"+m]||OpenLayers.Ajax.emptyFunction)(e);OpenLayers.Ajax.Responders.dispatch("on"+m,this,e);}catch(l){this.dispatchException(l);}if(m=="Complete"){this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction;}},getHeader:function(e){try{return this.transport.getResponseHeader(e);}catch(d){return null;}},dispatchException:function(m){var l=this.options.onException;if(l){l(this,m);OpenLayers.Ajax.Responders.dispatch("onException",this,m);}else{var j=false;var h=OpenLayers.Ajax.Responders.responders;for(var g=0;g<h.length;g++){if(h[g].onException){j=true;break;}}if(j){OpenLayers.Ajax.Responders.dispatch("onException",this,m);}else{throw m;}}}});OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(j){this.request=j;var h=this.transport=j.transport,g=this.readyState=h.readyState;if((g>2&&!(!!(window.attachEvent&&!window.opera)))||g==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=h.responseText==null?"":String(h.responseText);}if(g==4){var f=h.responseXML;this.responseXML=f===undefined?null:f;}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||"";}catch(b){return"";}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(b){return this.transport.getResponseHeader(b);}});OpenLayers.Ajax.getElementsByTagNameNS=function(g,h,m,j){var l=null;if(g.getElementsByTagNameNS){l=g.getElementsByTagNameNS(h,j);}else{l=g.getElementsByTagName(m+":"+j);}return l;};OpenLayers.Ajax.serializeXMLToString=function(f){var e=new XMLSerializer();var g=e.serializeToString(f);return g;};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(d,e){this.lon=OpenLayers.Util.toFloat(d);this.lat=OpenLayers.Util.toFloat(e);},toString:function(){return("lon="+this.lon+",lat="+this.lat);},toShortString:function(){return(this.lon+", "+this.lat);},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat);},add:function(g,f){if((g==null)||(f==null)){var e=OpenLayers.i18n("lonlatAddError");OpenLayers.Console.error(e);return null;}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(g),this.lat+OpenLayers.Util.toFloat(f));},equals:function(d){var e=false;if(d!=null){e=((this.lon==d.lon&&this.lat==d.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(d.lon)&&isNaN(d.lat)));}return e;},transform:function(g,e){var f=OpenLayers.Projection.transform({x:this.lon,y:this.lat},g,e);this.lon=f.x;this.lat=f.y;return this;},wrapDateLine:function(e){var d=this.clone();if(e){while(d.lon<e.left){d.lon+=e.getWidth();}while(d.lon>e.right){d.lon-=e.getWidth();}}return d;},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(d){var e=d.split(",");return new OpenLayers.LonLat(e[0],e[1]);};OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,d){this.w=parseFloat(e);this.h=parseFloat(d);},toString:function(){return("w="+this.w+",h="+this.h);},clone:function(){return new OpenLayers.Size(this.w,this.h);},equals:function(d){var e=false;if(d!=null){e=((this.w==d.w&&this.h==d.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(d.w)&&isNaN(d.h)));}return e;},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,d){this.x=parseFloat(e);this.y=parseFloat(d);},toString:function(){return("x="+this.x+",y="+this.y);},clone:function(){return new OpenLayers.Pixel(this.x,this.y);},equals:function(e){var d=false;if(e!=null){d=((this.x==e.x&&this.y==e.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)));}return d;},add:function(f,g){if((f==null)||(g==null)){var e=OpenLayers.i18n("pixelAddError");OpenLayers.Console.error(e);return null;}return new OpenLayers.Pixel(this.x+f,this.y+g);},offset:function(e){var d=this.clone();if(e){d=this.add(e.x,e.y);}return d;},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode();}return OpenLayers.Lang.code;},setCode:function(f){var h;if(!f){f=(OpenLayers.Util.getBrowserName()=="msie")?navigator.userLanguage:navigator.language;}var j=f.split("-");j[0]=j[0].toLowerCase();if(typeof OpenLayers.Lang[j[0]]=="object"){h=j[0];}if(j[1]){var g=j[0]+"-"+j[1].toUpperCase();if(typeof OpenLayers.Lang[g]=="object"){h=g;}}if(!h){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+j.join("-")+" dictionary, falling back to default language");h=OpenLayers.Lang.defaultCode;}OpenLayers.Lang.code=h;},translate:function(f,g){var h=OpenLayers.Lang[OpenLayers.Lang.getCode()];var j=h[f];if(!j){j=f;}if(g){j=OpenLayers.String.format(j,g);}return j;}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Base Layer",sameProjection:"The overview map only works when it is in the same projection as the main map",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>",scale:"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",graticule:"Graticule",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition failed: element with id ${elemId} may be misplaced.",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type.",end:""};
OpenLayers.Lang.fr=OpenLayers.Util.applyDefaults({unhandledRequest:"Requête non gérée, retournant ${statusText}",permalink:"Permalien",overlays:"Calques",baseLayer:"Calque de base",sameProjection:"La carte de situation ne fonctionne que lorsque sa projection est la même que celle de la carte principale",readNotImplemented:"Lecture non implémentée.",writeNotImplemented:"Ecriture non implémentée.",noFID:"Impossible de mettre à jour un objet sans identifiant (fid).",errorLoadingGML:"Erreur au chargement du fichier GML ${url}",browserNotSupported:"Votre navigateur ne supporte pas le rendu vectoriel. Les renderers actuellement supportés sont : \n${renderers}",componentShouldBe:"addFeatures : le composant devrait être de type ${geomType}",getFeatureError:"getFeatureFromEvent a été appelé sur un calque sans renderer. Cela signifie généralement que vous avez détruit cette couche, mais que vous avez conservé un handler qui lui était associé.",minZoomLevelError:"La propriété minZoomLevel doit seulement être utilisée pour des couches FixedZoomLevels-descendent. Le fait que cette couche WFS vérifie la présence de minZoomLevel est une relique du passé. Nous ne pouvons toutefois la supprimer sans casser des applications qui pourraient en dépendre. C'est pourquoi nous la déprécions -- la vérification du minZoomLevel sera supprimée en version 3.0. A la place, merci d'utiliser les paramètres de résolutions min/max tel que décrit sur : http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transaction WFS : SUCCES ${response}",commitFailed:"Transaction WFS : ECHEC ${response}",googleWarning:"La couche Google n'a pas été en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le sélecteur de couche en haut à droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement causé par la non-inclusion de la librairie Google Maps, ou alors parce que la clé de l'API ne correspond pas à votre site.\x3cbr\x3e\x3cbr\x3eDéveloppeurs : pour savoir comment corriger ceci, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3ecliquez ici\x3c/a\x3e",getLayerWarning:"La couche ${layerType} n'est pas en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le sélecteur de couche en haut à droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement causé par la non-inclusion de la librairie ${layerLib}.\x3cbr\x3e\x3cbr\x3eDéveloppeurs : pour savoir comment corriger ceci, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3ecliquez ici\x3c/a\x3e",scale:"Echelle ~ 1 : ${scaleDenom}",W:"O",E:"E",N:"N",S:"S",layerAlreadyAdded:"Vous avez essayé d'ajouter à la carte le calque : ${layerName}, mais il est déjà présent",reprojectDeprecated:"Vous utilisez l'option 'reproject' sur la couche ${layerName}. Cette option est dépréciée : Son usage permettait d'afficher des données au dessus de couches raster commerciales.Cette fonctionalité est maintenant supportée en utilisant le support de la projection Mercator Sphérique. Plus d'information est disponible sur http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Cette méthode est dépréciée, et sera supprimée à la version 3.0. Merci d'utiliser ${newMethod} à la place.",boundsAddError:"Vous devez passer les deux valeurs x et y à la fonction add.",lonlatAddError:"Vous devez passer les deux valeurs lon et lat à la fonction add.",pixelAddError:"Vous devez passer les deux valeurs x et y à la fonction add.",unsupportedGeometryType:"Type de géométrie non supporté : ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition a échoué: l'élément d'id ${elemId} pourrait être mal positionné.",filterEvaluateNotImplemented:"évaluer n'a pas encore été implémenté pour ce type de filtre."});OpenLayers.Lang.de=OpenLayers.Util.applyDefaults({unhandledRequest:"Unbehandelte Anfragerückmeldung ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Grundkarte",sameProjection:"Die Übersichtskarte funktioniert nur, wenn sie dieselbe Projektion wie die Hauptkarte verwendet",readNotImplemented:"Lesen nicht implementiert.",writeNotImplemented:"Schreiben nicht implementiert.",noFID:"Ein Feature, für das keine FID existiert, kann nicht aktualisiert werden.",errorLoadingGML:"Fehler beim Laden der GML-Datei ${url}",browserNotSupported:"Ihr Browser unterstützt keine Vektordarstellung. Aktuell unterstützte Renderer:\n${renderers}",componentShouldBe:"addFeatures: Komponente muss vom Typ ${geomType} sein",getFeatureError:"getFeatureFromEvent wurde vom einem Layer ohne Renderer aufgerufen. Dies bedeutet normalerweise, dass ein Layer entfernt wurde, aber nicht Handler, die auf ihn verweisen.",minZoomLevelError:"Die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Eigenschaft ist nur für die Verwendung mit \x3ccode\x3eFixedZoomLevels\x3c/code\x3e-untergeordneten Layers vorgesehen. Das dieser \x3ctt\x3ewfs\x3c/tt\x3e-Layer die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Eigenschaft überprüft ist ein Relikt der Vergangenheit. Wir können diese Überprüfung nicht entfernen, ohne das OL basierende Applikationen nicht mehr funktionieren. Daher markieren wir es als veraltet - die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Überprüfung wird in Version 3.0 entfernt werden. Bitte verwenden Sie stattdessen die Min-/Max-Lösung, wie sie unter http://trac.openlayers.org/wiki/SettingZoomLevels beschrieben ist.",commitSuccess:"WFS-Transaktion: Erfolgreich ${response}",commitFailed:"WFS-Transaktion: Fehlgeschlagen ${response}",googleWarning:"Der Google-Layer konnte nicht korrekt geladen werden.\x3cbr\x3e\x3cbr\x3eUm diese Meldung nicht mehr zu erhalten, wählen Sie einen anderen Hintergrundlayer aus dem LayerSwitcher in der rechten oberen Ecke.\x3cbr\x3e\x3cbr\x3eSehr wahrscheinlich tritt dieser Fehler auf, weil das Skript der Google-Maps-Bibliothek nicht eingebunden wurde oder keinen gültigen API-Schlüssel für Ihre URL enthält.\x3cbr\x3e\x3cbr\x3eEntwickler: Besuche \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3edas Wiki\x3c/a\x3e für Hilfe zum korrekten Einbinden des Google-Layers",getLayerWarning:"Der ${layerType}-Layer konnte nicht korrekt geladen werden.\x3cbr\x3e\x3cbr\x3eUm diese Meldung nicht mehr zu erhalten, wählen Sie einen anderen Hintergrundlayer aus dem LayerSwitcher in der rechten oberen Ecke.\x3cbr\x3e\x3cbr\x3eSehr wahrscheinlich tritt dieser Fehler auf, weil das Skript der '${layerLib}'-Bibliothek nicht eingebunden wurde.\x3cbr\x3e\x3cbr\x3eEntwickler: Besuche \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3edas Wiki\x3c/a\x3e für Hilfe zum korrekten Einbinden von Layern",scale:"Maßstab = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"S",layerAlreadyAdded:"Sie versuchen den Layer „${layerName}“ zur Karte hinzuzufügen, er wurde aber bereits hinzugefügt",reprojectDeprecated:"Sie verwenden die „Reproject“-Option des Layers ${layerName}. Diese Option ist veraltet: Sie wurde entwickelt um die Anzeige von Daten auf kommerziellen Basiskarten zu unterstützen, aber diese Funktion sollte jetzt durch Unterstützung der „Spherical Mercator“ erreicht werden. Weitere Informationen sind unter http://trac.openlayers.org/wiki/SphericalMercator verfügbar.",methodDeprecated:"Die Methode ist veraltet und wird in 3.0 entfernt. Bitte verwende stattdessen ${newMethod}.",boundsAddError:"Beide Werte (x und y) müssen der add-Funktion übergeben werden.",lonlatAddError:"Beide Werte (lon und lat) müssen der add-Funktion übergeben werden.",pixelAddError:"Beide Werte (x und y) müssen der add-Funktion übergeben werden.",unsupportedGeometryType:"Nicht unterstützter Geometrie-Typ: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition fehlgeschlagen: Element mit Id ${elemId} möglicherweise falsch platziert.",filterEvaluateNotImplemented:"„evaluate“ ist für diesen Filter-Typ nicht implementiert."});OpenLayers.Lang.nl=OpenLayers.Util.applyDefaults({unhandledRequest:"Het verzoek is niet afgehandeld met de volgende melding: ${statusText}",permalink:"Permanente verwijzing",overlays:"Overlays",baseLayer:"Achtergrondkaart",sameProjection:"De overzichtskaart werkt alleen als de projectie gelijk is aan de projectie van de hoofdkaart",readNotImplemented:"Lezen is niet geïmplementeerd.",writeNotImplemented:"Schrijven is niet geïmplementeerd.",noFID:"Een optie die geen FID heeft kan niet bijgewerkt worden.",errorLoadingGML:"Er is een fout opgetreden bij het laden van het GML bestand van ${url}",browserNotSupported:"Uw browser ondersteunt het weergeven van vectoren niet.\nMomenteel ondersteunde weergavemogelijkheden:\n${renderers}",componentShouldBe:"addFeatures : component moet van het type ${geomType} zijn",getFeatureError:"getFeatureFromEvent is aangeroepen op een laag zonder rederer.\nDit betekent meestal dat u een laag hebt verwijderd, maar niet een handler die ermee geassocieerd was.",minZoomLevelError:"De eigenschap minZoomLevel is alleen bedoeld voor gebruik lagen met die afstammen van FixedZoomLevels-lagen.\nDat deze WFS-laag minZoomLevel controleert, is een overblijfsel uit het verleden.\nWe kunnen deze controle echter niet verwijderen zonder op OL gebaseerde applicaties die hervan afhankelijk zijn stuk te maken.\nDaarom heeft deze functionaliteit de eigenschap 'deprecated' gekregen - de minZoomLevel wordt verwijderd in versie 3.0.\nGebruik in plaats van deze functie de mogelijkheid om min/max voor resolutie in te stellen zoals op de volgende pagina wordt beschreven:\nhttp://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS-transactie: succesvol ${response}",commitFailed:"WFS-transactie: mislukt ${response}",googleWarning:"De Google-Layer kon niet correct geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct ingevoegd is.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen.",getLayerWarning:"De laag ${layerType} kon niet goed geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct is ingevoegd.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen.",scale:"Schaal = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"Z",layerAlreadyAdded:"U hebt geprobeerd om de laag  ${layerName} aan de kaart toe te voegen, maar deze is al toegevoegd",reprojectDeprecated:"U gebruikt de optie 'reproject' op de laag ${layerName}.\nDeze optie is vervallen: deze optie was ontwikkeld om gegevens over commerciële basiskaarten weer te geven, maar deze functionaliteit wordt nu bereikt door ondersteuning van Spherical Mercator.\nMeer informatie is beschikbaar op http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Deze methode is verouderd en wordt verwijderd in versie 3.0.\nGebruik ${newMethod}.",boundsAddError:"U moet zowel de x- als de y-waarde doorgeven aan de toevoegfunctie.",lonlatAddError:"U moet zowel de lengte- als de breedtewaarde doorgeven aan de toevoegfunctie.",pixelAddError:"U moet zowel de x- als de y-waarde doorgeven aan de toevoegfunctie.",unsupportedGeometryType:"Dit geometrietype wordt niet ondersteund: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition is mislukt: het element met id ${elemId} is wellicht onjuist geplaatst.",filterEvaluateNotImplemented:"evalueren is niet geïmplementeerd voor dit filtertype."});
OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,last:null,start:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(g,e,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);},down:function(b){},move:function(b){},up:function(b){},out:function(b){},mousedown:function(d){var e=true;this.dragging=false;if(this.checkModifiers(d)&&OpenLayers.Event.isLeftClick(d)){this.started=true;this.start=d.xy;this.last=d.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(d);this.callback("down",[d.xy]);OpenLayers.Event.stop(d);if(!this.oldOnselectstart){this.oldOnselectstart=(document.onselectstart)?document.onselectstart:OpenLayers.Function.True;}document.onselectstart=OpenLayers.Function.False;e=!this.stopDown;}else{this.started=false;this.start=null;this.last=null;}return e;},mousemove:function(b){if(this.started&&!this.timeoutId&&(b.xy.x!=this.last.x||b.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(b.element===document){this.adjustXY(b);this.setEvent(b);}else{this.destroyDocumentEvents();}}if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval);}this.dragging=true;this.move(b);this.callback("move",[b.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=OpenLayers.Function.False;}this.last=this.evt.xy;}return true;},removeTimeout:function(){this.timeoutId=null;},mouseup:function(d){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(d);this.destroyDocumentEvents();}var e=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(d);this.callback("up",[d.xy]);if(e){this.callback("done",[d.xy]);}document.onselectstart=this.oldOnselectstart;}return true;},mouseout:function(d){if(this.started&&OpenLayers.Util.mouseLeft(d,this.map.div)){if(this.documentDrag===true){this.documentEvents=new OpenLayers.Events(this,document,null,null,{includeXY:true});this.documentEvents.on({mousemove:this.mousemove,mouseup:this.mouseup});OpenLayers.Element.addClass(document.body,"olDragDown");}else{var e=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(d);this.callback("out",[]);if(e){this.callback("done",[d.xy]);}if(document.onselectstart){document.onselectstart=this.oldOnselectstart;}}}return true;},click:function(b){return(this.start==this.last);},activate:function(){var b=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;b=true;}return b;},deactivate:function(){var b=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.dragging=false;this.start=null;this.last=null;b=true;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");}return b;},adjustXY:function(e){var d=OpenLayers.Util.pagePosition(this.map.div);e.xy.x-=d[0];e.xy.y-=d[1];},destroyDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents.destroy();this.documentEvents=null;},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxCharacteristics:null,initialize:function(g,e,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);var e={down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox};this.dragHandler=new OpenLayers.Handler.Drag(this,e,{keyMask:this.keyMask});},destroy:function(){if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null;}OpenLayers.Handler.prototype.destroy.apply(this,arguments);},setMap:function(b){OpenLayers.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(b);}},startBox:function(b){this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.dragHandler.start);this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox");},moveBox:function(l){var o=this.dragHandler.start.x;var h=this.dragHandler.start.y;var q=Math.abs(o-l.x);var j=Math.abs(h-l.y);this.zoomBox.style.width=Math.max(1,q)+"px";this.zoomBox.style.height=Math.max(1,j)+"px";this.zoomBox.style.left=l.x<o?l.x+"px":o+"px";this.zoomBox.style.top=l.y<h?l.y+"px":h+"px";var m=this.getBoxCharacteristics();if(m.newBoxModel){if(l.x>o){this.zoomBox.style.width=Math.max(1,q-m.xOffset)+"px";}if(l.y>h){this.zoomBox.style.height=Math.max(1,j-m.yOffset)+"px";}}},endBox:function(j){var l;if(Math.abs(this.dragHandler.start.x-j.x)>5||Math.abs(this.dragHandler.start.y-j.y)>5){var m=this.dragHandler.start;var o=Math.min(m.y,j.y);var s=Math.max(m.y,j.y);var q=Math.min(m.x,j.x);var r=Math.max(m.x,j.x);l=new OpenLayers.Bounds(q,s,r,o);}else{l=this.dragHandler.start.clone();}this.removeBox();this.callback("done",[l]);},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxCharacteristics=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox");},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true;}else{return false;}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate();return true;}else{return false;}},getBoxCharacteristics:function(){if(!this.boxCharacteristics){var f=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"))+1;var g=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"))+1;var e=OpenLayers.Util.getBrowserName()=="msie"?document.compatMode!="BackCompat":true;this.boxCharacteristics={xOffset:f,yOffset:g,newBoxModel:e};}return this.boxCharacteristics;},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,alwaysZoom:false,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask});},zoomBox:function(B){if(B instanceof OpenLayers.Bounds){var H;if(!this.out){var z=this.map.getLonLatFromPixel(new OpenLayers.Pixel(B.left,B.bottom));var t=this.map.getLonLatFromPixel(new OpenLayers.Pixel(B.right,B.top));H=new OpenLayers.Bounds(z.lon,z.lat,t.lon,t.lat);}else{var C=Math.abs(B.right-B.left);var w=Math.abs(B.top-B.bottom);var E=Math.min((this.map.size.h/w),(this.map.size.w/C));var J=this.map.getExtent();var I=this.map.getLonLatFromPixel(B.getCenterPixel());var G=I.lon-(J.getWidth()/2)*E;var D=I.lon+(J.getWidth()/2)*E;var u=I.lat-(J.getHeight()/2)*E;var F=I.lat+(J.getHeight()/2)*E;H=new OpenLayers.Bounds(G,u,D,F);}var v=this.map.getZoom();this.map.zoomToExtent(H);if(v==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(v+(this.out?-1:1));}}else{if(!this.out){this.map.setCenter(this.map.getLonLatFromPixel(B),this.map.getZoom()+1);}else{this.map.setCenter(this.map.getLonLatFromPixel(B),this.map.getZoom()-1);}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:25,documentDrag:false,draw:function(){this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone},{interval:this.interval,documentDrag:this.documentDrag});},panMap:function(b){this.panned=true;this.map.pan(this.handler.last.x-b.x,this.handler.last.y-b.y,{dragging:this.handler.dragging,animate:false});},panMapDone:function(b){if(this.panned){this.panMap(b);this.panned=false;}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false,timerId:null,down:null,rightclickTimerId:null,initialize:function(g,e,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);
if(this.pixelTolerance!=null){this.mousedown=function(a){this.down=a.xy;return true;};}},mousedown:null,mouseup:function(d){var e=true;if(this.checkModifiers(d)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(d)){e=this.rightclick(d);}return e;},rightclick:function(e){if(this.passesTolerance(e)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[e]);return !this.stopDouble;}else{var f=this["double"]?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]);var g=OpenLayers.Function.bind(this.delayedRightCall,this,f);this.rightclickTimerId=window.setTimeout(g,this.delay);}}return !this.stopSingle;},delayedRightCall:function(b){this.rightclickTimerId=null;if(b){this.callback("rightclick",[b]);}return !this.stopSingle;},dblclick:function(b){if(this.passesTolerance(b)){if(this["double"]){this.callback("dblclick",[b]);}this.clearTimer();}return !this.stopDouble;},click:function(d){if(this.passesTolerance(d)){if(this.timerId!=null){this.clearTimer();}else{var e=this.single?OpenLayers.Util.extend({},d):null;this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay);}}return !this.stopSingle;},passesTolerance:function(e){var g=true;if(this.pixelTolerance!=null&&this.down){var f=Math.sqrt(Math.pow(this.down.x-e.xy.x,2)+Math.pow(this.down.y-e.xy.y,2));if(f>this.pixelTolerance){g=false;}}return g;},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null;}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null;}},delayedCall:function(b){this.timerId=null;if(b){this.callback("click",[b]);}},deactivate:function(){var b=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;b=true;}return b;},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,documentDrag:false,zoomBox:null,zoomBoxEnabled:true,zoomWheelEnabled:true,mouseWheelOptions:null,handleRightClicks:false,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:true,initialize:function(b){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy();}this.dragPan=null;if(this.zoomBox){this.zoomBox.destroy();}this.zoomBox=null;OpenLayers.Control.prototype.destroy.apply(this,arguments);},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate();}this.handlers.click.activate();if(this.zoomBoxEnabled){this.zoomBox.activate();}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False;}var e={dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};var d={"double":true,stopDouble:true};this.handlers.click=new OpenLayers.Handler.Click(this,e,d);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions);},defaultDblClick:function(d){var e=this.map.getLonLatFromViewPortPx(d.xy);this.map.setCenter(e,this.map.zoom+1);},defaultDblRightClick:function(d){var e=this.map.getLonLatFromViewPortPx(d.xy);this.map.setCenter(e,this.map.zoom-1);},wheelChange:function(q,w){var r=this.map.getZoom();var t=this.map.getZoom()+Math.round(w);t=Math.max(t,0);t=Math.min(t,this.map.getNumZoomLevels());if(t===r){return;}var o=this.map.getSize();var u=o.w/2-q.xy.x;var v=q.xy.y-o.h/2;var s=this.map.baseLayer.getResolutionForZoom(t);var B=this.map.getLonLatFromPixel(q.xy);var z=new OpenLayers.LonLat(B.lon+u*s,B.lat+v*s);this.map.setCenter(z,t);},wheelUp:function(e,d){this.wheelChange(e,d||1);},wheelDown:function(e,d){this.wheelChange(e,d||-1);},disableZoomBox:function(){this.zoomBoxEnabled=false;this.zoomBox.deactivate();},enableZoomBox:function(){this.zoomBoxEnabled=true;if(this.active){this.zoomBox.activate();}},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate();},enableZoomWheel:function(){this.zoomWheelEnabled=true;if(this.active){this.handlers.wheel.activate();}},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(l,m,j,g){var h=arguments;h=[l,g];OpenLayers.Layer.prototype.initialize.apply(this,h);this.url=m;this.params=OpenLayers.Util.extend({},j);},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments);},clone:function(b){if(b==null){b=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions());}b=OpenLayers.Layer.prototype.clone.apply(this,[b]);return b;},setUrl:function(b){this.url=b;},mergeNewParams:function(d){this.params=OpenLayers.Util.extend(this.params,d);var e=this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"params"});}return e;},redraw:function(b){if(b){return this.mergeNewParams({_olSalt:Math.random()});}else{return OpenLayers.Layer.prototype.redraw.apply(this,[]);}},selectUrl:function(j,l){var m=1;for(var g=0,h=j.length;g<h;g++){m*=j.charCodeAt(g)*this.URL_HASH_FACTOR;m-=Math.floor(m);}return l[Math.floor(m*l.length)];},getFullRequestString:function(m,r){var j=r||this.url;var o=OpenLayers.Util.extend({},this.params);o=OpenLayers.Util.extend(o,m);var q=OpenLayers.Util.getParameterString(o);if(j instanceof Array){j=this.selectUrl(q,j);}var l=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(j));for(var s in o){if(s.toUpperCase() in l){delete o[s];}}q=OpenLayers.Util.getParameterString(o);return OpenLayers.Util.urlAppend(j,q);},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,grid:null,singleTile:false,ratio:1.5,buffer:2,numLoadingTiles:0,initialize:function(j,f,h,g){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.events.addEventType("tileloaded");this.grid=[];},destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments);},clearGrid:function(){if(this.grid){for(var l=0,h=this.grid.length;l<h;l++){var m=this.grid[l];for(var q=0,j=m.length;q<j;q++){var o=m[q];this.removeTileMonitoringHooks(o);o.destroy();}}this.grid=[];}},clone:function(b){if(b==null){b=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions());}b=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[b]);if(this.tileSize!=null){b.tileSize=this.tileSize.clone();}b.grid=[];return b;},moveTo:function(l,h,j){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);l=l||this.map.getExtent();if(l!=null){var m=!this.grid.length||h;var g=this.getTilesBounds();if(this.singleTile){if(m||(!j&&!g.containsBounds(l))){this.initSingleTile(l);}}else{if(m||!g.containsBounds(l,true)){this.initGriddedTiles(l);}else{this.moveGriddedTiles(l);}}}},setTileSize:function(b){if(this.singleTile){b=this.map.getSize();b.h=parseInt(b.h*this.ratio);b.w=parseInt(b.w*this.ratio);}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[b]);},getGridBounds:function(){var b="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";OpenLayers.Console.warn(b);return this.getTilesBounds();},getTilesBounds:function(){var j=null;
if(this.grid.length){var h=this.grid.length-1;var l=this.grid[h][0];var g=this.grid[0].length-1;var m=this.grid[0][g];j=new OpenLayers.Bounds(l.bounds.left,l.bounds.bottom,m.bounds.right,m.bounds.top);}return j;},initSingleTile:function(r){var m=r.getCenterLonLat();var o=r.getWidth()*this.ratio;var l=r.getHeight()*this.ratio;var q=new OpenLayers.Bounds(m.lon-(o/2),m.lat-(l/2),m.lon+(o/2),m.lat+(l/2));var t=new OpenLayers.LonLat(q.left,q.top);var u=this.map.getLayerPxFromLonLat(t);if(!this.grid.length){this.grid[0]=[];}var s=this.grid[0][0];if(!s){s=this.addTile(q,u);this.addTileMonitoringHooks(s);s.draw();this.grid[0][0]=s;}else{s.moveTo(q,u);}this.removeExcessTiles(1,1);},calculateGridLayout:function(J,K,F){var w=F*this.tileSize.w;var H=F*this.tileSize.h;var B=J.left-K.left;var v=Math.floor(B/w)-this.buffer;var z=B/w-v;var E=-z*this.tileSize.w;var u=K.left+v*w;var I=J.top-(K.bottom+H);var C=Math.ceil(I/H)+this.buffer;var L=C-I/H;var G=-L*this.tileSize.h;var D=K.bottom+C*H;return{tilelon:w,tilelat:H,tileoffsetlon:u,tileoffsetlat:D,tileoffsetx:E,tileoffsety:G};},initGriddedTiles:function(Z){var ab=this.map.getSize();var Q=Math.ceil(ab.h/this.tileSize.h)+Math.max(1,2*this.buffer);var M=Math.ceil(ab.w/this.tileSize.w)+Math.max(1,2*this.buffer);var O=this.getMaxExtent();var I=this.map.getResolution();var K=this.calculateGridLayout(Z,O,I);var ac=Math.round(K.tileoffsetx);var af=Math.round(K.tileoffsety);var W=K.tileoffsetlon;var P=K.tileoffsetlat;var ad=K.tilelon;var Y=K.tilelat;this.origin=new OpenLayers.Pixel(ac,af);var T=ac;var N=W;var V=0;var ah=parseInt(this.map.layerContainerDiv.style.left);var H=parseInt(this.map.layerContainerDiv.style.top);do{var aa=this.grid[V++];if(!aa){aa=[];this.grid.push(aa);}W=N;ac=T;var ae=0;do{var ag=new OpenLayers.Bounds(W,P,W+ad,P+Y);var S=ac;S-=ah;var U=af;U-=H;var L=new OpenLayers.Pixel(S,U);var J=aa[ae++];if(!J){J=this.addTile(ag,L);this.addTileMonitoringHooks(J);aa.push(J);}else{J.moveTo(ag,L,false);}W+=ad;ac+=this.tileSize.w;}while((W<=Z.right+ad*this.buffer)||ae<M);P-=Y;af+=this.tileSize.h;}while((P>=Z.bottom-Y*this.buffer)||V<Q);this.removeExcessTiles(V,ae);this.spiralTileLoad();},getMaxExtent:function(){return this.maxExtent;},spiralTileLoad:function(){var C=[];var t=["right","down","left","up"];var u=0;var D=-1;var r=OpenLayers.Util.indexOf(t,"right");var q=0;while(q<t.length){var s=u;var B=D;switch(t[r]){case"right":B++;break;case"down":s++;break;case"left":B--;break;case"up":s--;break;}var v=null;if((s<this.grid.length)&&(s>=0)&&(B<this.grid[0].length)&&(B>=0)){v=this.grid[s][B];}if((v!=null)&&(!v.queued)){C.unshift(v);v.queued=true;q=0;u=s;D=B;}else{r=(r+1)%4;q++;}}for(var z=0,w=C.length;z<w;z++){var v=C[z];v.draw();v.queued=false;}},addTile:function(d,e){},addTileMonitoringHooks:function(b){b.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart");}this.numLoadingTiles++;};b.events.register("loadstart",this,b.onLoadStart);b.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend");}};b.events.register("loadend",this,b.onLoadEnd);b.events.register("unload",this,b.onLoadEnd);},removeTileMonitoringHooks:function(b){b.unload();b.events.un({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,scope:this});},moveGriddedTiles:function(j){var f=this.buffer||1;while(true){var g=this.grid[0][0].position;var h=this.map.getViewPortPxFromLayerPx(g);if(h.x>-this.tileSize.w*(f-1)){this.shiftColumn(true);}else{if(h.x<-this.tileSize.w*f){this.shiftColumn(false);}else{if(h.y>-this.tileSize.h*(f-1)){this.shiftRow(true);}else{if(h.y<-this.tileSize.h*f){this.shiftRow(false);}else{break;}}}}}},shiftRow:function(s){var F=(s)?0:(this.grid.length-1);var G=this.grid;var C=G[F];var D=this.map.getResolution();var z=(s)?-this.tileSize.h:this.tileSize.h;var B=D*-z;var t=(s)?G.pop():G.shift();for(var w=0,u=C.length;w<u;w++){var E=C[w];var H=E.bounds.clone();var v=E.position.clone();H.bottom=H.bottom+B;H.top=H.top+B;v.y=v.y+z;t[w].moveTo(H,v);}if(s){G.unshift(t);}else{G.push(t);}},shiftColumn:function(r){var C=(r)?-this.tileSize.w:this.tileSize.w;var D=this.map.getResolution();var t=D*C;for(var B=0,w=this.grid.length;B<w;B++){var s=this.grid[B];var u=(r)?0:(s.length-1);var E=s[u];var F=E.bounds.clone();var z=E.position.clone();F.left=F.left+t;F.right=F.right+t;z.x=z.x+C;var v=r?this.grid[B].pop():this.grid[B].shift();v.moveTo(F,z);if(r){s.unshift(v);}else{s.push(v);}}},removeExcessTiles:function(m,q){while(this.grid.length>m){var l=this.grid.pop();for(var h=0,j=l.length;h<j;h++){var o=l[h];this.removeTileMonitoringHooks(o);o.destroy();}}while(this.grid[0].length>q){for(var h=0,j=this.grid.length;h<j;h++){var l=this.grid[h];var o=l.pop();this.removeTileMonitoringHooks(o);o.destroy();}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize();}},getTileBounds:function(t){var u=this.maxExtent;var r=this.getResolution();var s=r*this.tileSize.w;var l=r*this.tileSize.h;var o=this.getLonLatFromViewPortPx(t);var m=u.left+(s*Math.floor((o.lon-u.left)/s));var q=u.bottom+(l*Math.floor((o.lat-u.bottom)/l));return new OpenLayers.Bounds(m,q,m+s,q+l);},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",exceptions:"application/vnd.ogc.se_inimage",format:"image/jpeg"},reproject:false,isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{"EPSG:4326":true},initialize:function(l,m,j,g){var h=[];j=OpenLayers.Util.upperCaseObject(j);if(parseFloat(j.VERSION)>=1.3&&!j.EXCEPTIONS){j.EXCEPTIONS="INIMAGE";}h.push(l,m,j,g);OpenLayers.Layer.Grid.prototype.initialize.apply(this,h);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((g==null)||(!g.isBaseLayer)){this.isBaseLayer=false;}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png";}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);},clone:function(b){if(b==null){b=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions());}b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b]);return b;},reverseAxisOrder:function(){return(parseFloat(this.params.VERSION)>=1.3&&!!this.yx[this.map.getProjectionObject().getCode()]);},getURL:function(m){m=this.adjustBounds(m);var l=this.getImageSize();var j={};var g=this.reverseAxisOrder();j.BBOX=this.encodeBBOX?m.toBBOX(null,g):m.toArray(g);j.WIDTH=l.w;j.HEIGHT=l.h;var h=this.getFullRequestString(j);return h;},addTile:function(d,e){return new OpenLayers.Tile.Image(this,e,d,null,this.tileSize);},mergeNewParams:function(g){var e=OpenLayers.Util.upperCaseObject(g);var f=[e];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,f);},getFullRequestString:function(h,f){var g=this.map.getProjection();var j=(g=="none")?null:g;if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=j;}else{this.params.SRS=j;}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments);},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,sphericalMercator:false,zoomOffset:0,initialize:function(h,j,f){if(f&&f.sphericalMercator||this.sphericalMercator){f=OpenLayers.Util.extend({maxExtent:new OpenLayers.Bounds(-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339),maxResolution:156543.0339,numZoomLevels:19,units:"m",projection:"EPSG:900913"},f);}j=j||this.url;h=h||this.name;var g=[h,j,{},f];OpenLayers.Layer.Grid.prototype.initialize.apply(this,g);},clone:function(b){if(b==null){b=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions());}b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b]);return b;},getURL:function(s){var u=this.map.getResolution();var m=Math.round((s.left-this.maxExtent.left)/(u*this.tileSize.w));
var o=Math.round((this.maxExtent.top-s.top)/(u*this.tileSize.h));var q=this.map.getZoom()+this.zoomOffset;var l=this.url;var t=""+m+o+q;if(l instanceof Array){l=this.selectUrl(t,l);}var r=OpenLayers.String.format(l,{x:m,y:o,z:q});return r;},addTile:function(d,e){return new OpenLayers.Tile.Image(this,e,d,null,this.tileSize);},setMap:function(b){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom);}},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:true,url:"http://tile.openstreetmap.org/${z}/${x}/${y}.png",clone:function(b){if(b==null){b=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions());}b=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b]);return b;},CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,isGecko:null,supportUse:null,initialize:function(b){if(!this.supported()){return;}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.supportUse=(navigator.userAgent.toLowerCase().indexOf("applewebkit/5")==-1);this.isGecko=(navigator.userAgent.toLowerCase().indexOf("gecko/")!=-1);this.symbolMetrics={};},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments);},supported:function(){var b="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(b+"SVG","1.1")||document.implementation.hasFeature(b+"BasicStructure","1.1")));},inValidRange:function(h,j,g){var l=h+(g?0:this.translationParameters.x);var m=j+(g?0:this.translationParameters.y);return(l>=-this.MAX_PIXEL&&l<=this.MAX_PIXEL&&m>=-this.MAX_PIXEL&&m<=this.MAX_PIXEL);},setExtent:function(j,r){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var l=this.getResolution();var o=-j.left/l;var q=j.top/l;if(r){this.left=o;this.top=q;var s="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",s);this.translate(0,0);return true;}else{var m=this.translate(o-this.left,q-this.top);if(!m){this.setExtent(j,true);}return m;}},translate:function(f,g){if(!this.inValidRange(f,g,true)){return false;}else{var e="";if(f||g){e="translate("+f+","+g+")";}this.root.setAttributeNS(null,"transform",e);this.translationParameters={x:f,y:g};return true;}},setSize:function(b){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h);},getNodeType:function(g,e){var f=null;switch(g.CLASS_NAME){case"OpenLayers.Geometry.Point":if(e.externalGraphic){f="image";}else{if(this.isComplexSymbol(e.graphicName)){f=this.supportUse===false?"svg":"use";}else{f="circle";}}break;case"OpenLayers.Geometry.Rectangle":f="rect";break;case"OpenLayers.Geometry.LineString":f="polyline";break;case"OpenLayers.Geometry.LinearRing":f="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":f="path";break;default:break;}return f;},setStyle:function(E,r,T){r=r||E._style;T=T||E._options;var K=parseFloat(E.getAttributeNS(null,"r"));var L=1;var Q;if(E._geometryClass=="OpenLayers.Geometry.Point"&&K){E.style.visibility="";if(r.graphic===false){E.style.visibility="hidden";}else{if(r.externalGraphic){Q=this.getPosition(E);if(r.graphicTitle){E.setAttributeNS(null,"title",r.graphicTitle);}if(r.graphicWidth&&r.graphicHeight){E.setAttributeNS(null,"preserveAspectRatio","none");}var F=r.graphicWidth||r.graphicHeight;var I=r.graphicHeight||r.graphicWidth;F=F?F:r.pointRadius*2;I=I?I:r.pointRadius*2;var H=(r.graphicXOffset!=undefined)?r.graphicXOffset:-(0.5*F);var O=(r.graphicYOffset!=undefined)?r.graphicYOffset:-(0.5*I);var U=r.graphicOpacity||r.fillOpacity;E.setAttributeNS(null,"x",(Q.x+H).toFixed());E.setAttributeNS(null,"y",(Q.y+O).toFixed());E.setAttributeNS(null,"width",F);E.setAttributeNS(null,"height",I);E.setAttributeNS(this.xlinkns,"href",r.externalGraphic);E.setAttributeNS(null,"style","opacity: "+U);}else{if(this.isComplexSymbol(r.graphicName)){var S=r.pointRadius*3;var J=S*2;var G=this.importSymbol(r.graphicName);Q=this.getPosition(E);L=this.symbolMetrics[G][0]*3/J;var N=E.parentNode;var M=E.nextSibling;if(N){N.removeChild(E);}if(this.supportUse===false){var P=document.getElementById(G);E.firstChild&&E.removeChild(E.firstChild);E.appendChild(P.firstChild.cloneNode(true));E.setAttributeNS(null,"viewBox",P.getAttributeNS(null,"viewBox"));}else{E.setAttributeNS(this.xlinkns,"href","#"+G);}E.setAttributeNS(null,"width",J);E.setAttributeNS(null,"height",J);E.setAttributeNS(null,"x",Q.x-S);E.setAttributeNS(null,"y",Q.y-S);if(M){N.insertBefore(E,M);}else{if(N){N.appendChild(E);}}}else{E.setAttributeNS(null,"r",r.pointRadius);}}}var C=r.rotation;if((C!==undefined||E._rotation!==undefined)&&Q){E._rotation=C;C|=0;if(E.nodeName!=="svg"){E.setAttributeNS(null,"transform","rotate("+C+" "+Q.x+" "+Q.y+")");}else{var D=this.symbolMetrics[G];E.firstChild.setAttributeNS(null,"transform","rotate("+r.rotation+" "+D[1]+" "+D[2]+")");}}}if(T.isFilled){E.setAttributeNS(null,"fill",r.fillColor);E.setAttributeNS(null,"fill-opacity",r.fillOpacity);}else{E.setAttributeNS(null,"fill","none");}if(T.isStroked){E.setAttributeNS(null,"stroke",r.strokeColor);E.setAttributeNS(null,"stroke-opacity",r.strokeOpacity);E.setAttributeNS(null,"stroke-width",r.strokeWidth*L);E.setAttributeNS(null,"stroke-linecap",r.strokeLinecap||"round");E.setAttributeNS(null,"stroke-linejoin","round");r.strokeDashstyle&&E.setAttributeNS(null,"stroke-dasharray",this.dashStyle(r,L));}else{E.setAttributeNS(null,"stroke","none");}if(r.pointerEvents){E.setAttributeNS(null,"pointer-events",r.pointerEvents);}if(r.cursor!=null){E.setAttributeNS(null,"cursor",r.cursor);}return E;},dashStyle:function(j,f){var g=j.strokeWidth*f;var h=j.strokeDashstyle;switch(h){case"solid":return"none";case"dot":return[1,4*g].join();case"dash":return[4*g,4*g].join();case"dashdot":return[4*g,4*g,1,4*g].join();case"longdash":return[8*g,4*g].join();case"longdashdot":return[8*g,4*g,1,4*g].join();default:return OpenLayers.String.trim(h).replace(/\s+/g,",");}},createNode:function(f,g){var e=document.createElementNS(this.xmlns,f);if(g){e.setAttributeNS(null,"id",g);}return e;},nodeTypeCompare:function(d,e){return(e==d.nodeName);},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg");},createRoot:function(b){return this.nodeFactory(this.container.id+b,"g");},createDefs:function(){var b=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(b);return b;},drawPoint:function(e,d){return this.drawCircle(e,d,1);},drawCircle:function(o,m,h){var q=this.getResolution();var j=(m.x/q+this.left);var l=(this.top-m.y/q);if(this.inValidRange(j,l)){o.setAttributeNS(null,"cx",j);o.setAttributeNS(null,"cy",l);o.setAttributeNS(null,"r",h);return o;}else{return false;}},drawLineString:function(e,g){var f=this.getComponentsString(g.components);if(f.path){e.setAttributeNS(null,"points",f.path);return(f.complete?e:null);}else{return false;}},drawLinearRing:function(e,g){var f=this.getComponentsString(g.components);if(f.path){e.setAttributeNS(null,"points",f.path);return(f.complete?e:null);}else{return false;}},drawPolygon:function(v,q){var r="";var j=true;var w=true;var u,d;for(var t=0,s=q.components.length;t<s;t++){r+=" M";u=this.getComponentsString(q.components[t].components," ");d=u.path;if(d){r+=" "+d;w=u.complete&&w;}else{j=false;}}r+=" z";if(j){v.setAttributeNS(null,"d",r);v.setAttributeNS(null,"fill-rule","evenodd");
return w?v:null;}else{return false;}},drawRectangle:function(m,l){var g=this.getResolution();var h=(l.x/g+this.left);var j=(this.top-l.y/g);if(this.inValidRange(h,j)){m.setAttributeNS(null,"x",h);m.setAttributeNS(null,"y",j);m.setAttributeNS(null,"width",l.width/g);m.setAttributeNS(null,"height",l.height/g);return m;}else{return false;}},drawSurface:function(q,m){var o=null;var d=true;for(var r=0,l=m.components.length;r<l;r++){if((r%3)==0&&(r/3)==0){var s=this.getShortString(m.components[r]);if(!s){d=false;}o="M "+s;}else{if((r%3)==1){var s=this.getShortString(m.components[r]);if(!s){d=false;}o+=" C "+s;}else{var s=this.getShortString(m.components[r]);if(!s){d=false;}o+=" "+s;}}}o+=" Z";if(d){q.setAttributeNS(null,"d",o);return q;}else{return false;}},drawText:function(u,w,m){var v=this.getResolution();var o=(m.x/v+this.left);var s=(m.y/v-this.top);var q=this.nodeFactory(u+this.LABEL_ID_SUFFIX,"text");var r=this.nodeFactory(u+this.LABEL_ID_SUFFIX+"_tspan","tspan");q.setAttributeNS(null,"x",o);q.setAttributeNS(null,"y",-s);if(w.fontColor){q.setAttributeNS(null,"fill",w.fontColor);}if(w.fontOpacity){q.setAttributeNS(null,"opacity",w.fontOpacity);}if(w.fontFamily){q.setAttributeNS(null,"font-family",w.fontFamily);}if(w.fontSize){q.setAttributeNS(null,"font-size",w.fontSize);}if(w.fontWeight){q.setAttributeNS(null,"font-weight",w.fontWeight);}if(w.labelSelect===true){q.setAttributeNS(null,"pointer-events","visible");q._featureId=u;r._featureId=u;r._geometry=m;r._geometryClass=m.CLASS_NAME;}else{q.setAttributeNS(null,"pointer-events","none");}var t=w.labelAlign||"cm";q.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[t[0]]||"middle");if(this.isGecko){q.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[t[1]]||"central");}else{r.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[t[1]]||"-35%");}r.textContent=w.label;if(!q.parentNode){q.appendChild(r);this.textRoot.appendChild(q);}},getComponentsString:function(t,u){var r=[];var w=true;var s=t.length;var m=[];var q,o;for(var v=0;v<s;v++){o=t[v];r.push(o);q=this.getShortString(o);if(q){m.push(q);}else{if(v>0){if(this.getShortString(t[v-1])){m.push(this.clipLine(t[v],t[v-1]));}}if(v<s-1){if(this.getShortString(t[v+1])){m.push(this.clipLine(t[v],t[v+1]));}}w=false;}}return{path:m.join(u||","),complete:w};},clipLine:function(u,r){if(r.equals(u)){return"";}var t=this.getResolution();var z=this.MAX_PIXEL-this.translationParameters.x;var B=this.MAX_PIXEL-this.translationParameters.y;var v=r.x/t+this.left;var o=this.top-r.y/t;var w=u.x/t+this.left;var q=this.top-u.y/t;var s;if(w<-z||w>z){s=(q-o)/(w-v);w=w<0?-z:z;q=o+(w-v)*s;}if(q<-B||q>B){s=(w-v)/(q-o);q=q<0?-B:B;w=v+(q-o)*s;}return w+","+q;},getShortString:function(f){var j=this.getResolution();var g=(f.x/j+this.left);var h=(this.top-f.y/j);if(this.inValidRange(g,h)){return g+","+h;}else{return false;}},getPosition:function(b){return({x:parseFloat(b.getAttributeNS(null,"cx")),y:parseFloat(b.getAttributeNS(null,"cy"))});},importSymbol:function(D){if(!this.defs){this.defs=this.createDefs();}var G=this.container.id+"-"+D;if(document.getElementById(G)!=null){return G;}var E=OpenLayers.Renderer.symbol[D];if(!E){throw new Error(D+" is not a valid symbol name");}var B=this.nodeFactory(G,"symbol");var F=this.nodeFactory(null,"polygon");B.appendChild(F);var t=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var v=[];var w,z;for(var C=0;C<E.length;C=C+2){w=E[C];z=E[C+1];t.left=Math.min(t.left,w);t.bottom=Math.min(t.bottom,z);t.right=Math.max(t.right,w);t.top=Math.max(t.top,z);v.push(w,",",z);}F.setAttributeNS(null,"points",v.join(" "));var H=t.getWidth();var u=t.getHeight();var s=[t.left-H,t.bottom-u,H*3,u*3];B.setAttributeNS(null,"viewBox",s.join(" "));this.symbolMetrics[G]=[Math.max(H,u),t.getCenterLonLat().lon,t.getCenterLonLat().lat];this.defs.appendChild(B);return B.id;},getFeatureIdFromEvent:function(f){var g=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(this.supportUse===false&&!g){var e=f.target;g=e.parentNode&&e!=this.rendererRoot&&e.parentNode._featureId;}return g;},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,format:"image/png",serverResolutions:null,initialize:function(j,f,h,g){this.layername=h;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[j,f,{},g]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=(this.extension=="jpg")?"jpeg":this.extension;},clone:function(b){if(b==null){b=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions());}b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b]);return b;},getURL:function(C){var v=this.map.getResolution();var u=this.maxExtent;var q=this.tileSize;var D=Math.round((C.left-u.left)/(v*q.w));var r=Math.round((C.bottom-u.bottom)/(v*q.h));var t=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,v):this.map.getZoom();function w(a,b){a=String(a);var e=[];for(var d=0;d<b;++d){e.push("0");}return e.join("").substring(0,b-a.length)+a;}var z=[this.layername,w(t,2),w(parseInt(D/1000000),3),w((parseInt(D/1000)%1000),3),w((parseInt(D)%1000),3),w(parseInt(r/1000000),3),w((parseInt(r/1000)%1000),3),w((parseInt(r)%1000),3)+"."+this.extension];var s=z.join("/");var B=this.url;if(B instanceof Array){B=this.selectUrl(s,B);}B=(B.charAt(B.length-1)=="/")?B:B+"/";return B+s;},addTile:function(g,f){var e=this.getURL(g);return new OpenLayers.Tile.Image(this,f,g,e,this.tileSize);},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:false,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var b=this.topInUnits.length;this.div.appendChild(this.eTop);if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden";}else{this.eTop.style.visibility="visible";}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden";}else{this.eBottom.style.visibility="visible";}}this.map.events.register("moveend",this,this.update);this.update();return this.div;},getBarLen:function(g){var l=parseInt(Math.log(g)/Math.log(10));var h=Math.pow(10,l);var m=parseInt(g/h);var j;if(m>5){j=5;}else{if(m>2){j=2;}else{j=1;}}return j*h;},update:function(){var z=this.map.getResolution();if(!z){return;}var K=this.map.getUnits();var F=OpenLayers.INCHES_PER_UNIT;var v=this.maxWidth*z*F[K];var L=1;if(this.geodesic===true){var I=(this.map.getGeodesicPixelSize().w||0.000001)*this.maxWidth;var E=v/F.km;L=I/E;v*=L;}var J;var G;if(v>100000){J=this.topOutUnits;G=this.bottomOutUnits;}else{J=this.topInUnits;G=this.bottomInUnits;}var C=v/F[J];var w=v/F[G];var B=this.getBarLen(C);var D=this.getBarLen(w);C=B/F[K]*F[J];w=D/F[K]*F[G];var H=C/z/L;var u=w/z/L;if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(u)+"px";this.eBottom.innerHTML=D+" "+G;}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(H)+"px";this.eTop.innerHTML=B+" "+J;}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(b){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[b]);
},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,f){var g={};this.readChildNodes(e,g);f.outer=g.components[0];},innerBoundaryIs:function(e,f){var g={};this.readChildNodes(e,g);f.inner.push(g.components[0]);},Box:function(l,g){var j={};this.readChildNodes(l,j);if(!g.components){g.components=[];}var m=j.points[0];var h=j.points[1];g.components.push(new OpenLayers.Bounds(m.x,m.y,h.x,h.y));}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(g){var e;if(g instanceof Array){e="wfs:FeatureCollection";}else{e="gml:featureMember";}var f=this.writeNode(e,g);this.setAttributeNS(f,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[f]);},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(d){var e=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[d],e);return e;},coordinates:function(l){var m=l.length;var j=new Array(m);var h;for(var g=0;g<m;++g){h=l[g];if(this.xy){j[g]=h.x+","+h.y;}else{j[g]=h.y+","+h.x;}if(h.z!=undefined){j[g]+=","+h.z;}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:(m==1)?j[0]:j.join(" ")});},LineString:function(d){var e=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",d.components,e);return e;},Polygon:function(g){var e=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",g.components[0],e);for(var f=1;f<g.components.length;++f){this.writeNode("innerBoundaryIs",g.components[f],e);}return e;},outerBoundaryIs:function(e){var d=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",e,d);return d;},innerBoundaryIs:function(e){var d=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",e,d);return d;},LinearRing:function(e){var d=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",e.components,d);return d;},Box:function(d){var e=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:d.left,y:d.bottom},{x:d.right,y:d.top}],e);if(this.srsName){e.setAttribute("srsName",this.srsName);}return e;}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,initialize:function(b){OpenLayers.Format.prototype.initialize.apply(this,[b]);},read:function(json,filter){try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var object=eval("("+json+")");if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i]);}}}return filter(k,v);}object=walk("",object);}if(this.keepData){this.data=object;}return object;}}catch(e){}return null;},write:function(j,m){this.pretty=!!m;var h=null;var g=typeof j;if(this.serialize[g]){try{h=this.serialize[g].apply(this,[j]);}catch(l){OpenLayers.Console.error("Trouble serializing: "+l);}}return h;},writeIndent:function(){var d=[];if(this.pretty){for(var e=0;e<this.level;++e){d.push(this.indent);}}return d.join("");},writeNewline:function(){return(this.pretty)?this.newline:"";},writeSpace:function(){return(this.pretty)?this.space:"";},serialize:{object:function(q){if(q==null){return"null";}if(q.constructor==Date){return this.serialize.date.apply(this,[q]);}if(q.constructor==Array){return this.serialize.array.apply(this,[q]);}var l=["{"];this.level+=1;var o,h,m;var j=false;for(o in q){if(q.hasOwnProperty(o)){h=OpenLayers.Format.JSON.prototype.write.apply(this,[o,this.pretty]);m=OpenLayers.Format.JSON.prototype.write.apply(this,[q[o],this.pretty]);if(h!=null&&m!=null){if(j){l.push(",");}l.push(this.writeNewline(),this.writeIndent(),h,":",this.writeSpace(),m);j=true;}}}this.level-=1;l.push(this.writeNewline(),this.writeIndent(),"}");return l.join("");},array:function(j){var m;var l=["["];this.level+=1;for(var g=0,h=j.length;g<h;++g){m=OpenLayers.Format.JSON.prototype.write.apply(this,[j[g],this.pretty]);if(m!=null){if(g>0){l.push(",");}l.push(this.writeNewline(),this.writeIndent(),m);}}this.level-=1;l.push(this.writeNewline(),this.writeIndent(),"]");return l.join("");},string:function(d){var e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(d)){return'"'+d.replace(/([\x00-\x1f\\"])/g,function(b,g){var a=e[g];if(a){return a;}a=g.charCodeAt();return"\\u00"+Math.floor(a/16).toString(16)+(a%16).toString(16);})+'"';}return'"'+d+'"';},number:function(b){return isFinite(b)?String(b):"null";},"boolean":function(b){return String(b);},date:function(e){function d(a){return(a<10)?"0"+a:a;}return'"'+e.getFullYear()+"-"+d(e.getMonth()+1)+"-"+d(e.getDate())+"T"+d(e.getHours())+":"+d(e.getMinutes())+":"+d(e.getSeconds())+'"';}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);},read:function(e){var d={};this.readers.ogc.Filter.apply(this,[e,d]);return d.filter;},readers:{ogc:{Filter:function(e,f){var g={fids:[],filters:[]};this.readChildNodes(e,g);if(g.fids.length>0){f.filter=new OpenLayers.Filter.FeatureId({fids:g.fids});}else{if(g.filters.length>0){f.filter=g.filters[0];}}},FeatureId:function(f,e){var g=f.getAttribute("fid");if(g){e.fids.push(g);}},And:function(e,g){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,f);g.filters.push(f);},Or:function(e,g){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,f);g.filters.push(f);},Not:function(e,g){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,f);g.filters.push(f);},PropertyIsLessThan:function(e,g){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,f);g.filters.push(f);},PropertyIsGreaterThan:function(e,g){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,f);g.filters.push(f);},PropertyIsLessThanOrEqualTo:function(e,g){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,f);g.filters.push(f);},PropertyIsGreaterThanOrEqualTo:function(e,g){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,f);g.filters.push(f);},PropertyIsBetween:function(e,g){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,f);g.filters.push(f);},Literal:function(e,d){d.value=OpenLayers.String.numericIf(this.getChildValue(e));},PropertyName:function(d,e){e.property=this.getChildValue(d);},LowerBoundary:function(d,e){e.lowerBoundary=OpenLayers.String.numericIf(this.readOgcExpression(d));},UpperBoundary:function(d,e){e.upperBoundary=OpenLayers.String.numericIf(this.readOgcExpression(d));},Intersects:function(e,d){this.readSpatial(e,d,OpenLayers.Filter.Spatial.INTERSECTS);},Within:function(e,d){this.readSpatial(e,d,OpenLayers.Filter.Spatial.WITHIN);},Contains:function(e,d){this.readSpatial(e,d,OpenLayers.Filter.Spatial.CONTAINS);},DWithin:function(e,d){this.readSpatial(e,d,OpenLayers.Filter.Spatial.DWITHIN);},Distance:function(e,d){d.distance=parseInt(this.getChildValue(e));d.distanceUnits=e.getAttribute("units");}}},readSpatial:function(j,h,f){var g=new OpenLayers.Filter.Spatial({type:f});
this.readChildNodes(j,g);g.value=g.components[0];delete g.components;h.filters.push(g);},readOgcExpression:function(f){var g={};this.readChildNodes(f,g);var e=g.value;if(e===undefined){e=this.getChildValue(f);}return e;},write:function(b){return this.writers.ogc.Filter.apply(this,[b]);},writers:{ogc:{Filter:function(j){var h=this.createElementNSPlus("ogc:Filter");var f=j.CLASS_NAME.split(".").pop();if(f=="FeatureId"){for(var g=0;g<j.fids.length;++g){this.writeNode("FeatureId",j.fids[g],h);}}else{this.writeNode(this.getFilterType(j),j,h);}return h;},FeatureId:function(b){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:b}});},And:function(j){var h=this.createElementNSPlus("ogc:And");var f;for(var g=0;g<j.filters.length;++g){f=j.filters[g];this.writeNode(this.getFilterType(f),f,h);}return h;},Or:function(j){var h=this.createElementNSPlus("ogc:Or");var f;for(var g=0;g<j.filters.length;++g){f=j.filters[g];this.writeNode(this.getFilterType(f),f,h);}return h;},Not:function(e){var g=this.createElementNSPlus("ogc:Not");var f=e.filters[0];this.writeNode(this.getFilterType(f),f,g);return g;},PropertyIsLessThan:function(e){var d=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",e,d);this.writeNode("Literal",e.value,d);return d;},PropertyIsGreaterThan:function(e){var d=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",e,d);this.writeNode("Literal",e.value,d);return d;},PropertyIsLessThanOrEqualTo:function(e){var d=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",e,d);this.writeNode("Literal",e.value,d);return d;},PropertyIsGreaterThanOrEqualTo:function(e){var d=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",e,d);this.writeNode("Literal",e.value,d);return d;},PropertyIsBetween:function(e){var d=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",e,d);this.writeNode("LowerBoundary",e,d);this.writeNode("UpperBoundary",e,d);return d;},PropertyName:function(b){return this.createElementNSPlus("ogc:PropertyName",{value:b.property});},Literal:function(b){return this.createElementNSPlus("ogc:Literal",{value:b});},LowerBoundary:function(e){var d=this.createElementNSPlus("ogc:LowerBoundary");this.writeNode("Literal",e.lowerBoundary,d);return d;},UpperBoundary:function(e){var d=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",e.upperBoundary,d);return d;},INTERSECTS:function(b){return this.writeSpatial(b,"Intersects");},WITHIN:function(b){return this.writeSpatial(b,"Within");},CONTAINS:function(b){return this.writeSpatial(b,"Contains");},DWITHIN:function(e){var d=this.writeSpatial(e,"DWithin");this.writeNode("Distance",e,d);return d;},Distance:function(b){return this.createElementNSPlus("ogc:Distance",{attributes:{units:b.distanceUnits},value:b.distance});}}},getFilterType:function(e){var d=this.filterMap[e.type];if(!d){throw"Filter writing not supported for rule type: "+e.type;}return d;},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(b){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[b]);},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,g){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,f);g.filters.push(f);},PropertyIsNotEqualTo:function(e,g){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,f);g.filters.push(f);},PropertyIsLike:function(o,m){var q=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(o,q);var l=o.getAttribute("wildCard");var h=o.getAttribute("singleChar");var j=o.getAttribute("escape");q.value2regex(l,h,j);m.filters.push(q);}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var d=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",e,d);this.writeNode("Literal",e.value,d);return d;},PropertyIsNotEqualTo:function(e){var d=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",e,d);this.writeNode("Literal",e.value,d);return d;},PropertyIsLike:function(e){var d=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",e,d);this.writeNode("Literal",e.regex2value(),d);return d;},BBOX:function(f){var g=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",f,g);var e=this.writeNode("gml:Box",f.value,g);if(f.projection){e.setAttribute("srsName",f.projection);}return g;}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(f,g){var j=this.createElementNSPlus("ogc:"+g);this.writeNode("PropertyName",f,j);var h;if(f.value instanceof OpenLayers.Geometry){h=this.writeNode("feature:_geometry",f.value).firstChild;}else{h=this.writeNode("gml:Box",f.value);}if(f.projection){h.setAttribute("srsName",f.projection);}j.appendChild(h);return j;},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(b){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[b]);},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(f,h){var j=f.getAttribute("matchCase");var g=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(j==="false"||j==="0")});this.readChildNodes(f,g);h.filters.push(g);},PropertyIsNotEqualTo:function(f,h){var j=f.getAttribute("matchCase");var g=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(j==="false"||j==="0")});this.readChildNodes(f,g);h.filters.push(g);},PropertyIsLike:function(o,m){var q=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(o,q);var l=o.getAttribute("wildCard");var h=o.getAttribute("singleChar");var j=o.getAttribute("escapeChar");q.value2regex(l,h,j);m.filters.push(q);}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var d=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});this.writeNode("PropertyName",e,d);this.writeNode("Literal",e.value,d);return d;},PropertyIsNotEqualTo:function(e){var d=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});this.writeNode("PropertyName",e,d);this.writeNode("Literal",e.value,d);return d;},PropertyIsLike:function(e){var d=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",e,d);this.writeNode("Literal",e.regex2value(),d);return d;},BBOX:function(f){var g=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",f,g);var e=this.writeNode("gml:Envelope",f.value);if(f.projection){e.setAttribute("srsName",f.projection);}g.appendChild(e);
return g;}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(f,g){var j=this.createElementNSPlus("ogc:"+g);this.writeNode("PropertyName",f,j);var h;if(f.value instanceof OpenLayers.Geometry){h=this.writeNode("feature:_geometry",f.value).firstChild;}else{h=this.writeNode("gml:Envelope",f.value);}if(f.projection){h.setAttribute("srsName",f.projection);}j.appendChild(h);return j;},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",ows:"http://www.opengis.net/ows"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e]);}if(e&&e.nodeType==9){e=e.documentElement;}var d={};this.readNode(e,d);return d;},readers:{csw:{GetRecordsResponse:function(e,g){g.records=[];this.readChildNodes(e,g);var f=this.getAttributeNS(e,"","version");if(f!=""){g.version=f;}},RequestId:function(e,d){d.RequestId=this.getChildValue(e);},SearchStatus:function(f,g){g.SearchStatus={};var e=this.getAttributeNS(f,"","timestamp");if(e!=""){g.SearchStatus.timestamp=e;}},SearchResults:function(o,m){this.readChildNodes(o,m);var h=o.attributes;var l={};for(var q=0,j=h.length;q<j;++q){if((h[q].name=="numberOfRecordsMatched")||(h[q].name=="numberOfRecordsReturned")||(h[q].name=="nextRecord")){l[h[q].name]=parseInt(h[q].nodeValue);}else{l[h[q].name]=h[q].nodeValue;}}m.SearchResults=l;},SummaryRecord:function(e,g){var f={type:"SummaryRecord"};this.readChildNodes(e,f);g.records.push(f);},BriefRecord:function(e,g){var f={type:"BriefRecord"};this.readChildNodes(e,f);g.records.push(f);},DCMIRecord:function(e,g){var f={type:"DCMIRecord"};this.readChildNodes(e,f);g.records.push(f);},Record:function(e,g){var f={type:"Record"};this.readChildNodes(e,f);g.records.push(f);}},dc:{"*":function(o,m){var r=o.localName||o.nodeName.split(":").pop();if(!(m[r] instanceof Array)){m[r]=new Array();}var s={};var j=o.attributes;for(var q=0,l=j.length;q<l;++q){s[j[q].name]=j[q].nodeValue;}s.value=this.getChildValue(o);m[r].push(s);}},dct:{"*":function(e,g){var f=e.localName||e.nodeName.split(":").pop();if(!(g[f] instanceof Array)){g[f]=new Array();}g[f].push(this.getChildValue(e));}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(e,d){if(d.bounds){d.BoundingBox=[{crs:d.projection,value:[d.bounds.left,d.bounds.bottom,d.bounds.right,d.bounds.top]}];delete d.projection;delete d.bounds;}OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments);}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(e){var d=this.writeNode("csw:GetRecords",e);return OpenLayers.Format.XML.prototype.write.apply(this,[d]);},writers:{csw:{GetRecords:function(g){if(!g){g={};}var j=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:g.requestId||this.requestId,resultType:g.resultType||this.resultType,outputFormat:g.outputFormat||this.outputFormat,outputSchema:g.outputSchema||this.outputSchema,startPosition:g.startPosition||this.startPosition,maxRecords:g.maxRecords||this.maxRecords}});if(g.DistributedSearch||this.DistributedSearch){this.writeNode("csw:DistributedSearch",g.DistributedSearch||this.DistributedSearch,j);}var l=g.ResponseHandler||this.ResponseHandler;if(l instanceof Array&&l.length>0){for(var m=0,h=l.length;m<h;m++){this.writeNode("csw:ResponseHandler",l[m],j);}}this.writeNode("Query",g.Query||this.Query,j);return j;},DistributedSearch:function(e){var d=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:e.hopCount}});return d;},ResponseHandler:function(e){var d=this.createElementNSPlus("csw:ResponseHandler",{value:e.value});return d;},Query:function(g){if(!g){g={};}var j=this.createElementNSPlus("csw:Query",{attributes:{typeNames:g.typeNames||"csw:Record"}});var l=g.ElementName;if(l instanceof Array&&l.length>0){for(var m=0,h=l.length;m<h;m++){this.writeNode("csw:ElementName",l[m],j);}}else{this.writeNode("csw:ElementSetName",g.ElementSetName||{value:"summary"},j);}if(g.Constraint){this.writeNode("csw:Constraint",g.Constraint,j);}return j;},ElementName:function(e){var d=this.createElementNSPlus("csw:ElementName",{value:e.value});return d;},ElementSetName:function(e){var d=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:e.typeNames},value:e.value});return d;},Constraint:function(g){var f=this.createElementNSPlus("csw:Constraint",{attributes:{version:g.version}});if(g.Filter){var j=new OpenLayers.Format.Filter({version:g.version});f.appendChild(j.write(g.Filter));}else{if(g.CqlText){var h=this.createElementNSPlus("CqlText",{value:g.CqlText.value});f.appendChild(h);}}return f;}}},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.1",version:null,parser:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.options=b;},read:function(j){if(typeof j=="string"){j=OpenLayers.Format.XML.prototype.read.apply(this,[j]);}var m=j.documentElement;var g=this.version||m.getAttribute("version")||this.defaultVersion;if(!this.parser||this.parser.version!==g){var l=OpenLayers.Format.WMSCapabilities["v"+g.replace(/\./g,"_")];if(!l){throw"Can't find a WMS capabilities parser for version "+g;}this.parser=new l(this.options);}var h=this.parser.read(j);h.version=g;return h;},CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);},read:function(d){if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d]);}if(d&&d.nodeType==9){d=d.documentElement;}var e={};this.readNode(d,e);this.postProcessLayers(e);return e;},postProcessLayers:function(g){if(g.capability){g.capability.layers=[];var j=g.capability.nestedLayers;for(var l=0,h=j.length;l<h;++l){var m=j[l];this.processLayer(g.capability,m);}}},processLayer:function(F,u,D){if(u.formats===undefined){u.formats=F.request.getmap.formats;}if(D){u.styles=u.styles.concat(D.styles);var z=["queryable","cascaded","fixedWidth","fixedHeight","opaque","noSubsets","llbbox","minScale","maxScale","attribution"];var j=["srs","bbox","dimensions","authorityURLs"];var s;for(var B=0;B<z.length;B++){s=z[B];if(s in D){if(u[s]==null){u[s]=D[s];}if(u[s]==null){var v=["cascaded","fixedWidth","fixedHeight"];var E=["queryable","opaque","noSubsets"];if(OpenLayers.Util.indexOf(v,s)!=-1){u[s]=0;}if(OpenLayers.Util.indexOf(E,s)!=-1){u[s]=false;}}}}for(var B=0;B<j.length;B++){s=j[B];u[s]=OpenLayers.Util.extend(u[s],D[s]);}}for(var w=0,t=u.nestedLayers.length;w<t;w++){var C=u.nestedLayers[w];this.processLayer(F,C,u);}if(u.name){F.layers.push(u);}},readers:{wms:{Service:function(e,d){d.service={};this.readChildNodes(e,d.service);},Name:function(e,d){d.name=this.getChildValue(e);},Title:function(e,d){d.title=this.getChildValue(e);},Abstract:function(e,d){d["abstract"]=this.getChildValue(e);},BoundingBox:function(f,j){var h={};
h.bbox=[parseFloat(f.getAttribute("minx")),parseFloat(f.getAttribute("miny")),parseFloat(f.getAttribute("maxx")),parseFloat(f.getAttribute("maxy"))];var g={x:parseFloat(f.getAttribute("resx")),y:parseFloat(f.getAttribute("resy"))};if(!(isNaN(g.x)&&isNaN(g.y))){h.res=g;}return h;},OnlineResource:function(e,d){d.href=this.getAttributeNS(e,this.namespaces.xlink,"href");},ContactInformation:function(e,d){d.contactInformation={};this.readChildNodes(e,d.contactInformation);},ContactPersonPrimary:function(e,d){d.personPrimary={};this.readChildNodes(e,d.personPrimary);},ContactPerson:function(e,d){d.person=this.getChildValue(e);},ContactOrganization:function(e,d){d.organization=this.getChildValue(e);},ContactPosition:function(e,d){d.position=this.getChildValue(e);},ContactAddress:function(e,d){d.contactAddress={};this.readChildNodes(e,d.contactAddress);},AddressType:function(e,d){d.type=this.getChildValue(e);},Address:function(e,d){d.address=this.getChildValue(e);},City:function(e,d){d.city=this.getChildValue(e);},StateOrProvince:function(e,d){d.stateOrProvince=this.getChildValue(e);},PostCode:function(e,d){d.postcode=this.getChildValue(e);},Country:function(e,d){d.country=this.getChildValue(e);},ContactVoiceTelephone:function(e,d){d.phone=this.getChildValue(e);},ContactFacsimileTelephone:function(e,d){d.fax=this.getChildValue(e);},ContactElectronicMailAddress:function(e,d){d.email=this.getChildValue(e);},Fees:function(e,g){var f=this.getChildValue(e);if(f&&f.toLowerCase()!="none"){g.fees=f;}},AccessConstraints:function(f,e){var g=this.getChildValue(f);if(g&&g.toLowerCase()!="none"){e.accessConstraints=g;}},Capability:function(e,d){d.capability={nestedLayers:[]};this.readChildNodes(e,d.capability);},Request:function(e,d){d.request={};this.readChildNodes(e,d.request);},GetCapabilities:function(e,d){d.getcapabilities={formats:[]};this.readChildNodes(e,d.getcapabilities);},Format:function(e,d){if(d.formats instanceof Array){d.formats.push(this.getChildValue(e));}else{d.format=this.getChildValue(e);}},DCPType:function(e,d){this.readChildNodes(e,d);},HTTP:function(e,d){this.readChildNodes(e,d);},Get:function(e,d){this.readChildNodes(e,d);},Post:function(e,d){this.readChildNodes(e,d);},GetMap:function(e,d){d.getmap={formats:[]};this.readChildNodes(e,d.getmap);},GetFeatureInfo:function(e,d){d.getfeatureinfo={formats:[]};this.readChildNodes(e,d.getfeatureinfo);},Exception:function(e,d){d.exception={formats:[]};this.readChildNodes(e,d.exception);},Layer:function(C,w){var q=C.getAttributeNode("queryable");var B=(q&&q.specified)?C.getAttribute("queryable"):null;q=C.getAttributeNode("cascaded");var s=(q&&q.specified)?C.getAttribute("cascaded"):null;q=C.getAttributeNode("opaque");var v=(q&&q.specified)?C.getAttribute("opaque"):null;var r=C.getAttribute("noSubsets");var D=C.getAttribute("fixedWidth");var t=C.getAttribute("fixedHeight");var u={nestedLayers:[],styles:[],srs:{},metadataURLs:[],bbox:{},dimensions:{},authorityURLs:{},identifiers:{},keywords:[],queryable:(B&&B!=="")?(B==="1"||B==="true"):null,cascaded:(s!==null)?parseInt(s):null,opaque:v?(v==="1"||v==="true"):null,noSubsets:(r!==null)?(r==="1"||r==="true"):null,fixedWidth:(D!=null)?parseInt(D):null,fixedHeight:(t!=null)?parseInt(t):null};w.nestedLayers.push(u);this.readChildNodes(C,u);if(u.name){var z=u.name.split(":");if(z.length>0){u.prefix=z[0];}}},Attribution:function(e,d){d.attribution={};this.readChildNodes(e,d.attribution);},LogoURL:function(e,d){d.logo={width:e.getAttribute("width"),height:e.getAttribute("height")};this.readChildNodes(e,d.logo);},Style:function(e,g){var f={};g.styles.push(f);this.readChildNodes(e,f);},LegendURL:function(e,g){var f={width:e.getAttribute("width"),height:e.getAttribute("height")};g.legend=f;this.readChildNodes(e,f);},MetadataURL:function(f,e){var g={type:f.getAttribute("type")};e.metadataURLs.push(g);this.readChildNodes(f,g);},DataURL:function(e,d){d.dataURL={};this.readChildNodes(e,d.dataURL);},FeatureListURL:function(e,d){d.featureListURL={};this.readChildNodes(e,d.featureListURL);},AuthorityURL:function(f,h){var g=f.getAttribute("name");var j={};this.readChildNodes(f,j);h.authorityURLs[g]=j.href;},Identifier:function(f,g){var e=f.getAttribute("authority");g.identifiers[e]=this.getChildValue(f);},KeywordList:function(e,d){this.readChildNodes(e,d);},SRS:function(e,d){d.srs[this.getChildValue(e)]=true;}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(e,d){this.readChildNodes(e,d);},Keyword:function(e,d){if(d.keywords){d.keywords.push(this.getChildValue(e));}},DescribeLayer:function(e,d){d.describelayer={formats:[]};this.readChildNodes(e,d.describelayer);},GetLegendGraphic:function(e,d){d.getlegendgraphic={formats:[]};this.readChildNodes(e,d.getlegendgraphic);},GetStyles:function(e,d){d.getstyles={formats:[]};this.readChildNodes(e,d.getstyles);},PutStyles:function(e,d){d.putstyles={formats:[]};this.readChildNodes(e,d.putstyles);},UserDefinedSymbolization:function(f,e){var g={supportSLD:parseInt(f.getAttribute("SupportSLD"))==1,userLayer:parseInt(f.getAttribute("UserLayer"))==1,userStyle:parseInt(f.getAttribute("UserStyle"))==1,remoteWFS:parseInt(f.getAttribute("RemoteWFS"))==1};e.userSymbols=g;},LatLonBoundingBox:function(e,d){d.llbbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))];},BoundingBox:function(f,e){var g=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[f,e]);g.srs=f.getAttribute("SRS");e.bbox[g.srs]=g;},ScaleHint:function(m,l){var o=m.getAttribute("min");var j=m.getAttribute("max");var q=Math.pow(2,0.5);var h=OpenLayers.INCHES_PER_UNIT.m;l.maxScale=parseFloat(((o/q)*h*OpenLayers.DOTS_PER_INCH).toPrecision(13));l.minScale=parseFloat(((j/q)*h*OpenLayers.DOTS_PER_INCH).toPrecision(13));},Dimension:function(f,h){var g=f.getAttribute("name").toLowerCase();var j={name:g,units:f.getAttribute("units"),unitsymbol:f.getAttribute("unitSymbol")};h.dimensions[j.name]=j;},Extent:function(l,j){var g=l.getAttribute("name").toLowerCase();if(g in j.dimensions){var m=j.dimensions[g];m.nearestVal=l.getAttribute("nearestValue")==="1";m.multipleVal=l.getAttribute("multipleValues")==="1";m.current=l.getAttribute("current")==="1";m["default"]=l.getAttribute("default")||"";var h=this.getChildValue(l);m.values=h.split(",");}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",initialize:function(b){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[b]);},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(m,l){var o=this.getChildValue(m);var h=o.split(/ +/);for(var q=0,j=h.length;q<j;q++){l.srs[h[q]]=true;}}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",initialize:function(b){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[b]);},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,d){d.srs[this.getChildValue(e)]=true;}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(e,d){this.readChildNodes(e,d);},LayerLimit:function(e,d){d.layerLimit=parseInt(this.getChildValue(e));},MaxWidth:function(e,d){d.maxWidth=parseInt(this.getChildValue(e));},MaxHeight:function(e,d){d.maxHeight=parseInt(this.getChildValue(e));},BoundingBox:function(f,e){var g=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[f,e]);
g.srs=f.getAttribute("CRS");e.bbox[g.srs]=g;},CRS:function(e,d){this.readers.wms.SRS.apply(this,[e,d]);},EX_GeographicBoundingBox:function(e,d){d.llbbox=[];this.readChildNodes(e,d.llbbox);},westBoundLongitude:function(e,d){d[0]=this.getChildValue(e);},eastBoundLongitude:function(e,d){d[2]=this.getChildValue(e);},southBoundLatitude:function(e,d){d[1]=this.getChildValue(e);},northBoundLatitude:function(e,d){d[3]=this.getChildValue(e);},MinScaleDenominator:function(e,d){d.maxScale=parseFloat(this.getChildValue(e)).toPrecision(16);},MaxScaleDenominator:function(e,d){d.minScale=parseFloat(this.getChildValue(e)).toPrecision(16);},Dimension:function(f,h){var g=f.getAttribute("name").toLowerCase();var j={name:g,units:f.getAttribute("units"),unitsymbol:f.getAttribute("unitSymbol"),nearestVal:f.getAttribute("nearestValue")==="1",multipleVal:f.getAttribute("multipleValues")==="1","default":f.getAttribute("default")||"",current:f.getAttribute("current")==="1",values:this.getChildValue(f).split(",")};h.dimensions[j.name]=j;},Keyword:function(e,g){var f={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};if(g.keywords){g.keywords.push(f);}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(e,d){this.readers.wms.UserDefinedSymbolization.apply(this,[e,d]);d.userSymbols.inlineFeature=parseInt(e.getAttribute("InlineFeature"))==1;d.userSymbols.remoteWCS=parseInt(e.getAttribute("RemoteWCS"))==1;},DescribeLayer:function(e,d){this.readers.wms.DescribeLayer.apply(this,[e,d]);},GetLegendGraphic:function(e,d){this.readers.wms.GetLegendGraphic.apply(this,[e,d]);}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:false,initialize:function(d,e){OpenLayers.Control.prototype.initialize.apply(this,[e]);this.element=OpenLayers.Util.getElement(d);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.element=document.createElement("div");this.div.appendChild(this.element);}this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div;},updateScale:function(){var g;if(this.geodesic===true){var f=this.map.getUnits();if(!f){return;}var e=OpenLayers.INCHES_PER_UNIT;g=(this.map.getGeodesicPixelSize().w||0.000001)*e.km*OpenLayers.DOTS_PER_INCH;}else{g=this.map.getScale();}if(!g){return;}if(g>=9500&&g<=950000){g=Math.round(g/1000)+"K";}else{if(g>=950000){g=Math.round(g/1000000)+"M";}else{g=Math.round(g);}}this.element.innerHTML=OpenLayers.i18n("scale",{scaleDenom:g});},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],multi:false,featureAdded:function(){},handlerOptions:null,initialize:function(f,j,g){this.EVENT_TYPES=OpenLayers.Control.DrawFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[g]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(a,b){this.layer.events.triggerEvent("sketchmodified",{vertex:a,feature:b});},create:function(a,b){this.layer.events.triggerEvent("sketchstarted",{vertex:a,feature:b});}},this.callbacks);this.layer=f;this.handlerOptions=this.handlerOptions||{};if(!("multi" in this.handlerOptions)){this.handlerOptions.multi=this.multi;}var h=this.layer.styleMap&&this.layer.styleMap.styles.temporary;if(h){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":h})});}this.handler=new j(this,this.callbacks,this.handlerOptions);},drawFeature:function(g){var f=new OpenLayers.Feature.Vector(g);var e=this.layer.events.triggerEvent("sketchcomplete",{feature:f});if(e!==false){f.state=OpenLayers.State.INSERT;this.layer.addFeatures([f]);this.featureAdded(f);this.events.triggerEvent("featureadded",{feature:f});}},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(b){this.symbolizer={};OpenLayers.Util.extend(this,b);if(this.symbolizers){delete this.symbolizer;}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");},destroy:function(){for(var b in this.symbolizer){this.symbolizer[b]=null;}this.symbolizer=null;delete this.symbolizers;},evaluate:function(j){var f=this.getContext(j);var g=true;if(this.minScaleDenominator||this.maxScaleDenominator){var h=j.layer.map.getScale();}if(this.minScaleDenominator){g=h>=OpenLayers.Style.createLiteral(this.minScaleDenominator,f);}if(g&&this.maxScaleDenominator){g=h<OpenLayers.Style.createLiteral(this.maxScaleDenominator,f);}if(g&&this.filter){if(this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"){g=this.filter.evaluate(j);}else{g=this.filter.evaluate(f);}}return g;},getContext:function(d){var e=this.context;if(!e){e=d.attributes||d.data;}if(typeof this.context=="function"){e=this.context(d);}return e;},clone:function(){var h=OpenLayers.Util.extend({},this);if(this.symbolizers){var j=this.symbolizers.length;h.symbolizers=new Array(j);for(var o=0;o<j;++o){h.symbolizers[o]=this.symbolizers[o].clone();}}else{h.symbolizer={};var l,m;for(var q in this.symbolizer){l=this.symbolizer[q];m=typeof l;if(m==="object"){h.symbolizer[q]=OpenLayers.Util.extend({},l);}else{if(m==="string"){h.symbolizer[q]=l;}}}}h.filter=this.filter&&this.filter.clone();h.context=this.context&&OpenLayers.Util.extend({},this.context);return new OpenLayers.Rule(h);},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,initialize:function(g,e,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);},mousemove:function(b){if(this.passesTolerance(b.xy)){this.clearTimer();this.callback("move",[b]);this.px=b.xy;b=OpenLayers.Util.extend({},b);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,b),this.delay);}return !this.stopMove;},mouseout:function(b){if(OpenLayers.Util.mouseLeft(b,this.map.div)){this.clearTimer();this.callback("move",[b]);}return true;},passesTolerance:function(e){var g=true;if(this.pixelTolerance&&this.px){var f=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));if(f<this.pixelTolerance){g=false;}}return g;},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null;}},delayedCall:function(b){this.callback("pause",[b]);},deactivate:function(){var b=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();b=true;}return b;},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.MouseDefaults=OpenLayers.Class(OpenLayers.Control,{performedDrag:false,wheelObserver:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){if(this.handler){this.handler.destroy();}this.handler=null;this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver);OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver);this.wheelObserver=null;OpenLayers.Control.prototype.destroy.apply(this,arguments);},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});
this.registerWheelEvents();},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver);OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver);},defaultClick:function(d){if(!OpenLayers.Event.isLeftClick(d)){return;}var e=!this.performedDrag;this.performedDrag=false;return e;},defaultDblClick:function(d){var e=this.map.getLonLatFromViewPortPx(d.xy);this.map.setCenter(e,this.map.zoom+1);OpenLayers.Event.stop(d);return false;},defaultMouseDown:function(b){if(!OpenLayers.Event.isLeftClick(b)){return;}this.mouseDragStart=b.xy.clone();this.performedDrag=false;if(b.shiftKey){this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);}document.onselectstart=OpenLayers.Function.False;OpenLayers.Event.stop(b);},defaultMouseMove:function(m){this.mousePosition=m.xy.clone();if(this.mouseDragStart!=null){if(this.zoomBox){var o=Math.abs(this.mouseDragStart.x-m.xy.x);var h=Math.abs(this.mouseDragStart.y-m.xy.y);this.zoomBox.style.width=Math.max(1,o)+"px";this.zoomBox.style.height=Math.max(1,h)+"px";if(m.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=m.xy.x+"px";}if(m.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=m.xy.y+"px";}}else{var o=this.mouseDragStart.x-m.xy.x;var h=this.mouseDragStart.y-m.xy.y;var l=this.map.getSize();var j=new OpenLayers.Pixel(l.w/2+o,l.h/2+h);var q=this.map.getLonLatFromViewPortPx(j);this.map.setCenter(q,null,true);this.mouseDragStart=m.xy.clone();this.map.div.style.cursor="move";}this.performedDrag=true;}},defaultMouseUp:function(b){if(!OpenLayers.Event.isLeftClick(b)){return;}if(this.zoomBox){this.zoomBoxEnd(b);}else{if(this.performedDrag){this.map.setCenter(this.map.center);}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor="";},defaultMouseOut:function(b){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(b,this.map.div)){if(this.zoomBox){this.removeZoomBox();}this.mouseDragStart=null;}},defaultWheelUp:function(b){if(this.map.getZoom()<=this.map.getNumZoomLevels()){this.map.setCenter(this.map.getLonLatFromPixel(b.xy),this.map.getZoom()+1);}},defaultWheelDown:function(b){if(this.map.getZoom()>0){this.map.setCenter(this.map.getLonLatFromPixel(b.xy),this.map.getZoom()-1);}},zoomBoxEnd:function(l){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-l.xy.x)>5||Math.abs(this.mouseDragStart.y-l.xy.y)>5){var o=this.map.getLonLatFromViewPortPx(this.mouseDragStart);var m=this.map.getLonLatFromViewPortPx(l.xy);var q=Math.max(o.lat,m.lat);var u=Math.min(o.lat,m.lat);var r=Math.min(o.lon,m.lon);var t=Math.max(o.lon,m.lon);var s=new OpenLayers.Bounds(r,u,t,q);this.map.zoomToExtent(s);}else{var m=this.map.getLonLatFromViewPortPx(l.xy);this.map.setCenter(new OpenLayers.LonLat((m.lon),(m.lat)),this.map.getZoom()+1);}this.removeZoomBox();}},removeZoomBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;},onWheelEvent:function(j){var e=false;var g=OpenLayers.Event.element(j);while(g!=null){if(this.map&&g==this.map.div){e=true;break;}g=g.parentNode;}if(e){var h=0;if(!j){j=window.event;}if(j.wheelDelta){h=j.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){h=-h;}}else{if(j.detail){h=-j.detail/3;}}if(h){j.xy=this.mousePosition;if(h<0){this.defaultWheelDown(j);}else{this.defaultWheelUp(j);}}OpenLayers.Event.stop(j);}},CLASS_NAME:"OpenLayers.Control.MouseDefaults"});OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,arguments);},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments);},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.map.events.register("mousemove",this,this.redraw);this.map.events.register("mouseout",this,this.reset);this.redraw();return true;}else{return false;}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("mousemove",this,this.redraw);this.map.events.unregister("mouseout",this,this.reset);this.element.innerHTML="";return true;}else{return false;}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.left="";this.div.top="";this.element=this.div;}return this.div;},redraw:function(f){var g;if(f==null){this.reset();return;}else{if(this.lastXy==null||Math.abs(f.xy.x-this.lastXy.x)>this.granularity||Math.abs(f.xy.y-this.lastXy.y)>this.granularity){this.lastXy=f.xy;return;}g=this.map.getLonLatFromPixel(f.xy);if(!g){return;}if(this.displayProjection){g.transform(this.map.getProjectionObject(),this.displayProjection);}this.lastXy=f.xy;}var e=this.formatOutput(g);if(e!=this.element.innerHTML){this.element.innerHTML=e;}},reset:function(b){if(this.emptyString!=null){this.element.innerHTML=this.emptyString;}},formatOutput:function(e){var g=parseInt(this.numDigits);var f=this.prefix+e.lon.toFixed(g)+this.separator+e.lat.toFixed(g)+this.suffix;return f;},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:false,irregular:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(g,e,f){if(!(f&&f.layerOptions&&f.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{});}OpenLayers.Handler.prototype.initialize.apply(this,[g,e,f]);this.options=(f)?f:{};},setOptions:function(b){OpenLayers.Util.extend(this.options,b);OpenLayers.Util.extend(this,b);},activate:function(){var e=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var d=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,d);this.map.addLayer(this.layer);e=true;}return e;},deactivate:function(){var b=false;if(OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel();}if(this.layer.map!=null){this.layer.destroy(false);if(this.feature){this.feature.destroy();}}this.layer=null;this.feature=null;b=true;}return b;},down:function(e){this.fixedRadius=!!(this.radius);var d=this.map.getLonLatFromPixel(e.xy);this.origin=new OpenLayers.Geometry.Point(d.lon,d.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution();}if(this.persist){this.clear();}this.feature=new OpenLayers.Feature.Vector();this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:true});this.layer.drawFeature(this.feature,this.style);},move:function(s){var o=this.map.getLonLatFromPixel(s.xy);var l=new OpenLayers.Geometry.Point(o.lon,o.lat);if(this.irregular){var m=Math.sqrt(2)*Math.abs(l.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,m);}else{if(this.fixedRadius){this.origin=l;}else{this.calculateAngle(l,s);this.radius=Math.max(this.map.getResolution()/2,l.distanceTo(this.origin));}}this.modifyGeometry();if(this.irregular){var r=l.x-this.origin.x;var j=l.y-this.origin.y;var q;if(j==0){q=r/(this.radius*Math.sqrt(2));}else{q=r/j;}this.feature.geometry.resize(1,this.origin,q);this.feature.geometry.move(r/2,j/2);}this.layer.drawFeature(this.feature,this.style);},up:function(b){this.finalize();
if(this.start==this.last){this.callback("done",[b.xy]);}},out:function(b){this.finalize();},createGeometry:function(){this.angle=Math.PI*((1/this.sides)-(1/2));if(this.snapAngle){this.angle+=this.snapAngle*(Math.PI/180);}this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle);},modifyGeometry:function(){var h,g;var f=this.feature.geometry.components[0];if(f.components.length!=(this.sides+1)){this.createGeometry();f=this.feature.geometry.components[0];}for(var j=0;j<this.sides;++j){g=f.components[j];h=this.angle+(j*2*Math.PI/this.sides);g.x=this.origin.x+(this.radius*Math.cos(h));g.y=this.origin.y+(this.radius*Math.sin(h));g.clearBounds();}},calculateAngle:function(g,f){var h=Math.atan2(g.y-this.origin.y,g.x-this.origin.x);if(this.snapAngle&&(this.snapToggle&&!f[this.snapToggle])){var j=(Math.PI/180)*this.snapAngle;this.angle=Math.round(h/j)*j;}else{this.angle=h;}},cancel:function(){this.callback("cancel",null);this.finalize();},finalize:function(){this.origin=null;this.radius=this.options.radius;},clear:function(){if(this.layer){this.layer.renderer.clear();this.layer.destroyFeatures();}},callback:function(d,e){if(this.callbacks[d]){this.callbacks[d].apply(this.control,[this.feature.geometry.clone()]);}if(!this.persist&&(d=="done"||d=="cancel")){this.clear();}},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(g){if(!this.supported()){return;}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var j=document.createStyleSheet();var m=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];for(var l=0,h=m.length;l<h;l++){j.addRule("olv\\:"+m[l],"behavior: url(#default#VML); position: absolute; display: inline-block;");}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments);},supported:function(){return !!(document.namespaces);},setExtent:function(s,D){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var B=this.getResolution();var C=(s.left/B)|0;var v=(s.top/B-this.size.h)|0;if(D||!this.offset){this.offset={x:C,y:v};C=0;v=0;}else{C=C-this.offset.x;v=v-this.offset.y;}var q=C+" "+v;this.root.coordorigin=q;var t=[this.root,this.vectorRoot,this.textRoot];var u;for(var z=0,w=t.length;z<w;++z){u=t[z];var r=this.size.w+" "+this.size.h;u.coordsize=r;}this.root.style.flip="y";return true;},setSize:function(o){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);var r=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];var s=this.size.w+"px";var m=this.size.h+"px";var h;for(var q=0,l=r.length;q<l;++q){h=r[q];h.style.width=s;h.style.height=m;}},getNodeType:function(g,e){var f=null;switch(g.CLASS_NAME){case"OpenLayers.Geometry.Point":if(e.externalGraphic){f="olv:rect";}else{if(this.isComplexSymbol(e.graphicName)){f="olv:shape";}else{f="olv:oval";}}break;case"OpenLayers.Geometry.Rectangle":f="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":f="olv:shape";break;default:break;}return f;},setStyle:function(H,K,M,B){K=K||H._style;M=M||H._options;var J=K.fillColor;if(H._geometryClass==="OpenLayers.Geometry.Point"){if(K.externalGraphic){if(K.graphicTitle){H.title=K.graphicTitle;}var I=K.graphicWidth||K.graphicHeight;var z=K.graphicHeight||K.graphicWidth;I=I?I:K.pointRadius*2;z=z?z:K.pointRadius*2;var F=this.getResolution();var D=(K.graphicXOffset!=undefined)?K.graphicXOffset:-(0.5*I);var G=(K.graphicYOffset!=undefined)?K.graphicYOffset:-(0.5*z);H.style.left=(((B.x/F-this.offset.x)+D)|0)+"px";H.style.top=(((B.y/F-this.offset.y)-(G+z))|0)+"px";H.style.width=I+"px";H.style.height=z+"px";H.style.flip="y";J="none";M.isStroked=false;}else{if(this.isComplexSymbol(K.graphicName)){var L=this.importSymbol(K.graphicName);H.path=L.path;H.coordorigin=L.left+","+L.bottom;var N=L.size;H.coordsize=N+","+N;this.drawCircle(H,B,K.pointRadius);H.style.flip="y";}else{this.drawCircle(H,B,K.pointRadius);}}}if(M.isFilled){H.fillcolor=J;}else{H.filled="false";}var C=H.getElementsByTagName("fill");var O=(C.length==0)?null:C[0];if(!M.isFilled){if(O){H.removeChild(O);}}else{if(!O){O=this.createNode("olv:fill",H.id+"_fill");}O.opacity=K.fillOpacity;if(H._geometryClass==="OpenLayers.Geometry.Point"&&K.externalGraphic){if(K.graphicOpacity){O.opacity=K.graphicOpacity;}O.src=K.externalGraphic;O.type="frame";if(!(K.graphicWidth&&K.graphicHeight)){O.aspect="atmost";}}if(O.parentNode!=H){H.appendChild(O);}}var P=K.rotation;if((P!==undefined||H._rotation!==undefined)){H._rotation=P;if(K.externalGraphic){this.graphicRotate(H,D,G,K);O.opacity=0;}else{if(H._geometryClass==="OpenLayers.Geometry.Point"){H.style.rotation=P||0;}}}var E=H.getElementsByTagName("stroke");var w=(E.length==0)?null:E[0];if(!M.isStroked){H.stroked=false;if(w){w.on=false;}}else{if(!w){w=this.createNode("olv:stroke",H.id+"_stroke");H.appendChild(w);}w.on=true;w.color=K.strokeColor;w.weight=K.strokeWidth+"px";w.opacity=K.strokeOpacity;w.endcap=K.strokeLinecap=="butt"?"flat":(K.strokeLinecap||"round");if(K.strokeDashstyle){w.dashstyle=this.dashStyle(K);}}if(K.cursor!="inherit"&&K.cursor!=null){H.style.cursor=K.cursor;}return H;},graphicRotate:function(G,C,P,D){var D=D||G._style;var F=D.rotation||0;var U,K;if(!(D.graphicWidth&&D.graphicHeight)){var B=new Image();B.onreadystatechange=OpenLayers.Function.bind(function(){if(B.readyState=="complete"||B.readyState=="interactive"){U=B.width/B.height;K=Math.max(D.pointRadius*2,D.graphicWidth||0,D.graphicHeight||0);C=C*U;D.graphicWidth=K*U;D.graphicHeight=K;this.graphicRotate(G,C,P,D);}},this);B.src=D.externalGraphic;return;}else{K=Math.max(D.graphicWidth,D.graphicHeight);U=D.graphicWidth/D.graphicHeight;}var H=Math.round(D.graphicWidth||K*U);var J=Math.round(D.graphicHeight||K);G.style.width=H+"px";G.style.height=J+"px";var I=document.getElementById(G.id+"_image");if(!I){I=this.createNode("olv:imagedata",G.id+"_image");G.appendChild(I);}I.style.width=H+"px";I.style.height=J+"px";I.src=D.externalGraphic;I.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var O=F*Math.PI/180;var M=Math.sin(O);var Q=Math.cos(O);var N="progid:DXImageTransform.Microsoft.Matrix(M11="+Q+",M12="+(-M)+",M21="+M+",M22="+Q+",SizingMethod='auto expand')\n";var T=D.graphicOpacity||D.fillOpacity;if(T&&T!=1){N+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+T+")\n";}G.style.filter=N;var E=new OpenLayers.Geometry.Point(-C,-P);var S=new OpenLayers.Bounds(0,0,H,J).toGeometry();S.rotate(D.rotation,E);var L=S.getBounds();G.style.left=Math.round(parseInt(G.style.left)+L.left)+"px";G.style.top=Math.round(parseInt(G.style.top)-L.bottom)+"px";},postDraw:function(f){f.style.visibility="visible";var g=f._style.fillColor;var e=f._style.strokeColor;if(g=="none"&&f.fillcolor!=g){f.fillcolor=g;}if(e=="none"&&f.strokecolor!=e){f.strokecolor=e;}},setNodeDimension:function(g,j){var l=j.getBounds();if(l){var h=this.getResolution();var m=new OpenLayers.Bounds((l.left/h-this.offset.x)|0,(l.bottom/h-this.offset.y)|0,(l.right/h-this.offset.x)|0,(l.top/h-this.offset.y)|0);g.style.left=m.left+"px";g.style.top=m.top+"px";g.style.width=m.getWidth()+"px";g.style.height=m.getHeight()+"px";g.coordorigin=m.left+" "+m.top;g.coordsize=m.getWidth()+" "+m.getHeight();}},dashStyle:function(f){var g=f.strokeDashstyle;switch(g){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return g;default:var e=g.split(/[ ,]/);if(e.length==2){if(1*e[0]>=2*e[1]){return"longdash";}return(e[0]==1||e[1]==1)?"dot":"dash";}else{if(e.length==4){return(1*e[0]>=2*e[1])?"longdashdot":"dashdot";}}return"solid";}},createNode:function(f,g){var e=document.createElement(f);if(g){e.id=g;
}e.unselectable="on";e.onselectstart=OpenLayers.Function.False;return e;},nodeTypeCompare:function(m,g){var l=g;var h=l.indexOf(":");if(h!=-1){l=l.substr(h+1);}var j=m.nodeName;h=j.indexOf(":");if(h!=-1){j=j.substr(h+1);}return(l==j);},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div");},createRoot:function(b){return this.nodeFactory(this.container.id+b,"olv:group");},drawPoint:function(e,d){return this.drawCircle(e,d,1);},drawCircle:function(l,j,h){if(!isNaN(j.x)&&!isNaN(j.y)){var g=this.getResolution();l.style.left=(((j.x/g-this.offset.x)|0)-h)+"px";l.style.top=(((j.y/g-this.offset.y)|0)-h)+"px";var m=h*2;l.style.width=m+"px";l.style.height=m+"px";return l;}return false;},drawLineString:function(e,d){return this.drawLine(e,d,false);},drawLinearRing:function(e,d){return this.drawLine(e,d,true);},drawLine:function(C,r,u){this.setNodeDimension(C,r);var B=this.getResolution();var D=r.components.length;var w=new Array(D);var t,q,s;for(var v=0;v<D;v++){t=r.components[v];q=(t.x/B-this.offset.x)|0;s=(t.y/B-this.offset.y)|0;w[v]=" "+q+","+s+" l ";}var z=(u)?" x e":" e";C.path="m"+w.join("")+z;return C;},drawPolygon:function(E,t){this.setNodeDimension(E,t);var D=this.getResolution();var j=[];var z,B,C,v,F,w,s,u;for(C=0,v=t.components.length;C<v;C++){z=t.components[C];j.push("m");for(B=0,F=z.components.length;B<F;B++){w=z.components[B];s=(w.x/D-this.offset.x)|0;u=(w.y/D-this.offset.y)|0;j.push(" "+s+","+u);if(B==0){j.push(" l");}}j.push(" x ");}j.push("e");E.path=j.join("");return E;},drawRectangle:function(e,g){var f=this.getResolution();e.style.left=((g.x/f-this.offset.x)|0)+"px";e.style.top=((g.y/f-this.offset.y)|0)+"px";e.style.width=((g.width/f)|0)+"px";e.style.height=((g.height/f)|0)+"px";return e;},drawText:function(t,w,o){var q=this.nodeFactory(t+this.LABEL_ID_SUFFIX,"olv:rect");var r=this.nodeFactory(t+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");var u=this.getResolution();q.style.left=((o.x/u-this.offset.x)|0)+"px";q.style.top=((o.y/u-this.offset.y)|0)+"px";q.style.flip="y";r.innerText=w.label;if(w.fontColor){r.style.color=w.fontColor;}if(w.fontOpacity){r.style.filter="alpha(opacity="+(w.fontOpacity*100)+")";}if(w.fontFamily){r.style.fontFamily=w.fontFamily;}if(w.fontSize){r.style.fontSize=w.fontSize;}if(w.fontWeight){r.style.fontWeight=w.fontWeight;}if(w.labelSelect===true){q._featureId=t;r._featureId=t;r._geometry=o;r._geometryClass=o.CLASS_NAME;}r.style.whiteSpace="nowrap";r.inset="1px,0px,0px,0px";if(!q.parentNode){q.appendChild(r);this.textRoot.appendChild(q);}var s=w.labelAlign||"cm";if(s.length==1){s+="m";}var m=r.clientWidth*(OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(0,1)]);var v=r.clientHeight*(OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(1,1)]);q.style.left=parseInt(q.style.left)-m-1+"px";q.style.top=parseInt(q.style.top)+v+"px";},drawSurface:function(w,q){this.setNodeDimension(w,q);var v=this.getResolution();var m=[];var t,o,r;for(var u=0,s=q.components.length;u<s;u++){t=q.components[u];o=(t.x/v-this.offset.x)|0;r=(t.y/v-this.offset.y)|0;if((u%3)==0&&(u/3)==0){m.push("m");}else{if((u%3)==1){m.push(" c");}}m.push(" "+o+","+r);}m.push(" x e");w.path=m.join("");return w;},moveRoot:function(d){var e=this.map.getLayer(d.container.id);if(e instanceof OpenLayers.Layer.Vector.RootContainer){e=this.map.getLayer(this.container.id);}e&&e.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);e&&e.redraw();},importSymbol:function(z){var C=this.container.id+"-"+z;var D=this.symbolCache[C];if(D){return D;}var B=OpenLayers.Renderer.symbol[z];if(!B){throw new Error(z+" is not a valid symbol name");}var r=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var w=["m"];for(var v=0;v<B.length;v=v+2){var t=B[v];var u=B[v+1];r.left=Math.min(r.left,t);r.bottom=Math.min(r.bottom,u);r.right=Math.max(r.right,t);r.top=Math.max(r.top,u);w.push(t);w.push(u);if(v==0){w.push("l");}}w.push("x e");var q=w.join(" ");var s=(r.getWidth()-r.getHeight())/2;if(s>0){r.bottom=r.bottom-s;r.top=r.top+s;}else{r.left=r.left+s;r.right=r.right-s;}D={path:q,size:r.getWidth(),left:r.left,bottom:r.bottom};this.symbolCache[C]=D;return D;},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,arguments);},setMap:function(j){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var m=0,h=this.map.controls.length;m<h;m++){var l=this.map.controls[m];if((l!=this)&&(l.CLASS_NAME=="OpenLayers.Control.ArgParser")){if(l.displayProjection!=this.displayProjection){this.displayProjection=l.displayProjection;}break;}}if(m==this.map.controls.length){var g=OpenLayers.Util.getParameters();if(g.layers){this.layers=g.layers;this.map.events.register("addlayer",this,this.configureLayers);this.configureLayers();}if(g.lat&&g.lon){this.center=new OpenLayers.LonLat(parseFloat(g.lon),parseFloat(g.lat));if(g.zoom){this.zoom=parseInt(g.zoom);}this.map.events.register("changebaselayer",this,this.setCenter);this.setCenter();}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject());}this.map.setCenter(this.center,this.zoom);}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var j=0,g=this.layers.length;j<g;j++){var f=this.map.layers[j];var h=this.layers.charAt(j);if(h=="B"){this.map.setBaseLayer(f);}else{if((h=="T")||(h=="F")){f.setVisibility(h=="T");}}}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.LoadingPanel=OpenLayers.Class(OpenLayers.Control,{counter:0,maximized:false,visible:true,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);},setVisible:function(b){this.visible=b;if(b){OpenLayers.Element.show(this.div);}else{OpenLayers.Element.hide(this.div);}},getVisible:function(){return this.visible;},hide:function(){this.setVisible(false);},show:function(){this.setVisible(true);},toggle:function(){this.setVisible(!this.getVisible());},addLayer:function(b){if(b.layer){b.layer.events.register("loadstart",this,this.increaseCounter);b.layer.events.register("loadend",this,this.decreaseCounter);}},setMap:function(g){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("preaddlayer",this,this.addLayer);for(var e=0;e<this.map.layers.length;e++){var f=this.map.layers[e];f.events.register("loadstart",this,this.increaseCounter);f.events.register("loadend",this,this.decreaseCounter);}},increaseCounter:function(){this.counter++;if(this.counter>0){if(!this.maximized&&this.visible){this.maximizeControl();}}},decreaseCounter:function(){if(this.counter>0){this.counter--;}if(this.counter==0){if(this.maximized&&this.visible){this.minimizeControl();}}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);return this.div;},minimizeControl:function(b){this.div.style.display="none";this.div.style.width="0px";this.div.style.height="0px";this.maximized=false;if(b!=null){OpenLayers.Event.stop(b);}},maximizeControl:function(g){var h=this.map.getSize();var f=h.w;var j=h.h;this.div.style.width=f+"px";this.div.style.height=j+"px";this.div.style.display="block";this.maximized=true;if(g!=null){OpenLayers.Event.stop(g);}},destroy:function(){if(this.map){this.map.events.unregister("preaddlayer",this,this.addLayer);if(this.map.layers){for(var d=0;d<this.map.layers.length;d++){var e=this.map.layers[d];e.events.unregister("loadstart",this,this.increaseCounter);e.events.unregister("loadend",this,this.decreaseCounter);}}}OpenLayers.Control.prototype.destroy.apply(this,arguments);},CLASS_NAME:"OpenLayers.Control.LoadingPanel"});OpenLayers.Control.ScaleBar=OpenLayers.Class(OpenLayers.Control,{element:null,scale:1,displaySystem:"metric",minWidth:100,maxWidth:200,divisions:2,subdivisions:2,showMinorMeasures:false,abbreviateLabel:false,singleLine:false,align:"left",div:null,scaleText:"scale 1:",thousandsSeparator:"",measurementProperties:{english:{units:["miles","feet","inches"],abbr:["mi","ft","in"],inches:[63360,12,1]},metric:{units:["kilometers","meters","centimeters"],abbr:["km","m","cm"],inches:[39370.07874,39.370079,0.393701]}},limitedStyle:false,customStyles:null,defaultStyles:{Bar:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},BarAlt:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMajor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMinor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},NumbersBox:{height:13,width:40,top:24},LabelBox:{height:15,top:-2},LabelBoxSingleLine:{height:15,width:35,top:5,left:10}},appliedStyles:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);
if(!document.styleSheets){this.limitedStyle=true;}if(this.limitedStyle){this.appliedStyles=OpenLayers.Util.extend({},this.defaultStyles);OpenLayers.Util.extend(this.appliedStyles,this.customStyles);}this.element=document.createElement("div");this.element.style.position="relative";this.element.className=this.displayClass+"Wrapper";this.labelContainer=document.createElement("div");this.labelContainer.className=this.displayClass+"Units";this.labelContainer.style.position="absolute";this.graphicsContainer=document.createElement("div");this.graphicsContainer.style.position="absolute";this.graphicsContainer.className=this.displayClass+"Graphics";this.numbersContainer=document.createElement("div");this.numbersContainer.style.position="absolute";this.numbersContainer.className=this.displayClass+"Numbers";this.element.appendChild(this.graphicsContainer);this.element.appendChild(this.labelContainer);this.element.appendChild(this.numbersContainer);},destroy:function(){this.map.events.unregister("moveend",this,this.onMoveend);this.div.innerHTML="";OpenLayers.Control.prototype.destroy.apply(this);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.dxMarkerMajor=(this.styleValue("MarkerMajor","borderLeftWidth")+this.styleValue("MarkerMajor","width")+this.styleValue("MarkerMajor","borderRightWidth"))/2;this.dxMarkerMinor=(this.styleValue("MarkerMinor","borderLeftWidth")+this.styleValue("MarkerMinor","width")+this.styleValue("MarkerMinor","borderRightWidth"))/2;this.dxBar=(this.styleValue("Bar","borderLeftWidth")+this.styleValue("Bar","borderRightWidth"))/2;this.dxBarAlt=(this.styleValue("BarAlt","borderLeftWidth")+this.styleValue("BarAlt","borderRightWidth"))/2;this.dxNumbersBox=this.styleValue("NumbersBox","width")/2;var h=["Bar","BarAlt","MarkerMajor","MarkerMinor"];if(this.singleLine){h.push("LabelBoxSingleLine");}else{h.push("NumbersBox","LabelBox");}var g=0;for(var j=0;j<h.length;++j){var f=h[j];g=Math.max(g,this.styleValue(f,"top")+this.styleValue(f,"height"));}this.element.style.height=g+"px";this.xOffsetSingleLine=this.styleValue("LabelBoxSingleLine","width")+this.styleValue("LabelBoxSingleLine","left");this.div.appendChild(this.element);this.map.events.register("moveend",this,this.onMoveend);this.update();return this.div;},onMoveend:function(){this.update();},update:function(D){if(this.map.baseLayer==null||!this.map.getScale()){return;}this.scale=(D!=undefined)?D:this.map.getScale();this.element.title=this.scaleText+OpenLayers.Number.format(this.scale);this.element.style.width=this.maxWidth+"px";var w=this.getComp();this.setSubProps(w);this.labelContainer.innerHTML="";this.graphicsContainer.innerHTML="";this.numbersContainer.innerHTML="";var E=this.divisions*this.subdivisions;var v={left:0+(this.singleLine?0:this.dxNumbersBox),center:(this.maxWidth/2)-(E*this.subProps.pixels/2)-(this.singleLine?this.xOffsetSingleLine/2:0),right:this.maxWidth-(E*this.subProps.pixels)-(this.singleLine?this.xOffsetSingleLine:this.dxNumbersBox)};var z,H,C,s,F;for(var u=0;u<this.divisions;++u){z=u*this.subdivisions*this.subProps.pixels+v[this.align];this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",z-this.dxMarkerMajor));if(!this.singleLine){H=(u==0)?0:OpenLayers.Number.format((u*this.subdivisions)*this.subProps.length,this.subProps.dec,this.thousandsSeparator);this.numbersContainer.appendChild(this.createElement("NumbersBox",H,z-this.dxNumbersBox));}for(var B=0;B<this.subdivisions;++B){if((B%2)==0){s="Bar";F=z-this.dxBar;}else{s="BarAlt";F=z-this.dxBarAlt;}this.graphicsContainer.appendChild(this.createElement(s," ",F,this.subProps.pixels));if(B<this.subdivisions-1){C=(u*this.subdivisions)+B+1;z=C*this.subProps.pixels+v[this.align];this.graphicsContainer.appendChild(this.createElement("MarkerMinor"," ",z-this.dxMarkerMinor));if(this.showMinorMeasures&&!this.singleLine){H=C*this.subProps.length;this.numbersContainer.appendChild(this.createElement("NumbersBox",H,z-this.dxNumbersBox));}}}}z=E*this.subProps.pixels;z+=v[this.align];this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",z-this.dxMarkerMajor));H=OpenLayers.Number.format(E*this.subProps.length,this.subProps.dec,this.thousandsSeparator);if(!this.singleLine){this.numbersContainer.appendChild(this.createElement("NumbersBox",H,z-this.dxNumbersBox));}var t=document.createElement("div");t.style.position="absolute";var G;if(this.singleLine){G=H;t.className=this.displayClass+"LabelBoxSingleLine";t.style.left=Math.round(z+this.styleValue("LabelBoxSingleLine","left"))+"px";}else{G="";t.className=this.displayClass+"LabelBox";t.style.textAlign="center";t.style.width=Math.round(E*this.subProps.pixels)+"px";t.style.left=Math.round(v[this.align])+"px";t.style.overflow="hidden";}if(this.abbreviateLabel){G+=" "+this.subProps.abbr;}else{G+=" "+this.subProps.units;}t.appendChild(document.createTextNode(G));this.labelContainer.appendChild(t);},createElement:function(h,j,l,m){var g=document.createElement("div");g.className=this.displayClass+h;OpenLayers.Util.extend(g.style,{position:"absolute",textAlign:"center",overflow:"hidden",left:Math.round(l)+"px"});g.appendChild(document.createTextNode(j));if(m){g.style.width=Math.round(m)+"px";}return g;},getComp:function(){var O=this.measurementProperties[this.displaySystem];var I=O.units.length;var E=new Array(I);var F=this.divisions*this.subdivisions;for(var G=0;G<I;++G){E[G]={};var N=OpenLayers.DOTS_PER_INCH*O.inches[G]/this.scale;var D=((this.minWidth-this.dxNumbersBox)/N)/F;var S=((this.maxWidth-this.dxNumbersBox)/N)/F;for(var C=0;C<F;++C){var M=D*(C+1);var P=S*(C+1);var K=this.getHandsomeNumber(M,P);var L={value:(K.value/(C+1)),score:0,tie:0,dec:0,displayed:0};for(var B=0;B<F;++B){var z=K.value*(B+1)/(C+1);var Q=this.getHandsomeNumber(z,z);var H=((B+1)%this.subdivisions==0);var J=((B+1)==F);if((this.singleLine&&J)||(!this.singleLine&&(H||this.showMinorMeasures))){L.score+=Q.score;L.tie+=Q.tie;L.dec=Math.max(L.dec,Q.dec);L.displayed+=1;}else{L.score+=Q.score/this.subdivisions;L.tie+=Q.tie/this.subdivisions;}}L.score*=(G+1)*L.tie/L.displayed;E[G][C]=L;}}return E;},setSubProps:function(l){var s=this.measurementProperties[this.displaySystem];var o=Number.POSITIVE_INFINITY;var r=Number.POSITIVE_INFINITY;for(var t=0;t<l.length;++t){var m=OpenLayers.DOTS_PER_INCH*s.inches[t]/this.scale;for(var q in l[t]){var u=l[t][q];if((u.score<o)||((u.score==o)&&(u.tie<r))){this.subProps={length:u.value,pixels:m*u.value,units:s.units[t],abbr:s.abbr[t],dec:u.dec};o=u.score;r=u.tie;}}}},styleValue:function(w,o){var q=0;if(this.limitedStyle){q=this.appliedStyles[w][o];}else{w="."+this.displayClass+w;rules:for(var t=document.styleSheets.length-1;t>=0;--t){var s=document.styleSheets[t];if(!s.disabled){var m;try{if(typeof(s.cssRules)=="undefined"){if(typeof(s.rules)=="undefined"){continue;}else{m=s.rules;}}else{m=s.cssRules;}}catch(v){continue;}for(var u=0;u<m.length;++u){var r=m[u];if(r.selectorText&&(r.selectorText.toLowerCase()==w.toLowerCase())){if(r.style[o]!=""){q=parseInt(r.style[o]);break rules;}}}}}}return q?q:0;},getHandsomeNumber:function(w,B,E){E=(E==null)?10:E;var v={value:w,score:Number.POSITIVE_INFINITY,tie:Number.POSITIVE_INFINITY,dec:3};var t,u,C,z,s,F,D;for(var G=0;G<3;++G){t=Math.pow(2,(-1*G));u=Math.floor(Math.log(B/t)/Math.LN10);for(var H=u;H>(u-E+1);--H){C=Math.max(G-H,0);z=t*Math.pow(10,H);if((z*Math.floor(B/z))>=w){if(w%z==0){s=w/z;}else{s=Math.floor(w/z)+1;}F=s+(2*G);D=(H<0)?(Math.abs(H)+1):H;if((F<v.score)||((F==v.score)&&(D<v.tie))){v.value=parseFloat((z*s).toFixed(C));v.score=F;v.tie=D;v.dec=C;}}}}return v;},CLASS_NAME:"OpenLayers.Control.ScaleBar"});OpenLayers.Format.CSWGetRecords.v2_0_2_GeoNetwork=OpenLayers.Class(OpenLayers.Format.CSWGetRecords.v2_0_2,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",ows:"http://www.opengis.net/ows",geonet:"http://www.fao.org/geonetwork"},initialize:function(b){OpenLayers.Format.CSWGetRecords.v2_0_2.prototype.initialize.apply(this,[b]);
},readers:{csw:{GetRecordsResponse:function(e,g){g.records=[];this.readChildNodes(e,g);var f=this.getAttributeNS(e,"","version");if(f!=""){g.version=f;}},RequestId:function(e,d){d.RequestId=this.getChildValue(e);},SearchStatus:function(f,g){g.SearchStatus={};var e=this.getAttributeNS(f,"","timestamp");if(e!=""){g.SearchStatus.timestamp=e;}},SearchResults:function(o,m){this.readChildNodes(o,m);var h=o.attributes;var l={};for(var q=0,j=h.length;q<j;++q){if((h[q].name=="numberOfRecordsMatched")||(h[q].name=="numberOfRecordsReturned")||(h[q].name=="nextRecord")){l[h[q].name]=parseInt(h[q].nodeValue);}else{l[h[q].name]=h[q].nodeValue;}}m.SearchResults=l;},SummaryRecord:function(e,g){var f={type:"SummaryRecord"};this.readChildNodes(e,f);g.records.push(f);},BriefRecord:function(e,g){var f={type:"BriefRecord"};this.readChildNodes(e,f);g.records.push(f);},DCMIRecord:function(e,g){var f={type:"DCMIRecord"};this.readChildNodes(e,f);g.records.push(f);},Record:function(e,g){var f={type:"Record"};this.readChildNodes(e,f);g.records.push(f);},"*":function(g,h){var j=g.localName;if(!(h.geonet_info[j] instanceof Array)){h.geonet_info[j]=new Array();}var f=this.getChildValue(g);h.geonet_info[j].push(f);}},dc:{"*":function(o,m){var r=o.localName||o.nodeName.split(":").pop();if(!(m[r] instanceof Array)){m[r]=new Array();}var s={};var j=o.attributes;for(var q=0,l=j.length;q<l;++q){s[j[q].name]=j[q].nodeValue;}s.value=this.getChildValue(o);m[r].push(s);}},dct:{"*":function(e,g){var f=e.localName||e.nodeName.split(":").pop();if(!(g[f] instanceof Array)){g[f]=new Array();}g[f].push(this.getChildValue(e));}},geonet:{info:function(e,d){if(!(d.geonet_info instanceof Array)){d.geonet_info=new Array();}this.readChildNodes(e,d);}},ows:{WGS84BoundingBox:function(q,o){if(!(o.BoundingBox instanceof Array)){o.BoundingBox=new Array();}var r=this.getChildValue(this.getElementsByTagNameNS(q,this.namespaces.ows,"LowerCorner")[0]).split(" ",2);var l=this.getChildValue(this.getElementsByTagNameNS(q,this.namespaces.ows,"UpperCorner")[0]).split(" ",2);var t={value:[parseFloat(r[0]),parseFloat(r[1]),parseFloat(l[0]),parseFloat(l[1])]};var u=q.attributes;for(var s=0,m=u.length;s<m;++s){t[u[s].name]=u[s].nodeValue;}o.BoundingBox.push(t);},BoundingBox:function(e,d){this.readers.ows.WGS84BoundingBox.apply(this,[e,d]);}}},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2_GeoNetwork"});OpenLayers.Format.GeoNetworkRecords=OpenLayers.Class(OpenLayers.Format.XML,{defaultPrefix:"nons",namespaces:{nons:"",geonet:"http://www.fao.org/geonetwork"},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e]);}if(e&&e.nodeType==9){e=e.documentElement;}var d={};this.readNode(e,d);return d;},readers:{nons:{response:function(g,f){f.records=[];this.readChildNodes(g,f);var h=this.getAttributeNS(g,"","from");if(h!=""){f.from=h;}var j=this.getAttributeNS(g,"","to");if(j!=""){f.to=j;}},summary:function(l,j){j.summary={};var g=l.attributes;for(var m=0,h=g.length;m<h;++m){j.summary[g[m].name]=g[m].nodeValue;}this.readChildNodes(l,j.summary);},metadata:function(e,g){var f={type:"metadata"};this.readChildNodes(e,f);g.records.push(f);},geoBox:function(u,s){if(!(s.BoundingBox instanceof Array)){s.BoundingBox=new Array();}var e,o,r,v;if(u.firstChild.nodeValue&&u.firstChild.nodeValue.indexOf("|")){var q=u.firstChild.nodeValue.split("|");o=q[0];e=q[1];r=q[2];v=q[3];}else{for(var w=u.firstChild;w;w=w.nextSibling){switch(w.nodeName){case"southBL":e=this.getChildValue(w);break;case"westBL":o=this.getChildValue(w);break;case"eastBL":r=this.getChildValue(w);break;case"northBL":v=this.getChildValue(w);break;}}}var t={value:[parseFloat(o),parseFloat(e),parseFloat(r),parseFloat(v)]};s.BoundingBox.push(t);},"*":function(s,o){var u=s.localName||s.nodeName.split(":").pop();var q=s.parentNode.localName||s.parentNode.nodeName.split(":").pop();var r={};r.value=this.getChildValue(s);if(q=="info"){if(!(o.geonet_info[u] instanceof Array)){o.geonet_info[u]=new Array();}o.geonet_info[u].push(r);if(u=="harvestInfo"||u=="valid_details"){this.readChildNodes(s,o.geonet_info[u]);}}else{if(!(o[u] instanceof Array)){o[u]=new Array();}var l=s.attributes;for(var t=0,m=l.length;t<m;++t){r[l[t].name]=l[t].nodeValue;}o[u].push(r);this.readChildNodes(s,o[u]);}}},geonet:{info:function(e,d){if(!(d.geonet_info instanceof Array)){d.geonet_info=new Array();}this.readChildNodes(e,d);}}},CLASS_NAME:"OpenLayers.Format.GeoNetworkRecords"});(function(){var b=function(e,a){return function(d){if(a&&a[e]){a[e].call(a.scope||window,{responseText:d.responseText,responseXML:d.responseXML,argument:a.argument});}};};Ext.apply(Ext.lib.Ajax,{request:function(j,m,a,l,q){q=q||{};j=j||q.method;var o=q.headers;if(q.xmlData){if(!o||!o["Content-Type"]){o=o||{};o["Content-Type"]="text/xml";}j=j||"POST";l=q.xmlData;}else{if(q.jsonData){if(!o||!o["Content-Type"]){o=o||{};o["Content-Type"]="application/json";}j=j||"POST";l=typeof q.jsonData=="object"?Ext.encode(q.jsonData):q.jsonData;}}if((j&&j.toLowerCase()=="post")&&(q.form||q.params)&&(!o||!o["Content-Type"])){o=o||{};o["Content-Type"]="application/x-www-form-urlencoded";}return OpenLayers.Request.issue({success:b("success",a),failure:b("failure",a),method:j,headers:o,data:l,url:m});},isCallInProgress:function(a){return true;},abort:function(a){a.abort();}});})();Ext.namespace("GeoExt");GeoExt.singleFile=true;(function(){var v=(typeof GeoExt=="object"&&GeoExt.singleFile);var F=v?"GeoExt.js":"lib/GeoExt.js";var u=function(){var a="";var g=document.documentElement.getElementsByTagName("script");for(var d=0,f=g.length;d<f;d++){var j=g[d].getAttribute("src");if(j){var e=j.lastIndexOf(F);var b=j.lastIndexOf("?");if(b<0){b=j.length;}if((e>-1)&&(e+F.length==b)){a=j.slice(0,b-F.length);break;}}}return a;};if(!v){var t=new Array("GeoExt/data/AttributeReader.js","GeoExt/data/AttributeStore.js","GeoExt/data/FeatureRecord.js","GeoExt/data/FeatureReader.js","GeoExt/data/FeatureStore.js","GeoExt/data/LayerRecord.js","GeoExt/data/LayerReader.js","GeoExt/data/LayerStore.js","GeoExt/data/ScaleStore.js","GeoExt/data/WMSCapabilitiesReader.js","GeoExt/data/WMSCapabilitiesStore.js","GeoExt/data/WFSCapabilitiesReader.js","GeoExt/data/WFSCapabilitiesStore.js","GeoExt/data/WMSDescribeLayerReader.js","GeoExt/data/WMSDescribeLayerStore.js","GeoExt/data/WMCReader.js","GeoExt/widgets/Action.js","GeoExt/data/ProtocolProxy.js","GeoExt/widgets/FeatureRenderer.js","GeoExt/widgets/MapPanel.js","GeoExt/widgets/Popup.js","GeoExt/widgets/form.js","GeoExt/widgets/form/SearchAction.js","GeoExt/widgets/form/BasicForm.js","GeoExt/widgets/form/FormPanel.js","GeoExt/widgets/tips/SliderTip.js","GeoExt/widgets/tips/LayerOpacitySliderTip.js","GeoExt/widgets/tips/ZoomSliderTip.js","GeoExt/widgets/tree/LayerNode.js","GeoExt/widgets/tree/TreeNodeUIEventMixin.js","GeoExt/plugins/TreeNodeComponent.js","GeoExt/plugins/TreeNodeRadioButton.js","GeoExt/widgets/tree/LayerLoader.js","GeoExt/widgets/tree/LayerContainer.js","GeoExt/widgets/tree/BaseLayerContainer.js","GeoExt/widgets/tree/OverlayLayerContainer.js","GeoExt/widgets/tree/LayerParamNode.js","GeoExt/widgets/tree/LayerParamLoader.js","GeoExt/widgets/tree/WMSCapabilitiesLoader.js","GeoExt/widgets/LayerOpacitySlider.js","GeoExt/widgets/LayerLegend.js","GeoExt/widgets/LegendImage.js","GeoExt/widgets/UrlLegend.js","GeoExt/widgets/WMSLegend.js","GeoExt/widgets/VectorLegend.js","GeoExt/widgets/LegendPanel.js","GeoExt/widgets/ZoomSlider.js","GeoExt/widgets/grid/FeatureSelectionModel.js","GeoExt/data/PrintPage.js","GeoExt/data/PrintProvider.js","GeoExt/plugins/PrintPageField.js","GeoExt/plugins/PrintProviderField.js","GeoExt/plugins/PrintExtent.js","GeoExt/plugins/AttributeForm.js","GeoExt/widgets/PrintMapPanel.js","GeoExt/state/PermalinkProvider.js");var D=navigator.userAgent;var B=(D.match("MSIE")||D.match("Safari"));if(B){var E=new Array(t.length);}var s=u()+"lib/";for(var C=0,w=t.length;C<w;C++){if(B){E[C]="<script src='"+s+t[C]+"'><\/script>";
}else{var h=document.createElement("script");h.src=s+t[C];var z=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;z.appendChild(h);}}if(B){document.write(E.join(""));}}})();Ext.namespace("GeoExt.data");GeoExt.data.AttributeReader=function(e,d){e=e||{};if(!e.format){e.format=new OpenLayers.Format.WFSDescribeFeatureType();}GeoExt.data.AttributeReader.superclass.constructor.call(this,e,d||e.fields);if(e.feature){this.recordType.prototype.fields.add(new Ext.data.Field("value"));}};Ext.extend(GeoExt.data.AttributeReader,Ext.data.DataReader,{read:function(e){var d=e.responseXML;if(!d||!d.documentElement){d=e.responseText;}return this.readRecords(d);},readRecords:function(C){var F;if(C instanceof Array){F=C;}else{F=this.meta.format.read(C).featureTypes[0].properties;}var K=this.meta.feature;var H=this.recordType;var z=H.prototype.fields;var E=z.length;var j,L,J,B,N,M,I=[];for(var D=0,w=F.length;D<w;++D){N=false;j=F[D];L={};for(var G=0;G<E;++G){J=z.items[G].name;M=j[J];if(this.ignoreAttribute(J,M)){N=true;break;}L[J]=M;}if(K){M=K.attributes[L.name];if(M!==undefined){if(this.ignoreAttribute("value",M)){N=true;}else{L.value=M;}}}if(!N){I[I.length]=new H(L);}}return{success:true,records:I,totalRecords:I.length};},ignoreAttribute:function(g,j){var h=false;if(this.meta.ignore&&this.meta.ignore[g]){var f=this.meta.ignore[g];if(typeof f=="string"){h=(f===j);}else{if(f instanceof Array){h=(f.indexOf(j)>-1);}else{if(f instanceof RegExp){h=(f.test(j));}}}}return h;}});Ext.namespace("GeoExt.data");GeoExt.data.AttributeStoreMixin=function(){return{constructor:function(b){b=b||{};arguments.callee.superclass.constructor.call(this,Ext.apply(b,{proxy:b.proxy||(!b.data?new Ext.data.HttpProxy({url:b.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.AttributeReader(b,b.fields||["name","type","restriction"])}));if(this.feature){this.bind();}},bind:function(){this.on({update:this.onUpdate,load:this.onLoad,add:this.onAdd,scope:this});var b=[];this.each(function(a){b.push(a);});this.updateFeature(b);},onUpdate:function(g,f,e){this.updateFeature([f]);},onLoad:function(e,f,g){if(!g||g.add!==true){this.updateFeature(f);}},onAdd:function(e,f,g){this.updateFeature(f);},updateFeature:function(v){var o=this.feature,s=o.layer;var u,r,t,w,q,B,z;for(u=0,r=v.length;u<r;u++){t=v[u];w=t.get("name");q=t.get("value");B=o.attributes[w];if(B!==q){z=true;}}if(z&&s&&s.events&&s.events.triggerEvent("beforefeaturemodified",{feature:o})!==false){for(u=0,r=v.length;u<r;u++){t=v[u];w=t.get("name");q=t.get("value");o.attributes[w]=q;}s.events.triggerEvent("featuremodified",{feature:o});s.drawFeature(o);}}};};GeoExt.data.AttributeStore=Ext.extend(Ext.data.Store,GeoExt.data.AttributeStoreMixin());Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.FeatureReader=function(e,d){e=e||{};if(!(d instanceof Function)){d=GeoExt.data.FeatureRecord.create(d||e.fields||{});}GeoExt.data.FeatureReader.superclass.constructor.call(this,e,d);};Ext.extend(GeoExt.data.FeatureReader,Ext.data.DataReader,{totalRecords:null,read:function(b){return this.readRecords(b.features);},readRecords:function(F){var E=[];if(F){var C=this.recordType,v=C.prototype.fields;var w,B,z,D,H,I,e,J;for(w=0,B=F.length;w<B;w++){H=F[w];I={};if(H.attributes){for(z=0,D=v.length;z<D;z++){e=v.items[z];if(/[\[\.]/.test(e.mapping)){try{J=new Function("obj","return obj."+e.mapping)(H.attributes);}catch(j){J=e.defaultValue;}}else{J=H.attributes[e.mapping||e.name]||e.defaultValue;}if(e.convert){J=e.convert(J);}I[e.name]=J;}}I.feature=H;I.state=H.state;I.fid=H.fid;var G=(H.state===OpenLayers.State.INSERT)?undefined:H.id;E[E.length]=new C(I,G);}}return{records:E,totalRecords:this.totalRecords!=null?this.totalRecords:E.length};}});Ext.namespace("GeoExt.data");GeoExt.data.FeatureStoreMixin=function(){return{layer:null,reader:null,featureFilter:null,constructor:function(e){e=e||{};e.reader=e.reader||new GeoExt.data.FeatureReader({},e.fields);var g=e.layer;delete e.layer;if(e.features){e.data=e.features;}delete e.features;var f={initDir:e.initDir};delete e.initDir;arguments.callee.superclass.constructor.call(this,e);if(g){this.bind(g,f);}},bind:function(o,h){if(this.layer){return;}this.layer=o;h=h||{};var l=h.initDir;if(h.initDir==undefined){l=GeoExt.data.FeatureStore.LAYER_TO_STORE|GeoExt.data.FeatureStore.STORE_TO_LAYER;}var m=o.features.slice(0);if(l&GeoExt.data.FeatureStore.STORE_TO_LAYER){var j=this.getRange();for(var q=j.length-1;q>=0;q--){this.layer.addFeatures([j[q].getFeature()]);}}if(l&GeoExt.data.FeatureStore.LAYER_TO_STORE){this.loadData(m,true);}o.events.on({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this});},unbind:function(){if(this.layer){this.layer.events.un({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});this.un("load",this.onLoad,this);this.un("clear",this.onClear,this);this.un("add",this.onAdd,this);this.un("remove",this.onRemove,this);this.un("update",this.onUpdate,this);this.layer=null;}},getRecordFromFeature:function(g){var f=null;if(g.state!==OpenLayers.State.INSERT){f=this.getById(g.id);}else{var e=this.findBy(function(a){return a.getFeature()===g;});if(e>-1){f=this.getAt(e);}}return f;},onFeaturesAdded:function(h){if(!this._adding){var l=h.features,m=l;if(this.featureFilter){m=[];var o,j,q;for(var o=0,j=l.length;o<j;o++){q=l[o];if(this.featureFilter.evaluate(q)!==false){m.push(q);}}}this._adding=true;this.loadData(m,true);delete this._adding;}},onFeaturesRemoved:function(g){if(!this._removing){var j=g.features,l,h,m;for(m=j.length-1;m>=0;m--){l=j[m];h=this.getRecordFromFeature(l);if(h!==undefined){this._removing=true;this.remove(h);delete this._removing;}}}},onFeatureModified:function(o){if(!this._updating){var m=o.feature;var u=this.getRecordFromFeature(m);if(u!==undefined){u.beginEdit();var w=m.attributes;if(w){var t=this.recordType.prototype.fields;for(var v=0,s=t.length;v<s;v++){var r=t.items[v];var q=r.mapping||r.name;if(q in w){u.set(r.name,r.convert(w[q]));}}}u.set("state",m.state);u.set("fid",m.fid);u.setFeature(m);this._updating=true;u.endEdit();delete this._updating;}}},addFeaturesToLayer:function(f){var j,g,h;h=new Array((g=f.length));for(j=0;j<g;j++){h[j]=f[j].getFeature();}if(h.length>0){this._adding=true;this.layer.addFeatures(h);delete this._adding;}},onLoad:function(e,f,g){if(!g||g.add!==true){this._removing=true;this.layer.removeFeatures(this.layer.features);delete this._removing;this.addFeaturesToLayer(f);}},onClear:function(b){this._removing=true;this.layer.removeFeatures(this.layer.features);delete this._removing;},onAdd:function(e,f,g){if(!this._adding){this.addFeaturesToLayer(f);}},onRemove:function(f,g,j){if(!this._removing){var h=g.getFeature();if(this.layer.getFeatureById(h.id)!=null){this._removing=true;this.layer.removeFeatures([g.getFeature()]);delete this._removing;}}},onUpdate:function(q,j,r){if(!this._updating){var m=new GeoExt.data.FeatureRecord().fields;var o=j.getFeature();if(j.fields){var l=this.layer.events.triggerEvent("beforefeaturemodified",{feature:o});if(l!==false){var s=o.attributes;j.fields.each(function(a){var b=a.mapping||a.name;if(!m.containsKey(b)){s[b]=j.get(a.name);}});this._updating=true;this.layer.events.triggerEvent("featuremodified",{feature:o});delete this._updating;if(this.layer.getFeatureById(o.id)!=null){this.layer.drawFeature(o);}}}}}};};GeoExt.data.FeatureStore=Ext.extend(Ext.data.Store,new GeoExt.data.FeatureStoreMixin);GeoExt.data.FeatureStore.LAYER_TO_STORE=1;GeoExt.data.FeatureStore.STORE_TO_LAYER=2;Ext.namespace("GeoExt.data");GeoExt.data.LayerRecord=Ext.data.Record.create([{name:"layer"},{name:"title",type:"string",mapping:"name"}]);GeoExt.data.LayerRecord.prototype.getLayer=function(){return this.get("layer");};GeoExt.data.LayerRecord.prototype.setLayer=function(b){if(b!==this.data.layer){this.dirty=true;
if(!this.modified){this.modified={};}if(this.modified.layer===undefined){this.modified.layer=this.data.layer;}this.data.layer=b;if(!this.editing){this.afterEdit();}}};GeoExt.data.LayerRecord.prototype.clone=function(d){var e=this.getLayer()&&this.getLayer().clone();return new this.constructor(Ext.applyIf({layer:e},this.data),d||e.id);};GeoExt.data.LayerRecord.create=function(j){var m=Ext.extend(GeoExt.data.LayerRecord,{});var l=m.prototype;l.fields=new Ext.util.MixedCollection(false,function(a){return a.name;});GeoExt.data.LayerRecord.prototype.fields.each(function(a){l.fields.add(a);});if(j){for(var f=0,h=j.length;f<h;f++){l.fields.add(new Ext.data.Field(j[f]));}}m.getField=function(a){return l.fields.get(a);};return m;};Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.LayerReader=function(e,d){e=e||{};if(!(d instanceof Function)){d=GeoExt.data.LayerRecord.create(d||e.fields||{});}GeoExt.data.LayerReader.superclass.constructor.call(this,e,d);};Ext.extend(GeoExt.data.LayerReader,Ext.data.DataReader,{totalRecords:null,readRecords:function(z){var F=[];if(z){var D=this.recordType,u=D.prototype.fields;var w,C,B,E,v,j,t,s;for(w=0,C=z.length;w<C;w++){v=z[w];j={};for(B=0,E=u.length;B<E;B++){t=u.items[B];s=v[t.mapping||t.name]||t.defaultValue;s=t.convert(s);j[t.name]=s;}j.layer=v;F[F.length]=new D(j,v.id);}}return{records:F,totalRecords:this.totalRecords!=null?this.totalRecords:F.length};}});Ext.namespace("GeoExt.data");GeoExt.data.LayerStoreMixin=function(){return{map:null,reader:null,constructor:function(e){e=e||{};e.reader=e.reader||new GeoExt.data.LayerReader({},e.fields);delete e.fields;var g=e.map instanceof GeoExt.MapPanel?e.map.map:e.map;delete e.map;if(e.layers){e.data=e.layers;}delete e.layers;var f={initDir:e.initDir};delete e.initDir;arguments.callee.superclass.constructor.call(this,e);if(g){this.bind(g,f);}},bind:function(h,g){if(this.map){return;}this.map=h;g=g||{};var f=g.initDir;if(g.initDir==undefined){f=GeoExt.data.LayerStore.MAP_TO_STORE|GeoExt.data.LayerStore.STORE_TO_MAP;}var j=h.layers.slice(0);if(f&GeoExt.data.LayerStore.STORE_TO_MAP){this.each(function(a){this.map.addLayer(a.getLayer());},this);}if(f&GeoExt.data.LayerStore.MAP_TO_STORE){this.loadData(j,true);}h.events.on({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this});this.data.on({replace:this.onReplace,scope:this});},unbind:function(){if(this.map){this.map.events.un({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});this.un("load",this.onLoad,this);this.un("clear",this.onClear,this);this.un("add",this.onAdd,this);this.un("remove",this.onRemove,this);this.data.un("replace",this.onReplace,this);this.map=null;}},onChangeLayer:function(g){var j=g.layer;var m=this.findBy(function(b,a){return b.getLayer()===j;});if(m>-1){var h=this.getAt(m);if(g.property==="order"){if(!this._adding&&!this._removing){var l=this.map.getLayerIndex(j);if(l!==m){this._removing=true;this.remove(h);delete this._removing;this._adding=true;this.insert(l,[h]);delete this._adding;}}}else{if(g.property==="name"){h.set("title",j.name);}else{this.fireEvent("update",this,h,Ext.data.Record.EDIT);}}}},onAddLayer:function(e){if(!this._adding){var d=e.layer;this._adding=true;this.loadData([d],true);delete this._adding;}},onRemoveLayer:function(e){if(this.map.unloadDestroy){if(!this._removing){var d=e.layer;this._removing=true;this.remove(this.getById(d.id));delete this._removing;}}else{this.unbind();}},onLoad:function(s,j,q){if(!Ext.isArray(j)){j=[j];}if(q&&!q.add){this._removing=true;for(var o=this.map.layers.length-1;o>=0;o--){this.map.removeLayer(this.map.layers[o]);}delete this._removing;var l=j.length;if(l>0){var m=new Array(l);for(var r=0;r<l;r++){m[r]=j[r].getLayer();}this._adding=true;this.map.addLayers(m);delete this._adding;}}},onClear:function(e){this._removing=true;for(var d=this.map.layers.length-1;d>=0;d--){this.map.removeLayer(this.map.layers[d]);}delete this._removing;},onAdd:function(g,h,m){if(!this._adding){this._adding=true;var j;for(var l=h.length-1;l>=0;--l){j=h[l].getLayer();this.map.addLayer(j);if(m!==this.map.layers.length-1){this.map.setLayerIndex(j,m);}}delete this._adding;}},onRemove:function(f,g,j){if(!this._removing){var h=g.getLayer();if(this.map.getLayer(h.id)!=null){this._removing=true;this.removeMapLayer(g);delete this._removing;}}},onUpdate:function(m,h,g){if(g===Ext.data.Record.EDIT){if(h.modified&&h.modified.title){var l=h.getLayer();var j=h.get("title");if(j!==l.name){l.setName(j);}}}},removeMapLayer:function(b){this.map.removeLayer(b.getLayer());},onReplace:function(g,f,e){this.removeMapLayer(f);},getByLayer:function(d){var e=this.findBy(function(a){return a.getLayer()===d;});if(e>-1){return this.getAt(e);}},destroy:function(){this.unbind();GeoExt.data.LayerStore.superclass.destroy.call(this);}};};GeoExt.data.LayerStore=Ext.extend(Ext.data.Store,new GeoExt.data.LayerStoreMixin);GeoExt.data.LayerStore.MAP_TO_STORE=1;GeoExt.data.LayerStore.STORE_TO_MAP=2;Ext.namespace("GeoExt.data");GeoExt.data.ScaleStore=Ext.extend(Ext.data.Store,{map:null,constructor:function(e){var d=(e.map instanceof GeoExt.MapPanel?e.map.map:e.map);delete e.map;e=Ext.applyIf(e,{reader:new Ext.data.JsonReader({},["level","resolution","scale"])});GeoExt.data.ScaleStore.superclass.constructor.call(this,e);if(d){this.bind(d);}},bind:function(d,e){this.map=(d instanceof GeoExt.MapPanel?d.map:d);this.map.events.register("changebaselayer",this,this.populateFromMap);if(this.map.baseLayer){this.populateFromMap();}else{this.map.events.register("addlayer",this,this.populateOnAdd);}},unbind:function(){if(this.map){this.map.events.unregister("addlayer",this,this.populateOnAdd);this.map.events.unregister("changebaselayer",this,this.populateFromMap);delete this.map;}},populateOnAdd:function(b){if(b.layer.isBaseLayer){this.populateFromMap();this.map.events.unregister("addlayer",this,this.populateOnAdd);}},populateFromMap:function(){var m=[];var h=this.map.baseLayer.resolutions;var g=this.map.baseLayer.units;for(var j=h.length-1;j>=0;j--){var l=h[j];m.push({level:j,resolution:l,scale:OpenLayers.Util.getScaleFromResolution(l,g)});}this.loadData(m);},destroy:function(){this.unbind();GeoExt.data.ScaleStore.superclass.destroy.apply(this,arguments);}});Ext.namespace("GeoExt.data");GeoExt.data.PrintProvider=Ext.extend(Ext.util.Observable,{url:null,capabilities:null,method:"POST",customParams:null,scales:null,dpis:null,layouts:null,dpi:null,layout:null,constructor:function(b){this.initialConfig=b;Ext.apply(this,b);if(!this.customParams){this.customParams={};}this.addEvents("loadcapabilities","layoutchange","dpichange","beforeprint","print","printexception","beforeencodelayer","encodelayer");GeoExt.data.PrintProvider.superclass.constructor.apply(this,arguments);this.scales=new Ext.data.JsonStore({root:"scales",sortInfo:{field:"value",direction:"DESC"},fields:["name",{name:"value",type:"float"}]});this.dpis=new Ext.data.JsonStore({root:"dpis",fields:["name",{name:"value",type:"float"}]});this.layouts=new Ext.data.JsonStore({root:"layouts",fields:["name",{name:"size",mapping:"map"},{name:"rotation",type:"boolean"}]});if(b.capabilities){this.loadStores();}else{if(this.url.split("/").pop()){this.url+="/";}this.initialConfig.autoLoad&&this.loadCapabilities();}},setLayout:function(b){this.layout=b;this.fireEvent("layoutchange",this,b);},setDpi:function(b){this.dpi=b;this.fireEvent("dpichange",this,b);},print:function(D,C,r){if(D instanceof GeoExt.MapPanel){D=D.map;}C=C instanceof Array?C:[C];r=r||{};if(this.fireEvent("beforeprint",this,D,C,r)===false){return;}var w=Ext.apply({units:D.getUnits(),srs:D.baseLayer.projection.getCode(),layout:this.layout.get("name"),dpi:this.dpi.get("value")},this.customParams);var s=C[0].feature.layer;var t=[];Ext.each(D.layers,function(a){if(a!==s&&a.getVisibility()===true){var b=this.encodeLayer(a);b&&t.push(b);
}},this);w.layers=t;var z=[];Ext.each(C,function(a){z.push(Ext.apply({center:[a.center.lon,a.center.lat],scale:a.scale.get("value"),rotation:a.rotation},a.customParams));},this);w.pages=z;if(r.overview){var u=[];Ext.each(r.overview.layers,function(a){var b=this.encodeLayer(a);b&&u.push(b);},this);w.overviewLayers=u;}if(r.legend){var v=r.legend;var B=v.rendered;if(!B){v=v.cloneConfig({renderTo:document.body,hidden:true});}var E=[];v.items.each(function(b){if(!b.hidden){var a=this.encoders.legends[b.getXType()];E=E.concat(a.call(this,b));}},this);if(!B){v.destroy();}w.legends=E;}if(this.method==="GET"){var F=Ext.urlAppend(this.capabilities.printURL,"spec="+encodeURIComponent(Ext.encode(w)));window.open(F);this.fireEvent("print",this,F);}else{Ext.Ajax.request({url:this.capabilities.createURL,jsonData:w,success:function(b){var a=Ext.decode(b.responseText).getURL+(Ext.isIE?"?inline=true":"");if(Ext.isOpera||Ext.isIE){window.open(a);}else{window.location.href=a;}this.fireEvent("print",this,a);},failure:function(a){this.fireEvent("printexception",this,a);},params:this.initialConfig.baseParams,scope:this});}},loadCapabilities:function(){if(!this.url){return;}var b=this.url+"info.json";Ext.Ajax.request({url:b,method:"GET",disableCaching:false,success:function(a){this.capabilities=Ext.decode(a.responseText);this.loadStores();},params:this.initialConfig.baseParams,scope:this});},loadStores:function(){this.scales.loadData(this.capabilities);this.dpis.loadData(this.capabilities);this.layouts.loadData(this.capabilities);this.setLayout(this.layouts.getAt(0));this.setDpi(this.dpis.getAt(0));this.fireEvent("loadcapabilities",this,this.capabilities);},encodeLayer:function(f){var e;for(var g in this.encoders.layers){if(OpenLayers.Layer[g]&&f instanceof OpenLayers.Layer[g]){if(this.fireEvent("beforeencodelayer",this,f)===false){return;}e=this.encoders.layers[g].call(this,f);this.fireEvent("encodelayer",this,f,e);break;}}return(e&&e.type)?e:null;},getAbsoluteUrl:function(e){var a;if(Ext.isIE){a=document.createElement("<a href='"+e+"'/>");a.style.display="none";document.body.appendChild(a);a.href=a.href;document.body.removeChild(a);}else{a=document.createElement("a");a.href=e;}return a.href;},encoders:{layers:{WMS:function(f){var g=this.encoders.layers.HTTPRequest.call(this,f);Ext.apply(g,{type:"WMS",layers:[f.params.LAYERS].join(",").split(","),format:f.params.FORMAT,styles:[f.params.STYLES].join(",").split(",")});var h;for(var j in f.params){h=j.toLowerCase();if(!f.DEFAULT_PARAMS[h]&&"layers,styles,width,height,srs".indexOf(h)==-1){if(!g.customParams){g.customParams={};}g.customParams[j]=f.params[j];}}return g;},OSM:function(d){var e=this.encoders.layers.TileCache.call(this,d);return Ext.apply(e,{type:"OSM",baseURL:e.baseURL.substr(0,e.baseURL.indexOf("$")),extension:"png"});},TMS:function(d){var e=this.encoders.layers.TileCache.call(this,d);return Ext.apply(e,{type:"TMS",format:d.type});},TileCache:function(d){var e=this.encoders.layers.HTTPRequest.call(this,d);return Ext.apply(e,{type:"TileCache",layer:d.layername,maxExtent:d.maxExtent.toArray(),tileSize:[d.tileSize.w,d.tileSize.h],extension:d.extension,resolutions:d.serverResolutions||d.resolutions});},KaMapCache:function(d){var e=this.encoders.layers.KaMap.call(this,d);return Ext.apply(e,{type:"KaMapCache",group:d.params.g,metaTileWidth:d.params.metaTileSize.w,metaTileHeight:d.params.metaTileSize.h});},KaMap:function(d){var e=this.encoders.layers.HTTPRequest.call(this,d);return Ext.apply(e,{type:"KaMap",map:d.params.map,extension:d.params.i,group:d.params.g||"",maxExtent:d.maxExtent.toArray(),tileSize:[d.tileSize.w,d.tileSize.h],resolutions:d.serverResolutions||d.resolutions});},HTTPRequest:function(b){return{baseURL:this.getAbsoluteUrl(b.url instanceof Array?b.url[0]:b.url),opacity:(b.opacity!=null)?b.opacity:1,singleTile:b.singleTile};},Image:function(b){return{type:"Image",baseURL:this.getAbsoluteUrl(b.getURL(b.extent)),opacity:(b.opacity!=null)?b.opacity:1,extent:b.extent.toArray(),pixelSize:[b.size.w,b.size.h],name:b.name};},Vector:function(w){if(!w.features.length){return;}var z=[];var N={};var I=w.features;var M=new OpenLayers.Format.GeoJSON();var H=new OpenLayers.Format.JSON();var J=1;var C={};var L,K,D,B,G;for(var E=0,v=I.length;E<v;++E){L=I[E];K=L.style||w.style||w.styleMap.createSymbolizer(L,L.renderIntent);D=H.write(K);B=C[D];if(B){G=B;}else{C[D]=G=J++;if(K.externalGraphic){N[G]=Ext.applyIf({externalGraphic:this.getAbsoluteUrl(K.externalGraphic)},K);}else{N[G]=K;}}var F=M.extract.feature.call(M,L);F.properties=OpenLayers.Util.extend({_gx_style:G},F.properties);z.push(F);}return{type:"Vector",styles:N,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:z},name:w.name,opacity:(w.opacity!=null)?w.opacity:1};}},legends:{gx_wmslegend:function(j){var g=this.encoders.legends.base.call(this,j);var l=[];for(var m=1,h=j.items.getCount();m<h;++m){l.push(this.getAbsoluteUrl(j.items.get(m).url));}g[0].classes[0]={name:"",icons:l};return g;},gx_urllegend:function(d){var e=this.encoders.legends.base.call(this,d);e[0].classes.push({name:"",icon:this.getAbsoluteUrl(d.items.get(1).url)});return e;},base:function(b){return[{name:b.items.get(0).text,classes:[]}];}}}});Ext.namespace("GeoExt.data");GeoExt.data.PrintPage=Ext.extend(Ext.util.Observable,{printProvider:null,feature:null,center:null,scale:null,rotation:0,customParams:null,constructor:function(b){this.initialConfig=b;Ext.apply(this,b);if(!this.customParams){this.customParams={};}this.addEvents("change");GeoExt.data.PrintPage.superclass.constructor.apply(this,arguments);this.feature=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POLYGON((-1 -1,1 -1,1 1,-1 1,-1 -1))"));if(this.printProvider.capabilities){this.setScale(this.printProvider.scales.getAt(0));}else{this.printProvider.on({loadcapabilities:function(){this.setScale(this.printProvider.scales.getAt(0));},scope:this,single:true});}this.printProvider.on({layoutchange:this.onLayoutChange,scope:this});},getPrintExtent:function(b){b=b instanceof GeoExt.MapPanel?b.map:b;return this.calculatePageBounds(this.scale,b.getUnits());},setScale:function(j,h){var l=this.calculatePageBounds(j,h);var m=l.toGeometry();var g=this.rotation;if(g!=0){m.rotate(-g,m.getCentroid());}this.updateFeature(m,{scale:j});},setCenter:function(h){var l=this.feature.geometry;var j=l.getBounds().getCenterLonLat();var m=h.lon-j.lon;var g=h.lat-j.lat;l.move(m,g);this.updateFeature(l,{center:h});},setRotation:function(e,g){if(g||this.printProvider.layout.get("rotation")===true){var f=this.feature.geometry;f.rotate(this.rotation-e,f.getCentroid());this.updateFeature(f,{rotation:e});}},fit:function(r,o){o=o||{};var z=r,q;if(r instanceof GeoExt.MapPanel){z=r.map;}else{if(r instanceof OpenLayers.Feature.Vector){z=r.layer.map;q=r.geometry.getBounds();}}if(!q){q=z.getExtent();if(!q){return;}}this._updating=true;var B=q.getCenterLonLat();this.setCenter(B);var s=z.getUnits();var v=this.printProvider.scales.getAt(0);var w=Number.POSITIVE_INFINITY;var u=q.getWidth();var t=q.getHeight();this.printProvider.scales.each(function(a){var d=this.calculatePageBounds(a,s);if(o.mode=="closest"){var b=Math.abs(d.getWidth()-u)+Math.abs(d.getHeight()-t);if(b<w){w=b;v=a;}}else{var e=o.mode=="screen"?!q.containsBounds(d):d.containsBounds(q);if(e||(o.mode=="screen"&&!e)){v=a;}return e;}},this);this.setScale(v,s);delete this._updating;this.updateFeature(this.feature.geometry,{center:B,scale:v});},updateFeature:function(j,f){var l=this.feature;var h=l.geometry!==j;j.id=l.geometry.id;l.geometry=j;if(!this._updating){for(var m in f){if(f[m]===this[m]){delete f[m];}else{this[m]=f[m];h=true;}}Ext.apply(this,f);l.layer&&l.layer.drawFeature(l);h&&this.fireEvent("change",this,f);}},calculatePageBounds:function(z,t){var h=z.get("value");var u=this.feature;var s=this.feature.geometry;var B=s.getBounds().getCenterLonLat();var f=this.printProvider.layout.get("size");var t=t||(u.layer&&u.layer.map&&u.layer.map.getUnits())||"dd";var v=OpenLayers.INCHES_PER_UNIT[t];
var r=f.width/72/v*h/2;var w=f.height/72/v*h/2;return new OpenLayers.Bounds(B.lon-r,B.lat-w,B.lon+r,B.lat+w);},onLayoutChange:function(){if(this.printProvider.layout.get("rotation")===false){this.setRotation(0,true);}this.scale&&this.setScale(this.scale);},destroy:function(){this.printProvider.un("layoutchange",this.onLayoutChange,this);}});Ext.namespace("GeoExt.data");GeoExt.data.WMSCapabilitiesReader=function(e,d){e=e||{};if(!e.format){e.format=new OpenLayers.Format.WMSCapabilities();}if(typeof d!=="function"){d=GeoExt.data.LayerRecord.create(d||e.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"queryable",type:"boolean"},{name:"opaque",type:"boolean"},{name:"noSubsets",type:"boolean"},{name:"cascaded",type:"int"},{name:"fixedWidth",type:"int"},{name:"fixedHeight",type:"int"},{name:"minScale",type:"float"},{name:"maxScale",type:"float"},{name:"prefix",type:"string"},{name:"formats"},{name:"styles"},{name:"srs"},{name:"dimensions"},{name:"bbox"},{name:"llbbox"},{name:"attribution"},{name:"keywords"},{name:"identifiers"},{name:"authorityURLs"},{name:"metadataURLs"}]);}GeoExt.data.WMSCapabilitiesReader.superclass.constructor.call(this,e,d);};Ext.extend(GeoExt.data.WMSCapabilitiesReader,Ext.data.DataReader,{attributionCls:"gx-attribution",read:function(e){var d=e.responseXML;if(!d||!d.documentElement){d=e.responseText;}return this.readRecords(d);},serviceExceptionFormat:function(b){if(OpenLayers.Util.indexOf(b,"application/vnd.ogc.se_inimage")>-1){return"application/vnd.ogc.se_inimage";}if(OpenLayers.Util.indexOf(b,"application/vnd.ogc.se_xml")>-1){return"application/vnd.ogc.se_xml";}return b[0];},imageFormat:function(d){var e=d.formats;if(d.opaque&&OpenLayers.Util.indexOf(e,"image/jpeg")>-1){return"image/jpeg";}if(OpenLayers.Util.indexOf(e,"image/png")>-1){return"image/png";}if(OpenLayers.Util.indexOf(e,"image/png; mode=24bit")>-1){return"image/png; mode=24bit";}if(OpenLayers.Util.indexOf(e,"image/gif")>-1){return"image/gif";}return e[0];},imageTransparent:function(b){return b.opaque==undefined||!b.opaque;},readRecords:function(G){if(typeof G==="string"||G.nodeType){G=this.meta.format.read(G);}var P=G.version;var S=G.capability||{};var O=S.request&&S.request.getmap&&S.request.getmap.href;var M=S.layers;var N=S.exception?S.exception.formats:[];var E=this.serviceExceptionFormat(N);var F=[];if(O&&M){var K=this.recordType.prototype.fields;var J,T,Q,j,U,L;for(var H=0,v=M.length;H<v;H++){J=M[H];if(J.name){T={};for(var I=0,D=K.length;I<D;I++){U=K.items[I];L=J[U.mapping||U.name]||U.defaultValue;L=U.convert(L);T[U.name]=L;}Q={attribution:J.attribution?this.attributionMarkup(J.attribution):undefined,minScale:J.minScale,maxScale:J.maxScale};if(this.meta.layerOptions){Ext.apply(Q,this.meta.layerOptions);}j={layers:J.name,exceptions:E,format:this.imageFormat(J),transparent:this.imageTransparent(J),version:P};if(this.meta.layerParams){Ext.apply(j,this.meta.layerParams);}T.layer=new OpenLayers.Layer.WMS(J.title||J.name,O,j,Q);F.push(new this.recordType(T,T.layer.id));}}}return{totalRecords:F.length,success:true,records:F};},attributionMarkup:function(f){var e=[];if(f.logo){e.push("<img class='"+this.attributionCls+"-image' src='"+f.logo.href+"' />");}if(f.title){e.push("<span class='"+this.attributionCls+"-title'>"+f.title+"</span>");}if(f.href){for(var g=0;g<e.length;g++){e[g]="<a class='"+this.attributionCls+"-link' href="+f.href+">"+e[g]+"</a>";}}return e.join(" ");}});Ext.namespace("GeoExt.data");GeoExt.data.WMSCapabilitiesStore=function(b){b=b||{};GeoExt.data.WMSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(b,{proxy:b.proxy||(!b.data?new Ext.data.HttpProxy({url:b.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSCapabilitiesReader(b,b.fields)}));};Ext.extend(GeoExt.data.WMSCapabilitiesStore,Ext.data.Store);Ext.namespace("GeoExt.data");GeoExt.data.WMSDescribeLayerReader=function(e,d){e=e||{};if(!e.format){e.format=new OpenLayers.Format.WMSDescribeLayer();}if(!(typeof d==="function")){d=Ext.data.Record.create(d||e.fields||[{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}]);}GeoExt.data.WMSDescribeLayerReader.superclass.constructor.call(this,e,d);};Ext.extend(GeoExt.data.WMSDescribeLayerReader,Ext.data.DataReader,{read:function(e){var d=e.responseXML;if(!d||!d.documentElement){d=e.responseText;}return this.readRecords(d);},readRecords:function(j){if(typeof j==="string"||j.nodeType){j=this.meta.format.read(j);}var g=[],l;for(var m=0,h=j.length;m<h;m++){l=j[m];if(l){g.push(new this.recordType(l));}}return{totalRecords:g.length,success:true,records:g};}});Ext.namespace("GeoExt.data");GeoExt.data.WMSDescribeLayerStore=function(b){b=b||{};GeoExt.data.WMSDescribeLayerStore.superclass.constructor.call(this,Ext.apply(b,{proxy:b.proxy||(!b.data?new Ext.data.HttpProxy({url:b.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSDescribeLayerReader(b,b.fields)}));};Ext.extend(GeoExt.data.WMSDescribeLayerStore,Ext.data.Store);Ext.namespace("GeoExt");GeoExt.Action=Ext.extend(Ext.Action,{control:null,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(e){this.uScope=e.scope;this.uHandler=e.handler;this.uToggleHandler=e.toggleHandler;this.uCheckHandler=e.checkHandler;e.scope=this;e.handler=this.pHandler;e.toggleHandler=this.pToggleHandler;e.checkHandler=this.pCheckHandler;var d=this.control=e.control;delete e.control;if(d){if(e.map){e.map.addControl(d);delete e.map;}if((e.pressed||e.checked)&&d.map){d.activate();}d.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this});}arguments.callee.superclass.constructor.call(this,e);},pHandler:function(e){var d=this.control;if(d&&d.type==OpenLayers.Control.TYPE_BUTTON){d.trigger();}if(this.uHandler){this.uHandler.apply(this.uScope,arguments);}},pToggleHandler:function(e,d){this.changeControlState(d);if(this.uToggleHandler){this.uToggleHandler.apply(this.uScope,arguments);}},pCheckHandler:function(e,d){this.changeControlState(d);if(this.uCheckHandler){this.uCheckHandler.apply(this.uScope,arguments);}},changeControlState:function(b){if(b){if(!this._activating){this._activating=true;this.control.activate();this._activating=false;}}else{if(!this._deactivating){this._deactivating=true;this.control.deactivate();this._deactivating=false;}}},onCtrlActivate:function(){var b=this.control;if(b.type==OpenLayers.Control.TYPE_BUTTON){this.enable();}else{this.safeCallEach("toggle",[true]);this.safeCallEach("setChecked",[true]);}},onCtrlDeactivate:function(){var b=this.control;if(b.type==OpenLayers.Control.TYPE_BUTTON){this.disable();}else{this.safeCallEach("toggle",[false]);this.safeCallEach("setChecked",[false]);}},safeCallEach:function(j,g){var l=this.items;for(var m=0,h=l.length;m<h;m++){if(l[m][j]){l[m].rendered?l[m][j].apply(l[m],g):l[m].on({render:l[m][j].createDelegate(l[m],g),single:true});}}}});Ext.namespace("GeoExt");GeoExt.MapPanel=Ext.extend(Ext.Panel,{map:null,layers:null,center:null,zoom:null,prettyStateKeys:false,extent:null,stateEvents:["aftermapmove","afterlayervisibilitychange","afterlayeropacitychange"],initComponent:function(){if(!(this.map instanceof OpenLayers.Map)){this.map=new OpenLayers.Map(Ext.applyIf(this.map||{},{allOverlays:true}));}var b=this.layers;if(!b||b instanceof Array){this.layers=new GeoExt.data.LayerStore({layers:b,map:this.map.layers.length>0?this.map:null});}if(typeof this.center=="string"){this.center=OpenLayers.LonLat.fromString(this.center);}else{if(this.center instanceof Array){this.center=new OpenLayers.LonLat(this.center[0],this.center[1]);}}if(typeof this.extent=="string"){this.extent=OpenLayers.Bounds.fromString(this.extent);}else{if(this.extent instanceof Array){this.extent=OpenLayers.Bounds.fromArray(this.extent);}}GeoExt.MapPanel.superclass.initComponent.call(this);this.addEvents("aftermapmove","afterlayervisibilitychange","afterlayeropacitychange");this.map.events.on({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this});
},onMoveend:function(){this.fireEvent("aftermapmove");},onLayerchange:function(b){if(b.property){if(b.property==="visibility"){this.fireEvent("afterlayervisibilitychange");}else{if(b.property==="opacity"){this.fireEvent("afterlayeropacitychange");}}}},applyState:function(q){this.center=new OpenLayers.LonLat(q.x,q.y);this.zoom=q.zoom;var r,u,s,l,m,t;var o=this.map.layers;for(r=0,u=o.length;r<u;r++){s=o[r];l=this.prettyStateKeys?s.name:s.id;m=q["visibility_"+l];if(m!==undefined){m=(/^true$/i).test(m);if(s.isBaseLayer){if(m){this.map.setBaseLayer(s);}}else{s.setVisibility(m);}}t=q["opacity_"+l];if(t!==undefined){s.setOpacity(t);}}},getState:function(){var o;if(!this.map){return;}var l=this.map.getCenter();o={x:l.lon,y:l.lat,zoom:this.map.getZoom()};var q,s,r,j,m=this.map.layers;for(q=0,s=m.length;q<s;q++){r=m[q];j=this.prettyStateKeys?r.name:r.id;o["visibility_"+j]=r.getVisibility();o["opacity_"+j]=r.opacity==null?1:r.opacity;}return o;},updateMapSize:function(){if(this.map){this.map.updateSize();}},renderMap:function(){var b=this.map;b.render(this.body.dom);this.layers.bind(b);if(b.layers.length>0){if(this.center||this.zoom!=null){b.setCenter(this.center,this.zoom);}else{if(this.extent){b.zoomToExtent(this.extent);}else{b.zoomToMaxExtent();}}}},afterRender:function(){GeoExt.MapPanel.superclass.afterRender.apply(this,arguments);if(!this.ownerCt){this.renderMap();}else{this.ownerCt.on("move",this.updateMapSize,this);this.ownerCt.on({afterlayout:{fn:this.renderMap,scope:this,single:true}});}},onResize:function(){GeoExt.MapPanel.superclass.onResize.apply(this,arguments);this.updateMapSize();},onBeforeAdd:function(b){if(typeof b.addToMapPanel==="function"){b.addToMapPanel(this);}GeoExt.MapPanel.superclass.onBeforeAdd.apply(this,arguments);},remove:function(d,e){if(typeof d.removeFromMapPanel==="function"){d.removeFromMapPanel(this);}GeoExt.MapPanel.superclass.remove.apply(this,arguments);},beforeDestroy:function(){if(this.ownerCt){this.ownerCt.un("move",this.updateMapSize,this);}if(this.map&&this.map.events){this.map.events.un({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this});}if(!this.initialConfig.map||!(this.initialConfig.map instanceof OpenLayers.Map)){if(this.map&&this.map.destroy){this.map.destroy();}}delete this.map;GeoExt.MapPanel.superclass.beforeDestroy.apply(this,arguments);}});GeoExt.MapPanel.guess=function(){return Ext.ComponentMgr.all.find(function(b){return b instanceof GeoExt.MapPanel;});};Ext.reg("gx_mappanel",GeoExt.MapPanel);Ext.namespace("GeoExt");GeoExt.LegendImage=Ext.extend(Ext.BoxComponent,{url:null,defaultImgSrc:null,imgCls:null,initComponent:function(){GeoExt.LegendImage.superclass.initComponent.call(this);if(this.defaultImgSrc===null){this.defaultImgSrc=Ext.BLANK_IMAGE_URL;}this.autoEl={tag:"img","class":(this.imgCls?this.imgCls:""),src:this.defaultImgSrc};},setUrl:function(e){this.url=e;var d=this.getEl();if(d){d.un("error",this.onImageLoadError,this);d.on("error",this.onImageLoadError,this,{single:true});d.dom.src=e;}},onRender:function(d,e){GeoExt.LegendImage.superclass.onRender.call(this,d,e);if(this.url){this.setUrl(this.url);}},onDestroy:function(){var b=this.getEl();if(b){b.un("error",this.onImageLoadError,this);}GeoExt.LegendImage.superclass.onDestroy.apply(this,arguments);},onImageLoadError:function(){this.getEl().dom.src=this.defaultImgSrc;}});Ext.reg("gx_legendimage",GeoExt.LegendImage);Ext.namespace("GeoExt");GeoExt.LegendPanel=Ext.extend(Ext.Panel,{dynamic:true,layerStore:null,preferredTypes:null,filter:function(b){return true;},initComponent:function(){GeoExt.LegendPanel.superclass.initComponent.call(this);},onRender:function(){GeoExt.LegendPanel.superclass.onRender.apply(this,arguments);if(!this.layerStore){this.layerStore=GeoExt.MapPanel.guess().layers;}this.layerStore.each(function(b){this.addLegend(b);},this);if(this.dynamic){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,clear:this.onStoreClear,scope:this});}},recordIndexToPanelIndex:function(o){var m=this.layerStore;var q=m.getCount();var u=-1;var w=this.items?this.items.length:0;var t,s;for(var v=q-1;v>=0;--v){t=m.getAt(v);s=t.getLayer();var r=GeoExt.LayerLegend.getTypes(t);if(s.displayInLayerSwitcher&&r.length>0&&(m.getAt(v).get("hideInLegend")!==true)){++u;if(o===v||u>w-1){break;}}}return u;},getIdForLayer:function(b){return this.id+"-"+b.id;},onStoreAdd:function(q,h,o){var l=this.recordIndexToPanelIndex(o+h.length-1);for(var m=0,j=h.length;m<j;m++){this.addLegend(h[m],l);}this.doLayout();},onStoreRemove:function(e,f,g){this.removeLegend(f);},removeLegend:function(e){if(this.items){var d=this.getComponent(this.getIdForLayer(e.getLayer()));if(d){this.remove(d,true);this.doLayout();}}},onStoreClear:function(b){this.removeAllLegends();},removeAllLegends:function(){this.removeAll(true);this.doLayout();},addLegend:function(h,g){if(this.filter(h)===true){var l=h.getLayer();g=g||0;var j;var m=GeoExt.LayerLegend.getTypes(h,this.preferredTypes);if(l.displayInLayerSwitcher&&!h.get("hideInLegend")&&m.length>0){this.insert(g,{xtype:m[0],id:this.getIdForLayer(l),layerRecord:h,hidden:!((!l.map&&l.visibility)||(l.getVisibility()&&l.calculateInRange()))});}}},onDestroy:function(){if(this.layerStore){this.layerStore.un("add",this.onStoreAdd,this);this.layerStore.un("remove",this.onStoreRemove,this);this.layerStore.un("clear",this.onStoreClear,this);}GeoExt.LegendPanel.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gx_legendpanel",GeoExt.LegendPanel);Ext.namespace("GeoExt");GeoExt.LayerLegend=Ext.extend(Ext.Container,{layerRecord:null,showTitle:true,legendTitle:null,labelCls:null,layerStore:null,initComponent:function(){GeoExt.LayerLegend.superclass.initComponent.call(this);this.autoEl={};this.add({xtype:"label",text:this.getLayerTitle(this.layerRecord),cls:"x-form-item x-form-item-label"+(this.labelCls?" "+this.labelCls:"")});if(this.layerRecord&&this.layerRecord.store){this.layerStore=this.layerRecord.store;this.layerStore.on("update",this.onStoreUpdate,this);}},onStoreUpdate:function(j,g,f){if(g===this.layerRecord&&this.items.getCount()>0){var h=g.getLayer();this.setVisible(h.getVisibility()&&h.calculateInRange()&&h.displayInLayerSwitcher&&!g.get("hideInLegend"));this.update();}},update:function(){var b=this.getLayerTitle(this.layerRecord);if(this.items.get(0).text!==b){this.items.get(0).setText(b);}},getLayerTitle:function(e){var d=this.legendTitle||"";if(this.showTitle&&!d){if(e&&!e.get("hideTitle")){d=e.get("title")||e.get("name")||e.getLayer().name||"";}}return d;},beforeDestroy:function(){this.layerStore&&this.layerStore.un("update",this.onStoreUpdate,this);GeoExt.LayerLegend.superclass.beforeDestroy.apply(this,arguments);}});GeoExt.LayerLegend.getTypes=function(g,h){var l=(h||[]).concat();var m=[];for(var j in GeoExt.LayerLegend.types){if(GeoExt.LayerLegend.types[j].supports(g)){l.indexOf(j)==-1&&m.push(j);}else{l.remove(j);}}return l.concat(m);};GeoExt.LayerLegend.supports=function(b){};GeoExt.LayerLegend.types={};Ext.namespace("GeoExt");GeoExt.WMSLegend=Ext.extend(GeoExt.LayerLegend,{defaultStyleIsFirst:true,useScaleParameter:true,baseParams:null,initComponent:function(){GeoExt.WMSLegend.superclass.initComponent.call(this);var b=this.layerRecord.getLayer();this._noMap=!b.map;b.events.register("moveend",this,this.onLayerMoveend);this.update();},onLayerMoveend:function(b){if((b.zoomChanged===true&&this.useScaleParameter===true)||this._noMap){delete this._noMap;this.update();}},getLegendUrl:function(u,t){var w=this.layerRecord;var D;var q=w&&w.get("styles");var v=w.getLayer();t=t||[v.params.LAYERS].join(",").split(",");var r=v.params.STYLES&&[v.params.STYLES].join(",").split(",");var s=t.indexOf(u);var C=r&&r[s];if(q&&q.length>0){if(C){Ext.each(q,function(a){D=(a.name==C&&a.legend)&&a.legend.href;return !D;});}else{if(this.defaultStyleIsFirst===true&&!r&&!v.params.SLD&&!v.params.SLD_BODY){D=q[0].legend&&q[0].legend.href;}}}if(!D){D=v.getFullRequestString({REQUEST:"GetLegendGraphic",WIDTH:null,HEIGHT:null,EXCEPTIONS:"application/vnd.ogc.se_xml",LAYER:u,LAYERS:null,STYLE:(C!=="")?C:null,STYLES:null,SRS:null,FORMAT:null});
}if(this.useScaleParameter===true&&D.toLowerCase().indexOf("request=getlegendgraphic")!=-1){var B=v.map.getScale();D=Ext.urlAppend(D,"SCALE="+B);}var z=this.baseParams||{};Ext.applyIf(z,{FORMAT:"image/gif"});if(D.indexOf("?")>0){D=Ext.urlEncode(z,D);}return D;},update:function(){var t=this.layerRecord.getLayer();if(!(t&&t.map)){return;}GeoExt.WMSLegend.superclass.update.apply(this,arguments);var o,l,u,m;o=[t.params.LAYERS].join(",").split(",");var s=[];var q=this.items.get(0);this.items.each(function(b){u=o.indexOf(b.itemId);if(u<0&&b!=q){s.push(b);}else{if(b!==q){l=o[u];var a=this.getLegendUrl(l,o);if(!OpenLayers.Util.isEquivalentUrl(a,b.url)){b.setUrl(a);}}}},this);for(u=0,m=s.length;u<m;u++){var r=s[u];this.remove(r);r.destroy();}for(u=0,m=o.length;u<m;u++){l=o[u];if(!this.items||!this.getComponent(l)){this.add({xtype:"gx_legendimage",url:this.getLegendUrl(l,o),itemId:l});}}this.doLayout();},beforeDestroy:function(){if(this.useScaleParameter===true){var b=this.layerRecord.getLayer();b&&b.events&&b.events.unregister("moveend",this,this.onLayerMoveend);}GeoExt.WMSLegend.superclass.beforeDestroy.apply(this,arguments);}});GeoExt.WMSLegend.supports=function(b){return b.getLayer() instanceof OpenLayers.Layer.WMS;};GeoExt.LayerLegend.types.gx_wmslegend=GeoExt.WMSLegend;Ext.reg("gx_wmslegend",GeoExt.WMSLegend);Ext.namespace("GeoExt.tree");GeoExt.tree.LayerContainer=Ext.extend(Ext.tree.AsyncTreeNode,{constructor:function(b){b=Ext.applyIf(b||{},{text:"Layers"});this.loader=b.loader instanceof GeoExt.tree.LayerLoader?b.loader:new GeoExt.tree.LayerLoader(Ext.applyIf(b.loader||{},{store:b.layerStore}));GeoExt.tree.LayerContainer.superclass.constructor.call(this,b);},recordIndexToNodeIndex:function(q){var h=this.loader.store;var m=h.getCount();var j=this.childNodes.length;var l=-1;for(var o=m-1;o>=0;--o){if(this.loader.filter(h.getAt(o))===true){++l;if(q===o||l>j-1){break;}}}return l;},destroy:function(){delete this.layerStore;GeoExt.tree.LayerContainer.superclass.destroy.apply(this,arguments);}});Ext.tree.TreePanel.nodeTypes.gx_layercontainer=GeoExt.tree.LayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.BaseLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(b){b=Ext.applyIf(b||{},{text:"Base Layer",loader:{}});b.loader=Ext.applyIf(b.loader,{baseAttrs:Ext.applyIf(b.loader.baseAttrs||{},{iconCls:"gx-tree-baselayer-icon",checkedGroup:"baselayer"}),filter:function(a){var e=a.getLayer();return e.displayInLayerSwitcher===true&&e.isBaseLayer===true;}});GeoExt.tree.BaseLayerContainer.superclass.constructor.call(this,b);}});Ext.tree.TreePanel.nodeTypes.gx_baselayercontainer=GeoExt.tree.BaseLayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.LayerLoader=function(b){Ext.apply(this,b);this.addEvents("beforeload","load");GeoExt.tree.LayerLoader.superclass.constructor.call(this);};Ext.extend(GeoExt.tree.LayerLoader,Ext.util.Observable,{store:null,filter:function(b){return b.getLayer().displayInLayerSwitcher==true;},baseAttrs:null,uiProviders:null,load:function(e,d){if(this.fireEvent("beforeload",this,e)){this.removeStoreHandlers();while(e.firstChild){e.removeChild(e.firstChild);}if(!this.uiProviders){this.uiProviders=e.getOwnerTree().getLoader().uiProviders;}if(!this.store){this.store=GeoExt.MapPanel.guess().layers;}this.store.each(function(a){this.addLayerNode(e,a);},this);this.addStoreHandlers(e);if(typeof d=="function"){d();}this.fireEvent("load",this,e);}},onStoreAdd:function(h,j,q,m){if(!this._reordering){var l=m.recordIndexToNodeIndex(q+j.length-1);for(var o=0;o<j.length;++o){this.addLayerNode(m,j[o],l);}}},onStoreRemove:function(f,g,j,h){if(!this._reordering){this.removeLayerNode(h,g);}},addLayerNode:function(l,h,g){g=g||0;if(this.filter(h)===true){var j=this.createNode({nodeType:"gx_layer",layer:h.getLayer(),layerStore:this.store});var m=l.item(g);if(m){l.insertBefore(j,m);}else{l.appendChild(j);}j.on("move",this.onChildMove,this);}},removeLayerNode:function(e,f){if(this.filter(f)===true){var g=e.findChildBy(function(a){return a.layer==f.getLayer();});if(g){g.un("move",this.onChildMove,this);g.remove();e.reload();}}},onChildMove:function(o,z,r,q,t){this._reordering=true;var u=this.store.getByLayer(z.layer);if(q instanceof GeoExt.tree.LayerContainer&&this.store===q.loader.store){q.loader._reordering=true;this.store.remove(u);var B;if(q.childNodes.length>1){var s=(t===0)?t+1:t-1;B=this.store.findBy(function(a){return q.childNodes[s].layer===a.getLayer();});t===0&&B++;}else{if(r.parentNode===q.parentNode){var w=q;do{w=w.previousSibling;}while(w&&!(w instanceof GeoExt.tree.LayerContainer&&w.lastChild));if(w){B=this.store.findBy(function(a){return w.lastChild.layer===a.getLayer();});}else{var v=q;do{v=v.nextSibling;}while(v&&!(v instanceof GeoExt.tree.LayerContainer&&v.firstChild));if(v){B=this.store.findBy(function(a){return v.firstChild.layer===a.getLayer();});}B++;}}}if(B!==undefined){this.store.insert(B,[u]);window.setTimeout(function(){q.reload();r.reload();});}else{this.store.insert(oldRecordIndex,[u]);}delete q.loader._reordering;}delete this._reordering;},addStoreHandlers:function(d){if(!this._storeHandlers){this._storeHandlers={add:this.onStoreAdd.createDelegate(this,[d],true),remove:this.onStoreRemove.createDelegate(this,[d],true)};for(var e in this._storeHandlers){this.store.on(e,this._storeHandlers[e],this);}}},removeStoreHandlers:function(){if(this._storeHandlers){for(var b in this._storeHandlers){this.store.un(b,this._storeHandlers[b],this);}delete this._storeHandlers;}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs);}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider);}attr.nodeType=attr.nodeType||"gx_layer";return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr);},destroy:function(){this.removeStoreHandlers();}});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{constructor:function(b){GeoExt.tree.LayerNodeUI.superclass.constructor.apply(this,arguments);},render:function(h){var j=this.node.attributes;if(j.checked===undefined){j.checked=this.node.layer.getVisibility();}GeoExt.tree.LayerNodeUI.superclass.render.apply(this,arguments);var a=this.checkbox;if(j.checkedGroup){var g=Ext.DomHelper.insertAfter(a,['<input type="radio" name="',j.checkedGroup,'_checkbox" class="',a.className,a.checked?'" checked="checked"':"",'"></input>'].join(""));g.defaultChecked=a.defaultChecked;Ext.get(a).remove();this.checkbox=g;}this.enforceOneVisible();},onClick:function(b){if(b.getTarget(".x-tree-node-cb",1)){this.toggleCheck(this.isChecked());}else{GeoExt.tree.LayerNodeUI.superclass.onClick.apply(this,arguments);}},toggleCheck:function(b){b=(b===undefined?!this.isChecked():b);GeoExt.tree.LayerNodeUI.superclass.toggleCheck.call(this,b);this.enforceOneVisible();},enforceOneVisible:function(){var g=this.node.attributes;var j=g.checkedGroup;if(j&&j!=="gx_baselayer"){var l=this.node.layer;var h=this.node.getOwnerTree().getChecked();var m=0;Ext.each(h,function(a){var b=a.layer;if(!a.hidden&&a.attributes.checkedGroup===j){m++;if(b!=l&&g.checked){b.setVisibility(false);}}});if(m===0&&g.checked==false){l.setVisibility(true);}}},appendDDGhost:function(g){var e=this.elNode.cloneNode(true);var f=Ext.DomQuery.select("input[type='radio']",e);Ext.each(f,function(a){a.name=a.name+"_clone";});g.appendChild(e);}});GeoExt.tree.LayerNode=Ext.extend(Ext.tree.AsyncTreeNode,{layer:null,layerStore:null,constructor:function(b){b.leaf=b.leaf||!(b.children||b.loader);if(!b.iconCls&&!b.children){b.iconCls="gx-tree-layer-icon";}if(b.loader&&!(b.loader instanceof Ext.tree.TreeLoader)){b.loader=new GeoExt.tree.LayerParamLoader(b.loader);}this.defaultUI=this.defaultUI||GeoExt.tree.LayerNodeUI;Ext.apply(this,{layer:b.layer,layerStore:b.layerStore});if(b.text){this.fixedText=true;}GeoExt.tree.LayerNode.superclass.constructor.apply(this,arguments);},render:function(g){var j=this.layer instanceof OpenLayers.Layer&&this.layer;if(!j){if(!this.layerStore||this.layerStore=="auto"){this.layerStore=GeoExt.MapPanel.guess().layers;
}var f=this.layerStore.findBy(function(a){return a.get("title")==this.layer;},this);if(f!=-1){j=this.layerStore.getAt(f).getLayer();}}if(!this.rendered||!j){var h=this.getUI();if(j){this.layer=j;if(j.isBaseLayer){this.draggable=false;Ext.applyIf(this.attributes,{checkedGroup:"gx_baselayer"});}if(!this.text){this.text=j.name;}h.show();this.addVisibilityEventHandlers();}else{h.hide();}if(this.layerStore instanceof GeoExt.data.LayerStore){this.addStoreEventHandlers(j);}}GeoExt.tree.LayerNode.superclass.render.apply(this,arguments);},addVisibilityEventHandlers:function(){this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});this.on({checkchange:this.onCheckChange,scope:this});},onLayerVisibilityChanged:function(){if(!this._visibilityChanging){this.getUI().toggleCheck(this.layer.getVisibility());}},onCheckChange:function(g,e){if(e!=this.layer.getVisibility()){this._visibilityChanging=true;var f=this.layer;if(e&&f.isBaseLayer&&f.map){f.map.setBaseLayer(f);}else{f.setVisibility(e);}delete this._visibilityChanging;}},addStoreEventHandlers:function(){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,update:this.onStoreUpdate,scope:this});},onStoreAdd:function(m,g,l){var h;for(var j=0;j<g.length;++j){h=g[j].getLayer();if(this.layer==h){this.getUI().show();break;}else{if(this.layer==h.name){this.render();break;}}}},onStoreRemove:function(e,f,g){if(this.layer==f.getLayer()){this.getUI().hide();}},onStoreUpdate:function(j,g,f){var h=g.getLayer();if(!this.fixedText&&(this.layer==h&&this.text!==h.name)){this.setText(h.name);}},destroy:function(){var d=this.layer;if(d instanceof OpenLayers.Layer){d.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this});}delete this.layer;var e=this.layerStore;if(e){e.un("add",this.onStoreAdd,this);e.un("remove",this.onStoreRemove,this);e.un("update",this.onStoreUpdate,this);}delete this.layerStore;this.un("checkchange",this.onCheckChange,this);GeoExt.tree.LayerNode.superclass.destroy.apply(this,arguments);}});Ext.tree.TreePanel.nodeTypes.gx_layer=GeoExt.tree.LayerNode;Ext.namespace("GeoExt.tree");GeoExt.tree.LayerParamLoader=function(b){Ext.apply(this,b);this.addEvents("beforeload","load");GeoExt.tree.LayerParamLoader.superclass.constructor.call(this);};Ext.extend(GeoExt.tree.LayerParamLoader,Ext.util.Observable,{param:null,delimiter:",",load:function(f,h){if(this.fireEvent("beforeload",this,f)){while(f.firstChild){f.removeChild(f.firstChild);}var j=(f.layer instanceof OpenLayers.Layer.HTTPRequest)&&f.layer.params[this.param];if(j){var g=(j instanceof Array)?j.slice():j.split(this.delimiter);Ext.each(g,function(a,d,b){this.addParamNode(a,b,f);},this);}if(typeof h=="function"){h();}this.fireEvent("load",this,f);}},addParamNode:function(h,g,l){var j=this.createNode({layer:l.layer,param:this.param,item:h,allItems:g,delimiter:this.delimiter});var m=l.item(0);if(m){l.insertBefore(j,m);}else{l.appendChild(j);}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs);}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider);}attr.nodeType=attr.nodeType||"gx_layerparam";return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr);}});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerParamNode=Ext.extend(Ext.tree.TreeNode,{layer:null,param:null,item:null,delimiter:null,allItems:null,constructor:function(e){var d=e||{};d.iconCls=d.iconCls||"gx-tree-layerparam-icon";d.text=d.text||d.item;this.param=d.param;this.item=d.item;this.delimiter=d.delimiter||",";this.allItems=d.allItems;GeoExt.tree.LayerParamNode.superclass.constructor.apply(this,arguments);this.getLayer();if(this.layer){if(!this.allItems){this.allItems=this.getItemsFromLayer();}if(this.attributes.checked==null){this.attributes.checked=this.layer.getVisibility()&&this.getItemsFromLayer().indexOf(this.item)>=0;}else{this.onCheckChange(this,this.attributes.checked);}this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});this.on({checkchange:this.onCheckChange,scope:this});}},getLayer:function(){if(!this.layer){var g=this.attributes.layer;if(typeof g=="string"){var f=this.attributes.layerStore||GeoExt.MapPanel.guess().layers;var e=f.findBy(function(a){return a.get("title")==g;});g=e!=-1?f.getAt(e).getLayer():null;}this.layer=g;}return this.layer;},getItemsFromLayer:function(){var b=this.layer.params[this.param];return b instanceof Array?b:(b?b.split(this.delimiter):[]);},createParams:function(e){var d={};d[this.param]=this.layer.params[this.param] instanceof Array?e:e.join(this.delimiter);return d;},onLayerVisibilityChanged:function(){if(this.getItemsFromLayer().length===0){this.layer.mergeNewParams(this.createParams(this.allItems));}var b=this.layer.getVisibility();if(b&&this.getItemsFromLayer().indexOf(this.item)!==-1){this.getUI().toggleCheck(true);}if(!b){this.layer.mergeNewParams(this.createParams([]));this.getUI().toggleCheck(false);}},onCheckChange:function(m,o){var q=this.layer;var h=[];var j=this.getItemsFromLayer();if(o===true&&q.getVisibility()===false&&j.length===this.allItems.length){j=[];}Ext.each(this.allItems,function(a){if((a!==this.item&&j.indexOf(a)!==-1)||(o===true&&a===this.item)){h.push(a);}},this);var l=(h.length>0);l&&q.mergeNewParams(this.createParams(h));if(l!==q.getVisibility()){q.setVisibility(l);}(!l)&&q.mergeNewParams(this.createParams([]));},destroy:function(){var b=this.layer;if(b instanceof OpenLayers.Layer){b.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this});}delete this.layer;this.un("checkchange",this.onCheckChange,this);GeoExt.tree.LayerParamNode.superclass.destroy.apply(this,arguments);}});Ext.tree.TreePanel.nodeTypes.gx_layerparam=GeoExt.tree.LayerParamNode;Ext.namespace("GeoExt.tree");GeoExt.tree.OverlayLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(b){b=Ext.applyIf(b||{},{text:"Overlays"});b.loader=Ext.applyIf(b.loader||{},{filter:function(a){var e=a.getLayer();return e.displayInLayerSwitcher===true&&e.isBaseLayer===false;}});GeoExt.tree.OverlayLayerContainer.superclass.constructor.call(this,b);}});Ext.tree.TreePanel.nodeTypes.gx_overlaylayercontainer=GeoExt.tree.OverlayLayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.TreeNodeUIEventMixin=function(){return{constructor:function(b){b.addEvents("rendernode","rawclicknode");this.superclass=arguments.callee.superclass;this.superclass.constructor.apply(this,arguments);},render:function(b){if(!this.rendered){this.superclass.render.apply(this,arguments);this.fireEvent("rendernode",this.node);}},onClick:function(b){if(this.fireEvent("rawclicknode",this.node,b)!==false){this.superclass.onClick.apply(this,arguments);}}};};Ext.namespace("GeoExt.plugins");GeoExt.plugins.TreeNodeRadioButton=Ext.extend(Ext.util.Observable,{constructor:function(b){Ext.apply(this.initialConfig,Ext.apply({},b));Ext.apply(this,b);this.addEvents("radiochange");GeoExt.plugins.TreeNodeRadioButton.superclass.constructor.apply(this,arguments);},init:function(b){b.on({rendernode:this.onRenderNode,rawclicknode:this.onRawClickNode,beforedestroy:this.onBeforeDestroy,scope:this});},onRenderNode:function(e){var a=e.attributes;if(a.radioGroup&&!a.radio){a.radio=Ext.DomHelper.insertBefore(e.ui.anchor,['<input type="radio" class="gx-tree-radio" name="',a.radioGroup,'_radio"></input>'].join(""));}},onRawClickNode:function(e,g){var f=g.getTarget(".gx-tree-radio",1);if(f){f.defaultChecked=f.checked;this.fireEvent("radiochange",e);return false;}},onBeforeDestroy:function(b){b.un("rendernode",this.onRenderNode,this);b.un("rawclicknode",this.onRenderNode,this);b.un("beforedestroy",this.onBeforeDestroy,this);}});Ext.preg("gx_treenoderadiobutton",GeoExt.plugins.TreeNodeRadioButton);Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintProviderField=Ext.extend(Ext.util.Observable,{target:null,constructor:function(b){this.initialConfig=b;Ext.apply(this,b);GeoExt.plugins.PrintProviderField.superclass.constructor.apply(this,arguments);},init:function(d){this.target=d;
var e={scope:this,render:this.onRender,beforedestroy:this.onBeforeDestroy};e[d instanceof Ext.form.ComboBox?"select":"valid"]=this.onFieldChange;d.on(e);},onRender:function(e){var d=this.printProvider||e.ownerCt.printProvider;if(e.store===d.layouts){e.setValue(d.layout.get(e.displayField));d.on({layoutchange:this.onProviderChange,scope:this});}else{if(e.store===d.dpis){e.setValue(d.dpi.get(e.displayField));d.on({dpichange:this.onProviderChange,scope:this});}else{if(e.initialConfig.value===undefined){e.setValue(d.customParams[e.name]);}}}},onFieldChange:function(j,g){var h=this.printProvider||j.ownerCt.printProvider;var f=j.getValue();this._updating=true;if(g){switch(j.store){case h.layouts:h.setLayout(g);break;case h.dpis:h.setDpi(g);}}else{h.customParams[j.name]=f;}delete this._updating;},onProviderChange:function(d,e){if(!this._updating){this.target.setValue(e.get(this.target.displayField));}},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);this.target.un("render",this.onRender,this);this.target.un("select",this.onFieldChange,this);this.target.un("valid",this.onFieldChange,this);this.printProvider.un("layoutchange",this.onProviderChange,this);this.printProvider.un("dpichange",this.onProviderChange,this);}});Ext.preg("gx_printproviderfield",GeoExt.plugins.PrintProviderField);Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintPageField=Ext.extend(Ext.util.Observable,{printPage:null,target:null,constructor:function(b){this.initialConfig=b;Ext.apply(this,b);GeoExt.plugins.PrintPageField.superclass.constructor.apply(this,arguments);},init:function(g){this.target=g;var e={beforedestroy:this.onBeforeDestroy,scope:this};var f=g instanceof Ext.form.ComboBox?"select":g instanceof Ext.form.Checkbox?"check":"valid";e[f]=this.onFieldChange;g.on(e);this.printPage.on({change:this.onPageChange,scope:this});this.printPage.printProvider.on({layoutchange:this.onLayoutChange,scope:this});this.setValue(this.printPage);},onFieldChange:function(j,g){var h=this.printPage.printProvider;var f=j.getValue();this._updating=true;if(j.store===h.scales||j.name==="scale"){this.printPage.setScale(g);}else{if(j.name=="rotation"){!isNaN(f)&&this.printPage.setRotation(f);}else{this.printPage.customParams[j.name]=f;}}delete this._updating;},onPageChange:function(b){if(!this._updating){this.setValue(b);}},onLayoutChange:function(g,e){var f=this.target;f.name=="rotation"&&f.setDisabled(!e.get("rotation"));},setValue:function(e){var d=this.target;d.suspendEvents();if(d.store===e.printProvider.scales||d.name==="scale"){if(e.scale){d.setValue(e.scale.get(d.displayField));}}else{if(d.name=="rotation"){d.setValue(e.rotation);}}d.resumeEvents();},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);this.target.un("select",this.onFieldChange,this);this.target.un("valid",this.onFieldChange,this);this.printPage.un("change",this.onPageChange,this);this.printPage.printProvider.un("layoutchange",this.onLayoutChange,this);}});Ext.preg("gx_printpagefield",GeoExt.plugins.PrintPageField);Ext.namespace("GeoExt");GeoExt.SliderTip=Ext.extend(Ext.slider.Tip,{hover:true,minWidth:10,offsets:[0,-10],dragging:false,init:function(b){GeoExt.SliderTip.superclass.init.apply(this,arguments);if(this.hover){b.on("render",this.registerThumbListeners,this);}this.slider=b;},registerThumbListeners:function(){var g,h;for(var f=0,j=this.slider.thumbs.length;f<j;++f){g=this.slider.thumbs[f];h=g.tracker.el;(function(b,a){a.on({mouseover:function(d){this.onSlide(this.slider,d,b);this.dragging=false;},mouseout:function(){if(!this.dragging){this.hide.apply(this,arguments);}},scope:this});}).apply(this,[g,h]);}},onSlide:function(e,g,f){this.dragging=true;return GeoExt.SliderTip.superclass.onSlide.apply(this,arguments);}});Ext.namespace("GeoExt");GeoExt.LayerOpacitySliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>{opacity}%</div>",compiledTemplate:null,init:function(b){this.compiledTemplate=new Ext.Template(this.template);GeoExt.LayerOpacitySliderTip.superclass.init.call(this,b);},getText:function(e){var d={opacity:e.value};return this.compiledTemplate.apply(d);}});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerOpacitySliderPlugin=Ext.extend(Ext.util.Observable,{constructor:function(b){Ext.apply(this.initialConfig,Ext.apply({},b));Ext.apply(this,b);this.addEvents("opacityslide");GeoExt.tree.LayerOpacitySliderPlugin.superclass.constructor.apply(this,arguments);},init:function(b){b.on({rendernode:this.onRenderNode,scope:this});},onRenderNode:function(j){var a=j.attributes;var o=j.layer;if(a.slider){this.indentMarkup=j.parentNode?j.parentNode.ui.getChildIndent():"";var q=j.id+"-tree-slider-";q=Ext.id(null,q);buf=["<br/>","<table><tr>","<td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>","<a id=",q,"></a>","</td>","</tr></table>"];Ext.DomHelper.insertAfter(j.ui.anchor,buf.join(""));var m=100;var l=new Ext.Slider({minValue:0,maxValue:100,value:m,width:100,aggressive:true,layer:o,plugins:new GeoExt.LayerOpacitySliderTip()});Ext.override(Ext.Slider,{getRatio:function(){var b=this.innerEl.getComputedWidth();var d=this.maxValue-this.minValue;return d==0?b:(b/d);}});l.on("change",function(e,d,b){this.layer.setOpacity(d/100);});l.render(q);}}});Ext.preg&&Ext.preg("gx_layeropacitysliderplugin",GeoExt.tree.LayerOpacitySliderPlugin);Ext.namespace("GeoNetwork");GeoNetwork.singleFile=true;Ext.namespace("GeoNetwork","GeoNetwork.Lang");GeoNetwork.Lang.de={featureInfoTooltipTitle:"Feature info",featureInfoTooltipText:"Click in the map to get feature info from all visible layers.",zoomToMaxExtentTooltipTitle:"Full extent",zoomToMaxExtentTooltipText:"Use this button to go to the full extent of the map.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Draw a box in the map to zoom in. You can also click in the map and map will zoom in by a factor of 2.",zoomoutTooltipTitle:"Zoom out",zoomoutTooltipText:"Click in the map or draw a box to zoom out.",dragTooltipTitle:"Pan map",dragTooltipText:"Press the left mouse button to drag the map.",previousTooltipTitle:"Previous map extent",previosTooltipText:"Click this button to go back to the previous map extent",nextTooltipTitle:"Next map extent",nextTooltipText:"Click this button to go to the next map extent",featureInfoTitle:"Feature info",layerManagerTabTitle:"Layer management",legendTabTitle:"Legend",scaleTitle:"Scale",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"There is no queryable map layer",WMSBrowserTab1:"Select",WMSBrowserTab3:"External",WMSBrowserPreviewTitle:"Preview layer",WMSBrowserAddButton:"Add",WMSBrowserDuplicateMsg:"Layer is already in the map",WMSBrowserPreviewWaitMsg:"Retrieving preview image",WMSBrowserConnectButton:"Connect",WMSBrowserConnectError:"There was an error connecting to the Web Map Service, please check the URL.",infoTitle:"Information","mf.print.mapTitle":"Title","mf.print.comment":"Comment","mf.print.dpi":"Resolution","mf.print.scale":"Scale","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Print","mf.print.generatingPDF":"Generating PDF","mf.print.unableToPrint":"It was not posible to print, try later","mf.error":"Error",selectExtentTooltipTitle:"Select extent",selectExtentTooltipText:"Select extent for catalog searches",printTooltipTitle:"Print",printTooltipText:"Print the current map",savewmcTooltipTitle:"Save web map context",savewmcTooltipText:"Saves web map context for current map","saveWMCFile.windowTitle":"Save Web Map Context","saveWMCFile.errorSaveWMC":"Could not save Web Map Context",loadwmcTooltipTitle:"Load web map context",loadwmcTooltipText:"Loads web map context in current map","selectWMCFile.windowTitle":"Load Web Map Context",selectWMCFile:"Select Web Map Context file","selectWMCFile.waitLoadingWMC":"Loading Web Map Context","selectWMCFile.loadButtonText":"Load","selectWMCFile.mergeButtonText":"Merge","selectWMCFile.errorLoadingWMC":"Could not load Web Map Context",opacityButtonText:"Opacity",opacityWindowTitle:"Opacity",metadataButtonText:"Metadata",removeButtonText:"Remove",addWMSButtonText:"Add WMS",addWMSWindowTitle:"Add WMS","layerInfoPanel.windowTitle":"Layer metadata","layerInfoPanel.titleField":"Title","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Queryable",layerList:"Layer list",baseLayerList:"Base layers","metadataResults.buttonText":"Metadata results","metadataResults.tooltipTitle":"Metadata results","metadataResults.tooltipText":"Go to metadata results page","metadataResults.alertTitle":"Metadata results","metadataResults.alertText":"No metadata results to show","mf.information":"Print","mf.print.pdfReady":"PDF ready","loadLayer.loadingMessage":"Loading layer","loadLayer.error.title":"Load layer","loadLayer.error.message":"The layer could not be loaded","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Loading...","disclaimer.buttonClose":"Close",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Straat",gazetteerAddressField3Label:"Plaats",gazetteerAddressField4Label:"Gemeente",gazetteerAddressField5Label:"Huisnummer",searchOptionButton:"Zoek",GazetteerWindowTitle:"Zoek adres",searchResults:"Zoekresultaten",errorTitle:"Fout",SearchOptionLoadFailureMsg:"Het is niet gelukt resultaten op te halen.\nMogelijk is de service tijdelijk niet beschikbaar. \n",gazetteerTooltipTitle:"Zoek op basis van een adres",gazetteerTooltipText:"Zoek een locatie op basis van een postcode, straatnaam, gemeente en/of plaats.",SearchOptionNoResults:"No results found",zoomlayerTooltipTitle:"Zoom auf Layer",zoomlayerTooltipText:"Verwenden Sie diese Taste, um das ganze Ausma� der ausgew�hlten Layer.","zoomlayer.selectLayerTitle":"Zoom auf Layer","zoomlayer.selectLayerText":"No layer selected",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Time position",WMSTimeMovieTitle:"Animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions"};
OpenLayers.Util.extend(OpenLayers.Lang.de,GeoNetwork.Lang.de);Ext.namespace("GeoNetwork","GeoNetwork.lang");GeoNetwork.lang.en={previousPage:"Move to previous page",nextPage:"Move to next page",upInPage:"Scroll up in the results",downInPage:"Scroll down in the results",example:"Example:",helper:"Suggestion:",toggleLayerManager:"Display map layer manager",tagName:"Element name:",enableTooltip:"Enable tooltips to get more information about each descriptors.",connectIssue:"Catalogue connection issue",connectIssueMsg:"Error 404. Can't connect to catalogue at url ",featureInfoTooltipTitle:"Feature info",featureInfoTooltipText:"Click in the map to get feature info from all visible layers.",zoomToMaxExtentTooltipTitle:"Full extent",zoomToMaxExtentTooltipText:"Use this button to go to the full extent of the map.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Draw a box in the map to zoom in. You can also click in the map and map will zoom in by a factor of 2.",zoomoutTooltipTitle:"Zoom out",zoomoutTooltipText:"Click in the map or draw a box to zoom out.",dragTooltipTitle:"Pan map",dragTooltipText:"Press the left mouse button to drag the map.",previousTooltipTitle:"Previous map extent",previosTooltipText:"Click this button to go back to the previous map extent",nextTooltipTitle:"Next map extent",nextTooltipText:"Click this button to go to the next map extent",featureInfoTitle:"Feature info",layerManagerTabTitle:"Layer management",legendTabTitle:"Legend",scaleTitle:"Scale",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"There is no queryable map layer",WMSBrowserTab1:"Select",WMSBrowserTab3:"External",WMSBrowserPreviewTitle:"Preview layer",WMSBrowserAddButton:"Add",WMSBrowserDuplicateMsg:"Layer is already in the map",WMSBrowserPreviewWaitMsg:"Retrieving preview image",WMSBrowserConnectButton:"Connect",WMSBrowserConnectError:"There was an error connecting to the Web Map Service, please check the URL.",infoTitle:"Information","mf.print.mapTitle":"Title","mf.print.comment":"Comment","mf.print.dpi":"Resolution","mf.print.scale":"Scale","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Print","mf.print.generatingPDF":"Generating PDF","mf.print.unableToPrint":"It was not possible to print, try later","mf.error":"Error",selectExtentTooltipTitle:"Select extent",selectExtentTooltipText:"Select extent for catalog searches",clearExtentTooltipTitle:"Remove extent",clearExtentTooltipText:"Remove extent (ie. no spatial criteria)",printTooltipTitle:"Print",printTooltipText:"Print the current map",savewmcTooltipTitle:"Save web map context",savewmcTooltipText:"Saves web map context for current map","saveWMCFile.windowTitle":"Save Web Map Context","saveWMCFile.errorSaveWMC":"Could not save Web Map Context",loadwmcTooltipTitle:"Load web map context",loadwmcTooltipText:"Loads web map context in current map","selectWMCFile.windowTitle":"Load Web Map Context",selectWMCFile:"Select Web Map Context file","selectWMCFile.waitLoadingWMC":"Loading Web Map Context","selectWMCFile.loadButtonText":"Load","selectWMCFile.mergeButtonText":"Merge","selectWMCFile.errorLoadingWMC":"Could not load Web Map Context",opacityButtonText:"Opacity",opacityWindowTitle:"Opacity",metadataButtonText:"Metadata",removeButtonText:"Remove",addWMSButtonText:"Add WMS",addWMSWindowTitle:"Add layer from a WMS service","layerInfoPanel.windowTitle":"Layer metadata","layerInfoPanel.titleField":"Title","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Queryable",layerList:"Layer list",baseLayerList:"Base layers","metadataResults.buttonText":"Metadata results","metadataResults.tooltipTitle":"Metadata results","metadataResults.tooltipText":"Go to metadata results page","metadataResults.alertTitle":"Metadata results","metadataResults.alertText":"No metadata results to show","featureInfoWindow.windowTitle":"Feature info","mf.information":"Print","mf.print.pdfReady":"PDF ready","loadLayer.loadingMessage":"Loading layer","loadLayer.error.title":"Load layer","loadLayer.error.message":"The layer could not be loaded","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Loading...","disclaimer.buttonClose":"Close",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Street",gazetteerAddressField3Label:"Place",gazetteerAddressField4Label:"'Gemeente'",gazetteerAddressField5Label:"House number",searchOptionButton:"Search",resetSearchForm:"Reset search form values.",GazetteerWindowTitle:"Search for address",searchResults:"Search results",errorTitle:"Error",SearchOptionLoadFailureMsg:"No results available. \n The service may be unavailable. \n",gazetteerTooltipTitle:"Search based on an address",gazetteerTooltipText:"Search for a location, based on postcode, street name, 'gemeente' or place.",SearchOptionNoResults:"No results found",zoomlayerTooltipTitle:"Zoom to layer",zoomlayerTooltipText:"Use this button to go to the full extent of the selected layer.","zoomlayer.selectLayerTitle":"Zoom to layer","zoomlayer.selectLayerText":"No layer selected",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Pick a time position",WMSTimeMovieTitle:"Play animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions",fullTextSearch:"Full text search",keyword:"Keyword",org:"Organisation",mapTypes:"Map types",rsIdentifier:"Resource identifier",inspireSearchOptions:"INSPIRE criteria",inspireannex:"INSPIRE annex",inspirerelated:"Related to INSPIRE",inspirerelatedtt:"INSPIRE dataset with report on the conformity regarding the data specification",inspiretheme:"INSPIRE theme",similarity:"Search accuracy",wkt:"WKT geometry",simpleViewMode:"Simple view",spatialSearch:"Spatial criteria",mdChangeDate:"Metadata change date",tempExtent:"Temporal extent",hitsPerPage:"Hits per page",sortBy:"Sort by",relevance:"Relevance",title:"Title",changeDate:"Change date",rating:"Rating",popularity:"Popularity",scaleDesc:"Scale (desc)",scaleAsc:"Scale (asc)","abstract":"Abstract",catalogue:"Catalogue",group:"Group",chooseGroup:"Select a group",md:"Metadata",tpl:"Template",category:"Category",advTextSearch:"Advanced text search options",eitherWords:"Either of the words",exactPhrase:"Exact phrase",allWords:"All of the words",withoutWords:"Without the words",precise:"Precise",imprecise:"Imprecise",relationType:"Relation type",within:"within",touches:"touches",crosses:"crosses",fullyOutsideOf:"fullyOutsideOf",encloses:"encloses",overlaps:"overlaps",intersection:"intersection",nearYou:"Near you",from:"From",to:"To",scaleNominator:"1:",scale:"Scale",digital:"Digital",hardCopy:"Hard copy",download:"Download",downloadable:"Download",interactive:"Interactive",resourceType:"Resource type",dataset:"Dataset",series:"Series",service:"Service",spatialRepType:"Spatial representation",video:"Video",vector:"Vector",textTable:"Text, table",tin:"Tin",stereoModel:"Stereo model",grid:"Grid",kind:"Kind",enterGetCapURL:"Enter a GetCapabilities URL to register a new service.",edit:"Edit",duplicate:"Duplicate","delete":"Delete",createChild:"Create child",privileges:"Privileges",categories:"Categories",otherActions:"Other actions",view:"View",zoomTo:"Zoom to",saveXml:"Save as XML",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",printSel:"Export (PDF)",printTT:"Print. Open a new page for printing.",newOwner:"New owner",updateCategories:"Update categories",updatePrivileges:"Update privileges",noneSelected:"None selected",none:"none",all:"all",allInPage:"all in page",select:"Select ",username:"User name",password:"password",login:"Login",logout:"Logout",administration:"Administration",validationReport:"Validation report",status:"Status",items:"items",item:"item",thumbnails:"Thumbnails",noimages:"No images to display",add:"Add",small:"Small",large:"Large",selectImage:"Select an image",selectFile:"Select a file",image:"Image",uploading:"Uploading ...",upload:"Upload",success:"Success",failure:"Failure",error:"Error",save:"Save",reset:"Reset",fileProcessedMsg:"Processed file ${res} on the server",suggestion:"Suggestion",logoSelect:"Select a logo",relatedResources:"Related resources",createLink:"Create links ...",featureCat:"Feature catalogue",serviceMd:"Service metadata",datasetMd:"Dataset metadata",parentMd:"Parent metadata",updateChildren:"Update children",records:"records",record:"record",help:"Help",publishError:"Publication failed.",outOfMemoryError:"Out of memory error.",publishErrorCode:"Error code:",saveAndCheck:"Save and check",saveAndClose:"Save and close",cancel:"Cancel",layout:"Layout",collapseAll:"Collapse all sections",editAttributes:"Manage attributes",chooseAType:"Choose a type",chooseAView:"Choose a view",viewMode:"View mode",errorAndStatusMsg:"Error. Status: ${status}, text: ${text}. Try again.",mdEditor:"Metadata editor",minorEditTT:"Do not update timestamp on save",editing:"Editing ${title} (${uuid})",GetCapabilitiesDocumentError:"Error loading service GetCapabilities document from URL: ",maxResults:"Number of results",mdTitle:"Metadata title",keywords:"Keywords",createRelation:"Create relation",createIfNotExistButton:"Create a new metadata record",getCapabilitiesLayer:"GetCapabilities layer",layerName:"Layer name",searching:"Searching ...",perThesaurus:" per thesaurus",anyThesaurus:"Any thesaurus",selectedKeywords:"Selected keywords",foundKeywords:"Available keywords",clear:"Clear",publish:"Publish",publishTooltip:"Publish current dataset to remote node. If dataset is already publish in that node, it will be updated.",publishSuccess:"Successful publication.",publishLayerAdded:" Layer added to map preview.",unpublish:"Unpublish",unpublishTooltip:"Remove current dataset from remote node.",unpublishSuccess:"Successful unpublication.",unpublishError:"Unpublication failed. ",check:"Check",errorDatasetNotFound:"Dataset not found.",datasetFound:"Dataset found and added to the map preview.",checkFailure:"Failed to check dataset in remote node.",addOnlineSourceTitle:"Link service to metadata",addOnlineSource:"Add links",addOnlineSourceTT:"Add an onlinesource section to the current metadata record pointing to the WMS/WFS/WCS services. If the service is a WMS, the layer could be displayed in the map viewer.",statusInformation:"Status information.",publishing:"Publishing ...",mapPreview:"Map preview",selectANode:"Select a node ...",geoPublisherWindowTitle:"Geo-publication: ",keywordSelectionWindowTitle:"Keywords selection",crsSelectionWindowTitle:"Coordinate reference system selection",linkedMetadataSelectionWindowTitle:"Related metadata selection",NotOwnerError:"You don't have privileges to update this related record.",ServiceUpdateError:"Error during service metadata update",associateService:"Link service metadata",associateDataset:"Link dataset metadata",logoSelectionWindow:"Choose a logo",fileUploadWindow:"Upload data or document",selectedCRS:"Selected coordinate systems",foundCRS:"Available coordinate systems",search:"Search",restrictSearchToMap:"Restrict search to map extent",selected:"selected",selectRegion:"Select a region ...",drawRectangle:"Draw rectangle",drawPolygon:"Draw polygon",drawPolygonTT:"Click the button and draw a polygon by clicking on the map for each points. Double click to create polygon last points.",drawCircle:"Draw circle",discovery:"Discovery",visualization:"Visualization",when:"When ?",anyTime:"Anytime",onSelection:"On selection",adminAction:"Other",newMetadata:"New metadata",chooseTemplate:"Select a template",process:"Process",suggestions:"Suggestions",applySelected:"Apply selected task",processParametersWindow:"Task parameters",noSuggestion:"No suggestion.",thumbnailUploadWindow:"Upload thumbnail",addThumbnail:"Add",createSmall:"Create small thumbnail",scalingFactor:"Scaling factor",smallScalingFactor:"Small scaling factor",type:"Record type",clickToClose:"Click to close",removeSelected:"Remove selected",ownerName:"Metadata record owner",setPrivileges:"Set privileges",setCategories:"Set categories",massiveOp:"Batch operation ",prepareDownload:"Download files",mdMenu:"Actions",deleteRecord:"Delete metadata record ?",deleteConfirm:"Are you sure to delete this metadata record?",deleteRecordSuccess:"Metadata deleted.",deleteRecordFailure:"Error when deleting metadata record.",advancedSearchOptions:"Advanced criteria",relatedservices:"Related service",relatedchildren:"Children",relatedfcats:"Related feature catalogue",relatedhasfeaturecat:"Datasets",relatedsources:"Source datasets",getMEF:"Export (ZIP)",metadataCategories:"Metadata categories",validityInfo:"Validation status: ",lastUpdate:"Last update: ",importMetadata:"Import metadata",validationStatus:"Validation status",valid:"Valid",notValid:"Not valid",notDetermined:"Not determined",addToMap:"Add to map: ",downloadLink:"Download: ",webLink:"Web link: ",viewKml:"Open in GoogleEarth: ",layerTree:"Layer manager",mdResultsLayer:"Search results",printLayer:"Print page",relatedservices:"Related services",relatedparent:"Parent",relateddatasets:"Related datasets",relatedchildren:"Children",relatedrelated:"Feature catalogue/dataset link",delete19110Relation:"Remove feature catalogue relation",newWindow:"New window",addAsXLink:"Add as linked element",contactSelectionWindowTitle:"Contact selection",selectedContacts:"Selected contacts",foundContacts:"Available",contactRole:"Contact role",mapNearYou:"Center map on your location",errorChangeProtocol:"Remove uploaded file before changing protocol of an online resource.",resultBy:" result(s) / ",subTemplateImport:"Directory entry import",xmlData:"XML",minorEdit:"Minor edit",minorEditTT:"",runASearch:"Run a search.",focusOnAny:"Move focus to the full text search field.",hideSearchForm:"Hide or display search form.",switchMode:"Switch visualization mode.",resetSearchForm:"Reset search form.",focusOnLogin:"Focus on the login form to access catalogue administration or logout if already logged in.",openAdmin:"Go to administration",displayInfoPanel:"Display the information panel.",displayHelpPanel:"Display this help.",SelectionWindowTitle:"Select from directory",found:"Records found",selected:"Selected","add-extent-from-geokeywordsreplace":"Replace existing extent","add-info-from-wmssetExtent":"Set extent","add-info-from-wmssetAndReplaceExtent":"Replace existing extent","add-info-from-wmssetCRS":"Set coordinate reference system","add-info-from-wmssetDynamicGraphicOverview":"Set graphic overview (using GetMap request URL)","add-info-from-wmswmsServiceUrl":"Service URL","linked-data-checkerlinkUrl":"URL to remove","related-metadata-checkeruuidToRemove":"Identifier to remove","add-service-info-from-wxssetAndReplaceOperations":"Replace existing operations","add-service-info-from-wxswxsServiceUrl":"Service URL",manageDirectories:"Manage directories",directory:"Directory",thesaurusManager:"Thesaurus manager",Theme:"Theme",thesaurusFilePath:"Thesaurus file (.rdf)",ThesaurusName:"Thesaurus name",createThesaurusFromURL:"from URL",createThesaurusFromRepository:"from thesaurus repository",creationMode:"Create",thesaurusFromRepository:"Thesaurus",externalThesaurusURL:"URL",thesaurusCreation:"Add a thesaurus",Type:"Type",Activated:"Activated",emptyThesaurus:"New empty thesaurus",thesaurusFromFile:"From local file",thesaurusFromURL:"From remote file (URL)",id:"Identifier",label:"Label",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Label",newDefinition:"Definition",selDirectoryTT:"Select a type of directory. A directory group all elements having the same root element name (eg. gmd:CI_ResponsibleParty is a contact directory)",privTplElTT:"Manage privileges for the current selection.",addTplElTT:"Add an element from an XML fragment to a directory. The destination directory is based on the root element name (eg. gmd:CI_ResponsibleParty).",copyTplElTT:"Create a new entry in the directory from the current selection.",delTplElTT:"Remove selected entry from the directory."};
OpenLayers.Util.extend(OpenLayers.Lang.en,GeoNetwork.lang.en);Ext.namespace("GeoNetwork","GeoNetwork.Lang");GeoNetwork.Lang.fr={previousPage:"Page précédente",nextPage:"Page suivante",upInPage:"Se déplacer vers le haut des résultats",downInPage:"Se déplacer vers le bas des résultats",example:"Exemple :",helper:"Suggestion :",toggleLayerManager:"Afficher le gestionnaire de couches",tagName:"Nom de l'élément :",enableTooltip:"Activer les info-bulles pour obtenir une description complète de chaque champs.",connectIssue:"Échec de connexion au catalogue",connectIssueMsg:"Erreur 404. Impossible de se connecter à l'URL ",featureInfoTooltipTitle:"caractéristique",featureInfoTooltipText:"Cliquer sur la carte pour obtenir des informations sur les données affichees.",zoomToMaxExtentTooltipTitle:"Zoom optimal",zoomToMaxExtentTooltipText:"Utiliser ce bouton pour tout afficher.",zoominTooltipTitle:"Zoomer",zoominTooltipText:"Dessiner un rectangle sur la carte pour zoomer. En cliquant sur la carte, le facteur de zoom est 2.",zoomoutTooltipTitle:"Dézoomer",zoomoutTooltipText:"Cliquer sur la carte ou dessiner un rectangle pour dézoomer.",dragTooltipTitle:"Main",dragTooltipText:"Appuyer sur le bouton gauche de la souris pour déplacer la carte.",previousTooltipTitle:"Revenir au zoom précédant",previosTooltipText:"Cliquer ici pour revenir au zoom précédant",nextTooltipTitle:"Zoom suivant",nextTooltipText:"Cliquer ici pour avancer au zoom suivant",featureInfoTitle:"Caractéristique",layerManagerTabTitle:"Gérer les couches",legendTabTitle:"Légende",scaleTitle:"Echelle",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"Il n'existe pas de carte correspondant à la requête",WMSBrowserTab1:"Sélectionner",WMSBrowserTab3:"Externe",WMSBrowserPreviewTitle:"Aperçu de la couche",WMSBrowserAddButton:"Ajouter",WMSBrowserDuplicateMsg:"La couche est déjà affichée",WMSBrowserPreviewWaitMsg:"Récupérer l'image precedente",WMSBrowserConnectButton:"Connexion",WMSBrowserConnectError:"Erreur de connexion au service Web, merci de vérifier l'URL.",infoTitle:"Information","mf.print.mapTitle":"Titre","mf.print.comment":"Commentaire","mf.print.dpi":"Résolution","mf.print.scale":"Échelle","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Imprimer","mf.print.generatingPDF":"Générer PDF","mf.print.unableToPrint":"Impression impossible, essayer plus tard","mf.error":"Erreur",selectExtentTooltipTitle:"Définir une emprise",selectExtentTooltipText:"Dessiner une emprise à utiliser comme critère géographique",clearExtentTooltipTitle:"Supprimer l'emprise",clearExtentTooltipText:"Supprimer l'emprise (ie. aucun critère géographique)",printTooltipTitle:"Imprimer",printTooltipText:"Imprimer la carte actuelle",savewmcTooltipTitle:"Sauvegarder environnement (vue, paramètres,etc.)",savewmcTooltipText:"Sauvegarder environnement pour la carte actuelle","saveWMCFile.windowTitle":"Sauvegarder l'environnement","saveWMCFile.errorSaveWMC":"Sauvegarde de l'environnement impossible",loadwmcTooltipTitle:"Restaurer l'environnement",loadwmcTooltipText:"Restaurer l'environnement dans la carte actuelle","selectWMCFile.windowTitle":"Restaurer l'environnement",selectWMCFile:"Ouvrir un environnement","selectWMCFile.waitLoadingWMC":"Restauration de l'environnement en cours...","selectWMCFile.loadButtonText":"Charger","selectWMCFile.mergeButtonText":"Fusionner","selectWMCFile.errorLoadingWMC":"Chargement de l'environnement impossible",opacityButtonText:"Transparence",opacityWindowTitle:"Transparence",metadataButtonText:"Metadata",removeButtonText:"Supprimer",addWMSButtonText:"Ajouter WMS",addWMSWindowTitle:"Ajouter WMS","layerInfoPanel.windowTitle":"Couche metadata","layerInfoPanel.titleField":"Titre","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Requête",layerList:"Liste des couches","metadataResults.buttonText":"Résultats Metadata","metadataResults.tooltipTitle":"résultats Metadata","metadataResults.tooltipText":"Aller a la page des résultats Metadata","metadataResults.alertTitle":"Résultats Metadata","metadataResults.alertText":"Pas de résultats Metadata","mf.information":"Imprimer","mf.print.pdfReady":"PDF prêt","loadLayer.loadingMessage":"Chargement de la couche","loadLayer.error.title":"Charger la couche","loadLayer.error.message":"La couche ne peut être chargée","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Chargement...","disclaimer.buttonClose":"Fermer",gazetteerAddressField1Label:"Code postal",gazetteerAddressField2Label:"Street",gazetteerAddressField3Label:"Place",gazetteerAddressField4Label:"Municipalité",gazetteerAddressField5Label:"Numéro",searchOptionButton:"Recherche",GazetteerWindowTitle:"Résultat pour l'adresse",searchResults:"Recherche les résultats",resetSearchForm:"Réinitialiser le formulaire de recherche.",errorTitle:"Erreur",SearchOptionLoadFailureMsg:"Pas de résultats trouvés. \n Le serveur peut être indisponible. \n",gazetteerTooltipTitle:"Recherche basée sur l'adresse",gazetteerTooltipText:"Recherche du lieu, basé sur le code postal, la rue, la municipalité ou place.",SearchOptionNoResults:"Pas de résultats trouvés.",zoomlayerTooltipTitle:"Zoom sur une couche",zoomlayerTooltipText:"Utilisez ce bouton pour accéder à la pleine mesure de le calque sélectionné.","zoomlayer.selectLayerTitle":"Zoom sur une couche","zoomlayer.selectLayerText":"No de calque sélectionné",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Time position",WMSTimeMovieTitle:"Animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions",fullTextSearch:"Rechercher ...",keyword:"Mots-clés",org:"Organisation",mapTypes:"Type de données",rsIdentifier:"Identifiant de la ressource",inspireSearchOptions:"INSPIRE",inspireannex:"Annexe",inspirerelated:"Données soumises à INSPIRE",inspirerelatedtt:"Données décrivant un rapport sur la conformité vis-à-vis des spécifications sur les données INSPIRE.",inspiretheme:"Thème",similarity:"Précision",wkt:"Geométrie WKT",spatialSearch:"Critères géographiques",mdChangeDate:"Date de mise à jour des métadonnées",tempExtent:"Étendue temporelle",hitsPerPage:"Nombre par page",sortBy:"Trier par",relevance:"Pertinence",title:"Titre",changeDate:"Date de mise à jour",rating:"Note",popularity:"Popularité",scaleDesc:"Échelle (desc)",scaleAsc:"Échelle (asc)","abstract":"Résumé",catalogue:"Catalogue",group:"Groupe",md:"Métadonnée",tpl:"Modèle",category:"Catégorie",advTextSearch:"Options avancées",eitherWords:"Tous - au moins un des mots suivants",exactPhrase:"Cette expression exacte",allWords:"Tous les mots suivants",withoutWords:"Aucun des mots suivants",precise:"Précis",imprecise:"Flou",relationType:"Type de relation",within:"À l'intérieur",touches:"Touche",crosses:"Travers",fullyOutsideOf:"En dehors",encloses:"Contient",overlaps:"Chevauche",intersection:"Intersecte",nearYou:"À proximité",from:"du",to:"au",scaleNominator:"1/",scale:"Échelle",digital:"Numérique",hardCopy:"Copie papier",download:"Télécharger",downloadable:"Téléchargeable",interactive:"Interactive",resourceType:"Type de ressource",dataset:"Série de données",series:"Ensemble de séries de données",service:"Service",spatialRepType:"Représentation spatiale",video:"Vidéo",vector:"Vecteur",textTable:"Tableau, Texte",tin:"Tin",stereoModel:"Vue 3D",grid:"Raster",kind:"Type",enterGetCapURL:"Saisir l'URL d'un GetCapabilities pour enregistrer un nouveau service",edit:"Éditer",duplicate:"Dupliquer","delete":"Supprimer",createChild:"Créer un enfant",privileges:"Privilèges",categories:"Catégories",otherActions:"Autres actions",view:"Consulter",zoomTo:"Zoomer vers",saveXml:"Export (XML)",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",printSel:"Export (PDF)",printTT:"Imprimer. Ouvre une nouvelle page adaptée à l'impression.",newOwner:"Associer un autre auteur",updateCategories:"Mettre à jour les catégories",updatePrivileges:"Mettre à jour les privilèges",noneSelected:"Sélection vide",none:"aucun",all:"tous",allInPage:"tous dans la page",select:"Selectionner ",username:"Identifiant",password:"Mot de passe",login:"Connexion",logout:"Déconnexion",administration:"Administration",validationReport:"Rapport de validation",status:"Status",items:"éléments",item:"élément",thumbnails:"Aperçus",noimages:"Aucun aperçu disponible",add:"Ajouter",small:"Petit",large:"Grand",selectImage:"Sélectionner une image",selectFile:"Sélectionner un fichier",image:"Image",uploading:"Transfert en cours ...",upload:"Transférer",success:"Succès",failure:"Échec",error:"Erreur",save:"Sauver",reset:"Réinitialiser",fileProcessedMsg:"Traitement du fichier ${res} réalisé sur le serveur",suggestion:"Suggestion",logoSelect:"Sélectionner un logo",relatedResources:"Ressources associées",createLink:"Associer ...",featureCat:"Catalogue d'attributs",serviceMd:"Métadonnées de service",datasetMd:"Métadonnées de données",parentMd:"Parent",updateChildren:"Mettre à jour les enfants",records:"enregistrements",record:"enregistrement",help:"Aide",publishError:"Échec lors de la publication.",outOfMemoryError:"Érreur de dépassement de mémoire.",publishErrorCode:"Code érreur :",saveAndCheck:"Sauver et valider",saveAndClose:"Sauver et fermer",cancel:"Annuler",layout:"Mise en page",Resolution:"Résolution",collapseAll:"Réduire les sections",editAttributes:"Gérer les attributs",chooseAType:"Choisir un type",chooseAView:"Choisir une vue",viewMode:"Affichage",errorAndStatusMsg:"Érreur. Status : ${status}, description : ${text}. Essayer à nouveau.",mdEditor:"Editeur de métadonnée",editing:"${title} (${uuid}) en cours d'édition",GetCapabilitiesDocumentError:"Erreur lors de la tentative de récupération des informations du service (ie. GetCapabilities) avec l'adresse: ",maxResults:"Nombre de résultats",mdTitle:"Titre de la métadonnée",keywords:"Mots-clés",createRelation:"Créer la relation",createIfNotExistButton:"Créer une nouvelle métadonnée",getCapabilitiesLayer:"Couches du GetCapabilities",layerName:"Nom de la couche",searching:"Recherche en cours ...",perThesaurus:" par thesaurus",anyThesaurus:"Tous les thésaurus",selectedKeywords:"Mots clés selectionnés",foundKeywords:"Mots clés trouvés",clear:"Effacer",publish:"Publier",publishTooltip:"Publier le jeu de données en cours dans le nœud distant. Si le jeu de données est présent, il est mis à jour.",publishSuccess:"Publication effectuée.",publishLayerAdded:" Couche ajoutée à la carte.",unpublish:"Dépublier",unpublishTooltip:"Supprimer le jeu de données en cours dans le nœud distant.",unpublishSuccess:"Dépublication effectuée.",unpublishError:"Echec de la dépublication. ",check:"Vérifier",errorDatasetNotFound:"Jeu de données non trouvé.",datasetFound:"Jeu de données trouvé et ajouté à la carte.",checkFailure:"Echec de la vérification de la présence du jeu de données dans le nœud distant.",addOnlineSourceTitle:"Lier le service à la fiche",addOnlineSource:"Ajouter les liens",addOnlineSourceTT:"Ajouter les informations pour faire la liaison avec la couche dans le service WMS/WFS/WCS.",statusInformation:"Status.",publishing:"Publication en cours ...",mapPreview:"Carte",selectANode:"Choisir un nœud ...",geoPublisherWindowTitle:"Géo-publication : ",keywordSelectionWindowTitle:"Sélection de mots clés",crsSelectionWindowTitle:"Sélection des systèmes de coordonnées",linkedMetadataSelectionWindowTitle:"Sélection des métadonnées associées",NotOwnerError:"Vous n'avez pas les privilèges pour mettre à jour la métadonnée associée.",ServiceUpdateError:"Erreur lors de la mise à jour de la métadonnée.",associateService:"Associer une métadonnée de service",associateDataset:"Associer une métadonnée de données",logoSelectionWindow:"Sélectionner un logo",fileUploadWindow:"Ajouter des données ou des documents",selectedCRS:"Systèmes sélectionnés",foundCRS:"Systèmes disponibles",search:"Rechercher",restrictSearchToMap:"Restreindre la recherche à la carte",selected:"sélectionné(s)",selectRegion:"Choisir une région ...",drawRectangle:"Créer un rectangle",drawPolygon:"Créer un polygone",drawCircle:"Créer un cercle",discovery:"Découverte",visualization:"Visualisation",when:"Critères temporels",anyTime:"N'importe quand",onSelection:"Sur la sélection",adminAction:"Autres",newMetadata:"Nouvelle métadonnée",chooseGroup:"Selectionner un groupe",chooseTemplate:"Sélectionner un modèle",process:"Traiter",suggestions:"Suggestions",applySelected:"Appliquer le traitement sélectionné",processParametersWindow:"Paramètres du traitement",noSuggestion:"Aucune suggestion.",thumbnailUploadWindow:"Ajouter un aperçu",addThumbnail:"Ajouter",createSmall:"Créer un petit aperçu",scalingFactor:"Facteur d'échelle",smallScalingFactor:"Facteur d'échelle",type:"Type de fiche",clickToClose:"Cliquer pour fermer",removeSelected:"Supprimer la sélection","metadata.update.new":"Chargement en cours ...","metadata.update.forget.new":"Ré-initialisation en cours ...",ownerName:"Rédacteur de la métadonnée",setPrivileges:"Définir les privilèges",setCategories:"Choisir les catégories",massiveOp:"Opération sur la sélection",prepareDownload:"Télécharger les fichiers",mdMenu:"Actions",simpleViewMode:"Vue simplifiée",deleteRecord:"Supprimer la métadonnée ?",deleteConfirm:"Confirmez-vous la suppression de la métadonnée ?",deleteRecordSuccess:"Metadonnée supprimée",deleteRecordFailure:"Échec lors de la suppression de la métadonnée",advancedSearchOptions:"Critères avancés",getMEF:"Export (ZIP)",metadataCategories:"Catégories",validityInfo:"Information sur la validation",lastUpdate:"Dernière mise à jour : ",importMetadata:"Import de métadonnées",validationStatus:"Validation ",valid:"Valide",notValid:"Non valide",notDetermined:"Non déterminé",addToMap:"Ajouter à la carte : ",downloadLink:"Télécharger : ",webLink:"Site web : ",viewKml:"Visualiser avec GoogleEarth : ",layerTree:"Gestion des couches",mdResultsLayer:"Résultats de la recherche",printLayer:"Page de l'impression",relatedservices:"Services associés",relatedparent:"Métadonnée parent",relateddatasets:"Métadonnées associées",relatedchildren:"Enfants",relatedrelated:"Relation catalogue d'attributs/données",relatedfcats:"Relation catalogue d'attributs/données",relatedhasfeaturecat:"Donnée",relatedsources:"Données sources",delete19110Relation:"Supprimer le lien cat. d'attributs",newWindow:"Nouvelle fenêtre",addAsXLink:"Ajout d'un élément lié",contactSelectionWindowTitle:"Sélection des contacts",selectedContacts:"Contacts sélectionnés",foundContacts:"Contacts disponibles",contactRole:"Rôle du contact",mapNearYou:"Centrer la carte sur votre position",create:"Créer",errorChangeProtocol:"Impossible de changer le protocol lorsqu'un fichier est attaché. Supprimer le fichier.",resultBy:" resultat(s) / ",subTemplateImport:"Importer un élément dans un annuaire",xmlData:"XML",minorEdit:"Modif. mineure",minorEditTT:"Lorsque cette option est activée, la date de mise à jour des métadonnées n'est pas changée. Lors de l'utilisation des suggestions, ou de la mise à jour d'une imagette, cette option est sans effet, la date est mise à jour.",runSearch:"Lancer la recherche.",focusOnAny:"Déplacer le curseur sur le critère plein texte.",hideSearchForm:"Afficher ou cacher le formulaire de recherche.",switchMode:"Changer de mode de visualisation.",resetSearchForm:"Réinitialiser le formulaire de recherche.",focusOnLogin:"Déplacer le curseur sur le formulaire de connexion ou déconnexion si vous êtes connecté.",openAdmin:"Administrer le catalogue",displayInfoPanel:"Afficher la page d'information.",displayHelpPanel:"Afficher cette page d'aide.",SelectionWindowTitle:"Rechercher dans l'annuaire",found:"Enregistrements trouvés","add-extent-from-geokeywordsreplace":"Remplacer les étendues géographiques existantes","add-info-from-wmssetExtent":"Définir l'étendue","add-info-from-wmssetAndReplaceExtent":"Remplacer les étendues existantes","add-info-from-wmssetCRS":"Ajouter les systèmes de coordonnées","add-info-from-wmssetDynamicGraphicOverview":"Définir l'aperçu (en ajoutant une URL vers une requête GetMap)","add-info-from-wmswmsServiceUrl":"URL du service","linked-data-checkerlinkUrl":"Lien à supprimer","related-metadata-checkeruuidToRemove":"Identifiant à supprimer","add-service-info-from-wxssetAndReplaceOperations":"Remplacer les opérations existantes","add-service-info-from-wxswxsServiceUrl":"URL du service",manageDirectories:"Gestion des annuaires",directory:"Annuaire",thesaurusManager:"Gestion des thésaurus",Theme:"Thème",thesaurusFilePath:"Fichier (.rdf)",ThesaurusName:"Nom du thésaurus",createThesaurusFromURL:"A partir d'une URL",createThesaurusFromRepository:"A partir du dépôt partagé",creationMode:"Créer",thesaurusFromRepository:"Thésaurus",externalThesaurusURL:"URL",thesaurusCreation:"Ajout d'un thésaurus",Type:"Type",Activated:"Activé",emptyThesaurus:"Nouveau thésaurus vide",thesaurusFromFile:"A partir d'un fichier local",thesaurusFromURL:"A partir d'un fichier distant (URL)",id:"Identifiant",label:"Libellé",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Libellé",newDefinition:"Définition",selDirectoryTT:"Choisir un type d'annuaire. Un annuaire est constitué d'éléments ayant la même balise racine (eg. les éléments gmd:CI_ResponsibleParty font partie de l'annuaire de contact)",privTplElTT:"Gérer les privilèges sur la sélection.",addTplElTT:"Ajouter un élément à partir d'un fragment d'XML. L'annuaire cible est basé sur le nom de la balise racine (eg. gmd:CI_ResponsibleParty).",copyTplElTT:"Créer un nouvel élément dans l'annuaire à partir de l'élément sélectionné.",delTplElTT:"Supprimer la sélection."};
OpenLayers.Util.extend(OpenLayers.Lang.fr,GeoNetwork.Lang.fr);Ext.namespace("GeoNetwork","GeoNetwork.Lang");GeoNetwork.Lang.nl={featureInfoTooltipTitle:"Attribuut-informatie",featureInfoTooltipText:"Klik in de kaart om attribuut-informatie op te vragen van alle zichtbare lagen.",zoomToMaxExtentTooltipTitle:"Volledig kaartbeeld",zoomToMaxExtentTooltipText:"Klik op deze button om naar het volledig kaartbeeld te zoomen.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Trek een kader in kaart om in te zoomen. Ook kan er geklikt worden in de kaart waarna er met een factor 2 ingezoomd wordt.",zoomoutTooltipTitle:"Zoom uit",zoomoutTooltipText:"Klik in de kaart om gecentreerd op dit punt met een factor 2 uit te zoomen. Ook kan er een kader in de kaart getrokken worden, hoe kleiner dit kader hoe verder er uitgezoomd zal worden.",dragTooltipTitle:"Verschuif kaart",dragTooltipText:"Houd de linker muisknop ingedrukt en versleep de kaart.",previousTooltipTitle:"Vorige kaart extent",previosTooltipText:"Klik op deze button om terug te gaan naar de vorige kaart extent",nextTooltipTitle:"Volgende kaart extent",nextTooltipText:"Klik op deze button om verder te gaan naar de volgende kaart extent",featureInfoTitle:"Attribuut-informatie",layerManagerTabTitle:"Kaartlagenbeheer",legendTabTitle:"Legenda",scaleTitle:"Schaal",xTitle:"X",yTitle:"Y",projectionTitle:"Projectie",FeatureInfoNotQueryable:"Er is geen bevraagbare kaartlaag",WMSBrowserTab1:"Selecteren",WMSBrowserTab3:"Extern",WMSBrowserPreviewTitle:"Preview kaartlaag",WMSBrowserAddButton:"Voeg toe",WMSBrowserDuplicateMsg:"Kaartlaag is reeds aanwezig.",WMSBrowserPreviewWaitMsg:"Preview image ophalen",WMSBrowserConnectButton:"Maak verbinding",WMSBrowserConnectError:"Er is een fout opgetreden bij het maken van de verbinding, controleer de URL.",infoTitle:"Informatie","mf.print.mapTitle":"Titel","mf.print.comment":"Opmerkingen","mf.print.dpi":"Resolutie","mf.print.scale":"Schaal","mf.print.rotation":"Rotatie","mf.print.resetPos":"Terug naar begininstellingen","mf.print.print":"Print","mf.print.generatingPDF":"Aanmaken PDF","mf.print.unableToPrint":"Het was helaas niet mogelijk om te printen, probeert u het svp later nogmaals","mf.error":"Fout",selectExtentTooltipTitle:"Begrens zoekgebied",selectExtentTooltipText:"Begrens het zoekgebied door in de kaart een kader te trekken.",printTooltipTitle:"Print",printTooltipText:"Print de huidige kaart",savewmcTooltipTitle:"Opslaan WMC",savewmcTooltipText:"Sla een Web Map Context document op.","saveWMCFile.windowTitle":"Opslaan Web Map Context","saveWMCFile.errorSaveWMC":"Kon het WMC bestand niet opslaan",loadwmcTooltipTitle:"Open WMC",loadwmcTooltipText:"Opent een bestaand Web Map Context document in de kaart viewer","selectWMCFile.windowTitle":"Openen Web Map Context",selectWMCFile:"Select WMC bestand","selectWMCFile.waitLoadingWMC":"Laden Web Map Context","selectWMCFile.loadButtonText":"Openen","selectWMCFile.mergeButtonText":"Samenvoegen","selectWMCFile.errorLoadingWMC":"Kon het Web Map Context bestand niet openen",opacityButtonText:"Opaciteit",opacityWindowTitle:"Opaciteit",metadataButtonText:"Metadata",removeButtonText:"Verwijderen",addWMSButtonText:"Voeg WMS toe",addWMSWindowTitle:"Voeg WMS toe","layerInfoPanel.windowTitle":"Metadata van de kaartlaag","layerInfoPanel.titleField":"Titel","layerInfoPanel.descriptionField":"Samenvatting","layerInfoPanel.queryableField":"Bevraagbaar",layerList:"Kaartlagen",baseLayerList:"Ondergrond","metadataResults.buttonText":"Metadata resultaten","metadataResults.tooltipTitle":"Metadata resultaten","metadataResults.tooltipText":"Ga naar de metadata resultaatpagina","metadataResults.alertTitle":"Metadata resultaten","metadataResults.alertText":"Geen metadata resultaten om te tonen","featureInfoWindow.windowTitle":"Attribuut-informatie","mf.information":"Print","mf.print.pdfReady":"PDF gereed","loadLayer.loadingMessage":"Ophalen kaartlaag","loadLayer.error.title":"Ophalen kaartlaag","loadLayer.error.message":"De kaartlaag kon niet worden geladen","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Laden...","disclaimer.buttonClose":"Sluiten",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Straat",gazetteerAddressField3Label:"Plaats",gazetteerAddressField4Label:"Gemeente",gazetteerAddressField5Label:"Huisnummer",searchOptionButton:"Zoek",GazetteerWindowTitle:"Zoek adres",searchResults:"Zoekresultaten",errorTitle:"Fout",SearchOptionLoadFailureMsg:"Het is niet gelukt resultaten op te halen.\nMogelijk is de service tijdelijk niet beschikbaar. \n",gazetteerTooltipTitle:"Zoek op basis van een adres",gazetteerTooltipText:"Zoek een locatie op basis van een postcode, straatnaam, gemeente en/of plaats.",SearchOptionNoResults:"Geen resultaten gevonden",zoomlayerTooltipTitle:"Zoom naar laag",zoomlayerTooltipText:"Gebruik deze knop om naar de volledige omvang van de geselecteerde laag.","zoomlayer.selectLayerTitle":"Zoom naar laag","zoomlayer.selectLayerText":"Geen laag geselecteerd",layerStylesWindowTitle:"Kaartlaag stijlen",layerStylesPreviewTitle:"Maak een voorvertoning van de legenda",selectStyleButton:"Selecteer kaartstijl",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Kies een tijdstip",WMSTimeMovieTitle:"Speel een animatie af",wmsTimeUpdateButtonText:"Doorvoeren",WMSTimeAnimationCheckbox:"Speel laatste ${steps} tijdstippen af"};OpenLayers.Util.extend(OpenLayers.Lang.nl,GeoNetwork.Lang.nl);Ext.namespace("GeoNetwork");GeoNetwork.Lang={};GeoNetwork.Util={defaultLocale:"en",locales:[["ar","عربي","ara"],["ca","Català","cat"],["cn","中文","chi"],["de","Deutsch","ger"],["en","English","eng"],["es","Español","spa"],["fr","Français","fre"],["nl","Nederlands","dut"],["no","Norsk","nor"],["pt","Рortuguês","por"],["ru","Русский","rus"]],setLang:function(g,e){g=g||GeoNetwork.Util.defaultLocale;OpenLayers.Lang.setCode(g);var f=document.createElement("script");f.type="text/javascript";f.src=e+"/js/ext/src/locale/ext-lang-"+g+".js";document.getElementsByTagName("head")[0].appendChild(f);},getCatalogueLang:function(d){var e;for(e=0;e<GeoNetwork.Util.locales.length;e++){if(GeoNetwork.Util.locales[e][0]===d){return GeoNetwork.Util.locales[e][0];}}return GeoNetwork.Util.defaultLocale;},getISO3LangCode:function(d){var e;for(e=0;e<GeoNetwork.Util.locales.length;e++){if(GeoNetwork.Util.locales[e][0]===d){return GeoNetwork.Util.locales[e][2];}}return"eng";},getParameters:function(C){var q=OpenLayers.Util.getParameters(C);if(OpenLayers.String.contains(C,"#")){var B=C.indexOf("#")+1;var w=C.length;var D=C.substring(B,w);var z=D.split(/[\/]/);for(var u=0,t=z.length;u<t;++u){var v=z[u].split("=");var r=v[0];var s=v[1]||"";q[r]=s;}}return q;},getBaseUrl:function(b){return b.substring(0,b.indexOf("?")||b.indexOf("#")||b.length);}};Ext.namespace("GeoNetwork");GeoNetwork.Catalogue=Ext.extend(Ext.util.Observable,{SERVERURL:null,URL:null,LANG:"en",DEFAULT_LANG:"en",EDITOR_MODE:{IN_OTHER_WINDOW:1,IN_EDITOR_POPUP:2},editMode:1,hostUrl:null,servlet:null,extentMap:null,services:{},windowOption:"menubar=no,location=no,toolbar=no,directories=no",windowName:"",startRecord:1,mdStore:null,summaryStore:null,statusBarId:null,mdDisplayPanelId:undefined,resultsView:undefined,mdOverlayedCmpId:undefined,identifiedUser:undefined,adminUser:false,metadataEditFn:undefined,adminAppUrl:"",selectedRecords:0,constructor:function(e){e=e||{};Ext.apply(this,e);if(this.hostUrl){if(this.hostUrl.indexOf("http")===-1){this.hostUrl=window.location.href.match(/http.*\//,"")+this.hostUrl;}this.SERVERURL=this.hostUrl;}else{this.SERVERURL="http://"+window.location.host+"/";}if(this.hostUrl){this.URL=this.SERVERURL;}else{if(this.servlet){this.URL=this.SERVERURL+this.servlet;}else{this.URL=this.SERVERURL+"geonetwork";}}this.LANG=(this.lang?this.lang:this.DEFAULT_LANG);var d=this.URL+"/srv/"+this.LANG+"/";this.services={rootUrl:d,csw:d+"csw",xmlSearch:d+"xml.search",mdSelect:d+"metadata.select",mdView:d+"view",mdXMLInsert:d+"xml.metadata.insert",mdShow:d+"metadata.show.embedded",mdMEF:d+"mef.export",mdXMLGet:d+"xml.metadata.get",mdXMLGet19139:d+"xml_iso19139",mdXMLGetDC:d+"xml_dublin-core",mdXMLGetFGDC:d+"xml_fgdc-std",mdXMLGet19115:d+"xml_iso19115to19139",mdDuplicate:d+"metadata.duplicate.form",mdDelete:d+"metadata.delete",mdPrint:d+"pdf",mdEdit:d+"edit",mdCreate:d+"metadata.create.new",mdUpdate:d+"metadata.update.new",mdProcessingXml:d+"xml.metadata.processing",mdProcessing:d+"metadata.processing.new",mdMassiveChildrenForm:d+"metadata.batch.children.form",mdAdmin:d+"metadata.admin.form",mdValidate:d+"xml.metadata.validate",mdSuggestion:d+"metadata.suggestion",mdCategory:d+"metadata.category.form",mdRelationInsert:d+"xml.relation.insert",mdRelationDelete:d+"xml.relation.delete",mdRelation:d+"xml.relation",mdGetThumbnail:d+"metadata.thumbnail",mdSetThumbnail:d+"metadata.thumbnail.set.new",mdUnsetThumbnail:d+"metadata.thumbnail.unset.new",mdImport:d+"metadata.xmlinsert.form",subTemplateType:d+"subtemplate.types",subTemplate:d+"subtemplate",upload:d+"resources.upload.new",prepareDownload:d+"prepare.file.download",fileDisclaimer:d+"file.disclaimer",fileDownload:d+"file.download",geopublisher:d+"geoserver.publisher",login:d+"xml.user.login",logout:d+"xml.user.logout",mef:d+"mef.export?format=full&version=2",csv:d+"csv.search",pdf:d+"pdf.selection.search",harvestingStart:d+"xml.harvesting.start",harvestingStop:d+"xml.harvesting.stop",harvestingRun:d+"xml.harvesting.run",harvestingAdd:d+"xml.harvesting.add",harvestingUpdate:d+"xml.harvesting.update",harvestingRemove:d+"xml.harvesting.remove",thesaurusAdd:d+"thesaurus.add",thesaurusActivate:d+"thesaurus.activate",thesaurusDelete:d+"thesaurus.delete",thesaurusUpload:d+"xml.thesaurus.upload",thesaurusDownload:d+"thesaurus.download",thesaurusConceptAdd:d+"thesaurus.addelement",thesaurusConceptUpdate:d+"thesaurus.updateelement",thesaurusConceptDelete:d+"thesaurus.deleteelement",getIcons:d+"xml.harvesting.info?type=icons",opensearchSuggest:d+"main.search.suggest",massiveOp:{NewOwner:d+"metadata.batch.newowner.form",Categories:d+"metadata.batch.category.form",Delete:d+"metadata.batch.delete",Privileges:d+"metadata.batch.admin.form"},metadataMassiveUpdatePrivilege:d+"metadata.batch.update.privileges",metadataMassiveUpdateCategories:d+"metadata.batch.update.categories",getGroups:d+"xml.info?type=groups",getRegions:d+"xml.info?type=regions",getSources:d+"xml.info?type=sources",getUsers:d+"xml.info?type=users",getSiteInfo:d+"xml.info?type=site",schemaInfo:d+"xml.schema.info",getZ3950repositories:d+"xml.info?type=z3950repositories",getCategories:d+"xml.info?type=categories",getHarvesters:d+"xml.harvesting.get",rate:d+"xml.metadata.rate",xmlConfig:d+"xml.config.get",admin:d+"admin",xmlError:d+"xml.main.error",searchKeyword:d+"xml.search.keywords",getThesaurus:d+"xml.thesaurus.getList",getKeyword:d+"xml.keyword.get",searchCRS:d+"crs.search",getCRSTypes:d+"crs.types",logoAdd:d+"logo.add",logoUrl:this.URL+"/images/logos/",imgUrl:this.URL+"/images/",harvesterLogoUrl:this.URL+"/images/harvesting/"};
this.extentMap=new GeoNetwork.map.ExtentMap();this.addEvents("selectionchange","afterLogin","afterLogout","afterBadLogin","afterBadLogout","afterDelete");GeoNetwork.Catalogue.superclass.constructor.call(this,e);},setServiceUrl:function(d,e){this.services[d]=this.services.rootUrl+e;},isIdentified:function(){return !this.identifiedUser?false:true;},isAdmin:function(){return this.adminUser;},onAfterLogin:function(){this.fireEvent("afterLogin",this,this.isIdentified());},onAfterBadLogin:function(){this.fireEvent("afterBadLogin",this,this.isIdentified());},onAfterLogout:function(){this.fireEvent("afterLogout",this,this.isIdentified());},onAfterBadLogout:function(){this.fireEvent("afterBadLogout",this,this.isIdentified());},onAfterDelete:function(){this.fireEvent("afterDelete",this);},onAfterRating:function(){this.fireEvent("afterRating",this);},setSelectedRecords:function(b){this.selectedRecords=parseInt(b,10);this.onSelectionChange();},getSelectedRecords:function(){return this.selectedRecords;},onSelectionChange:function(){this.fireEvent("selectionchange",this,this.getSelectedRecords());},getInfo:function(){var h={};var f=["name","organization","siteId"];var j=OpenLayers.Request.GET({url:this.services.getSiteInfo,async:false});if(j.responseXML){var g=j.responseXML.documentElement;Ext.each(f,function(a,b){h[a]=g.getElementsByTagName(a)[0].childNodes[0].nodeValue;});}return h;},updateStatus:function(d){if(this.statusBarId){var e=Ext.getCmp(this.statusBarId);if(e){e.update(d);return;}e=Ext.getDom(this.statusBarId);if(e){e.innerHTML=d;return;}}},search:function(s,r,w,o,q,t,v,u){var m=this.metadataStore===t;if(m){this.updateStatus(OpenLayers.i18n("searching"));}if(q!==false){q=true;}if(!o){o=this.startRecord;}if(!r){r=Ext.emptyFn;}if(!w){w=Ext.emptyFn;}if(t===undefined){t=this.metadataStore;}if(v===undefined){v=this.summaryStore;}if(q){t.removeAll();}if(typeof s==="object"){GeoNetwork.util.SearchTools.doQueryFromParams(s,this,o,r,w,q,t,v,u);}else{GeoNetwork.util.SearchTools.doQueryFromForm(s,this,o,r,w,q,t,v,u);}},kvpSearch:function(q,o,t,l,r,m,s,u){if(r!==false){r=true;}if(!l){l=this.startRecord;}if(!o){o=Ext.emptyFn;}if(!t){t=Ext.emptyFn;}if(!m){m=this.metadataStore;}if(!s){s=this.summaryStore;}if(r){m.removeAll();}GeoNetwork.util.SearchTools.doQuery(q,this,l,o,t,r,m,s,u);},cswSearch:function(h,j,f,g){this.metadataCSWStore.removeAll();if(j){j=Ext.emptyFn;}if(f){f=Ext.emptyFn;}if(g){g=this.startRecord;}GeoNetwork.util.CSWSearchTools.doCSWQueryFromForm(h,this,g,j,null,f);},metadataSelect:function(j,f){this.setSelectedRecords(0);var h=this;var g=0;for(g=0;g<f.length;g++){OpenLayers.Request.GET({url:this.services.mdSelect,params:{id:f[g],selected:j},success:function(a){var b=a.responseXML.documentElement.getElementsByTagName("Selected")[0].childNodes[0].nodeValue;if(b){h.setSelectedRecords(b);}},failure:function(a){Ext.Msg.alert("Selection failed",a.responseText);}});}},metadataRate:function(e,f,g){OpenLayers.Request.GET({url:this.services.rate,params:{uuid:e,rating:f},success:function(a){var b=a.responseXML.documentElement.childNodes[0].nodeValue;if(g){g(b);}catalogue.onAfterRating();return b;},failure:function(a){Ext.Msg.alert("Rating failed",a.responseText);}});},metadataSelectAll:function(b){this.metadataSelection("add-all",b);},metadataSelectNone:function(b){this.metadataSelection("remove-all",b);},metadataSelection:function(f,g){var e=this;OpenLayers.Request.GET({url:this.services.mdSelect,params:{selected:f},success:function(a){var b=a.responseXML.documentElement.getElementsByTagName("Selected")[0].childNodes[0].nodeValue;if(b){e.setSelectedRecords(b);}if(g){g();}},failure:function(a){}});},csvExport:function(){window.open(this.services.csv,this.windowName,this.windowOption);},mefExport:function(){location.replace(this.services.mef);},pdfExport:function(){location.replace(this.services.pdf);},metadataShow:function(w,t,u,m){var v=this.services.mdView+"?uuid="+escape(w);var q=Ext.getBody();if(this.resultsView){var s=this.metadataStore.getAt(this.metadataStore.find("uuid",w));if(!s){var o=GeoNetwork.data.MetadataResultsFastStore();this.kvpSearch("fast=index&_uuid="+w,null,null,null,true,o,null,false);s=o.getAt(o.find("uuid",w));}var r=new GeoNetwork.view.ViewWindow({serviceUrl:v,lang:this.lang,currTab:GeoNetwork.defaultViewMode||"simple",printDefaultForTabs:GeoNetwork.printDefaultForTabs||false,catalogue:this,maximized:t||false,metadataUuid:w,record:s,resultsView:this.resultsView});r.show(this.resultsView);r.alignTo(q,"tr-tr");}else{window.open(this.services.mdShow+"?uuid="+w,this.windowName,this.windowOption);}},metadataShowById:function(o,u,r,m){var s=this.services.mdView+"?id="+o,l;if(this.resultsView){if(!l){var t=GeoNetwork.data.MetadataResultsFastStore();this.kvpSearch("fast=index&_id="+o,null,null,null,true,t,null,false);l=t.getAt(t.find("id",o));}var q=new GeoNetwork.view.ViewWindow({serviceUrl:s,currTab:GeoNetwork.defaultViewMode||"simple",catalogue:this,maximized:u||false,record:l,metadataUuid:l.get("uuid"),resultsView:this.resultsView});q.show(this.resultsView);q.alignTo(Ext.getBody(),"r-r");}},metadataXMLShow:function(j,h){var g=this.services.mdXMLGet;if(h==="iso19139"){g=this.services.mdXMLGet19139;}else{if(h==="dublin-core"){g=this.services.mdXMLGetDC;}else{if(h==="fgdc"){g=this.services.mdXMLGetFGDC;}else{if(h==="iso19115"){g=this.services.mdXMLGet19115;}}}}var f=g+"?uuid="+j;window.open(f,this.windowName,this.windowOption);},metadataPrint:function(d){var e=this.services.mdPrint+"?uuid="+d;location.replace(e);},metadataMEF:function(d){var e=this.services.mdMEF+"?version=2&uuid="+d;location.replace(e);},metadataEdit:function(j,g,m,l,h){switch(this.editMode){case this.EDITOR_MODE.IN_EDITOR_POPUP:if(this.metadataEditFn){this.metadataEditFn(j,g,m,l,h);}break;default:window.open(this.services.mdEdit+"?id="+j,this.windowName,this.windowOption);}},metadataDuplicate:function(b){window.open(this.services.mdDuplicate+"?uuid="+b,this.windowName,this.windowOption);},metadataCreateChild:function(b){window.open(this.services.mdDuplicate+"?child=y&uuid="+b,this.windowName,this.windowOption);},metadataDuplicateWithSchema:function(e,d){window.open(this.services.mdDuplicate+"?uuid="+e+"&schema="+d,this.windowName,this.windowOption);},metadataDelete:function(b){Ext.Msg.confirm(OpenLayers.i18n("deleteRecord"),OpenLayers.i18n("deleteConfirm"),this.metadataDeleteDo,b);},metadataDeleteDo:function(e){if(e==="yes"){var d={uuid:this};catalogue.doAction(catalogue.services.mdDelete,d,OpenLayers.i18n("deleteRecordSuccess"),OpenLayers.i18n("deleteRecordFailure"),catalogue.onAfterDelete.bind(catalogue));}},doAction:function(j,m,l,q,o,h){if(j.indexOf("http")===-1){j=this.services.rootUrl+j;}OpenLayers.Request.GET({url:j,params:m,success:function(a){if(l){Ext.Msg.alert(l,a.responseText);}if(o){o(a);}},failure:function(a){if(q){Ext.Msg.alert(q,a.responseText);}if(h){h(a);}}});},isLoggedIn:function(){var f=OpenLayers.Request.GET({url:this.services.admin,async:false}),g;g=f.responseText.indexOf("Exception")!==-1;if(f.status===200&&!g){this.identifiedUser={firstName:"",surName:"",role:""};this.onAfterLogin();return true;}else{if(f.status===404){this.showError(OpenLayers.i18n("connectIssue"),OpenLayers.i18n("connectIssueMsg")+this.services.rootUrl+".");}else{if(g){this.checkError();return false;}else{var e=Ext.state.Manager.getProvider();if(e){e.set("user",undefined);}return false;}}}},login:function(h,f){var j=this,g;OpenLayers.Request.GET({url:this.services.login,params:{username:h,password:f,info:"true"},success:function(a){g=a.responseXML.getElementsByTagName("record")[0];j.identifiedUser={username:g?g.getElementsByTagName("username")[0].firstChild.nodeValue:"-",name:g?g.getElementsByTagName("name")[0].firstChild.nodeValue:"-",surname:g?g.getElementsByTagName("surname")[0].firstChild.nodeValue:"-",role:g?g.getElementsByTagName("profile")[0].firstChild.nodeValue:"guest"};j.onAfterLogin();},failure:function(a){j.identifiedUser=undefined;j.onAfterBadLogin();}});},logout:function(){var b=this;
OpenLayers.Request.GET({url:this.services.logout,success:function(a){b.identifiedUser=undefined;b.onAfterLogout();},failure:function(a){b.identifiedUser=undefined;b.onAfterBadLogout();}});},checkError:function(f){var h=this,g,j;OpenLayers.Request.GET({url:this.services.xmlError,success:function(a){g=h.parseError(a.responseXML);j=g.info+" "+g.exc+"<br/>"+g.stack;h.showError("Catalogue error",j);if(f){f(h,a);}},failure:function(a){h.showError("Catalogue error",a.status);}});},showError:function(d,e){Ext.MessageBox.show({title:d,msg:e,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});},parseError:function(d){var e=d.getElementsByTagName("error")[0];return{stack:e.getElementsByTagName("Stack")[0].firstChild.nodeValue,exc:e.getElementsByTagName("Exception")[0].firstChild.nodeValue,resource:e.getElementsByTagName("Resource")[0].firstChild.nodeValue,msg:e.getElementsByTagName("Message")[0].firstChild.nodeValue,provider:e.getElementsByTagName("Provider")[0].firstChild.nodeValue,info:e.getElementsByTagName("Error")[0].firstChild.nodeValue};},admin:function(){location.replace(this.adminAppUrl);},metadataImport:function(){location.replace(this.services.mdImport);},massiveOp:function(g,f){var e=this.services.massiveOp[g];this.modalAction(OpenLayers.i18n("massiveOp")+" - "+g,e,f);},modalAction:function(h,f,g){if(f){var j=new Ext.Window({id:"modalWindow",layout:"fit",width:700,height:400,closeAction:"destroy",plain:true,modal:true,draggable:false,title:h,items:new Ext.Panel({autoLoad:{url:f,callback:g,scope:j},border:false,frame:false})});j.show(this);j.alignTo(Ext.getBody(),"t-t");}},metadataAdmin:function(d){var e=this.services.mdAdmin+"?id="+d;this.modalAction(OpenLayers.i18n("setPrivileges"),e);},metadataCategory:function(d){var e=this.services.mdCategory+"?id="+d;this.modalAction(OpenLayers.i18n("setCategories"),e);},metadataPrepareDownload:function(d){var e=this.services.prepareDownload+"?id="+d;this.modalAction(OpenLayers.i18n("prepareDownload"),e);}});Ext.reg("gn_catalogue",GeoNetwork.Catalogue);Ext.namespace("GeoNetwork.util");GeoNetwork.util.HelpTools={fields:[{name:"name",mapping:"@name"},{name:"id",mapping:"@id"},{name:"label"},{name:"description"},{name:"help",convert:function(j,l){var q=[],r,s;var m=l.getElementsByTagName("help");for(r=0;r<m.length;r++){var o=m[r].getElementsByTagName("p");if(o.length!==0){for(s=0;s<m.length;s++){q.push(o[s].firstChild.nodeValue);}}else{if(m[r].firstChild){q.push(m[r].firstChild.nodeValue);}}}return q;}},{name:"example"},{name:"helper",convert:function(s,l){var q=[],o,r;var j=l.getElementsByTagName("helper");if(j.length===1){var m=j[0].getElementsByTagName("option");for(r=0;r<m.length;r++){q.push({title:m[r].getAttribute("title"),label:m[r].firstChild.nodeValue,value:m[r].getAttribute("value")});}}return q;}}],Templates:{SIMPLE:['<div class="help">{description}',"<tpl if=\"values.example != ''\">","<div><span>"+OpenLayers.i18n("example")+"</span> {example}</div>","</tpl></div>"],COMPLETE:['<div class="help"><span class="title">{label}</span>',"<div>{description}</div>",'<tpl for="help">',"<div>{.}</div>","</tpl>","<tpl if=\"values.example != ''\">","<div><span>"+OpenLayers.i18n("example")+"</span> {example}</div>","</tpl>","<tpl if=\"values.helper != ''\">","<div><span>"+OpenLayers.i18n("helper")+"</span><ul>",'<tpl for="helper">','<li title="{values.title}">{values.label}</li>',"</tpl>","</ul></div>","</tpl>","<div>"+OpenLayers.i18n("tagName")+" {name}</div>","</div>"]},get:function(l,q,h,j){var m=l.split("|"),o='<request><element schema="'+q+'" name="'+m[1]+'" context="'+m[2]+'" fullContext="'+m[3]+'" isoType="'+m[4]+'" /></request>';q=q||m[0].split(".")[1]||"iso19139";OpenLayers.Request.POST({url:h,data:o,success:function(e){var d=e.responseXML.getElementsByTagName("element");if(d[0]&&d[0].getAttribute("error")==="not-found"){return;}var a=new Ext.data.XmlReader({record:"element",fields:GeoNetwork.util.HelpTools.fields});var b=a.readRecords(e.responseXML);if(j){j(b);}}});}};Ext.namespace("GeoNetwork.util");GeoNetwork.util.SearchTools={fast:"false",output:"full",sortBy:"relevance",hitsPerPage:"50",doQuery:function(r,m,o,s,w,q,t,v,u){OpenLayers.Request.GET({url:m.services.rootUrl+t.service+"?"+r,async:u===false?false:true,success:function(a){if(q){var b=new OpenLayers.Format.GeoNetworkRecords();var h=b.read(a.responseText);var g=h.records;var e=m.metadataStore===t,d=m.summaryStore===v;if(g.length>0){t.loadData(h);}if(d){var f=h.summary;if(f&&f.count>0&&v){v.loadData(f);}}if(m&&e){m.updateStatus(h.from+"-"+h.to+OpenLayers.i18n("resultBy")+f.count);}}if(s){s(a,r);}},failure:function(a){if(w){w(a);}}});},doQueryFromForm:function(o,q,r,u,B,s,v,z,w){var t=GeoNetwork.util.SearchTools.buildQueryFromForm(Ext.getCmp(o),r,GeoNetwork.util.SearchTools.sortBy,v.fast);GeoNetwork.util.SearchTools.doQuery(t,q,r,u,B,s,v,z,w);},doQueryFromParams:function(w,q,r,u,C,s,v,B,z){var D=[],t;GeoNetwork.util.SearchTools.addFiltersFromPropertyMap(w,D,r);t=GeoNetwork.util.SearchTools.buildQueryGET(D,r,GeoNetwork.util.SearchTools.sortBy,v.fast);GeoNetwork.util.SearchTools.doQuery(t,q,r,u,C,s,v,B,z);},buildQueryFromForm:function(m,q,l,h){var j=GeoNetwork.util.SearchTools.getFormValues(m);var o=[];GeoNetwork.util.SearchTools.addFiltersFromPropertyMap(j,o,q);return GeoNetwork.util.SearchTools.buildQueryGET(o,q,l,h);},populateFormFromParams:function(e,d){e.cascade(function(a){if(a.getName){var b=a.getName();if(b.indexOf("_")!==-1){b=b.substring(2);if(d[b]){a.setValue(d[b]);}}else{if(d[b]){a.setValue(d[b]);}}}});},addFiltersFromPropertyMap:function(m,w,s){var t=".8",o,v=m.E_similarity,u=m.E_hitsperpage;if(v!==undefined){t=m.E_similarity;GeoNetwork.util.SearchTools.addFilter(w,"E_similarity",t);}if(!u){u=GeoNetwork.util.SearchTools.hitsPerPage;}var q=parseInt(s,10)+parseInt(u,10)-1;GeoNetwork.util.SearchTools.addFilter(w,"E_from",s);GeoNetwork.util.SearchTools.addFilter(w,"E_to",q);for(o in m){if(m.hasOwnProperty(o)){var r=m[o];if(r!==""&&o!=="E_similarity"){GeoNetwork.util.SearchTools.addFilter(w,o,r);}}}},addFilter:function(s,j,q){var m=j.match("^(\\[?)([^_]+)_(.*)$"),l,o=[];if(m){var r=m[3].split("|");for(l=0;l<r.length;++l){GeoNetwork.util.SearchTools.addFilterImpl(s,m[2],r[l],q);}}},addFilterImpl:function(j,f,g,h){if(f.charAt(0)==="E"){j.push(g+"="+encodeURIComponent(h)+"");}else{if(f==="B"){j.push(g+"="+(h?"on":"off")+"");}else{if(f==="O"){if(h){j.push(g+"=on");}}else{alert("Cannot parse "+f);}}}},sortByMappings:{relevance:{name:"relevance",order:""},rating:{name:"changeDate",order:""},popularity:{name:"popularity",order:""},date:{name:"date",order:""},title:{name:"title",order:"reverse"}},buildQueryGET:function(m,g,j,h){var l="fast="+(h?h:GeoNetwork.util.SearchTools.fast)+"&";if(m){l+=m.join("&");}return l;},getFormValues:function(d){var e=d.getForm().getValues()||{};d.cascade(function(a){if(a.disabled!==true&&a.rendered){if(a.isXType("boxselect")){if(a.getValue&&a.getValue()){e[a.getName()]=a.getValue();}}else{if(a.isXType("combo")){if(a.getValue&&a.getValue()){e[a.getName()]=a.getValue();}}else{if(a.isXType("fieldset")){if(a.checkbox){e[a.checkboxName]=!a.collapsed;}}else{if(a.isXType("radiogroup")){var b=a.items.get(0);e[b.getName()]=b.getGroupValue();}else{if(a.isXType("checkbox")){e[a.getName()]=a.getValue();}else{if(a.isXType("datefield")){if(a.getValue()!==""){e[a.getName()]=a.getValue().format("Y-m-d")+(a.postfix?a.postfix:"");}}else{if(a.getName){if(a.getValue&&a.getValue()!==""){e[a.getName()]=a.getValue();}}}}}}}}}return true;});return e;}};var translations={};function translate(b){return translations[b]||b;}function checkAllInputsIn(h,f){var j=Ext.getDom(h).getElementsByTagName("input"),g;for(g=0;g<j.length;g++){j[g].checked=f;}}function setAll(b){checkAllInputsIn(b,true);}function clearAll(b){checkAllInputsIn(b,false);}function checkBoxModalUpdate(l,j,m,o){var q=Ext.DomQuery.select('input[type="checkbox"]');var h="?";if(j==="metadata.admin"||j==="metadata.category"){h+="id="+Ext.getDom("metadataid").value;}Ext.each(q,function(a){if(a.checked&&a.name!=""){h+="&"+a.name+"=on";
}});catalogue.doAction(j+h,null,null,o,function(a){Ext.getDom(l).innerHTML=a.responseText;if(j==="metadata.admin"||j==="metadata.category"){Ext.getCmp("modalWindow").close();}},null);}function addGroups(h){var m=h.getElementsByTagName("group"),o;Ext.getDom("group").options.length=0;for(o=0;o<m.length;o++){var l=m[o].getElementsByTagName("id")[0].firstChild.nodeValue;var j=m[o].getElementsByTagName("name")[0].firstChild.nodeValue;var q=document.createElement("option");q.text=j;q.value=l;if(m.length===1){q.selected=true;}Ext.getDom("group").options.add(q);}}function doGroups(b){catalogue.doAction("xml.usergroups.list?id="+b,null,null,"Error retrieving groups",function(e){if(e.nodeName==="error"){Ext.getDom("group").options.length=0;Ext.getDom("group").value="";var a=Ext.getDom("user");for(i=0;i<a.options.length;i++){a.options[i].selected=false;}}else{addGroups(e.responseXML);}});}function checkMassiveNewOwner(f,h){var g=Ext.getDom("user").value;var j=Ext.getDom("group").value;if(g===""){Ext.Msg.alert(h,"selectNewOwner");return false;}if(j.value===""){Ext.Msg.alert(h,"selectOwnerGroup");return false;}catalogue.doAction(f+"?user="+g+"&group="+j,null,null,null,function(a){Ext.getDom("massivenewowner").parentNode.innerHTML=a.responseText;});}function doDownload(m,q){var o=Ext.getDom("downloadlist").getElementsByTagName("INPUT"),s="&id="+m+"&access=private",r=false;for(var j=0;j<o.length;j++){if(o[j].checked||q!==null){r=true;var l=o[j].getAttribute("name");s+="&fname="+l;}}if(!r){Ext.Msg.alert("Alert",OpenLayers.i18n("selectOneFile"));return;}catalogue.doAction(catalogue.services.fileDisclaimer+"?"+s,null,null,null,function(a){Ext.getDom("downloadlist").parentNode.innerHTML=a.responseText;});}function feedbackSubmit(){var b=Ext.getDom("feedbackf");catalogue.doAction(catalogue.services.fileDownload+"?"+Ext.Ajax.serializeForm(b),null,null,null,function(a){Ext.getDom("feedbackf").parentNode.innerHTML=a.responseText;});}function goSubmit(b){document.forms[b].submit();}Ext.namespace("GeoNetwork.util");GeoNetwork.util.INSPIRESearchFormTools={getAnnexField:function(g){var e=[["i","I"],["ii","II"],["iii","III"]],f={id:"inspireannex",name:"E_inspireannex",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("inspireannex"),store:new Ext.data.ArrayStore({id:0,fields:["id","label"],data:e}),valueField:"id",displayField:"label"};if(g){Ext.apply(f,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(f);}else{return new Ext.form.ComboBox(f);}},getRelatedField:function(){var b=new Ext.form.Checkbox({hideLabel:true,boxLabel:OpenLayers.i18n("inspirerelated"),tabTip:OpenLayers.i18n("inspirerelatedtt"),name:"O_inspirerelated"});return b;},getThemesFieldWithSuggestion:function(e){var d=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:e.opensearchSuggest,field:"inspiretheme",name:"E_inspiretheme",fieldLabel:OpenLayers.i18n("inspiretheme")});return d;},getThemesField:function(o,l){var j,q,m;j=Ext.data.Record.create([{name:"id"},{name:"value"},{name:"definition"},{name:"uri"}]);q=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:o.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pKeyword:"*",pThesauri:"external.theme.inspire-theme",pMode:"searchBox",maxResults:"35"},reader:new Ext.data.XmlReader({record:"keyword",id:"id"},j),fields:["id","value","definition","uri"],sortInfo:{field:"value"}});q.load();var h={id:"inspiretheme",name:"E_inspiretheme",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("inspiretheme"),store:q,valueField:"value",displayField:"value"};if(l){Ext.apply(h,{valueDelimiter:" or ",stackItems:true});return new Ext.ux.form.SuperBoxSelect(h);}else{return new Ext.form.ComboBox(h);}},getINSPIREFields:function(e,d){return[this.getAnnexField(d),this.getThemesField(e,d),this.getRelatedField()];}};Ext.namespace("GeoNetwork.util");GeoNetwork.util.SearchFormTools={getSimpleFormFields:function(o,u,w,q,t,r,m,v){var s=[];if(o){s.push(new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:true,width:285,minChars:2,loadingText:"...",hideTrigger:true,url:o.opensearchSuggest,listeners:{}}));}else{s.push(GeoNetwork.util.SearchFormTools.getFullTextField());}if(q){s.push(GeoNetwork.util.SearchFormTools.getTypesField(r,true));}if(u){s.push(GeoNetwork.util.SearchFormTools.getSimpleMap(u,w,t,m,v));}s.push(GeoNetwork.util.SearchFormTools.getOptions());return s;},getAdvancedFormFields:function(aj,ac,M){var Z=[],W,ae,O;if(aj){W=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:true,width:285,minChars:2,loadingText:"...",hideTrigger:true,url:aj.opensearchSuggest});O=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:aj.opensearchSuggest,field:"orgName",name:"E_orgName",fieldLabel:OpenLayers.i18n("org")});ae=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:aj.opensearchSuggest,field:"keyword",name:"E_themekey",fieldLabel:OpenLayers.i18n("keyword")});}else{W=GeoNetwork.util.SearchFormTools.getFullTextField();ae=GeoNetwork.util.SearchFormTools.getKeywordsField();O=GeoNetwork.util.SearchFormTools.getOrgNameField();}var Y=GeoNetwork.util.SearchFormTools.getAdvancedTextFields();var ai=GeoNetwork.util.SearchFormTools.getTitleField();var T=GeoNetwork.util.SearchFormTools.getAbstractField();var U=GeoNetwork.util.SearchFormTools.getTypesField();var J={xtype:"fieldset",title:OpenLayers.i18n("mapTypes"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:true,defaultType:"checkbox",defaults:{width:160},items:GeoNetwork.util.SearchFormTools.getMapTypesField()};var af={xtype:"fieldset",title:OpenLayers.i18n("similarity"),autoHeight:true,autoWidth:true,layout:"column",collapsible:true,collapsed:true,items:[GeoNetwork.util.SearchFormTools.getSimilarityField()]};var ak=new Ext.form.TextField({name:"E_geometry",id:"geometry",fieldLabel:OpenLayers.i18n("wkt"),hideLabel:false});var ab=[],V;for(V=0;V<ac.length;V++){ab.push(ac[V].clone());}var aa={xtype:"gn_geometrymapfield",geometryFieldId:"geometry",id:"geometryMap",layers:ab,mapOptions:M};var K=GeoNetwork.util.SearchFormTools.getNearYouButton("geometry");var S=GeoNetwork.util.SearchFormTools.getRelationField();var al=GeoNetwork.util.SearchFormTools.getScaleDenominatorField(true);var Q=new Ext.form.FieldSet({title:OpenLayers.i18n("spatialSearch"),autoWidth:true,collapsible:true,collapsed:true,items:[ak,K,aa,S]});var ad=new Ext.form.FieldSet({title:OpenLayers.i18n("when"),autoWidth:true,defaultType:"datefield",collapsible:true,collapsed:true,items:GeoNetwork.util.SearchFormTools.getWhen()});var L=GeoNetwork.util.SearchFormTools.getCatalogueField(aj.getSources,aj.logoUrl);var N=GeoNetwork.util.SearchFormTools.getGroupField(aj.getGroups);var ag=GeoNetwork.util.SearchFormTools.getMetadataTypeField();var P=GeoNetwork.util.SearchFormTools.getCategoryField(aj.getCategories,null,true);var ah=GeoNetwork.util.SearchFormTools.getOptions();Z.push(W,Y,ai,T,ae,O,Q,U,J,al,ad,L,N,ag,P,ah,af);return Z;},getSimpleMap:function(u,w,s,o,v){var r=[],B=[],t;var q=new Ext.form.TextField({name:"E_geometry",id:"geometry",inputType:"hidden"});for(t=0;t<u.length;t++){B.push(u[t].clone());}var z={xtype:"gn_geometrymapfield",geometryFieldId:"geometry",id:"geometryMap",layers:B,mapOptions:w,activated:s};if(o){Ext.applyIf(z,o);}r.push(q,z);if(v){r.push(GeoNetwork.util.SearchFormTools.getRelationField());}return r;},getOptions:function(j){var h=j||[["10"],["20"],["50"],["100"]];var l=GeoNetwork.util.SearchFormTools.getSortByCombo();var m=new Ext.form.ComboBox({id:"E_hitsperpage",name:"E_hitsperpage",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("hitsPerPage"),value:h[1],store:new Ext.data.ArrayStore({id:0,fields:["id"],data:h}),valueField:"id",displayField:"id"});var g=new Ext.form.FieldSet({title:"Options",autoWidth:true,collapsible:true,collapsed:true,defaults:{width:160},items:[l,m]});return g;},getSortByCombo:function(){var e=new Ext.form.TextField({name:"E_sortBy",id:"E_sortBy",inputType:"hidden"});
var f=new Ext.form.TextField({name:"E_sortOrder",id:"sortOrder",inputType:"hidden"});var g=new Ext.form.ComboBox({mode:"local",fieldLabel:OpenLayers.i18n("sortBy"),triggerAction:"all",value:"relevance",store:GeoNetwork.util.SearchFormTools.getSortByStore(),valueField:"id",displayField:"name",listeners:{change:function(j,a,d){var b=a.split("#");e.setValue(b[0]);f.setValue(b[1]);}}});return[e,f,g];},getSortByStore:function(){return new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["relevance#",OpenLayers.i18n("relevance")],["title#reverse",OpenLayers.i18n("title")],["changeDate#",OpenLayers.i18n("changeDate")],["rating#",OpenLayers.i18n("rating")],["popularity#",OpenLayers.i18n("popularity")],["denominator#",OpenLayers.i18n("scaleDesc")],["denominator#revers",OpenLayers.i18n("scaleAsc")]]});},getFullTextField:function(){return new Ext.form.TextField({name:"E_any",id:"E_any",fieldLabel:OpenLayers.i18n("fullTextSearch"),hideLabel:false});},getTitleField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_title",OpenLayers.i18n("title"));},getAbstractField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_abstract",OpenLayers.i18n("abstract"));},getKeywordsField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_themekey",OpenLayers.i18n("keyword"));},getOrgNameField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_orgName",OpenLayers.i18n("org"));},getTextField:function(d,e){return new Ext.form.TextField({name:d,fieldLabel:e,hideLabel:false});},getCatalogueField:function(o,l,m){var j=GeoNetwork.data.CatalogueSourceStore(o),q='<tpl for="."><div class="x-combo-list-item logo"><img src="'+l+'{id}.gif"/>{name}</div></tpl>';j.load();var h={name:"E_siteId",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("catalogue"),store:j,valueField:"id",displayField:"name",tpl:q};if(m){Ext.apply(h,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:'<img style="max-width:16px;" src="'+l+'{id}.gif"/>{name}'});return new Ext.ux.form.SuperBoxSelect(h);}else{return new Ext.form.ComboBox(h);}},getGroupField:function(m,j){var l=GeoNetwork.data.GroupStore(m),g='<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>";l.load();var h={name:"E_group",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:l,valueField:"id",displayField:"name",tpl:g};if(j){Ext.apply(h,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:"{[values.label."+OpenLayers.Lang.getCode()+"]}"});return new Ext.ux.form.SuperBoxSelect(h);}else{return new Ext.form.ComboBox(h);}},getMetadataTypeField:function(d){var e={name:"E_template",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("kind"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["n",OpenLayers.i18n("md")],["y",OpenLayers.i18n("tpl")]]}),valueField:"id",displayField:"name"};if(d){Ext.apply(e,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(e);}else{return new Ext.form.ComboBox(e);}},getCategoryField:function(q,m,o){var l=GeoNetwork.data.CategoryStore(q);l.load();var r=(m?'<tpl for="."><div class="x-combo-list-item"><img src="'+m+'{name}.png"/>{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>":'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>");var s={name:"E_category",mode:"local",fieldLabel:OpenLayers.i18n("category"),triggerAction:"all",store:l,valueField:"name",displayField:"name",tpl:r};if(o){var j=(m?'<img src="'+m+'{name}.png"/>{[values.label.'+OpenLayers.Lang.getCode()+"]}":"{[values.label."+OpenLayers.Lang.getCode()+"]}");Ext.apply(s,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:j});return new Ext.ux.form.SuperBoxSelect(s);}else{return new Ext.form.ComboBox(s);}},getAdvancedTextFields:function(){return{xtype:"fieldset",title:OpenLayers.i18n("advTextSearch"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:true,defaultType:"textfield",items:[{name:"E_or",fieldLabel:OpenLayers.i18n("eitherWords"),hideLabel:false},{name:"E_phrase",fieldLabel:OpenLayers.i18n("exactPhrase"),hideLabel:false},{name:"E_all",fieldLabel:OpenLayers.i18n("allWords"),hideLabel:false},{name:"E_without",fieldLabel:OpenLayers.i18n("withoutWords"),hideLabel:false}]};},getSimilarityField:function(){return{xtype:"radiogroup",items:[{xtype:"label",text:OpenLayers.i18n("precise")},{name:"E_similarity",inputValue:1},{name:"E_similarity",inputValue:0.8,checked:true},{name:"E_similarity",inputValue:0.6},{name:"E_similarity",inputValue:0.4},{name:"E_similarity",inputValue:0.2},{xtype:"label",text:OpenLayers.i18n("imprecise")}]};},getRelationField:function(){return new Ext.form.ComboBox({name:"E_relation",mode:"local",width:150,triggerAction:"all",fieldLabel:OpenLayers.i18n("relationType"),store:new Ext.data.ArrayStore({id:0,fields:["relation","label"],data:[["",""],["intersection",OpenLayers.i18n("intersection")],["overlaps",OpenLayers.i18n("overlaps")],["encloses",OpenLayers.i18n("encloses")],["fullyOutsideOf",OpenLayers.i18n("fullyOutsideOf")],["crosses",OpenLayers.i18n("crosses")],["touches",OpenLayers.i18n("touches")],["within",OpenLayers.i18n("within")]]}),valueField:"relation",displayField:"label"});},getNearYouButton:function(b){return new Ext.Button({text:OpenLayers.i18n("nearYou"),iconCls:"md-mn mn-user-location",iconAlign:"right",listeners:{click:function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(a){Ext.getCmp(b).setValue("POINT("+a.coords.latitude+" "+a.coords.longitude+")");});}}}});},registerDateVtype:function(){if(Ext.form.VTypes.daterange){return;}Ext.apply(Ext.form.VTypes,{daterange:function(l,m){var g=m.parseDate(l);if(!g){return false;}if(m.startDateField&&(!this.dateRangeMax||(g.getTime()!==this.dateRangeMax.getTime()))){var j=Ext.getCmp(m.startDateField);j.setMaxValue(g);j.validate();this.dateRangeMax=g;}else{if(m.endDateField&&(!this.dateRangeMin||(g.getTime()!==this.dateRangeMin.getTime()))){var h=Ext.getCmp(m.endDateField);h.setMinValue(g);h.validate();this.dateRangeMin=g;}}return true;}});},getWhen:function(){var d=new Ext.form.Checkbox({name:"timeType",checked:true,fieldLabel:OpenLayers.i18n("anyTime"),handler:function(b,a){b.ownerCt.items.each(function(j,m,l){if(a&&j.getXType()==="datefield"){j.setValue("");}});}});var e=[d,{xtype:"label",text:OpenLayers.i18n("mdChangeDate")}];e.push(GeoNetwork.util.SearchFormTools.getMetadataDateField(d));e.push({xtype:"label",text:OpenLayers.i18n("tempExtent")});e.push(GeoNetwork.util.SearchFormTools.getTemporalExtentField(d));return e;},getMetadataDateField:function(b){GeoNetwork.util.SearchFormTools.registerDateVtype();return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_dateFrom","from","dateFrom","E_dateTo","to","dateTo",b);},getTemporalExtentField:function(b){GeoNetwork.util.SearchFormTools.registerDateVtype();return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_extFrom","from","extFrom","E_extTo","to","extTo",b);},getDateRangeFields:function(u,s,o,q,r,l,t){GeoNetwork.util.SearchFormTools.registerDateVtype();var m=function(d,a,b){if(this&&a!==""){this.setValue(false);}};return[{fieldLabel:OpenLayers.i18n(s),name:u,id:o,width:120,vtype:"daterange",endDateField:l,format:"d/m/Y",listeners:{change:m,scope:t}},{fieldLabel:OpenLayers.i18n(r),name:q,id:l,width:120,vtype:"daterange",startDateField:o,format:"d/m/Y",listeners:{change:m,scope:t}}];},getScaleDenominatorField:function(v,u,s,q,w){u=u||1000;s=s||1000000;q=q||1000;w=w||230;var r=new Ext.slider.Tip({getText:function(a){return String.format("<b>"+OpenLayers.i18n("scaleNominator")+"{0}</b>",a.value);}});var t=new Ext.form.Field({name:"E_denominatorFrom",value:"",hidden:true});var o=new Ext.form.Field({name:"E_denominatorTo",value:"",hidden:true});var z=new Ext.slider.MultiSlider({disabled:v?true:false,width:w,minValue:u,maxValue:s,increment:q,values:[u,s],formFields:[t,o],plugins:r,listeners:{change:function(b,a,d){b.formFields[d.index].setValue(a);}}});
var B=new Ext.form.Checkbox({fieldLabel:OpenLayers.i18n("scale"),value:v?true:false,handler:function(b,a){z.setDisabled(!a);if(!a){t.setValue("");o.setValue("");}}});return[t,o,B,z];},getMapTypesField:function(){var b=GeoNetwork.util.SearchFormTools.getSpatialRepresentationTypeField(null,true);return[{hideLabel:true,boxLabel:OpenLayers.i18n("digital"),name:"B_digital"},{hideLabel:true,boxLabel:OpenLayers.i18n("hardCopy"),name:"B_paper"},{hideLabel:true,boxLabel:OpenLayers.i18n("downloadable"),name:"B_download"},{hideLabel:true,boxLabel:OpenLayers.i18n("interactive"),name:"B_dynamic"},b];},getValidField:function(d){var e={name:"E__valid",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("validationStatus"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["1",OpenLayers.i18n("valid")],["0",OpenLayers.i18n("notValid")],["-1",OpenLayers.i18n("notDetermined")]]}),valueField:"id",displayField:"name"};if(d){Ext.apply(e,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(e);}else{return new Ext.form.ComboBox(e);}},getTypesField:function(j,h){var f=[["dataset",OpenLayers.i18n("dataset")],["series",OpenLayers.i18n("series")],["service",OpenLayers.i18n("service")]],g={name:"E_type",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("resourceType"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:j||f}),valueField:"id",displayField:"name"};if(h){Ext.apply(g,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(g);}else{return new Ext.form.ComboBox(g);}},getSpatialRepresentationTypeField:function(j,h){var f=[["grid",OpenLayers.i18n("grid")],["stereoModel",OpenLayers.i18n("stereoModel")],["tin",OpenLayers.i18n("tin")],["textTabled",OpenLayers.i18n("textTable")],["vector",OpenLayers.i18n("vector")],["video",OpenLayers.i18n("video")]],g={name:"E_spatialRepresentationType",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("spatialRepType"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:j||f}),valueField:"id",displayField:"name"};if(h){Ext.apply(g,{valueDelimiter:" or "});return new Ext.ux.form.SuperBoxSelect(g);}else{return new Ext.form.ComboBox(g);}}};Ext.namespace("GeoNetwork.util");GeoNetwork.util.CSWSearchTools={cswMethod:"POST",resultsMode:"results_with_summary",sortBy:"",maxRecords:"50",doCSWQueryFromForm:function(o,q,t,s,v,m){var w=q.services.csw;var r=GeoNetwork.util.CSWSearchTools.buildCSWQueryFromForm(GeoNetwork.util.CSWSearchTools.cswMethod,Ext.getCmp(o),t,GeoNetwork.util.CSWSearchTools.sortBy,m);if(GeoNetwork.util.CSWSearchTools.cswMethod==="POST"){var u=GeoNetwork.util.CSWSearchTools.buildCSWQueryFromForm("GET",Ext.getCmp(o),t,GeoNetwork.util.CSWSearchTools.sortBy,m);OpenLayers.Request.POST({url:w,data:r,success:function(a){var b=new OpenLayers.Format.CSWGetRecords.v2_0_2();q.currentRecords=b.read(a.responseText);var d=q.currentRecords.records;if(d.length>0){q.metadataCSWStore.loadData(q.currentRecords);}if(s){s(a,u);}},failure:v});}else{OpenLayers.Request.GET({url:w,params:r,success:function(a){s(a,r);},failure:v});}},buildCSWQueryFromForm:function(o,s,l,q,r){var m=GeoNetwork.util.CSWSearchTools.getFormValues(s);var t=[];GeoNetwork.util.CSWSearchTools.addFiltersFromPropertyMap(m,t);r(m,t);if(t.length===0){t.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:"anyText",value:".*"}));}var u=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:t});if(o==="POST"){return GeoNetwork.util.CSWSearchTools.buildCSWQueryPOST(u,l,q);}else{return GeoNetwork.util.CSWSearchTools.buildCSWQueryGET(u,l,q);}},addFiltersFromPropertyMap:function(h,m){var j=".8",q=h.E_similarity,o;if(q!==null&&q!==undefined){j=h.E_similarity;GeoNetwork.util.CSWSearchTools.addFilter(m,"E_similarity",j,j);}for(o in h){if(h.hasOwnProperty(o)){var l=h[o];if(l!==""&&o!=="E_similarity"){GeoNetwork.util.CSWSearchTools.addFilter(m,o,l,j);}}}},addFilter:function(s,t,r,m){var o=t.match("^(\\[?)([^_]+)_(.*)$"),q=[],u;if(o){if(o[1]==="["){var l=r.split(",");for(u=0;u<l.length;++u){GeoNetwork.util.CSWSearchTools.addFilterImpl(l.length>1?q:s,o[2],o[3],l[u],m);}if(l.length>1){s.push(new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:q}));}}else{GeoNetwork.util.CSWSearchTools.addFilterImpl(s,o[2],o[3],r,m);}}},addFilterImpl:function(s,t,l,r,m){var u;if(t==="S"){s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:l,value:r+".*"}));}else{if(t==="C"){s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:l,value:".*"+r+".*"}));}else{if(t.charAt(0)==="E"){if(t.length>1){s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:t.substring(1)}));}s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:l,value:r}));if(t.length>1){s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:m}));}}else{if(t===">="){s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,property:l,value:r}));}else{if(t==="<="){s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:l,value:r}));}else{if(t==="T"){var o=r.split(" ");for(u=0;u<o.length;++u){s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:l,value:o[u]}));}}else{if(t==="B"){s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:l,value:r?1:0}));}else{if(t==="V"){var q=r.match("^([^/]+)/(.*)$");s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:"1.0"}));s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:q[1],value:q[2]}));s.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:m}));}else{alert("Cannot parse "+t);}}}}}}}}},sortByMappings:{relevance:{name:"relevance",order:"D"},rating:{name:"rating",order:"D"},popularity:{name:"popularity",order:"D"},date:{name:"date",order:"D"},title:{name:"title",order:"A"}},buildCSWQueryPOST:function(o,h,l){var j='<?xml version="1.0" encoding="UTF-8"?>\n<csw:GetRecords xmlns:csw="http://www.opengis.net/cat/csw/2.0.2" service="CSW" version="2.0.2" resultType="'+this.resultsMode+'" startPosition="'+h+'" maxRecords="'+this.maxRecords+'">\n  <csw:Query typeNames="csw:Record">\n    <csw:ElementSetName>full</csw:ElementSetName>\n';if(l){var m=GeoNetwork.util.CSWSearchTools.sortByMappings[l];j+='    <ogc:SortBy xmlns:ogc="http://www.opengis.net/ogc">\n      <ogc:SortProperty>\n        <ogc:PropertyName>'+m.name+"</ogc:PropertyName>\n        <ogc:SortOrder>"+m.order+"</ogc:SortOrder>\n      </ogc:SortProperty>\n    </ogc:SortBy>\n";}if(o){var q=new OpenLayers.Format.XML().write(new OpenLayers.Format.Filter().write(o));q=q.replace(/^<\?xml[^?]*\?>/,"");j+='    <csw:Constraint version="1.0.0">\n';j+=q;j+="    </csw:Constraint>\n";}j+="  </csw:Query>\n</csw:GetRecords>";return j;},buildCSWQueryGET:function(o,h,l){var j={request:"GetRecords",service:"CSW",version:"2.0.2",resultType:this.resultsMode,namespace:"csw:http://www.opengis.net/cat/csw/2.0.2",typeNames:"csw:Record",constraintLanguage:"FILTER",constraint_language_version:"1.1.0",elementSetName:"full",startPosition:h,maxRecords:this.maxRecords};if(l){var m=GeoNetwork.util.CSWSearchTools.sortByMappings[l];j.sortBy=m.name+":"+m.order;}if(o){var q=new OpenLayers.Format.XML().write(new OpenLayers.Format.Filter().write(o));q=q.replace(/^<\?xml[^?]*\?>/,"");j.constraint=q;}return j;},getFormValues:function(d){var e=d.getForm().getValues()||{};d.cascade(function(a){if(a.disabled!==true){if(a.isXType("boxselect")){if(a.getValue&&a.getValue()){e[a.getName()]=a.getValue();}}else{if(a.isXType("combo")){if(a.getValue&&a.getValue()){e[a.getName()]=a.getValue();
}}else{if(a.isXType("fieldset")){if(a.checkbox){e[a.checkboxName]=!a.collapsed;}}else{if(a.isXType("radiogroup")){var b=a.items.get(0);e[b.getName()]=b.getGroupValue();}else{if(a.isXType("checkbox")){e[a.getName()]=a.getValue();}else{if(a.isXType("datefield")){if(a.getValue()!==""){e[a.getName()]=a.getValue().format("Y-m-d")+(a.postfix?a.postfix:"");}}else{if(a.getName){if(a.getValue&&a.getValue()!==""){e[a.getName()]=a.getValue();}}}}}}}}}return true;});return e;}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.CatalogueSourceStore=function(b){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:b,disableCaching:false}),record:"source",idPath:"id",fields:[{name:"id",mapping:"uuid"},{name:"name"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.CategoryStore=function(e){function d(r,s){var a={};var q=s.getElementsByTagName("label");var m;if(q.length===1){var o=q[0].childNodes;var b;for(m=0,len=o.length;m<len;++m){b=o[m];if(b.nodeType===1){a[b.nodeName]=b.firstChild.nodeValue;}}}return a;}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:e,disableCaching:false}),record:"category",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"name"},{name:"label",convert:d}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.CodeListStore=function(q){var o=q.schema||"iso19139";var m='<request><codelist schema="'+o+'" name="'+q.codeListName+'" /></request>';var h=[{name:"code"},{name:"label"},{name:"description"}];var l=Ext.data.Record.create(h);var j=new Ext.data.Store({fields:h});OpenLayers.Request.POST({url:q.url,data:m,success:function(d){var b=d.responseXML.getElementsByTagName("entry");for(var a=0;a<b.length;a++){var e=new l({code:b[a].getElementsByTagName("code")[0].firstChild.nodeValue,label:b[a].getElementsByTagName("label")[0].firstChild.nodeValue,description:b[a].getElementsByTagName("description")[0].firstChild.nodeValue});j.add(e);}}});return j;};Ext.namespace("GeoNetwork.data");GeoNetwork.data.GroupStore=function(e){function d(r,s){var a={};var m;var q=s.getElementsByTagName("label");if(q.length===1){var o=q[0].childNodes;var b;for(m=0,len=o.length;m<len;++m){b=o[m];if(b.nodeType===1){a[b.nodeName]=b.firstChild.nodeValue;}}}return a;}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:e,disableCaching:false}),record:"group",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"name"},{name:"description"},{name:"email"},{name:"referrer"},{name:"label",convert:d}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.HarvesterStore=function(g){function f(e,q){var o=[],a,b=q.getElementsByTagName("categories");if(b.length===1){var d=b[0].getElementsByTagName("category");for(a=0;a<d.length;a++){o.push(d[a].getAttribute("id"));}}return o;}function h(e,q){var o=[],d,b=q.getElementsByTagName("operation");for(d=0;d<b.length;d++){var a=b[d];o.push(a.getAttribute("name"));}return o;}function j(d,m){var e=Ext.data.Record.create([{name:"group_id",mapping:"@id"},{name:"operation",convert:h}]);var a=new Ext.data.XmlReader({record:"group"},e);var b=a.readRecords(m);return b;}return new Ext.data.XmlStore({autoDestroy:true,url:g,record:"node",idPath:"@id",fields:[{name:"id",mapping:"@id"},{name:"type",mapping:"@type"},{name:"site_name",mapping:"site/name"},{name:"site_uuid",mapping:"site/uuid"},{name:"site_host",mapping:"site/host"},{name:"site_servlet",mapping:"site/servlet"},{name:"site_port",mapping:"site/port"},{name:"site_url",mapping:"site/url"},{name:"site_icon",mapping:"site/icon"},{name:"site_ogctype",mapping:"site/ogctype"},{name:"options_lang",mapping:"options/lang"},{name:"options_topic",mapping:"options/topic"},{name:"options_createthumbnails",mapping:"options/createthumbnails"},{name:"options_uselayer",mapping:"options/uselayer"},{name:"options_uselayermd",mapping:"options/uselayermd"},{name:"options_datasetcategory",mapping:"options/datasetcategory"},{name:"privileges",convert:j},{name:"categories",convert:f},{name:"site_account_use",mapping:"site/account/use"},{name:"site_account_username",mapping:"site/account/username"},{name:"site_account_password",mapping:"site/account/password"},{name:"options_every",mapping:"options/every"},{name:"options_onerunonly",mapping:"options/onerunonly"},{name:"options_status",mapping:"options/status"},{name:"info_lastrun",mapping:"info/lastRun"},{name:"info_running",mapping:"info/running"},{name:"info_result_total",mapping:"info/result/total"},{name:"info_result_added",mapping:"info/result/added"},{name:"info_result_layer",mapping:"info/result/layer"},{name:"info_result_layerUuidExist",mapping:"info/result/layerUuidExist"},{name:"info_result_layerUsingMdUrl",mapping:"info/result/layerUsingMdUrl"},{name:"info_result_unknownSchema",mapping:"info/result/unknownSchema"},{name:"info_result_removed",mapping:"info/result/removed"},{name:"info_result_unretrievable",mapping:"info/result/unretrievable"},{name:"info_result_badFormat",mapping:"info/result/badFormat"},{name:"info_result_doesNotValidate",mapping:"info/result/doesNotValidate"},{name:"info_result_thumbnails",mapping:"info/result/thumbnails"},{name:"info_result_thumbnailsFailed",mapping:"info/result/thumbnailsFailed"},{name:"error_message",mapping:"error/message"},{name:"error_class",mapping:"error/class"},{name:"error_stack"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataCSWResultsStore=function(){function q(e,a){var d,b;if(a.URI){for(d=0;d<a.URI.length;d++){b=a.URI[d];if(b.name==="thumbnail"){if(b.value.indexOf("http")===-1){return GeoNetwork.Catalogue.URL+"/srv/en/"+b.value;}else{return b.value;}}}}return"";}function v(e,a){var d,b;if(a.URI){for(d=0;d<a.URI.length;d++){b=a.URI[d];if(b.protocol&&b.protocol.indexOf("http-get-capabilities")!==-1){return b.value;}}}return"";}function t(b,a){if(a.geonet_info){return a.geonet_info.source[0];}else{return"";}}function m(b,a){if(a.geonet_info){return a.geonet_info.popularity[0];}else{return"";}}function o(b,a){if(a.geonet_info){return a.geonet_info.rating[0];}else{return"";}}function w(b,a){if(a.geonet_info){return a.geonet_info.download[0];}else{return"";}}function u(b,a){if(a.geonet_info){return a.geonet_info.ownername[0];}else{return"";}}function s(b,a){if(a.geonet_info&&a.geonet_info.is_harvested){return a.geonet_info.is_harvested[0];}else{return"";}}function r(b,a){if(a.geonet_info&&a.geonet_info.edit){return a.geonet_info.edit;}else{return"false";}}return new Ext.data.JsonStore({totalProperty:"SearchResults.numberOfRecordsMatched",root:"records",fields:[{name:"title",mapping:"title[0].value",defaultValue:""},{name:"abstract",mapping:"abstract",defaultValue:""},{name:"subject",mapping:"subject"},{name:"uuid",mapping:"identifier[0].value",defaultValue:""},{name:"thumbnail",convert:q},{name:"uri",mapping:"uri",defaultValue:""},{name:"getCapabilitiesUrl",convert:v},{name:"isharvested",convert:s},{name:"source",convert:t},{name:"rating",convert:o},{name:"popularity",convert:m},{name:"download",convert:w},{name:"ownername",convert:u},{name:"edit",convert:r},{name:"bbox",mapping:"BoundingBox",defaultValue:""}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataRelationStore=function(m,j,l){var g=[{name:"id"},{name:"uuid"},{name:"title"},{name:"abstract"},{name:"keyword"},{name:"type",mapping:"@type"}];if(l){var h=new Ext.data.XmlReader({record:"relation",idProperty:"uuid"},g);return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:m,params:j,disableCaching:false}),reader:h,groupField:"type",sortInfo:{field:"type",direction:"ASC"}});}else{return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:m,disableCaching:false}),record:"relation",idPath:"uuid",fields:g});}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataResultsStore=function(){function N(a,b){if(b.title&&b.title){return b.title[0].value;}else{return"";}}function L(d,e){var b,f=[],a;if(e.geonet_info&&e.geonet_info.valid_details){a=e.geonet_info.valid_details;
for(b=0;b<a.length;b++){f.push({valid:a.status[b].value,type:a.type[b].value,ratio:a.ratio[b].value});}}return f;}function S(d,e){var b;var a="";var f;if(e.image){for(b=0;b<e.image.length;b++){f=e.image[b].value;if(f.indexOf("http")!==-1||b===0){a=f;}}}return a;}function J(e,f){var b,g=[],a,d;if(f.responsibleParty){for(b=0;b<f.responsibleParty.length;b++){a=f.responsibleParty[b];d=(f.responsibleParty.organisationName&&f.responsibleParty.organisationName[b]?f.responsibleParty.organisationName[b].value:"");g.push({applies:a.appliesTo,logo:a.logo,role:a.role,name:d});}}return g;}function K(a,b){if(b.link){return b.link;}return[];}function I(a,b){if(b.geonet_info&&b.geonet_info.source){return b.geonet_info.source[0].value;}else{return"";}}function D(a,b){if(b.geonet_info&&b.geonet_info.popularity){return b.geonet_info.popularity[0].value;}else{return"";}}function O(a,b){if(b.geonet_info&&b.geonet_info.rating){return b.geonet_info.rating[0].value;}else{return"";}}function W(a,b){if(b.geonet_info&&b.geonet_info.download){return b.geonet_info.download[0].value;}else{return"";}}function P(a,b){if(b.geonet_info&&b.geonet_info.ownername){return b.geonet_info.ownername[0].value;}else{return"";}}function C(a,b){if(b.geonet_info&&b.geonet_info.isHarvested){return b.geonet_info.isHarvested[0].value;}else{return"";}}function E(a,b){if(b.geonet_info&&b.geonet_info.harvestInfo&&b.geonet_info.harvestInfo.type){return b.geonet_info.harvestInfo.type[0].value;}else{return"";}}function T(a,b){if(b.geonet_info&&b.geonet_info.category){return b.geonet_info.category;}else{return"";}}function U(a,b){if(b.geonet_info&&b.geonet_info.changeDate){return b.geonet_info.changeDate[0].value;}else{return"";}}function M(a,b){if(b.geonet_info&&b.geonet_info.createDate){return b.geonet_info.createDate[0].value;}else{return"";}}function H(a,b){if(b.geonet_info&&b.geonet_info.selected){return b.geonet_info.selected[0].value;}else{return"";}}function G(a,b){if(b["abstract"]){return b["abstract"][0].value;}else{return"";}}function F(a,b){if(b.type){return b.type[0].value;}else{return"";}}function V(a,b){if(b.geonet_info&&b.geonet_info.edit){return b.geonet_info.edit[0].value;}else{return"false";}}function Q(a,b){if(b.geonet_info&&b.geonet_info.displayOrder){return b.geonet_info.displayOrder[0].value;}else{return 0;}}return new Ext.data.JsonStore({totalProperty:"summary.count",root:"records",fast:"false",service:"xml.search",fields:[{name:"title",convert:N},{name:"abstract",convert:G},{name:"type",convert:F},{name:"subject",mapping:"keyword",defaultValue:""},{name:"uuid",mapping:"geonet_info.uuid[0].value",defaultValue:""},{name:"id",mapping:"geonet_info.id[0].value",defaultValue:""},{name:"schema",mapping:"geonet_info.schema[0].value",defaultValue:""},{name:"contact",convert:J},{name:"thumbnail",convert:S},{name:"links",convert:K},{name:"uri",mapping:"uri",defaultValue:""},{name:"isharvested",convert:C},{name:"harvestertype",convert:E},{name:"createdate",convert:M},{name:"changedate",convert:U},{name:"selected",convert:H},{name:"source",convert:I},{name:"category",convert:T},{name:"rating",convert:O},{name:"popularity",convert:D},{name:"download",convert:W},{name:"ownername",convert:P},{name:"edit",convert:V},{name:"bbox",mapping:"BoundingBox",defaultValue:""},{name:"displayOrder",convert:Q,sortType:"asInt"},{name:"valid",mapping:"geonet_info.valid[0].value",defaultValue:"-1"},{name:"valid_details",convert:L}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataResultsFastStore=function(){var Y="|";function Q(a,b){if(b.title&&b.title){return b.title[0].value;}else{return"";}}function O(a,b){if(b.valid){return b.valid[0].value;}else{return"-1";}}function L(f,g){var d,h=[],a;for(var e in g){if(g.hasOwnProperty(e)&&e.indexOf("valid_")!==-1){var b=g[e];h.push({valid:b[0].value,type:e.split("_")[1],ratio:""});}}return h;}function V(e,f){var d;var b="";var g;if(f.image){for(d=0;d<f.image.length;d++){var a=f.image[d].value.split(Y);g=a[1];if(g.indexOf("http")!==-1||d===0){b=g;}}}return b;}function K(f,g){var d,h=[],b,e;if(g.responsibleParty){for(d=0;d<g.responsibleParty.length;d++){var a=g.responsibleParty[d].value.split(Y);h.push({applies:a[1],logo:a[3],role:a[0],name:a[2]});}}return h;}function M(b,e){var d=[];if(e.link){for(i=0;i<e.link.length;i++){var a=e.link[i].value.split(Y);d.push({name:a[0],title:a[1],href:a[2],protocol:a[3],type:a[4]});}}return d;}function J(a,b){if(b.geonet_info&&b.geonet_info.source){return b.geonet_info.source[0].value;}else{return"";}}function E(a,b){if(b.popularity){return b.popularity[0].value;}else{return"";}}function S(a,b){if(b.rating){return b.rating[0].value;}else{return"";}}function ab(a,b){if(b.download){return b.download[0].value;}else{return"";}}function T(d,e){if(e.userinfo&&e.userinfo[0].value){var b=e.userinfo[0].value.split(Y);try{return b[2]+" "+b[1];}catch(a){return"";}}else{return"";}}function N(a,b){if(b.isHarvested){return b.isHarvested[0].value;}else{return"";}}function F(a,b){if(b.geonet_info&&b.geonet_info.harvestInfo&&b.geonet_info.harvestInfo.type){return b.geonet_info.harvestInfo.type[0].value;}else{return"";}}function W(a,b){if(b.category){return b.category;}else{return"";}}function Z(a,b){if(b.geonet_info&&b.geonet_info.changeDate){return b.geonet_info.changeDate[0].value;}else{return"";}}function P(a,b){if(b.geonet_info&&b.geonet_info.createDate){return b.geonet_info.createDate[0].value;}else{return"";}}function I(a,b){if(b.geonet_info&&b.geonet_info.selected){return b.geonet_info.selected[0].value;}else{return"";}}function H(a,b){if(b["abstract"]){return b["abstract"][0].value;}else{return"";}}function G(a,b){if(b.type){return b.type[0].value;}else{return"";}}function aa(a,b){if(b.geonet_info&&b.geonet_info.edit){return b.geonet_info.edit[0].value;}else{return"false";}}function U(a,b){if(b.geonet_info&&b.geonet_info.displayOrder){return b.geonet_info.displayOrder[0].value;}else{return 0;}}return new Ext.data.JsonStore({totalProperty:"summary.count",root:"records",fast:"index",service:"q",fields:[{name:"title",convert:Q},{name:"abstract",convert:H},{name:"type",convert:G},{name:"subject",mapping:"keyword",defaultValue:""},{name:"uuid",mapping:"geonet_info.uuid[0].value",defaultValue:""},{name:"id",mapping:"geonet_info.id[0].value",defaultValue:""},{name:"schema",mapping:"geonet_info.schema[0].value",defaultValue:""},{name:"contact",convert:K},{name:"thumbnail",convert:V},{name:"links",convert:M},{name:"uri",mapping:"uri",defaultValue:""},{name:"isharvested",convert:N},{name:"harvestertype",convert:F},{name:"createdate",convert:P},{name:"changedate",convert:Z},{name:"selected",convert:I},{name:"source",convert:J},{name:"category",convert:W},{name:"rating",convert:S},{name:"popularity",convert:E},{name:"download",convert:ab},{name:"ownername",convert:T},{name:"edit",convert:aa},{name:"bbox",mapping:"BoundingBox",defaultValue:""},{name:"displayOrder",convert:U,sortType:"asInt"},{name:"valid",convert:O},{name:"valid_details",convert:L}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataSummaryStore=function(){return new Ext.data.JsonStore({totalProperty:"count",root:"keywords.keyword",listeners:{load:function(l,m,t){var u="count";var q="class";var r="type";var o={};var s=6;l.each(function(b){b.set(r,l.root);var a=b.get(r);if(typeof o.type!=="object"){o.type={maxValue:0,minValue:1};}o.type.maxValue=Math.max(b.get(u),o.type.maxValue);o.type.minValue=Math.min(b.get(u),o.type.minValue);});l.each(function(b){var a=b.get(r);var d=0;if(o.type.maxValue!==o.type.minValue){d=(b.get(u)-o.type.minValue)/(o.type.maxValue-o.type.minValue)*s;}b.set(q,Math.round(d));});}},sortInfo:{field:"value",direction:"ASC"},fields:[{name:"type",defaultValue:null},{name:"value",mapping:"name",defaultValue:""},{name:"count",mapping:"count",defaultValue:""},{name:"class",defaultValue:"0"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.MetadataThumbnailStore=function(e,g){var f=[{name:"href"},{name:"desc"},{name:"type"},{name:"mimetype"}];return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:e,params:g,disableCaching:false}),record:"thumbnail",idPath:"href",fields:f});
};Ext.namespace("GeoNetwork.data");GeoNetwork.data.OpenSearchSuggestionReader=function(e,d){e=e||{};GeoNetwork.data.OpenSearchSuggestionReader.superclass.constructor.call(this,e,d||e.fields);};Ext.extend(GeoNetwork.data.OpenSearchSuggestionReader,Ext.data.JsonReader,{rootId:undefined,readRecords:function(v){this.arrayData=v;var G,I;var K=this.meta,O=K?Ext.num(K.idIndex,K.id):null,Q=this.recordType,H=Q.prototype.fields,F=[],N=true,M;this.rootId=1;var j=(!this.rootId?this.getRoot(v):v[this.rootId]);for(G=0,len=j.length;G<len;G++){var o=j[G],S={},J=((O||O===0)&&o[O]!==undefined&&o[O]!==""?o[O]:null);for(I=0,jlen=H.length;I<jlen;I++){var s=H.items[I],f=s.mapping!==undefined&&s.mapping!==null?s.mapping:I;M=o[f]!==undefined?o[f]:s.defaultValue;M=s.convert(M,o);S[s.name]=o;}var P=new Q(S,J);P.json=o;F[F.length]=P;}var L=F.length;if(K.totalProperty){M=parseInt(this.getTotal(v),10);if(!isNaN(M)){L=M;}}if(K.successProperty){M=this.getSuccess(v);if(M===false||M==="false"){N=false;}}return{success:true,records:F,totalRecords:F.length};}});Ext.namespace("GeoNetwork.data");Ext.namespace("GeoNetwork.data");GeoNetwork.data.OpenSearchSuggestionStore=function(b){b=b||{};GeoNetwork.data.OpenSearchSuggestionStore.superclass.constructor.call(this,Ext.apply(b,{proxy:b.proxy||(!b.data?new Ext.data.HttpProxy({url:b.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoNetwork.data.OpenSearchSuggestionReader(b,b.fields||["value"])}));};Ext.extend(GeoNetwork.data.OpenSearchSuggestionStore,Ext.data.Store);Ext.namespace("GeoNetwork.data");GeoNetwork.data.RegionStore=function(e){function d(r,s){var a={};var m;var q=s.getElementsByTagName("label");if(q.length===1){var o=q[0].childNodes;var b;for(m=0,len=o.length;m<len;++m){b=o[m];if(b.nodeType===1){a[b.nodeName]=b.firstChild.nodeValue;}}}return a;}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:e,disableCaching:false}),record:"region",idPath:"@id",fields:[{name:"id",mapping:"@id"},{name:"north"},{name:"south"},{name:"east"},{name:"west"},{name:"label",convert:d}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.SubTemplateTypeStore=function(b){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:b,disableCaching:false}),record:"record",idPath:"type",fields:[{name:"type"},{name:"schema"},{name:"label"},{name:"description"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.SuggestionStore=function(q,l,o){function m(a,b){var d=b.getAttribute("type");return'<span class="'+d+'">&#160;</span>';}var h=[{name:"id",mapping:"@id"},{name:"name",mapping:"@process"},{name:"target",mapping:"@target"},{name:"category",mapping:"@category"},{name:"desc",mapping:"name"},{name:"params",mapping:"params"},{name:"operational",mapping:"operational"}];if(o){var j=new Ext.data.XmlReader({record:"suggestion",idProperty:"@id"},h);return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:q,params:l,disableCaching:false}),reader:j,groupField:"category",sortInfo:{field:"target",direction:"ASC"}});}else{return new Ext.data.XmlStore({autoDestroy:true,baseParams:l,proxy:new Ext.data.HttpProxy({method:"GET",url:q,disableCaching:false}),record:"suggestion",idPath:"@id",fields:h});}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.ThesaurusFeedStore=function(g){var f="http://geonetwork.svn.sourceforge.net/svnroot/geonetwork/utilities/repository/thesaurus.xml";var e=new Ext.data.XmlStore({autoDestroy:true,autoLoad:true,proxy:new Ext.data.HttpProxy({method:"GET",url:g||f,disableCaching:false}),record:"entry",idPath:"id",fields:[{name:"id"},{name:"title"},{name:"link",mapping:"link/@href"},{name:"updated"},{name:"summary"},{name:"category"}]});return e;};Ext.namespace("GeoNetwork.data");GeoNetwork.data.ThesaurusStore=function(j){var h=Ext.data.Record.create([{name:"filename"},{name:"title"},{name:"theme",mapping:"dname"},{name:"id",mapping:"key"},{name:"type"},{name:"activated"}]);var f=new Ext.data.Store({url:j.url,reader:new Ext.data.XmlReader({record:"thesaurus"},h),sortInfo:{field:"id",direction:"ASC"},fields:["filename","theme","id","title","type","activated"]});if(j.allOption){var g=new h({filename:OpenLayers.i18n("anyThesaurus"),activated:"y"});g.set("id","");f.add(g);}if(j.activatedOnly){f.on("load",function(){var a=this.query("activated","n");a.each(function(b,d){this.removeAt(this.indexOf(b));},f);},f);}f.load({add:true});return f;};Ext.namespace("GeoNetwork.data");GeoNetwork.data.UserStore=function(b){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:b,disableCaching:false}),record:"user",idPath:"id",fields:[{name:"id"},{name:"username"},{name:"surname"},{name:"name"},{name:"profile"},{name:"address"},{name:"email"},{name:"city"},{name:"state"},{name:"zip"},{name:"country"},{name:"organisation"},{name:"kind"}]});};Ext.namespace("GeoNetwork.data");GeoNetwork.data.ValidationRuleStore=function(q,l,o){function m(a,b){var d=b.getAttribute("type");return'<span class="'+d+'">&#160;</span>';}var h=[{name:"id",mapping:"@id"},{name:"group",mapping:"@group"},{name:"status",mapping:"@type"},{name:"statusIcon",convert:m},{name:"title"},{name:"details"},{name:"msg"}];if(o){var j=new Ext.data.XmlReader({record:"rule",idProperty:"id"},h);return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:q,params:l,disableCaching:false}),reader:j,groupField:"group",sortInfo:{field:"status",direction:"ASC"}});}else{return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:q,params:l,disableCaching:false}),record:"rule",idPath:"@id",fields:h});}};Ext.namespace("GeoNetwork.data");GeoNetwork.data.Z3950RepositoryStore=function(b){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:b,disableCaching:false}),record:"repository",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"code",mapping:"id/@code"},{name:"name",mapping:"label"}]});};Ext.namespace("GeoNetwork.form");GeoNetwork.form.GeometryMapField=Ext.extend(GeoExt.MapPanel,{layer_style:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),geometryFieldId:undefined,geometryField:undefined,mapOptions:undefined,extentBox:undefined,vectorLayer:undefined,nearYou:undefined,initStyle:function(){this.layer_style.fillOpacity=0;this.layer_style.strokeOpacity=0.8;this.layer_style.strokeDashstyle="dash";this.layer_style.strokeWidth=4;},createExtentControl:function(){var d;if(this.restrictToMapExtent){d=new Ext.form.Checkbox({boxLabel:OpenLayers.i18n("restrictSearchToMap"),checked:this.activated?true:false,listeners:{check:function(b,a){this.geometryField.setValue("");this.nearYou.toggle(false);if(a){this.on("aftermapmove",this.setField,this);this.fireEvent("aftermapmove");}else{this.un("aftermapmove",this.setField,this);}},scope:panel}});this.getTopToolbar().add(d);if(this.activated){this.on("aftermapmove",this.setField,this);}}else{this.initStyle();this.extentBox=new GeoNetwork.Control.ExtentBox({wktelement:this.geometryField,vectorLayerStyle:this.layer_style});d=new GeoExt.Action({control:this.extentBox,toggleGroup:this.map.id+"move",allowDepress:false,pressed:this.activated?true:false,map:this.map,tooltip:{title:OpenLayers.i18n("selectExtentTooltipTitle"),text:OpenLayers.i18n("selectExtentTooltipText")},iconCls:"selextent"});this.vectorLayer=this.extentBox.getOrCreateLayer();var e={iconCls:"clearPolygon",tooltip:{title:OpenLayers.i18n("clearExtentTooltipTitle"),text:OpenLayers.i18n("clearExtentTooltipText")},handler:function(){this.vectorLayer.destroyFeatures();this.geometryField.setValue("");},scope:this};this.getTopToolbar().add(d,e);}if(this.nearYouControl){this.getTopToolbar().add(this.nearYou);}return d;},createNavBar:function(){var o=[];var h=this;this.nearYou=new Ext.Button({iconCls:"md-mn mn-user-location",iconAlign:"right",tooltip:OpenLayers.i18n("mapNearYou"),enableToggle:true,toggleGroup:this.map.id+"move",listeners:{toggle:function(d,b){var a=this;
if(b){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(e){a.map.panTo(new OpenLayers.LonLat(e.coords.longitude,e.coords.latitude));a.geometryField.setValue("POINT("+e.coords.latitude+" "+e.coords.longitude+")");});}}else{a.geometryField.setValue("");}},scope:h}});var m=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent(),map:this.map,iconCls:"zoomfull",tooltip:{title:OpenLayers.i18n("zoomToMaxExtentTooltipTitle"),text:OpenLayers.i18n("zoomToMaxExtentTooltipText")}});var j=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox(),map:this.map,toggleGroup:this.map.id+"move",allowDepress:false,iconCls:"zoomin",tooltip:{title:OpenLayers.i18n("zoominTooltipTitle"),text:OpenLayers.i18n("zoominTooltipText")}});var q=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({displayClass:"ZoomOut",out:true}),map:this.map,toggleGroup:this.map.id+"move",allowDepress:false,tooltip:{title:OpenLayers.i18n("zoomoutTooltipTitle"),text:OpenLayers.i18n("zoomoutTooltipText")},iconCls:"zoomout"});var l=new GeoExt.Action({control:new OpenLayers.Control.DragPan({isDefault:true}),toggleGroup:this.map.id+"move",allowDepress:false,pressed:this.activated?false:true,map:this.map,iconCls:"pan",tooltip:{title:OpenLayers.i18n("dragTooltipTitle"),text:OpenLayers.i18n("dragTooltipText")}});o.push(m,j,q,l,"->");return o;},defaultConfig:{id:"geometryMap",width:290,height:180,border:false,activated:false,restrictToMapExtent:false,nearYouControl:true},initComponent:function(){Ext.applyIf(this,this.defaultConfig);var b=this.mapOptions||{projection:"EPSG:4326",units:"degrees",maxExtent:new OpenLayers.Bounds(-180,-90,180,90),restrictedExtent:new OpenLayers.Bounds(-180,-90,180,90),controls:[]};if(!b.controls){b.controls=[];}this.map=new OpenLayers.Map("search_map",b);this.map.addControl(new GeoNetwork.Control.ZoomWheel());this.map.addControl(new OpenLayers.Control.LoadingPanel());this.map.addControl(new OpenLayers.Control.MousePosition());this.tbar=this.createNavBar();this.geometryField=Ext.getCmp(this.geometryFieldId);GeoNetwork.form.GeometryMapField.superclass.initComponent.call(this);this.createExtentControl();},setExtent:function(b){if(b){this.extentBox.updateFields(b);}else{this.extentBox.updateFields(this.map.getMaxExtent());}},setField:function(){if(this.geometryField!==undefined){var d=this.map.getExtent().toArray();var e="POLYGON(("+d[0]+" "+d[1]+","+d[0]+" "+d[3]+","+d[2]+" "+d[3]+","+d[2]+" "+d[1]+","+d[0]+" "+d[1]+"))";this.geometryField.setValue(e);}}});Ext.reg("gn_geometrymapfield",GeoNetwork.form.GeometryMapField);Ext.namespace("GeoNetwork.form");GeoNetwork.form.OpenSearchSuggestionTextField=Ext.extend(Ext.form.ComboBox,{defaultConfig:{hideLabel:true,width:400,minChars:2,loadingText:"...",hideTrigger:true,forceLowerCase:true},url:undefined,field:"any",fieldLabel:undefined,name:"E_any",displayField:"value",tpl:undefined,mode:"remote",store:undefined,queryParam:"q",autoSelect:false,itemSelector:"div.search-item",initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.id="E_"+this.field;GeoNetwork.form.OpenSearchSuggestionTextField.superclass.initComponent.call(this);if(!this.tpl){var b='<tpl for="."><div class="search-item"><h3>{[values.value.replace(Ext.getDom(\''+this.id+"').value, '<span>' + Ext.getDom('"+this.id+"').value + '</span>')]}</h3></div></tpl>";this.tpl=new Ext.XTemplate(b);}if(this.forceLowerCase){this.on("beforequery",function(a){a.query=a.query.toLowerCase();});}this.store=new GeoNetwork.data.OpenSearchSuggestionStore({url:this.url,rootId:1,baseParams:{field:this.field}});}});Ext.reg("gn_opensearchsuggestiontextfield",GeoNetwork.form.OpenSearchSuggestionTextField);Ext.namespace("GeoNetwork.form");GeoNetwork.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){if(!this.store.baseParams){this.store.baseParams={};}GeoNetwork.form.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(e,d){if(d.getKey()===d.ENTER){this.onTrigger2Click();}},this);},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,hasSearch:false,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.store.baseParams[this.paramName]="";this.store.removeAll();this.el.dom.value="";this.triggers[0].hide();this.hasSearch=false;this.focus();}},onTrigger2Click:function(){var b=this.getRawValue();if(b.length<1){this.store.baseParams[this.paramName]="*";}else{this.store.baseParams[this.paramName]=b;}if(this.triggerAction){this.triggerAction(this.scope,b);}else{this.store.reload();}this.hasSearch=true;this.triggers[0].show();this.focus();}});Ext.reg("gn_searchfield",GeoNetwork.form.SearchField);Ext.namespace("GeoNetwork");GeoNetwork.LoginForm=Ext.extend(Ext.FormPanel,{url:"",catalogue:undefined,defaultConfig:{border:false,layout:"form",id:"loginForm",hideLoginLabels:true,width:340},defaultType:"textfield",userInfo:undefined,username:undefined,password:undefined,toggledFields:[],toggledFieldsOff:[],keys:[{key:[Ext.EventObject.ENTER],handler:function(){Ext.getCmp("btnLoginForm").fireEvent("click");}}],initComponent:function(){Ext.applyIf(this,this.defaultConfig);var q=this;var o=new Ext.Button({width:50,text:OpenLayers.i18n("login"),iconCls:"md-mn mn-login",id:"btnLoginForm",listeners:{click:function(){this.catalogue.login(this.username.getValue(),this.password.getValue());},scope:q}}),s=new Ext.Button({width:80,text:OpenLayers.i18n("administration"),listeners:{click:function(){catalogue.admin();},scope:this}}),r=new Ext.Button({width:80,text:OpenLayers.i18n("logout"),iconCls:"md-mn mn-logout",listeners:{click:function(){catalogue.logout();},scope:this}});this.username=new Ext.form.TextField({id:"username",name:"username",width:70,hideLabel:false,allowBlank:false,fieldLabel:OpenLayers.i18n("username"),emptyText:OpenLayers.i18n("username")});this.password=new Ext.form.TextField({name:"password",width:70,hideLabel:false,allowBlank:false,fieldLabel:OpenLayers.i18n("password"),emptyText:OpenLayers.i18n("password"),inputType:"password"});this.userInfo=new Ext.form.Label({width:170,text:"",cls:"loginInfo"});if(this.hideLoginLabels){this.toggledFields.push(this.username,this.password,o);}else{var m=new Ext.form.Label({html:OpenLayers.i18n("username")}),j=new Ext.form.Label({html:OpenLayers.i18n("password")});this.toggledFields.push(m,this.username,j,this.password,o);}this.toggledFieldsOff.push(this.userInfo,r);if(this.catalogue.adminAppUrl!==""){this.toggledFieldsOff.push(s);}this.items=[this.toggledFields,this.toggledFieldsOff];GeoNetwork.LoginForm.superclass.initComponent.call(this);var l=this.catalogue.isLoggedIn();this.login(this.catalogue,l);this.catalogue.on("afterLogin",this.login,this);this.catalogue.on("afterLogout",this.login,this);},login:function(f,g){var e=g?true:false;Ext.each(this.toggledFields,function(a){a.setVisible(!e);});Ext.each(this.toggledFieldsOff,function(a){a.setVisible(e);});if(f.identifiedUser&&f.identifiedUser.username){this.userInfo.setText(f.identifiedUser.name+" "+f.identifiedUser.surname+" <br/>("+f.identifiedUser.role+")",false);}else{this.userInfo.setText("");}this.doLayout(false,true);}});Ext.reg("gn_loginform",GeoNetwork.LoginForm);Ext.namespace("GeoNetwork");GeoNetwork.MetadataMenu=Ext.extend(Ext.menu.Menu,{record:undefined,setRecord:function(b){this.record=b;this.updateMenu();},resultsView:undefined,catalogue:undefined,editAction:undefined,deleteAction:undefined,zoomToAction:undefined,otherActions:undefined,adminMenuSeparator:undefined,duplicateAction:undefined,createChildAction:undefined,adminAction:undefined,categoryAction:undefined,viewAction:undefined,printAction:undefined,viewXMLAction:undefined,getMEFAction:undefined,ratingWidget:undefined,defaultConfig:{},create:function(){this.editAction=new Ext.Action({text:OpenLayers.i18n("edit"),iconCls:"md-mn-edit",handler:function(){var b=this.record.get("id");this.catalogue.metadataEdit(b);},scope:this});this.add(this.editAction);
this.deleteAction=new Ext.Action({text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){var b=this.record.get("uuid");this.catalogue.metadataDelete(b);},scope:this});this.add(this.deleteAction);this.duplicateAction=new Ext.Action({text:OpenLayers.i18n("duplicate"),iconCls:"md-mn-copy",handler:function(){var b=this.record.get("id");GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,b,OpenLayers.i18n("duplicate"),false);},scope:this});this.createChildAction=new Ext.Action({text:OpenLayers.i18n("createChild"),iconCls:"md-mn-copy",handler:function(){var b=this.record.get("id");GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,b,OpenLayers.i18n("createChild"),true);},scope:this});this.adminAction=new Ext.Action({text:OpenLayers.i18n("privileges"),iconCls:"privIcon",handler:function(){var b=this.record.get("id");this.catalogue.metadataAdmin(b);},scope:this});this.categoryAction=new Ext.Action({text:OpenLayers.i18n("categories"),handler:function(){var b=this.record.get("id");this.catalogue.metadataCategory(b);},scope:this});this.otherActions=new Ext.menu.Item({text:OpenLayers.i18n("otherActions"),menu:{items:[this.duplicateAction,this.createChildAction,this.adminAction,this.categoryAction]}});this.add(this.otherActions);this.adminMenuSeparator=new Ext.menu.Separator();this.add(this.adminMenuSeparator);this.viewAction=new Ext.Action({text:OpenLayers.i18n("view"),iconCls:"md-mn-view",handler:function(){var b=this.record.get("uuid");this.catalogue.metadataShow(b);},scope:this});this.add(this.viewAction);this.zoomToAction=new Ext.Action({text:OpenLayers.i18n("zoomTo"),iconCls:"zoomlayer",handler:function(){var b=this.record.get("uuid");this.resultsView.zoomTo(b);},scope:this});this.add(this.zoomToAction);this.viewXMLAction=new Ext.Action({text:OpenLayers.i18n("saveXml"),iconCls:"xmlIcon",handler:function(){var d=this.record.get("uuid");var e=this.record.get("schema");this.catalogue.metadataXMLShow(d,e);},scope:this});this.add(this.viewXMLAction);this.printAction=new Ext.Action({text:OpenLayers.i18n("printSel"),iconCls:"md-mn-pdf",handler:function(){this.catalogue.metadataPrint(this.record.get("uuid"));},scope:this});this.add(this.printAction);this.getMEFAction=new Ext.Action({text:OpenLayers.i18n("getMEF"),iconCls:"md-mn-zip",handler:function(){this.catalogue.metadataMEF(this.record.get("uuid"));},scope:this});this.add(this.getMEFAction);if(Ext.ux.RatingItem){this.ratingWidget=new Ext.ux.RatingItem(null,{canReset:false,name:"rating",disabled:true,nbStars:5,cls:"ux-menu-rating-item",listeners:{change:function(h,j,e){if(j){var g=this.record.get("uuid");this.catalogue.metadataRate(g,j,this.hide());this.ratingWidget.reset();}},scope:this}});this.add(this.ratingWidget);}this.updateMenu();},updateMenu:function(){if(!this.record){return;}var j=this.record.get("edit")==="true"?(this.record.get("isharvested")==="y"?GeoNetwork.Settings.editor.editHarvested||false:true):false,g=this.record.get("isharvested")==="y"?true:false,f=this.record.get("harvestertype"),h=this.catalogue.isIdentified();if(!h){this.editAction.hide();this.deleteAction.hide();}else{this.editAction.show();this.deleteAction.show();}this.otherActions.setVisible(h);this.adminMenuSeparator.setVisible(h);this.editAction.setDisabled(!j);this.adminAction.setDisabled(!j&&!g);this.categoryAction.setDisabled(!j&&!g);this.deleteAction.setDisabled(!j&&!g);if(this.ratingWidget){this.ratingWidget.reset();if(g&&f!=="geonetwork"){this.ratingWidget.disable();}else{this.ratingWidget.enable();}}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);GeoNetwork.MetadataMenu.superclass.initComponent.call(this);this.create();}});Ext.reg("gn_metadatamenu",GeoNetwork.MetadataMenu);Ext.namespace("GeoNetwork");GeoNetwork.MetadataResultsView=Ext.extend(Ext.DataView,{catalogue:undefined,templates:null,overClass:"md-over",itemSelector:"li.md",emptyText:"",autoWidth:true,maps:[],mapsProjection:"EPSG:4326",projectionFrom:undefined,projectionTo:undefined,mdSelectionUuids:[],layer_style:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),layer_style_hover:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),layer_style_selected:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),features:[],hover_feature:[],displayContextualMenu:true,contextMenu:undefined,contextMenuNodeId:undefined,acMenu:undefined,displaySerieMembers:false,maxOfMembers:50,relatedTpl:undefined,newMetadataWindow:undefined,plugins:[],listeners:{dblclick:{fn:function(q,j,m,l){if(this.maps.length!==0){var e=this.getStore().getAt(j);var o=e.get("uuid");this.zoomTo(o);}}},mouseenter:{fn:function(v,e,u,j){var r,s;if(this.maps.length!==0){var l=this.getStore().getAt(e);var w=l.get("uuid");for(s=0;s<this.maps.length;s++){var t=this.maps[s].layer;if(t.features){for(r=0;r<t.features.length;r++){if(w===t.features[r].attributes.id){if(!this.hover_feature[s]){t.drawFeature(t.features[r],this.layer_style_hover);this.hover_feature[s]=t.features[r];}continue;}}}}}this.actionMenuInit(e,u);}},mouseleave:{fn:function(o,j,m,l){var q;if(this.acMenu){this.acMenu.hide();}this.acMenu=undefined;for(q=0;q<this.maps.length;q++){if(this.hover_feature[q]){var e=this.maps[q].layer;e.drawFeature(this.hover_feature[q],this.layer_style);this.hover_feature[q]=null;continue;}}}},contextmenu:{fn:function(e,g,j,h){if(this.displayContextualMenu){this.contextMenuNodeId=g;this.createMenu(g,e);this.contextMenu.showAt(h.getXY());h.stopEvent();}}}},actionMenuInit:function(e,d){this.acMenu=Ext.get(Ext.DomQuery.selectNode("span.md-action-menu",d));this.acMenu.on("click",function(){this.createMenu(e,this);this.contextMenu.showAt([this.acMenu.getX(),this.acMenu.getY()+this.acMenu.getHeight()]);}.bind(this));this.acMenu.show();},createMenu:function(g,e){var f=this.getStore().getAt(g);if(!this.contextMenu){this.contextMenu=new GeoNetwork.MetadataMenu({floating:true,catalogue:catalogue,record:f,resultsView:e});}else{this.contextMenu.setRecord(f);}},zoomTo:function(l){var m,g;for(g=0;g<this.maps.length;g++){var h=this.maps[g].layer;if(h.features){for(m=0;m<h.features.length;m++){if(l===h.features[m].attributes.id){var j=h.features[m].geometry.getBounds();if(j){this.maps[g].map.zoomToExtent(j);}break;}}}}},initComponent:function(){var e;this.templates=this.templates||{SIMPLE:GeoNetwork.Templates.SIMPLE,THUMBNAIL:GeoNetwork.Templates.THUMBNAIL,FULL:GeoNetwork.Templates.FULL};GeoNetwork.MetadataResultsView.superclass.initComponent.call(this);this.setStore(this.catalogue.metadataStore);this.initStyle();this.relatedTpl=new Ext.XTemplate(this.relatedTpl||GeoNetwork.Templates.Relation.SHORT);if(this.maps){if(this.maps instanceof OpenLayers.Map){var g=this.maps;this.maps=[];this.addMap(g);}else{for(e=0;e<this.maps.length;e++){var f=this.maps[e];this.initMap(f);}}}else{this.maps=[];}this.on("selectionchange",this.selectionChange);},setStore:function(b){this.store=b;this.getStore().on({load:this.resultsLoaded,clear:this.destroyMetadataBbox,scope:this});},addMap:function(l,j){var m=false,g;for(g=0;g<this.maps.length;g++){if(this.maps[g].map.id===l.id){m=true;break;}}if(!m){var h={map:l,zoomToExtentOnSearch:j||false};this.mapsProjection=l.projection;this.projectionFrom=new OpenLayers.Projection("EPSG:4326");this.projectionTo=new OpenLayers.Projection(this.mapsProjection);this.maps.push(h);this.initMap(h);}},initMap:function(d){var e=new OpenLayers.Layer.Vector(OpenLayers.i18n("mdResultsLayer"),{style:this.layer_style});this.addCurrentFeatures(e);d.layer=e;d.map.addLayer(e);},removeMap:function(b){this.maps.splice(b,1);},getTemplates:function(){return this.templates;},removeTemplate:function(b){delete this.templates[b];},addTemplate:function(e,d){this.templates[e]=d;},applyTemplate:function(b){this.tpl=this.templates[b];this.refresh();},initStyle:function(){this.layer_style.fillOpacity=0;this.layer_style.graphicOpacity=1;this.layer_style_selected.fillOpacity=0.1;this.layer_style_hover.fillOpacity=0.3;this.layer_style_hover.strokeWidth=3;},destroyMetadataBbox:function(){var d;
for(d=0;d<this.maps.length;d++){var e=this.maps[d].layer;if(e.features){if(e.features.length>0){this.features=[];e.destroyFeatures();}}}},resultsLoaded:function(f,e,g){this.drawMetadataBbox(f,e,g);this.contextMenu=undefined;this.initRatingWidget();this.dislayLinks(e);},dislayLinks:function(e){var g="children",f=this;if(this.displaySerieMembers){Ext.each(e,function(d){var b=d.get("type")==="series",a=d.get("id");if(b){var j=new GeoNetwork.data.MetadataRelationStore(this.catalogue.services.mdRelation+"?type="+g+"&fast=false&uuid="+escape(d.get("uuid")),null,true);j.load();j.on("load",function(h,m){Ext.each(m,function(t){var s=Ext.query("#md-relation-"+a,f.el.dom.body),u=Ext.get(s[0]),l=u.parent();if(l&&l.isScrollable()){l.addClass("more");}if(u){u.insertHtml("beforeEnd",f.relatedTpl.apply(t.data));l.setVisible(true);}},this);});}},this);}},drawMetadataBbox:function(h,q,m){var l,o;if(this.maps.length===0){return;}this.features=[];Ext.each(q,function(f){var b=f.get("bbox");if(b){var E=[];for(o=0;o<b.length;o++){var B=b[o].value;var r=new OpenLayers.Geometry.Point(B[2],B[1]);var C=new OpenLayers.Geometry.Point(B[2],B[3]);var D=new OpenLayers.Geometry.Point(B[0],B[3]);var F=new OpenLayers.Geometry.Point(B[0],B[1]);if(this.mapsProjection!=="EPSG:4326"){r.transform(this.projectionFrom,this.projectionTo);C.transform(this.projectionFrom,this.projectionTo);D.transform(this.projectionFrom,this.projectionTo);F.transform(this.projectionFrom,this.projectionTo);}var g=[r,C,D,F,r];var e=new OpenLayers.Geometry.LinearRing(g);var a=new OpenLayers.Geometry.Polygon([e]);E.push(a.clone());}var d=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(E),{id:f.get("uuid")});this.features.push(d.clone());}},this);for(l=0;l<this.maps.length;l++){this.addCurrentFeatures(this.maps[l].layer);}if(this.features.length>0){for(l=0;l<this.maps.length;l++){var j=this.maps[l];if(j.zoomToExtentOnSearch){j.map.zoomToExtent(j.layer.getDataExtent());}}}},initRatingWidget:function(){var g=Ext.DomQuery.select("div.rating"),f;for(f=0;f<g.length;++f){if(Ext.ux.RatingItem){var e=new Ext.ux.RatingItem(g[f],{disabled:true,name:"rating"+f});}else{g[f].style.display="none";}}},selectAll:function(){var d=Ext.DomQuery.select("input.selector"),e;for(e=0;e<d.length;++e){d[e].checked=true;}},selectAllInPage:function(){var d=Ext.DomQuery.select("input.selector"),e;for(e=0;e<d.length;++e){d[e].checked=true;Ext.each(this.getRecords(this.getNodes()),function(a){var b=a.get("uuid");this.catalogue.metadataSelect("add",[b]);},this);}},selectNone:function(){var d=Ext.DomQuery.select("input.selector"),e;for(e=0;e<d.length;++e){d[e].checked=false;}},selectionChange:function(s,l){if(this.catalogue){var m=this.getRecords(l);var o={};var t=[];var q=[];var u;var r;for(u=0;u<m.length;u++){r=m[u].get("uuid");o[r]=true;}for(u=0;u<this.mdSelectionUuids.length;u++){r=this.mdSelectionUuids[u];if(o[r]){t.push(r);}else{q.push(r);}}for(r in o){if(o.hasOwnProperty(r)&&!this.mdSelectionUuids[r]){t.push(r);}}this.catalogue.metadataSelect("add",t);this.catalogue.metadataSelect("remove",q);this.mdSelectionUuids=t;}},addCurrentFeatures:function(q){var j=this.features.length,h;if(j>0){var o=[];o=[];var l,m;for(h=0;h<j;h++){l=this.features[h];m=l.clone();o[h]=m;}q.addFeatures(o);}},onDestroy:function(){GeoNetwork.MetadataResultsView.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gn_metadataresultsview",GeoNetwork.MetadataResultsView);Ext.namespace("GeoNetwork");GeoNetwork.MetadataResultsToolbar=Ext.extend(Ext.Toolbar,{catalogue:undefined,metadataResultsView:undefined,mdSelectionInfoCmp:undefined,searchBtCmp:undefined,sortByCmp:undefined,sortByCombo:undefined,mdSelectionInfo:"md-selection-info",selectionActions:[],deleteAction:undefined,otherItem:undefined,ownerAction:undefined,updateCategoriesAction:undefined,updatePrivilegesAction:undefined,createMetadataAction:undefined,newMetadataWindow:undefined,mdImportAction:undefined,adminAction:undefined,actionMenu:undefined,item:null,actionOnSelectionMenu:undefined,admin:false,initComponent:function(){var e=[];e.push(this.createSelectionToolBar());e.push(["->"]);var d=this.getSortByCombo();e.push(OpenLayers.i18n("sortBy"),d,"|");e.push(this.createTemplateMenu());e.push(this.createOtherActionMenu());GeoNetwork.MetadataResultsToolbar.superclass.initComponent.call(this);this.add(e);this.catalogue.on("selectionchange",this.updateSelectionInfo,this);this.catalogue.on("afterLogin",this.updatePrivileges,this);this.catalogue.on("afterLogout",this.updatePrivileges,this);this.updateSelectionInfo(this.catalogue,0);},getSortByCombo:function(){var b=this;this.sortByCombo=new Ext.form.ComboBox({mode:"local",id:"sortByToolBar",triggerAction:"all",value:"relevance",width:130,store:GeoNetwork.util.SearchFormTools.getSortByStore(),valueField:"id",displayField:"name",listeners:{select:function(j,h,a){if(this.sortByCmp){this.sortByCmp.setValue(j.getValue());var g=j.getValue().split("#");Ext.getCmp("E_sortBy").setValue(g[0]);Ext.getCmp("sortOrder").setValue(g[1]);}if(this.searchBtCmp){this.searchBtCmp.fireEvent("click");}},scope:b}});return this.sortByCombo;},clickTemplateMenu:function(e,d){if(d){this.applyTemplate(e.getId());}this.initRatingWidget();},createMassiveActionMenu:function(b){this.deleteAction=new Ext.menu.Item({text:OpenLayers.i18n("delete"),iconCls:"cancel",id:"deleteAction",handler:function(){this.catalogue.massiveOp("Delete",function(){this.catalogue.metadataSelectNone();});},scope:this,hidden:b});this.ownerAction=new Ext.menu.Item({text:OpenLayers.i18n("newOwner"),id:"ownerAction",handler:function(){this.catalogue.massiveOp("NewOwner");},scope:this,hidden:b});this.updateCategoriesAction=new Ext.menu.Item({text:OpenLayers.i18n("updateCategories"),id:"updateCategoriesAction",handler:function(){this.catalogue.massiveOp("Categories");},scope:this,hidden:b});this.updatePrivilegesAction=new Ext.menu.Item({text:OpenLayers.i18n("updatePrivileges"),id:"updatePrivilegesAction",iconCls:"privIcon",handler:function(){this.catalogue.massiveOp("Privileges");},scope:this,hidden:b});this.selectionActions.push(this.deleteAction,this.ownerAction,this.updateCategoriesAction,this.updatePrivilegesAction);this.actionMenu.addItem(this.deleteAction);this.actionMenu.addItem(this.ownerAction);this.actionMenu.addItem(this.updateCategoriesAction);this.actionMenu.addItem(this.updatePrivilegesAction);},createAdminMenu:function(b){this.actionMenu.addItem("-");this.otherItem=new Ext.menu.TextItem({html:'<b class="menu-title">'+OpenLayers.i18n("adminAction")+"</b>",hidden:true});this.actionMenu.addItem(this.otherItem);this.createMetadataAction=new Ext.menu.Item({text:OpenLayers.i18n("newMetadata"),iconCls:"addIcon",handler:function(){if(this.newMetadataWindow){this.newMetadataWindow.close();this.newMetadataWindow=undefined;}if(!this.newMetadataWindow){var a=new GeoNetwork.editor.NewMetadataPanel({getGroupUrl:this.catalogue.services.getGroups,catalogue:this.catalogue});this.newMetadataWindow=new Ext.Window({title:OpenLayers.i18n("newMetadata"),width:600,height:420,layout:"fit",modal:true,items:a,closeAction:"hide",constrain:true,iconCls:"addIcon"});}this.newMetadataWindow.show();},scope:this,hidden:b});this.actionMenu.addItem(this.createMetadataAction);this.mdImportAction=new Ext.menu.Item({text:OpenLayers.i18n("importMetadata"),handler:function(){this.catalogue.metadataImport();},scope:this,hidden:b});this.actionMenu.addItem(this.mdImportAction);this.adminAction=new Ext.menu.Item({text:OpenLayers.i18n("administration"),handler:function(){this.catalogue.admin();},scope:this,hidden:b});this.actionMenu.addItem(this.adminAction);},createTemplateMenu:function(){var h=this.metadataResultsView.getTemplates();var j=[];var g;for(g in h){if(h.hasOwnProperty(g)){var f=new Ext.Button({text:"",enableToggle:true,toggleGroup:"tpl",id:g,iconCls:"mn-view-"+g.toLowerCase(),toggleHandler:this.clickTemplateMenu,scope:this.metadataResultsView,pressed:(g==="FULL"?true:false)});j.push(f);}}return[j,"|"];},createOtherActionMenu:function(){this.actionMenu=new Ext.menu.Menu();
var g=new Ext.Action({text:OpenLayers.i18n("exportCsv"),handler:function(){this.catalogue.csvExport();},scope:this});var e=new Ext.Action({text:OpenLayers.i18n("exportZip"),iconCls:"md-mn-zip",handler:function(){this.catalogue.mefExport();},scope:this});var f=new Ext.Action({text:OpenLayers.i18n("printSel"),iconCls:"md-mn-pdf",handler:function(){this.catalogue.pdfExport();},scope:this});this.selectionActions.push(e,g,f);this.actionMenu.add('<b class="menu-title">'+OpenLayers.i18n("onSelection")+"</b>",e,g,f);this.createMassiveActionMenu(!this.catalogue.isIdentified());this.createAdminMenu(!this.catalogue.isIdentified());this.actionOnSelectionMenu=new Ext.Button({text:OpenLayers.i18n("otherActions"),menu:this.actionMenu});return this.actionOnSelectionMenu;},createSelectionToolBar:function(){var f=new Ext.Action({text:OpenLayers.i18n("allInPage"),handler:function(){this.metadataResultsView.selectAllInPage();},scope:this});var g=new Ext.Action({text:OpenLayers.i18n("all"),handler:function(){this.catalogue.metadataSelectAll();this.metadataResultsView.selectAll();},scope:this});var j=new Ext.Action({text:OpenLayers.i18n("none"),handler:function(){this.catalogue.metadataSelectNone();this.metadataResultsView.selectNone();},scope:this});var h={id:"md-selection-info",xtype:"tbtext",text:OpenLayers.i18n("noneSelected")};this.catalogue.on("selectionchange",this.updateSelectionInfo,this);return[h,"|",{xtype:"tbtext",text:OpenLayers.i18n("select")},f,{xtype:"tbtext",text:", "},g,{xtype:"tbtext",text:", "},j];},updateSelectionInfo:function(d,e){if(!this.mdSelectionInfoCmp){this.mdSelectionInfoCmp=Ext.getCmp(this.mdSelectionInfo);}Ext.each(this.selectionActions,function(a){if(e===0){a.disable();}else{a.enable();}});this.mdSelectionInfoCmp.setText(e+" "+OpenLayers.i18n("selected"));},updatePrivileges:function(g,f){var e=[this.deleteAction,this.ownerAction,this.updateCategoriesAction,this.updatePrivilegesAction,this.createMetadataAction,this.mdImportAction,this.mdImportAction,this.adminAction,this.otherItem];Ext.each(e,function(){this.setVisible(f);});},onDestroy:function(){GeoNetwork.MetadataResultsToolbar.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gn_metadataresultstoolbar",GeoNetwork.MetadataResultsToolbar);Ext.namespace("GeoNetwork");GeoNetwork.TagCloudView=Ext.extend(Ext.DataView,{catalogue:undefined,multiSelect:true,root:"keywords.keyword",qurey:undefined,searchField:"themekey",onSuccess:null,onFailure:null,overClass:"tag-cloud-hover",itemSelector:"li.tag-cloud",emptyText:"",autoWidth:true,initComponent:function(){GeoNetwork.TagCloudView.superclass.initComponent.call(this);this.tpl=this.tpl||new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="tag-cloud tag-cloud-{class}">','<a href="#" onclick="javascript:catalogue.kvpSearch(\'fast='+this.catalogue.metadataStore.fast+"&summaryOnly=0&from=1&to=20&hitsPerPage=20&"+this.searchField+"={value}', "+this.onSuccess+","+this.onFailure+', null);" alt="{value}" title="{count} records">{value}</a>',"</li>","</tpl>","</ul>");this.store=this.catalogue.summaryStore;if(this.query){this.catalogue.kvpSearch(this.query,null,null,null,true);}}});Ext.reg("gn_tagcloudview",GeoNetwork.TagCloudView);Ext.namespace("GeoNetwork");GeoNetwork.Templates=Ext.extend(Ext.XTemplate,{compiled:false,disableFormats:false,catalogue:null,sortOrder:0,abstractMaxSize:50,xmlTplMarkup:['<?xml version="1.0" encoding="UTF-8"?>','<node id="{id}" type="{type}">',"<site>","<name>{site_name}</name>",'<tpl if="values.site_ogctype">',"<ogctype>{site_ogctype}</ogctype>","</tpl>",'<tpl if="values.site_url">',"<url>{site_url}</url>","</tpl>",'<tpl if="values.site_icon">',"<icon>{site_icon}</icon>","</tpl>",'<tpl if="values.site_account_use">',"<account>","<use>{site_account_use}</use>","<username>{site_account_username}</username>","<password>{site_account_password}</password>","</account>","</tpl>","</site>","<options>",'<tpl if="values.options_every">',"<every>{options_every}</every>","</tpl>",'<tpl if="values.options_onerunonly">',"<oneRunOnly>{options_onerunonly}</oneRunOnly>","</tpl>",'<tpl if="values.options_lang">',"<lang>{options_lang}</lang>","</tpl>",'<tpl if="values.options_topic">',"<topic>{options_topic}</topic>","</tpl>",'<tpl if="values.options_createthumbnails">',"<createThumbnails>{options_createthumbnails}</createThumbnails>","</tpl>",'<tpl if="values.options_uselayer">',"<useLayer>{options_uselayer}</useLayer>","</tpl>",'<tpl if="values.options_uselayermd">',"<useLayerMd>{options_uselayermd}</useLayerMd>","</tpl>",'<tpl if="values.options_datasetcategory">',"<datasetcategory>{options_datasetcategory}</datasetcategory>","</tpl>","</options>","<content>","</content>","<privileges>","</privileges>",'<group id="1">','<operation name="view" />','<operation name="dynamic" />',"</group>","<categories>","</categories>",'<tpl if="values.info_result_total">',"</tpl>","</node>"],initComponent:function(){GeoNetwork.Templates.superclass.initComponent.call(this);},getHarvesterTemplate:function(){return new Ext.XTemplate(this.xmlTplMarkup);}});GeoNetwork.Templates.TITLE='<h1><input type="checkbox" <tpl if="selected==\'true\'">checked="true"</tpl> class="selector" onclick="javascript:catalogue.metadataSelect((this.checked?\'add\':\'remove\'), [\'{uuid}\']);"/><a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');return false;">{title}</a><span class="md-action-menu"> - <a rel="mdMenu">'+OpenLayers.i18n("mdMenu")+"</a></span></h1>";GeoNetwork.Templates.RATING_TPL='<tpl if="isharvested==\'n\' || harvestertype==\'geonetwork\'"><div class="rating"><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'1\'">checked="true"</tpl> value="1"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'2\'">checked="true"</tpl> value="2"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'3\'">checked="true"</tpl> value="3"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'4\'">checked="true"</tpl> value="4"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'5\'">checked="true"</tpl> value="5"/></div></tpl>';GeoNetwork.Templates.LOGO='<div class="md-logo"><img src="{[catalogue.URL]}/images/logos/{source}.gif"/></div>';GeoNetwork.Templates.SIMPLE=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-simple" title="{abstract}">','<table><tr><td style="width:30px;">',GeoNetwork.Templates.LOGO,'</td><td id="{uuid}">',GeoNetwork.Templates.TITLE,'<tpl if="subject">','<span class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></span>","</tpl>","</td></tr></table>","</li>","</tpl>","</ul>");GeoNetwork.Templates.THUMBNAIL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-thumbnail">','<div class="md-wrap" id="{uuid}" title="{abstract}">',GeoNetwork.Templates.TITLE,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="{thumbnail}"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>",'<tpl for="links">',"<tpl if=\"values.type == 'application/vnd.ogc.wms_xml'\">","<a href=\"#\" class=\"md-mn addLayer\" title=\"{title}\" alt=\"{title}\" onclick=\"app.switchMode('1', true);app.getIMap().addWMSLayer([['{title}', '{href}', '{name}', '{id}']]);\">&nbsp;</a>","</tpl>","</tpl>","</div>","</li>","</tpl>","</ul>");GeoNetwork.Templates.FULL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-full">',"<table><tr>",'<td class="left">',GeoNetwork.Templates.LOGO,"</td>",'<td id="{uuid}">',GeoNetwork.Templates.TITLE,'<p class="abstract">{[values.abstract.substring(0, 350)]} ...</p>','<tpl if="subject">','<p class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></p>","</tpl>",'<div class="md-links">','<tpl for="links">',"<tpl if=\"values.type == 'application/vnd.ogc.wms_xml' || values.type == 'OGC:WMS'\">",'<a href="#" class="md-mn addLayer" title="'+OpenLayers.i18n("addToMap")+" {title}\" alt=\"Add layer to map\" onclick=\"app.switchMode('1', true);app.getIMap().addWMSLayer([['{[escape(values.title)]}', '{href}', '{name}', '{id}']]);\">&nbsp;</a>","</tpl>","<tpl if=\"values.type == 'application/vnd.google-earth.kml+xml'\">",'<a href="{href}" class="md-mn md-mn-kml" title="'+OpenLayers.i18n("viewKml")+' {title}" alt="Open kml">&nbsp;</a>',"</tpl>","<tpl if=\"values.type == 'application/zip' || values.type == 'application/x-compressed'\">",'<a href="{href}" class="md-mn md-mn-zip" title="'+OpenLayers.i18n("downloadLink")+' {title}" alt="Download">&nbsp;</a>',"</tpl>","<tpl if=\"values.type == 'text/html'\">",'<a href="{href}" class="md-mn md-mn-www" title="'+OpenLayers.i18n("webLink")+' {title}" alt="Web link" target="_blank">&nbsp;</a>',"</tpl>","</tpl>",'<tpl if="this.hasDownloadLinks(values.links)">','<a href="#" onclick="catalogue.metadataPrepareDownload({id});" class="md-mn downloadAllIcon" title="'+OpenLayers.i18n("prepareDownload")+'" alt="download">&nbsp;</a>',"</tpl>","</div>",'</td><td class="thumb">',GeoNetwork.Templates.RATING_TPL,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="{thumbnail}"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>",'</td><td class="icon">','<div class="md-mn valid-{valid}" title="'+OpenLayers.i18n("validityInfo"),'<tpl for="valid_details">',"{values.type}: ","<tpl if=\"values.valid == '1'\">"+OpenLayers.i18n("valid")+"</tpl>","<tpl if=\"values.valid == '0'\">"+OpenLayers.i18n("notValid")+"</tpl>","<tpl if=\"values.valid == '-1'\">"+OpenLayers.i18n("notDetermined")+"</tpl>","<tpl if=\"values.ratio != ''\"> ({values.ratio}) </tpl> - ","</tpl>",'">&nbsp;</div>','</td><td class="icon" title="'+OpenLayers.i18n("metadataCategories")+'">','<tpl for="category">','<div class="md-mn cat-{value}" title="{value}">&nbsp;</div>',"</tpl>","</td></tr></table>",'<div class="relation" title="'+OpenLayers.i18n("relateddatasets")+'"><span></span><ul id="md-relation-{id}"></ul></div>','<div class="md-contact">','<tpl for="contact">',"<tpl if=\"applies=='resource'\">",'<span title="{role} - {applies}"><tpl if="values.logo !== undefined && values.logo !== \'\'">','<img src="{logo}" class="orgLogo"/>',"</tpl>","{name}&nbsp;&nbsp;</span>","</tpl>","</tpl>","<tpl if=\"edit=='true' && isharvested!='y'\">",'<br/><span class="md-mn md-mn-user" title="'+OpenLayers.i18n("ownerName")+'">{ownername} - '+OpenLayers.i18n("lastUpdate")+"{[values.changedate.split('T')[0]]}</span>","</tpl>","</div>","</li>","</tpl>","</ul>",{hasDownloadLinks:function(e){var d;
for(d=0;d<e.length;d++){if(e[d].type==="application/x-compressed"){return true;}}return false;}});GeoNetwork.Templates.Relation={SHORT:['<li class="{type}">','<a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');return false;" title="{abstract}">{title}</a>',"</li>"]};Ext.namespace("GeoNetwork.view");GeoNetwork.view.ViewWindow=Ext.extend(Ext.Window,{defaultConfig:{layout:"fit",width:700,height:740,border:false,lang:"en",autoScroll:true,closeAction:"destroy",currTab:"simple",displayTooltip:true,printDefaultForTabs:false,printMode:undefined,relationTypes:"service|children|related|parent|dataset|fcat",maximizable:true,maximized:false,collapsible:true,collapsed:false},serviceUrl:undefined,catalogue:undefined,metadataUuid:undefined,record:undefined,resultsView:undefined,actionMenu:undefined,tipTpl:undefined,metadataSchema:undefined,cache:{},tooltips:[],relatedTpl:undefined,getLinkedData:function(){var d=new GeoNetwork.data.MetadataRelationStore(this.catalogue.services.mdRelation+"?type="+this.relationTypes+"&fast=false&uuid="+escape(this.metadataUuid),null,true),e=this;d.load();d.on("load",function(){this.each(e.displayLinkedData,e);});},displayLinkedData:function(j){var l=Ext.query("table.related",this.body.dom),o=j.get("type");var q=Ext.get(l[0]);var h=q.child("tr td[class*="+o+"]");var m=this.relatedTpl.apply(j.data);if(h!==null){h.next().child("li").insertHtml("afterEnd",m);}else{q.child("tr").insertHtml("beforeBegin",'<tr><td class="main '+o+'"><span class="cat-'+o+' icon">'+OpenLayers.i18n("related"+o)+"</span></td><td><ul>"+m+"</ul></td></tr>");}},createActionMenu:function(){if(!this.actionMenu){this.actionMenu=new GeoNetwork.MetadataMenu({catalogue:this.catalogue,record:this.record,resultsView:this.resultsView});}var b={text:OpenLayers.i18n("mdMenu"),menu:this.actionMenu};return b;},createViewMenu:function(g){var f=['<b class="menu-title">'+OpenLayers.i18n("chooseAView")+"</b>"];this.viewMenu=new Ext.menu.Menu({items:f});var e={text:OpenLayers.i18n("viewMode"),iconCls:"viewModeIcon",menu:this.viewMenu};return e;},updateViewMenu:function(){var C=Ext.query("span.mode",this.body.dom),D=[],z,B,j,v=this.getId(),F=true;D.push([OpenLayers.i18n("simpleViewMode"),"view-simple",F]);Ext.ux.Lightbox.register("a[rel^=lightbox-viewset]",true);this.printMode=this.currTab;for(z=0;z<C.length;z++){if(C[z].firstChild){var E=C[z].getAttribute("id");var H=C[z].innerHTML;var w=Ext.get(C[z]).next();var e=w.query("LI");var u=w.query("LI[id="+this.currTab+"]");var G=u.length===1;if(!G){Ext.get(C[z]).parent().remove();}else{if(w&&e.length===1){w.remove();}else{for(B=0;B<e.length;B++){j=Ext.get(e[B]);if(this.printDefaultForTabs){this.printMode="default";}j.on("click",function(){Ext.getCmp(v).switchToTab(this);},j.getAttribute("id"));}}}D.push([H,E,G]);if(G===true){F=false;}}}D[0][2]=F;this.updateToolbar(D);},updateToolbar:function(g){var e,f;this.viewMenu.removeAll();for(e=0;e<g.length;e++){f=g[e];this.viewMenu.add({text:f[0],checked:false,disabled:f[2],group:"mode",value:f[1],listeners:{checkchange:this.onViewCheck,scope:this}});}this.viewMenu.doLayout();},switchToTab:function(b){this.currTab=b;this.onViewCheck({value:this.currTab},true);},onViewCheck:function(d,e){if(e){this.currTab=d.value;this.load({url:this.serviceUrl+"&currTab="+this.currTab,callback:this.afterMetadataLoad,scope:this});}},afterMetadataLoad:function(){this.cache={};this.tooltips=[];this.updateViewMenu();this.catalogue.extentMap.initMapDiv();if(this.currTab==="view-simple"||this.currTab==="inspire"||this.currTab==="simple"){this.getLinkedData();}this.registerTooltip();},createPrintMenu:function(){return new Ext.Button({iconCls:"print",tooltip:OpenLayers.i18n("printTT"),listeners:{click:function(d,e){window.open("print.html?uuid="+this.metadataUuid+"&currTab="+this.printMode+"&hl="+this.lang);},scope:this}});},createTooltipMenu:function(){return new Ext.Button({enableToggle:true,pressed:this.displayTooltip,iconCls:"book",tooltip:OpenLayers.i18n("enableTooltip"),listeners:{toggle:function(d,e){this.displayTooltip=e;this.enableTooltip();},scope:this}});},enableTooltip:function(){Ext.each(this.tooltips,function(d,e){if(this.displayTooltip){d.enable();}else{d.disable();}},this);},registerTooltip:function(){var b=Ext.query("th[id]",this.body.dom);b=b.concat(Ext.query("legend[id]",this.body.dom));Ext.each(b,function(r,e,s){var f=Ext.get(r);var a=f.getAttribute("id");if(f.is("TH")){var o=f.up("FIELDSET");var q=function(){if(this.displayTooltip){this.loadHelp(a,o);}};f.parent().on("mouseover",q,this);}else{var q=function(){if(this.displayTooltip){this.loadHelp(a);}};f.on("mouseover",q,this);}},this);},loadHelp:function(g,e){if(!this.cache[g]){var f=this;GeoNetwork.util.HelpTools.get(g,this.metadataSchema,this.catalogue.services.schemaInfo,function(a){f.cache[g]=f.tipTpl.apply(a.records[0].data);var b=new Ext.ToolTip({target:g,title:a.records[0].get("label"),anchor:e?"top":"bottom",anchorOffset:35,html:f.cache[g]});f.tooltips.push(b);});}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.tipTpl=new Ext.XTemplate(GeoNetwork.util.HelpTools.Templates.SIMPLE);this.relatedTpl=new Ext.XTemplate(this.relatedTpl||GeoNetwork.Templates.Relation.SHORT);this.tools=[{id:"newwindow",qtip:OpenLayers.i18n("newWindow"),handler:function(h,j,e,g){window.open(GeoNetwork.Util.getBaseUrl(location.href)+"#uuid="+this.metadataUuid);this.hide();},scope:this}];this.tbar=[this.createViewMenu(),this.createActionMenu(),"->",this.createPrintMenu(),this.createTooltipMenu()];GeoNetwork.view.ViewWindow.superclass.initComponent.call(this);this.metadataSchema=this.record?this.record.get("schema"):"";this.setTitle(this.record?this.record.get("title"):"");this.add(new Ext.Panel({autoLoad:{url:this.serviceUrl+"&currTab="+this.currTab,callback:this.afterMetadataLoad,scope:this},border:false,frame:false,autoScroll:true}));this.on("beforeshow",function(b){b.setSize(b.getWidth()>Ext.getBody().getWidth()?Ext.getBody().getWidth():b.getWidth(),b.getHeight()>Ext.getBody().getHeight()?Ext.getBody().getHeight():b.getHeight());});}});Ext.reg("gn_view_viewwindow",GeoNetwork.view.ViewWindow);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.SubTemplateSelectionPanel=Ext.extend(Ext.FormPanel,{border:false,catalogue:undefined,namespaces:{xlink:"http://www.w3.org/1999/xlink",gmd:"http://www.isotc211.org/2005/gmd",gmx:"http://www.isotc211.org/2005/gmx",gco:"http://www.isotc211.org/2005/gco",gts:"http://www.isotc211.org/2005/gts",gml:"http://www.opengis.net/gml"},id:"subTemplateSearchForm",contact:Ext.data.Record.create([{name:"xlink"},{name:"name"}]),subTemplateStore:undefined,codeListStore:undefined,subTplTypeField:undefined,addAsXLink:false,itemSelector:null,loadingMask:null,subTemplateCount:null,ref:null,name:null,elementName:null,codeListConfig:{"gmd:CI_ResponsibleParty":{xpath:"gmd:role/gmd:CI_RoleCode/@codeListValue",url:"",label:OpenLayers.i18n("contactRole"),code:"gmd:CI_RoleCode"}},codeListCombo:null,role:"",defaultRole:"pointOfContact",SubTemplateSelected:[],initComponent:function(){this.subTemplateStore=GeoNetwork.data.MetadataResultsStore();this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getSearchField()],items:[this.getSubTemplateItemSelector()]}];this.subTemplateStore.on({loadexception:function(){},beforeload:function(e,d){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();},load:function(){this.loadingMask.hide();},scope:this});this.addEvents("subTemplateSelected");this.bbar=["->",{id:"addAsXLinkCheckBox",xtype:"checkbox",checked:false,boxLabel:OpenLayers.i18n("addAsXLink"),listeners:{check:function(d,e){this.addAsXLink=e;},scope:this}},this.getCodeListCombo()," ",{id:"SubTemplateSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildSubTemplateXmlList();},scope:this}];GeoNetwork.editor.SubTemplateSelectionPanel.superclass.initComponent.call(this);
},getSearchField:function(){this.subTplTypeField=new Ext.form.TextField({name:"E__root",hidden:true,value:""});return[new GeoNetwork.form.SearchField({name:"E_any",store:this.catalogue.metadataStore,triggerAction:function(b){b.doSearch();},scope:this}),this.subTplTypeField,{xtype:"textfield",name:"E__isTemplate",hidden:true,value:"s"}];},setRef:function(b){this.ref=b;},setName:function(b){this.name=b;},setElementName:function(b){this.elementName=b;this.subTplTypeField.setValue(b);if(this.codeListConfig[b]){this.codeListCombo.setVisible(true);}else{this.codeListCombo.setVisible(false);}},setAddAsXLink:function(b){this.addAsXLink=b||false;Ext.getCmp("addAsXLinkCheckBox").setValue(this.addAsXLink);},getCodeListCombo:function(){this.codeListStore=GeoNetwork.data.CodeListStore({url:this.catalogue.services.schemaInfo,codeListName:"gmd:CI_RoleCode"});this.codeListCombo=new Ext.form.ComboBox({id:"codeList",store:this.codeListStore,triggerAction:"all",mode:"local",fieldLabel:"",displayField:"label",valueField:"code"});this.codeListStore.on({load:function(){Ext.getCmp("codeList").setValue(this.defaultRole);},scope:this});return this.codeListCombo;},getSubTemplateItemSelector:function(){var b='<tpl for="."><div class="ux-mselect-item';if(Ext.isIE||Ext.isIE7){b+='" unselectable=on';}else{b+=' x-unselectable"';}b+=">{title}</div></tpl>";this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["uuid","title"],toData:[],msWidth:320,msHeight:230,valueField:"uuid",fromTpl:b,toTpl:b,toLegend:OpenLayers.i18n("selected"),fromLegend:OpenLayers.i18n("found"),fromStore:this.subTemplateStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var a=this.getForm().findField("itemselector");a.reset.call(a);},scope:this}]});this.itemSelector.on({change:function(a){Ext.getCmp("SubTemplateSearchValidateButton").setDisabled(a.toStore.getCount()<1);}});return this.itemSelector;},buildSubTemplateXmlList:function(){if(!this.elementName){alert("Error: sub template root element name is not defined!");return;}var h="";var j="~";var f=this.itemSelector.toMultiselect.store;this.SubTemplateSelected=[];this.codeListValue="";this.subTemplateCount=0;if(this.codeListConfig[this.elementName]&&this.codeListConfig[this.elementName].xpath){h="&process="+this.codeListConfig[this.elementName].xpath+j+Ext.getCmp("codeList").getValue();}var g=this;xlinkCollection=f.collect("uuid");Ext.each(xlinkCollection,function(a,d,b){var m=g.catalogue.services.subTemplate+"?uuid="+a+h;++g.subTemplateCount;if(g.addAsXLink){var e="<"+g.name+g.generateNamespaceDeclaration()+" xlink:href='"+m+"'/>";g.SubTemplateSelected.push(e);}else{g.retrieveSubTemplate(m);}});if(this.addAsXLink){this.fireEvent("subTemplateSelected",this,this.SubTemplateSelected);this.ownerCt.hide();}f.clearFilter();},retrieveSubTemplate:function(b){Ext.getCmp("SubTemplateSearchValidateButton").disable();Ext.Ajax.request({url:b,method:"GET",scope:this,success:function(a){var e=a.responseText;if(e.indexOf(this.elementName)!==-1){this.SubTemplateSelected.push("<"+this.name+this.generateNamespaceDeclaration()+">"+a.responseText+"</"+this.name+">");}Ext.getCmp("SubTemplateSearchValidateButton").enable();this.subTemplateCount-=1;if(this.subTemplateCount===0){this.fireEvent("subTemplateSelected",this,this.SubTemplateSelected);this.ownerCt.hide();}}});},generateNamespaceDeclaration:function(f){var e="";for(var g in this.namespaces){if((f&&f[g])||!f){e+=" xmlns:"+g+'="'+this.namespaces[g]+'"';}}return e;},doSearch:function(){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();GeoNetwork.util.SearchTools.doQueryFromForm(this.id,this.catalogue,1,this.showResults.bind(this),null,false,this.subTemplateStore);},showResults:function(f){var h=new OpenLayers.Format.GeoNetworkRecords();var j=h.read(f.responseText);var g=j.records;if(g.length>0){this.subTemplateStore.loadData(j);}}});Ext.reg("gn_editor_subtemplateselectionpanel",GeoNetwork.editor.SubTemplateSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.CRSSelectionPanel=Ext.extend(Ext.FormPanel,{CRS:Ext.data.Record.create([{name:"authority"},{name:"code"},{name:"version"},{name:"codeSpace"},{name:"description"}]),crsStore:undefined,catalogue:undefined,border:false,first:null,itemSelector:null,loadingMask:null,crsCount:null,ref:null,crsSelected:"",initComponent:function(){this.crsStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchCRS,method:"GET"}),baseParams:{name:"",type:"",maxResults:50},reader:new Ext.data.XmlReader({record:"crs",id:"code"},this.CRS),fields:["code","codeSpace","authority","description","version"],sortInfo:{field:"description"}});this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getCRSTypeCombo()," ",this.getCRS(),"->",OpenLayers.i18n("maxResults"),this.getLimitInput()],items:[this.getCRSItemSelector()]}];this.crsStore.on({loadexception:function(){},beforeload:function(e,d){if(Ext.getCmp("maxResults")){e.baseParams.maxResults=Ext.getCmp("maxResults").getValue();}if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();},load:function(){this.loadingMask.hide();},scope:this});this.addEvents("crsSelected");this.bbar=["->",{id:"crsSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildCRSXmlList();},scope:this}];GeoNetwork.editor.CRSSelectionPanel.superclass.initComponent.call(this);},getCRS:function(){return new GeoNetwork.form.SearchField({id:"crsSearchField",width:240,store:this.crsStore,paramName:"name"});},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:50,width:40};},getCRSTypeCombo:function(){var g=Ext.data.Record.create([{name:"id"}]);var e=new Ext.data.Store({url:this.catalogue.services.getCRSTypes,reader:new Ext.data.XmlReader({record:"type"},g),fields:["id"]});var f=new g({filename:OpenLayers.i18n("any")});f.set("id","");e.add(f);e.load({add:true});return{xtype:"combo",width:150,id:"search-crs",value:0,store:e,triggerAction:"all",mode:"local",displayField:"id",valueField:"id",listWidth:250,listeners:{select:function(a,j,d){this.crsStore.removeAll();this.crsStore.baseParams.type=a.getValue();var b=Ext.getCmp("crsSearchField").getValue();if(b.length<1){this.crsStore.baseParams.name="";}else{this.crsStore.baseParams.name=b;}this.crsStore.reload();},clear:function(a){this.crsStore.load();},scope:this}};},getCRSItemSelector:function(){var b='<tpl for="."><div class="ux-mselect-item';if(Ext.isIE||Ext.isIE7){b+='" unselectable=on';}else{b+=' x-unselectable"';}b+=">{description}</div></tpl>";this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["code","codeSpace","authority","description","version"],toData:[],msWidth:320,msHeight:230,valueField:"code",fromTpl:b,toTpl:b,toLegend:OpenLayers.i18n("selectedCRS"),fromLegend:OpenLayers.i18n("foundCRS"),fromStore:this.crsStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var a=this.getForm().findField("itemselector");a.reset.call(a);},scope:this}]});this.itemSelector.on({change:function(a){Ext.getCmp("crsSearchValidateButton").setDisabled(a.toStore.getCount()<1);}});return this.itemSelector;},setRef:function(b){this.ref=b;},buildCRSXmlList:function(){this.crsSelected="";var b=this.itemSelector.toMultiselect.store;this.first=true;b.each(function(a){var e="<gmd:referenceSystemInfo xmlns:gmd='http://www.isotc211.org/2005/gmd'  xmlns:gco='http://www.isotc211.org/2005/gco'><gmd:MD_ReferenceSystem><gmd:referenceSystemIdentifier><gmd:RS_Identifier><gmd:code><gco:CharacterString>"+a.data.description+"</gco:CharacterString></gmd:code><gmd:codeSpace><gco:CharacterString>"+a.data.codeSpace+"</gco:CharacterString></gmd:codeSpace><gmd:version><gco:CharacterString>"+a.data.version+"</gco:CharacterString></gmd:version></gmd:RS_Identifier></gmd:referenceSystemIdentifier></gmd:MD_ReferenceSystem></gmd:referenceSystemInfo>";
this.crsSelected+=(this.first?"":"&amp;&amp;&amp;")+e;this.first=false;},this);if(this.crsSelected!==""){this.fireEvent("crsSelected",this.crsSelected);this.ownerCt.hide();}}});Ext.reg("gn_editor_crsselectionpanel",GeoNetwork.editor.CRSSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.EditorPanel=Ext.extend(Ext.Panel,{border:false,editUrl:undefined,updateUrl:undefined,frame:false,editorToolBar:undefined,tbarConfig:undefined,id:"editorPanel",defaultConfig:{defaultViewMode:"simple",layout:"border",height:800,xlinkOptions:{},utilityPanelCollapsed:false,utilityPanelConfig:{thumbnailPanel:{collapsed:false},relationPanel:{collapsed:true},validationPanel:{collapsed:true},suggestionPanel:{collapsed:true},helpPanel:{collapsed:false}}},catalogue:undefined,toolbar:undefined,validationPanel:undefined,relationPanel:undefined,helpPanel:undefined,suggestionPanel:undefined,thumbnailPanel:undefined,editorMainPanel:undefined,metadataId:undefined,versionId:undefined,metadataMode:undefined,metadataSchema:undefined,metadataType:undefined,position:undefined,relatedMetadataStore:undefined,keywordSelectionWindow:undefined,contactSelectionWindow:undefined,subTemplateSelectionWindow:undefined,crsSelectionWindow:undefined,logoSelectionWindow:undefined,linkedMetadataSelectionWindow:undefined,geoPublisherWindow:undefined,lang:undefined,fileUploadWindow:undefined,mask:undefined,managerInitialized:false,container:undefined,setContainer:function(b){if(!this.container){this.container=b;}},showLogoSelectionPanel:function(e){if(!this.logoSelectionWindow){var d=new GeoNetwork.editor.LogoSelectionPanel({ref:e,serviceUrl:this.catalogue.services.getIcons,logoAddUrl:this.catalogue.services.logoAdd,logoUrl:this.catalogue.services.harvesterLogoUrl,listeners:{logoselected:function(a,g){var b=a.store.getAt(g);Ext.getDom(a.ref).value=a.logoUrl+b.get("name");}}});this.logoSelectionWindow=new Ext.Window({title:OpenLayers.i18n("logoSelectionWindow"),width:300,height:300,layout:"fit",modal:true,items:d,closeAction:"hide",constrain:true,iconCls:"attached"});}this.logoSelectionWindow.items.get(0).setRef(e);this.logoSelectionWindow.show();},showFileUploadPanel:function(h,j){var g=this;if(this.fileUploadWindow){this.fileUploadWindow.close();this.fileUploadWindow=undefined;}if(!this.fileUploadWindow){var f=new Ext.form.FormPanel({fileUpload:true,defaultType:"textfield",items:[{name:"id",allowBlank:false,hidden:true,value:this.metadataId},{name:"access",allowBlank:false,hidden:true,value:"private"},{name:"ref",allowBlank:false,hidden:true,value:j},{name:"proto",hidden:true,value:""},{name:"overwrite",fieldLabel:"Overwrite",checked:true,xtype:"checkbox"},{xtype:"fileuploadfield",emptyText:OpenLayers.i18n("selectFile"),fieldLabel:"File",allowBlank:false,name:"f_"+j,buttonText:"",buttonCfg:{iconCls:"uploadIconAdd"}}],buttons:[{text:OpenLayers.i18n("upload"),iconCls:"attachedAdd",handler:function(){if(f.getForm().isValid()){f.getForm().submit({url:g.catalogue.services.upload,waitMsg:OpenLayers.i18n("uploading"),success:function(e,b){var a=b.result.fname;var d=Ext.getDom("_"+j);if(d){d.value=a;}g.save();g.fileUploadWindow.hide();}});}}},{text:OpenLayers.i18n("reset"),handler:function(){f.getForm().reset();}}]});this.fileUploadWindow=new Ext.Window({title:OpenLayers.i18n("fileUploadWindow"),width:300,height:300,layout:"fit",modal:true,items:f,closeAction:"hide",constrain:true,iconCls:"attached"});}this.fileUploadWindow.show();},showGeoPublisherPanel:function(w,B,q,z,t,r,u,o){var v=this;if(this.geoPublisherWindow){this.geoPublisherWindow.close();this.geoPublisherWindow=undefined;}if(!this.geoPublisherWindow){var s=new GeoNetwork.editor.GeoPublisherPanel({width:650,height:300,layers:GeoNetwork.map.BACKGROUND_LAYERS,extent:o,serviceUrl:this.catalogue.services.geopublisher,listeners:{addOnLineSource:function(j,d,e){var b;var g="";var h=(d.get("id").indexOf("mapserver")===-1?d.get("namespacePrefix")+":":"")+this.layerName;var a="_X"+u+"_"+r.replace(":","COLON");var f="<gmd:onLine xmlns:gmd=&quot;http://www.isotc211.org/2005/gmd&quot; xmlns:gco=&quot;http://www.isotc211.org/2005/gco&quot;><gmd:CI_OnlineResource><gmd:linkage><gmd:URL>${ogcurl}</gmd:URL></gmd:linkage><gmd:protocol><gco:CharacterString>${protocol}</gco:CharacterString></gmd:protocol><gmd:name><gco:CharacterString>${layerName}</gco:CharacterString></gmd:name><gmd:description><gco:CharacterString>${metadataTitle}</gco:CharacterString></gmd:description></gmd:CI_OnlineResource></gmd:onLine>";for(b in e){if(e.hasOwnProperty(b)&&e[b].checked===true){g+=OpenLayers.String.format(f,{ogcurl:d.get(b+"Url"),protocol:e[b].label,layerName:h,metadataTitle:this.metadataTitle+"("+e[b].label+")"})+"&&&";}}GeoNetwork.editor.EditorTools.addHiddenFormField(a,g);v.save();v.geoPublisherWindow.hide();}}});this.geoPublisherWindow=new Ext.Window({title:OpenLayers.i18n("geoPublisherWindowTitle"),layout:"fit",modal:true,items:s,closeAction:"hide",constrain:true,iconCls:"repository"});}this.geoPublisherWindow.items.get(0).setRef(w,B,q,z,t);this.geoPublisherWindow.setTitle(OpenLayers.i18n("geoPublisherWindowTitle")+" "+z);this.geoPublisherWindow.show();},showSubTemplateSelectionPanel:function(l,g,h){var m=this;if(this.subTemplateSelectionWindow){this.subTemplateSelectionWindow.close();this.subTemplateSelectionWindow=undefined;}if(!this.subTemplateSelectionWindow){var j=new GeoNetwork.editor.SubTemplateSelectionPanel({width:620,height:300,catalogue:this.catalogue,listeners:{subTemplateSelected:function(a,b){GeoNetwork.editor.EditorTools.addHiddenFormFieldForFragment(a,b,m);}}});this.subTemplateSelectionWindow=new Ext.Window({title:OpenLayers.i18n("SelectionWindowTitle"),layout:"fit",items:j,closeAction:"hide",constrain:true,iconCls:"searchIcon"});}this.subTemplateSelectionWindow.items.get(0).setRef(l);this.subTemplateSelectionWindow.items.get(0).setName(g);this.subTemplateSelectionWindow.items.get(0).setElementName(h);this.subTemplateSelectionWindow.items.get(0).setAddAsXLink(this.xlinkOptions.CONTACT);this.subTemplateSelectionWindow.show();},showKeywordSelectionPanel:function(d){var e=this;if(this.keywordSelectionWindow){this.keywordSelectionWindow.close();this.keywordSelectionWindow=undefined;}if(!this.keywordSelectionWindow){this.keywordSelectionPanel=new GeoNetwork.editor.KeywordSelectionPanel({catalogue:this.catalogue,listeners:{keywordselected:function(b,a){GeoNetwork.editor.EditorTools.addHiddenFormFieldForFragment(b,a,e);}}});this.keywordSelectionWindow=new Ext.Window({title:OpenLayers.i18n("keywordSelectionWindowTitle"),width:620,height:300,layout:"fit",modal:true,items:this.keywordSelectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"});}this.keywordSelectionWindow.items.get(0).setRef(d);this.keywordSelectionWindow.items.get(0).setAddAsXLink(this.xlinkOptions.KEYWORD);this.keywordSelectionWindow.show();},showCRSSelectionPanel:function(g,f){var e=this;if(!this.crsSelectionWindow){this.crsSelectionPanel=new GeoNetwork.editor.CRSSelectionPanel({catalogue:this.catalogue,listeners:{crsSelected:function(b){var a="_X"+g+"_"+f.replace(":","COLON");GeoNetwork.editor.EditorTools.addHiddenFormField(a,b);e.save();}}});this.crsSelectionWindow=new Ext.Window({title:OpenLayers.i18n("crsSelectionWindowTitle"),layout:"fit",width:620,height:300,modal:true,items:this.crsSelectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"});}this.crsSelectionWindow.items.get(0).setRef(g);this.crsSelectionWindow.show();},showLinkedMetadataSelectionPanel:function(m,h,l){var l=l||h;var j=((l==="uuidref"||l==="iso19110"||l==="")?true:false);var g=this;this.linkedMetadataSelectionPanel=new GeoNetwork.editor.LinkedMetadataSelectionPanel({ref:m,catalogue:this.catalogue,singleSelect:j,mode:l,listeners:{linkedmetadataselected:function(e,b){if(j){if(this.ref!==null){Ext.get("_"+this.ref+(h!==""?"_"+h:"")).dom.value=b[0].data.uuid;}else{if(this.mode==="iso19110"){var d=e.catalogue.services.mdRelationInsert+"?parentId="+document.mainForm.id.value+"&childUuid="+b[0].data.uuid;
var a=Ext.Ajax.request({url:d,method:"GET",success:function(u,o){var q=e.catalogue.services.mdProcessing+"?uuidref="+b[0].data.uuid+"&id="+document.mainForm.id.value+"&process=update-attachFeatureCatalogue";g.process(q);},failure:function(q,o){Ext.MessageBox.alert(OpenLayers.String.format(OpenLayers.i18n("errorAndStatusMsg"),{status:q.status,text:q.statusText}));setBunload(true);}});}}}else{var f=[];var r=b.length>1?true:false;Ext.each(b,function(o,q){if(r){h=h+"_"+q;}f.push({tag:"input",type:"hidden",id:h,name:h,value:o.data.uuid});});var s=Ext.DomHelper;s.append(Ext.get("hiddenFormElements"),f);}}}});this.linkedMetadataSelectionWindow=new Ext.Window({title:OpenLayers.i18n("linkedMetadataSelectionWindowTitle"),width:620,height:300,layout:"fit",items:this.linkedMetadataSelectionPanel,closeAction:"hide",constrain:true,iconCls:"linkIcon",modal:true});this.linkedMetadataSelectionWindow.show();},showLinkedServiceMetadataSelectionPanel:function(g,j,l){var m=this;j=Ext.getDom("serviceUrl")&&Ext.getDom("serviceUrl").value;var h=new GeoNetwork.editor.LinkedMetadataSelectionPanel({mode:g,autoWidth:true,ref:null,serviceUrl:j,catalogue:this.catalogue,region:"north",uuid:l,singleSelect:true,listeners:{linkedmetadataselected:function(d,a){var b=Ext.getCmp("getCapabilitiesLayerName").getValue();if(g==="attachService"){var e=m.catalogue.services.mdProcessingXml+"?uuid="+a[0].data.uuid+"&process=update-srv-attachDataset&uuidref="+document.mainForm.uuid.value+"&scopedName="+b;Ext.Ajax.request({url:e,method:"GET",success:function(v,t){var u=v.responseText;if(u.indexOf("Not owner")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("NotOwnerError"));}else{if(u.indexOf("error")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("error")+u);}}var w=m.catalogue.services.mdProcessing+"?id="+m.metadataId+"&process=update-onlineSrc&desc="+b+"&url="+escape(a[0].data.uri)+"&scopedName="+b;Ext.Ajax.request({url:w,method:"GET",success:function(q,o){m.updateEditor(q);},failure:function(q,o){Ext.MessageBox.alert(OpenLayers.i18n("datasetUpdateError"));setBunload(true);}});},failure:function(s,r){Ext.MessageBox.alert(OpenLayers.i18n("ServiceUpdateError"));setBunload(true);}});}else{var f=m.catalogue.services.mdProcessingXml+"?uuid="+a[0].data.uuid+"&process=update-onlineSrc&desc="+b+"&url="+j+"&scopedName="+b;Ext.Ajax.request({url:f,method:"GET",success:function(u,s){var t=u.responseText;if(t.indexOf("Not owner")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("NotOwnerError"));}else{if(t.indexOf("error")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("error")+t);}}m.process(m.catalogue.services.mdProcessing+"?uuid="+document.mainForm.uuid.value+"&process=update-srv-attachDataset&uuidref="+a[0].data.uuid+"&scopedName="+b);},failure:function(s,r){Ext.MessageBox.alert(OpenLayers.i18n("ServiceUpdateError"));setBunload(true);}});}},scope:this}});this.linkedMetadataSelectionWindow=new Ext.Window({title:(g==="attachService"?OpenLayers.i18n("associateService"):OpenLayers.i18n("associateDataset")),layout:"fit",width:620,height:400,items:h,closeAction:"hide",constrain:true,iconCls:"linkIcon",modal:true});this.linkedMetadataSelectionWindow.show();},switchToTab:function(b){Ext.getDom("currTab").value=b;this.save();},finish:function(){this.loadUrl("metadata.update.finish",undefined,this.closeCallback);},save:function(){this.loadUrl("metadata.update.new",undefined,this.loadCallback);},callAction:function(b){this.loadUrl(b,undefined,this.loadCallback);},validate:function(){this.loadUrl("metadata.update.new","validate",this.loadCallback);this.validationPanel.expand(true);},reset:function(){this.loadUrl("metadata.update.forget.new",undefined,this.loadCallback);},cancel:function(){this.loadUrl("metadata.update.forgetandfinish",undefined,this.closeCallback);},process:function(b){this.loadUrl(b,undefined,this.loadCallback,true);},init:function(l,q,o,m,h){var j;this.metadataId=l;if(q){j=this.createUrl+"?id="+this.metadataId+"&group="+o;if(m){j+="&child=y";}if(h){j+="&isTemplate="+h;}}else{j=this.editUrl+"?id="+this.metadataId;}j+="&currTab="+(document.mainForm?document.mainForm.currTab.value:this.defaultViewMode);this.loadUrl(j,undefined,this.loadCallback);if(this.disabled){this.setDisabled(false);}this.container.show();this.ownerCt.show();},loadUrl:function(l,j,h,g){if(document.mainForm){if(typeof j!=="undefined"){document.mainForm.showvalidationerrors.value="true";}else{document.mainForm.showvalidationerrors.value="false";}}var m=this.editorMainPanel.getUpdater();m.update({url:(l.indexOf("/")!==-1?l:this.catalogue.services.rootUrl+l),params:!g&&document.mainForm&&Ext.fly("editForm")!==null?Ext.Ajax.serializeForm("editForm"):undefined,callback:h,scope:this,loadScripts:true,text:OpenLayers.i18n(l)+" ("+l+")"});},closeCallback:function(){this.onEditorClosed();this.ownerCt.hide();},loadCallback:function(j,h,g,f){if(!this.managerInitialized){this.initManager();}if(h){this.metadataLoaded();}else{this.getError(g);}},getError:function(s){if(s&&s.responseText){var m=s.responseText,l,j,r,o,q;j=m.match(/<h2 class=\"error\"\>(.*)<\/h2\>/);l=j||m.match(/<div id=\"error\"\>\n[ ]*<h2>(.*)<\/h2\>/);r=m.match(/<\/h2\>\n[ ]*<p\><\/p\>(.*)/);if(!r){o=m.match(/<p id=\"error\">(.*)<\/p\>/);q=m.match(/<p id=\"stacktrace\">(.*)<\/p\>/);r=o[1]+q[1];}else{r=r[1];}if(l){Ext.Msg.alert(l[1],(r?r:""),function(){this.ownerCt.hide();},this);}}},updateEditor:function(b){this.editorMainPanel.update(b,false,this.metadataLoaded.bind(this));},metadataLoaded:function(){this.metadataSchema=document.mainForm.schema.value;this.metadataType=Ext.getDom("template");this.metadataId=document.mainForm.id.value;this.versionId=document.mainForm.version.value;this.toolbar.setIsMinor(document.mainForm.minor.value);this.toolbar.setIsTemplate(this.metadataType.value);if(this.disabled){this.setDisabled(false);}this.onMetadataUpdated();this.initCalendar();this.validateMetadataFields();this.catalogue.extentMap.initMapDiv();var b=Ext.query("th[id]",this.body.dom);b=b.concat(Ext.query("legend[id]",this.body.dom));Ext.each(b,function(o,a,q){var l=Ext.get(o);var e=l.getAttribute("id");if(l.is("TH")){var m=l.up("FIELDSET");l.parent().on("mouseover",function(){this.helpPanel.updateHelp(e,m);},this);}else{l.on("mouseover",function(){this.helpPanel.updateHelp(e);},this);}},this);this.updateViewMenu();},validateMetadataField:function(f){var e=f.getAttribute("onchange");var g=f.getAttribute("onkeyup");if(typeof e==="function"){e=e.toString();}if(typeof g==="function"){g=g.toString();}if(!f||(e!==null&&e.indexOf("validate")===-1)||(g!==null&&g.indexOf("validate")===-1)){return;}if(f.onkeyup){f.onkeyup();}if(f.onchange){f.onchange();}},validateMetadataFields:function(){var b=Ext.DomQuery.select("select.lang_selector");Ext.each(b,function(a){for(i=0;i<a.options.length;i+=1){if(a.options[i].getAttribute("code").toLowerCase()===this.lang){a.options[i].selected=true;}}});b=Ext.DomQuery.select("input,textarea,select");Ext.each(b,function(a){this.validateMetadataField(a);},this);},initCalendar:function(){var t=Ext.DomQuery.select("div.cal"),v;for(v=0;v<t.length;v++){var C=t[v];var B=C.id;C.id=B+"Id";if(C.firstChild===null||C.childNodes.length===1){var s="Y-m-d";var u=Ext.getDom(B+"_format",this.editorMainPanel.dom);if(u){s=u.value;}var w=Ext.getDom(B+"_cal",this.editorMainPanel.dom);var r=(w?w.value:"");var q=s.indexOf("T")===-1?false:true;if(q){var z=new Ext.ux.form.DateTime({renderTo:C.id,name:B,id:B,value:r,dateFormat:"Y-m-d",timeFormat:"H:i",hiddenFormat:"Y-m-d\\TH:i:s",dtSeparator:"T"});}else{var D=new Ext.form.DateField({renderTo:C,name:B,id:B,width:160,value:r,format:"Y-m-d"});}}}},updateViewMenu:function(){var B=Ext.query("span.mode",this.body.dom),C=[],w,z,t;for(w=0;w<B.length;w++){if(B[w].firstChild){var D=B[w].getAttribute("id");var v=Ext.get(B[w]).next();var j=B[w].innerHTML;var s=v.query("LI");var u=v.query("LI[id="+document.mainForm.currTab.value+"]");var e=u.length===1;if(!e){Ext.get(B[w]).parent().remove();}else{if(v&&s.length===1){v.remove();}else{for(z=0;z<s.length;z++){t=Ext.get(s[z]);
t.on("click",function(){Ext.getCmp("editorPanel").switchToTab(this);},t.getAttribute("id"));}}}C.push([j,D,e]);}}this.toolbar.updateViewMenu(C);},onMetadataUpdated:function(){this.fireEvent("metadataUpdated",this,this.metadataId,this.metadataSchema,this.versionId);},onEditorClosed:function(){this.fireEvent("editorClosed",this);},initManager:function(){var b=this.editorMainPanel.getUpdater();b.on("beforeupdate",function(g,a,f){this.position=this.editorMainPanel.getEl().parent().dom.scrollTop;},this);b.on("update",function(e,a){this.editorMainPanel.getEl().parent().dom.scrollTop=this.position;},this);this.managerInitialized=true;},initPanelLayout:function(){if(this.container){if(this.container.setIconClass){this.container.setIconClass("editing");}if(this.container.setTitle){if(this.metadataId){this.container.setTitle(OpenLayers.String.format(OpenLayers.i18n("editing"),{title:"",uuid:this.metadataId}));}else{}}}},initComponent:function(){var e;Ext.applyIf(this,this.defaultConfig);this.disabled=(this.metadataId?false:true);this.lang=(this.lang?this.lang:"en");this.editUrl=this.catalogue.services.mdEdit;this.createUrl=this.catalogue.services.mdCreate;this.updateUrl=this.catalogue.services.mdUpdate;GeoNetwork.editor.EditorPanel.superclass.initComponent.call(this);panel=this;this.editorMainPanel=new Ext.Panel({border:false,frame:false,id:"editorMainPanel"});var g={editor:panel};Ext.apply(g,this.tbarConfig);this.toolbar=new GeoNetwork.editor.EditorToolbar(g);var f={region:"center",split:true,autoScroll:true,tbar:this.toolbar,minHeigth:400,items:[this.editorMainPanel]};this.add(f);this.validationPanel=new GeoNetwork.editor.ValidationPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,serviceUrl:this.catalogue.services.mdValidate},this.utilityPanelConfig.validationPanel));this.helpPanel=new GeoNetwork.editor.HelpPanel(Ext.applyIf({editor:this,html:""},this.utilityPanelConfig.helpPanel));this.relationPanel=new GeoNetwork.editor.LinkedMetadataPanel(Ext.applyIf({editor:this,metadataId:this.metadataId,metadataSchema:this.metadataSchema,serviceUrl:this.catalogue.services.mdRelation},this.utilityPanelConfig.relationPanel));this.thumbnailPanel=new GeoNetwork.editor.ThumbnailPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,getThumbnail:this.catalogue.services.mdGetThumbnail,setThumbnail:this.catalogue.services.mdSetThumbnail,unsetThumbnail:this.catalogue.services.mdUnsetThumbnail},this.utilityPanelConfig.thumbnailPanel));this.suggestionPanel=new GeoNetwork.editor.SuggestionsPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,catalogue:this.catalogue},this.utilityPanelConfig.suggestionPanel));e={region:"east",split:true,collapsible:true,collapsed:this.utilityPanelCollapsed,hideCollapseTool:true,collapseMode:"mini",autoScroll:true,minWidth:280,width:280,items:[this.thumbnailPanel,this.relationPanel,this.suggestionPanel,this.validationPanel,this.helpPanel]};this.add(e);this.addEvents("metadataUpdated","editorClosed");this.on("added",function(a,d,b){if(d){this.setContainer(d);}this.initPanelLayout();},this);}});Ext.reg("gn_editor_editorpanel",GeoNetwork.editor.EditorPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.EditorToolbar=Ext.extend(Ext.Toolbar,{catalogue:undefined,editor:undefined,defaultConfig:{isTemplate:false,hideTypeMenu:false,editAttributes:false},mapOptions:undefined,layers:undefined,typeMenu:undefined,configMenu:undefined,viewMenu:undefined,saveAction:undefined,saveAndCloseAction:undefined,checkAction:undefined,resetAction:undefined,cancelAction:undefined,minorCheckbox:undefined,minorEdit:false,initComponent:function(){Ext.applyIf(this,this.defaultConfig);var b=[];if(!this.hideTypeMenu){b.push(this.createTypeMenu());b.push(["-"]);}this.saveAction=new Ext.Action({text:OpenLayers.i18n("save"),iconCls:"saveMetadata",handler:function(){this.save();},scope:this.editor});this.checkAction=new Ext.Action({text:OpenLayers.i18n("saveAndCheck"),iconCls:"validateMetadata",handler:function(){this.validationPanel.validate();},scope:this.editor});this.saveAndCloseAction=new Ext.Action({text:OpenLayers.i18n("saveAndClose"),iconCls:"quitMetadata",handler:function(){this.finish();},scope:this.editor});this.minorCheckbox=new Ext.Button({enableToggle:true,text:OpenLayers.i18n("minorEdit"),tooltip:OpenLayers.i18n("minorEditTT"),listeners:{toggle:function(e,a){document.mainForm.minor.value=this.minorEdit=a;},scope:this}});this.resetAction=new Ext.Action({text:OpenLayers.i18n("reset"),iconCls:"refreshMetadata",handler:function(){this.reset();},scope:this.editor});this.cancelAction=new Ext.Action({text:OpenLayers.i18n("cancel"),iconCls:"cancel",handler:function(){this.cancel();},scope:this.editor});b.push(this.createViewMenu(),["-"],this.saveAction,this.checkAction,this.saveAndCloseAction,this.minorCheckbox,["->"],this.resetAction,this.cancelAction,this.configMenu());GeoNetwork.editor.EditorToolbar.superclass.initComponent.call(this);this.add(b);},setIsTemplate:function(d){if(!this.hideTypeMenu){var e=d==="y";Ext.getCmp("type_y").setChecked(e);Ext.getCmp("type_n").setChecked(!e);}},setIsMinor:function(e){var d=true;if(e===""||e==="false"){d=false;}this.minorCheckbox.toggle(d);},createTypeMenu:function(){this.typeMenu={text:OpenLayers.i18n("type"),menu:{items:['<b class="menu-title">'+OpenLayers.i18n("chooseAType")+"</b>",{text:OpenLayers.i18n("md"),checked:true,value:"n",id:"type_n",group:"type",checkHandler:this.onTypeCheck},{text:OpenLayers.i18n("tpl"),checked:true,id:"type_y",group:"type",value:"y",checkHandler:this.onTypeCheck}]}};return this.typeMenu;},configMenu:function(){this.configMenu={iconCls:"configIcon",menu:{items:[{text:OpenLayers.i18n("collapseAll"),checked:false,checkHandler:function(){Ext.each(Ext.DomQuery.select("div.toggle"),function(b){if(b.onclick){b.onclick();}});}},{text:OpenLayers.i18n("editAttributes"),checked:this.editAttributes,checkHandler:function(d,e){this.editAttributes=e;this.editAttributesVisibility();},scope:this}]}};this.editor.on("metadataUpdated",function(){this.editAttributesVisibility();},this);return this.configMenu;},editAttributesVisibility:function(){Ext.each(Ext.select("div.toggle-attr"),function(b){b.setVisibilityMode(Ext.Element.DISPLAY);b.setVisible(this.editAttributes);},this);},createViewMenu:function(g){var f=['<b class="menu-title">'+OpenLayers.i18n("chooseAView")+"</b>"];this.viewMenu=new Ext.menu.Menu({items:f});var e={text:OpenLayers.i18n("viewMode"),iconCls:"viewModeIcon",menu:this.viewMenu};return e;},updateViewMenu:function(g){var e,f;this.viewMenu.removeAll();for(e=0;e<g.length;e++){f=g[e];this.viewMenu.add({text:f[0],checked:false,disabled:f[2],group:"mode",value:f[1],listeners:{checkchange:this.onViewCheck,scope:this}});}this.viewMenu.doLayout();},onViewCheck:function(d,e){if(e){this.editor.editorMainPanel.getEl().parent().scrollTo("top",0);document.mainForm.currTab.value=d.value;this.saveAction.execute();}},onTypeCheck:function(d,e){if(e){Ext.get("template").dom.value=d.value;}},onDestroy:function(){GeoNetwork.EditorToolbar.superclass.onDestroy.apply(this,arguments);}});Ext.reg("gn_editor_editortoolbar",GeoNetwork.editor.EditorToolbar);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.EditorTools={addHiddenFormFieldForFragment:function(j,l,q){var m="_X"+j.ref+"_"+j.name.replace(":","COLON");var h;var o=true;Ext.each(l,function(a,b){l[b]=a.replace('<?xml version="1.0" encoding="UTF-8"?>',"").replace(/\&/g,"&amp;amp;").replace(/\"/g,"&quot;").replace(/\r\n/g,"");if(o){h=l[b];o=false;}else{h+="&amp;&amp;&amp;"+l[b];}});GeoNetwork.editor.EditorTools.addHiddenFormField(m,h);if(q){q.save();}},addHiddenFormField:function(f,h){var g={tag:"input",type:"hidden",id:f,name:f,value:h};var j=Ext.DomHelper;j.append(Ext.get("hiddenFormElements"),g);},showNewMetadataWindow:function(q,l,m,j,h){if(q.newMetadataWindow){q.newMetadataWindow.close();q.newMetadataWindow=undefined;}if(!q.newMetadataWindow){var o=new GeoNetwork.editor.NewMetadataPanel({selectedTpl:l,isChild:j,filter:h,getGroupUrl:q.catalogue.services.getGroups,catalogue:q.catalogue});
q.newMetadataWindow=new Ext.Window({title:m===undefined?OpenLayers.i18n("newMetadata"):m,width:300,height:100,layout:"fit",modal:true,items:o,closeAction:"destroy",constrain:true,iconCls:"addIcon"});}q.newMetadataWindow.show();}};lastclick=0;Checks={message:translate("loseYourChange"),_setMessage:function(b){this.message=b;},_onbeforeunload:function(b){}};function unloadMess(){mess=translate("loseYourChange");return mess;}function doEditorAlert(e,d){$(e).style.display="block";}function setBunload(b){if(b){Checks._setMessage(unloadMess());}else{Checks._setMessage(null);}}function noDoubleClick(){var b=(new Date()).valueOf();if((b-lastclick)>500){setBunload(false);lastclick=b;return true;}else{return false;}}function doNewElementAction(s,t,l,o,r,m){var q=null;var u=false;doNewElementAjax(s,t,l,q,o,r,m,u);}function doNewORElementAction(s,t,l,o,q,r,m){var u=true;doNewElementAjax(s,t,l,o,q,r,m,u);}function doNewAttributeAction(s,t,l,o,r){var q="geonet:attribute";var m=null;var u=false;doNewElementAjax(s,t,l,q,o,r,m,u);}function doNewElementAjax(u,v,D,z,C,q,r,s){var t=document.mainForm.id.value;var w="&id="+t+"&ref="+v+"&name="+D;if(z!=null){w+="&child="+z;}var B=Ext.get(C);Ext.Ajax.request({url:catalogue.services.rootUrl+u,method:"GET",params:w,success:function(e,a){var d=e.responseText;if(z=="geonet:attribute"){Ext.getCmp("editorPanel").save();return;}if(q=="replace"){Ext.DomHelper.insertHtml("afterEnd",B.dom,d);B.remove();}else{if(q=="add"||q=="after"){var b=B.insertHtml("afterEnd",d,true);setAddControls(b,s);}else{if(q=="before"){var b=B.insertHtml("beforeBegin",d,true);setAddControls(b,s);}else{Ext.MessageBox.alert("doNewElementAjax: invalid what: "+q+" should be one of replace, after or before.");}}}Ext.getCmp("editorPanel").metadataLoaded();setBunload(true);},onFailure:function(a){Ext.MessageBox.alert(translate("errorAddElement")+D+translate("errorFromDoc")+" / status "+a.status+" text: "+a.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doRemoveElementAction(s,t,v,w,r){var q=document.mainForm.id.value;var u=Ext.get(w);var o=u.next();var m=u.prev();Ext.Ajax.request({url:catalogue.services.rootUrl+s,method:"GET",params:{id:q,ref:t,parent:v},success:function(a,b){var d=a.responseText;if(d==""){if(bottomElement(u)&&document.mainForm.currTab.value!="simple"){swapControls(u,m);u.remove();u=m;}else{u.remove();u=o;}if(topElement(u)){topControls(u,r);}}else{if(orElement(u)){u.remove();}else{Ext.DomHelper.insertHtml("afterEnd",u.dom,d);u.remove();}}setBunload(true);},failure:function(a,b){Ext.MessageBox.alert(translate("errorDeleteElement")+name+" "+translate("errorFromDoc")+" / status "+a.status+" text: "+a.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doRemoveAttributeAction(m,g,l){var j=document.mainForm.id.value;var h=Ext.get(g+"_block");Ext.Ajax.request({url:catalogue.services.rootUrl+m,method:"GET",params:{id:j,ref:g},success:function(e,a){var d=e.responseText;var b=Ext.getCmp("editorPanel");b.save();setBunload(true);},failure:function(b,a){Ext.MessageBox.alert(translate("errorDeleteAttribute")+name+" "+translate("errorFromDoc")+" / status "+b.status+" text: "+b.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function updateEditorContent(f,g){var e=Ext.getCmp("editorPanel");e.updateEditor(f.responseText);setBunload(true);}function doProcessing(d,e){d.id=document.mainForm.id.value;d.remote="true";Ext.Ajax.request({url:catalogue.services.rootUrl+"metadata.processing",method:"POST",params:d,success:function(b,a){updateEditorContent(b,a);if(e){e();}},failure:function(a){Ext.MessageBox.alert(translate("errorSaveFailed")+"/ status "+a.status+" text: "+a.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doMoveElementAction(l,m,j){var g=Ext.get(j);var h={id:document.mainForm.id.value,ref:m};Ext.Ajax.request({url:catalogue.services.rootUrl+l,method:"POST",params:h,success:function(a){if(l.indexOf("elem.up")!=-1){var d=g.prev();g.insertSibling(d,"after");swapControls(g,d);}else{var b=g.next();g.insertSibling(b,"before");swapControls(g,b);}setBunload(true);},failure:function(a){Ext.MessageBox.alert(translate("errorMoveElement")+m+" / status "+a.status+" text: "+a.statusText+" - "+translate("tryAgain"));setBunload(true);}});}function doFileRemoveAction(j,f,g,h){setBunload(false);document.mainForm.access.value=g;document.mainForm.ref.value=f;document.mainForm.action=j;Ext.getCmp("editorPanel").callAction(j);}function checkForFileUpload(v,q,w){var z=Ext.getDom("_"+v);var t=Ext.getDom("s_"+q);var u=Ext.getDom("_"+q);var s=w.startsWith("WWW:DOWNLOAD");var r=t.value;var C=(r.startsWith("WWW:DOWNLOAD")&&r.indexOf("http")>0);if(s){if(!C){alert(OpenLayers.i18n("errorChangeProtocol"));t.value=u.value;}else{u.value=t.value;}return;}var D=Ext.get("di_"+v);var B=Ext.get("db_"+v);u.value=t.value;if(C){if(D!==null){D.hide();}if(B!==null){B.show();}Ext.getCmp("editorPanel").callAction("metadata.update.new");}else{if(D!==null){D.show();}if(B!==null){B.hide();}}}function handleCheckboxAsBoolean(e,d){if(e.checked){Ext.getDom(d).value="true";}else{Ext.getDom(d).value="false";}}function swapControls(q,r){var j=getControlsFromElement(q);var l=getControlsFromElement(r);for(var s=0;s<j.length;++s){var m=j[s].isVisible();var o=l[s]?l[s].isVisible():false;if(l[s]){if(m){l[s].show();}else{l[s].hide();}}if(o){j[s].show();}else{j[s].hide();}}}function getControlsFromElement(j){if(j===null){return[];}var h=j.getAttribute("id");var g=Ext.get("buttons_"+h).query("a");for(var f=0;f<g.length;f++){g[f]=Ext.get(g[f]).setVisibilityMode(Ext.Element.DISPLAY);}return g;}function topElement(b){if(b.prev()==undefined){return true;}else{return(!isSameElement(b.prev(),b));}}function bottomElement(b){if(b.next()==undefined){return true;}else{return(!isSameElement(b.next(),b));}}function getIdSplit(e){var d=e.getAttribute("id");if(d==null){return null;}return d.split("_");}function orElement(e){if(e.next()==undefined){return false;}else{var f=getIdSplit(e.next());var g=getIdSplit(e);if(f==null||g==null){return false;}if(f[0]=="child"&&f[1]==g[0]){return true;}else{return false;}}}function isSameElement(f,g){var h=getIdSplit(f);var j=getIdSplit(g);if(h==null||j==null){return false;}if(h[0]==j[0]){return true;}else{return false;}}function topControls(j,f){var h=getControlsFromElement(j);var g=0;if(h.length==5){g=1;}if(bottomElement(j)&&!orElement(j)){h[0].show();}else{h[0].hide();}if(g==1){if(bottomElement(j)&&!orElement(j)){h[g].show();}else{h[g].hide();}}if(bottomElement(j)){if(f==0){h[1+g].show();}else{h[1+g].hide();}}else{h[1+g].show();}h[2+g].hide();if(bottomElement(j)){h[3+g].hide();}else{h[3+g].show();}}function setAddControls(m,o){elDescs=getControlsFromElement(m);var j=0;if(elDescs.length==5){j=1;}if(o){elDescs[0].hide();}else{elDescs[0].show();}if(j==1){if(o){elDescs[j].hide();}else{elDescs[j].show();}}elDescs[1+j].show();elDescs[2+j].show();if(elDescs[3+j]){elDescs[3+j].hide();}if(topElement(m)){elDescs[2+j].hide();}else{var q=m.prev();var l=getControlsFromElement(q);var h=0;if(l.length==5){h=1;}l[0].hide();if(h==1){l[h].hide();}l[1+h].show();if(topElement(q)){l[2+h].hide();}else{l[2+h].show();}var m=l[3+h];if(m){m.show();}}}function validateNumber(s,q,j){var o=s.value;var l="0123456789";if(!q){if(!validateNonEmpty(s)){return false;}}if(j){l+=".";}var r=true;var m;for(i=0;i<o.length&&r;i++){m=o.charAt(i);if(m=="-"||m=="+"){if(i<0){r=false;}}else{if(l.indexOf(m)==-1){r=false;}}}if(!r){Ext.get(s).addClass("error");return false;}else{Ext.get(s).removeClass("error");return true;}}function validateNonEmpty(b){if(b.value.length<1){Ext.get(b).addClass("error");return false;}else{Ext.get(b).removeClass("error");return true;}}function validateEmail(b){if(!Ext.form.VTypes.email(b.value)){Ext.get(b).addClass("error");return false;}else{Ext.get(b).removeClass("error");return true;}}function toggleFieldset(g,f){var b=Ext.get(g);if(b.hasClass("tgDown")){b.removeClass("tgDown");f.style.display="none";b.addClass("tgRight");}else{b.removeClass("tgRight");
f.style.display="block";b.addClass("tgDown");}}function enableLocalInput(l,h){var m=l.value;var o=l.parentNode.parentNode;var q=o.getElementsByTagName("input");var j=o.getElementsByTagName("textarea");showLocalInput(q,m,h);showLocalInput(j,m,h);}function showLocalInput(j,h,g){for(index in j){var f=j[index];if(f.style!=null&&f.style.display!="none"){f.style.display="none";}}for(index in j){var f=j[index];if(f.name==h){f.style.display="block";if(g){f.focus();}}}}function clearSuggestion(b){if($(b)!=null){$(b).innerHTML="";}}function googleTranslate(s,l,o,m,q){var r={GE:"de",SP:"es",CH:"zh"};if(r[m]){m=r[m];}if(r[q]){q=r[q];}if($(s).value==""){Ext.Msg.alert(translate("translateWithGoogle.emptyInput"));return;}if($(s).value.length>5000){Ext.Msg.alert(translate("translateWithGoogle.maxSize"));return;}if($(l)!=null){$(l).innerHTML="";}try{google.language.translate($(s).value,m,q,function(b){if(!b.error){var a=b.translation.replace(/&#39;/g,"'").replace(/&quot;/g,'"');if($(o)!=null){$(o).value=a;}if($(l)!=null){$(l).innerHTML=a;$(l).style.display="block";}}else{Ext.Msg.alert(b.error.message+" ("+b.error.code+")");}validateMetadataField($(o));});}catch(j){Ext.Msg.alert("Translation service error","Check google translation API is loaded: "+j);}}function updateChildren(l,j,m){var q="&id="+document.mainForm.id.value+"&parentUuid="+Ext.getDom("parentUuid").value+"&schema="+Ext.getDom("schema").value+"&childrenIds="+Ext.getDom("childrenIds").value;var h=Ext.get(l).select('input[type="checkbox"]');h.each(function(b){var a=Ext.getDom(b);if(a.checked){q+="&"+a.name+"=true";}});var o=Ext.get(l).select('input[type="radio"]');o.each(function(b){var a=Ext.getDom(b);if(b.checked){q+="&"+a.name+"="+a.value;}});Ext.Ajax.request({url:catalogue.services.rootUrl+j,method:"GET",params:q,success:function(e,a){var b=e.responseXML;if(b.childNodes.length!==0&&b.childNodes[0].localName=="response"){var d=b.childNodes[0].childNodes[0].nodeValue;Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),d);Ext.get(l).hide();}else{Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),m);}},failure:function(b,a){Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),m);}});}Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.HelpPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,iconCls:"book",title:undefined,collapsible:true,collapsed:false},editor:undefined,tipTpl:undefined,cache:{},loadHelp:function(j,l,m,h){if(!this.cache[j]){var g=this;GeoNetwork.util.HelpTools.get(j,this.editor.metadataSchema,this.editor.catalogue.services.schemaInfo,function(a){g.cache[j]=g.tipTpl.apply(a.records[0].data);g.update(g.cache[j]);});}},updateHelp:function(l,o){if(this.collapsed){return;}var h=l;var m="";var q;var j=this;if(o){q=o.first().getAttribute("id");}if(this.cache[l]&&this.cache[q]){this.update(this.cache[l]+this.cache[q]);}else{if(q){this.loadHelp(q,null,false,j.loadHelp(l,q,true));}else{this.loadHelp(l,null,true);}}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.tipTpl=new Ext.XTemplate(GeoNetwork.util.HelpTools.Templates.COMPLETE);this.title=OpenLayers.i18n("help");GeoNetwork.editor.HelpPanel.superclass.initComponent.call(this);panel=this;}});Ext.reg("gn_editor_helppanel",GeoNetwork.editor.HelpPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.keyword={};GeoNetwork.editor.KeywordSelectionPanel=Ext.extend(Ext.FormPanel,{catalogue:undefined,Keyword:Ext.data.Record.create([{name:"value"},{name:"thesaurus"},{name:"uri"}]),keywordStore:undefined,border:false,addAsXLink:false,itemSelector:null,loadingMask:null,ThesaurusCount:null,ref:null,name:"gmd:descriptiveKeywords",keywordsSelected:[],initComponent:function(){this.keywordStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pThesauri:"",pMode:"searchBox"},reader:new Ext.data.XmlReader({record:"keyword",id:"uri"},this.Keyword),fields:["value","thesaurus","uri"],sortInfo:{field:"thesaurus"}});this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getThesaurusCombo()," ",this.getKeyword(),"->",OpenLayers.i18n("maxResults")+" "+OpenLayers.i18n("perThesaurus"),this.getLimitInput()],items:[this.getKeywordsItemSelector()]}];this.keywordStore.on({loadexception:function(){},beforeload:function(e,d){if(Ext.getCmp("maxResults")){e.baseParams.maxResults=Ext.getCmp("maxResults").getValue();}if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();},load:function(){this.loadingMask.hide();},scope:this});this.addEvents("keywordselected");this.bbar=["->",{id:"addAsXLinkCheckBox",xtype:"checkbox",checked:false,boxLabel:OpenLayers.i18n("addAsXLink"),listeners:{check:function(d,e){this.addAsXLink=e;},scope:this}},{id:"keywordSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildKeywordXmlList();},scope:this}];GeoNetwork.editor.KeywordSelectionPanel.superclass.initComponent.call(this);},getKeyword:function(){return new GeoNetwork.form.SearchField({id:"keywordSearchField",width:240,store:this.keywordStore,paramName:"pKeyword"});},setRef:function(b){this.ref=b;},setAddAsXLink:function(b){this.addAsXLink=b||false;Ext.getCmp("addAsXLinkCheckBox").setValue(this.addAsXLink);},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:50,width:40};},getThesaurusCombo:function(){GeoNetwork.editor.keyword.thesaurusStore=new GeoNetwork.data.ThesaurusStore({url:this.catalogue.services.getThesaurus,allOption:true,activatedOnly:true});return{xtype:"combo",width:150,id:"search-thesauri",value:0,store:GeoNetwork.editor.keyword.thesaurusStore,triggerAction:"all",mode:"local",displayField:"filename",valueField:"id",listWidth:250,listeners:{select:function(h,g,f){this.keywordStore.removeAll();this.keywordStore.baseParams.pThesauri=h.getValue();var j=Ext.getCmp("keywordSearchField").getValue();if(j.length<1){this.keywordStore.baseParams.pKeyword="*";}else{this.keywordStore.baseParams.pKeyword=j;}this.keywordStore.reload();},clear:function(b){this.keywordStore.load();},scope:this}};},getKeywordsItemSelector:function(){var b='<tpl for="."><div class="ux-mselect-item';if(Ext.isIE||Ext.isIE7){b+='" unselectable=on';}else{b+=' x-unselectable"';}b+='>{id} {value} <span class="ux-mselect-item-thesaurus">({thesaurus})</span></div></tpl>';this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["value","thesaurus"],toData:[],msWidth:320,msHeight:230,valueField:"value",toSortField:undefined,fromTpl:b,toTpl:b,toLegend:OpenLayers.i18n("selectedKeywords"),fromLegend:OpenLayers.i18n("foundKeywords"),fromStore:this.keywordStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var a=this.getForm().findField("itemselector");a.reset.call(a);},scope:this}]});this.itemSelector.on({change:function(a){Ext.getCmp("keywordSearchValidateButton").setDisabled(a.toStore.getCount()<1);}});return this.itemSelector;},buildKeywordXmlList:function(){this.keywordsSelected=[];var g=this;this.ThesaurusCount=0;var f=[];var e=this.itemSelector.toMultiselect.store;f=e.collect("thesaurus");Ext.each(f,function(b,d,a){e.filter("thesaurus",b);var r=e.collect("uri");Ext.each(r,function(h,j){r[j]=h.replace("#","%23");});var u=g.catalogue.services.getKeyword;var s=r.length>1?true:false;var t=u+"?thesaurus="+b+"&id="+r.join(",")+"&multiple="+s;++g.ThesaurusCount;if(g.addAsXLink){var q="<gmd:descriptiveKeywords xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:gmd='http://www.isotc211.org/2005/gmd'  xmlns:gco='http://www.isotc211.org/2005/gco' xlink:href='"+t+"'/>";g.keywordsSelected.push(q);}else{g.retrieveKeywordData(t);}});if(this.addAsXLink){this.fireEvent("keywordselected",this,this.keywordsSelected);
this.ownerCt.hide();}e.clearFilter();},retrieveKeywordData:function(b){Ext.getCmp("keywordSearchValidateButton").disable();Ext.Ajax.request({url:b,method:"GET",scope:this,success:function(e){var a=e.responseText;if(a.indexOf("<gmd:MD_Keywords")!==-1){this.keywordsSelected.push("<gmd:descriptiveKeywords xmlns:gmd='http://www.isotc211.org/2005/gmd'>"+e.responseText+"</gmd:descriptiveKeywords>");}Ext.getCmp("keywordSearchValidateButton").enable();this.ThesaurusCount-=1;if(this.ThesaurusCount===0){this.fireEvent("keywordselected",this,this.keywordsSelected);this.ownerCt.hide();}}});}});Ext.reg("gn_editor_keywordselectionpanel",GeoNetwork.editor.KeywordSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.LinkedMetadataPanel=Ext.extend(Ext.Panel,{title:undefined,editor:undefined,metadataId:undefined,selectedUuid:undefined,selectedType:undefined,metadataSchema:undefined,serviceUrl:undefined,store:undefined,parentAction:undefined,datasetAction:undefined,serviceAction:undefined,featureCatAction:undefined,delFeatureCatAction:undefined,updateChildrenAction:undefined,colModel:undefined,expander:undefined,defaultConfig:{border:false,frame:false,iconCls:"linkIcon",collapsible:true,collapsed:false},createColumnDef:function(){this.expander=new Ext.grid.RowExpander({tpl:new Ext.XTemplate('<div title=""><a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');">{title}</a></div>{msg}')});return[this.expander,{id:"type",header:OpenLayers.i18n("type"),width:60,sortable:true,hidden:true,dataIndex:"type"},{header:OpenLayers.i18n("title"),hidden:false,dataIndex:"title"}];},createColumnModel:function(){this.colModel=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:this.createColumnDef()});return this.colModel;},updatePanel:function(){this.reload();},clear:function(){this.store.removeAll();},reload:function(l,j,m){this.metadataId=j||this.metadataId;this.metadataSchema=m||this.metadataSchema;if(this.collapsed){return;}this.colModel.setConfig(this.createColumnDef());var h=this.metadataSchema.indexOf("iso19139")!==-1;var e=this.metadataSchema==="iso19110";this.parentAction.setDisabled(!h);this.serviceAction.setDisabled(!h);this.datasetAction.setDisabled(!h);this.featureCatAction.setDisabled(e);this.store.reload({params:{id:this.metadataId,fast:"false"}});},updateStatus:function(g,h,m){var l=g.find("type","children");this.updateChildrenAction.setDisabled(l===-1);var j=g.find("type","related");this.delFeatureCatAction.setDisabled(j===-1);},selectionChangeEvent:function(j,g,h){var e=j.getStore().getAt(g);this.selectedUuid=e.get("uuid");this.selectedType=e.get("type");this.delFeatureCatAction.setDisabled(this.selectedType!=="related");},getChildrenIds:function(){var b=[];this.store.each(function(a){if(a.get("type")==="children"){this.push(a.get("id"));}},b);return b;},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("relatedResources");this.tools=[{id:"refresh",handler:function(a,b,j,l){j.reload(j,j.metadataId);}}];this.parentAction=new Ext.Action({text:OpenLayers.i18n("parentMd"),handler:function(){this.switchToTab("metadata");},scope:this.editor});this.datasetAction=new Ext.Action({text:OpenLayers.i18n("datasetMd"),iconCls:"cat-dataset",handler:function(){this.showLinkedServiceMetadataSelectionPanel("coupledResource","","");},scope:this.editor});this.serviceAction=new Ext.Action({text:OpenLayers.i18n("serviceMd"),iconCls:"cat-service",handler:function(){this.showLinkedServiceMetadataSelectionPanel("attachService","","");},scope:this.editor});this.featureCatAction=new Ext.Action({text:OpenLayers.i18n("featureCat"),iconCls:"cat-featureCatalogue",handler:function(){this.showLinkedMetadataSelectionPanel(null,"iso19110");},scope:this.editor});this.delFeatureCatAction=new Ext.Action({text:OpenLayers.i18n("delete19110Relation"),handler:function(){this.editor.catalogue.doAction(this.editor.catalogue.services.mdRelationDelete,{childUuid:this.selectedUuid,parentId:this.metadataId},null,null,this.reload.bind(this),null);var a=this.editor.catalogue.services.mdProcessing+"?uuidref="+this.selectedUuid+"&id="+this.metadataId+"&process=update-detachFeatureCatalogue";this.editor.process(a);},scope:this,disabled:true});this.updateChildrenAction=new Ext.Action({text:OpenLayers.i18n("updateChildren"),handler:function(){this.editor.catalogue.modalAction(OpenLayers.i18n("updateChildren"),this.editor.catalogue.services.mdMassiveChildrenForm+"?parentUuid="+document.mainForm.uuid.value+"&schema="+document.mainForm.schema.value+"&childrenIds="+this.getChildrenIds().join(","));},scope:this,disabled:true});this.bbar=new Ext.Toolbar({items:[{text:OpenLayers.i18n("createLink"),iconCls:"relatedAddIcon",menu:new Ext.menu.Menu({items:[this.parentAction,this.datasetAction,this.serviceAction,this.featureCatAction]})},{text:OpenLayers.i18n("otherActions"),menu:new Ext.menu.Menu({items:[this.updateChildrenAction,this.delFeatureCatAction]})}]});GeoNetwork.editor.LinkedMetadataPanel.superclass.initComponent.call(this);this.store=new GeoNetwork.data.MetadataRelationStore(this.serviceUrl,{fast:false,id:this.metadataId},true);var e=this;var d=new Ext.grid.GridPanel({store:this.store,colModel:this.createColumnModel(),loadMask:true,plugins:this.expander,view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+OpenLayers.i18n("records")+'" : "'+OpenLayers.i18n("record")+'"]})'}),frame:false,height:150,autoWidth:true,listeners:{rowclick:this.selectionChangeEvent,scope:e}});this.add(d);if(this.metadataId){this.reload();}this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);this.store.on("load",this.updateStatus,this);}});Ext.reg("gn_editor_linkedmetadatapanel",GeoNetwork.editor.LinkedMetadataPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.Filter={SERVICE:[{name:"E_type",value:"service"}],DATASET:[{name:"E_type",value:"dataset"}],FEATURE_CATALOGUE:[{name:"E__schema",value:"iso19110"}]};GeoNetwork.editor.linkedMetadata={};GeoNetwork.editor.LinkedMetadataSelectionPanel=Ext.extend(Ext.FormPanel,{catalogue:undefined,border:false,layout:"fit",createIfNotExistURL:null,hiddenParameters:undefined,singleSelect:true,loadingMask:null,mdStore:null,ref:null,proxy:null,mode:null,serviceUrl:null,capabilitiesStore:null,linkedMetadataStore:undefined,initComponent:function(){this.addEvents("linkedmetadataselected");this.mdStore=GeoNetwork.data.MetadataResultsStore();this.linkedMetadataStore=GeoNetwork.data.MetadataCSWResultsStore();if(this.mode==="attachService"||this.mode==="coupledResource"){this.capabilitiesStore=new GeoExt.data.WMSCapabilitiesStore({url:this.serviceUrl,id:"capabilitiesStore",listeners:{exception:function(d,b,a,o,e,q){Ext.MessageBox.alert(OpenLayers.i18n("error"));},beforeload:function(){if(this.mode==="attachService"){var a=Ext.getCmp("linkedMetadataGrid").getSelectionModel().getSelections();if(a===undefined||a[0].data.uri===""){Ext.MessageBox.alert(OpenLayers.i18n("noServiceURLError"));}this.capabilitiesStore.baseParams.url=a[0].data.uri+"?&SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.1";}else{if(this.mode==="coupledResource"){this.capabilitiesStore.baseParams.url=this.serviceUrl;}}},loadexception:function(){Ext.MessageBox.alert(OpenLayers.i18n("GetCapabilitiesDocumentError")+this.capabilitiesStore.baseParams.url);},scope:this}});}if(this.mode==="attachService"){this.hiddenParameters=GeoNetwork.editor.Filter.SERVICE;}else{if(this.mode==="iso19110"){this.hiddenParameters=GeoNetwork.editor.Filter.FEATURE_CATALOGUE;}}var j=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:"",listeners:{selectionchange:function(){Ext.getCmp("linkedMetadataValidateButton").setDisabled(this.getSelections().length<1);}}});var h=[this.getSearchInput(),"->",OpenLayers.i18n("maxResults"),this.getLimitInput()];this.addHiddenFormInput(h);var f=new Ext.grid.GridPanel({id:"linkedMetadataGrid",xtype:"grid",layout:"fit",height:280,bodyStyle:"padding: 0px;",border:true,loadMask:true,tbar:h,store:this.linkedMetadataStore,columns:[j,{id:"title",header:OpenLayers.i18n("mdTitle"),dataIndex:"title"},{id:"subject",header:OpenLayers.i18n("keywords"),dataIndex:"subject",hidden:true},{id:"uri",header:OpenLayers.i18n("uri"),dataIndex:"getCapabilitiesUrl"}],sm:j,autoExpandColumn:"title",listeners:{rowclick:function(d,a,b){if(this.capabilitiesStore!==null&&this.mode!=="coupledResource"){this.serviceUrl=d.getStore().getAt(a).data.uri;
if(this.serviceUrl===""){this.capabilitiesStore.removeAll();}else{this.capabilitiesStore.baseParams.url=this.serviceUrl;this.capabilitiesStore.reload();}}},scope:this}});if(this.mode==="attachService"||this.mode==="coupledResource"){this.items=this.getScopedNamePanel(f);}else{this.items=f;}var g=this;this.bbar=["->",{id:"linkedMetadataValidateButton",iconCls:"relatedAddIcon",text:OpenLayers.i18n("createRelation"),disabled:true,handler:function(){var a=f.getSelectionModel().getSelections();this.fireEvent("linkedmetadataselected",this,a);this.ownerCt.close();},scope:g}];this.linkedMetadataStore.on({load:function(){if(this.loadingMask!==null){this.loadingMask.hide();}},scope:this});GeoNetwork.editor.LinkedMetadataSelectionPanel.superclass.initComponent.call(this);},getCreateIfNotExistButton:function(){if(!this.createIfNotExistURL){return"";}return{id:"createIfNotExistButton",iconCls:"addIcon",text:OpenLayers.i18n("createIfNotExistButton"),handler:function(){window.location.replace(this.createIfNotExistURL);},scope:this};},setRef:function(b){this.ref=b;},addHiddenFormInput:function(e){var d;if(this.hiddenParameters){for(d=0;d<this.hiddenParameters.length;d++){e.push({xtype:"textfield",fieldLabel:this.hiddenParameters[d].name,name:this.hiddenParameters[d].name,value:this.hiddenParameters[d].value,hidden:true});}}return e;},getSearchInput:function(){return new GeoNetwork.form.SearchField({name:"E.8_AnyText",width:240,store:this.linkedMetadataStore,triggerAction:function(b){b.doSearch();},scope:this});},getLimitInput:function(){return{xtype:"textfield",name:"nbResultPerPage",id:"nbResultPerPage",value:20,width:40};},getScopedNamePanel:function(j){var h={xtype:"combo",id:"getCapabilitiesLayerNameCombo",fieldLabel:OpenLayers.i18n("getCapabilitiesLayer"),store:this.capabilitiesStore,valueField:"name",displayField:"title",triggerAction:"all",listeners:{select:function(a,d,b){Ext.getCmp("getCapabilitiesLayerName").setValue(a.getValue());}}};var f={xtype:"textfield",id:"getCapabilitiesLayerName",fieldLabel:OpenLayers.i18n("layerName"),valueField:"name",displayField:"title"};var g={xtype:"panel",layout:"form",bodyStyle:"padding: 2px;",border:true,items:[j,h,f]};return g;},doSearch:function(){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("searching")});}this.loadingMask.show();GeoNetwork.editor.nbResultPerPage=20;if(Ext.getCmp("nbResultPerPage")){GeoNetwork.editor.nbResultPerPage=Ext.getCmp("nbResultPerPage").getValue();}GeoNetwork.util.CSWSearchTools.doCSWQueryFromForm(this.id,this.catalogue,1,this.showResults.bind(this),null,Ext.emptyFn);},showResults:function(f){var h=new OpenLayers.Format.CSWGetRecords.v2_0_2();var j=h.read(f.responseText);var g=j.records;if(g.length>0){this.linkedMetadataStore.loadData(j);}}});Ext.reg("gn_editor_linkedmetadataselectionpanel",GeoNetwork.editor.LinkedMetadataSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.LogoSelectionPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoScroll:true,autoWidth:true,layout:"border"},store:undefined,view:undefined,uploadForm:undefined,serviceUrl:undefined,logoAddUrl:undefined,ref:undefined,setRef:function(b){this.ref=b;},getUploadForm:function(){this.uploadForm=new Ext.form.FormPanel({fileUpload:true,region:"south",height:80,split:true,items:{xtype:"fileuploadfield",allowBlank:false,emptyText:OpenLayers.i18n("logoSelect"),hideLabel:true,name:"fname",buttonCfg:{iconCls:"thumbnailAddIcon"}},buttons:[{text:OpenLayers.i18n("upload"),scope:this,iconCls:"thumbnailGoIcon",handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:this.logoAddUrl,scope:this,success:function(e,d){this.store.reload();},failure:function(b){Ext.Msg.alert(OpenLayers.i18n("failure"),b.responseText);}});}}}]});return this.uploadForm;},initComponent:function(){Ext.applyIf(this,this.defaultConfig);var e=new Ext.XTemplate('<tpl for="."><div class="logo-wrap"><div id="{name}" class="logo">','<img src="'+this.logoUrl+'{name}" title="{name}"/><span>{name}</span></div></div>',"</tpl>");var d=Ext.data.Record.create([{name:"name",mapping:""}]);this.store=new Ext.data.Store({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:this.serviceUrl,disableCaching:false}),reader:new Ext.data.XmlReader({record:"icon",id:"icon"},d),fields:["name"]});this.view=new Ext.DataView({store:this.store,tpl:e,singleSelect:true,selectedClass:"logo-selected",overClass:"logo-over",itemSelector:"div.logo-wrap",autoScroll:true,listeners:{selectionchange:function(b,a){var g=this.view.getSelectedIndexes();if(a){this.fireEvent("logoselected",this,g);this.ownerCt.hide();}},scope:this}});this.items=[new Ext.Panel({region:"center",split:true,border:true,autoScroll:true,items:[this.view]}),this.getUploadForm()];GeoNetwork.editor.LogoSelectionPanel.superclass.initComponent.call(this);this.addEvents("logoselected");this.store.load();}});Ext.reg("gn_editor_logoselectionpanel",GeoNetwork.editor.LogoSelectionPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.NewMetadataPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,isTemplate:"n"},editor:undefined,getGroupUrl:undefined,groupStore:undefined,catalogue:undefined,tplStore:undefined,selectedGroup:undefined,selectedTpl:undefined,isChild:undefined,filter:undefined,createBt:undefined,validate:function(){if(this.selectedGroup!==undefined&&this.selectedTpl!==undefined){this.createBt.setDisabled(false);}else{this.createBt.setDisabled(true);}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);var d,e;this.createBt=new Ext.Button({text:OpenLayers.i18n("create"),iconCls:"addIcon",disabled:true,handler:function(){this.catalogue.metadataEdit(this.selectedTpl,true,this.selectedGroup,this.isChild,this.isTemplate);this.ownerCt.hide();},scope:this});this.buttons=[this.createBt,{text:OpenLayers.i18n("cancel"),iconCls:"cancel",handler:function(){this.ownerCt.hide();},scope:this}];GeoNetwork.editor.NewMetadataPanel.superclass.initComponent.call(this);this.groupStore=GeoNetwork.data.GroupStore(this.getGroupUrl);this.groupStore.load();if(!this.selectedTpl){this.tplStore=GeoNetwork.Settings.mdStore?GeoNetwork.Settings.mdStore():GeoNetwork.data.MetadataResultsStore();this.tplStore.setDefaultSort("displayOrder");d=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:""});e=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[d,{header:"Schema",dataIndex:"schema"},{id:"title",header:"Title",dataIndex:"title"},{header:"Order",hidden:true,dataIndex:"displayOrder"}]});this.add(new Ext.grid.GridPanel({layout:"fit",title:OpenLayers.i18n("chooseTemplate"),border:false,autoScroll:true,height:330,store:this.tplStore,colModel:e,sm:d,autoExpandColumn:"title",listeners:{rowclick:function(l,a,b){var j=l.getStore().getAt(a).data;if(l.getSelectionModel().getCount()!==0){this.selectedTpl=j.id;}else{this.selectedTpl=undefined;}this.validate();},scope:this}}));this.catalogue.search({E_template:"y"},null,null,1,true,this.tplStore,null);}this.add(new Ext.form.ComboBox({name:"E_group",mode:"local",emptyText:OpenLayers.i18n("chooseGroup"),triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:this.groupStore,allowBlank:false,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>",listeners:{select:function(a,b,g){this.selectedGroup=b.get("id");this.validate();},scope:this}}));this.add({xtype:"textfield",name:"isTemplate",hidden:true,value:this.isTemplate});}});Ext.reg("gn_editor_newmetadatapanel",GeoNetwork.editor.NewMetadataPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.GeoPublisherPanel=Ext.extend(Ext.form.FormPanel,{border:false,serviceUrl:undefined,itemSelector:null,geoserverStore:undefined,loadingMask:null,metadataId:null,metadataUuid:null,metadataTitle:null,fileName:null,layerName:null,accessStatus:null,nodeId:null,geoPublicationMap:null,geoPublicationMapPanel:null,geoPublicationTb:null,layers:null,extent:null,stylerBt:null,publishBt:null,unpublishBt:null,checkBt:null,protocols:{wms:{checked:true,label:"OGC:WMS"},wfs:{checked:false,label:"OGC:WFS"},wcs:{checked:false,label:"OGC:WCS"}},addOnLineSourceBt:null,addOnLineSourceMenu:null,enableStyler:false,statusBar:null,layerPreviewName:"DatasetPreview",initComponent:function(){var m=this;
var g=Ext.data.Record.create([{name:"id"},{name:"name"},{name:"adminUrl"},{name:"wmsUrl"},{name:"wfsUrl"},{name:"wcsUrl"},{name:"stylerUrl"},{name:"namespacePrefix"}]);this.geoserverStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:m.serviceUrl+"?action=LIST",method:"GET"}),baseParams:{action:"LIST"},reader:new Ext.data.XmlReader({record:"node",id:"id"},g),sortInfo:{field:"name"}});this.publishBt=new Ext.Button({text:OpenLayers.i18n("publish"),tooltip:OpenLayers.i18n("publishTooltip"),iconCls:"addVector",handler:function(){this.statusBar.setText("");this.loadingMask.show();Ext.Ajax.request({url:m.serviceUrl,params:{metadataId:this.metadataId,metadataUuid:this.metadataUuid,metadataTitle:this.metadataTitle,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"CREATE"},method:"GET",success:function(d,a){if(d.responseText.indexOf("OutOfMemoryError")!==-1){this.statusBar.setText(OpenLayers.i18n("publishError")+OpenLayers.i18n("outOfMemoryError"));this.loadingMask.hide();return;}var b=d.responseXML.getElementsByTagName("Exception").item(0);if(b!==null){this.statusBar.setText(OpenLayers.i18n("publishError")+OpenLayers.i18n("publishErrorCode")+b.getAttribute("status"));this.loadingMask.hide();return;}this.statusBar.setText(OpenLayers.i18n("publishSuccess"));this.updatePrivileges(1);this.addLayer(this.layerPreviewName,this.layerName);this.statusBar.setText(this.statusBar.text+OpenLayers.i18n("publishLayerAdded"));this.loadingMask.hide();},failure:function(b,a){this.statusBar.setText(OpenLayers.i18n("publishError"));this.loadingMask.hide();},scope:this});},scope:this});this.unpublishBt=new Ext.Button({text:OpenLayers.i18n("unpublish"),tooltip:OpenLayers.i18n("unpublishTooltip"),iconCls:"delVector",handler:function(){this.statusBar.setText("");this.cleanLayerPreview();Ext.Ajax.request({url:m.serviceUrl,params:{metadataId:this.metadataId,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"DELETE"},method:"GET",success:function(b,a){this.statusBar.setText(OpenLayers.i18n("unpublishSuccess"));this.updatePrivileges(0);},failure:function(b,a){this.statusBar.setText(OpenLayers.i18n("unpublishError"));},scope:this});},scope:this});this.checkBt=new Ext.Button({text:OpenLayers.i18n("check"),iconCls:"connect",listeners:{click:function(){this.statusBar.setText("");Ext.Ajax.request({url:m.serviceUrl,params:{metadataId:this.metadataId,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"GET"},method:"GET",success:function(e,a){var b=e.responseXML.getElementsByTagName("Exception").item(0);if(b!==null){var d=b.getAttribute("status");this.statusBar.setText(OpenLayers.i18n("errorDatasetNotFound")+d);if(d.indexOf("No vector layer")!==-1||d.indexOf("404")!==-1){this.updatePrivileges(0);}else{this.updatePrivileges();}return;}this.statusBar.setText(OpenLayers.i18n("datasetFound"));this.updatePrivileges(1);this.addLayer(this.layerPreviewName,this.layerName);},failure:function(b,a){this.statusBar.setText(OpenLayers.i18n("checkFailure"));this.updatePrivileges();},scope:this});},scope:this}});this.addOnLineSourceBt={text:OpenLayers.i18n("addOnlineSource"),tooltip:"",iconCls:"processMetadata",handler:function(){var a=this.geoserverStore.getById(this.nodeId);this.fireEvent("addOnLineSource",this,a,this.protocols);},scope:this};var l=[];for(p in this.protocols){if(this.protocols.hasOwnProperty(p)){var j=this.protocols[p];l.push({text:j.label,canActivate:false,hideOnClick:false,checked:j.checked,checkHandler:this.protocolChecked,scope:j});}}l.push("-",this.addOnLineSourceBt);this.addOnLineSourceMenu=new Ext.Button({iconCls:"processMetadata",text:OpenLayers.i18n("addOnlineSourceTitle"),tooltip:OpenLayers.i18n("addOnlineSourceTT"),menu:new Ext.menu.Menu({items:l})});this.stylerBt=new Ext.Button({text:OpenLayers.i18n("Style"),iconCls:"styler",id:"stylerBt",tooltip:"",handler:function(){var a=this.geoserverStore.getById(this.nodeId);var b=a.get("stylerUrl")+"?namespace="+a.get("namespacePrefix")+"&layer="+a.get("namespacePrefix")+":"+this.layerName;window.open(b,"","toolbar=no,menubar=no,width=600,height=500");},scope:this});this.geoPublicationTb=new Ext.Toolbar({items:[this.getGeoserverCombo(),this.checkBt,this.publishBt,this.unpublishBt,this.addOnLineSourceMenu,this.stylerBt]});this.statusBar=new Ext.form.Label({id:"statusBar",html:OpenLayers.i18n("statusInformation")});var h=new Ext.Toolbar({items:[this.statusBar]});this.geoserverStore.load({add:false});this.tbar=this.geoPublicationTb;this.bbar=h;this.items=this.getGeoPublicationMapPanel();this.addEvents("addOnLineSource");GeoNetwork.editor.GeoPublisherPanel.superclass.initComponent.call(this);this.on("resize",function(a,d,b){a.geoPublicationMapPanel.setSize(d,b);});if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(Ext.getBody(),{msg:OpenLayers.i18n("publishing")});}},getGeoPublicationMapPanel:function(){var f={projection:GeoNetwork.map.PROJECTION,theme:null,maxExtent:GeoNetwork.map.EXTENT};var g=new OpenLayers.Map(f),e;this.geoPublicationMapPanel=new GeoExt.MapPanel({id:"mapPanel",layers:GeoNetwork.map.BACKGROUND_LAYERS||[],map:g,width:this.width,height:this.height});return this.geoPublicationMapPanel;},addLayer:function(j,h){var l=Ext.getCmp("mapPanel").map;var m=new OpenLayers.Bounds.fromArray(this.extent);if(GeoNetwork.map.PROJECTION!=="EPSG:4326"){m.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection(GeoNetwork.map.PROJECTION));}l.zoomToExtent(m||GeoNetwork.map.EXTENT);this.cleanLayerPreview();var g=new OpenLayers.Layer.WMS(j,this.geoserverStore.getById(this.nodeId).get("wmsUrl"),{transparent:"true",layers:h},{singleTile:true});l.addLayer(g);},cleanLayerPreview:function(){var d=Ext.getCmp("mapPanel").map;var e=d.getLayersByName(this.layerPreviewName);if(e.length>0){e[0].destroy();}},getGeoserverCombo:function(){return{xtype:"combo",tpl:'<tpl for="."><div ext:qtip="{name}. {adminUrl}" class="x-combo-list-item">{name}</div></tpl>',store:this.geoserverStore,displayField:"name",autoSelect:true,forceSelection:true,mode:"local",triggerAction:"all",emptyText:OpenLayers.i18n("selectANode"),id:"geoserverNode",listeners:{select:function(g,f,e){this.nodeId=f.get("id");this.cleanLayerPreview();this.enableStyler=(f.get("stylerUrl")===""?false:true);this.checkBt.fireEvent("click");},scope:this}};},setRef:function(m,l,s,o,j){this.metadataId=m;this.metadataUuid=l;this.metadataTitle=s;this.fileName=o;this.accessStatus=j;if(this.fileName.indexOf("jdbc")!==-1){this.layerName=this.fileName.substr(this.fileName.indexOf("#")+1,this.fileName.length);}else{if(this.accessStatus==="fileOrUrl"){var q=this.fileName.lastIndexOf("/")+1;var r=this.fileName.lastIndexOf(".");this.layerName=this.fileName.substr(q,r-q);}else{this.layerName=this.fileName.substr(0,this.fileName.indexOf("."));}}this.cleanLayerPreview();this.updatePrivileges();if(this.nodeId!==null){this.checkBt.fireEvent("click");}},protocolChecked:function(d,e){this.checked=e;},updatePrivileges:function(b){if(this.nodeId===null){this.checkBt.disable();}else{this.checkBt.enable();}this.publishBt.disable();this.unpublishBt.disable();this.addOnLineSourceMenu.disable();this.stylerBt.disable();switch(b){case 0:this.publishBt.enable();break;case 1:this.publishBt.enable();this.unpublishBt.enable();this.addOnLineSourceMenu.enable();if(this.fileName.indexOf("tif")!==-1||!this.enableStyler){this.stylerBt.disable();}else{this.stylerBt.enable();}break;}}});Ext.reg("gn_editor_geopublisherpanel",GeoNetwork.editor.GeoPublisherPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.SuggestionsPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,iconCls:"suggestionIcon",title:undefined,collapsible:true,collapsed:true},metadataId:undefined,processName:undefined,processParams:undefined,processParametersWindow:undefined,catalogue:undefined,editor:undefined,store:undefined,clear:function(){this.store.removeAll();},reload:function(e,d){this.metadataId=d||this.metadataId;if(this.collapsed){return;}this.store.reload({params:{id:this.metadataId}});
},runSuggestedProcess:function(){if(this.processName){if(this.processParams){this.generateForm();}else{var b=this.catalogue.services.mdProcessing+"?id="+this.metadataId+"&process="+this.processName;this.run(b);}}},run:function(b){this.editor.process(b);if(this.processParametersWindow){this.processParametersWindow.hide();this.processParametersWindow.destroy();this.processParametersWindow=undefined;}},selectionChangeEvent:function(e,g){var f=e.getRecords(g);if(f[0]){this.getBottomToolbar().setDisabled(false);this.processName=f[0].get("name");this.processParams=f[0].get("params");}else{this.getBottomToolbar().setDisabled(true);this.processName=undefined;this.processParams=undefined;}},generateForm:function(){this.processParametersWindow=undefined;if(!this.processParametersWindow){var o=new Ext.form.FormPanel({defaultType:"textfield",items:[{name:"id",allowBlank:false,hidden:true,value:this.metadataId},{name:"process",allowBlank:false,hidden:true,value:this.processName}],buttons:[{text:OpenLayers.i18n("process"),iconCls:"suggestionRunIcon",handler:function(){if(o.getForm().isValid()){var a=this.catalogue.services.mdProcessing+"?"+o.getForm().getValues(true);this.run(a);}},scope:this},{text:OpenLayers.i18n("reset"),iconCls:"cancel",handler:function(){o.getForm().reset();}}]});var h=Ext.util.JSON.decode(this.processParams),l,j="",q=false,m;for(m in h){if(h.hasOwnProperty(m)){if(h[m].type==="boolean"){l="checkbox";}else{l="textfield";}if(m==="gurl"&&this.catalogue.URL){j=this.catalogue.URL;q=true;}else{if(m==="lang"&&this.catalogue.LANG){j=this.catalogue.LANG;q=true;}else{q=false;j=h[m].defaultValue;}}o.add({xtype:l,name:m,fieldLabel:OpenLayers.i18n(this.processName+m),hidden:q,value:j});}}this.processParametersWindow=new Ext.Window({title:OpenLayers.i18n("processParametersWindow"),width:300,height:300,layout:"fit",modal:true,items:o,closeAction:"destroy",constrain:true,iconCls:"suggestionIcon"});}this.processParametersWindow.show();},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("suggestions");this.tools=[{id:"refresh",handler:function(a,b,j,l){j.reload(j,j.metadataId);}}];this.bbar=new Ext.Toolbar({disabled:true,items:[{text:OpenLayers.i18n("applySelected"),iconCls:"suggestionRunIcon",handler:this.runSuggestedProcess,scope:this}]});var e=new Ext.XTemplate('<ul><tpl for=".">','<li class="suggestion" title="{name}">{desc}','<span class="suggestion-{operational}"></span></li>',"</tpl></ul>");this.store=new GeoNetwork.data.SuggestionStore(this.catalogue.services.mdSuggestion,{action:"analyze",id:this.metadataId},false);var d=new Ext.DataView({store:this.store,tpl:e,singleSelect:true,autoHeight:true,loadingText:"...",selectedClass:"suggestion-selected",overClass:"suggestion-over",itemSelector:"li.suggestion",emptyText:OpenLayers.i18n("noSuggestion"),listeners:{selectionchange:this.selectionChangeEvent,scope:this}});GeoNetwork.editor.SuggestionsPanel.superclass.initComponent.call(this);this.add(d);this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);}});Ext.reg("gn_editor_suggestionspanel",GeoNetwork.editor.SuggestionsPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.ThumbnailPanel=Ext.extend(Ext.Panel,{title:undefined,metadataId:undefined,versionId:undefined,setThumbnail:undefined,unsetThumbnail:undefined,getThumbnail:undefined,uploadForm:undefined,idField:undefined,versionField:undefined,thumbnail:undefined,editor:undefined,dataView:undefined,store:undefined,thumbnailUploadWindow:undefined,addButton:undefined,delButton:undefined,defaultConfig:{border:false,frame:false,iconCls:"thumbnailIcon",collapsible:true,collapsed:false,autoScroll:true},clear:function(){this.store.removeAll();},reload:function(j,h,e,g){this.metadataId=h||this.metadataId;this.versionId=g||this.metadataId;if(this.collapsed){return;}this.idField.setValue(this.metadataId);this.versionField.setValue(this.versionId);this.store.reload({params:{id:this.metadataId}});},uploadThumbnail:function(){if(!this.thumbnailUploadWindow){this.thumbnailUploadWindow=new Ext.Window({title:OpenLayers.i18n("thumbnailUploadWindow"),width:300,height:300,layout:"fit",modal:true,items:this.uploadForm,closeAction:"hide",constrain:true,iconCls:"thumbnailAddIcon"});}this.thumbnailUploadWindow.show();},removeThumbnail:function(){var e=this,d=this.unsetThumbnail+"?id="+this.metadataId+"&version="+this.versionId+"&type="+(this.thumbnail==="thumbnail"?"small":"large");OpenLayers.Request.GET({url:d,success:function(a){e.editor.init(e.metadataId);},failure:function(a){}});},selectionChangeEvent:function(f,j){var g=j?f.getRecords(j):[],h=this.dataView.getStore().query("desc",/thumbnail|large_thumbnail/).length==2;if(g[0]){this.thumbnail=g[0].get("desc");if(this.thumbnail==="thumbnail"||this.thumbnail==="large_thumbnail"){this.delButton.setDisabled(false);}else{this.delButton.setDisabled(true);}}else{this.delButton.setDisabled(true);this.thumbnail=undefined;}this.addButton.setDisabled(h);},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("thumbnails");this.tools=[{id:"refresh",handler:function(a,b,j,l){j.reload(j,j.metadataId);}}];var e=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="thumbnail">','<img class="thumb-small" src="{href}" title="{desc}"><br/>','<a rel="lightbox-set" class="md-mn lightBox" href="{href}"></a>',"<span>{desc}</span>","</li>","</tpl>","</ul>");this.addButton=new Ext.Button({text:OpenLayers.i18n("addThumbnail"),iconCls:"thumbnailAddIcon",handler:this.uploadThumbnail,scope:this});this.delButton=new Ext.Button({text:OpenLayers.i18n("removeSelected"),iconCls:"thumbnailDelIcon",disabled:true,handler:this.removeThumbnail,scope:this});this.bbar=new Ext.Toolbar({items:[this.addButton,this.delButton]});this.store=new GeoNetwork.data.MetadataThumbnailStore(this.getThumbnail,{id:this.metadataId});this.store.on("load",function(){this.dataView.fireEvent("selectionchange",this);Ext.ux.Lightbox.register("a[rel^=lightbox-set]",true);},this);this.idField=new Ext.form.TextField({xtype:"textfield",name:"id",value:this.metadataId,hidden:true});this.versionField=new Ext.form.TextField({name:"version",value:this.versionId,hidden:true});var d=new Ext.slider.Tip({getText:function(a){return String.format("<b>{0} px</b>",a.value);}});this.uploadForm=new Ext.form.FormPanel({fileUpload:true,items:[this.idField,this.versionField,{xtype:"textfield",name:"scalingDir",value:"width",hidden:true},{xtype:"textfield",name:"smallScalingDir",value:"width",hidden:true},{xtype:"fileuploadfield",emptyText:OpenLayers.i18n("selectImage"),fieldLabel:OpenLayers.i18n("image"),name:"fname",allowBlank:false,buttonText:"",buttonCfg:{iconCls:"thumbnailAddIcon"}},{xtype:"radio",checked:true,fieldLabel:"Type",boxLabel:OpenLayers.i18n("large"),name:"type",value:"large"},{xtype:"radio",fieldLabel:"",boxLabel:OpenLayers.i18n("small"),name:"type",value:"small"},{xtype:"sliderfield",fieldLabel:OpenLayers.i18n("scalingFactor"),name:"scalingFactor",value:1000,minValue:400,maxValue:1800,increment:200},{xtype:"checkbox",checked:true,hideLabel:true,fieldLabel:"",labelSeparator:"",boxLabel:OpenLayers.i18n("createSmall"),name:"createSmall",value:"true"},{xtype:"sliderfield",fieldLabel:OpenLayers.i18n("smallScalingFactor"),name:"smallScalingFactor",value:180,minValue:100,maxValue:220,increment:20}],buttons:[{text:OpenLayers.i18n("upload"),formBind:true,iconCls:"thumbnailGoIcon",scope:this,handler:function(){if(this.uploadForm.getForm().isValid()){var a=this;this.uploadForm.getForm().submit({url:this.setThumbnail,waitMsg:OpenLayers.i18n("uploading"),success:function(g,b){a.editor.init(a.metadataId);a.thumbnailUploadWindow.hide();}});}}},{text:OpenLayers.i18n("reset"),iconCls:"cancel",scope:this,handler:function(){this.uploadForm.getForm().reset();}}]});GeoNetwork.editor.ThumbnailPanel.superclass.initComponent.call(this);this.dataView=new Ext.DataView({autoHeight:true,autoWidth:true,store:this.store,tpl:e,singleSelect:true,selectedClass:"thumbnail-selected",overClass:"thumbnail-over",itemSelector:"li.thumbnail",emptyText:OpenLayers.i18n("noimages"),listeners:{selectionchange:this.selectionChangeEvent,scope:this}});
this.add(this.dataView);if(this.metadataId){this.reload(this,this.metadataId);}this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);}});Ext.reg("gn_editor_thumbnailpanel",GeoNetwork.editor.ThumbnailPanel);Ext.namespace("GeoNetwork.editor");GeoNetwork.editor.ValidationPanel=Ext.extend(Ext.Panel,{title:undefined,editor:undefined,metadataId:undefined,serviceUrl:undefined,store:undefined,defaultConfig:{border:false,frame:false,collapsible:true,collapsed:true,iconCls:"validateMetadata"},validate:function(){this.editor.validate(function(){this.updateValidationReport();}.bind(this));},updateValidationReport:function(){if(this.collapsed){this.toggleCollapse();}this.reload(this);},clear:function(){this.store.removeAll();},reload:function(e,d){this.metadataId=d||this.metadataId;if(this.collapsed){return;}this.store.reload({params:{id:this.metadataId}});},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.title=OpenLayers.i18n("validationReport");this.tools=[{id:"refresh",handler:function(a,b,d,e){d.reload(d,d.metadataId);}}];GeoNetwork.editor.ValidationPanel.superclass.initComponent.call(this);this.store=new GeoNetwork.data.ValidationRuleStore(this.serviceUrl,{id:this.metadataId},true);var j=Ext.grid;var h=new j.RowExpander({tpl:new Ext.XTemplate('<div title="{details}"><b>{title}</b></div>{msg}')});var g=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:[h,{id:"group",header:OpenLayers.i18n("group"),width:60,sortable:true,hidden:true,dataIndex:"group"},{header:OpenLayers.i18n("status"),width:10,resizable:false,sortable:true,dataIndex:"statusIcon"},{header:OpenLayers.i18n("title"),hidden:false,dataIndex:"title"}]});var f=new j.GridPanel({store:this.store,colModel:g,loadMask:true,plugins:h,view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+OpenLayers.i18n("items")+'" : "'+OpenLayers.i18n("item")+'"]})'}),frame:false,height:300,autoWidth:true});this.add(f);this.editor.on("editorClosed",this.clear,this);this.editor.on("metadataUpdated",this.reload,this);this.on("expand",this.reload);}});Ext.reg("gn_editor_validationpanel",GeoNetwork.editor.ValidationPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.AdminTools={showImportMetadataWindow:function(j,h){var g=new GeoNetwork.admin.MetadataInsertPanel({metadataType:j});var f=new Ext.Window({title:h||OpenLayers.i18n("importMetadata"),width:450,height:450,layout:"fit",modal:true,items:g,closeAction:"destroy",constrain:true,iconCls:"addIcon"});f.show();}};Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.HarvesterPanel=Ext.extend(Ext.Panel,{border:false,frame:false,layout:"border",height:800,catalogue:undefined,harvesterStore:undefined,harvesterTplMarkup:["Information: {site_name}<br/>","Last run: {info_lastrun}<br/>",'<tpl if="info_result_total">',"Total: {info_result_total}<br/>","Added: {info_result_added}<br/>","Removed: {info_result_removed}<br/>","Schema unknwon: {info_result_unknowSchema}<br/>","</tpl>"],harvesterTpl:undefined,xmlTpl:undefined,harvesterGrid:undefined,currentHarvester:undefined,initComponent:function(){GeoNetwork.admin.HarvesterPanel.superclass.initComponent.call(this);panel=this;this.createGrid();this.harvesterTpl=new Ext.XTemplate(this.harvesterTplMarkup);this.xmlTpl=new GeoNetwork.Templates().getHarvesterTemplate();this.harvesterGrid.getSelectionModel().on("rowselect",function(a,b,h){var j=Ext.getCmp("harvesterDetailPanel");this.harvesterTpl.overwrite(j.body,h.data);},this);var d={id:"harvesterDetailPanel",region:"east",split:true,minWidth:200,width:200,collapsible:true,hideCollapseTool:true,collapseMode:"mini",bodyStyle:{background:"#ffffff",padding:"7px"},html:"Please select a harvester to see additional details."};this.add(d);var e={id:"harvesterEditorPanel",region:"south",title:"Harvester configuration",split:true,autoScroll:true,minHeigth:400,items:[new Ext.FormPanel({border:false,frame:false,maxHeight:600,id:"harvesterEditorForm",items:[this.getHarvesterTypeField(),this.getSiteFields("geonetwork"),this.getOptionsFields("geonetwork")],buttons:[{text:"Save",listeners:{click:function(){var a=Ext.getCmp("harvesterEditorForm").getForm();if(a.isValid()){a.updateRecord(this.currentHarvester);var b=this.xmlTpl.apply(this.currentHarvester.data);this.addHarvester(this.catalogue.services.harvestingAdd,b);}},scope:panel}}]})]};this.add(e);},harvesterType:[["geonetwork","GeoNetwork"],["geonetwork20","GeoNetwork 2.0"],["webdav","webdav"],["csw","csw"],["ogcwxs","OGC WxS"],["thredds","thredds"],["z3950","z3950"],["oaipmh","oaipmh"],["metadatafragments","metadatafragments"],["arcsde","arcsde"],["filesystem","filesystem"]],switchMode:function(b){this.switchElement("site_servlet",false);this.switchElement("site_port",false);this.switchElement("site_host",false);this.switchElement("site_url",false);if(b=="geonetwork"||b=="geonetwork20"){this.switchElement("site_servlet",true);this.switchElement("site_port",true);this.switchElement("site_host",true);}else{this.switchElement("site_url",true);}if(b=="ogcwxs"){}},switchElement:function(e,f){var j=Ext.getCmp(e);var m=Ext.getCmp("harvesterEditorForm");var l=m.getForm().findField(e);if(f){l.container.up("div.x-form-item").show();j.enable();}else{l.container.up("div.x-form-item").hide();j.disable();}m.doLayout(false,true);},getHarvesterTypeField:function(){return new Ext.form.ComboBox({id:"type",name:"type",mode:"local",triggerAction:"all",fieldLabel:"Harvester type",store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:this.harvesterType}),valueField:"id",displayField:"name",listeners:{change:function(g,e,f){this.switchMode(e);},scope:this}});},ogcwxsType:[["WMS1.0.0","WMS 1.0.0"],["WMS1.1.1","WMS 1.1.1"],["WFS1.0.0","WFS 1.0.0"],["WFS1.1.0","WFS 1.1.0"],["WCS1.0.0","WCS 1.0.0"],["WPS0.4.0","WPS 0.4.0"],["WPS1.0.0","WPS 1.0.0"]],getSiteFields:function(u){var v=[];var C=new Ext.form.TextField({id:"id",name:"id",mode:"local",hidden:true});var E=new Ext.form.TextField({name:"site_name",mode:"local",fieldLabel:"Name"});v.push(C,E);var D=new Ext.form.TextField({id:"site_url",name:"site_url",mode:"local",fieldLabel:"URL"});var s=new Ext.form.ComboBox({id:"site_ogctype",name:"site_ogctype",mode:"local",fieldLabel:"Type of service",store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:this.ogcwxsType}),valueField:"id",displayField:"name"});v.push(D,s);var t=new Ext.form.TextField({id:"site_servlet",name:"site_servlet",mode:"local",fieldLabel:"Servlet"});var r=new Ext.form.TextField({id:"site_host",name:"site_host",mode:"local",fieldLabel:"Host"});var B=new Ext.form.TextField({id:"site_port",name:"site_port",mode:"local",fieldLabel:"Port"});v.push(r,B,t);var z=new Ext.form.Checkbox({id:"site_account_use",name:"site_account_use",mode:"local",fieldLabel:"Use account"});var w=new Ext.form.TextField({id:"site_account_username",name:"site_account_username",mode:"local",fieldLabel:"Username"});var F=new Ext.form.TextField({id:"site_account_password",name:"site_account_password",mode:"local",fieldLabel:"Password"});v.push(z,w,F);return{xtype:"fieldset",title:"Harvester main information",collapsible:true,items:v};},getOptionsFields:function(){var l=[];var q=new Ext.form.Checkbox({id:"options_createthumbnails",name:"options_createthumbnails",mode:"local",fieldLabel:"Create thumbnail for WMS layers"});var r=new Ext.form.Checkbox({id:"options_uselayer",name:"options_uselayer",mode:"local",fieldLabel:"Create metadata for layer elements using GetCapabilities information"});var u=new Ext.form.Checkbox({id:"options_uselayermd",name:"options_uselayermd",mode:"local",fieldLabel:"Create metadata for layer elements using MetadataURL attributes (if existing, if not use GetCapabilities)"});var s=new Ext.form.TextField({id:"options_lang",name:"options_lang",mode:"local",defaultValue:"eng",fieldLabel:"Language"});var t=new Ext.form.TextField({id:"options_topic",name:"options_topic",mode:"local",defaultValue:"",fieldLabel:"Topic category"});
l.push(q,r,u,s,t);var m=new Ext.form.Checkbox({id:"options_onerunonly",name:"options_onerunonly",mode:"local",fieldLabel:"One run only"});var o=new Ext.form.TextField({id:"options_every",name:"options_every",mode:"local",defaultValue:"90",fieldLabel:"Every"});l.push(m,o);return{xtype:"fieldset",title:"Harvester options",collapsible:true,items:l};},getPrivilegesFields:function(){return;},getCategoriesFields:function(){return;},createEditor:function(){var b=Ext.data.Record.create([{name:"id",mapping:"node/@id"},{name:"occupation"}]);},createGrid:function(){var b=new Ext.grid.CheckboxSelectionModel({singleSelect:true,header:"",listeners:{selectionchange:function(){Ext.getCmp("harvestEditBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestRemoveBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestActivateBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestDesactivateBt").setDisabled(this.getSelections().length<1);Ext.getCmp("harvestRunBt").setDisabled(this.getSelections().length<1);}}});this.harvesterGrid=new Ext.grid.GridPanel({store:this.harvesterStore,split:true,id:"harvesterGrid",region:"center",sm:b,columns:[b,{id:"id",header:"id",width:60,sortable:true,dataIndex:"id",hidden:true},{header:"Name",width:125,sortable:true,dataIndex:"site_name"},{header:"Type",width:75,sortable:true,dataIndex:"type"},{header:"Status",width:80,sortable:true,dataIndex:"site_status"},{header:"Running",width:80,sortable:true,dataIndex:"info_running"},{header:"Every",width:80,sortable:true,dataIndex:"options_every"},{header:"Last run",width:160,sortable:true,dataIndex:"info_lastrun"}],stripeRows:true,maxHeight:250,height:250,stateful:true,stateId:"grid",listeners:{rowclick:function(a,e,h){var m=this.harvesterGrid.getStore().getAt(e);this.currentHarvester=m;console.log(m);var l=Ext.getCmp("harvesterEditorForm").getForm();l.loadRecord(m);},scope:this},buttons:[{text:"Add",listeners:{click:function(){}}},{text:"Activate",id:"harvestActivateBt",disabled:true,listeners:{click:function(){var a=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();var e={id:a.data.id};this.doAction(this.catalogue.services.harvestingStart,e,this.refreshHarvester,null,null,"Failed to activate the harvester");},scope:this}},{text:"Desactivate",id:"harvestDesactivateBt",disabled:true,listeners:{click:function(){var a=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();var e={id:a.data.id};this.doAction(this.catalogue.services.harvestingStop,e,this.refreshHarvester,null,null,"Failed to desactivate the harvester");},scope:this}},{id:"harvestEditBt",text:"Edit",disabled:true,listeners:{click:function(){},scope:this}},{text:"Run",id:"harvestRunBt",disabled:true,listeners:{click:function(){var a=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();var e={id:a.data.id};this.doAction(this.catalogue.services.harvestingRun,e,this.refreshHarvester,null,null,"Failed to start the harvester");},scope:this}},{id:"harvestRemoveBt",text:"Remove",icon:"../images/default/cross.png",disabled:true,listeners:{click:function(){var a=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();Ext.Msg.confirm("Delete ?","Are you sure to delete selected harvester and all its records?",this.removeHarvester,a.data.id);},scope:this}},{text:"Refresh",id:"harvestRefreshBt",listeners:{click:function(){this.harvesterGrid.getStore().reload();},scope:this}}]});this.add(this.harvesterGrid);},addHarvester:function(e,f){var g={url:e,data:f};OpenLayers.Util.applyDefaults(g,{success:function(a){Ext.Msg.alert("ok",a.responseText);},failure:function(a){Ext.Msg.alert("Failed",a.responseText);}});OpenLayers.Request.POST(g);},doAction:function(j,m,o,h,l,q){OpenLayers.Request.GET({url:j,params:m,success:function(a){if(l){Ext.Msg.alert(l,a.responseText);}if(o){o(a);}},failure:function(a){if(q){Ext.Msg.alert(q,a.responseText);}if(o){o(a);}}});},removeHarvester:function(e){if(e=="yes"){var d={id:this};this.doAction(this.catalogue.services.harvestingRemove,d,this.refreshHarvester,null,null,"Failed to delete the harvester");}},refreshHarvester:function(){Ext.getCmp("harvestRefreshBt").fireEvent("click");}});Ext.reg("gn_admin_harvesterpanel",GeoNetwork.admin.HarvesterPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.MetadataInsertPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoScroll:true,autoWidth:true,layout:"border"},store:undefined,view:undefined,uploadForm:undefined,serviceUrl:undefined,ref:undefined,setRef:function(b){this.ref=b;},getForm:function(){var b=GeoNetwork.data.GroupStore(catalogue.services.getGroups);b.load();this.uploadForm=new Ext.form.FormPanel({region:"center",split:true,errorReader:new Ext.data.XmlReader({record:"response"},["id"]),items:[{xtype:"textfield",hidden:true,name:"insert_mode",value:"0"},{xtype:"textfield",hidden:true,name:"template",value:"s"},{xtype:"textarea",name:"data",fieldLabel:OpenLayers.i18n("xmlData"),allowBlank:false,width:300,height:200},new Ext.form.ComboBox({name:"group",hiddenName:"group",mode:"local",emptyText:OpenLayers.i18n("chooseGroup"),triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:b,allowBlank:false,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>"})],buttons:[{text:OpenLayers.i18n("add"),scope:this,iconCls:"thumbnailGoIcon",handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:catalogue.services.mdXMLInsert,scope:this,success:function(a,e){if(this.ownerCt){this.ownerCt.close();}},failure:function(a){Ext.Msg.alert(OpenLayers.i18n("failure"),a.responseText);}});}}}]});return this.uploadForm;},initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.items=[this.getForm()];GeoNetwork.admin.MetadataInsertPanel.superclass.initComponent.call(this);}});Ext.reg("gn_admin_metadatainsertpanel",GeoNetwork.admin.MetadataInsertPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.SubTemplateManagerPanel=Ext.extend(Ext.Panel,{border:false,frame:false,record:undefined,layout:"border",catalogue:undefined,toolbar:undefined,searchPanel:undefined,searchForm:undefined,searchField:undefined,newMetadataWindow:undefined,searchResultGrid:undefined,subTemplateEditor:undefined,subTemplateToolbar:undefined,subTemplateType:undefined,subTemplateTypeStore:undefined,defaultConfig:{defaultViewMode:"simple",height:800,autoWidth:true,layout:"border",iconCls:"subtemplateIcon"},getSubTemplateTypeField:function(){return{xtype:"combo",name:"E__root",mode:"local",title:OpenLayers.i18n("selDirectoryTT"),triggerAction:"all",store:this.subTemplateTypeStore,valueField:"type",tpl:'<tpl for="."><div class="x-combo-list-item" title="{description}">{label} ({type})</div></tpl>',displayField:"label"};},initComponent:function(f){Ext.apply(this,f);Ext.applyIf(this,this.defaultConfig);this.subTemplateTypeStore=new GeoNetwork.data.SubTemplateTypeStore(this.catalogue.services.subTemplateType);this.catalogue.metadataStore=GeoNetwork.data.MetadataResultsStore();this.catalogue.editMode=2;this.catalogue.metadataEditFn=function(a,j,d,b){this.editorPanel.init(a,j,d,b,"s");}.bind(this);GeoNetwork.admin.SubTemplateManagerPanel.superclass.initComponent.call(this);this.initSearch();this.initEditor();var g={region:"west",split:true,collapsible:true,collapsed:false,hideCollapseTool:true,collapseMode:"mini",autoScroll:true,minWidth:240,width:280,items:[this.searchForm,this.searchResultGrid]};var e={region:"center",split:true,autoScroll:true,minHeigth:400,items:[this.editorPanel]};this.add(g);this.add(e);this.searchField.focus(true);},search:function(){this.editorPanel.cancel();this.catalogue.search("searchForm",null,null);},initSearch:function(){var e=this;this.searchField=new GeoNetwork.form.SearchField({name:"E_any",store:this.catalogue.metadataStore,triggerAction:function(a){a.record=undefined;a.disableToolbar(true);a.search();},scope:e});this.searchForm=new Ext.FormPanel({id:"searchForm",border:false,defaults:{width:240,hideLabel:true},items:[this.getSubTemplateTypeField(),{xtype:"textfield",name:"E__isTemplate",hidden:true,value:"s"},this.searchField]});
var d=["afterDelete"];Ext.each(d,function(a){this.catalogue.on(a,function(){this.search();},this);},this);this.searchResultGrid=new Ext.grid.GridPanel({layout:"fit",autoHeight:true,height:500,border:false,store:this.catalogue.metadataStore,columns:[{id:"title",header:OpenLayers.i18n("title"),dataIndex:"title"},{id:"uuid",header:"Uuid",dataIndex:"uuid",hidden:true}],autoExpandColumn:"title",listeners:{rowclick:function(h,a,b){this.record=h.getStore().getAt(a).data;this.editorPanel.init(this.record.id,false);this.disableToolbar(false);},scope:e},bbar:{items:[{xtype:"button",text:OpenLayers.i18n("add"),tooltip:OpenLayers.i18n("addTplElTT"),iconCls:"addIcon",handler:function(){var a="s";GeoNetwork.admin.AdminTools.showImportMetadataWindow(a,OpenLayers.i18n("subTemplateImport"));},scope:this},{text:OpenLayers.i18n("duplicate"),tooltip:OpenLayers.i18n("copyTplElTT"),iconCls:"md-mn-copy",disabled:true,handler:function(){var a=this.record.id;GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,a,OpenLayers.i18n("duplicate"),false);},scope:this},{text:OpenLayers.i18n("delete"),tooltip:OpenLayers.i18n("delTplElTT"),iconCls:"md-mn-del",disabled:true,handler:function(){var a=this.record.uuid;this.catalogue.metadataDelete(a);},scope:this},{text:OpenLayers.i18n("privileges"),tooltip:OpenLayers.i18n("privTplElTT"),iconCls:"privIcon",disabled:true,handler:function(){var a=this.record.id;this.catalogue.metadataAdmin(a);},scope:this}]}});},disableToolbar:function(e){var d=this.searchResultGrid.getBottomToolbar();Ext.each(d.items,function(a,b){if(b!==0){d.get(b).setDisabled(e);}},d);},initEditor:function(){var b={collapsed:true,hidden:true};this.editorPanel=new GeoNetwork.editor.EditorPanel({defaultViewMode:this.defaultViewMode,tbarConfig:{hideTypeMenu:true},utilityPanelConfig:{thumbnailPanel:b,relationPanel:b,validationPanel:{collapsed:true},suggestionPanel:b,helpPanel:{collapsed:false}},catalogue:this.catalogue,utilityPanelCollapsed:true});},refresh:function(){this.subTemplateTypeStore.load();}});Ext.reg("gn_admin_subtemplatemanagerpanel",GeoNetwork.admin.SubTemplateManagerPanel);Ext.namespace("GeoNetwork.admin");GeoNetwork.admin.ThesaurusManagerPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoWidth:true,layout:"border",maxResults:50,defaultThesaurusType:"theme"},border:false,frame:false,selectedThesaurus:undefined,layout:"border",catalogue:undefined,toolbar:undefined,thesaurusGrid:undefined,thesaurusStore:undefined,keywordGrid:undefined,createEmptyThesaurusWindow:undefined,createThesaurusFromLocalFileWindow:undefined,createThesaurusFromRemoteFileWindow:undefined,createEmptyThesaurusForm:undefined,createThesaurusFromLocalFileForm:undefined,createThesaurusFromRemoteFileForm:undefined,initComponent:function(){Ext.applyIf(this,this.defaultConfig);this.thesaurusStore=new GeoNetwork.data.ThesaurusStore({url:this.catalogue.services.getThesaurus});var e=Ext.data.Record.create([{name:"id"},{name:"value"},{name:"thesaurus"},{name:"definition"},{name:"uri"},{name:"east"},{name:"west"},{name:"south"},{name:"north"}]);this.keywordStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pThesauri:"",pMode:"searchBox",maxResults:this.maxResults},reader:new Ext.data.XmlReader({record:"keyword",id:"id"},e),fields:["id","value","definition","thesaurus","uri","east","west","south","north"],sortInfo:{field:"value"}});GeoNetwork.admin.ThesaurusManagerPanel.superclass.initComponent.call(this);this.initThesaurusView();this.initKeywordView();var g={region:"west",split:true,autoScroll:true,minWidth:280,width:400,items:[this.thesaurusGrid]};var f={region:"center",split:true,autoScroll:true,minHeigth:400,items:[this.keywordGrid]};this.add(g);this.add(f);},initThesaurusView:function(){var e=this;var f=[["y"],["n"]];var g=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"title",header:OpenLayers.i18n("ThesaurusName"),dataIndex:"title",editable:false},{id:"filename",header:OpenLayers.i18n("id"),dataIndex:"filename",editable:false},{id:"theme",header:OpenLayers.i18n("Theme"),dataIndex:"theme",editable:false},{id:"type",header:OpenLayers.i18n("Type"),dataIndex:"type",editable:false},{id:"activated",header:OpenLayers.i18n("Activated"),dataIndex:"activated",width:50,editor:new Ext.form.ComboBox({mode:"local",editable:false,typeAhead:true,triggerAction:"all",lazyRender:true,allowBlank:false,listClass:"x-combo-list-small",store:new Ext.data.ArrayStore({id:0,fields:["id"],data:f}),valueField:"id",displayField:"id"})}]});this.thesaurusGrid=new Ext.grid.EditorGridPanel({layout:"fit",autoHeight:true,border:false,store:this.thesaurusStore,cm:g,autoExpandColumn:"title",clicksToEdit:1,listeners:{scope:this,afteredit:function(a){Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusActivate+"?ref="+a.record.data.id+"&activated="+a.record.data.activated,failure:function(){Ext.Msg.alert("Fail");}});},dblclick:function(a){this.keywordStore.setBaseParam("pKeyword","*");this.keywordStore.reload();}},sm:new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{scope:this,selectionchange:function(a){this.updateKeywordGridAndToolbar();this.updateThesaurusToolbar();this.updateKeywordToolbar();}}}),tbar:{disabled:false,items:[{text:OpenLayers.i18n("add"),iconCls:"addIcon",menu:{xtype:"menu",plain:true,items:[{text:OpenLayers.i18n("emptyThesaurus"),scope:this,handler:function(){if(!this.createEmptyThesaurusWindow){this.createEmptyThesaurusWindow=this.getCreateEmptyThesaurusWindow();}this.createEmptyThesaurusWindow.show(this);}},{text:OpenLayers.i18n("thesaurusFromFile"),scope:this,handler:function(){if(!this.createThesaurusFromLocalFileWindow){this.createThesaurusFromLocalFileWindow=this.getCreateThesaurusFromLocalFileWindow();}this.createThesaurusFromLocalFileWindow.show(this);}},{text:OpenLayers.i18n("thesaurusFromURL"),scope:this,handler:function(){if(!this.createThesaurusFromRemoteFileWindow){this.createThesaurusFromRemoteFileWindow=this.getCreateThesaurusFromRemoteFileWindow();}this.createThesaurusFromRemoteFileWindow.show(this);}}]}},{id:"delete_thesaurus_button",disabled:true,text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){OpenLayers.Request.GET({scope:this,url:this.catalogue.services.thesaurusDelete+"?ref="+this.keywordStore.baseParams.pThesauri,success:function(a){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(a){}});},scope:this},{id:"download_thesaurus_button",disabled:true,text:OpenLayers.i18n("download"),iconCls:"xmlIcon",handler:function(){location.replace(this.catalogue.services.thesaurusDownload+"?ref="+this.keywordStore.baseParams.pThesauri);},scope:this}]}});},initKeywordView:function(){var b=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"id",header:OpenLayers.i18n("id"),dataIndex:"uri",editor:new Ext.form.TextField({allowBlank:false})},{id:"hidden_id",header:OpenLayers.i18n("uri"),dataIndex:"id",hidden:true,editor:new Ext.form.TextField({allowBlank:false})},{id:"value",header:OpenLayers.i18n("label"),dataIndex:"value",editor:new Ext.form.TextField({allowBlank:false})},{id:"definition",header:OpenLayers.i18n("definition"),dataIndex:"definition",editor:new Ext.form.TextField({allowBlank:false})},{id:"west",header:OpenLayers.i18n("xmin"),dataIndex:"west",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"east",header:OpenLayers.i18n("xmax"),dataIndex:"east",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"south",header:OpenLayers.i18n("ymin"),dataIndex:"south",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"north",header:OpenLayers.i18n("ymax"),dataIndex:"north",hidden:true,editor:new Ext.form.TextField({allowBlank:true})}]});this.keywordGrid=new Ext.grid.EditorGridPanel({layout:"fit",autoHeight:true,height:500,border:false,store:this.keywordStore,cm:b,autoExpandColumn:"value",sm:new Ext.grid.CellSelectionModel({listeners:{scope:this,selectionchange:function(a){this.updateKeywordToolbar();
}}}),listeners:{scope:this,afteredit:function(e){var E=this.keywordStore.baseParams.pThesauri;var I=E.split(".")[1];var L=e.record.data.uri.split("#");var C=L[0];var D=L[1];var H=D;var G=this.catalogue.lang;var K=e.record.data.value;var F=e.record.data.definition;var z;if(e.field==="uri"){H=e.originalValue.split("#")[1];}if(I==="place"){var w=e.record.data.south;var B=e.record.data.north;var J=e.record.data.west;var a=e.record.data.east;z="<request><oldid>"+H+"</oldid><newid>"+D+"</newid><lang>"+G+"</lang><ref>"+E+"</ref><definition>"+F+"</definition><namespace>"+C+"#</namespace><north>"+B+"</north><south>"+w+"</south><east>"+a+"</east><prefLab>"+K+"</prefLab><west>"+J+"</west><refType>"+I+"</refType></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptUpdate,failure:function(){Ext.Msg.alert("Fail");},xmlData:z});}else{z="<request><newid>"+D+"</newid><refType>"+I+"</refType><definition>"+F+"</definition><namespace>"+C+"#</namespace><ref>"+E+"</ref><oldid>"+H+"</oldid><lang>"+G+"</lang><prefLab>"+K+"</prefLab></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptUpdate,failure:function(){Ext.Msg.alert("Fail");},xmlData:z});}e.record.commit();}},tbar:{disabled:true,items:[{id:"add_keyword_button",text:OpenLayers.i18n("add"),iconCls:"addIcon",handler:function(){var J=this.keywordGrid.store.recordType;var G="#"+new Date().getTime();var F=this.keywordStore.baseParams.pThesauri;var I=F.split(".")[1];var D=G.split("#")[1];var H=this.catalogue.lang;var u=OpenLayers.i18n("newLabel");var E=OpenLayers.i18n("newDefinition");var z;if(I==="place"){var w=-90;var B=90;var a=-180;var v=180;z="<request><oldid/><newid>"+D+"</newid><lang>"+H+"</lang><ref>"+F+"</ref><definition>"+E+"</definition><namespace>#</namespace><north>"+B+"</north><south>"+w+"</south><east>"+v+"</east><prefLab>"+u+"</prefLab><west>"+a+"</west><refType>"+I+"</refType></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptAdd,failure:function(){Ext.Msg.alert("Fail");},xmlData:z});}else{z="<request><newid>"+D+"</newid><refType>"+I+"</refType><definition>"+E+"</definition><namespace>#</namespace><ref>"+F+"</ref><oldid/><lang>"+H+"</lang><prefLab>"+u+"</prefLab></request>";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptAdd,failure:function(){Ext.Msg.alert("Fail");},xmlData:z});}var C=new J({uri:G,value:u,definition:E,west:-180,east:180,south:-90,north:90});this.keywordGrid.stopEditing();this.keywordGrid.store.insert(0,C);this.keywordGrid.startEditing(0,0);},scope:this},{id:"delete_keyword_button",text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){var a=this.keywordGrid.getSelectionModel().getSelectedCell();var l=this.keywordGrid.store.getAt(a[0]);var q=this.keywordStore.baseParams.pThesauri;var m=l.data.uri.split("#");var o=m[0];var j=m[1];Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptDelete+"?pThesaurus="+q+"&namespace="+o+"%23&id="+j,failure:function(){Ext.Msg.alert("Fail");}});this.keywordGrid.store.removeAt(a[0]);},scope:this},"->",this.getKeyword(),OpenLayers.i18n("maxResults")+" "+OpenLayers.i18n("perThesaurus"),this.getLimitInput()]}});},updateThesaurusToolbar:function(){var b=this.thesaurusGrid.getSelectionModel().getSelected();Ext.getCmp("delete_thesaurus_button").setDisabled(!b);Ext.getCmp("download_thesaurus_button").setDisabled(!b);},updateKeywordToolbar:function(){var f=this.thesaurusGrid.getSelectionModel().getSelected();if(f){var h=f.data.type;var j=h==="local";if(j){var g=this.keywordGrid.getSelectionModel().getSelectedCell();Ext.getCmp("delete_keyword_button").setDisabled(!g);}}},updateKeywordGridAndToolbar:function(){var l=this.thesaurusGrid.getSelectionModel().getSelected();if(l){this.keywordGrid.getTopToolbar().enable();var s=l.data.theme;var m=l.data.type;var r=m==="local";var o=l.data.id;this.keywordStore.removeAll();this.keywordStore.baseParams.pThesauri=o;var q=(s!=="place");this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("east"),q);this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("west"),q);this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("south"),q);this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("north"),q);for(var j=0;j<this.keywordGrid.getColumnModel().getColumnCount();j++){this.keywordGrid.getColumnModel().setEditable(j,r);}Ext.getCmp("delete_keyword_button").setDisabled(!r);Ext.getCmp("add_keyword_button").setDisabled(!r);}else{this.keywordGrid.getTopToolbar().disable();}},getCreateEmptyThesaurusWindow:function(){var b=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateEmptyThesaurusForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){if(this.createEmptyThesaurusForm.getForm().isValid()){this.createEmptyThesaurusForm.getForm().getEl().dom.enctype="application/x-www-form-urlencoded";this.createEmptyThesaurusForm.bodyCfg.enctype="application/x-www-form-urlencoded";Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusAdd,success:function(){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(){Ext.Msg.alert("Fail");},xmlData:"<request><fname>"+Ext.getCmp("empty_thesaurusName").getValue()+"</fname><dname>"+Ext.getCmp("empty_themeCmb").getValue()+"</dname><type>"+Ext.getCmp("empty_thesaurusType").getValue()+"</type></request>"});b.hide();}}}]});return b;},getCreateThesaurusFromLocalFileWindow:function(){var b=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateThesaurusFromLocalFileForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){console.log(this.createThesaurusFromLocalFileForm);if(this.createThesaurusFromLocalFileForm.getForm().isValid()){this.createThesaurusFromLocalFileForm.getForm().getEl().dom.enctype="multipart/form-data";this.createThesaurusFromLocalFileForm.bodyCfg.enctype="multipart/form-data";this.createThesaurusFromLocalFileForm.getForm().submit({url:this.catalogue.services.thesaurusUpload,scope:this,success:function(a,e){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(a){Ext.Msg.alert(OpenLayers.i18n("failure"),a.responseText);}});b.hide();}}}]});return b;},getCreateThesaurusFromRemoteFileWindow:function(){var b=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateThesaurusFromRemoteFileForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){if(this.createThesaurusFromRemoteFileForm.getForm().isValid()){this.createThesaurusFromRemoteFileForm.getForm().getEl().dom.enctype="application/x-www-form-urlencoded";this.createThesaurusFromRemoteFileForm.bodyCfg.enctype="application/x-www-form-urlencoded";this.createThesaurusFromRemoteFileForm.getForm().submit({url:this.catalogue.services.thesaurusUpload,scope:this,success:function(a){this.thesaurusStore.removeAll();this.thesaurusStore.reload();},failure:function(a){Ext.Msg.alert(OpenLayers.i18n("failure"),a.responseText);}});b.hide();}}}]});return b;},getCreateEmptyThesaurusForm:function(){this.createEmptyThesaurusForm=new Ext.form.FormPanel({fileUpload:false,region:"center",autoHeight:true,baseCls:"x-plain",labelWidth:170,split:true,items:[{xtype:"textfield",fieldLabel:OpenLayers.i18n("ThesaurusName"),id:"empty_thesaurusName",name:"fname",anchor:"-15"},this.createTypeCombo("empty_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"empty_thesaurusType",name:"type",value:"local",hidden:true,anchor:"-15"}]});
return this.createEmptyThesaurusForm;},getCreateThesaurusFromLocalFileForm:function(){this.createThesaurusFromLocalFileForm=new Ext.form.FormPanel({fileUpload:true,region:"center",autoHeight:true,baseCls:"x-plain",errorReader:new Ext.data.XmlReader({record:"record"},["Thesaurus"]),labelWidth:170,split:true,items:[{xtype:"fileuploadfield",allowBlank:true,fieldLabel:OpenLayers.i18n("thesaurusFilePath"),id:"local_fname",name:"fname",buttonCfg:{text:OpenLayers.i18n("selectFile")}},this.createTypeCombo("local_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"local_thesaurusType",name:"type",value:"external",hidden:true,anchor:"-15"},{xtype:"textfield",hidden:true,name:"mode",value:"file"}]});return this.createThesaurusFromLocalFileForm;},getCreateThesaurusFromRemoteFileForm:function(){this.createThesaurusFromRemoteFileForm=new Ext.form.FormPanel({fileUpload:false,region:"center",autoHeight:true,baseCls:"x-plain",labelWidth:170,split:true,errorReader:new Ext.data.XmlReader({record:"record"},["Thesaurus"]),listeners:{scope:this,afterrender:function(b){Ext.getCmp("remote_thesaurusURL").setVisible(true);Ext.getCmp("remote_thesaurusCmb").setVisible(false);Ext.getCmp("remote_themeCmb").setVisible(true);}},items:[{xtype:"radiogroup",id:"creationModeRadioGroup",columns:1,submitValue:false,fieldLabel:OpenLayers.i18n("creationMode"),items:[{boxLabel:OpenLayers.i18n("createThesaurusFromURL"),name:"rb-auto",inputValue:1,checked:true},{boxLabel:OpenLayers.i18n("createThesaurusFromRepository"),name:"rb-auto",inputValue:2}],listeners:{scope:this,change:function(d,e){Ext.getCmp("remote_thesaurusURL").setVisible(e.inputValue===1);Ext.getCmp("remote_thesaurusCmb").setVisible(e.inputValue===2);Ext.getCmp("remote_themeCmb").setVisible(e.inputValue!==2);}}},{xtype:"textfield",fieldLabel:OpenLayers.i18n("externalThesaurusURL"),id:"remote_thesaurusURL",name:"url",anchor:"-15"},{fieldLabel:OpenLayers.i18n("thesaurusFromRepository"),id:"remote_thesaurusCmb",anchor:"-15",xtype:"combo",mode:"local",triggerAction:"all",forceSelection:true,editable:false,displayField:"title",valueField:"link",submitValue:false,store:new GeoNetwork.data.ThesaurusFeedStore(),listeners:{scope:this,select:function(g,f,e){Ext.getCmp("remote_thesaurusURL").setValue(f.data.link);Ext.getCmp("remote_themeCmb").setValue(f.data.category);}}},this.createTypeCombo("remote_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"remote_thesaurusType",name:"type",value:"external",hidden:true,anchor:"-15"}]});return this.createThesaurusFromRemoteFileForm;},createTypeCombo:function(b){return new Ext.form.ComboBox({fieldLabel:OpenLayers.i18n("Theme"),id:b,name:"themeCmb",anchor:"-15",mode:"local",value:this.defaultThesaurusType,triggerAction:"all",forceSelection:true,editable:false,displayField:"name",valueField:"value",hiddenName:"dir",store:new Ext.data.JsonStore({fields:["name","value"],data:[{name:"Discipline",value:"discipline"},{name:"Place",value:"place"},{name:"Stratum",value:"stratum"},{name:"Temporal",value:"temporal"},{name:"Theme",value:"theme"}]})});},getKeyword:function(){return new GeoNetwork.form.SearchField({id:"keywordSearchField",width:240,store:this.keywordStore,paramName:"pKeyword"});},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:this.maxResults,width:40,listeners:{scope:this,change:function(g,e,f){this.keywordStore.baseParams.maxResults=e;}}};}});Ext.reg("gn_admin_thesaurusmanagerpanel",GeoNetwork.admin.ThesaurusManagerPanel);Ext.namespace("GeoNetwork");GeoNetwork.OGCServiceQuickRegister=Ext.extend(Ext.menu.Menu,{catalogue:undefined,harvesterStore:undefined,textInfo:undefined,textExample:"eg. http://services.sandre.eaufrance.fr/geo/ouvrage?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities",textValidButton:"Check & Add",urlFieldWidth:250,urlField:undefined,initComponent:function(){this.textInfo=OpenLayers.i18n("enterGetCapURL");var b=[];b.push({text:this.textInfo,canActivate:false});this.urlField={xtype:"textfield",width:this.urlFieldWidth,margins:"0 0 0 30",id:"OGCServiceQuickRegisterUrl",value:"",iconCls:"no-icon"};b.push(this.urlField);b.push({text:this.textExample,canActivate:false});b.push({xtype:"buttongroup",autoWidth:true,border:false,frame:false,columns:2,iconCls:"no-icon",defaults:{xtype:"button",iconAlign:"right"},items:[{text:this.textValidButton,iconCls:"md-mn md-mn-badd",handler:this.getCapabilities}]});Ext.apply(this,{defaultType:"menuitem",items:b});GeoNetwork.OGCServiceQuickRegister.superclass.initComponent.call(this);},getCapabilities:function(){var e=Ext.getCmp("OGCServiceQuickRegisterUrl").getValue();var d=this.ownerCt.ownerCt;OpenLayers.Request.GET({url:e,success:function(j){if(j.responseText.indexOf("Some unexpected")!==-1){Ext.Msg.alert("Failed to check service url.",j.responseText);return;}var h=j.responseXML;if(!h){Ext.Msg.alert("GetCapabilities failed","Null response returned - check proxy or service configuration.");return;}var a=new OpenLayers.Format.WMSCapabilities();var b=a.read(h);d.addHarvester(b.service.title,e,b.version);},failure:function(a){Ext.Msg.alert("Failed to check service url.",a.responseText);}});},addHarvester:function(l,o,j){var m=new Ext.data.Record({id:"",type:"ogcwxs",site_name:l,site_url:o.replace(/&/g,"&amp;"),site_ogctype:"WMS"+j,site_icon:"default.gif",site_account_use:"false",options_every:"90",options_topic:"",options_onerunonly:"true",options_lang:"en",options_createthumbnails:"true",options_uselayer:"true",options_uselayermd:"false"});var h=new GeoNetwork.Templates().getHarvesterTemplate();var q=h.apply(m.data);this.saveHarvester(q);},saveHarvester:function(f){var g=this;var e={url:this.catalogue.services.harvestingAdd,data:f};OpenLayers.Util.applyDefaults(e,{success:function(d){var b=d.responseXML;var a=b.firstChild.getAttribute("id");g.runHarvester(this.catalogue.services.harvestingRun,a);},failure:function(a){Ext.Msg.alert("Failed",a.responseText);}});OpenLayers.Request.POST(e);},runHarvester:function(f,g){var e=this;OpenLayers.Request.GET({url:f+"?id="+g,success:function(a){if(a.responseText.indexOf("nexpected")!==-1){Ext.Msg.alert("Activation or start failed.",a.responseText);return;}Ext.Msg.alert("Successfull registration","Wait a few minutes before having all layers and services registered in the catalogue.");if(e.harvesterStore){e.harvesterStore.reload();}},failure:function(a){Ext.Msg.alert("Registration failed",a.responseText);}});}});Ext.reg("gn_ogcservicequickregister",GeoNetwork.OGCServiceQuickRegister);Ext.namespace("GeoNetwork.map");GeoNetwork.map.ExtentMap=function(){var V=[];var ae=[];var ac=OpenLayers.Feature.Vector.style["default"];var U=null;var Y=null;var aa=null;var S=null;var T=null;var ab=5;var Q=OpenLayers.Class(OpenLayers.Geometry,{id:null,initialize:function(a){this.id=a;},CLASS_NAME:"GeoNetwork.map.ExtentMap.MultiPolygonReference"});var K=GeoNetwork.map.PROJECTION||"EPSG:4326";var aj="EPSG:4326";var O=new OpenLayers.Projection(aj);var J=null;var M="m";var ad=null;function P(e,d){var f=new OpenLayers.Projection(d);var b=(f===O?new OpenLayers.Format.GML.v3():new OpenLayers.Format.GML.v3({externalProjection:O,internalProjection:f}));var a=b.writeNode("feature:_geometry",e.geometry);return OpenLayers.Format.XML.prototype.write.call(b,a.firstChild);}function N(){var b,e={units:M,projection:K,theme:null},f=new OpenLayers.Map(e);if(!S){var a=f.getControlsByClass("OpenLayers.Control.Navigation")[0];a.disableZoomWheel();f.removeControl(f.getControlsByClass("OpenLayers.Control.PanZoom")[0]);}f.addControl(new OpenLayers.Control.MousePosition());for(b=0;b<GeoNetwork.map.BACKGROUND_LAYERS.length;b++){f.addLayer(GeoNetwork.map.BACKGROUND_LAYERS[b].clone());}var d=new OpenLayers.Layer.Vector("VectorLayer",{});f.addLayer(d);d.events.on({sketchstarted:function(){this.destroyFeatures();},scope:d});V[T]=f;ae[T]=d;return f;}function I(a,b,g,f){var e=b.split(","),d;for(d=0;d<e.length;++d){Ext.get(e[d]).on("change",function(){ag(f,b,g,false);});
Ext.get("_"+e[d]).on("change",function(){ag(f,b,g,true);});}}function ag(m,g,e,h){var j=m.getLayersByName("VectorLayer")[0];var o,d,a;var q=g.split(",");d=[];if(h){d[0]=Ext.get("_"+q[0]).getValue();d[1]=Ext.get("_"+q[1]).getValue();d[2]=Ext.get("_"+q[2]).getValue();d[3]=Ext.get("_"+q[3]).getValue();o=OpenLayers.Bounds.fromArray(d);a=o.clone();if(K!==O){a.transform(new OpenLayers.Projection(aj),new OpenLayers.Projection(K));}}else{d[0]=Ext.get(q[0]).getValue();d[1]=Ext.get(q[1]).getValue();d[2]=Ext.get(q[2]).getValue();d[3]=Ext.get(q[3]).getValue();o=OpenLayers.Bounds.fromArray(d);a=o.clone();var f=null;var l=document.getElementsByName("proj_"+e);for(i=0;i<l.length;i++){if(l[i].checked===true){f=l[i].value;}}if(f!==K){a.transform(new OpenLayers.Projection(f),new OpenLayers.Projection(K));}if(f!==aj){o.transform(new OpenLayers.Projection(f),new OpenLayers.Projection(aj));}Ext.get("_"+q[0]).dom.value=o.left;Ext.get("_"+q[1]).dom.value=o.bottom;Ext.get("_"+q[2]).dom.value=o.right;Ext.get("_"+q[3]).dom.value=o.top;}Ext.get(q[0]).dom.onkeyup();Ext.get(q[1]).dom.onkeyup();Ext.get(q[2]).dom.onkeyup();Ext.get(q[3]).dom.onkeyup();var b=new OpenLayers.Feature.Vector(a.toGeometry());j.destroyFeatures();j.addFeatures(b);L(V[e],ae[e]);Z(g,e);}function Z(a,h){function f(t,l,r){var s=t.split(",");var B=Ext.get("_"+s[0]).getValue();var w=Ext.get("_"+s[1]).getValue();var m=Ext.get("_"+s[2]).getValue();var q=Ext.get("_"+s[3]).getValue();var o=B!==""?B:"0";var j=w!==""?w:"0";var u=m!==""?m:"0";var z=q!==""?q:"0";var v=OpenLayers.Bounds.fromString(o+","+j+","+u+","+z);if(!l.equals(O)){v.transform(O,l);}if(B!==""){B=v.left.toFixed(r)+"";}Ext.get(s[0]).dom.value=B;if(w!==""){w=v.bottom.toFixed(r)+"";}Ext.get(s[1]).dom.value=w;if(m!==""){m=v.right.toFixed(r)+"";}Ext.get(s[2]).dom.value=m;if(q!==""){q=v.top.toFixed(r)+"";}Ext.get(s[3]).dom.value=q;}var d=Ext.DomQuery.select("input.proj"),e;for(e=0;e<d.length;++e){var b=d[e];if(b.id.indexOf(h)!==-1){if(b.checked){f(a,new OpenLayers.Projection(b.value),ab);}var g=Ext.get(b.id);g.on("click",function(){f(a,new OpenLayers.Projection(this.value),ab);},g.dom);}}}function ah(e){var a="WKT";var f,g;if(e!==null){a=e.format||"WKT";f=e.from;g=e.to;}var b=new OpenLayers.Format[a]();if(f!==null&&g!==null){b.internalProjection=f;b.externalProjection=g;}if(!this.vectorLayer.features.length){return null;}var d=this.vectorLayer.features[this.vectorLayer.features.length-1];return b.write(d);}function W(h,a,j,l){if(h===""){return false;}var d="WKT";var f,e;if(a!==null){d=a.format||"WKT";f=a.from;e=a.to;}var g=new OpenLayers.Format[d]();if(f!==null&&e!==null){g.externalProjection=f;g.internalProjection=e;}h=h.replace(/\n/g,"");var b=g.read(h);if(!b){return false;}if(b.length){b=b[0];}j.addFeatures(b);if(a.zoomToFeatures){L(l,j);}return true;}function af(f,d,h){var j=f.getLayersByName("VectorLayer")[0];var g;var e=d.split(",");var b=[];b[0]=Ext.get("_"+e[0]).getValue();b[1]=Ext.get("_"+e[1]).getValue();b[2]=Ext.get("_"+e[2]).getValue();b[3]=Ext.get("_"+e[3]).getValue();g=OpenLayers.Bounds.fromArray(b);g.transform(O,J);Ext.get(e[0]).dom.onkeyup();Ext.get(e[1]).dom.onkeyup();Ext.get(e[2]).dom.onkeyup();Ext.get(e[3]).dom.onkeyup();var a=new OpenLayers.Feature.Vector(g.toGeometry());j.destroyFeatures();j.addFeatures(a);L(f,j);Z(d,h);}function ai(d){var b=GeoNetwork.data.RegionStore(catalogue.services.getRegions);var a=new Ext.form.ComboBox({store:b,tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label[\''+OpenLayers.Lang.getCode()+"']]}</div></tpl>",typeAhead:true,mode:"local",triggerAction:"all",emptyText:OpenLayers.i18n("selectRegion"),selectOnFocus:true,width:135,listeners:{focus:{fn:function(e){e.getStore().load();}},select:{fn:d}},iconCls:"no-icon"});return a;}function L(f,d){var a=d.getDataExtent();if(a&&!isNaN(a.left)){var b=a.getWidth()/2;var e=a.getHeight()/2;a.left-=b;a.right+=b;a.bottom-=e;a.top+=e;f.zoomToExtent(a);}else{f.zoomToMaxExtent();}}return{init:function(){},initMapDiv:function(){var b,o,a,d,h;J=new OpenLayers.Projection(K);ad=J;b=Ext.DomQuery.select(".extentViewer");o=Ext.id;for(a=0;a<b.length;++a){var f=b[a];U=f.getAttribute("target_polygon");Y=f.getAttribute("watched_bbox");S=f.getAttribute("edit")==="true";T=f.getAttribute("elt_ref");d=f.getAttribute("desc_ref");aa=f.getAttribute("mode");var m=f.childNodes;var g=[];for(h=0;h<m.length;h++){if(m[h].nodeType===1){g.push(m[h]);}}m=g;if(m.length>1){continue;}var q;q=Ext.id(f);var r=N();if(S){var j,e=[];if(aa==="bbox"){j=new OpenLayers.Control.DrawFeature(ae[T],OpenLayers.Handler.RegularPolygon,{handlerOptions:{irregular:true,sides:4},featureAdded:function(v){var u=v.geometry.getBounds(),t;if(J!==O){t=u.clone().transform(J,O);}else{t=u;}var s=this.watchedBbox.split(",");Ext.get("_"+s[0]).dom.value=t.left;Ext.get("_"+s[1]).dom.value=t.bottom;Ext.get("_"+s[2]).dom.value=t.right;Ext.get("_"+s[3]).dom.value=t.top;Z(this.watchedBbox,this.eltRef);}.bind({watchedBbox:Y,eltRef:T})});e.push(new GeoExt.Action({map:V[T],control:j,text:OpenLayers.i18n("drawRectangle"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawRectangle"}));e.push(ai(function(u,t,v){var s=this.watchedBbox.split(",");Ext.get("_"+s[0]).dom.value=t.data.west;Ext.get("_"+s[1]).dom.value=t.data.south;Ext.get("_"+s[2]).dom.value=t.data.east;Ext.get("_"+s[3]).dom.value=t.data.north;af(V[T],Y,T,true);if(Ext.get("_"+this.descRef)!==null){Ext.get("_"+this.descRef).dom.value=t.data.label[OpenLayers.Lang.getCode()];}}.bind({extentMap:this,map:V[T],watchedBbox:Y,eltRef:T,descRef:d})));}else{if(aa==="polygon"){j=new OpenLayers.Control.DrawFeature(ae[T],OpenLayers.Handler.Polygon,{featureAdded:function(s){document.getElementById("_X"+this).value=P(s,K);}.bind(U)});e.push(new GeoExt.Action({map:V[T],control:j,text:OpenLayers.i18n("drawPolygon"),tooltip:OpenLayers.i18n("drawPolygonTT"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawPolygon"}));j=new OpenLayers.Control.DrawFeature(ae[T],OpenLayers.Handler.RegularPolygon,{handlerOptions:{irregular:true,sides:60},featureAdded:function(s){document.getElementById("_X"+this).value=P(s,K);}.bind(U)});e.push(new GeoExt.Action({map:V[T],control:j,text:OpenLayers.i18n("drawCircle"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawCircle"}));}}e.push({text:OpenLayers.i18n("clear"),iconCls:"clearPolygon",handler:function(){this.vectorLayer.destroyFeatures();var t=document.getElementById("_X"+this.targetPolygon);if(t!==null){t.value="";}if(this.targetBbox!==""){var s=this.targetBbox.split(",");Ext.get(s[0]).dom.value="";Ext.get(s[1]).dom.value="";Ext.get(s[2]).dom.value="";Ext.get(s[3]).dom.value="";Ext.get("_"+s[0]).dom.value="";Ext.get("_"+s[1]).dom.value="";Ext.get("_"+s[2]).dom.value="";Ext.get("_"+s[3]).dom.value="";$(s[0]).onkeyup();$(s[1]).onkeyup();$(s[2]).onkeyup();$(s[3]).onkeyup();}},scope:{vectorLayer:ae[T],targetPolygon:U,targetBbox:Y,eltRef:T}});}var l=new GeoExt.MapPanel({renderTo:q,height:300,width:400,map:V[T],tbar:(S?e:null)});if(m.length>0){W(m[0].innerHTML,{format:"WKT",zoomToFeatures:true,from:O,to:J},ae[T],V[T]);}if(Y!==""){Z(Y,T);I(ae[T],Y,T,V[T]);}}}};};GeoNetwork.map.ExtentMap.prev_geometry=OpenLayers.Format.GML.Base.prototype.writers.feature._geometry;OpenLayers.Format.GML.Base.prototype.writers.feature._geometry=function(g){if(g.CLASS_NAME==="GeoNetwork.map.ExtentMap.MultiPolygonReference"){var e=this.createElementNS(this.namespaces.gml,"gml:MultiPolygon");var f=this.createElementNS(this.namespaces.gml,"gml:MultiPolygon");f.setAttribute("gml:id",g.id);e.appendChild(f);return e;}else{return GeoNetwork.map.ExtentMap.prev_geometry.apply(this,arguments);}};if(!window.GeoNetwork){window.GeoNetwork={};}if(!GeoNetwork.Control){GeoNetwork.Control={};}GeoNetwork.Control.ZoomWheel=OpenLayers.Class(OpenLayers.Control,{wheelChange:OpenLayers.Control.Navigation.prototype.wheelChange,draw:function(){this.handler=new OpenLayers.Handler.MouseWheel(this,{up:OpenLayers.Control.Navigation.prototype.wheelUp,down:OpenLayers.Control.Navigation.prototype.wheelDown});
this.activate();},CLASS_NAME:"GeoNetwork.Control.ZoomWheel"});if(!window.GeoNetwork){window.GeoNetwork={};}if(!GeoNetwork.Control){GeoNetwork.Control={};}GeoNetwork.Control.ExtentBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,wktelement:null,minxelement:null,minyelement:null,maxxelement:null,maxyelement:null,EVENT_TYPES:["finishBox"],initialize:function(b){this.EVENT_TYPES=GeoNetwork.Control.ExtentBox.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.RegularPolygon(this,{create:this.startBox,done:this.endBox},{irregular:true});},setMap:function(b){OpenLayers.Control.prototype.setMap.apply(this,arguments);},startBox:function(){this.getOrCreateLayer();this.vectorLayer.destroyFeatures();},endBox:function(){var b=this.handler.feature.geometry.getBounds();this.updateFields(b);this.events.triggerEvent("finishBox",null);},updateFields:function(B){var u=new OpenLayers.Feature.Vector(B.toGeometry(),null,this.vectorLayerStyle);this.vectorLayer.addFeatures([u]);this.vectorLayer.refresh();var r=this.map.getProjectionObject();var w=new OpenLayers.Projection("WGS84");var z=new OpenLayers.LonLat(B.left,B.bottom).transform(r,w);var v=new OpenLayers.LonLat(B.right,B.top).transform(r,w);var o=z.lon.toFixed(4),q=z.lat.toFixed(4),s=v.lon.toFixed(4),t=v.lat.toFixed(4);if(this.wktelement){this.wktelement.setValue("POLYGON(("+o+" "+q+","+o+" "+t+","+s+" "+t+","+s+" "+q+","+o+" "+q+"))");}else{if(this.minxelement){this.minxelement.dom.value=o;}if(this.maxxelement){this.maxxelement.dom.value=s;}if(this.minyelement){this.minyelement.dom.value=q;}if(this.maxyelement){this.maxyelement.dom.value=t;}}},updateMap:function(){if((!this.minxelement)||(!this.maxxelement)||(!this.minyelement)||(!this.maxyelement)){return;}this.getOrCreateLayer();var m=this.map.getProjectionObject();var u=new OpenLayers.Projection("WGS84");var o=new OpenLayers.LonLat(this.map.getExtent().left,this.map.getExtent().bottom).transform(m,u);var s=new OpenLayers.LonLat(this.map.getExtent().right,this.map.getExtent().top).transform(m,u);var t=parseFloat(this.minxelement.dom.value);if(isNaN(t)){this.minxelement.dom.value=o.lon;}t=parseFloat(this.maxxelement.dom.value);if(isNaN(t)){this.maxxelement.dom.value=s.lon;}t=parseFloat(this.minyelement.dom.value);if(isNaN(t)){this.minyelement.dom.value=o.lat;}t=parseFloat(this.maxyelement.dom.value);if(isNaN(t)){this.maxyelement.dom.value=s.lat;}this.minxelement.dom.value=parseFloat(this.minxelement.dom.value).toFixed(4);this.maxxelement.dom.value=parseFloat(this.maxxelement.dom.value).toFixed(4);this.minyelement.dom.value=parseFloat(this.minyelement.dom.value).toFixed(4);this.maxyelement.dom.value=parseFloat(this.maxyelement.dom.value).toFixed(4);this.vectorLayer.destroyFeatures();var w=new OpenLayers.LonLat(this.minxelement.dom.value,this.minyelement.dom.value).transform(u,m);var r=new OpenLayers.LonLat(this.maxxelement.dom.value,this.maxyelement.dom.value).transform(u,m);var v=new OpenLayers.Bounds();v.extend(w);v.extend(r);var q=new OpenLayers.Feature.Vector(v.toGeometry(),null,this.vectorLayerStyle);this.vectorLayer.addFeatures([q]);this.vectorLayer.refresh();},getOrCreateLayer:function(){if(!this.vectorLayer){this.vectorLayer=this.vectorLayer||new OpenLayers.Layer.Vector("ExtentBox",{style:this.vectorLayerStyle});this.map.addLayer(this.vectorLayer);}this.map.setLayerIndex(this.vectorLayer,this.map.getNumLayers());return this.vectorLayer;},clear:function(){if(this.vectorLayer){this.vectorLayer.destroyFeatures();}},zoomTo:function(){var j=this.map.getProjectionObject();var g=new OpenLayers.Projection("WGS84");var l=new OpenLayers.LonLat(this.minxelement.dom.value,this.minyelement.dom.value).transform(g,j);var h=new OpenLayers.LonLat(this.maxxelement.dom.value,this.maxyelement.dom.value).transform(g,j);var m=new OpenLayers.Bounds();m.extend(l);m.extend(h);this.map.zoomToExtent(m);},CLASS_NAME:"GeoNetwork.Control.ExtentBox"});Ext.namespace("GeoNetwork","GeoNetwork.OGCUtil");GeoNetwork.OGCUtil.getProtocolVersion=function(){return"1.3.0";};GeoNetwork.OGCUtil.getLanguage=function(){return GeoNetwork.Util.getISO3LangCode(catalogue.lang);};GeoNetwork.OGCUtil.ensureProperUrlEnd=function(a){if(a.indexOf("?")==-1){a+="?";}else{var b=a.substring(a.length-1);if(b!="&"&&b!="?"){a+="&";}}return a;};GeoNetwork.OGCUtil.reprojectMap=function(b,d,g){if(b.projection!=d.projCode){b.baseLayer.options.scales=b.scales;var m=b.getProjectionObject();b.projection=d.projCode;if(d.getUnits()===null){b.units="degrees";}else{b.units=d.getUnits();}var f=null;if(b.getControlsByClass("GeoNetwork.Control.CursorPos").length>0){f=b.getControlsByClass("GeoNetwork.Control.CursorPos")[0];}if(b.units=="m"&&f!==null){f.numdigits=0;}else{if(b.units=="degrees"&&f!==null){f.numdigits=4;}}b.maxExtent=b.maxExtent.transform(m,d);b.baseLayer.extent=b.maxExtent;var a=b.getExtent().transform(m,d);for(var h=0;h<b.layers.length;h++){var l=b.layers[h];l.units=b.units;l.projection=d;l.maxExtent=b.maxExtent;if(l.isBaseLayer){l.initResolutions();}else{l.resolutions=b.baseLayer.resolutions;l.minResolution=b.baseLayer.minResolution;l.maxResolution=b.baseLayer.maxResolution;}if(l instanceof OpenLayers.Layer.Vector){for(var e=0;e<l.features.length;e++){var o=l.features[e];if(o.geometry.projection!=b.projection){o.geometry.transform(new OpenLayers.Projection(o.geometry.projection),b.getProjectionObject());o.geometry.projection=b.projection;}}}}if(!g){b.zoomToExtent(a);}}};GeoNetwork.OGCUtil.layerExistsInMap=function(f,l){var g=false;for(var d=0,a=l.layers.length;d<a;d++){if(l.layers){var b=l.layers[d];if(b.params){try{var j=b.params.LAYERS.split(",");if((j.indexOf(f.params.LAYERS)!=-1)&&b.params.SERVICE==f.params.SERVICE&&b.url==f.url){g=b;break;}}catch(h){}}}}return g;};Ext.namespace("GeoNetwork","GeoNetwork.CatalogueInterface");GeoNetwork.CatalogueInterface=function(){var g;var a;var f;var e=function(j){g=j;};var h=function(j,t,o){var u=null;for(var l=0,r=t.length;l<r;++l){var m=t[l];try{var q=m.name.split(",");if(q.indexOf(o.params.LAYERS)!=-1){u=m;break;}}catch(s){}if(typeof(m.nestedLayers)!="undefined"){u=h(j,m.nestedLayers,o);if(u!==null){break;}}}return u;};var b=function(t){a.hide();var l=new OpenLayers.Format.WMSCapabilities();var s=l.read(t.responseXML||t.responseText);if(s.capability){var r=s.service.accessContraints;if((r)&&(r.toLowerCase()!="none")&&(r!="-")){var m=new GeoNetwork.DisclaimerWindow({disclaimer:r});m.show();m=null;}if(g){for(var v=0,z=f.length;v<z;v++){var o=f[v][0];var j=f[v][1];var w=f[v][2];var q=f[v][3];var u=new OpenLayers.Layer.WMS(o,j,{layers:w,format:"image/png",transparent:"TRUE",version:s.version,language:GeoNetwork.OGCUtil.getLanguage()},{queryable:true,singleTile:true,ratio:1,buffer:0,transitionEffect:"resize",metadata_id:q});if(!GeoNetwork.OGCUtil.layerExistsInMap(u,g)){u.events.on({loadstart:function(){this.isLoading=true;}});u.events.on({loadend:function(){this.isLoading=false;}});var B=h(s,s.capability.layers,u);if(B){u.queryable=B.queryable;u.name=B.title||u.name;u.llbbox=B.llbbox;u.styles=B.styles;u.dimensions=B.dimensions;}g.addLayer(u);}}}}};var d=function(j){a.hide();Ext.MessageBox.alert(OpenLayers.i18n("loadLayer.error.title"),OpenLayers.i18n("loadLayer.error.message"));};return{init:function(j){e(j);},addLayers:function(o){if(o.length===0){return;}var l=o[0][1];if(o[0][2]===""){GeoNetwork.WindowManager.showWindow("addwms");var j=Ext.getCmp(GeoNetwork.WindowManager.getWindow("addwms").browserPanel.id);j.setURL(l);return;}a=new Ext.LoadMask(g.div,{msg:OpenLayers.Lang.translate("loadLayer.loadingMessage")});a.show();f=o;var s={service:"WMS",request:"GetCapabilities",version:GeoNetwork.OGCUtil.getProtocolVersion(),language:GeoNetwork.OGCUtil.getLanguage()};var r=OpenLayers.Util.getParameterString(s);var q=(l.indexOf("?")>-1)?"&":"?";l+=q+r;var m=Ext.Ajax.request({url:l,method:"GET",success:b,failure:d,timeout:10000});}};};GeoNetwork.CatalogueInterface=new GeoNetwork.CatalogueInterface();
Ext.namespace("GeoNetwork","GeoNetwork.WMC");GeoNetwork.WMC=function(){return{loadWmc:function(g,a){try{var f=g.layers;for(var b=f.length-1;b>0;b--){if(!f[b].isBaseLayer){g.removeLayer(f[b]);}}Ext.getCmp("toctree").getSelectionModel().clearSelections();var e=new OpenLayers.Format.WMC({layerOptions:{buffer:0}});g=e.read(a,{map:g});}catch(d){Ext.MessageBox.alert(OpenLayers.i18n("selectWMCFile.errorLoadingWMC"));}},mergeWmc:function(e,a){try{var d=new OpenLayers.Format.WMC({layerOptions:{buffer:0}});e=d.read(a,{map:e});}catch(b){Ext.MessageBox.alert(OpenLayers.i18n("selectWMCFile.errorLoadingWMC"));}},saveContext:function(b){var a=new OpenLayers.Format.WMC();OpenLayers.Request.POST({url:"../../wmc/create.wmc",data:a.write(b),success:this.onSaveContextSuccess,failure:this.onSaveContextFailure});},onSaveContextSuccess:function(a){var b=a.responseText;var d=Ext.decode(b);if(d.success){window.location=d.url;}else{this.onSaveContextFailure();}},onSaveContextFailure:function(a,b){Ext.MessageBox.show({icon:Ext.MessageBox.ERROR,title:OpenLayers.i18n("saveWMCFile.windowTitle"),msg:OpenLayers.i18n("saveWMCFile.errorSaveWMC"),buttons:Ext.MessageBox.OK});}};};GeoNetwork.WMCManager=new GeoNetwork.WMC();Ext.namespace("GeoNetwork","GeoNetwork.tree");GeoNetwork.tree.WMSListGenerator=function(a){Ext.apply(this,a);if(this.node&&this.wmsStore){this.createWMSList();}};GeoNetwork.tree.WMSListGenerator.prototype={node:null,wmsStore:null,click:null,scope:null,createWMSList:function(){this.wmsStore.each(this.appendRecord,this);},appendRecord:function(a){var b=new Ext.tree.TreeNode({url:a.get("url"),text:a.get("title"),cls:"folder",leaf:false});b.appendChild(new Ext.tree.TreeNode({text:"",dummy:true}));b.addListener("beforeexpand",this.addNodesFromWMS,this);this.node.appendChild(b);},replaceNode:function(a){this.currentNode.parentNode.replaceChild(a,this.currentNode);a.ui.afterLoad();a.expand();},addNodesFromWMS:function(b){if(b.firstChild&&b.firstChild.attributes.dummy){b.removeChild(b.firstChild);b.ui.beforeLoad();this.scope.currentNode=b;var a=new GeoNetwork.tree.WMSTreeGenerator({click:this.click,callback:this.replaceNode,scope:this.scope});a.loadWMS(b.attributes.url);}}};Ext.namespace("GeoNetwork","GeoNetwork.tree");GeoNetwork.tree.WMSTreeGenerator=function(a){Ext.apply(this,a);};GeoNetwork.tree.WMSTreeGenerator.prototype={layerParams:{format:"image/png",transparent:"TRUE"},layerOptions:{ratio:1,singleTile:true,isBaseLayer:false},click:null,callback:null,scope:null,loadWMS:function(l){var h=(l.indexOf("version=")>-1);var m=l.toLowerCase();var h=(m.indexOf("version=")>-1);var g=(m.indexOf("service=wms")>-1);var e=(m.indexOf("request=getcapabilities")>-1);var f=(m.indexOf("language=")>-1);var b={};if(!h){b.version=GeoNetwork.OGCUtil.getProtocolVersion();}if(!g){b.service="WMS";}if(!e){b.request="GetCapabilities";}if(!f){b.language=GeoNetwork.OGCUtil.getLanguage();}var a=OpenLayers.Util.getParameterString(b);var d=(l.indexOf("?")>-1)?"&":"?";l+=d+a;var j=Ext.Ajax.request({url:l,method:"GET",failure:this.processFailure,success:this.processSuccess,disableCaching:false,scope:this});},processSuccess:function(b){if(!this.parser){this.parser=new OpenLayers.Format.WMSCapabilities();}var g=this.parser.read(b.responseXML||b.responseText);this.layerParams.VERSION=g.version;var f;if(g.capability){for(var e=0,a=g.capability.nestedLayers.length;e<a;++e){var d=g.capability.nestedLayers[e];f=this.addLayer(d,g.capability.request.getmap.href,null);this.processLayer(d,g.capability.request.getmap.href,f);}}Ext.callback(this.callback,this.scope,[f,g]);},processFailure:function(a){Ext.callback(this.callback,this.scope,null);},createWMSLayer:function(b,a){return new OpenLayers.Layer.WMS(b.title,a,OpenLayers.Util.extend({layers:b.name,language:GeoNetwork.OGCUtil.getLanguage()},this.layerParams),OpenLayers.Util.extend({minScale:b.minScale,queryable:b.queryable,maxScale:b.maxScale,metadataURL:b.metadataURL,dimensions:b.dimensions,styles:b.styles,llbbox:b.llbbox},this.layerOptions));},addLayer:function(d,b,a){var g=null;if(d.name){g=this.createWMSLayer(d,b);if(d.styles&&d.styles.length>0){var e=d.styles[0];if(e.legend&&e.legend.href){g.legendURL=e.legend.href;}}}var f=new Ext.tree.TreeNode({wmsLayer:g,text:d.title});f.addListener("click",this.click,this.scope);if(a){a.appendChild(f);}return f;},processLayer:function(b,a,d){Ext.each(b.nestedLayers,function(f){var e=this.addLayer(f,a,d);if(f.nestedLayers){this.processLayer(f,a,e);}},this);}};Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.BrowserPanel=function(a){Ext.apply(this,a);GeoNetwork.wms.BrowserPanel.superclass.constructor.call(this);};GeoNetwork.wms.BrowserPanel.ADDWMS=0;GeoNetwork.wms.BrowserPanel.WMSLIST=1;Ext.extend(GeoNetwork.wms.BrowserPanel,Ext.Panel,{previewPanel:null,treePanel:null,map:null,previewCenterPoint:null,mode:GeoNetwork.wms.BrowserPanel.WMSLIST,wmsStore:null,urlField:null,searchResultsGrid:null,searchField:null,parseBt:null,typeRadio:null,defaultConfig:{border:false,frame:false,layout:"border"},initComponent:function(e){Ext.apply(this,e);Ext.applyIf(this,this.defaultConfig);GeoNetwork.wms.BrowserPanel.superclass.initComponent.call(this);this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,previewCenterPoint:this.previewCenterPoint});var d;this.treePanel=new Ext.tree.TreePanel({rootVisible:false,autoScroll:true,autoHeight:true});d=new Ext.tree.TreeNode({text:"",draggable:false,cls:"folder"});this.treePanel.setRootNode(d);var b=[];if(this.mode==GeoNetwork.wms.BrowserPanel.ADDWMS){this.createForm();b.push(this.form);}b.push(this.treePanel);var a={autoScroll:true,region:"center",items:b,split:true,width:300,minWidth:300,border:false};var f={region:"east",border:false,items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};this.add(a);this.add(f);if(this.mode==GeoNetwork.wms.BrowserPanel.WMSLIST){this.treeGen=new GeoNetwork.tree.WMSListGenerator({click:this.nodeClick,scope:this,node:this.treePanel.getRootNode(),wmsStore:this.wmsStore});}else{if(this.mode==GeoNetwork.wms.BrowserPanel.ADDWMS){new GeoNetwork.tree.WMSListGenerator({click:this.nodeClick,scope:this,node:this.treePanel.getRootNode(),wmsStore:this.wmsStore});this.treeGen=new GeoNetwork.tree.WMSTreeGenerator({click:this.nodeClick,callback:this.showTree,scope:this});}}this.addButton({text:OpenLayers.i18n("WMSBrowserAddButton"),iconCls:"addLayerIcon",width:150},this.addLayerToMap,this);this.doLayout();},createForm:function(){this.form=new Ext.form.FormPanel({labelWidth:15,id:"serviceSearchForm"});this.typeRadio=new Ext.form.RadioGroup({items:[{name:"addWmsType",fieldLabel:"Search WMS",labelSeparator:"",inputValue:0,checked:true},{name:"addWmsType",labelSeparator:"",fieldLabel:" or add by URL",inputValue:1}],listeners:{change:function(f,h){var g=(h.getGroupValue()=="0");this.urlField.setVisible(!g);this.searchField.setVisible(g);this.searchResultsGrid.setVisible(g);},scope:this}});this.form.add(this.typeRadio);this.urlField=new Ext.form.TextField({name:"wmsurl",hideLabel:true,hidden:true,emptyText:"WMS server URL ...",width:250,autoHeight:true});this.form.add(this.urlField);var e=GeoNetwork.data.MetadataResultsStore();var a=GeoNetwork.data.MetadataSummaryStore();this.searchField=new GeoNetwork.form.SearchField({name:"E_any",hideLabel:true,width:250,minWidth:250,store:e,triggerAction:function(f){f.search("serviceSearchForm",null,null,1,true,e,a);},scope:catalogue});var d=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:""});this.searchResultsGrid=new Ext.grid.GridPanel({layout:"fit",height:80,border:false,store:e,columns:[d,{id:"title",header:"Title",dataIndex:"title"}],sm:d,autoExpandColumn:"title",listeners:{rowclick:function(f,j,h){var g=f.getStore().getAt(j).data;this.setValue(g.links[0].href);},scope:this.urlField}});var b=new Ext.form.TextField({inputType:"hidden",name:"E_serviceType",value:"OGC:WMS"});this.form.add(this.searchField,b,this.searchResultsGrid);this.parseBt=new Ext.Button({id:"parse",text:OpenLayers.i18n("WMSBrowserConnectButton"),iconCls:"connectIcon",width:150});
this.form.addButton(this.parseBt,this.getWMSCaps,this);},showTree:function(d,b){if(!d){Ext.MessageBox.alert(OpenLayers.i18n("errorTitle"),OpenLayers.i18n("WMSBrowserConnectError"));this.body.dom.style.cursor="default";}var e=b.service.accessContraints;if((e)&&(e.toLowerCase()!="none")&&(e!="-")){var f=new GeoNetwork.DisclaimerWindow({disclaimer:e});f.show();f=null;}var a=this.treePanel.getRootNode();if(d){this.treePanel.getRootNode().appendChild(d);}this.treePanel.show();this.body.dom.style.cursor="default";},getWMSCaps:function(b){var a=this.urlField.getValue();a=a.replace(/^\s+|\s+$/g,"");if(a!=""){this.body.dom.style.cursor="wait";this.treeGen.loadWMS(a);}},setURL:function(a){var a=this.urlField.setValue(a);this.typeRadio.setValue(1);this.getWMSCaps(this.parseBt);},nodeClick:function(a){this.previewPanel.showPreview(a.attributes.wmsLayer);},addLayerToMap:function(){if(this.previewPanel.currentLayer){var a=GeoNetwork.OGCUtil.layerExistsInMap(this.previewPanel.currentLayer,this.map);if(!a){this.previewPanel.currentLayer.events.on({loadstart:function(){this.isLoading=true;}});this.previewPanel.currentLayer.events.on({loadend:function(){this.isLoading=false;}});this.map.addLayers([this.previewPanel.currentLayer]);}else{Ext.MessageBox.alert(OpenLayers.i18n("infoTitle"),OpenLayers.i18n("WMSBrowserDuplicateMsg"));}}}});Ext.reg("gn_wmsbrowserpanel",GeoNetwork.wms.BrowserPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.LayerInfoPanel=function(a){Ext.apply(this,a);GeoNetwork.wms.LayerInfoPanel.superclass.constructor.call(this);};Ext.extend(GeoNetwork.wms.LayerInfoPanel,Ext.Panel,{previewPanel:null,map:null,previewCenterPoint:null,onlineresource:null,layer:null,initComponent:function(){GeoNetwork.wms.LayerInfoPanel.superclass.initComponent.call(this);this.layout="border";this.border=false;this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,previewCenterPoint:this.previewCenterPoint});this.store=new Ext.data.SimpleStore({reader:new Ext.data.ArrayReader({},[{name:"title",type:"string"},{name:"field",type:"string"}]),fields:["title","field"]});this.gridPanel=new Ext.grid.GridPanel({title:"",store:this.store,autoScroll:true,hideHeaders:false,columns:[]});this.layerInfo=new GeoNetwork.wms.WMSLayerInfo({callback:this._showLayerInfo,scope:this});var a={region:"center",layout:"fit",items:[this.gridPanel],split:true,width:300,minWidth:300};var b={region:"east",items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};this.add(a);this.add(b);this.doLayout();},showLayerInfo:function(){this.previewPanel.showPreview(this.layer);this.layerInfo.loadWMS(this.onlineresource,this.layer);},_showLayerInfo:function(a){if(!a){Ext.MessageBox.alert(OpenLayers.i18n("errorTitle"),OpenLayers.i18n("WMSBrowserConnectError"));this.body.dom.style.cursor="default";}else{var b=[[OpenLayers.i18n("layerInfoPanel.titleField"),a.title||a.name],[OpenLayers.i18n("layerInfoPanel.descriptionField"),a.description],[OpenLayers.i18n("layerInfoPanel.queryableField"),a.queryable]];this.gridPanel.reconfigure(this.store,new Ext.grid.ColumnModel([{header:"Field",dataIndex:"title",sortable:true},{id:"value",header:"Value",dataIndex:"field",sortable:true}]));this.gridPanel.autoExpandColumn="value";this.gridPanel.getStore().loadData(b);}this.body.dom.style.cursor="default";}});Ext.reg("gn_infolayerpanel",GeoNetwork.wms.LayerInfoPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.LayerStylesPanel=function(a){Ext.apply(this,a);GeoNetwork.wms.LayerStylesPanel.superclass.constructor.call(this);};Ext.extend(GeoNetwork.wms.LayerStylesPanel,Ext.Panel,{previewPanel:null,map:null,layer:null,selectedStyle:null,initComponent:function(){GeoNetwork.wms.LayerStylesPanel.superclass.initComponent.call(this);this.layout="border";this.border=false;this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,title:OpenLayers.i18n("layerStylesPreviewTitle")});this.store=new Ext.data.SimpleStore({reader:new Ext.data.ArrayReader({},[{name:"name",type:"string"},{name:"title",type:"string"},{name:"legendUrl",type:"string"}]),fields:["name","title","legendUrl"]});this.gridPanel=new Ext.grid.GridPanel({title:"",border:false,autoScroll:true,store:this.store,hideHeaders:false,columns:[{header:"Style",width:120,dataIndex:"name",sortable:false},{id:"description",header:"Description",width:180,dataIndex:"title",sortable:false}],autoExpandColumn:"description"});this.gridPanel.on("rowclick",this._selectStyle,this);var a={region:"center",layout:"fit",items:[this.gridPanel],split:true,width:300,minWidth:300};var b={region:"east",items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};this.add(a);this.add(b);this.doLayout();},showLayerStyles:function(d){var f=[];for(var b=0;b<d.styles.length;b++){var a="";if(d.styles[b].legend){a=d.styles[b].legend.href;}var e=[d.styles[b].name,d.styles[b].title,a];f.push(e);}this.gridPanel.getStore().loadData(f);},_selectStyle:function(b,h,d){var f=b.store.getAt(h);this.selectedStyle=f.get("name");b.getView().focusEl.focus();var a=f.get("legendUrl");if(a==""){return;}a=unescape(a);this.selectedStyleLegendUrl=a;var g=f.get("legendUrl")+"&style="+this.selectedStyle;this.previewPanel.showPreviewLegend(unescape(g));}});Ext.reg("gn_layerstylespanel",GeoNetwork.wms.LayerStylesPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.PreviewPanel=function(a){Ext.apply(this,a);GeoNetwork.wms.PreviewPanel.superclass.constructor.call(this);};Ext.extend(GeoNetwork.wms.PreviewPanel,Ext.Panel,{title:OpenLayers.i18n("WMSBrowserPreviewTitle"),baseCls:"x-plain",cls:"x-panel-title-variant1",imgCls:"preview-image",width:250,height:250,currentLayer:null,initComponent:function(){GeoNetwork.wms.PreviewPanel.superclass.initComponent.call(this);this.image=new Ext.BoxComponent({autoEl:{tag:"img","class":this.imgCls,src:Ext.BLANK_IMAGE_URL,width:this.width,height:this.height}});this.add(this.image);},hideMask:function(){if(this.mask){this.mask.hide();}},showMask:function(){if(!this.mask){this.mask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("WMSBrowserPreviewWaitMsg")});Ext.EventManager.addListener(this.image.getEl(),"load",this.hideMask,this);Ext.EventManager.addListener(this.image.getEl(),"error",this.hideMask,this);}this.mask.show();},calculateBBOX:function(g){var m;var o=(parseFloat(g.params.VERSION)>=1.3);if(g.llbbox){if(this.map.getProjection()!=="EPSG:4326"){var b=OpenLayers.Bounds.fromArray(g.llbbox);b=b.transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());m=b.toArray(o);}else{var b=OpenLayers.Bounds.fromArray(g.llbbox);m=b.toArray(o);}}else{m=this.map.maxExtent.toArray(o);}var a=OpenLayers.Bounds.fromArray(m).getCenterLonLat();if(g.minScale>0){var d;if(g.maxScale>0){d=(parseFloat(g.maxScale)+parseFloat(g.minScale))/2;}else{d=0.9*parseFloat(g.minScale);}var h=OpenLayers.Util.getResolutionFromScale(d,this.map.units);var f=Math.round(h*this.width);var e=Math.round(h*this.height);var l=a.lon;var j=a.lat;if(f!==0&&e!==0){if(o){m=[j-0.5*e,l-0.5*f,j+0.5*e,l+0.5*f];}else{m=[l-0.5*f,j-0.5*e,l+0.5*f,j+0.5*e];}}}return m.join(",");},showPreview:function(b){if(!b){return;}this.showMask();var d=b.map;if(d===null){b.map=this.map;}var a=b.getFullRequestString({BBOX:this.calculateBBOX(b),WIDTH:this.width,HEIGHT:this.height});if(d===null){b.map=d;}this.currentLayer=b;this.image.getEl().dom.src=a;},showPreviewLegend:function(a){this.remove(this.image);this.image=null;this.image=new Ext.BoxComponent({autoEl:{tag:"img","class":this.imgCls,src:a}});this.add(this.image);this.doLayout();}});Ext.reg("gn_wmspreview",GeoNetwork.wms.PreviewPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");GeoNetwork.wms.WMSLayerInfo=function(a){Ext.apply(this,a);};GeoNetwork.wms.WMSLayerInfo.prototype={layerParams:{format:"image/png",transparent:"TRUE"},layerOptions:{ratio:1,singleTile:true,isBaseLayer:false},callback:null,scope:null,layer:null,loadWMS:function(m,f){this.layer=f;var o=m.toLowerCase();
var j=(o.indexOf("version=")>-1);var h=(o.indexOf("service=wms")>-1);var e=(o.indexOf("request=getcapabilities")>-1);var g=(o.indexOf("language=")>-1);var b={};if(!j){b.version=GeoNetwork.OGCUtil.getProtocolVersion();}if(!h){b.service="WMS";}if(!e){b.request="GetCapabilities";}if(!g){b.language=GeoNetwork.OGCUtil.getLanguage();}var a=OpenLayers.Util.getParameterString(b);var d=(m.indexOf("?")>-1)?"&":"?";m+=d+a;var l=Ext.Ajax.request({url:m,method:"GET",failure:this.processFailure,success:this.processSuccess,timeout:10000,scope:this});},processSuccess:function(a){if(!this.parser){this.parser=new OpenLayers.Format.WMSCapabilities();}var d=this.parser.read(a.responseXML||a.responseText);var b;if(d.capability){b=this.processLayers(d,d.capability.nestedLayers);}Ext.callback(this.callback,this.scope,[b,this.layer]);},processFailure:function(a){Ext.callback(this.callback,this.scope,[null,this.layer]);},createWMSLayer:function(b,a){return new OpenLayers.Layer.WMS(b.title,a,OpenLayers.Util.extend({layers:b.name},this.layerParams),OpenLayers.Util.extend({minScale:b.minScale,queryable:b.queryable,maxScale:b.maxScale,description:b.abstrack,metadataURL:b.metadataURL,llbbox:b.llbbox},this.layerOptions));},processLayers:function(h,l){var f=null;for(var g=0,a=l.length;g<a;++g){var b=l[g];try{var d=b.name.split(",");if(d.indexOf(this.layer.params.LAYERS)!=-1){f=this.createWMSLayer(b,h.service.href);break;}}catch(j){}if(typeof(b.nestedLayers)!="undefined"){f=this.processLayers(h,b.nestedLayers);if(f!=null){break;}}}return f;}};Ext.namespace("GeoNetwork");GeoNetwork.FeatureInfoPanel=function(a){Ext.apply(this,a);GeoNetwork.FeatureInfoPanel.superclass.constructor.call(this);};Ext.extend(GeoNetwork.FeatureInfoPanel,Ext.Panel,{features:null,treePanel:null,infoPanel:null,initComponent:function(){GeoNetwork.FeatureInfoPanel.superclass.initComponent.call(this);this.layout="border";this.treePanel=new Ext.tree.TreePanel({rootVisible:true,autoScroll:true});var b=new Ext.tree.TreeNode({text:OpenLayers.i18n("featureInfoTitle"),draggable:false,expanded:true,cls:"folder"});this.treePanel.setRootNode(b);var a={region:"center",items:[this.treePanel],split:true,minWidth:100};this.infoPanel=new Ext.Panel();this.infoPanel.on("render",function(){if(this.features){this.showFeatures(this.features);}},this);var d={region:"east",items:[this.infoPanel],split:true,plain:true,cls:"popup-variant1",width:400,autoScroll:true};this.add(a);this.add(d);this.doLayout();},setMap:function(a){this.map=a;},featureToHTML:function(e){var b='<table class="olFeatureInfoTable" cellspacing="1" cellpadding="1"><tbody>';for(var a in e.attributes){if(a){b+='<tr class="olFeatureInfoRow"><td width="50%" class="olFeatureInfoColumn">'+a+'</td><td width="50%" class="olFeatureInfoValue">'+e.attributes[a]+"</td></tr>";}}b+="</tbody></table>";var d=new Ext.XTemplate(b);d.overwrite(this.infoPanel.body,e);},click:function(f){if(f.attributes.features.length===0){var e='<table class="olFeatureInfoTable" cellpadding="1" cellspacing="1"><tbody>';e+='<tr class="olFeatureInfoRow"><td colspan="2" class="olFeatureInfoValue">'+OpenLayers.i18n("FeatureInfoNoInfo")+"</td></tr>";e+="</tbody></table>";Ext.DomHelper.overwrite(this.infoPanel.body,e);}for(var d=0,a=f.attributes.features.length;d<a;d++){var b=f.attributes.features[d];this.featureToHTML(b);}},clearInfoPanel:function(){if(this.infoPanel.body){Ext.DomHelper.overwrite(this.infoPanel.body,"");}},getLayerTitle:function(d){if(d==null){return"&nbsp";}var e=this.map.getLayersByClass("OpenLayers.Layer.WMS");for(var b=0,a=e.length;b<a;b++){if(e[b].params.LAYERS instanceof Array){if(OpenLayers.Util.indexOf(e[b].params.LAYERS,d)!==-1){return e[b].name;}}else{if(e[b].params.LAYERS.indexOf(d)!==-1){return e[b].name;}}}},showFeatures:function(f){this.clearInfoPanel();var b=this.treePanel.getRootNode();while(b.firstChild){b.removeChild(b.firstChild);}var e,a,l=[];for(e=0,a=f.length;e<a;e++){var h=false;for(var d=0;d<l.length;d++){if(l[d].title===f[e].type){l[d].features.push(f[e]);h=true;}}if(h===false){l.push({title:this.getLayerTitle(f[e].type),features:[f[e]]});}}for(e=0,a=l.length;e<a;e++){var g=new Ext.tree.TreeNode({text:l[e].title,features:l[e].features});g.addListener("click",this.click,this);b.appendChild(g);if(e===0){b.expand();this.click(g);this.treePanel.getSelectionModel().select(g);}}b.expand();}});Ext.reg("gn_featureinfo",GeoNetwork.FeatureInfoPanel);Ext.namespace("GeoNetwork");GeoNetwork.LegendPanel=Ext.extend(GeoExt.LegendPanel,{initComponent:function(){GeoNetwork.LegendPanel.superclass.initComponent.call(this);},onStoreAdd:function(e,d,f){GeoNetwork.LegendPanel.superclass.onStoreAdd.apply(this,arguments);for(var g=0,a=d.length;g<a;g++){var b=d[g];if(b.get("layer").legendURL!==undefined){b.set("legendURL",b.get("layer").legendURL);}}}});Ext.reg("gn_legendpanel",GeoNetwork.LegendPanel);Ext.namespace("GeoNetwork");GeoNetwork.ProjectionSelector=function(a){Ext.apply(this,a);GeoNetwork.ProjectionSelector.superclass.constructor.call(this);};Ext.extend(GeoNetwork.ProjectionSelector,Ext.form.ComboBox,{projections:null,initComponent:function(){GeoNetwork.ProjectionSelector.superclass.initComponent.call(this);this.on("select",this.reproject,this);this.valueField="value";this.autoWidth=true;this.autoHeight=true;this.displayField="text";this.triggerAction="all";this.mode="local";this.store=new Ext.data.Store({reader:new Ext.data.ArrayReader({},[{name:"value"},{name:"text"}]),data:this.projections});this.value=this.map.getProjection();},reproject:function(b,a){GeoNetwork.OGCUtil.reprojectMap(this.map,new OpenLayers.Projection(a.get("value")),false);}});Ext.reg("gn_projectionselector",GeoNetwork.ProjectionSelector);Ext.namespace("GeoNetwork");GeoNetwork.TimeSelector=function(a){Ext.apply(this,a);GeoNetwork.TimeSelector.superclass.constructor.call(this);};Ext.extend(GeoNetwork.TimeSelector,Ext.form.FormPanel,{layer:null,numberOfSteps:12,border:false,originalFormat:null,initComponent:function(){this.buttons=[new Ext.Button({text:OpenLayers.i18n("wmsTimeUpdateButtonText"),handler:this.updateValue,scope:this})];GeoNetwork.TimeSelector.superclass.initComponent.call(this);},beforeDestroy:function(){this.updateValue();GeoNetwork.TimeSelector.superclass.beforeDestroy.call(this);},setLayer:function(a){this.layer=a;this.originalFormat=this.layer.params.FORMAT||this.layer.params.format;if(this.layer.dimensions&&this.layer.dimensions.time){this.add(new Ext.form.Label({text:OpenLayers.i18n("WMSTimePositionTitle")}));this.add(new Ext.BoxComponent({height:10}));this.add(this.createDateTimeField());if(this.layer.dimensions.time.multipleVal){this.add(new Ext.BoxComponent({height:25}));this.add(new Ext.form.Label({text:OpenLayers.i18n("WMSTimeMovieTitle")}));this.add(new Ext.BoxComponent({height:10}));this.add({xtype:"checkbox",listeners:{check:{fn:this.playMovie,scope:this}},hideLabel:true,boxLabel:OpenLayers.i18n("WMSTimeAnimationCheckbox",{steps:this.numberOfSteps})});}this.doLayout();}},getInterval:function(a){return parseInt(a.substring(a.indexOf("PT")+2,a.indexOf("M")));},playMovie:function(e,h){if(h){var d,g,b;if(this.layer.dimensions.time.values&&this.layer.dimensions.time.values.length>0){var f=this.layer.dimensions.time.values[0].split("/");d=f[1];g=this.getInterval(f[2]);var j=Date.parseDate(d,"c");j=j-(1000*60*g*this.numberOfSteps);j=new Date(j);b=this.formatTimeAsUTC(j)+"/"+d;}this.layer.mergeNewParams({TIME:b,FORMAT:"image/gif"});}else{this.updateValue();}},formatTimeAsUTC:function(a){var b=a.dateFormat("c");var d=""+a.getUTCHours();if(d.length<2){d="0"+d;}b=b.replace(b.substring(b.indexOf("T"),b.indexOf("T")+3),"T"+d);b=b.replace(b.substring(b.indexOf("+"),b.indexOf("+")+6),"Z");return b;},updateValue:function(){this.layer.mergeNewParams({TIME:this.formatTimeAsUTC(this.getForm().findField("current").getValue()),FORMAT:this.originalFormat});},createDateTimeField:function(){var e,a,d;if(this.layer.dimensions.time.values&&this.layer.dimensions.time.values.length>0){var b=this.layer.dimensions.time.values[0].split("/");
e=b[0];a=b[1];d=this.getInterval(b[2]);}return new Ext.ux.form.DateTime({hiddenFormat:"c",dateFormat:null,hideLabel:true,name:"current",dateConfig:{minValue:Date.parseDate(e,"c"),maxValue:Date.parseDate(a,"c")},timeConfig:{increment:d},value:(this.layer.params.TIME)?this.layer.params.TIME:this.layer.dimensions.time["default"],width:340});}});Ext.reg("gn_timeselector",GeoNetwork.TimeSelector);Ext.namespace("GeoNetwork");GeoNetwork.BaseWindow=function(a){Ext.apply(this,a);GeoNetwork.BaseWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.BaseWindow,Ext.Window,{map:null,initComponent:function(){GeoNetwork.BaseWindow.superclass.initComponent.call(this);this.constrainHeader=true;this.collapsible=true;this.layout="fit";this.plain=true;this.stateful=false;}});Ext.namespace("GeoNetwork");GeoNetwork.SingletonWindowManager=function(){var a=new Object();var b=new Array();return{registerWindow:function(g,e,d){var f=new e(d);a[g]={windowz:f,classz:e,configz:d};},getWindow:function(d){if(a[d]){return a[d].windowz;}else{return null;}},showWindow:function(f){if(a[f]){if(Ext.isEmpty(Ext.getCmp(f))){var d=a[f];var e=new d.classz(d.configz);a[f]={windowz:e,classz:d.classz,configz:d.configz};}a[f].windowz.show();return true;}else{return false;}},hideAllWindows:function(){for(key in a){if(a[key].windowz.isVisible()){a[key].windowz.setVisible(false);b[b.length]=key;}}},restoreHiddenWindows:function(){for(var e=0,d=b.length;e<d;++e){a[b[e]].windowz.setVisible(true);}b=new Array();}};};GeoNetwork.WindowManager=new GeoNetwork.SingletonWindowManager();Ext.namespace("GeoNetwork");GeoNetwork.AddWmsLayerWindow=function(a){Ext.apply(this,a);GeoNetwork.AddWmsLayerWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.AddWmsLayerWindow,GeoNetwork.BaseWindow,{iconCls:"addLayerIcon",browserPanel:null,initComponent:function(){GeoNetwork.AddWmsLayerWindow.superclass.initComponent.call(this);this.title=this.title||OpenLayers.i18n("addWMSWindowTitle");this.width=600;this.height=500;var b=new Ext.data.Store({data:GeoNetwork.WMSList,reader:new Ext.data.ArrayReader({},[{name:"title"},{name:"url"}])});this.browserPanel={id:this.id+"wmsbrowserpanel",xtype:"gn_wmsbrowserpanel",mode:GeoNetwork.wms.BrowserPanel.ADDWMS,wmsStore:b,map:this.map};var a=new Ext.Panel({border:false,deferredRender:false,layout:"fit",items:[this.browserPanel]});this.add(a);this.doLayout();}});Ext.namespace("GeoNetwork");GeoNetwork.FeatureInfoWindow=function(a){Ext.apply(this,a);GeoNetwork.FeatureInfoWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.FeatureInfoWindow,GeoNetwork.BaseWindow,{control:null,initComponent:function(){GeoNetwork.FeatureInfoWindow.superclass.initComponent.call(this);this.title=this.title||OpenLayers.i18n("featureInfoWindow.windowTitle");this.width=600;this.height=250;this.cls="popup-variant1";var a=new GeoNetwork.FeatureInfoPanel();this.add(a);this.doLayout();},setFeatures:function(a){this.items.items[0].showFeatures(a);},setMap:function(a){this.items.items[0].setMap(a);}});Ext.namespace("GeoNetwork");GeoNetwork.LoadWmcWindow=function(a){Ext.apply(this,a);GeoNetwork.LoadWmcWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.LoadWmcWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.LoadWmcWindow.superclass.initComponent.call(this);this.width=480;this.title=this.title||OpenLayers.i18n("selectWMCFile.windowTitle");this.resizable=false;this.charset="UTF-8";var a=new Ext.FormPanel({fileUpload:true,height:100,bodyStyle:"padding: 10px 10px 0 10px;",labelWidth:0,plain:true,frame:true,border:false,defaults:{anchor:"90%",msgTarget:"side",allowBlank:false},items:[{xtype:"fileuploadfield",id:"form-file",width:120,emptyText:OpenLayers.i18n("selectWMCFile"),hideLabel:true,buttonText:"",name:"Fileconten",buttonCfg:{text:"",iconCls:"selectfile"}}],buttons:[{text:OpenLayers.i18n("selectWMCFile.loadButtonText"),scope:this,handler:function(){if(a.getForm().isValid()){a.getForm().submit({url:"../../wmc/load.wmc",success:this.onSuccessLoad,failure:this.onFailure,scope:this});}}},{text:OpenLayers.i18n("selectWMCFile.mergeButtonText"),scope:this,handler:function(){if(a.getForm().isValid()){a.getForm().submit({url:"../../wmc/load.wmc",success:this.onSuccessMerge,failure:this.onFailure,scope:this});}}}]});this.add(a);this.doLayout();},onSuccessLoad:function(d,e){var b=e.response.responseText;var f=Ext.decode(b);if(f.success){var a=OpenLayers.Function.bind(this.parseWMCLoad,this);OpenLayers.loadURL(f.url,null,null,a);}else{this.onAjaxFailure();}},onSuccessMerge:function(d,e){var b=e.response.responseText;var f=Ext.decode(b);if(f.success){var a=OpenLayers.Function.bind(this.parseWMCMerge,this);OpenLayers.loadURL(f.url,null,null,a);}else{this.onAjaxFailure();}},onFailure:function(a,b){Ext.MessageBox.show({icon:Ext.MessageBox.ERROR,title:OpenLayers.i18n("errorTitle"),msg:OpenLayers.i18n("InvalidWMC"),buttons:Ext.MessageBox.OK});},parseWMCLoad:function(a){GeoNetwork.WMCManager.loadWmc(this.map,a.responseText);Ext.WindowMgr.getActive().close();},parseWMCMerge:function(a){GeoNetwork.WMCManager.mergeWmc(this.map,a.responseText);Ext.WindowMgr.getActive().close();}});Ext.namespace("GeoNetwork");GeoNetwork.DisclaimerWindow=function(a){Ext.apply(this,a);GeoNetwork.DisclaimerWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.DisclaimerWindow,Ext.Window,{disclaimer:null,initComponent:function(){GeoNetwork.BaseWindow.superclass.initComponent.call(this);this.id="disclaimerwindow";this.constrainHeader=true;this.layout="fit";this.plain=true;this.stateful=false;this.title=OpenLayers.i18n("disclaimer.windowTitle");this.minWidth=440;this.minHeight=280;this.width=440;this.height=280;this.autoScroll=true;this.modal=true;this.addButton(OpenLayers.i18n("disclaimer.buttonClose"),function(){this.close();},this);if(this.disclaimer.startsWith("http://")){this.on("show",this.showDisclaimerUrl);}else{var a=new Ext.form.TextArea({hideLabel:true,name:"msg",value:this.disclaimer,anchor:"100% -53",enableKeyEvents:true,listeners:{keydown:function(d,b){if(!(b.getKey()==67&&b.ctrlKey)){b.stopEvent();}}}});this.add(a);}this.doLayout();},showDisclaimerUrl:function(){this.load({url:OpenLayers.ProxyHost+this.disclaimer,text:OpenLayers.i18n("disclaimer.loading"),timeout:30,scripts:false});}});Ext.namespace("GeoNetwork");GeoNetwork.LayerStylesWindow=function(a){Ext.apply(this,a);GeoNetwork.LayerStylesWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.LayerStylesWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.LayerStylesWindow.superclass.initComponent.call(this);this.title=this.title||OpenLayers.i18n("layerStylesWindowTitle");this.width=575;this.height=300;this.layerStylesPanel=new GeoNetwork.wms.LayerStylesPanel({map:this.map});this.add(this.layerStylesPanel);this.addButton(OpenLayers.i18n("selectStyleButton"),this._selectStyle,this);this.doLayout();},showLayerStyles:function(a){this.layer=a;this.layerStylesPanel.showLayerStyles(a);},_selectStyle:function(){this.layer.mergeNewParams({styles:this.layerStylesPanel.selectedStyle});this.layer.legendURL=this.layerStylesPanel.selectedStyleLegendUrl;}});Ext.namespace("GeoNetwork");GeoNetwork.WmsLayerMetadataWindow=function(a){Ext.apply(this,a);GeoNetwork.WmsLayerMetadataWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.WmsLayerMetadataWindow,GeoNetwork.BaseWindow,{layer:null,initComponent:function(){GeoNetwork.WmsLayerMetadataWindow.superclass.initComponent.call(this);this.title=this.title||OpenLayers.i18n("layerInfoPanel.windowTitle");this.width=575;this.height=300;this.infoLayerPanel=new GeoNetwork.wms.LayerInfoPanel({map:this.map});this.add(this.infoLayerPanel);this.doLayout();},showLayerInfo:function(a){this.infoLayerPanel.layer=a;this.infoLayerPanel.onlineresource=a.url;this.infoLayerPanel.showLayerInfo();}});Ext.namespace("GeoNetwork");GeoNetwork.WMSTimeWindow=function(a){Ext.apply(this,a);GeoNetwork.WMSTimeWindow.superclass.constructor.call(this);};Ext.extend(GeoNetwork.WMSTimeWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.WMSTimeWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("WMSTimeWindowTitle");this.width=450;this.height=300;this.timeSelector=new GeoNetwork.TimeSelector({bodyStyle:"padding: 10px 10px 0 10px;"});this.add(this.timeSelector);this.doLayout();},setLayer:function(a){this.timeSelector.setLayer(a);}});